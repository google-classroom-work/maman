/*!For license information please see 639.fe770ac0.chunk.js.LICENSE.txt*/(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[639],{78502:function(w,v,I){"use strict";I.d(v,{d:function(){return Q},h:function(){return a},i:function(){return K},m:function(){return u},p:function(){return U}});var P=function(w,v){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,v){w.__proto__=v}||function(w,v){for(var I in v)Object.prototype.hasOwnProperty.call(v,I)&&(w[I]=v[I])},P(w,v)};function u(w,v){if("function"!==typeof v&&null!==v)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");function I(){this.constructor=w}P(w,v),w.prototype=null===v?Object.create(v):(I.prototype=v.prototype,new I)}var Q=function(){return Q=Object.assign||function(w){for(var v,I=1,P=arguments.length;I<P;I++)for(var u in v=arguments[I])Object.prototype.hasOwnProperty.call(v,u)&&(w[u]=v[u]);return w},Q.apply(this,arguments)};function K(w,v,I,P){var u,Q=arguments.length,K=Q<3?v:null===P?P=Object.getOwnPropertyDescriptor(v,I):P;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)K=Reflect.decorate(w,v,I,P);else for(var a=w.length-1;a>=0;a--)(u=w[a])&&(K=(Q<3?u(K):Q>3?u(v,I,K):u(v,I))||K);return Q>3&&K&&Object.defineProperty(v,I,K),K}function a(w,v,I,P){return new(I||(I=Promise))((function(u,Q){function K(w){try{U(P.next(w))}catch(w){Q(w)}}function a(w){try{U(P.throw(w))}catch(w){Q(w)}}function U(w){var v;w.done?u(w.value):(v=w.value,v instanceof I?v:new I((function(w){w(v)}))).then(K,a)}U((P=P.apply(w,v||[])).next())}))}function U(w,v){var I,P,u,Q,K={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return Q={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(Q[Symbol.iterator]=function(){return this}),Q;function a(Q){return function(a){return function(Q){if(I)throw new TypeError("Generator is already executing.");for(;K;)try{if(I=1,P&&(u=2&Q[0]?P.return:Q[0]?P.throw||((u=P.return)&&u.call(P),0):P.next)&&!(u=u.call(P,Q[1])).done)return u;switch(P=0,u&&(Q=[2&Q[0],u.value]),Q[0]){case 0:case 1:u=Q;break;case 4:return K.label++,{value:Q[1],done:!1};case 5:K.label++,P=Q[1],Q=[0];continue;case 7:Q=K.ops.pop(),K.trys.pop();continue;default:if(!(u=(u=K.trys).length>0&&u[u.length-1])&&(6===Q[0]||2===Q[0])){K=0;continue}if(3===Q[0]&&(!u||Q[1]>u[0]&&Q[1]<u[3])){K.label=Q[1];break}if(6===Q[0]&&K.label<u[1]){K.label=u[1],u=Q;break}if(u&&K.label<u[2]){K.label=u[2],K.ops.push(Q);break}u[2]&&K.ops.pop(),K.trys.pop();continue}Q=v.call(w,K)}catch(w){Q=[6,w],P=0}finally{I=u=0}if(5&Q[0])throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}}([Q,a])}}}Object.create;Object.create},50061:function(w,v){!function(w){"use strict";var v=function(w,I){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,v){w.__proto__=v}||function(w,v){for(var I in v)Object.prototype.hasOwnProperty.call(v,I)&&(w[I]=v[I])},v(w,I)};function I(w,I){if("function"!==typeof I&&null!==I)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function P(){this.constructor=w}v(w,I),w.prototype=null===I?Object.create(I):(P.prototype=I.prototype,new P)}function P(w,v,I,P){var u,Q=arguments.length,K=Q<3?v:null===P?P=Object.getOwnPropertyDescriptor(v,I):P;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)K=Reflect.decorate(w,v,I,P);else for(var a=w.length-1;a>=0;a--)(u=w[a])&&(K=(Q<3?u(K):Q>3?u(v,I,K):u(v,I))||K);return Q>3&&K&&Object.defineProperty(v,I,K),K}function u(w,v,I){if(I||2===arguments.length)for(var P,u=0,Q=v.length;u<Q;u++)!P&&u in v||(P||(P=Array.prototype.slice.call(v,0,u)),P[u]=v[u]);return w.concat(P||Array.prototype.slice.call(v))}var Q,K=255,a=213;w.OPERATION=void 0,(Q=w.OPERATION||(w.OPERATION={}))[Q.ADD=128]="ADD",Q[Q.REPLACE=0]="REPLACE",Q[Q.DELETE=64]="DELETE",Q[Q.DELETE_AND_ADD=192]="DELETE_AND_ADD",Q[Q.TOUCH=1]="TOUCH",Q[Q.CLEAR=10]="CLEAR";var U=function(){function v(w,v,I){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=w,this.setParent(v,I)}return v.prototype.setParent=function(w,v,I){var P=this;if(this.indexes||(this.indexes=this.ref instanceof Nw?this.ref._definition.indexes:{}),this.parent=w,this.parentIndex=I,v)if(this.root=v,this.ref instanceof Nw){var u=this.ref._definition;for(var Q in u.schema){var K=this.ref[Q];if(K&&K.$changes){var a=u.indexes[Q];K.$changes.setParent(this.ref,v,a)}}}else"object"===typeof this.ref&&this.ref.forEach((function(w,v){if(w instanceof Nw){var I=w.$changes,u=P.ref.$changes.indexes[v];I.setParent(P.ref,P.root,u)}}))},v.prototype.operation=function(w){this.changes.set(--this.currentCustomOperation,w)},v.prototype.change=function(v,I){void 0===I&&(I=w.OPERATION.ADD);var P="number"===typeof v?v:this.indexes[v];this.assertValidIndex(P,v);var u=this.changes.get(P);u&&u.op!==w.OPERATION.DELETE&&u.op!==w.OPERATION.TOUCH||this.changes.set(P,{op:u&&u.op===w.OPERATION.DELETE?w.OPERATION.DELETE_AND_ADD:I,index:P}),this.allChanges.add(P),this.changed=!0,this.touchParents()},v.prototype.touch=function(v){var I="number"===typeof v?v:this.indexes[v];this.assertValidIndex(I,v),this.changes.has(I)||this.changes.set(I,{op:w.OPERATION.TOUCH,index:I}),this.allChanges.add(I),this.touchParents()},v.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},v.prototype.getType=function(w){if(this.ref._definition)return(v=this.ref._definition).schema[v.fieldsByIndex[w]];var v,I=(v=this.parent._definition).schema[v.fieldsByIndex[this.parentIndex]];return Object.values(I)[0]},v.prototype.getChildrenFilter=function(){var w=this.parent._definition.childFilters;return w&&w[this.parentIndex]},v.prototype.getValue=function(w){return this.ref.getByIndex(w)},v.prototype.delete=function(v){var I="number"===typeof v?v:this.indexes[v];if(void 0!==I){var P=this.getValue(I);this.changes.set(I,{op:w.OPERATION.DELETE,index:I}),this.allChanges.delete(I),delete this.caches[I],P&&P.$changes&&(P.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(v," (").concat(I,")"))},v.prototype.discard=function(v,I){var P=this;void 0===v&&(v=!1),void 0===I&&(I=!1),this.ref instanceof Nw||this.changes.forEach((function(v){if(v.op===w.OPERATION.DELETE){var I=P.ref.getIndex(v.index);delete P.indexes[I]}})),this.changes.clear(),this.changed=v,I&&this.allChanges.clear(),this.currentCustomOperation=0},v.prototype.discardAll=function(){var w=this;this.changes.forEach((function(v){var I=w.getValue(v.index);I&&I.$changes&&I.$changes.discardAll()})),this.discard()},v.prototype.cache=function(w,v){this.caches[w]=v},v.prototype.clone=function(){return new v(this.ref,this.parent,this.root)},v.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},v.prototype.assertValidIndex=function(w,v){if(void 0===w)throw new Error('ChangeTree: missing index for field "'.concat(v,'"'))},v}();function p(w,v,I,P){return w[v]||(w[v]=[]),w[v].push(I),null===P||void 0===P||P.forEach((function(w,v){return I(w,v)})),function(){return Y(w[v],w[v].indexOf(I))}}function r(v){var I=this,P="string"!==typeof this.$changes.getType();this.$items.forEach((function(u,Q){v.push({refId:I.$changes.refId,op:w.OPERATION.DELETE,field:Q,value:void 0,previousValue:u}),P&&I.$changes.root.removeRef(u.$changes.refId)}))}function Y(w,v){if(-1===v||v>=w.length)return!1;for(var I=w.length-1,P=v;P<I;P++)w[P]=w[P+1];return w.length=I,!0}var g=function(w,v){var I=w.toString(),P=v.toString();return I<P?-1:I>P?1:0};function J(w){return w.$proxy=!0,w=new Proxy(w,{get:function(w,v){return"symbol"===typeof v||isNaN(v)?w[v]:w.at(v)},set:function(w,v,I){if("symbol"===typeof v||isNaN(v))w[v]=I;else{var P=Array.from(w.$items.keys()),u=parseInt(P[v]||v);void 0===I||null===I?w.deleteAt(u):w.setAt(u,I)}return!0},deleteProperty:function(w,v){return"number"===typeof v?w.deleteAt(v):delete w[v],!0}})}var l=function(){function v(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,w)}return v.prototype.onAdd=function(v,I){return void 0===I&&(I=!0),p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,v,I?this.$items:void 0)},v.prototype.onRemove=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,v)},v.is=function(w){return Array.isArray(w)||void 0!==w.array},Object.defineProperty(v.prototype,"length",{get:function(){return this.$items.size},set:function(w){0===w?this.clear():this.splice(w,this.length-w)},enumerable:!1,configurable:!0}),v.prototype.push=function(){for(var w,v=this,I=[],P=0;P<arguments.length;P++)I[P]=arguments[P];return I.forEach((function(I){w=v.$refId++,v.setAt(w,I)})),w},v.prototype.pop=function(){var w=Array.from(this.$indexes.values()).pop();if(void 0!==w){this.$changes.delete(w),this.$indexes.delete(w);var v=this.$items.get(w);return this.$items.delete(w),v}},v.prototype.at=function(w){var v=Array.from(this.$items.keys())[w];return this.$items.get(v)},v.prototype.setAt=function(v,I){var P,u;if(void 0!==I&&null!==I){if(this.$items.get(v)!==I){void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,v);var Q=null!==(u=null===(P=this.$changes.indexes[v])||void 0===P?void 0:P.op)&&void 0!==u?u:w.OPERATION.ADD;this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,I),this.$changes.change(v,Q)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},v.prototype.deleteAt=function(w){var v=Array.from(this.$items.keys())[w];return void 0!==v&&this.$deleteAt(v)},v.prototype.$deleteAt=function(w){return this.$changes.delete(w),this.$indexes.delete(w),this.$items.delete(w)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&r.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.concat=function(){for(var w,I=[],P=0;P<arguments.length;P++)I[P]=arguments[P];return new(v.bind.apply(v,u([void 0],(w=Array.from(this.$items.values())).concat.apply(w,I),!1)))},v.prototype.join=function(w){return Array.from(this.$items.values()).join(w)},v.prototype.reverse=function(){var w=this,v=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(I,P){w.setAt(v[P],I)})),this},v.prototype.shift=function(){var w=Array.from(this.$items.keys()).shift();if(void 0!==w){var v=this.$items.get(w);return this.$deleteAt(w),v}},v.prototype.slice=function(w,I){var P=new v;return P.push.apply(P,Array.from(this.$items.values()).slice(w,I)),P},v.prototype.sort=function(w){var v=this;void 0===w&&(w=g);var I=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(w).forEach((function(w,P){v.setAt(I[P],w)})),this},v.prototype.splice=function(w,v){void 0===v&&(v=this.length-w);for(var I=Array.from(this.$items.keys()),P=[],u=w;u<w+v;u++)P.push(this.$items.get(I[u])),this.$deleteAt(I[u]);return P},v.prototype.unshift=function(){for(var w=this,v=[],I=0;I<arguments.length;I++)v[I]=arguments[I];var P=this.length,u=v.length,Q=Array.from(this.$items.values());return v.forEach((function(v,I){w.setAt(I,v)})),Q.forEach((function(v,I){w.setAt(u+I,v)})),P+u},v.prototype.indexOf=function(w,v){return Array.from(this.$items.values()).indexOf(w,v)},v.prototype.lastIndexOf=function(w,v){return void 0===v&&(v=this.length-1),Array.from(this.$items.values()).lastIndexOf(w,v)},v.prototype.every=function(w,v){return Array.from(this.$items.values()).every(w,v)},v.prototype.some=function(w,v){return Array.from(this.$items.values()).some(w,v)},v.prototype.forEach=function(w,v){Array.from(this.$items.values()).forEach(w,v)},v.prototype.map=function(w,v){return Array.from(this.$items.values()).map(w,v)},v.prototype.filter=function(w,v){return Array.from(this.$items.values()).filter(w,v)},v.prototype.reduce=function(w,v){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},v.prototype.reduceRight=function(w,v){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},v.prototype.find=function(w,v){return Array.from(this.$items.values()).find(w,v)},v.prototype.findIndex=function(w,v){return Array.from(this.$items.values()).findIndex(w,v)},v.prototype.fill=function(w,v,I){throw new Error("ArraySchema#fill() not implemented")},v.prototype.copyWithin=function(w,v,I){throw new Error("ArraySchema#copyWithin() not implemented")},v.prototype.toString=function(){return this.$items.toString()},v.prototype.toLocaleString=function(){return this.$items.toLocaleString()},v.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},v.prototype.includes=function(w,v){return Array.from(this.$items.values()).includes(w,v)},v.prototype.flatMap=function(w,v){throw new Error("ArraySchema#flatMap() is not supported.")},v.prototype.flat=function(w){throw new Error("ArraySchema#flat() is not supported.")},v.prototype.findLast=function(){var w=Array.from(this.$items.values());return w.findLast.apply(w,arguments)},v.prototype.findLastIndex=function(){var w=Array.from(this.$items.values());return w.findLastIndex.apply(w,arguments)},v.prototype.setIndex=function(w,v){this.$indexes.set(w,v)},v.prototype.getIndex=function(w){return this.$indexes.get(w)},v.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},v.prototype.deleteByIndex=function(w){var v=this.$indexes.get(w);this.$items.delete(v),this.$indexes.delete(w)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){return this.toArray().map((function(w){return"function"===typeof w.toJSON?w.toJSON():w}))},v.prototype.clone=function(w){return w?new(v.bind.apply(v,u([void 0],Array.from(this.$items.values()),!1))):new(v.bind.apply(v,u([void 0],this.map((function(w){return w.$changes?w.clone():w})),!1)))},v}();function R(w){return w.$proxy=!0,w=new Proxy(w,{get:function(w,v){return"symbol"!==typeof v&&"undefined"===typeof w[v]?w.get(v):w[v]},set:function(w,v,I){return"symbol"!==typeof v&&-1===v.indexOf("$")&&"onAdd"!==v&&"onRemove"!==v&&"onChange"!==v?w.set(v,I):w[v]=I,!0},deleteProperty:function(w,v){return w.delete(v),!0}})}var x=function(){function v(w){var I=this;if(this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w)if(w instanceof Map||w instanceof v)w.forEach((function(w,v){return I.set(v,w)}));else for(var P in w)this.set(P,w[P])}return v.prototype.onAdd=function(v,I){return void 0===I&&(I=!0),p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,v,I?this.$items:void 0)},v.prototype.onRemove=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,v)},v.is=function(w){return void 0!==w.map},v.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(v.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.set=function(v,I){if(void 0===I||null===I)throw new Error("MapSchema#set('".concat(v,"', ").concat(I,"): trying to set ").concat(I," value on '").concat(v,"'."));v=v.toString();var P="undefined"!==typeof this.$changes.indexes[v],u=P?this.$changes.indexes[v]:this.$refId++,Q=P?w.OPERATION.REPLACE:w.OPERATION.ADD,K=void 0!==I.$changes;if(K&&I.$changes.setParent(this,this.$changes.root,u),P){if(!K&&this.$items.get(v)===I)return;K&&this.$items.get(v)!==I&&(Q=w.OPERATION.ADD)}else this.$changes.indexes[v]=u,this.$indexes.set(u,v);return this.$items.set(v,I),this.$changes.change(v,Q),this},v.prototype.get=function(w){return this.$items.get(w)},v.prototype.delete=function(w){return this.$changes.delete(w),this.$items.delete(w)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&r.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(w){return this.$items.has(w)},v.prototype.forEach=function(w){this.$items.forEach(w)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(w,v){this.$indexes.set(w,v)},v.prototype.getIndex=function(w){return this.$indexes.get(w)},v.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},v.prototype.deleteByIndex=function(w){var v=this.$indexes.get(w);this.$items.delete(v),this.$indexes.delete(w)},v.prototype.toJSON=function(){var w={};return this.forEach((function(v,I){w[I]="function"===typeof v.toJSON?v.toJSON():v})),w},v.prototype.clone=function(w){var I;return w?I=Object.assign(new v,this):(I=new v,this.forEach((function(w,v){w.$changes?I.set(v,w.clone()):I.set(v,w)}))),I},v}(),j={};function s(w,v){j[w]=v}function B(w){return j[w]}var t=function(){function w(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return w.create=function(v){var I=new w;return I.schema=Object.assign({},v&&v.schema||{}),I.indexes=Object.assign({},v&&v.indexes||{}),I.fieldsByIndex=Object.assign({},v&&v.fieldsByIndex||{}),I.descriptors=Object.assign({},v&&v.descriptors||{}),I.deprecated=Object.assign({},v&&v.deprecated||{}),I},w.prototype.addField=function(w,v){var I=this.getNextFieldIndex();this.fieldsByIndex[I]=w,this.indexes[w]=I,this.schema[w]=Array.isArray(v)?{array:v[0]}:v},w.prototype.hasField=function(w){return void 0!==this.indexes[w]},w.prototype.addFilter=function(w,v){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[w]]=v,this.indexesWithFilters.push(this.indexes[w]),!0},w.prototype.addChildrenFilter=function(w,v){var I=this.indexes[w],P=this.schema[w];if(B(Object.keys(P)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[I]=v,!0;console.warn("@filterChildren: field '".concat(w,"' can't have children. Ignoring filter."))},w.prototype.getChildrenFilter=function(w){return this.childFilters&&this.childFilters[this.indexes[w]]},w.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},w}();function i(w){return w._context&&w._context.useFilters}var z=function(){function w(){this.types={},this.schemas=new Map,this.useFilters=!1}return w.prototype.has=function(w){return this.schemas.has(w)},w.prototype.get=function(w){return this.types[w]},w.prototype.add=function(w,v){void 0===v&&(v=this.schemas.size),w._definition=t.create(w._definition),w._typeid=v,this.types[v]=w,this.schemas.set(w,v)},w.create=function(v){return void 0===v&&(v={}),function(I){return v.context||(v.context=new w),o(I,v)}},w}(),E=new z;function o(w,v){return void 0===v&&(v={}),function(I,P){var Q=v.context||E,K=I.constructor;if(K._context=Q,!w)throw new Error("".concat(K.name,': @type() reference provided for "').concat(P,"\" is undefined. Make sure you don't have any circular dependencies."));Q.has(K)||Q.add(K);var a=K._definition;if(a.addField(P,w),a.descriptors[P]){if(a.deprecated[P])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(P,"' definition on '").concat(K.name,"'.\nCheck @type() annotation"))}catch(w){var U=w.stack.split("\n")[4].trim();throw new Error("".concat(w.message," ").concat(U))}}var p=l.is(w),r=!p&&x.is(w);if("string"!==typeof w&&!Nw.is(w)){var Y=Object.values(w)[0];"string"===typeof Y||Q.has(Y)||Q.add(Y)}if(v.manual)a.descriptors[P]={enumerable:!0,configurable:!0,writable:!0};else{var g="_".concat(P);a.descriptors[g]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[P]={get:function(){return this[g]},set:function(w){w!==this[g]&&(void 0!==w&&null!==w?(!p||w instanceof l||(w=new(l.bind.apply(l,u([void 0],w,!1)))),!r||w instanceof x||(w=new x(w)),void 0===w.$proxy&&(r?w=R(w):p&&(w=J(w))),this.$changes.change(P),w.$changes&&w.$changes.setParent(this,this.$changes.root,this._definition.indexes[P])):this[g]&&this.$changes.delete(P),this[g]=w)},enumerable:!0,configurable:!0}}}}function h(w){return function(v,I){var P=v.constructor;P._definition.addFilter(I,w)&&(P._context.useFilters=!0)}}function n(w){return function(v,I){var P=v.constructor;P._definition.addChildrenFilter(I,w)&&(P._context.useFilters=!0)}}function W(w){return void 0===w&&(w=!0),function(v,I){var P=v.constructor._definition;P.deprecated[I]=!0,w&&(P.descriptors[I]={get:function(){throw new Error("".concat(I," is deprecated."))},set:function(w){},enumerable:!1,configurable:!0})}}function V(w,v,I){for(var P in void 0===I&&(I={}),I.context||(I.context=w._context||I.context||E),v)o(v[P],I)(w.prototype,P);return w}function F(w){for(var v=0,I=0,P=0,u=w.length;P<u;P++)(v=w.charCodeAt(P))<128?I+=1:v<2048?I+=2:v<55296||v>=57344?I+=3:(P++,I+=4);return I}function O(w,v,I){for(var P=0,u=0,Q=I.length;u<Q;u++)(P=I.charCodeAt(u))<128?w[v++]=P:P<2048?(w[v++]=192|P>>6,w[v++]=128|63&P):P<55296||P>=57344?(w[v++]=224|P>>12,w[v++]=128|P>>6&63,w[v++]=128|63&P):(u++,P=65536+((1023&P)<<10|1023&I.charCodeAt(u)),w[v++]=240|P>>18,w[v++]=128|P>>12&63,w[v++]=128|P>>6&63,w[v++]=128|63&P)}function N(w,v){w.push(255&v)}function q(w,v){w.push(255&v)}function m(w,v){w.push(255&v),w.push(v>>8&255)}function c(w,v){w.push(255&v),w.push(v>>8&255)}function M(w,v){w.push(255&v),w.push(v>>8&255),w.push(v>>16&255),w.push(v>>24&255)}function S(w,v){var I=v>>24,P=v>>16,u=v>>8,Q=v;w.push(255&Q),w.push(255&u),w.push(255&P),w.push(255&I)}function e(w,v){var I=Math.floor(v/Math.pow(2,32));S(w,v>>>0),S(w,I)}function H(w,v){var I=v/Math.pow(2,32)>>0;S(w,v>>>0),S(w,I)}function G(w,v){b(w,v)}function L(w,v){k(w,v)}var d=new Int32Array(2),D=new Float32Array(d.buffer),f=new Float64Array(d.buffer);function b(w,v){D[0]=v,M(w,d[0])}function k(w,v){f[0]=v,M(w,d[0]),M(w,d[1])}function C(w,v){return q(w,v?1:0)}function y(w,v){v||(v="");var I=F(v),P=0;if(I<32)w.push(160|I),P=1;else if(I<256)w.push(217),q(w,I),P=2;else if(I<65536)w.push(218),c(w,I),P=3;else{if(!(I<4294967296))throw new Error("String too long");w.push(219),S(w,I),P=5}return O(w,w.length,v),P+I}function T(w,v){return isNaN(v)?T(w,0):isFinite(v)?v!==(0|v)?(w.push(203),k(w,v),9):v>=0?v<128?(q(w,v),1):v<256?(w.push(204),q(w,v),2):v<65536?(w.push(205),c(w,v),3):v<4294967296?(w.push(206),S(w,v),5):(w.push(207),H(w,v),9):v>=-32?(w.push(224|v+32),1):v>=-128?(w.push(208),N(w,v),2):v>=-32768?(w.push(209),m(w,v),3):v>=-2147483648?(w.push(210),M(w,v),5):(w.push(211),e(w,v),9):T(w,v>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Z=Object.freeze({__proto__:null,utf8Write:O,int8:N,uint8:q,int16:m,uint16:c,int32:M,uint32:S,int64:e,uint64:H,float32:G,float64:L,writeFloat32:b,writeFloat64:k,boolean:C,string:y,number:T});function A(w,v,I){for(var P="",u=0,Q=v,K=v+I;Q<K;Q++){var a=w[Q];0!==(128&a)?192!==(224&a)?224!==(240&a)?240!==(248&a)?console.error("Invalid byte "+a.toString(16)):(u=(7&a)<<18|(63&w[++Q])<<12|(63&w[++Q])<<6|(63&w[++Q])<<0)>=65536?(u-=65536,P+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):P+=String.fromCharCode(u):P+=String.fromCharCode((15&a)<<12|(63&w[++Q])<<6|(63&w[++Q])<<0):P+=String.fromCharCode((31&a)<<6|63&w[++Q]):P+=String.fromCharCode(a)}return P}function X(w,v){return ww(w,v)<<24>>24}function ww(w,v){return w[v.offset++]}function vw(w,v){return Iw(w,v)<<16>>16}function Iw(w,v){return w[v.offset++]|w[v.offset++]<<8}function Pw(w,v){return w[v.offset++]|w[v.offset++]<<8|w[v.offset++]<<16|w[v.offset++]<<24}function uw(w,v){return Pw(w,v)>>>0}function Qw(w,v){return gw(w,v)}function Kw(w,v){return Jw(w,v)}function aw(w,v){var I=uw(w,v);return Pw(w,v)*Math.pow(2,32)+I}function Uw(w,v){var I=uw(w,v);return uw(w,v)*Math.pow(2,32)+I}var pw=new Int32Array(2),rw=new Float32Array(pw.buffer),Yw=new Float64Array(pw.buffer);function gw(w,v){return pw[0]=Pw(w,v),rw[0]}function Jw(w,v){return pw[0]=Pw(w,v),pw[1]=Pw(w,v),Yw[0]}function lw(w,v){return ww(w,v)>0}function Rw(w,v){var I,P=w[v.offset++];P<192?I=31&P:217===P?I=ww(w,v):218===P?I=Iw(w,v):219===P&&(I=uw(w,v));var u=A(w,v.offset,I);return v.offset+=I,u}function xw(w,v){var I=w[v.offset];return I<192&&I>160||217===I||218===I||219===I}function jw(w,v){var I=w[v.offset++];return I<128?I:202===I?gw(w,v):203===I?Jw(w,v):204===I?ww(w,v):205===I?Iw(w,v):206===I?uw(w,v):207===I?Uw(w,v):208===I?X(w,v):209===I?vw(w,v):210===I?Pw(w,v):211===I?aw(w,v):I>223?-1*(255-I+1):void 0}function sw(w,v){var I=w[v.offset];return I<128||I>=202&&I<=211}function Bw(w,v){return w[v.offset]<160}function tw(w,v){return w[v.offset-1]===K&&(w[v.offset]<128||w[v.offset]>=202&&w[v.offset]<=211)}var iw=Object.freeze({__proto__:null,int8:X,uint8:ww,int16:vw,uint16:Iw,int32:Pw,uint32:uw,float32:Qw,float64:Kw,int64:aw,uint64:Uw,readFloat32:gw,readFloat64:Jw,boolean:lw,string:Rw,stringCheck:xw,number:jw,numberCheck:sw,arrayCheck:Bw,switchStructureCheck:tw}),zw=function(){function v(w){var v=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w&&w.forEach((function(w){return v.add(w)}))}return v.prototype.onAdd=function(v,I){return void 0===I&&(I=!0),p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,v,I?this.$items:void 0)},v.prototype.onRemove=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,v)},v.is=function(w){return void 0!==w.collection},v.prototype.add=function(w){var v=this.$refId++;return void 0!==w.$changes&&w.$changes.setParent(this,this.$changes.root,v),this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,w),this.$changes.change(v),v},v.prototype.at=function(w){var v=Array.from(this.$items.keys())[w];return this.$items.get(v)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(w){for(var v,I,P=this.$items.entries();(I=P.next())&&!I.done;)if(w===I.value[1]){v=I.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&r.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(w){return Array.from(this.$items.values()).some((function(v){return v===w}))},v.prototype.forEach=function(w){var v=this;this.$items.forEach((function(I,P,u){return w(I,P,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(w,v){this.$indexes.set(w,v)},v.prototype.getIndex=function(w){return this.$indexes.get(w)},v.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},v.prototype.deleteByIndex=function(w){var v=this.$indexes.get(w);this.$items.delete(v),this.$indexes.delete(w)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var w=[];return this.forEach((function(v,I){w.push("function"===typeof v.toJSON?v.toJSON():v)})),w},v.prototype.clone=function(w){var I;return w?I=Object.assign(new v,this):(I=new v,this.forEach((function(w){w.$changes?I.add(w.clone()):I.add(w)}))),I},v}(),Ew=function(){function v(w){var v=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w&&w.forEach((function(w){return v.add(w)}))}return v.prototype.onAdd=function(v,I){return void 0===I&&(I=!0),p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,v,I?this.$items:void 0)},v.prototype.onRemove=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,v)},v.is=function(w){return void 0!==w.set},v.prototype.add=function(v){var I,P;if(this.has(v))return!1;var u=this.$refId++;void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,u);var Q=null!==(P=null===(I=this.$changes.indexes[u])||void 0===I?void 0:I.op)&&void 0!==P?P:w.OPERATION.ADD;return this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,v),this.$changes.change(u,Q),u},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(w){for(var v,I,P=this.$items.entries();(I=P.next())&&!I.done;)if(w===I.value[1]){v=I.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&r.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(w){for(var v,I=this.$items.values(),P=!1;(v=I.next())&&!v.done;)if(w===v.value){P=!0;break}return P},v.prototype.forEach=function(w){var v=this;this.$items.forEach((function(I,P,u){return w(I,P,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(w,v){this.$indexes.set(w,v)},v.prototype.getIndex=function(w){return this.$indexes.get(w)},v.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},v.prototype.deleteByIndex=function(w){var v=this.$indexes.get(w);this.$items.delete(v),this.$indexes.delete(w)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var w=[];return this.forEach((function(v,I){w.push("function"===typeof v.toJSON?v.toJSON():v)})),w},v.prototype.clone=function(w){var I;return w?I=Object.assign(new v,this):(I=new v,this.forEach((function(w){w.$changes?I.add(w.clone()):I.add(w)}))),I},v}(),ow=function(){function w(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return w.prototype.addRefId=function(w){this.refIds.has(w)||(this.refIds.add(w),this.containerIndexes.set(w,new Set))},w.get=function(v){return void 0===v.$filterState&&(v.$filterState=new w),v.$filterState},w}(),hw=function(){function w(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return w.prototype.getNextUniqueId=function(){return this.nextUniqueId++},w.prototype.addRef=function(w,v,I){void 0===I&&(I=!0),this.refs.set(w,v),I&&(this.refCounts[w]=(this.refCounts[w]||0)+1)},w.prototype.removeRef=function(w){this.refCounts[w]=this.refCounts[w]-1,this.deletedRefs.add(w)},w.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},w.prototype.garbageCollectDeletedRefs=function(){var w=this;this.deletedRefs.forEach((function(v){if(!(w.refCounts[v]>0)){var I=w.refs.get(v);if(I instanceof Nw)for(var P in I._definition.schema)"string"!==typeof I._definition.schema[P]&&I[P]&&I[P].$changes&&w.removeRef(I[P].$changes.refId);else{var u=I.$changes.parent._definition,Q=u.schema[u.fieldsByIndex[I.$changes.parentIndex]];"function"===typeof Object.values(Q)[0]&&Array.from(I.values()).forEach((function(v){return w.removeRef(v.$changes.refId)}))}w.refs.delete(v),delete w.refCounts[v]}})),this.deletedRefs.clear()},w}(),nw=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return I(v,w),v}(Error);function Ww(w,v,I,P){var u,Q=!1;switch(v){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":u="number",isNaN(w)&&console.log('trying to encode "NaN" in '.concat(I.constructor.name,"#").concat(P));break;case"string":u="string",Q=!0;break;case"boolean":return}if(typeof w!==u&&(!Q||Q&&null!==w)){var K="'".concat(JSON.stringify(w),"'").concat(w&&w.constructor&&" (".concat(w.constructor.name,")")||"");throw new nw("a '".concat(u,"' was expected, but ").concat(K," was provided in ").concat(I.constructor.name,"#").concat(P))}}function Vw(w,v,I,P){if(!(w instanceof v))throw new nw("a '".concat(v.name,"' was expected, but '").concat(w.constructor.name,"' was provided in ").concat(I.constructor.name,"#").concat(P))}function Fw(w,v,I,P,u){Ww(I,w,P,u);var Q=Z[w];if(!Q)throw new nw("a '".concat(w,"' was expected, but ").concat(I," was provided in ").concat(P.constructor.name,"#").concat(u));Q(v,I)}function Ow(w,v,I){return iw[w](v,I)}var Nw=function(){function v(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];Object.defineProperties(this,{$changes:{value:new U(this,void 0,new hw),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var I=this._definition.descriptors;I&&Object.defineProperties(this,I),w[0]&&this.assign(w[0])}return v.onError=function(w){console.error(w)},v.is=function(w){return w._definition&&void 0!==w._definition.schema},v.prototype.onChange=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,v)},v.prototype.onRemove=function(v){return p(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,v)},v.prototype.assign=function(w){return Object.assign(this,w),this},Object.defineProperty(v.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),v.prototype.setDirty=function(w,v){this.$changes.change(w,v)},v.prototype.listen=function(w,v,I){var P=this;return void 0===I&&(I=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[w]||(this.$callbacks[w]=[]),this.$callbacks[w].push(v),I&&void 0!==this[w]&&v(this[w],void 0),function(){return Y(P.$callbacks[w],P.$callbacks[w].indexOf(v))}},v.prototype.decode=function(I,P,u){var Q;void 0===P&&(P={offset:0}),void 0===u&&(u=this);var a=[],U=this.$changes.root,p=I.length,r=0;for(U.refs.set(r,this);P.offset<p;){var Y=I[P.offset++];if(Y!=K){var g=u.$changes,J=void 0!==u._definition,R=J?Y>>6<<6:Y;if(R!==w.OPERATION.CLEAR){var j=J?Y%(R||255):jw(I,P),s=J?u._definition.fieldsByIndex[j]:"",t=g.getType(j),i=void 0,z=void 0,E=void 0;if(J?z=u["_".concat(s)]:(z=u.getByIndex(j),(R&w.OPERATION.ADD)===w.OPERATION.ADD?(E=u instanceof x?Rw(I,P):j,u.setIndex(j,E)):E=u.getIndex(j)),(R&w.OPERATION.DELETE)===w.OPERATION.DELETE&&(R!==w.OPERATION.DELETE_AND_ADD&&u.deleteByIndex(j),z&&z.$changes&&U.removeRef(z.$changes.refId),i=null),void 0!==s){if(R===w.OPERATION.DELETE);else if(v.is(t)){var o=jw(I,P);if(i=U.refs.get(o),R!==w.OPERATION.REPLACE){var h=this.getSchemaType(I,P,t);i||((i=this.createTypeInstance(h)).$changes.refId=o,z&&(i.$callbacks=z.$callbacks,z.$changes.refId&&o!==z.$changes.refId&&U.removeRef(z.$changes.refId))),U.addRef(o,i,i!==z)}}else if("string"===typeof t)i=Ow(t,I,P);else{var n=B(Object.keys(t)[0]),W=jw(I,P),V=U.refs.has(W)?z||U.refs.get(W):new n.constructor;if((i=V.clone(!0)).$changes.refId=W,z&&(i.$callbacks=z.$callbacks,z.$changes.refId&&W!==z.$changes.refId)){U.removeRef(z.$changes.refId);for(var F=z.entries(),O=void 0;(O=F.next())&&!O.done;){var N=(Q=O.value)[0],q=Q[1];a.push({refId:W,op:w.OPERATION.DELETE,field:N,value:void 0,previousValue:q})}}U.addRef(W,i,V!==z)}if(null!==i&&void 0!==i)if(i.$changes&&i.$changes.setParent(g.ref,g.root,j),u instanceof v)u[s]=i;else if(u instanceof x)N=E,u.$items.set(N,i),u.$changes.allChanges.add(j);else if(u instanceof l)u.setAt(j,i);else if(u instanceof zw){var m=u.add(i);u.setIndex(j,m)}else u instanceof Ew&&!1!==(m=u.add(i))&&u.setIndex(j,m);z!==i&&a.push({refId:r,op:R,field:s,dynamicIndex:E,value:i,previousValue:z})}else{console.warn("@colyseus/schema: definition mismatch");for(var c={offset:P.offset};P.offset<p&&(!tw(I,P)||(c.offset=P.offset+1,!U.refs.has(jw(I,c))));)P.offset++}}else u.clear(a)}else{r=jw(I,P);var M=U.refs.get(r);if(!M)throw new Error('"refId" not found: '.concat(r));u=M}}return this._triggerChanges(a),U.garbageCollectDeletedRefs(),a},v.prototype.encode=function(I,P,u){void 0===I&&(I=!1),void 0===P&&(P=[]),void 0===u&&(u=!1);for(var Q=this.$changes,a=new WeakSet,U=[Q],p=1,r=0;r<p;r++){var Y=U[r],g=Y.ref,J=g instanceof v;Y.ensureRefId(),a.add(Y),Y!==Q&&(Y.changed||I)&&(q(P,K),T(P,Y.refId));for(var l=I?Array.from(Y.allChanges):Array.from(Y.changes.values()),R=0,j=l.length;R<j;R++){var s=I?{op:w.OPERATION.ADD,index:l[R]}:l[R],t=s.index,i=J?g._definition.fieldsByIndex&&g._definition.fieldsByIndex[t]:t,z=P.length;if(s.op!==w.OPERATION.TOUCH)if(J)q(P,t|s.op);else{if(q(P,s.op),s.op===w.OPERATION.CLEAR)continue;T(P,t)}if(J||(s.op&w.OPERATION.ADD)!=w.OPERATION.ADD||g instanceof x&&y(P,Y.ref.$indexes.get(t)),s.op!==w.OPERATION.DELETE){var E=Y.getType(t),o=Y.getValue(t);if(o&&o.$changes&&!a.has(o.$changes)&&(U.push(o.$changes),o.$changes.ensureRefId(),p++),s.op!==w.OPERATION.TOUCH){if(v.is(E))Vw(o,E,g,i),T(P,o.$changes.refId),(s.op&w.OPERATION.ADD)===w.OPERATION.ADD&&this.tryEncodeTypeId(P,E,o.constructor);else if("string"===typeof E)Fw(E,P,o,g,i);else{var h=B(Object.keys(E)[0]);Vw(g["_".concat(i)],h.constructor,g,i),T(P,o.$changes.refId)}u&&Y.cache(t,P.slice(z))}}}I||u||Y.discard()}return P},v.prototype.encodeAll=function(w){return this.encode(!0,[],w)},v.prototype.applyFilters=function(I,P){var u,Q;void 0===P&&(P=!1);for(var a=this,U=new Set,p=ow.get(I),r=[this.$changes],Y=1,g=[],J=function(J){var l=r[J];if(U.has(l.refId))return"continue";var R=l.ref,j=R instanceof v;q(g,K),T(g,l.refId);var s=p.refIds.has(l),B=P||!s;p.addRefId(l);var t=p.containerIndexes.get(l),i=B?Array.from(l.allChanges):Array.from(l.changes.values());!P&&j&&R._definition.indexesWithFilters&&R._definition.indexesWithFilters.forEach((function(v){!t.has(v)&&l.allChanges.has(v)&&(B?i.push(v):i.push({op:w.OPERATION.ADD,index:v}))}));for(var z=0,E=i.length;z<E;z++){var o=B?{op:w.OPERATION.ADD,index:i[z]}:i[z];if(o.op!==w.OPERATION.CLEAR){var h=o.index;if(o.op!==w.OPERATION.DELETE){var n=l.getValue(h),W=l.getType(h);if(j){if((V=R._definition.filters&&R._definition.filters[h])&&!V.call(R,I,n,a)){n&&n.$changes&&U.add(n.$changes.refId);continue}}else{var V,F=l.parent;if((V=l.getChildrenFilter())&&!V.call(F,I,R.$indexes.get(h),n,a)){n&&n.$changes&&U.add(n.$changes.refId);continue}}if(n.$changes&&(r.push(n.$changes),Y++),o.op!==w.OPERATION.TOUCH)if(o.op===w.OPERATION.ADD||j)g.push.apply(g,null!==(u=l.caches[h])&&void 0!==u?u:[]),t.add(h);else if(t.has(h))g.push.apply(g,null!==(Q=l.caches[h])&&void 0!==Q?Q:[]);else{if(t.add(h),q(g,w.OPERATION.ADD),T(g,h),R instanceof x){var O=l.ref.$indexes.get(h);y(g,O)}n.$changes?T(g,n.$changes.refId):Z[W](g,n)}else n.$changes&&!j&&(q(g,w.OPERATION.ADD),T(g,h),R instanceof x&&(O=l.ref.$indexes.get(h),y(g,O)),T(g,n.$changes.refId))}else j?q(g,o.op|h):(q(g,o.op),T(g,h))}else q(g,o.op)}},l=0;l<Y;l++)J(l);return g},v.prototype.clone=function(){var w,v=new this.constructor,I=this._definition.schema;for(var P in I)"object"===typeof this[P]&&"function"===typeof(null===(w=this[P])||void 0===w?void 0:w.clone)?v[P]=this[P].clone():v[P]=this[P];return v},v.prototype.toJSON=function(){var w=this._definition.schema,v=this._definition.deprecated,I={};for(var P in w)v[P]||null===this[P]||"undefined"===typeof this[P]||(I[P]="function"===typeof this[P].toJSON?this[P].toJSON():this["_".concat(P)]);return I},v.prototype.discardAllChanges=function(){this.$changes.discardAll()},v.prototype.getByIndex=function(w){return this[this._definition.fieldsByIndex[w]]},v.prototype.deleteByIndex=function(w){this[this._definition.fieldsByIndex[w]]=void 0},v.prototype.tryEncodeTypeId=function(w,v,I){v._typeid!==I._typeid&&(q(w,a),T(w,I._typeid))},v.prototype.getSchemaType=function(w,v,I){var P;return w[v.offset]===a&&(v.offset++,P=this.constructor._context.get(jw(w,v))),P||I},v.prototype.createTypeInstance=function(w){var v=new w;return v.$changes.root=this.$changes.root,v},v.prototype._triggerChanges=function(I){for(var P,u,Q,K,a,U,p,r,Y,g=new Set,J=this.$changes.root.refs,l=function(l){var R=I[l],x=R.refId,j=J.get(x),s=j.$callbacks;if((R.op&w.OPERATION.DELETE)===w.OPERATION.DELETE&&R.previousValue instanceof v&&(null===(u=null===(P=R.previousValue.$callbacks)||void 0===P?void 0:P[w.OPERATION.DELETE])||void 0===u||u.forEach((function(w){return w()}))),!s)return"continue";if(j instanceof v){if(!g.has(x))try{null===(Q=null===s||void 0===s?void 0:s[w.OPERATION.REPLACE])||void 0===Q||Q.forEach((function(w){return w()}))}catch(w){v.onError(w)}try{s.hasOwnProperty(R.field)&&(null===(K=s[R.field])||void 0===K||K.forEach((function(w){return w(R.value,R.previousValue)})))}catch(w){v.onError(w)}}else R.op===w.OPERATION.ADD&&void 0===R.previousValue?null===(a=s[w.OPERATION.ADD])||void 0===a||a.forEach((function(w){var v;return w(R.value,null!==(v=R.dynamicIndex)&&void 0!==v?v:R.field)})):R.op===w.OPERATION.DELETE?void 0!==R.previousValue&&(null===(U=s[w.OPERATION.DELETE])||void 0===U||U.forEach((function(w){var v;return w(R.previousValue,null!==(v=R.dynamicIndex)&&void 0!==v?v:R.field)}))):R.op===w.OPERATION.DELETE_AND_ADD&&(void 0!==R.previousValue&&(null===(p=s[w.OPERATION.DELETE])||void 0===p||p.forEach((function(w){var v;return w(R.previousValue,null!==(v=R.dynamicIndex)&&void 0!==v?v:R.field)}))),null===(r=s[w.OPERATION.ADD])||void 0===r||r.forEach((function(w){var v;return w(R.value,null!==(v=R.dynamicIndex)&&void 0!==v?v:R.field)}))),R.value!==R.previousValue&&(null===(Y=s[w.OPERATION.REPLACE])||void 0===Y||Y.forEach((function(w){var v;return w(R.value,null!==(v=R.dynamicIndex)&&void 0!==v?v:R.field)})));g.add(x)},R=0;R<I.length;R++)l(R)},v._definition=t.create(),v}();function qw(w){for(var v=[w.$changes],I=1,P={},u=P,Q=function(w){var I=v[w];I.changes.forEach((function(w){var v=I.ref,P=w.index,Q=v._definition?v._definition.fieldsByIndex[P]:v.$indexes.get(P);u[Q]=I.getValue(P)}))},K=0;K<I;K++)Q(K);return P}var mw={context:new z},cw=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return I(v,w),P([o("string",mw)],v.prototype,"name",void 0),P([o("string",mw)],v.prototype,"type",void 0),P([o("number",mw)],v.prototype,"referencedType",void 0),v}(Nw),Mw=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.fields=new l,v}return I(v,w),P([o("number",mw)],v.prototype,"id",void 0),P([o([cw],mw)],v.prototype,"fields",void 0),v}(Nw),Sw=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.types=new l,v}return I(v,w),v.encode=function(w){var I=w.constructor,P=new v;P.rootType=I._typeid;var u=function(w,v){for(var I in v){var u=new cw;u.name=I;var Q=void 0;if("string"===typeof v[I])Q=v[I];else{var K=v[I],a=void 0;Nw.is(K)?(Q="ref",a=v[I]):"string"===typeof K[Q=Object.keys(K)[0]]?Q+=":"+K[Q]:a=K[Q],u.referencedType=a?a._typeid:-1}u.type=Q,w.fields.push(u)}P.types.push(w)},Q=I._context.types;for(var K in Q){var a=new Mw;a.id=Number(K),u(a,Q[K]._definition.schema)}return P.encodeAll()},v.decode=function(w,P){var u=new z,Q=new v;Q.decode(w,P);var K=Q.types.reduce((function(w,v){var P=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return I(v,w),v}(Nw),Q=v.id;return w[Q]=P,u.add(P,Q),w}),{});Q.types.forEach((function(w){var v=K[w.id];w.fields.forEach((function(w){var I;if(void 0!==w.referencedType){var P=w.type,Q=K[w.referencedType];if(!Q){var a=w.type.split(":");P=a[0],Q=a[1]}"ref"===P?o(Q,{context:u})(v.prototype,w.name):o(((I={})[P]=Q,I),{context:u})(v.prototype,w.name)}else o(w.type,{context:u})(v.prototype,w.name)}))}));var a=K[Q.rootType],U=new a;for(var p in a._definition.schema){var r=a._definition.schema[p];"string"!==typeof r&&(U[p]="function"===typeof r?new r:new(B(Object.keys(r)[0]).constructor))}return U},P([o([Mw],mw)],v.prototype,"types",void 0),P([o("number",mw)],v.prototype,"rootType",void 0),v}(Nw);s("map",{constructor:x}),s("array",{constructor:l}),s("set",{constructor:Ew}),s("collection",{constructor:zw}),w.ArraySchema=l,w.CollectionSchema=zw,w.Context=z,w.MapSchema=x,w.Reflection=Sw,w.ReflectionField=cw,w.ReflectionType=Mw,w.Schema=Nw,w.SchemaDefinition=t,w.SetSchema=Ew,w.decode=iw,w.defineTypes=V,w.deprecated=W,w.dumpChanges=qw,w.encode=Z,w.filter=h,w.filterChildren=n,w.hasFilter=i,w.registerType=s,w.type=o,Object.defineProperty(w,"__esModule",{value:!0})}(v)},89050:function(w){w.exports=function(w){return null!=w&&null!=w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}},5837:function(w,v,I){"use strict";var P=I(34789),u=I(28638),Q=I(89050);I.g.__TYPEDARRAY_POOL||(I.g.__TYPEDARRAY_POOL={UINT8:u([32,0]),UINT16:u([32,0]),UINT32:u([32,0]),INT8:u([32,0]),INT16:u([32,0]),INT32:u([32,0]),FLOAT:u([32,0]),DOUBLE:u([32,0]),DATA:u([32,0]),UINT8C:u([32,0]),BUFFER:u([32,0])});var K="undefined"!==typeof Uint8ClampedArray,a=I.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=u([32,0])),a.BUFFER||(a.BUFFER=u([32,0]));var U=a.DATA,p=a.BUFFER;function r(w){if(w){var v=w.length||w.byteLength,I=P.log2(v);U[I].push(w)}}function Y(w){w=P.nextPow2(w);var v=P.log2(w),I=U[v];return I.length>0?I.pop():new ArrayBuffer(w)}function g(w){return new Uint8Array(Y(w),0,w)}function J(w){return new Uint16Array(Y(2*w),0,w)}function l(w){return new Uint32Array(Y(4*w),0,w)}function R(w){return new Int8Array(Y(w),0,w)}function x(w){return new Int16Array(Y(2*w),0,w)}function j(w){return new Int32Array(Y(4*w),0,w)}function s(w){return new Float32Array(Y(4*w),0,w)}function B(w){return new Float64Array(Y(8*w),0,w)}function t(w){return K?new Uint8ClampedArray(Y(w),0,w):g(w)}function i(w){return new DataView(Y(w),0,w)}v.free=function(w){if(Q(w))p[P.log2(w.length)].push(w);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(w)&&(w=w.buffer),!w)return;var v=w.length||w.byteLength,I=0|P.log2(v);U[I].push(w)}},v.freeUint8=v.freeUint16=v.freeUint32=v.freeInt8=v.freeInt16=v.freeInt32=v.freeFloat32=v.freeFloat=v.freeFloat64=v.freeDouble=v.freeUint8Clamped=v.freeDataView=function(w){r(w.buffer)},v.freeArrayBuffer=r,v.freeBuffer=function(w){p[P.log2(w.length)].push(w)},v.malloc=function(w,v){if(void 0===v||"arraybuffer"===v)return Y(w);switch(v){case"uint8":return g(w);case"uint16":return J(w);case"uint32":return l(w);case"int8":return R(w);case"int16":return x(w);case"int32":return j(w);case"float":case"float32":return s(w);case"double":case"float64":return B(w);case"uint8_clamped":return t(w);case"buffer":throw"Buffer not supported";case"data":case"dataview":return i(w);default:return null}return null},v.mallocArrayBuffer=Y,v.mallocUint8=g,v.mallocUint16=J,v.mallocUint32=l,v.mallocInt8=R,v.mallocInt16=x,v.mallocInt32=j,v.mallocFloat32=v.mallocFloat=s,v.mallocFloat64=v.mallocDouble=B,v.mallocUint8Clamped=t,v.mallocDataView=i,v.clearCache=function(){for(var w=0;w<32;++w)a.UINT8[w].length=0,a.UINT16[w].length=0,a.UINT32[w].length=0,a.INT8[w].length=0,a.INT16[w].length=0,a.INT32[w].length=0,a.FLOAT[w].length=0,a.DOUBLE[w].length=0,a.UINT8C[w].length=0,U[w].length=0,p[w].length=0}},25191:function(w,v,I){w.exports=u;var P=I(47077);function u(w,v){if(!(this instanceof u))return new u(w,v);var I=P.create();P.add(I,w,v),this.base=P.min(P.create(),w,I),this.vec=P.clone(v),this.max=P.max(P.create(),w,I),this.mag=P.length(this.vec)}var Q=u.prototype;Q.width=function(){return this.vec[0]},Q.height=function(){return this.vec[1]},Q.depth=function(){return this.vec[2]},Q.x0=function(){return this.base[0]},Q.y0=function(){return this.base[1]},Q.z0=function(){return this.base[2]},Q.x1=function(){return this.max[0]},Q.y1=function(){return this.max[1]},Q.z1=function(){return this.max[2]},Q.translate=function(w){return P.add(this.max,this.max,w),P.add(this.base,this.base,w),this},Q.setPosition=function(w){return P.add(this.max,w,this.vec),P.copy(this.base,w),this},Q.expand=function(w){var v=P.create(),I=P.create();return P.max(v,w.max,this.max),P.min(I,w.base,this.base),P.subtract(v,v,I),new u(I,v)},Q.intersects=function(w){return!(w.base[0]>this.max[0])&&(!(w.base[1]>this.max[1])&&(!(w.base[2]>this.max[2])&&(!(w.max[0]<this.base[0])&&(!(w.max[1]<this.base[1])&&!(w.max[2]<this.base[2])))))},Q.touches=function(w){var v=this.union(w);return null!==v&&(0==v.width()||0==v.height()||0==v.depth())},Q.union=function(w){if(!this.intersects(w))return null;var v=Math.max(w.base[0],this.base[0]),I=Math.max(w.base[1],this.base[1]),P=Math.max(w.base[2],this.base[2]);return new u([v,I,P],[Math.min(w.max[0],this.max[0])-v,Math.min(w.max[1],this.max[1])-I,Math.min(w.max[2],this.max[2])-P])}},34789:function(w,v){"use strict";function I(w){var v=32;return(w&=-w)&&v--,65535&w&&(v-=16),16711935&w&&(v-=8),252645135&w&&(v-=4),858993459&w&&(v-=2),1431655765&w&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(w){return(w>0)-(w<0)},v.abs=function(w){var v=w>>31;return(w^v)-v},v.min=function(w,v){return v^(w^v)&-(w<v)},v.max=function(w,v){return w^(w^v)&-(w<v)},v.isPow2=function(w){return!(w&w-1)&&!!w},v.log2=function(w){var v,I;return v=(w>65535)<<4,v|=I=((w>>>=v)>255)<<3,v|=I=((w>>>=I)>15)<<2,(v|=I=((w>>>=I)>3)<<1)|(w>>>=I)>>1},v.log10=function(w){return w>=1e9?9:w>=1e8?8:w>=1e7?7:w>=1e6?6:w>=1e5?5:w>=1e4?4:w>=1e3?3:w>=100?2:w>=10?1:0},v.popCount=function(w){return 16843009*((w=(858993459&(w-=w>>>1&1431655765))+(w>>>2&858993459))+(w>>>4)&252645135)>>>24},v.countTrailingZeros=I,v.nextPow2=function(w){return w+=0===w,--w,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)+1},v.prevPow2=function(w){return w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)-(w>>>1)},v.parity=function(w){return w^=w>>>16,w^=w>>>8,w^=w>>>4,27030>>>(w&=15)&1};var P=new Array(256);!function(w){for(var v=0;v<256;++v){var I=v,P=v,u=7;for(I>>>=1;I;I>>>=1)P<<=1,P|=1&I,--u;w[v]=P<<u&255}}(P),v.reverse=function(w){return P[255&w]<<24|P[w>>>8&255]<<16|P[w>>>16&255]<<8|P[w>>>24&255]},v.interleave2=function(w,v){return(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(w,v){return(w=65535&((w=16711935&((w=252645135&((w=858993459&((w=w>>>v&1431655765)|w>>>1))|w>>>2))|w>>>4))|w>>>16))<<16>>16},v.interleave3=function(w,v,I){return w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2),(w|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<2},v.deinterleave3=function(w,v){return(w=1023&((w=4278190335&((w=251719695&((w=3272356035&((w=w>>>v&1227133513)|w>>>2))|w>>>4))|w>>>8))|w>>>16))<<22>>22},v.nextCombination=function(w){var v=w|w-1;return v+1|(~v&-~v)-1>>>I(w)+1}},96137:function(w,v,I){"use strict";w.exports=function(w,v,I){switch(arguments.length){case 1:return Y(w);case 2:return"function"===typeof v?p(w,w,v,!0):g(w,v);case 3:return p(w,v,I,!1);default:throw new Error("box-intersect: Invalid arguments")}};var P,u=I(5837),Q=I(73818),K=I(72067);function a(w,v){for(var I=0;I<w;++I)if(!(v[I]<=v[I+w]))return!0;return!1}function U(w,v,I,P){for(var u=0,Q=0,K=0,U=w.length;K<U;++K){var p=w[K];if(!a(v,p)){for(var r=0;r<2*v;++r)I[u++]=p[r];P[Q++]=K}}return Q}function p(w,v,I,P){var a=w.length,p=v.length;if(!(a<=0||p<=0)){var r=w[0].length>>>1;if(!(r<=0)){var Y,g=u.mallocDouble(2*r*a),J=u.mallocInt32(a);if((a=U(w,r,g,J))>0){if(1===r&&P)Q.init(a),Y=Q.sweepComplete(r,I,0,a,g,J,0,a,g,J);else{var l=u.mallocDouble(2*r*p),R=u.mallocInt32(p);(p=U(v,r,l,R))>0&&(Q.init(a+p),Y=1===r?Q.sweepBipartite(r,I,0,a,g,J,0,p,l,R):K(r,I,P,a,g,J,p,l,R),u.free(l),u.free(R))}u.free(g),u.free(J)}return Y}}}function r(w,v){P.push([w,v])}function Y(w){return P=[],p(w,w,r,!0),P}function g(w,v){return P=[],p(w,v,r,!1),P}},80442:function(w,v){"use strict";var I="d",P="ax",u="fp",Q="es",K="rs",a="re",U="rb",p="bs",r="be",Y="bb",g=[I,P,"vv",K,a,U,"ri",p,r,Y,"bi"];function J(w){var v="bruteForce"+(w?"Full":"Partial"),P=[],K=g.slice();w||K.splice(3,0,u);var a=["function "+v+"("+K.join()+"){"];function U(v,u){var K=function(w,v,P){var u="bruteForce"+(w?"Red":"Blue")+(v?"Flip":"")+(P?"Full":""),K=["function ",u,"(",g.join(),"){","var ",Q,"=2*",I,";"],a="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",U="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(P?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return w?K.push(a,"Q",":",U):K.push(U,"Q",":",a),P?K.push("if(y1<x0||x1<y0)continue;"):v?K.push("if(y0<=x0||x1<y0)continue;"):K.push("if(y0<x0||x1<y0)continue;"),K.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),v?K.push("yi,xi"):K.push("xi,yi"),K.push(");if(rv!==void 0)return rv;}}}"),{name:u,code:K.join("")}}(v,u,w);P.push(K.code),a.push("return "+K.name+"("+g.join()+");")}a.push("if(re-rs>be-bs){"),w?(U(!0,!1),a.push("}else{"),U(!1,!1)):(a.push("if(fp){"),U(!0,!0),a.push("}else{"),U(!0,!1),a.push("}}else{if(fp){"),U(!1,!0),a.push("}else{"),U(!1,!1),a.push("}")),a.push("}}return "+v);var p=P.join("")+a.join("");return new Function(p)()}v.partial=J(!1),v.full=J(!0)},72067:function(w,v,I){"use strict";w.exports=function(w,v,I,Q,r,z,E,o,h){!function(w,v){var I=8*u.log2(v+1)*(w+1)|0,Q=u.nextPow2(6*I);j.length<Q&&(P.free(j),j=P.mallocInt32(Q));var K=u.nextPow2(2*I);s.length<K&&(P.free(s),s=P.mallocDouble(K))}(w,Q+E);var n,W=0,V=2*w;B(W++,0,0,Q,0,E,I?16:0,-1/0,1/0),I||B(W++,0,0,E,0,Q,1,-1/0,1/0);for(;W>0;){var F=6*(W-=1),O=j[F],N=j[F+1],q=j[F+2],m=j[F+3],c=j[F+4],M=j[F+5],S=2*W,e=s[S],H=s[S+1],G=1&M,L=!!(16&M),d=r,D=z,f=o,b=h;if(G&&(d=o,D=h,f=r,b=z),!(2&M&&(q=J(w,O,N,q,d,D,H),N>=q))&&!(4&M&&(N=l(w,O,N,q,d,D,e))>=q)){var k=q-N,C=c-m;if(L){if(w*k*(k+C)<4194304){if(void 0!==(n=U.scanComplete(w,O,v,N,q,d,D,m,c,f,b)))return n;continue}}else{if(w*Math.min(k,C)<128){if(void 0!==(n=K(w,O,v,G,N,q,d,D,m,c,f,b)))return n;continue}if(w*k*C<4194304){if(void 0!==(n=U.scanBipartite(w,O,v,G,N,q,d,D,m,c,f,b)))return n;continue}}var y=Y(w,O,N,q,d,D,e,H);if(N<y)if(w*(y-N)<128){if(void 0!==(n=a(w,O+1,v,N,y,d,D,m,c,f,b)))return n}else if(O===w-2){if(void 0!==(n=G?U.sweepBipartite(w,v,m,c,f,b,N,y,d,D):U.sweepBipartite(w,v,N,y,d,D,m,c,f,b)))return n}else B(W++,O+1,N,y,m,c,G,-1/0,1/0),B(W++,O+1,m,c,N,y,1^G,-1/0,1/0);if(y<q){var T=p(w,O,m,c,f,b),Z=f[V*T+O],A=g(w,O,T,c,f,b,Z);if(A<c&&B(W++,O,y,q,A,c,(4|G)+(L?16:0),Z,H),m<T&&B(W++,O,y,q,m,T,(2|G)+(L?16:0),e,Z),T+1===A){if(void 0!==(n=L?i(w,O,v,y,q,d,D,T,f,b[T]):t(w,O,v,G,y,q,d,D,T,f,b[T])))return n}else if(T<A){var X;if(L){if(X=R(w,O,y,q,d,D,Z),y<X){var ww=g(w,O,y,X,d,D,Z);if(O===w-2){if(y<ww&&void 0!==(n=U.sweepComplete(w,v,y,ww,d,D,T,A,f,b)))return n;if(ww<X&&void 0!==(n=U.sweepBipartite(w,v,ww,X,d,D,T,A,f,b)))return n}else y<ww&&B(W++,O+1,y,ww,T,A,16,-1/0,1/0),ww<X&&(B(W++,O+1,ww,X,T,A,0,-1/0,1/0),B(W++,O+1,T,A,ww,X,1,-1/0,1/0))}}else X=G?x(w,O,y,q,d,D,Z):R(w,O,y,q,d,D,Z),y<X&&(O===w-2?n=G?U.sweepBipartite(w,v,T,A,f,b,y,X,d,D):U.sweepBipartite(w,v,y,X,d,D,T,A,f,b):(B(W++,O+1,y,X,T,A,G,-1/0,1/0),B(W++,O+1,T,A,y,X,1^G,-1/0,1/0)))}}}}};var P=I(5837),u=I(34789),Q=I(80442),K=Q.partial,a=Q.full,U=I(73818),p=I(55005),r=I(50050),Y=r("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),g=r("lo===p0",["p0"]),J=r("lo<p0",["p0"]),l=r("hi<=p0",["p0"]),R=r("lo<=p0&&p0<=hi",["p0"]),x=r("lo<p0&&p0<=hi",["p0"]),j=P.mallocInt32(1024),s=P.mallocDouble(1024);function B(w,v,I,P,u,Q,K,a,U){var p=6*w;j[p]=v,j[p+1]=I,j[p+2]=P,j[p+3]=u,j[p+4]=Q,j[p+5]=K;var r=2*w;s[r]=a,s[r+1]=U}function t(w,v,I,P,u,Q,K,a,U,p,r){var Y=2*w,g=U*Y,J=p[g+v];w:for(var l=u,R=u*Y;l<Q;++l,R+=Y){var x=K[R+v],j=K[R+v+w];if(!(J<x||j<J)&&(!P||J!==x)){for(var s,B=a[l],t=v+1;t<w;++t){x=K[R+t],j=K[R+t+w];var i=p[g+t],z=p[g+t+w];if(j<i||z<x)continue w}if(void 0!==(s=P?I(r,B):I(B,r)))return s}}}function i(w,v,I,P,u,Q,K,a,U,p){var r=2*w,Y=a*r,g=U[Y+v];w:for(var J=P,l=P*r;J<u;++J,l+=r){var R=K[J];if(R!==p){var x=Q[l+v],j=Q[l+v+w];if(!(g<x||j<g)){for(var s=v+1;s<w;++s){x=Q[l+s],j=Q[l+s+w];var B=U[Y+s],t=U[Y+s+w];if(j<B||t<x)continue w}var i=I(R,p);if(void 0!==i)return i}}}}},55005:function(w,v,I){"use strict";w.exports=function(w,v,I,Q,K,a){if(Q<=I+1)return I;var U=I,p=Q,r=Q+I>>>1,Y=2*w,g=r,J=K[Y*r+v];for(;U<p;){if(p-U<8){u(w,v,U,p,K,a),J=K[Y*r+v];break}var l=p-U,R=Math.random()*l+U|0,x=K[Y*R+v],j=Math.random()*l+U|0,s=K[Y*j+v],B=Math.random()*l+U|0,t=K[Y*B+v];x<=s?t>=s?(g=j,J=s):x>=t?(g=R,J=x):(g=B,J=t):s>=t?(g=j,J=s):t>=x?(g=R,J=x):(g=B,J=t);for(var i=Y*(p-1),z=Y*g,E=0;E<Y;++E,++i,++z){var o=K[i];K[i]=K[z],K[z]=o}var h=a[p-1];a[p-1]=a[g],a[g]=h,g=P(w,v,U,p-1,K,a,J);for(i=Y*(p-1),z=Y*g,E=0;E<Y;++E,++i,++z){o=K[i];K[i]=K[z],K[z]=o}h=a[p-1];if(a[p-1]=a[g],a[g]=h,r<g){for(p=g-1;U<p&&K[Y*(p-1)+v]===J;)p-=1;p+=1}else{if(!(g<r))break;for(U=g+1;U<p&&K[Y*U+v]===J;)U+=1}}return P(w,v,I,r,K,a,K[Y*r+v])};var P=I(50050)("lo<p0",["p0"]);function u(w,v,I,P,u,Q){for(var K=2*w,a=K*(I+1)+v,U=I+1;U<P;++U,a+=K)for(var p=u[a],r=U,Y=K*(U-1);r>I&&u[Y+v]>p;--r,Y-=K){for(var g=Y,J=Y+K,l=0;l<K;++l,++g,++J){var R=u[g];u[g]=u[J],u[J]=R}var x=Q[r];Q[r]=Q[r-1],Q[r-1]=x}}},50050:function(w){"use strict";w.exports=function(w,v){var I="abcdef".split("").concat(v),P=[];w.indexOf("lo")>=0&&P.push("lo=e[k+n]");w.indexOf("hi")>=0&&P.push("hi=e[k+o]");return I.push("for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m".replace("_",P.join()).replace("$",w)),Function.apply(void 0,I)}},40526:function(w){"use strict";w.exports=function(w,I){I<=128?v(0,I-1,w):U(0,I-1,w)};function v(w,v,I){for(var P=2*(w+1),u=w+1;u<=v;++u){for(var Q=I[P++],K=I[P++],a=u,U=P-2;a-->w;){var p=I[U-2],r=I[U-1];if(p<Q)break;if(p===Q&&r<K)break;I[U]=p,I[U+1]=r,U-=2}I[U]=Q,I[U+1]=K}}function I(w,v,I){v*=2;var P=I[w*=2],u=I[w+1];I[w]=I[v],I[w+1]=I[v+1],I[v]=P,I[v+1]=u}function P(w,v,I){v*=2,I[w*=2]=I[v],I[w+1]=I[v+1]}function u(w,v,I,P){v*=2,I*=2;var u=P[w*=2],Q=P[w+1];P[w]=P[v],P[w+1]=P[v+1],P[v]=P[I],P[v+1]=P[I+1],P[I]=u,P[I+1]=Q}function Q(w,v,I,P,u){v*=2,u[w*=2]=u[v],u[v]=I,u[w+1]=u[v+1],u[v+1]=P}function K(w,v,I){v*=2;var P=I[w*=2],u=I[v];return!(P<u)&&(P!==u||I[w+1]>I[v+1])}function a(w,v,I,P){var u=P[w*=2];return u<v||u===v&&P[w+1]<I}function U(w,p,r){var Y=(p-w+1)/6|0,g=w+Y,J=p-Y,l=w+p>>1,R=l-Y,x=l+Y,j=g,s=R,B=l,t=x,i=J,z=w+1,E=p-1,o=0;K(j,s,r)&&(o=j,j=s,s=o),K(t,i,r)&&(o=t,t=i,i=o),K(j,B,r)&&(o=j,j=B,B=o),K(s,B,r)&&(o=s,s=B,B=o),K(j,t,r)&&(o=j,j=t,t=o),K(B,t,r)&&(o=B,B=t,t=o),K(s,i,r)&&(o=s,s=i,i=o),K(s,B,r)&&(o=s,s=B,B=o),K(t,i,r)&&(o=t,t=i,i=o);for(var h=r[2*s],n=r[2*s+1],W=r[2*t],V=r[2*t+1],F=2*j,O=2*B,N=2*i,q=2*g,m=2*l,c=2*J,M=0;M<2;++M){var S=r[F+M],e=r[O+M],H=r[N+M];r[q+M]=S,r[m+M]=e,r[c+M]=H}P(R,w,r),P(x,p,r);for(var G=z;G<=E;++G)if(a(G,h,n,r))G!==z&&I(G,z,r),++z;else if(!a(G,W,V,r))for(;;){if(a(E,W,V,r)){a(E,h,n,r)?(u(G,z,E,r),++z,--E):(I(G,E,r),--E);break}if(--E<G)break}Q(w,z-1,h,n,r),Q(p,E+1,W,V,r),z-2-w<=32?v(w,z-2,r):U(w,z-2,r),p-(E+2)<=32?v(E+2,p,r):U(E+2,p,r),E-z<=32?v(z,E,r):U(z,E,r)}},73818:function(w,v,I){"use strict";w.exports={init:function(w){var v=u.nextPow2(w);U.length<v&&(P.free(U),U=P.mallocInt32(v));p.length<v&&(P.free(p),p=P.mallocInt32(v));r.length<v&&(P.free(r),r=P.mallocInt32(v));Y.length<v&&(P.free(Y),Y=P.mallocInt32(v));g.length<v&&(P.free(g),g=P.mallocInt32(v));J.length<v&&(P.free(J),J=P.mallocInt32(v));var I=8*v;l.length<I&&(P.free(l),l=P.mallocDouble(I))},sweepBipartite:function(w,v,I,P,u,a,g,J,j,s){for(var B=0,t=2*w,i=w-1,z=t-1,E=I;E<P;++E){var o=a[E],h=t*E;l[B++]=u[h+i],l[B++]=-(o+1),l[B++]=u[h+z],l[B++]=o}for(E=g;E<J;++E){o=s[E]+K;var n=t*E;l[B++]=j[n+i],l[B++]=-o,l[B++]=j[n+z],l[B++]=o}var W=B>>>1;Q(l,W);var V=0,F=0;for(E=0;E<W;++E){var O=0|l[2*E+1];if(O>=K)R(r,Y,F--,O=O-K|0);else if(O>=0)R(U,p,V--,O);else if(O<=-268435456){O=-O-K|0;for(var N=0;N<V;++N){if(void 0!==(q=v(U[N],O)))return q}x(r,Y,F++,O)}else{O=-O-1|0;for(N=0;N<F;++N){var q;if(void 0!==(q=v(O,r[N])))return q}x(U,p,V++,O)}}},sweepComplete:function(w,v,I,P,u,K,a,j,s,B){for(var t=0,i=2*w,z=w-1,E=i-1,o=I;o<P;++o){var h=K[o]+1<<1,n=i*o;l[t++]=u[n+z],l[t++]=-h,l[t++]=u[n+E],l[t++]=h}for(o=a;o<j;++o){h=B[o]+1<<1;var W=i*o;l[t++]=s[W+z],l[t++]=1|-h,l[t++]=s[W+E],l[t++]=1|h}var V=t>>>1;Q(l,V);var F=0,O=0,N=0;for(o=0;o<V;++o){var q=0|l[2*o+1],m=1&q;if(o<V-1&&q>>1===l[2*o+3]>>1&&(m=2,o+=1),q<0){for(var c=-(q>>1)-1,M=0;M<N;++M){if(void 0!==(S=v(g[M],c)))return S}if(0!==m)for(M=0;M<F;++M){if(void 0!==(S=v(U[M],c)))return S}if(1!==m)for(M=0;M<O;++M){var S;if(void 0!==(S=v(r[M],c)))return S}0===m?x(U,p,F++,c):1===m?x(r,Y,O++,c):2===m&&x(g,J,N++,c)}else{c=(q>>1)-1;0===m?R(U,p,F--,c):1===m?R(r,Y,O--,c):2===m&&R(g,J,N--,c)}}},scanBipartite:function(w,v,I,P,u,a,r,Y,g,J,j,s){var B=0,t=2*w,i=v,z=v+w,E=1,o=1;P?o=K:E=K;for(var h=u;h<a;++h){var n=h+E,W=t*h;l[B++]=r[W+i],l[B++]=-n,l[B++]=r[W+z],l[B++]=n}for(h=g;h<J;++h){n=h+o;var V=t*h;l[B++]=j[V+i],l[B++]=-n}var F=B>>>1;Q(l,F);var O=0;for(h=0;h<F;++h){var N=0|l[2*h+1];if(N<0){var q=!1;if((n=-N)>=K?(q=!P,n-=K):(q=!!P,n-=1),q)x(U,p,O++,n);else{var m=s[n],c=t*n,M=j[c+v+1],S=j[c+v+1+w];w:for(var e=0;e<O;++e){var H=U[e],G=t*H;if(!(S<r[G+v+1]||r[G+v+1+w]<M)){for(var L=v+2;L<w;++L)if(j[c+L+w]<r[G+L]||r[G+L+w]<j[c+L])continue w;var d,D=Y[H];if(void 0!==(d=P?I(m,D):I(D,m)))return d}}}}else R(U,p,O--,N-E)}},scanComplete:function(w,v,I,P,u,a,p,r,Y,g,J){for(var R=0,x=2*w,j=v,s=v+w,B=P;B<u;++B){var t=B+K,i=x*B;l[R++]=a[i+j],l[R++]=-t,l[R++]=a[i+s],l[R++]=t}for(B=r;B<Y;++B){t=B+1;var z=x*B;l[R++]=g[z+j],l[R++]=-t}var E=R>>>1;Q(l,E);var o=0;for(B=0;B<E;++B){var h=0|l[2*B+1];if(h<0){if((t=-h)>=K)U[o++]=t-K;else{var n=J[t-=1],W=x*t,V=g[W+v+1],F=g[W+v+1+w];w:for(var O=0;O<o;++O){var N=U[O],q=p[N];if(q===n)break;var m=x*N;if(!(F<a[m+v+1]||a[m+v+1+w]<V)){for(var c=v+2;c<w;++c)if(g[W+c+w]<a[m+c]||a[m+c+w]<g[W+c])continue w;var M=I(q,n);if(void 0!==M)return M}}}}else{for(t=h-K,O=o-1;O>=0;--O)if(U[O]===t){for(c=O+1;c<o;++c)U[c-1]=U[c];break}--o}}}};var P=I(5837),u=I(34789),Q=I(40526),K=1<<28,a=1024,U=P.mallocInt32(a),p=P.mallocInt32(a),r=P.mallocInt32(a),Y=P.mallocInt32(a),g=P.mallocInt32(a),J=P.mallocInt32(a),l=P.mallocDouble(8192);function R(w,v,I,P){var u=v[P],Q=w[I-1];w[u]=Q,v[Q]=u}function x(w,v,I,P){w[I]=P,v[P]=I}},81238:function(w){"use strict";w.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12628:function(w,v,I){var P=I(81238),u=I(52796),Q=Object.hasOwnProperty,K=Object.create(null);for(var a in P)Q.call(P,a)&&(K[P[a]]=a);var U=w.exports={to:{},get:{}};function p(w,v,I){return Math.min(Math.max(v,w),I)}function r(w){var v=Math.round(w).toString(16).toUpperCase();return v.length<2?"0"+v:v}U.get=function(w){var v,I;switch(w.substring(0,3).toLowerCase()){case"hsl":v=U.get.hsl(w),I="hsl";break;case"hwb":v=U.get.hwb(w),I="hwb";break;default:v=U.get.rgb(w),I="rgb"}return v?{model:I,value:v}:null},U.get.rgb=function(w){if(!w)return null;var v,I,u,K=[0,0,0,1];if(v=w.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(u=v[2],v=v[1],I=0;I<3;I++){var a=2*I;K[I]=parseInt(v.slice(a,a+2),16)}u&&(K[3]=parseInt(u,16)/255)}else if(v=w.match(/^#([a-f0-9]{3,4})$/i)){for(u=(v=v[1])[3],I=0;I<3;I++)K[I]=parseInt(v[I]+v[I],16);u&&(K[3]=parseInt(u+u,16)/255)}else if(v=w.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(I=0;I<3;I++)K[I]=parseInt(v[I+1],0);v[4]&&(v[5]?K[3]=.01*parseFloat(v[4]):K[3]=parseFloat(v[4]))}else{if(!(v=w.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(v=w.match(/^(\w+)$/))?"transparent"===v[1]?[0,0,0,0]:Q.call(P,v[1])?((K=P[v[1]])[3]=1,K):null:null;for(I=0;I<3;I++)K[I]=Math.round(2.55*parseFloat(v[I+1]));v[4]&&(v[5]?K[3]=.01*parseFloat(v[4]):K[3]=parseFloat(v[4]))}for(I=0;I<3;I++)K[I]=p(K[I],0,255);return K[3]=p(K[3],0,1),K},U.get.hsl=function(w){if(!w)return null;var v=w.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var I=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,p(parseFloat(v[2]),0,100),p(parseFloat(v[3]),0,100),p(isNaN(I)?1:I,0,1)]}return null},U.get.hwb=function(w){if(!w)return null;var v=w.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var I=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,p(parseFloat(v[2]),0,100),p(parseFloat(v[3]),0,100),p(isNaN(I)?1:I,0,1)]}return null},U.to.hex=function(){var w=u(arguments);return"#"+r(w[0])+r(w[1])+r(w[2])+(w[3]<1?r(Math.round(255*w[3])):"")},U.to.rgb=function(){var w=u(arguments);return w.length<4||1===w[3]?"rgb("+Math.round(w[0])+", "+Math.round(w[1])+", "+Math.round(w[2])+")":"rgba("+Math.round(w[0])+", "+Math.round(w[1])+", "+Math.round(w[2])+", "+w[3]+")"},U.to.rgb.percent=function(){var w=u(arguments),v=Math.round(w[0]/255*100),I=Math.round(w[1]/255*100),P=Math.round(w[2]/255*100);return w.length<4||1===w[3]?"rgb("+v+"%, "+I+"%, "+P+"%)":"rgba("+v+"%, "+I+"%, "+P+"%, "+w[3]+")"},U.to.hsl=function(){var w=u(arguments);return w.length<4||1===w[3]?"hsl("+w[0]+", "+w[1]+"%, "+w[2]+"%)":"hsla("+w[0]+", "+w[1]+"%, "+w[2]+"%, "+w[3]+")"},U.to.hwb=function(){var w=u(arguments),v="";return w.length>=4&&1!==w[3]&&(v=", "+w[3]),"hwb("+w[0]+", "+w[1]+"%, "+w[2]+"%"+v+")"},U.to.keyword=function(w){return K[w.slice(0,3)]}},32901:function(w,v,I){for(var P=I(27424).default,u=I(74704).default,Q=I(861).default,K=I(12628),a=I(43143),U=["keyword","gray","hex"],p={},r=0,Y=Object.keys(a);r<Y.length;r++){var g=Y[r];p[Q(a[g].labels).sort().join("")]=g}var J={};function l(w,v){if(!(this instanceof l))return new l(w,v);if(v&&v in U&&(v=null),v&&!(v in a))throw new Error("Unknown model: "+v);var I,P;if(null==w)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(w instanceof l)this.model=w.model,this.color=Q(w.color),this.valpha=w.valpha;else if("string"===typeof w){var u=K.get(w);if(null===u)throw new Error("Unable to parse color from string: "+w);this.model=u.model,P=a[this.model].channels,this.color=u.value.slice(0,P),this.valpha="number"===typeof u.value[P]?u.value[P]:1}else if(w.length>0){this.model=v||"rgb",P=a[this.model].channels;var r=Array.prototype.slice.call(w,0,P);this.color=i(r,P),this.valpha="number"===typeof w[P]?w[P]:1}else if("number"===typeof w)this.model="rgb",this.color=[w>>16&255,w>>8&255,255&w],this.valpha=1;else{this.valpha=1;var Y=Object.keys(w);"alpha"in w&&(Y.splice(Y.indexOf("alpha"),1),this.valpha="number"===typeof w.alpha?w.alpha:0);var g=Y.sort().join("");if(!(g in p))throw new Error("Unable to parse color from object: "+JSON.stringify(w));this.model=p[g];var R=a[this.model].labels,x=[];for(I=0;I<R.length;I++)x.push(w[R[I]]);this.color=i(x)}if(J[this.model])for(P=a[this.model].channels,I=0;I<P;I++){var j=J[this.model][I];j&&(this.color[I]=j(this.color[I]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}l.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(w){var v=this.model in K.to?this:this.rgb(),I=1===(v=v.round("number"===typeof w?w:1)).valpha?v.color:[].concat(Q(v.color),[this.valpha]);return K.to[v.model](I)},percentString:function(w){var v=this.rgb().round("number"===typeof w?w:1),I=1===v.valpha?v.color:[].concat(Q(v.color),[this.valpha]);return K.to.rgb.percent(I)},array:function(){return 1===this.valpha?Q(this.color):[].concat(Q(this.color),[this.valpha])},object:function(){for(var w={},v=a[this.model].channels,I=a[this.model].labels,P=0;P<v;P++)w[I[P]]=this.color[P];return 1!==this.valpha&&(w.alpha=this.valpha),w},unitArray:function(){var w=this.rgb().color;return w[0]/=255,w[1]/=255,w[2]/=255,1!==this.valpha&&w.push(this.valpha),w},unitObject:function(){var w=this.rgb().object();return w.r/=255,w.g/=255,w.b/=255,1!==this.valpha&&(w.alpha=this.valpha),w},round:function(w){return w=Math.max(w||0,0),new l([].concat(Q(this.color.map(function(w){return function(v){return function(w,v){return Number(w.toFixed(v))}(v,w)}}(w))),[this.valpha]),this.model)},alpha:function(w){return void 0!==w?new l([].concat(Q(this.color),[Math.max(0,Math.min(1,w))]),this.model):this.valpha},red:s("rgb",0,B(255)),green:s("rgb",1,B(255)),blue:s("rgb",2,B(255)),hue:s(["hsl","hsv","hsl","hwb","hcg"],0,(function(w){return(w%360+360)%360})),saturationl:s("hsl",1,B(100)),lightness:s("hsl",2,B(100)),saturationv:s("hsv",1,B(100)),value:s("hsv",2,B(100)),chroma:s("hcg",1,B(100)),gray:s("hcg",2,B(100)),white:s("hwb",1,B(100)),wblack:s("hwb",2,B(100)),cyan:s("cmyk",0,B(100)),magenta:s("cmyk",1,B(100)),yellow:s("cmyk",2,B(100)),black:s("cmyk",3,B(100)),x:s("xyz",0,B(95.047)),y:s("xyz",1,B(100)),z:s("xyz",2,B(108.833)),l:s("lab",0,B(100)),a:s("lab",1),b:s("lab",2),keyword:function(w){return void 0!==w?new l(w):a[this.model].keyword(this.color)},hex:function(w){return void 0!==w?new l(w):K.to.hex(this.rgb().round().color)},hexa:function(w){if(void 0!==w)return new l(w);var v=this.rgb().round().color,I=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===I.length&&(I="0"+I),K.to.hex(v)+I},rgbNumber:function(){var w=this.rgb().color;return(255&w[0])<<16|(255&w[1])<<8|255&w[2]},luminosity:function(){var w,v=this.rgb().color,I=[],Q=u(v.entries());try{for(Q.s();!(w=Q.n()).done;){var K=P(w.value,2),a=K[0],U=K[1]/255;I[a]=U<=.04045?U/12.92:Math.pow((U+.055)/1.055,2.4)}}catch(w){Q.e(w)}finally{Q.f()}return.2126*I[0]+.7152*I[1]+.0722*I[2]},contrast:function(w){var v=this.luminosity(),I=w.luminosity();return v>I?(v+.05)/(I+.05):(I+.05)/(v+.05)},level:function(w){var v=this.contrast(w);return v>=7?"AAA":v>=4.5?"AA":""},isDark:function(){var w=this.rgb().color;return(2126*w[0]+7152*w[1]+722*w[2])/1e4<128},isLight:function(){return!this.isDark()},negate:function(){for(var w=this.rgb(),v=0;v<3;v++)w.color[v]=255-w.color[v];return w},lighten:function(w){var v=this.hsl();return v.color[2]+=v.color[2]*w,v},darken:function(w){var v=this.hsl();return v.color[2]-=v.color[2]*w,v},saturate:function(w){var v=this.hsl();return v.color[1]+=v.color[1]*w,v},desaturate:function(w){var v=this.hsl();return v.color[1]-=v.color[1]*w,v},whiten:function(w){var v=this.hwb();return v.color[1]+=v.color[1]*w,v},blacken:function(w){var v=this.hwb();return v.color[2]+=v.color[2]*w,v},grayscale:function(){var w=this.rgb().color,v=.3*w[0]+.59*w[1]+.11*w[2];return l.rgb(v,v,v)},fade:function(w){return this.alpha(this.valpha-this.valpha*w)},opaquer:function(w){return this.alpha(this.valpha+this.valpha*w)},rotate:function(w){var v=this.hsl(),I=v.color[0];return I=(I=(I+w)%360)<0?360+I:I,v.color[0]=I,v},mix:function(w,v){if(!w||!w.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof w);var I=w.rgb(),P=this.rgb(),u=void 0===v?.5:v,Q=2*u-1,K=I.alpha()-P.alpha(),a=((Q*K===-1?Q:(Q+K)/(1+Q*K))+1)/2,U=1-a;return l.rgb(a*I.red()+U*P.red(),a*I.green()+U*P.green(),a*I.blue()+U*P.blue(),I.alpha()*u+P.alpha()*(1-u))}};for(var R=function(){var w=j[x];if(U.includes(w))return"continue";var v=a[w].channels;l.prototype[w]=function(){if(this.model===w)return new l(this);for(var v=arguments.length,I=new Array(v),P=0;P<v;P++)I[P]=arguments[P];return I.length>0?new l(I,w):new l([].concat(Q(t(a[this.model][w].raw(this.color))),[this.valpha]),w)},l[w]=function(){for(var I=arguments.length,P=new Array(I),u=0;u<I;u++)P[u]=arguments[u];var Q=P[0];return"number"===typeof Q&&(Q=i(P,v)),new l(Q,w)}},x=0,j=Object.keys(a);x<j.length;x++)R();function s(w,v,I){w=Array.isArray(w)?w:[w];var P,Q=u(w);try{for(Q.s();!(P=Q.n()).done;){var K=P.value;(J[K]||(J[K]=[]))[v]=I}}catch(w){Q.e(w)}finally{Q.f()}return w=w[0],function(P){var u;return void 0!==P?(I&&(P=I(P)),(u=this[w]()).color[v]=P,u):(u=this[w]().color[v],I&&(u=I(u)),u)}}function B(w){return function(v){return Math.max(0,Math.min(w,v))}}function t(w){return Array.isArray(w)?w:[w]}function i(w,v){for(var I=0;I<v;I++)"number"!==typeof w[I]&&(w[I]=0);return w}w.exports=l},20198:function(w,v,I){for(var P=I(27424).default,u=I(15987),Q={},K=0,a=Object.keys(u);K<a.length;K++){var U=a[K];Q[u[U]]=U}var p={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};w.exports=p;for(var r=0,Y=Object.keys(p);r<Y.length;r++){var g=Y[r];if(!("channels"in p[g]))throw new Error("missing channels property: "+g);if(!("labels"in p[g]))throw new Error("missing channel labels property: "+g);if(p[g].labels.length!==p[g].channels)throw new Error("channel and label counts mismatch: "+g);var J=p[g],l=J.channels,R=J.labels;delete p[g].channels,delete p[g].labels,Object.defineProperty(p[g],"channels",{value:l}),Object.defineProperty(p[g],"labels",{value:R})}p.rgb.hsl=function(w){var v,I=w[0]/255,P=w[1]/255,u=w[2]/255,Q=Math.min(I,P,u),K=Math.max(I,P,u),a=K-Q;K===Q?v=0:I===K?v=(P-u)/a:P===K?v=2+(u-I)/a:u===K&&(v=4+(I-P)/a),(v=Math.min(60*v,360))<0&&(v+=360);var U=(Q+K)/2;return[v,100*(K===Q?0:U<=.5?a/(K+Q):a/(2-K-Q)),100*U]},p.rgb.hsv=function(w){var v,I,P,u,Q,K=w[0]/255,a=w[1]/255,U=w[2]/255,p=Math.max(K,a,U),r=p-Math.min(K,a,U),Y=function(w){return(p-w)/6/r+.5};return 0===r?(u=0,Q=0):(Q=r/p,v=Y(K),I=Y(a),P=Y(U),K===p?u=P-I:a===p?u=1/3+v-P:U===p&&(u=2/3+I-v),u<0?u+=1:u>1&&(u-=1)),[360*u,100*Q,100*p]},p.rgb.hwb=function(w){var v=w[0],I=w[1],P=w[2];return[p.rgb.hsl(w)[0],100*(1/255*Math.min(v,Math.min(I,P))),100*(P=1-1/255*Math.max(v,Math.max(I,P)))]},p.rgb.cmyk=function(w){var v=w[0]/255,I=w[1]/255,P=w[2]/255,u=Math.min(1-v,1-I,1-P);return[100*((1-v-u)/(1-u)||0),100*((1-I-u)/(1-u)||0),100*((1-P-u)/(1-u)||0),100*u]},p.rgb.keyword=function(w){var v=Q[w];if(v)return v;for(var I,P,K,a=1/0,U=0,p=Object.keys(u);U<p.length;U++){var r=p[U],Y=u[r],g=(P=w,K=Y,Math.pow(P[0]-K[0],2)+Math.pow(P[1]-K[1],2)+Math.pow(P[2]-K[2],2));g<a&&(a=g,I=r)}return I},p.keyword.rgb=function(w){return u[w]},p.rgb.xyz=function(w){var v=w[0]/255,I=w[1]/255,P=w[2]/255;return[100*(.4124*(v=v>.04045?Math.pow((v+.055)/1.055,2.4):v/12.92)+.3576*(I=I>.04045?Math.pow((I+.055)/1.055,2.4):I/12.92)+.1805*(P=P>.04045?Math.pow((P+.055)/1.055,2.4):P/12.92)),100*(.2126*v+.7152*I+.0722*P),100*(.0193*v+.1192*I+.9505*P)]},p.rgb.lab=function(w){var v=p.rgb.xyz(w),I=v[0],P=v[1],u=v[2];return P/=100,u/=108.883,I=(I/=95.047)>.008856?Math.pow(I,1/3):7.787*I+16/116,[116*(P=P>.008856?Math.pow(P,1/3):7.787*P+16/116)-16,500*(I-P),200*(P-(u=u>.008856?Math.pow(u,1/3):7.787*u+16/116))]},p.hsl.rgb=function(w){var v,I,P,u=w[0]/360,Q=w[1]/100,K=w[2]/100;if(0===Q)return[P=255*K,P,P];for(var a=2*K-(v=K<.5?K*(1+Q):K+Q-K*Q),U=[0,0,0],p=0;p<3;p++)(I=u+1/3*-(p-1))<0&&I++,I>1&&I--,P=6*I<1?a+6*(v-a)*I:2*I<1?v:3*I<2?a+(v-a)*(2/3-I)*6:a,U[p]=255*P;return U},p.hsl.hsv=function(w){var v=w[0],I=w[1]/100,P=w[2]/100,u=I,Q=Math.max(P,.01);return I*=(P*=2)<=1?P:2-P,u*=Q<=1?Q:2-Q,[v,100*(0===P?2*u/(Q+u):2*I/(P+I)),100*((P+I)/2)]},p.hsv.rgb=function(w){var v=w[0]/60,I=w[1]/100,P=w[2]/100,u=Math.floor(v)%6,Q=v-Math.floor(v),K=255*P*(1-I),a=255*P*(1-I*Q),U=255*P*(1-I*(1-Q));switch(P*=255,u){case 0:return[P,U,K];case 1:return[a,P,K];case 2:return[K,P,U];case 3:return[K,a,P];case 4:return[U,K,P];case 5:return[P,K,a]}},p.hsv.hsl=function(w){var v,I,P=w[0],u=w[1]/100,Q=w[2]/100,K=Math.max(Q,.01);I=(2-u)*Q;var a=(2-u)*K;return v=u*K,[P,100*(v=(v/=a<=1?a:2-a)||0),100*(I/=2)]},p.hwb.rgb=function(w){var v,I=w[0]/360,P=w[1]/100,u=w[2]/100,Q=P+u;Q>1&&(P/=Q,u/=Q);var K=Math.floor(6*I),a=1-u;v=6*I-K,0!==(1&K)&&(v=1-v);var U,p,r,Y=P+v*(a-P);switch(K){default:case 6:case 0:U=a,p=Y,r=P;break;case 1:U=Y,p=a,r=P;break;case 2:U=P,p=a,r=Y;break;case 3:U=P,p=Y,r=a;break;case 4:U=Y,p=P,r=a;break;case 5:U=a,p=P,r=Y}return[255*U,255*p,255*r]},p.cmyk.rgb=function(w){var v=w[0]/100,I=w[1]/100,P=w[2]/100,u=w[3]/100;return[255*(1-Math.min(1,v*(1-u)+u)),255*(1-Math.min(1,I*(1-u)+u)),255*(1-Math.min(1,P*(1-u)+u))]},p.xyz.rgb=function(w){var v,I,P,u=w[0]/100,Q=w[1]/100,K=w[2]/100;return I=-.9689*u+1.8758*Q+.0415*K,P=.0557*u+-.204*Q+1.057*K,v=(v=3.2406*u+-1.5372*Q+-.4986*K)>.0031308?1.055*Math.pow(v,1/2.4)-.055:12.92*v,I=I>.0031308?1.055*Math.pow(I,1/2.4)-.055:12.92*I,P=P>.0031308?1.055*Math.pow(P,1/2.4)-.055:12.92*P,[255*(v=Math.min(Math.max(0,v),1)),255*(I=Math.min(Math.max(0,I),1)),255*(P=Math.min(Math.max(0,P),1))]},p.xyz.lab=function(w){var v=w[0],I=w[1],P=w[2];return I/=100,P/=108.883,v=(v/=95.047)>.008856?Math.pow(v,1/3):7.787*v+16/116,[116*(I=I>.008856?Math.pow(I,1/3):7.787*I+16/116)-16,500*(v-I),200*(I-(P=P>.008856?Math.pow(P,1/3):7.787*P+16/116))]},p.lab.xyz=function(w){var v,I,P,u=w[0];v=w[1]/500+(I=(u+16)/116),P=I-w[2]/200;var Q=Math.pow(I,3),K=Math.pow(v,3),a=Math.pow(P,3);return I=Q>.008856?Q:(I-16/116)/7.787,v=K>.008856?K:(v-16/116)/7.787,P=a>.008856?a:(P-16/116)/7.787,[v*=95.047,I*=100,P*=108.883]},p.lab.lch=function(w){var v,I=w[0],P=w[1],u=w[2];return(v=360*Math.atan2(u,P)/2/Math.PI)<0&&(v+=360),[I,Math.sqrt(P*P+u*u),v]},p.lch.lab=function(w){var v=w[0],I=w[1],P=w[2]/360*2*Math.PI;return[v,I*Math.cos(P),I*Math.sin(P)]},p.rgb.ansi16=function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=P(w,3),u=I[0],Q=I[1],K=I[2],a=null===v?p.rgb.hsv(w)[2]:v;if(0===(a=Math.round(a/50)))return 30;var U=30+(Math.round(K/255)<<2|Math.round(Q/255)<<1|Math.round(u/255));return 2===a&&(U+=60),U},p.hsv.ansi16=function(w){return p.rgb.ansi16(p.hsv.rgb(w),w[2])},p.rgb.ansi256=function(w){var v=w[0],I=w[1],P=w[2];return v===I&&I===P?v<8?16:v>248?231:Math.round((v-8)/247*24)+232:16+36*Math.round(v/255*5)+6*Math.round(I/255*5)+Math.round(P/255*5)},p.ansi16.rgb=function(w){var v=w%10;if(0===v||7===v)return w>50&&(v+=3.5),[v=v/10.5*255,v,v];var I=.5*(1+~~(w>50));return[(1&v)*I*255,(v>>1&1)*I*255,(v>>2&1)*I*255]},p.ansi256.rgb=function(w){if(w>=232){var v=10*(w-232)+8;return[v,v,v]}var I;return w-=16,[Math.floor(w/36)/5*255,Math.floor((I=w%36)/6)/5*255,I%6/5*255]},p.rgb.hex=function(w){var v=(((255&Math.round(w[0]))<<16)+((255&Math.round(w[1]))<<8)+(255&Math.round(w[2]))).toString(16).toUpperCase();return"000000".substring(v.length)+v},p.hex.rgb=function(w){var v=w.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!v)return[0,0,0];var I=v[0];3===v[0].length&&(I=I.split("").map((function(w){return w+w})).join(""));var P=parseInt(I,16);return[P>>16&255,P>>8&255,255&P]},p.rgb.hcg=function(w){var v,I=w[0]/255,P=w[1]/255,u=w[2]/255,Q=Math.max(Math.max(I,P),u),K=Math.min(Math.min(I,P),u),a=Q-K;return v=a<=0?0:Q===I?(P-u)/a%6:Q===P?2+(u-I)/a:4+(I-P)/a,v/=6,[360*(v%=1),100*a,100*(a<1?K/(1-a):0)]},p.hsl.hcg=function(w){var v=w[1]/100,I=w[2]/100,P=I<.5?2*v*I:2*v*(1-I),u=0;return P<1&&(u=(I-.5*P)/(1-P)),[w[0],100*P,100*u]},p.hsv.hcg=function(w){var v=w[1]/100,I=w[2]/100,P=v*I,u=0;return P<1&&(u=(I-P)/(1-P)),[w[0],100*P,100*u]},p.hcg.rgb=function(w){var v=w[0]/360,I=w[1]/100,P=w[2]/100;if(0===I)return[255*P,255*P,255*P];var u,Q=[0,0,0],K=v%1*6,a=K%1,U=1-a;switch(Math.floor(K)){case 0:Q[0]=1,Q[1]=a,Q[2]=0;break;case 1:Q[0]=U,Q[1]=1,Q[2]=0;break;case 2:Q[0]=0,Q[1]=1,Q[2]=a;break;case 3:Q[0]=0,Q[1]=U,Q[2]=1;break;case 4:Q[0]=a,Q[1]=0,Q[2]=1;break;default:Q[0]=1,Q[1]=0,Q[2]=U}return u=(1-I)*P,[255*(I*Q[0]+u),255*(I*Q[1]+u),255*(I*Q[2]+u)]},p.hcg.hsv=function(w){var v=w[1]/100,I=v+w[2]/100*(1-v),P=0;return I>0&&(P=v/I),[w[0],100*P,100*I]},p.hcg.hsl=function(w){var v=w[1]/100,I=w[2]/100*(1-v)+.5*v,P=0;return I>0&&I<.5?P=v/(2*I):I>=.5&&I<1&&(P=v/(2*(1-I))),[w[0],100*P,100*I]},p.hcg.hwb=function(w){var v=w[1]/100,I=v+w[2]/100*(1-v);return[w[0],100*(I-v),100*(1-I)]},p.hwb.hcg=function(w){var v=w[1]/100,I=1-w[2]/100,P=I-v,u=0;return P<1&&(u=(I-P)/(1-P)),[w[0],100*P,100*u]},p.apple.rgb=function(w){return[w[0]/65535*255,w[1]/65535*255,w[2]/65535*255]},p.rgb.apple=function(w){return[w[0]/255*65535,w[1]/255*65535,w[2]/255*65535]},p.gray.rgb=function(w){return[w[0]/100*255,w[0]/100*255,w[0]/100*255]},p.gray.hsl=function(w){return[0,0,w[0]]},p.gray.hsv=p.gray.hsl,p.gray.hwb=function(w){return[0,100,w[0]]},p.gray.cmyk=function(w){return[0,0,0,w[0]]},p.gray.lab=function(w){return[w[0],0,0]},p.gray.hex=function(w){var v=255&Math.round(w[0]/100*255),I=((v<<16)+(v<<8)+v).toString(16).toUpperCase();return"000000".substring(I.length)+I},p.rgb.gray=function(w){return[(w[0]+w[1]+w[2])/3/255*100]}},43143:function(w,v,I){var P=I(20198),u=I(63150),Q={};Object.keys(P).forEach((function(w){Q[w]={},Object.defineProperty(Q[w],"channels",{value:P[w].channels}),Object.defineProperty(Q[w],"labels",{value:P[w].labels});var v=u(w);Object.keys(v).forEach((function(I){var P=v[I];Q[w][I]=function(w){var v=function(){for(var v=arguments.length,I=new Array(v),P=0;P<v;P++)I[P]=arguments[P];var u=I[0];if(void 0===u||null===u)return u;u.length>1&&(I=u);var Q=w(I);if("object"===typeof Q)for(var K=Q.length,a=0;a<K;a++)Q[a]=Math.round(Q[a]);return Q};return"conversion"in w&&(v.conversion=w.conversion),v}(P),Q[w][I].raw=function(w){var v=function(){for(var v=arguments.length,I=new Array(v),P=0;P<v;P++)I[P]=arguments[P];var u=I[0];return void 0===u||null===u?u:(u.length>1&&(I=u),w(I))};return"conversion"in w&&(v.conversion=w.conversion),v}(P)}))})),w.exports=Q},63150:function(w,v,I){var P=I(20198);function u(w){var v=function(){for(var w={},v=Object.keys(P),I=v.length,u=0;u<I;u++)w[v[u]]={distance:-1,parent:null};return w}(),I=[w];for(v[w].distance=0;I.length;)for(var u=I.pop(),Q=Object.keys(P[u]),K=Q.length,a=0;a<K;a++){var U=Q[a],p=v[U];-1===p.distance&&(p.distance=v[u].distance+1,p.parent=u,I.unshift(U))}return v}function Q(w,v){return function(I){return v(w(I))}}function K(w,v){for(var I=[v[w].parent,w],u=P[v[w].parent][w],K=v[w].parent;v[K].parent;)I.unshift(v[K].parent),u=Q(P[v[K].parent][K],u),K=v[K].parent;return u.conversion=I,u}w.exports=function(w){for(var v=u(w),I={},P=Object.keys(v),Q=P.length,a=0;a<Q;a++){var U=P[a];null!==v[U].parent&&(I[U]=K(U,v))}return I}},15987:function(w){"use strict";w.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},37981:function(w,v,I){"use strict";var P=I(64687),u=I(56690).default,Q=I(89728).default,K=this&&this.__createBinding||(Object.create?function(w,v,I,P){void 0===P&&(P=I);var u=Object.getOwnPropertyDescriptor(v,I);u&&!("get"in u?!v.__esModule:u.writable||u.configurable)||(u={enumerable:!0,get:function(){return v[I]}}),Object.defineProperty(w,P,u)}:function(w,v,I,P){void 0===P&&(P=I),w[P]=v[I]}),a=this&&this.__setModuleDefault||(Object.create?function(w,v){Object.defineProperty(w,"default",{enumerable:!0,value:v})}:function(w,v){w.default=v}),U=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var v={};if(null!=w)for(var I in w)"default"!==I&&Object.prototype.hasOwnProperty.call(w,I)&&K(v,w,I);return a(v,w),v},p=this&&this.__awaiter||function(w,v,I,P){return new(I||(I=Promise))((function(u,Q){function K(w){try{U(P.next(w))}catch(w){Q(w)}}function a(w){try{U(P.throw(w))}catch(w){Q(w)}}function U(w){var v;w.done?u(w.value):(v=w.value,v instanceof I?v:new I((function(w){w(v)}))).then(K,a)}U((P=P.apply(w,v||[])).next())}))};Object.defineProperty(v,"__esModule",{value:!0}),v.Auth=v.Platform=void 0;var r=U(I(22494)),Y=I(98216),g="colyseus-auth-token";!function(w){w.ios="ios",w.android="android"}(v.Platform||(v.Platform={}));var J=function(){function w(v){var I=this;u(this,w),this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=v.replace("ws","http"),(0,Y.getItem)(g,(function(w){return I.token=w}))}return Q(w,[{key:"hasToken",get:function(){return!!this.token}},{key:"login",value:function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return p(this,void 0,void 0,P.mark((function v(){var I,u,Q;return P.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:return I=Object.assign({},w),this.hasToken&&(I.token=this.token),v.next=4,this.request("post","/auth",I);case 4:for(Q in u=v.sent,this.token=u.token,(0,Y.setItem)(g,this.token),u)this.hasOwnProperty(Q)&&(this[Q]=u[Q]);return this.registerPingService(),v.abrupt("return",this);case 10:case"end":return v.stop()}}),v,this)})))}},{key:"save",value:function(){return p(this,void 0,void 0,P.mark((function w(){return P.wrap((function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone});case 2:return w.abrupt("return",this);case 3:case"end":return w.stop()}}),w,this)})))}},{key:"getFriends",value:function(){return p(this,void 0,void 0,P.mark((function w(){return P.wrap((function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this.request("get","/friends/all");case 2:return w.abrupt("return",w.sent);case 3:case"end":return w.stop()}}),w,this)})))}},{key:"getOnlineFriends",value:function(){return p(this,void 0,void 0,P.mark((function w(){return P.wrap((function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this.request("get","/friends/online");case 2:return w.abrupt("return",w.sent);case 3:case"end":return w.stop()}}),w,this)})))}},{key:"getFriendRequests",value:function(){return p(this,void 0,void 0,P.mark((function w(){return P.wrap((function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this.request("get","/friends/requests");case 2:return w.abrupt("return",w.sent);case 3:case"end":return w.stop()}}),w,this)})))}},{key:"sendFriendRequest",value:function(w){return p(this,void 0,void 0,P.mark((function v(){return P.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.request("post","/friends/requests",{userId:w});case 2:return v.abrupt("return",v.sent);case 3:case"end":return v.stop()}}),v,this)})))}},{key:"acceptFriendRequest",value:function(w){return p(this,void 0,void 0,P.mark((function v(){return P.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.request("put","/friends/requests",{userId:w});case 2:return v.abrupt("return",v.sent);case 3:case"end":return v.stop()}}),v,this)})))}},{key:"declineFriendRequest",value:function(w){return p(this,void 0,void 0,P.mark((function v(){return P.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.request("del","/friends/requests",{userId:w});case 2:return v.abrupt("return",v.sent);case 3:case"end":return v.stop()}}),v,this)})))}},{key:"blockUser",value:function(w){return p(this,void 0,void 0,P.mark((function v(){return P.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.request("post","/friends/block",{userId:w});case 2:return v.abrupt("return",v.sent);case 3:case"end":return v.stop()}}),v,this)})))}},{key:"unblockUser",value:function(w){return p(this,void 0,void 0,P.mark((function v(){return P.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.request("put","/friends/block",{userId:w});case 2:return v.abrupt("return",v.sent);case 3:case"end":return v.stop()}}),v,this)})))}},{key:"request",value:function(w,v){var I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return p(this,void 0,void 0,P.mark((function K(){var a,U,p,Y;return P.wrap((function(P){for(;;)switch(P.prev=P.next){case 0:for(U in Q.Accept="application/json",this.hasToken&&(Q.Authorization="Bearer "+this.token),a=[],I)a.push("".concat(U,"=").concat(I[U]));return p=a.length>0?"?".concat(a.join("&")):"",Y={headers:Q},u&&(Y.body=u),P.next=9,r[w]("".concat(this.endpoint).concat(v).concat(p),Y);case 9:return P.abrupt("return",P.sent.data);case 10:case"end":return P.stop()}}),K,this)})))}},{key:"logout",value:function(){this.token=void 0,(0,Y.removeItem)(g),this.unregisterPingService()}},{key:"registerPingService",value:function(){var w=this,v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((function(){return w.request("get","/auth")}),v)}},{key:"unregisterPingService",value:function(){clearInterval(this.keepOnlineInterval)}}]),w}();v.Auth=J},90442:function(w,v,I){"use strict";var P,u=I(27424).default,Q=I(64687),K=I(89728).default,a=I(56690).default,U=I(66115).default,p=I(61655).default,r=I(26389).default,Y=I(33496).default,g=this&&this.__awaiter||function(w,v,I,P){return new(I||(I=Promise))((function(u,Q){function K(w){try{U(P.next(w))}catch(w){Q(w)}}function a(w){try{U(P.throw(w))}catch(w){Q(w)}}function U(w){var v;w.done?u(w.value):(v=w.value,v instanceof I?v:new I((function(w){w(v)}))).then(K,a)}U((P=P.apply(w,v||[])).next())}))};Object.defineProperty(v,"__esModule",{value:!0}),v.Client=v.MatchMakeError=void 0;var J=I(22494),l=I(33739),R=I(62898),x=function(w){p(I,w);var v=r(I);function I(w,P){var u;return a(this,I),(u=v.call(this,w)).code=P,Object.setPrototypeOf(U(u),I.prototype),u}return K(I)}(Y(Error));v.MatchMakeError=x;var j="undefined"!==typeof window&&"undefined"!==typeof(null===(P=null===window||void 0===window?void 0:window.location)||void 0===P?void 0:P.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567",s=function(){function w(){var v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j;if(a(this,w),"string"===typeof v){var I=new URL(v),P="https:"===I.protocol||"wss:"===I.protocol,u=Number(I.port||(P?443:80));this.settings={hostname:I.hostname,pathname:"/"!==I.pathname?I.pathname:"",port:u,secure:P}}else void 0===v.port&&(v.port=v.secure?443:80),void 0===v.pathname&&(v.pathname=""),this.settings=v}return K(w,[{key:"joinOrCreate",value:function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,Q.mark((function P(){return Q.wrap((function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,this.createMatchMakeRequest("joinOrCreate",w,v,I);case 2:return P.abrupt("return",P.sent);case 3:case"end":return P.stop()}}),P,this)})))}},{key:"create",value:function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,Q.mark((function P(){return Q.wrap((function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,this.createMatchMakeRequest("create",w,v,I);case 2:return P.abrupt("return",P.sent);case 3:case"end":return P.stop()}}),P,this)})))}},{key:"join",value:function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,Q.mark((function P(){return Q.wrap((function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,this.createMatchMakeRequest("join",w,v,I);case 2:return P.abrupt("return",P.sent);case 3:case"end":return P.stop()}}),P,this)})))}},{key:"joinById",value:function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,Q.mark((function P(){return Q.wrap((function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,this.createMatchMakeRequest("joinById",w,v,I);case 2:return P.abrupt("return",P.sent);case 3:case"end":return P.stop()}}),P,this)})))}},{key:"reconnect",value:function(w,v){return g(this,void 0,void 0,Q.mark((function I(){var P,K,a,U;return Q.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if("string"!==typeof w||"string"!==typeof v){I.next=2;break}throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");case 2:return P=w.split(":"),K=u(P,2),a=K[0],U=K[1],I.next=5,this.createMatchMakeRequest("reconnect",a,{reconnectionToken:U},v);case 5:return I.abrupt("return",I.sent);case 6:case"end":return I.stop()}}),I,this)})))}},{key:"getAvailableRooms",value:function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return g(this,void 0,void 0,Q.mark((function v(){return Q.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,(0,J.get)(this.getHttpEndpoint("".concat(w)),{headers:{Accept:"application/json"}});case 2:return v.abrupt("return",v.sent.data);case 3:case"end":return v.stop()}}),v,this)})))}},{key:"consumeSeatReservation",value:function(w,v,I){return g(this,void 0,void 0,Q.mark((function P(){var u,K,a,U=this;return Q.wrap((function(P){for(;;)switch(P.prev=P.next){case 0:return(u=this.createRoom(w.room.name,v)).roomId=w.room.roomId,u.sessionId=w.sessionId,K={sessionId:u.sessionId},w.reconnectionToken&&(K.reconnectionToken=w.reconnectionToken),a=I||u,u.connect(this.buildEndpoint(w.room,K),w.devMode&&function(){return g(U,void 0,void 0,Q.mark((function I(){var P,K,U=this;return Q.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(u.roomId,"'...")),P=0,8,K=function I(){return g(U,void 0,void 0,Q.mark((function K(){return Q.wrap((function(Q){for(;;)switch(Q.prev=Q.next){case 0:return P++,Q.prev=1,Q.next=4,this.consumeSeatReservation(w,v,a);case 4:console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(u.roomId,"'")),Q.next=10;break;case 7:Q.prev=7,Q.t0=Q.catch(1),P<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(P," out of ").concat(8,")")),setTimeout(I,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs."));case 10:case"end":return Q.stop()}}),K,this,[[1,7]])})))},setTimeout(K,2e3);case 5:case"end":return I.stop()}}),I)})))},a),P.abrupt("return",new Promise((function(w,v){var I=function(w,I){return v(new l.ServerError(w,I))};a.onError.once(I),a.onJoin.once((function(){a.onError.remove(I),w(a)}))})));case 8:case"end":return P.stop()}}),P,this)})))}},{key:"createMatchMakeRequest",value:function(w,v){var I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},P=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;return g(this,void 0,void 0,Q.mark((function K(){var a;return Q.wrap((function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,(0,J.post)(this.getHttpEndpoint("".concat(w,"/").concat(v)),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(I)});case 2:if(!(a=Q.sent.data).error){Q.next=5;break}throw new x(a.error,a.code);case 5:return"reconnect"===w&&(a.reconnectionToken=I.reconnectionToken),Q.next=8,this.consumeSeatReservation(a,P,u);case 8:return Q.abrupt("return",Q.sent);case 9:case"end":return Q.stop()}}),K,this)})))}},{key:"createRoom",value:function(w,v){return new R.Room(w,v)}},{key:"buildEndpoint",value:function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=[];for(var P in v)v.hasOwnProperty(P)&&I.push("".concat(P,"=").concat(v[P]));var u=this.settings.secure?"wss://":"ws://";return w.publicAddress?u+="".concat(w.publicAddress):u+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname),"".concat(u,"/").concat(w.processId,"/").concat(w.roomId,"?").concat(I.join("&"))}},{key:"getHttpEndpoint",value:function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname,"/matchmake/").concat(w)}},{key:"getEndpointPort",value:function(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""}}]),w}();v.Client=s},34787:function(w,v,I){"use strict";var P=I(56690).default,u=I(89728).default;Object.defineProperty(v,"__esModule",{value:!0}),v.Connection=void 0;var Q=I(52054),K=function(){function w(){P(this,w),this.events={},this.transport=new Q.WebSocketTransport(this.events)}return u(w,[{key:"send",value:function(w){this.transport.send(w)}},{key:"connect",value:function(w){this.transport.connect(w)}},{key:"close",value:function(w,v){this.transport.close(w,v)}},{key:"isOpen",get:function(){return this.transport.isOpen}}]),w}();v.Connection=K},65211:function(w,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.utf8Length=v.utf8Read=v.ErrorCode=v.Protocol=void 0,function(w){w[w.HANDSHAKE=9]="HANDSHAKE",w[w.JOIN_ROOM=10]="JOIN_ROOM",w[w.ERROR=11]="ERROR",w[w.LEAVE_ROOM=12]="LEAVE_ROOM",w[w.ROOM_DATA=13]="ROOM_DATA",w[w.ROOM_STATE=14]="ROOM_STATE",w[w.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",w[w.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",w[w.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(v.Protocol||(v.Protocol={})),function(w){w[w.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",w[w.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",w[w.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",w[w.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",w[w.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",w[w.AUTH_FAILED=4215]="AUTH_FAILED",w[w.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(v.ErrorCode||(v.ErrorCode={})),v.utf8Read=function(w,v){for(var I=w[v++],P="",u=0,Q=v,K=v+I;Q<K;Q++){var a=w[Q];if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(u=(7&a)<<18|(63&w[++Q])<<12|(63&w[++Q])<<6|(63&w[++Q])<<0)>=65536?(u-=65536,P+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):P+=String.fromCharCode(u)}else P+=String.fromCharCode((15&a)<<12|(63&w[++Q])<<6|(63&w[++Q])<<0);else P+=String.fromCharCode((31&a)<<6|63&w[++Q]);else P+=String.fromCharCode(a)}return P},v.utf8Length=function(){for(var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",v=0,I=0,P=0,u=w.length;P<u;P++)(v=w.charCodeAt(P))<128?I+=1:v<2048?I+=2:v<55296||v>=57344?I+=3:(P++,I+=4);return I+1}},62898:function(w,v,I){"use strict";var P=I(56690).default,u=I(89728).default,Q=this&&this.__createBinding||(Object.create?function(w,v,I,P){void 0===P&&(P=I);var u=Object.getOwnPropertyDescriptor(v,I);u&&!("get"in u?!v.__esModule:u.writable||u.configurable)||(u={enumerable:!0,get:function(){return v[I]}}),Object.defineProperty(w,P,u)}:function(w,v,I,P){void 0===P&&(P=I),w[P]=v[I]}),K=this&&this.__setModuleDefault||(Object.create?function(w,v){Object.defineProperty(w,"default",{enumerable:!0,value:v})}:function(w,v){w.default=v}),a=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var v={};if(null!=w)for(var I in w)"default"!==I&&Object.prototype.hasOwnProperty.call(w,I)&&Q(v,w,I);return K(v,w),v};Object.defineProperty(v,"__esModule",{value:!0}),v.Room=void 0;var U=a(I(61627)),p=I(34787),r=I(65211),Y=I(40765),g=I(8491),J=I(10025),l=I(50061),R=I(33739),x=function(){function w(v,I){var u=this;P(this,w),this.onStateChange=(0,J.createSignal)(),this.onError=(0,J.createSignal)(),this.onLeave=(0,J.createSignal)(),this.onJoin=(0,J.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,g.createNanoEvents)(),this.roomId=null,this.name=v,I&&(this.serializer=new((0,Y.getSerializer)("schema")),this.rootSchema=I,this.serializer.state=new I),this.onError((function(w,v){var I;return null===(I=console.warn)||void 0===I?void 0:I.call(console,"colyseus.js - onError => (".concat(w,") ").concat(v))})),this.onLeave((function(){return u.removeAllListeners()}))}return u(w,[{key:"id",get:function(){return this.roomId}},{key:"connect",value:function(v,I){var P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,u=new p.Connection;P.connection=u,u.events.onmessage=w.prototype.onMessageCallback.bind(P),u.events.onclose=function(w){var v;if(!P.hasJoined)return null===(v=console.warn)||void 0===v||v.call(console,"Room connection was closed unexpectedly (".concat(w.code,"): ").concat(w.reason)),void P.onError.invoke(w.code,w.reason);w.code===R.CloseCode.DEVMODE_RESTART&&I?I():(P.onLeave.invoke(w.code),P.destroy())},u.events.onerror=function(w){var v;null===(v=console.warn)||void 0===v||v.call(console,"Room, onError (".concat(w.code,"): ").concat(w.reason)),P.onError.invoke(w.code,w.reason)},u.connect(v)}},{key:"leave",value:function(){var w=this,v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((function(I){w.onLeave((function(w){return I(w)})),w.connection?v?w.connection.send([r.Protocol.LEAVE_ROOM]):w.connection.close():w.onLeave.invoke(R.CloseCode.CONSENTED)}))}},{key:"onMessage",value:function(w,v){return this.onMessageHandlers.on(this.getMessageHandlerKey(w),v)}},{key:"send",value:function(w,v){var I,P=[r.Protocol.ROOM_DATA];if("string"===typeof w?l.encode.string(P,w):l.encode.number(P,w),void 0!==v){var u=U.encode(v);(I=new Uint8Array(P.length+u.byteLength)).set(new Uint8Array(P),0),I.set(new Uint8Array(u),P.length)}else I=new Uint8Array(P);this.connection.send(I.buffer)}},{key:"sendBytes",value:function(w,v){var I,P=[r.Protocol.ROOM_DATA_BYTES];"string"===typeof w?l.encode.string(P,w):l.encode.number(P,w),(I=new Uint8Array(P.length+(v.byteLength||v.length))).set(new Uint8Array(P),0),I.set(new Uint8Array(v),P.length),this.connection.send(I.buffer)}},{key:"state",get:function(){return this.serializer.getState()}},{key:"removeAllListeners",value:function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}},{key:"onMessageCallback",value:function(w){var v=Array.from(new Uint8Array(w.data)),I=v[0];if(I===r.Protocol.JOIN_ROOM){var P=1,u=(0,r.utf8Read)(v,P);if(P+=(0,r.utf8Length)(u),this.serializerId=(0,r.utf8Read)(v,P),P+=(0,r.utf8Length)(this.serializerId),!this.serializer){var Q=(0,Y.getSerializer)(this.serializerId);this.serializer=new Q}v.length>P&&this.serializer.handshake&&this.serializer.handshake(v,{offset:P}),this.reconnectionToken="".concat(this.roomId,":").concat(u),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([r.Protocol.JOIN_ROOM])}else if(I===r.Protocol.ERROR){var K={offset:1},a=l.decode.number(v,K),p=l.decode.string(v,K);this.onError.invoke(a,p)}else if(I===r.Protocol.LEAVE_ROOM)this.leave();else if(I===r.Protocol.ROOM_DATA_SCHEMA){var g={offset:1},J=this.serializer.getState().constructor._context.get(l.decode.number(v,g)),R=new J;R.decode(v,g),this.dispatchMessage(J,R)}else if(I===r.Protocol.ROOM_STATE)v.shift(),this.setState(v);else if(I===r.Protocol.ROOM_STATE_PATCH)v.shift(),this.patch(v);else if(I===r.Protocol.ROOM_DATA){var x={offset:1},j=l.decode.stringCheck(v,x)?l.decode.string(v,x):l.decode.number(v,x),s=v.length>x.offset?U.decode(w.data,x.offset):void 0;this.dispatchMessage(j,s)}else if(I===r.Protocol.ROOM_DATA_BYTES){var B={offset:1},t=l.decode.stringCheck(v,B)?l.decode.string(v,B):l.decode.number(v,B);this.dispatchMessage(t,new Uint8Array(v.slice(B.offset)))}}},{key:"setState",value:function(w){this.serializer.setState(w),this.onStateChange.invoke(this.serializer.getState())}},{key:"patch",value:function(w){this.serializer.patch(w),this.onStateChange.invoke(this.serializer.getState())}},{key:"dispatchMessage",value:function(w,v){var I,P=this.getMessageHandlerKey(w);this.onMessageHandlers.events[P]?this.onMessageHandlers.emit(P,v):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",w,v):null===(I=console.warn)||void 0===I||I.call(console,"colyseus.js: onMessage() not registered for type '".concat(w,"'."))}},{key:"destroy",value:function(){this.serializer&&this.serializer.teardown()}},{key:"getMessageHandlerKey",value:function(w){switch(typeof w){case"function":return"$".concat(w._typeid);case"string":return w;case"number":return"i".concat(w);default:throw new Error("invalid message type.")}}}]),w}();v.Room=x},98216:function(w,v){"use strict";var I;function P(){return I||(I="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(w,v){this.cache[w]=v},getItem:function(w){this.cache[w]},removeItem:function(w){delete this.cache[w]}}),I}Object.defineProperty(v,"__esModule",{value:!0}),v.getItem=v.removeItem=v.setItem=void 0,v.setItem=function(w,v){P().setItem(w,v)},v.removeItem=function(w){P().removeItem(w)},v.getItem=function(w,v){var I=P().getItem(w);"undefined"!==typeof Promise&&I instanceof Promise?I.then((function(w){return v(w)})):v(I)}},8491:function(w,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createNanoEvents=void 0;v.createNanoEvents=function(){return{emit:function(w){for(var v=this.events[w]||[],I=arguments.length,P=new Array(I>1?I-1:0),u=1;u<I;u++)P[u-1]=arguments[u];for(var Q=0,K=v.length;Q<K;Q++)v[Q].apply(v,P)},events:{},on:function(w,v){var I,P=this;return(null===(I=this.events[w])||void 0===I?void 0:I.push(v))||(this.events[w]=[v]),function(){var I;P.events[w]=null===(I=P.events[w])||void 0===I?void 0:I.filter((function(w){return v!==w}))}}}}},10025:function(w,v,I){"use strict";var P=I(56690).default,u=I(89728).default;Object.defineProperty(v,"__esModule",{value:!0}),v.createSignal=v.EventEmitter=void 0;var Q=function(){function w(){P(this,w),this.handlers=[]}return u(w,[{key:"register",value:function(w){return this.handlers.push(w),this}},{key:"invoke",value:function(){for(var w=this,v=arguments.length,I=new Array(v),P=0;P<v;P++)I[P]=arguments[P];this.handlers.forEach((function(v){return v.apply(w,I)}))}},{key:"invokeAsync",value:function(){for(var w=this,v=arguments.length,I=new Array(v),P=0;P<v;P++)I[P]=arguments[P];return Promise.all(this.handlers.map((function(v){return v.apply(w,I)})))}},{key:"remove",value:function(w){var v=this.handlers.indexOf(w);this.handlers[v]=this.handlers[this.handlers.length-1],this.handlers.pop()}},{key:"clear",value:function(){this.handlers=[]}}]),w}();v.EventEmitter=Q,v.createSignal=function(){var w=new Q;function v(v){return w.register(v,null===this)}return v.once=function(v){w.register((function I(){for(var P=arguments.length,u=new Array(P),Q=0;Q<P;Q++)u[Q]=arguments[Q];v.apply(this,u),w.remove(I)}))},v.remove=function(v){return w.remove(v)},v.invoke=function(){return w.invoke.apply(w,arguments)},v.invokeAsync=function(){return w.invokeAsync.apply(w,arguments)},v.clear=function(){return w.clear()},v}},33739:function(w,v,I){"use strict";var P=I(89728).default,u=I(56690).default,Q=I(61655).default,K=I(26389).default,a=I(33496).default;Object.defineProperty(v,"__esModule",{value:!0}),v.ServerError=v.CloseCode=void 0,function(w){w[w.CONSENTED=4e3]="CONSENTED",w[w.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(v.CloseCode||(v.CloseCode={}));var U=function(w){Q(I,w);var v=K(I);function I(w,P){var Q;return u(this,I),(Q=v.call(this,P)).name="ServerError",Q.code=w,Q}return P(I)}(a(Error));v.ServerError=U},21021:function(w,v,I){"use strict";v.d=void 0,I(80876);var P=I(90442);Object.defineProperty(v,"d",{enumerable:!0,get:function(){return P.Client}});var u=I(65211);var Q=I(62898);var K=I(37981);var a=I(74042);var U=I(94183),p=I(40765);(0,p.registerSerializer)("schema",a.SchemaSerializer),(0,p.registerSerializer)("none",U.NoneSerializer)},80876:function(){ArrayBuffer.isView||(ArrayBuffer.isView=function(w){return null!==w&&"object"===typeof w&&w.buffer instanceof ArrayBuffer}),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},61627:function(w,v){"use strict";function I(w,v){if(this._offset=v,w instanceof ArrayBuffer)this._buffer=w,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(w))throw new Error("Invalid argument");this._buffer=w.buffer,this._view=new DataView(this._buffer,w.byteOffset,w.byteLength)}}Object.defineProperty(v,"__esModule",{value:!0}),v.decode=v.encode=void 0,I.prototype._array=function(w){for(var v=new Array(w),I=0;I<w;I++)v[I]=this._parse();return v},I.prototype._map=function(w){for(var v={},I=0;I<w;I++)v[this._parse()]=this._parse();return v},I.prototype._str=function(w){var v=function(w,v,I){for(var P="",u=0,Q=v,K=v+I;Q<K;Q++){var a=w.getUint8(Q);if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(u=(7&a)<<18|(63&w.getUint8(++Q))<<12|(63&w.getUint8(++Q))<<6|(63&w.getUint8(++Q))<<0)>=65536?(u-=65536,P+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):P+=String.fromCharCode(u)}else P+=String.fromCharCode((15&a)<<12|(63&w.getUint8(++Q))<<6|(63&w.getUint8(++Q))<<0);else P+=String.fromCharCode((31&a)<<6|63&w.getUint8(++Q));else P+=String.fromCharCode(a)}return P}(this._view,this._offset,w);return this._offset+=w,v},I.prototype._bin=function(w){var v=this._buffer.slice(this._offset,this._offset+w);return this._offset+=w,v},I.prototype._parse=function(){var w,v=this._view.getUint8(this._offset++),I=0,P=0,u=0,Q=0;if(v<192)return v<128?v:v<144?this._map(15&v):v<160?this._array(15&v):this._str(31&v);if(v>223)return-1*(255-v+1);switch(v){case 192:return null;case 194:return!1;case 195:return!0;case 196:return I=this._view.getUint8(this._offset),this._offset+=1,this._bin(I);case 197:return I=this._view.getUint16(this._offset),this._offset+=2,this._bin(I);case 198:return I=this._view.getUint32(this._offset),this._offset+=4,this._bin(I);case 199:if(I=this._view.getUint8(this._offset),P=this._view.getInt8(this._offset+1),this._offset+=2,-1===P){var K=this._view.getUint32(this._offset);return u=this._view.getInt32(this._offset+4),Q=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*u+Q)+K/1e6)}return[P,this._bin(I)];case 200:return I=this._view.getUint16(this._offset),P=this._view.getInt8(this._offset+2),this._offset+=3,[P,this._bin(I)];case 201:return I=this._view.getUint32(this._offset),P=this._view.getInt8(this._offset+4),this._offset+=5,[P,this._bin(I)];case 202:return w=this._view.getFloat32(this._offset),this._offset+=4,w;case 203:return w=this._view.getFloat64(this._offset),this._offset+=8,w;case 204:return w=this._view.getUint8(this._offset),this._offset+=1,w;case 205:return w=this._view.getUint16(this._offset),this._offset+=2,w;case 206:return w=this._view.getUint32(this._offset),this._offset+=4,w;case 207:return u=this._view.getUint32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,u+Q;case 208:return w=this._view.getInt8(this._offset),this._offset+=1,w;case 209:return w=this._view.getInt16(this._offset),this._offset+=2,w;case 210:return w=this._view.getInt32(this._offset),this._offset+=4,w;case 211:return u=this._view.getInt32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,u+Q;case 212:return P=this._view.getInt8(this._offset),this._offset+=1,0===P?void(this._offset+=1):[P,this._bin(1)];case 213:return P=this._view.getInt8(this._offset),this._offset+=1,[P,this._bin(2)];case 214:return P=this._view.getInt8(this._offset),this._offset+=1,-1===P?(w=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*w)):[P,this._bin(4)];case 215:return P=this._view.getInt8(this._offset),this._offset+=1,0===P?(u=this._view.getInt32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(u+Q)):-1===P?(u=this._view.getUint32(this._offset),Q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&u)+Q)+(u>>>2)/1e6)):[P,this._bin(8)];case 216:return P=this._view.getInt8(this._offset),this._offset+=1,[P,this._bin(16)];case 217:return I=this._view.getUint8(this._offset),this._offset+=1,this._str(I);case 218:return I=this._view.getUint16(this._offset),this._offset+=2,this._str(I);case 219:return I=this._view.getUint32(this._offset),this._offset+=4,this._str(I);case 220:return I=this._view.getUint16(this._offset),this._offset+=2,this._array(I);case 221:return I=this._view.getUint32(this._offset),this._offset+=4,this._array(I);case 222:return I=this._view.getUint16(this._offset),this._offset+=2,this._map(I);case 223:return I=this._view.getUint32(this._offset),this._offset+=4,this._map(I)}throw new Error("Could not parse")},v.decode=function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=new I(w,v),u=P._parse();if(P._offset!==w.byteLength)throw new Error(w.byteLength-P._offset+" trailing bytes");return u};function P(w,v,I){for(var P=0,u=0,Q=I.length;u<Q;u++)(P=I.charCodeAt(u))<128?w.setUint8(v++,P):P<2048?(w.setUint8(v++,192|P>>6),w.setUint8(v++,128|63&P)):P<55296||P>=57344?(w.setUint8(v++,224|P>>12),w.setUint8(v++,128|P>>6&63),w.setUint8(v++,128|63&P)):(u++,P=65536+((1023&P)<<10|1023&I.charCodeAt(u)),w.setUint8(v++,240|P>>18),w.setUint8(v++,128|P>>12&63),w.setUint8(v++,128|P>>6&63),w.setUint8(v++,128|63&P))}function u(w,v,I){var P=typeof I,Q=0,K=0,a=0,U=0,p=0,r=0;if("string"===P){if(p=function(w){for(var v=0,I=0,P=0,u=w.length;P<u;P++)(v=w.charCodeAt(P))<128?I+=1:v<2048?I+=2:v<55296||v>=57344?I+=3:(P++,I+=4);return I}(I),p<32)w.push(160|p),r=1;else if(p<256)w.push(217,p),r=2;else if(p<65536)w.push(218,p>>8,p),r=3;else{if(!(p<4294967296))throw new Error("String too long");w.push(219,p>>24,p>>16,p>>8,p),r=5}return v.push({_str:I,_length:p,_offset:w.length}),r+p}if("number"===P)return Math.floor(I)===I&&isFinite(I)?I>=0?I<128?(w.push(I),1):I<256?(w.push(204,I),2):I<65536?(w.push(205,I>>8,I),3):I<4294967296?(w.push(206,I>>24,I>>16,I>>8,I),5):(a=I/Math.pow(2,32)>>0,U=I>>>0,w.push(207,a>>24,a>>16,a>>8,a,U>>24,U>>16,U>>8,U),9):I>=-32?(w.push(I),1):I>=-128?(w.push(208,I),2):I>=-32768?(w.push(209,I>>8,I),3):I>=-2147483648?(w.push(210,I>>24,I>>16,I>>8,I),5):(a=Math.floor(I/Math.pow(2,32)),U=I>>>0,w.push(211,a>>24,a>>16,a>>8,a,U>>24,U>>16,U>>8,U),9):(w.push(203),v.push({_float:I,_length:8,_offset:w.length}),9);if("object"===P){if(null===I)return w.push(192),1;if(Array.isArray(I)){if((p=I.length)<16)w.push(144|p),r=1;else if(p<65536)w.push(220,p>>8,p),r=3;else{if(!(p<4294967296))throw new Error("Array too large");w.push(221,p>>24,p>>16,p>>8,p),r=5}for(Q=0;Q<p;Q++)r+=u(w,v,I[Q]);return r}if(I instanceof Date){var Y=I.getTime(),g=Math.floor(Y/1e3),J=1e6*(Y-1e3*g);return g>=0&&J>=0&&g<=17179869183?0===J&&g<=4294967295?(w.push(214,255,g>>24,g>>16,g>>8,g),6):(a=g/4294967296,U=4294967295&g,w.push(215,255,J>>22,J>>14,J>>6,a,U>>24,U>>16,U>>8,U),10):(a=Math.floor(g/4294967296),U=g>>>0,w.push(199,12,255,J>>24,J>>16,J>>8,J,a>>24,a>>16,a>>8,a,U>>24,U>>16,U>>8,U),15)}if(I instanceof ArrayBuffer){if((p=I.byteLength)<256)w.push(196,p),r=2;else if(p<65536)w.push(197,p>>8,p),r=3;else{if(!(p<4294967296))throw new Error("Buffer too large");w.push(198,p>>24,p>>16,p>>8,p),r=5}return v.push({_bin:I,_length:p,_offset:w.length}),r+p}if("function"===typeof I.toJSON)return u(w,v,I.toJSON());var l=[],R="",x=Object.keys(I);for(Q=0,K=x.length;Q<K;Q++)void 0!==I[R=x[Q]]&&"function"!==typeof I[R]&&l.push(R);if((p=l.length)<16)w.push(128|p),r=1;else if(p<65536)w.push(222,p>>8,p),r=3;else{if(!(p<4294967296))throw new Error("Object too large");w.push(223,p>>24,p>>16,p>>8,p),r=5}for(Q=0;Q<p;Q++)r+=u(w,v,R=l[Q]),r+=u(w,v,I[R]);return r}if("boolean"===P)return w.push(I?195:194),1;if("undefined"===P)return w.push(192),1;if("function"===typeof I.toJSON)return u(w,v,I.toJSON());throw new Error("Could not encode")}v.encode=function(w){var v=[],I=[],Q=u(v,I,w),K=new ArrayBuffer(Q),a=new DataView(K),U=0,p=0,r=-1;I.length>0&&(r=I[0]._offset);for(var Y,g=0,J=0,l=0,R=v.length;l<R;l++)if(a.setUint8(p+l,v[l]),l+1===r){if(g=(Y=I[U])._length,J=p+r,Y._bin)for(var x=new Uint8Array(Y._bin),j=0;j<g;j++)a.setUint8(J+j,x[j]);else Y._str?P(a,J,Y._str):void 0!==Y._float&&a.setFloat64(J,Y._float);p+=g,I[++U]&&(r=I[U]._offset)}return K}},94183:function(w,v,I){"use strict";var P=I(56690).default,u=I(89728).default;Object.defineProperty(v,"__esModule",{value:!0}),v.NoneSerializer=void 0;var Q=function(){function w(){P(this,w)}return u(w,[{key:"setState",value:function(w){}},{key:"getState",value:function(){return null}},{key:"patch",value:function(w){}},{key:"teardown",value:function(){}},{key:"handshake",value:function(w){}}]),w}();v.NoneSerializer=Q},74042:function(w,v,I){"use strict";var P=I(56690).default,u=I(89728).default;Object.defineProperty(v,"__esModule",{value:!0}),v.SchemaSerializer=void 0;var Q=I(50061),K=function(){function w(){P(this,w)}return u(w,[{key:"setState",value:function(w){return this.state.decode(w)}},{key:"getState",value:function(){return this.state}},{key:"patch",value:function(w){return this.state.decode(w)}},{key:"teardown",value:function(){var w,v;null===(v=null===(w=this.state)||void 0===w?void 0:w.$changes)||void 0===v||v.root.clearRefs()}},{key:"handshake",value:function(w,v){this.state?(new Q.Reflection).decode(w,v):this.state=Q.Reflection.decode(w,v)}}]),w}();v.SchemaSerializer=K},40765:function(w,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.getSerializer=v.registerSerializer=void 0;var I={};v.registerSerializer=function(w,v){I[w]=v},v.getSerializer=function(w){var v=I[w];if(!v)throw new Error("missing serializer: "+w);return v}},52054:function(w,v,I){"use strict";var P=I(56690).default,u=I(89728).default,Q=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(v,"__esModule",{value:!0}),v.WebSocketTransport=void 0;var K=Q(I(32299)),a=globalThis.WebSocket||K.default,U=function(){function w(v){P(this,w),this.events=v}return u(w,[{key:"send",value:function(w){w instanceof ArrayBuffer?this.ws.send(w):Array.isArray(w)&&this.ws.send(new Uint8Array(w).buffer)}},{key:"connect",value:function(w){this.ws=new a(w,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}},{key:"close",value:function(w,v){this.ws.close(w,v)}},{key:"isOpen",get:function(){return this.ws.readyState===a.OPEN}}]),w}();v.WebSocketTransport=U},32299:function(w){"use strict";w.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},28638:function(w){"use strict";function v(w,I,P){var u=0|w[P];if(u<=0)return[];var Q,K=new Array(u);if(P===w.length-1)for(Q=0;Q<u;++Q)K[Q]=I;else for(Q=0;Q<u;++Q)K[Q]=v(w,I,P+1);return K}w.exports=function(w,I){switch("undefined"===typeof I&&(I=0),typeof w){case"number":if(w>0)return function(w,v){var I,P;for(I=new Array(w),P=0;P<w;++P)I[P]=v;return I}(0|w,I);break;case"object":if("number"===typeof w.length)return v(w,I,0)}return[]}},6547:function(w,v,I){w.exports=function(){var w=this;this.components={},this.comps=this.components;var v=this.components,I=1,u={},Q=[],K=[],a={timeout:!1,removals:[],multiComps:[]};function U(w,I){var P=v[I],Q=u[I],K=Q.hash[w];K&&(Q.remove(w),P.onRemove&&(P.multi?(K.forEach((function(v){v&&P.onRemove(w,v)})),K.length=0):P.onRemove(w,K)),a.removals.push(Q),p())}function p(){a.timeout||(a.timeout=!0,setTimeout(r,1))}function r(){a.timeout=!1,Y()}function Y(){a.multiComps.length&&function(w){for(var v=0;v<w.length;v++){var I=w[v],P=I.entID,u=I.data,Q=u.hash[P];if(Q){for(var K=0;K<Q.length;K++)Q[K]||(Q.splice(K,1),K--);0===Q.length&&(u.remove(P),a.removals.push(u))}}w.length=0}(a.multiComps),a.removals.length&&function(w){for(var v=0;v<w.length;v++){w[v].flush()}w.length=0}(a.removals)}this._storage=u,this._systems=Q,this._renderSystems=K,this.createEntity=function(v){var P=I++;return Array.isArray(v)&&v.forEach((function(v){return w.addComponent(P,v)})),P},this.deleteEntity=function(v){return Object.keys(u).forEach((function(w){u[w].hash[v]&&U(v,w)})),w},this.createComponent=function(w){if(!w)throw new Error("Missing component definition");var I=w.name;if(!I)throw new Error("Component definition must have a name property.");if("string"!==typeof I)throw new Error("Component name must be a string.");if(""===I)throw new Error("Component name must be a non-empty string.");if(u[I])throw new Error("Component ".concat(I," already exists."));var a={};return a.name=I,a.multi=!!w.multi,a.order=isNaN(w.order)?99:w.order,a.stateConstructor=w.stateConstructor||null,a.state=w.state||{},a.onAdd=w.onAdd||null,a.onRemove=w.onRemove||null,a.system=w.system||null,a.renderSystem=w.renderSystem||null,v[I]=a,u[I]=new P,u[I]._pendingMultiCleanup=!1,u[I]._multiCleanupIDs=a.multi?[]:null,a.system&&(Q.push(I),Q.sort((function(w,I){return v[w].order-v[I].order}))),a.renderSystem&&(K.push(I),K.sort((function(w,I){return v[w].order-v[I].order}))),I},this.overwriteComponent=function(w,I){var P=v[w];if(!P)throw new Error("Unknown component: ".concat(w));if(!I)throw new Error("Missing component definition");if(P.name!==I.name)throw new Error("Overwriting component must use the same name property.");var a={};a.name=w,a.multi=!!I.multi,a.order=isNaN(I.order)?99:I.order,a.state=I.state||{},a.onAdd=I.onAdd||null,a.onRemove=I.onRemove||null,a.system=I.system||null,a.renderSystem=I.renderSystem||null,v[w]=a,u[w]._pendingMultiCleanup=!1,u[w]._multiCleanupIDs=a.multi?[]:null;var U=Q.indexOf(w);a.system&&U<0&&Q.push(w),!a.system&&U>=0&&Q.splice(U,1),Q.sort((function(w,I){return v[w].order-v[I].order}));var p=K.indexOf(w);a.renderSystem&&p<0&&K.push(w),!a.renderSystem&&p>=0&&K.splice(p,1),K.sort((function(w,I){return v[w].order-v[I].order}));var r=a.state;return this.getStatesList(w).forEach((function(w){for(var v in r)v in w||(w[v]=r[v]);a.onAdd&&a.onAdd(w.__id,w)})),w},this.deleteComponent=function(I){var P=u[I];if(!P)throw new Error("Unknown component: ".concat(I));P.flush(),P.list.forEach((function(w){w&&U(w.__id||w[0].__id,I)}));var a=Q.indexOf(I),p=K.indexOf(I);return a>-1&&Q.splice(a,1),p>-1&&K.splice(p,1),u[I].dispose(),delete u[I],delete v[I],w},this.addComponent=function(w,I,P){var Q,K=v[I],a=u[I];if(!a)throw new Error("Unknown component: ".concat(I,"."));if(a.hash[w]&&!K.multi)throw new Error("Entity ".concat(w," already has component: ").concat(I,"."));if(K.stateConstructor){if(!(Q=new K.stateConstructor).hasOwnProperty("__id"))throw new Error("Component ".concat(K.name," stateConstructor type does not have property __id"))}else Q=Object.assign({},{__id:w},K.state,P);if(Q.__id=w,K.multi){var U=a.hash[w];U||(U=[],a.add(w,U)),U.push(Q)}else a.add(w,Q);return K.onAdd&&K.onAdd(w,Q),this},this.hasComponent=function(w,v){var I=u[v];if(!I)throw new Error("Unknown component: ".concat(v,"."));return!!I.hash[w]},this.removeComponent=function(v,I){if(!u[I])throw new Error("Unknown component: ".concat(I,"."));return U(v,I),w},this.getState=function(w,v){var I=u[v];if(!I)throw new Error("Unknown component: ".concat(v,"."));return I.hash[w]},this.getStatesList=function(w){var v=u[w];if(!v)throw new Error("Unknown component: ".concat(w,"."));return Y(),v.list},this.getStateAccessor=function(w){if(!u[w])throw new Error("Unknown component: ".concat(w,"."));var v=u[w].hash;return function(w){return v[w]}},this.getComponentAccessor=function(w){if(!u[w])throw new Error("Unknown component: ".concat(w,"."));var v=u[w].hash;return function(w){return!!v[w]}},this.tick=function(I){Y();for(var P=0;P<Q.length;P++){var K=Q[P],a=v[K],U=u[K];a.system(I,U.list),Y()}return w},this.render=function(I){Y();for(var P=0;P<K.length;P++){var Q=K[P],a=v[Q],U=u[Q];a.renderSystem(I,U.list),Y()}return w},this.removeMultiComponent=function(I,P,Q){var K=v[P],U=u[P];if(!U)throw new Error("Unknown component: ".concat(P,"."));if(!K.multi)throw new Error("removeMultiComponent called on non-multi component");return function(w,v,I,P){var u=I.hash[w];if(u){var Q=u[P];Q&&(u[P]=null,v.onRemove&&v.onRemove(w,Q),a.multiComps.push({entID:w,data:I}),p())}}(I,K,U,Q),w}};var P=I(65410)},65410:function(w,v,I){var P=I(56690).default,u=I(89728).default;function Q(w,v){var I=w._map[v];if(delete w.hash[v],delete w._map[v],I===w.list.length-1)w.list.pop();else{var P=w.list.pop();if(w.list[I]=P,null===P||null===P[0]){var u=w.list.length;for(var Q in w._map)if(w._map[Q]===u)return void(w._map[Q]=I)}else{var K=P.__id||P[0].__id;w._map[K]=I}}}w.exports=function(){"use strict";function w(){P(this,w),this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}return u(w,[{key:"add",value:function(w,v){if("number"===typeof this._map[w]){var I=this._map[w];this.hash[w]=v,this.list[I]=v}else this._map[w]=this.list.length,this.hash[w]=v,this.list.push(v)}},{key:"remove",value:function(w){var v=this._map[w];this.hash[w]=null,this.list[v]=null,this._pendingRemovals.push(w)}},{key:"dispose",value:function(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}},{key:"flush",value:function(){for(var w=0;w<this._pendingRemovals.length;w++){var v=this._pendingRemovals[w];null===this.hash[v]&&Q(this,v)}this._pendingRemovals.length=0}}]),w}()},97413:function(w){"use strict";w.exports=function(w,v,I,P,u,Q){var K=+v[0],a=+v[1],U=+v[2],p=+I[0],r=+I[1],Y=+I[2],g=Math.sqrt(p*p+r*r+Y*Y);if(0===g)throw new Error("Can't raycast along a zero vector");return function(w,v,I,P,u,Q,K,a,U,p){for(var r=0,Y=Math.floor,g=0|Y(v),J=0|Y(I),l=0|Y(P),R=u>0?1:-1,x=Q>0?1:-1,j=K>0?1:-1,s=Math.abs(1/u),B=Math.abs(1/Q),t=Math.abs(1/K),i=s<1/0?s*(R>0?g+1-v:v-g):1/0,z=B<1/0?B*(x>0?J+1-I:I-J):1/0,E=t<1/0?t*(j>0?l+1-P:P-l):1/0,o=-1;r<=a;){var h=w(g,J,l);if(h)return U&&(U[0]=v+r*u,U[1]=I+r*Q,U[2]=P+r*K),p&&(p[0]=p[1]=p[2]=0,0===o&&(p[0]=-R),1===o&&(p[1]=-x),2===o&&(p[2]=-j)),h;i<z?i<E?(g+=R,r=i,i+=s,o=0):(l+=j,r=E,E+=t,o=2):z<E?(J+=x,r=z,z+=B,o=1):(l+=j,r=E,E+=t,o=2)}return U&&(U[0]=v+r*u,U[1]=I+r*Q,U[2]=P+r*K),p&&(p[0]=p[1]=p[2]=0),0}(w,K,a,U,p/=g,r/=g,Y/=g,P="undefined"===typeof P?64:+P,u,Q)}},69113:function(w,v,I){"use strict";var P=P||function(w,v){var I={},P=I.lib={},u=function(){},Q=P.Base={extend:function(w){u.prototype=this;var v=new u;return w&&v.mixIn(w),v.hasOwnProperty("init")||(v.init=function(){v.$super.init.apply(this,arguments)}),v.init.prototype=v,v.$super=this,v},create:function(){var w=this.extend();return w.init.apply(w,arguments),w},init:function(){},mixIn:function(w){for(var v in w)w.hasOwnProperty(v)&&(this[v]=w[v]);w.hasOwnProperty("toString")&&(this.toString=w.toString)},clone:function(){return this.init.prototype.extend(this)}},K=P.WordArray=Q.extend({init:function(w,v){w=this.words=w||[],this.sigBytes=undefined!=v?v:4*w.length},toString:function(w){return(w||U).stringify(this)},concat:function(w){var v=this.words,I=w.words,P=this.sigBytes;if(w=w.sigBytes,this.clamp(),P%4)for(var u=0;u<w;u++)v[P+u>>>2]|=(I[u>>>2]>>>24-u%4*8&255)<<24-(P+u)%4*8;else if(65535<I.length)for(u=0;u<w;u+=4)v[P+u>>>2]=I[u>>>2];else v.push.apply(v,I);return this.sigBytes+=w,this},clamp:function(){var v=this.words,I=this.sigBytes;v[I>>>2]&=4294967295<<32-I%4*8,v.length=w.ceil(I/4)},clone:function(){var w=Q.clone.call(this);return w.words=this.words.slice(0),w},random:function(v){for(var I=[],P=0;P<v;P+=4)I.push(4294967296*w.random()|0);return new K.init(I,v)}}),a=I.enc={},U=a.Hex={stringify:function(w){var v=w.words;w=w.sigBytes;for(var I=[],P=0;P<w;P++){var u=v[P>>>2]>>>24-P%4*8&255;I.push((u>>>4).toString(16)),I.push((15&u).toString(16))}return I.join("")},parse:function(w){for(var v=w.length,I=[],P=0;P<v;P+=2)I[P>>>3]|=parseInt(w.substr(P,2),16)<<24-P%8*4;return new K.init(I,v/2)}},p=a.Latin1={stringify:function(w){var v=w.words;w=w.sigBytes;for(var I=[],P=0;P<w;P++)I.push(String.fromCharCode(v[P>>>2]>>>24-P%4*8&255));return I.join("")},parse:function(w){for(var v=w.length,I=[],P=0;P<v;P++)I[P>>>2]|=(255&w.charCodeAt(P))<<24-P%4*8;return new K.init(I,v)}},r=a.Utf8={stringify:function(w){try{return decodeURIComponent(escape(p.stringify(w)))}catch(w){throw Error("Malformed UTF-8 data")}},parse:function(w){return p.parse(unescape(encodeURIComponent(w)))}},Y=P.BufferedBlockAlgorithm=Q.extend({reset:function(){this._data=new K.init,this._nDataBytes=0},_append:function(w){"string"==typeof w&&(w=r.parse(w)),this._data.concat(w),this._nDataBytes+=w.sigBytes},_process:function(v){var I=this._data,P=I.words,u=I.sigBytes,Q=this.blockSize,a=u/(4*Q);if(v=(a=v?w.ceil(a):w.max((0|a)-this._minBufferSize,0))*Q,u=w.min(4*v,u),v){for(var U=0;U<v;U+=Q)this._doProcessBlock(P,U);U=P.splice(0,v),I.sigBytes-=u}return new K.init(U,u)},clone:function(){var w=Q.clone.call(this);return w._data=this._data.clone(),w},_minBufferSize:0});P.Hasher=Y.extend({cfg:Q.extend(),init:function(w){this.cfg=this.cfg.extend(w),this.reset()},reset:function(){Y.reset.call(this),this._doReset()},update:function(w){return this._append(w),this._process(),this},finalize:function(w){return w&&this._append(w),this._doFinalize()},blockSize:16,_createHelper:function(w){return function(v,I){return new w.init(I).finalize(v)}},_createHmacHelper:function(w){return function(v,I){return new g.HMAC.init(w,I).finalize(v)}}});var g=I.algo={};return I}(Math);!function(w){for(var v=P,I=(Q=v.lib).WordArray,u=Q.Hasher,Q=v.algo,K=[],a=[],U=function(w){return 4294967296*(w-(0|w))|0},p=2,r=0;64>r;){var Y;w:{Y=p;for(var g=w.sqrt(Y),J=2;J<=g;J++)if(!(Y%J)){Y=!1;break w}Y=!0}Y&&(8>r&&(K[r]=U(w.pow(p,.5))),a[r]=U(w.pow(p,1/3)),r++),p++}var l=[];Q=Q.SHA256=u.extend({_doReset:function(){this._hash=new I.init(K.slice(0))},_doProcessBlock:function(w,v){for(var I=this._hash.words,P=I[0],u=I[1],Q=I[2],K=I[3],U=I[4],p=I[5],r=I[6],Y=I[7],g=0;64>g;g++){if(16>g)l[g]=0|w[v+g];else{var J=l[g-15],R=l[g-2];l[g]=((J<<25|J>>>7)^(J<<14|J>>>18)^J>>>3)+l[g-7]+((R<<15|R>>>17)^(R<<13|R>>>19)^R>>>10)+l[g-16]}J=Y+((U<<26|U>>>6)^(U<<21|U>>>11)^(U<<7|U>>>25))+(U&p^~U&r)+a[g]+l[g],R=((P<<30|P>>>2)^(P<<19|P>>>13)^(P<<10|P>>>22))+(P&u^P&Q^u&Q),Y=r,r=p,p=U,U=K+J|0,K=Q,Q=u,u=P,P=J+R|0}I[0]=I[0]+P|0,I[1]=I[1]+u|0,I[2]=I[2]+Q|0,I[3]=I[3]+K|0,I[4]=I[4]+U|0,I[5]=I[5]+p|0,I[6]=I[6]+r|0,I[7]=I[7]+Y|0},_doFinalize:function(){var v=this._data,I=v.words,P=8*this._nDataBytes,u=8*v.sigBytes;return I[u>>>5]|=128<<24-u%32,I[14+(u+64>>>9<<4)]=w.floor(P/4294967296),I[15+(u+64>>>9<<4)]=P,v.sigBytes=4*I.length,this._process(),this._hash},clone:function(){var w=u.clone.call(this);return w._hash=this._hash.clone(),w}});v.SHA256=u._createHelper(Q),v.HmacSHA256=u._createHmacHelper(Q)}(Math),function(){var w=P,v=w.enc.Utf8;w.algo.HMAC=w.lib.Base.extend({init:function(w,I){w=this._hasher=new w.init,"string"==typeof I&&(I=v.parse(I));var P=w.blockSize,u=4*P;I.sigBytes>u&&(I=w.finalize(I)),I.clamp();for(var Q=this._oKey=I.clone(),K=this._iKey=I.clone(),a=Q.words,U=K.words,p=0;p<P;p++)a[p]^=1549556828,U[p]^=909522486;Q.sigBytes=K.sigBytes=u,this.reset()},reset:function(){var w=this._hasher;w.reset(),w.update(this._iKey)},update:function(w){return this._hasher.update(w),this},finalize:function(w){var v=this._hasher;return w=v.finalize(w),v.reset(),v.finalize(this._oKey.clone().concat(w))}})}(),function(){var w=P,v=w.lib.WordArray;w.enc.Base64={stringify:function(w){var v=w.words,I=w.sigBytes,P=this._map;w.clamp(),w=[];for(var u=0;u<I;u+=3)for(var Q=(v[u>>>2]>>>24-u%4*8&255)<<16|(v[u+1>>>2]>>>24-(u+1)%4*8&255)<<8|v[u+2>>>2]>>>24-(u+2)%4*8&255,K=0;4>K&&u+.75*K<I;K++)w.push(P.charAt(Q>>>6*(3-K)&63));if(v=P.charAt(64))for(;w.length%4;)w.push(v);return w.join("")},parse:function(w){var I=w.length,P=this._map;(u=P.charAt(64))&&(-1!=(u=w.indexOf(u))&&(I=u));for(var u=[],Q=0,K=0;K<I;K++)if(K%4){var a=P.indexOf(w.charAt(K-1))<<K%4*2,U=P.indexOf(w.charAt(K))>>>6-K%4*2;u[Q>>>2]|=(a|U)<<24-Q%4*8,Q++}return v.create(u,Q)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(w){!function(w){w[w.Undefined=0]="Undefined",w[w.Debug=1]="Debug",w[w.Info=2]="Info",w[w.Warning=3]="Warning",w[w.Error=4]="Error",w[w.Critical=5]="Critical"}(w.EGAErrorSeverity||(w.EGAErrorSeverity={})),function(w){w[w.Undefined=0]="Undefined",w[w.Start=1]="Start",w[w.Complete=2]="Complete",w[w.Fail=3]="Fail"}(w.EGAProgressionStatus||(w.EGAProgressionStatus={})),function(w){w[w.Undefined=0]="Undefined",w[w.Source=1]="Source",w[w.Sink=2]="Sink"}(w.EGAResourceFlowType||(w.EGAResourceFlowType={})),function(w){w[w.Undefined=0]="Undefined",w[w.Clicked=1]="Clicked",w[w.Show=2]="Show",w[w.FailedShow=3]="FailedShow",w[w.RewardReceived=4]="RewardReceived"}(w.EGAAdAction||(w.EGAAdAction={})),function(w){w[w.Undefined=0]="Undefined",w[w.Unknown=1]="Unknown",w[w.Offline=2]="Offline",w[w.NoFill=3]="NoFill",w[w.InternalError=4]="InternalError",w[w.InvalidRequest=5]="InvalidRequest",w[w.UnableToPrecache=6]="UnableToPrecache"}(w.EGAAdError||(w.EGAAdError={})),function(w){w[w.Undefined=0]="Undefined",w[w.Video=1]="Video",w[w.RewardedVideo=2]="RewardedVideo",w[w.Playable=3]="Playable",w[w.Interstitial=4]="Interstitial",w[w.OfferWall=5]="OfferWall",w[w.Banner=6]="Banner"}(w.EGAAdType||(w.EGAAdType={})),function(w){!function(w){w[w.NoResponse=0]="NoResponse",w[w.BadResponse=1]="BadResponse",w[w.RequestTimeout=2]="RequestTimeout",w[w.JsonEncodeFailed=3]="JsonEncodeFailed",w[w.JsonDecodeFailed=4]="JsonDecodeFailed",w[w.InternalServerError=5]="InternalServerError",w[w.BadRequest=6]="BadRequest",w[w.Unauthorized=7]="Unauthorized",w[w.UnknownResponseCode=8]="UnknownResponseCode",w[w.Ok=9]="Ok",w[w.Created=10]="Created"}(w.EGAHTTPApiResponse||(w.EGAHTTPApiResponse={}))}(w.http||(w.http={})),function(w){!function(w){w[w.Undefined=0]="Undefined",w[w.EventValidation=1]="EventValidation",w[w.Database=2]="Database",w[w.Init=3]="Init",w[w.Http=4]="Http",w[w.Json=5]="Json"}(w.EGASdkErrorCategory||(w.EGASdkErrorCategory={})),function(w){w[w.Undefined=0]="Undefined",w[w.BusinessEvent=1]="BusinessEvent",w[w.ResourceEvent=2]="ResourceEvent",w[w.ProgressionEvent=3]="ProgressionEvent",w[w.DesignEvent=4]="DesignEvent",w[w.ErrorEvent=5]="ErrorEvent",w[w.InitHttp=9]="InitHttp",w[w.EventsHttp=10]="EventsHttp",w[w.ProcessEvents=11]="ProcessEvents",w[w.AddEventsToStore=12]="AddEventsToStore",w[w.AdEvent=20]="AdEvent"}(w.EGASdkErrorArea||(w.EGASdkErrorArea={})),function(w){w[w.Undefined=0]="Undefined",w[w.InvalidCurrency=1]="InvalidCurrency",w[w.InvalidShortString=2]="InvalidShortString",w[w.InvalidEventPartLength=3]="InvalidEventPartLength",w[w.InvalidEventPartCharacters=4]="InvalidEventPartCharacters",w[w.InvalidStore=5]="InvalidStore",w[w.InvalidFlowType=6]="InvalidFlowType",w[w.StringEmptyOrNull=7]="StringEmptyOrNull",w[w.NotFoundInAvailableCurrencies=8]="NotFoundInAvailableCurrencies",w[w.InvalidAmount=9]="InvalidAmount",w[w.NotFoundInAvailableItemTypes=10]="NotFoundInAvailableItemTypes",w[w.WrongProgressionOrder=11]="WrongProgressionOrder",w[w.InvalidEventIdLength=12]="InvalidEventIdLength",w[w.InvalidEventIdCharacters=13]="InvalidEventIdCharacters",w[w.InvalidProgressionStatus=15]="InvalidProgressionStatus",w[w.InvalidSeverity=16]="InvalidSeverity",w[w.InvalidLongString=17]="InvalidLongString",w[w.DatabaseTooLarge=18]="DatabaseTooLarge",w[w.DatabaseOpenOrCreate=19]="DatabaseOpenOrCreate",w[w.JsonError=25]="JsonError",w[w.FailHttpJsonDecode=29]="FailHttpJsonDecode",w[w.FailHttpJsonEncode=30]="FailHttpJsonEncode",w[w.InvalidAdAction=31]="InvalidAdAction",w[w.InvalidAdType=32]="InvalidAdType",w[w.InvalidString=33]="InvalidString"}(w.EGASdkErrorAction||(w.EGASdkErrorAction={})),function(w){w[w.Undefined=0]="Undefined",w[w.Currency=1]="Currency",w[w.CartType=2]="CartType",w[w.ItemType=3]="ItemType",w[w.ItemId=4]="ItemId",w[w.Store=5]="Store",w[w.FlowType=6]="FlowType",w[w.Amount=7]="Amount",w[w.Progression01=8]="Progression01",w[w.Progression02=9]="Progression02",w[w.Progression03=10]="Progression03",w[w.EventId=11]="EventId",w[w.ProgressionStatus=12]="ProgressionStatus",w[w.Severity=13]="Severity",w[w.Message=14]="Message",w[w.AdAction=15]="AdAction",w[w.AdType=16]="AdType",w[w.AdSdkName=17]="AdSdkName",w[w.AdPlacement=18]="AdPlacement"}(w.EGASdkErrorParameter||(w.EGASdkErrorParameter={}))}(w.events||(w.events={}))}(u||(u={}));var u;u.EGAErrorSeverity,u.EGAProgressionStatus,u.EGAResourceFlowType;!function(w){!function(w){var v;!function(w){w[w.Error=0]="Error",w[w.Warning=1]="Warning",w[w.Info=2]="Info",w[w.Debug=3]="Debug"}(v||(v={}));var I=function(){function w(){w.debugEnabled=!1}return w.setInfoLog=function(v){w.instance.infoLogEnabled=v},w.setVerboseLog=function(v){w.instance.infoLogVerboseEnabled=v},w.i=function(I){if(w.instance.infoLogEnabled){var P="Info/"+w.Tag+": "+I;w.instance.sendNotificationMessage(P,v.Info)}},w.w=function(I){var P="Warning/"+w.Tag+": "+I;w.instance.sendNotificationMessage(P,v.Warning)},w.e=function(I){var P="Error/"+w.Tag+": "+I;w.instance.sendNotificationMessage(P,v.Error)},w.ii=function(I){if(w.instance.infoLogVerboseEnabled){var P="Verbose/"+w.Tag+": "+I;w.instance.sendNotificationMessage(P,v.Info)}},w.d=function(I){if(w.debugEnabled){var P="Debug/"+w.Tag+": "+I;w.instance.sendNotificationMessage(P,v.Debug)}},w.prototype.sendNotificationMessage=function(w,I){switch(I){case v.Error:console.error(w);break;case v.Warning:console.warn(w);break;case v.Debug:"function"===typeof console.debug?console.debug(w):console.log(w);break;case v.Info:console.log(w)}},w.instance=new w,w.Tag="GameAnalytics",w}();w.GALogger=I}(w.logging||(w.logging={}))}(u||(u={})),function(w){!function(v){var I=w.logging.GALogger,u=function(){function w(){}return w.getHmac=function(w,v){var I=P.HmacSHA256(v,w);return P.enc.Base64.stringify(I)},w.stringMatch=function(w,v){return!(!w||!v)&&v.test(w)},w.joinStringArray=function(w,v){for(var I="",P=0,u=w.length;P<u;P++)P>0&&(I+=v),I+=w[P];return I},w.stringArrayContainsString=function(w,v){if(0===w.length)return!1;for(var I in w)if(w[I]===v)return!0;return!1},w.encode64=function(v){v=encodeURI(v);var I,P,u,Q,K,a="",U=0,p=0,r=0;do{u=(I=v.charCodeAt(r++))>>2,Q=(3&I)<<4|(P=v.charCodeAt(r++))>>4,K=(15&P)<<2|(U=v.charCodeAt(r++))>>6,p=63&U,isNaN(P)?K=p=64:isNaN(U)&&(p=64),a=a+w.keyStr.charAt(u)+w.keyStr.charAt(Q)+w.keyStr.charAt(K)+w.keyStr.charAt(p),I=P=U=0,u=Q=K=p=0}while(r<v.length);return a},w.decode64=function(v){var P,u,Q,K,a="",U=0,p=0,r=0;/[^A-Za-z0-9\+\/\=]/g.exec(v)&&I.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),v=v.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{P=w.keyStr.indexOf(v.charAt(r++))<<2|(Q=w.keyStr.indexOf(v.charAt(r++)))>>4,u=(15&Q)<<4|(K=w.keyStr.indexOf(v.charAt(r++)))>>2,U=(3&K)<<6|(p=w.keyStr.indexOf(v.charAt(r++))),a+=String.fromCharCode(P),64!=K&&(a+=String.fromCharCode(u)),64!=p&&(a+=String.fromCharCode(U)),P=u=U=0,Q=K=p=0}while(r<v.length);return decodeURI(a)},w.timeIntervalSince1970=function(){var w=new Date;return Math.round(w.getTime()/1e3)},w.createGuid=function(){return(w.s4()+w.s4()+"-"+w.s4()+"-4"+w.s4().substr(0,3)+"-"+w.s4()+"-"+w.s4()+w.s4()+w.s4()).toLowerCase()},w.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},w.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",w}();v.GAUtilities=u}(w.utilities||(w.utilities={}))}(u||(u={})),function(w){!function(v){var I=w.logging.GALogger,P=w.utilities.GAUtilities,u=w.events.EGASdkErrorCategory,Q=w.events.EGASdkErrorArea,K=w.events.EGASdkErrorAction,a=w.events.EGASdkErrorParameter,U=function(w,v,I,P,u){this.category=w,this.area=v,this.action=I,this.parameter=P,this.reason=u};v.ValidationResult=U;var p=function(){function v(){}return v.validateBusinessEvent=function(w,P,p,r,Y){return v.validateCurrency(w)?P<0?(I.w("Validation fail - business event - amount. Cannot be less than 0. Failed amount: "+P),new U(u.EventValidation,Q.BusinessEvent,K.InvalidAmount,a.Amount,P+"")):v.validateShortString(p,!0)?v.validateEventPartLength(r,!1)?v.validateEventPartCharacters(r)?v.validateEventPartLength(Y,!1)?v.validateEventPartCharacters(Y)?null:(I.w("Validation fail - business event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+Y),new U(u.EventValidation,Q.BusinessEvent,K.InvalidEventPartCharacters,a.ItemId,Y)):(I.w("Validation fail - business event - itemId. Cannot be (null), empty or above 64 characters. String: "+Y),new U(u.EventValidation,Q.BusinessEvent,K.InvalidEventPartLength,a.ItemId,Y)):(I.w("Validation fail - business event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+r),new U(u.EventValidation,Q.BusinessEvent,K.InvalidEventPartCharacters,a.ItemType,r)):(I.w("Validation fail - business event - itemType: Cannot be (null), empty or above 64 characters. String: "+r),new U(u.EventValidation,Q.BusinessEvent,K.InvalidEventPartLength,a.ItemType,r)):(I.w("Validation fail - business event - cartType. Cannot be above 32 length. String: "+p),new U(u.EventValidation,Q.BusinessEvent,K.InvalidShortString,a.CartType,p)):(I.w("Validation fail - business event - currency: Cannot be (null) and need to be A-Z, 3 characters and in the standard at openexchangerates.org. Failed currency: "+w),new U(u.EventValidation,Q.BusinessEvent,K.InvalidCurrency,a.Currency,w))},v.validateResourceEvent=function(p,r,Y,g,J,l,R){return p==w.EGAResourceFlowType.Undefined?(I.w("Validation fail - resource event - flowType: Invalid flow type."),new U(u.EventValidation,Q.ResourceEvent,K.InvalidFlowType,a.FlowType,"")):r?P.stringArrayContainsString(l,r)?Y>0?g?v.validateEventPartLength(g,!1)?v.validateEventPartCharacters(g)?P.stringArrayContainsString(R,g)?v.validateEventPartLength(J,!1)?v.validateEventPartCharacters(J)?null:(I.w("Validation fail - resource event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+J),new U(u.EventValidation,Q.ResourceEvent,K.InvalidEventPartCharacters,a.ItemId,J)):(I.w("Validation fail - resource event - itemId: Cannot be (null), empty or above 64 characters. String: "+J),new U(u.EventValidation,Q.ResourceEvent,K.InvalidEventPartLength,a.ItemId,J)):(I.w("Validation fail - resource event - itemType: Not found in list of pre-defined available resource itemTypes. String: "+g),new U(u.EventValidation,Q.ResourceEvent,K.NotFoundInAvailableItemTypes,a.ItemType,g)):(I.w("Validation fail - resource event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+g),new U(u.EventValidation,Q.ResourceEvent,K.InvalidEventPartCharacters,a.ItemType,g)):(I.w("Validation fail - resource event - itemType: Cannot be (null), empty or above 64 characters. String: "+g),new U(u.EventValidation,Q.ResourceEvent,K.InvalidEventPartLength,a.ItemType,g)):(I.w("Validation fail - resource event - itemType: Cannot be (null)"),new U(u.EventValidation,Q.ResourceEvent,K.StringEmptyOrNull,a.ItemType,"")):(I.w("Validation fail - resource event - amount: Float amount cannot be 0 or negative. Value: "+Y),new U(u.EventValidation,Q.ResourceEvent,K.InvalidAmount,a.Amount,Y+"")):(I.w("Validation fail - resource event - currency: Not found in list of pre-defined available resource currencies. String: "+r),new U(u.EventValidation,Q.ResourceEvent,K.NotFoundInAvailableCurrencies,a.Currency,r)):(I.w("Validation fail - resource event - currency: Cannot be (null)"),new U(u.EventValidation,Q.ResourceEvent,K.StringEmptyOrNull,a.Currency,""))},v.validateProgressionEvent=function(P,p,r,Y){if(P==w.EGAProgressionStatus.Undefined)return I.w("Validation fail - progression event: Invalid progression status."),new U(u.EventValidation,Q.ProgressionEvent,K.InvalidProgressionStatus,a.ProgressionStatus,"");if(Y&&!r&&p)return I.w("Validation fail - progression event: 03 found but 01+02 are invalid. Progression must be set as either 01, 01+02 or 01+02+03."),new U(u.EventValidation,Q.ProgressionEvent,K.WrongProgressionOrder,a.Undefined,p+":"+r+":"+Y);if(r&&!p)return I.w("Validation fail - progression event: 02 found but not 01. Progression must be set as either 01, 01+02 or 01+02+03"),new U(u.EventValidation,Q.ProgressionEvent,K.WrongProgressionOrder,a.Undefined,p+":"+r+":"+Y);if(!p)return I.w("Validation fail - progression event: progression01 not valid. Progressions must be set as either 01, 01+02 or 01+02+03"),new U(u.EventValidation,Q.ProgressionEvent,K.WrongProgressionOrder,a.Undefined,(p||"")+":"+(r||"")+":"+(Y||""));if(!v.validateEventPartLength(p,!1))return I.w("Validation fail - progression event - progression01: Cannot be (null), empty or above 64 characters. String: "+p),new U(u.EventValidation,Q.ProgressionEvent,K.InvalidEventPartLength,a.Progression01,p);if(!v.validateEventPartCharacters(p))return I.w("Validation fail - progression event - progression01: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+p),new U(u.EventValidation,Q.ProgressionEvent,K.InvalidEventPartCharacters,a.Progression01,p);if(r){if(!v.validateEventPartLength(r,!0))return I.w("Validation fail - progression event - progression02: Cannot be empty or above 64 characters. String: "+r),new U(u.EventValidation,Q.ProgressionEvent,K.InvalidEventPartLength,a.Progression02,r);if(!v.validateEventPartCharacters(r))return I.w("Validation fail - progression event - progression02: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+r),new U(u.EventValidation,Q.ProgressionEvent,K.InvalidEventPartCharacters,a.Progression02,r)}if(Y){if(!v.validateEventPartLength(Y,!0))return I.w("Validation fail - progression event - progression03: Cannot be empty or above 64 characters. String: "+Y),new U(u.EventValidation,Q.ProgressionEvent,K.InvalidEventPartLength,a.Progression03,Y);if(!v.validateEventPartCharacters(Y))return I.w("Validation fail - progression event - progression03: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+Y),new U(u.EventValidation,Q.ProgressionEvent,K.InvalidEventPartCharacters,a.Progression03,Y)}return null},v.validateDesignEvent=function(w){return v.validateEventIdLength(w)?v.validateEventIdCharacters(w)?null:(I.w("Validation fail - design event - eventId: Non valid characters. Only allowed A-z, 0-9, -_., ()!?. String: "+w),new U(u.EventValidation,Q.DesignEvent,K.InvalidEventIdCharacters,a.EventId,w)):(I.w("Validation fail - design event - eventId: Cannot be (null) or empty. Only 5 event parts allowed seperated by :. Each part need to be 32 characters or less. String: "+w),new U(u.EventValidation,Q.DesignEvent,K.InvalidEventIdLength,a.EventId,w))},v.validateErrorEvent=function(P,p){return P==w.EGAErrorSeverity.Undefined?(I.w("Validation fail - error event - severity: Severity was unsupported value."),new U(u.EventValidation,Q.ErrorEvent,K.InvalidSeverity,a.Severity,"")):v.validateLongString(p,!0)?null:(I.w("Validation fail - error event - message: Message cannot be above 8192 characters."),new U(u.EventValidation,Q.ErrorEvent,K.InvalidLongString,a.Message,p))},v.validateAdEvent=function(P,p,r,Y){return P==w.EGAAdAction.Undefined?(I.w("Validation fail - error event - severity: Severity was unsupported value."),new U(u.EventValidation,Q.AdEvent,K.InvalidAdAction,a.AdAction,"")):p==w.EGAAdType.Undefined?(I.w("Validation fail - ad event - adType: Ad type was unsupported value."),new U(u.EventValidation,Q.AdEvent,K.InvalidAdType,a.AdType,"")):v.validateShortString(r,!1)?v.validateString(Y,!1)?null:(I.w("Validation fail - ad event - message: Ad placement cannot be above 64 characters."),new U(u.EventValidation,Q.AdEvent,K.InvalidString,a.AdPlacement,Y)):(I.w("Validation fail - ad event - message: Ad SDK name cannot be above 32 characters."),new U(u.EventValidation,Q.AdEvent,K.InvalidShortString,a.AdSdkName,r))},v.validateSdkErrorEvent=function(w,P,a,U,p){return!!v.validateKeys(w,P)&&(a===u.Undefined?(I.w("Validation fail - sdk error event - type: Category was unsupported value."),!1):U===Q.Undefined?(I.w("Validation fail - sdk error event - type: Area was unsupported value."),!1):p!==K.Undefined||(I.w("Validation fail - sdk error event - type: Action was unsupported value."),!1))},v.validateKeys=function(w,v){return!(!P.stringMatch(w,/^[A-z0-9]{32}$/)||!P.stringMatch(v,/^[A-z0-9]{40}$/))},v.validateCurrency=function(w){return!!w&&!!P.stringMatch(w,/^[A-Z]{3}$/)},v.validateEventPartLength=function(w,v){return!(!v||w)||!!w&&!(w.length>64)},v.validateEventPartCharacters=function(w){return!!P.stringMatch(w,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},v.validateEventIdLength=function(w){return!!w&&!!P.stringMatch(w,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},v.validateEventIdCharacters=function(w){return!!w&&!!P.stringMatch(w,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},v.validateAndCleanInitRequestResponse=function(w,v){if(null==w)return I.w("validateInitRequestResponse failed - no response dictionary."),null;var P={};try{var u=w.server_ts;if(!(u>0))return I.w("validateInitRequestResponse failed - invalid value in 'server_ts' field."),null;P.server_ts=u}catch(v){return I.w("validateInitRequestResponse failed - invalid type in 'server_ts' field. type="+typeof w.server_ts+", value="+w.server_ts+", "+v),null}if(v){try{var Q=w.configs;P.configs=Q}catch(v){return I.w("validateInitRequestResponse failed - invalid type in 'configs' field. type="+typeof w.configs+", value="+w.configs+", "+v),null}try{var K=w.configs_hash;P.configs_hash=K}catch(v){return I.w("validateInitRequestResponse failed - invalid type in 'configs_hash' field. type="+typeof w.configs_hash+", value="+w.configs_hash+", "+v),null}try{var a=w.ab_id;P.ab_id=a}catch(v){return I.w("validateInitRequestResponse failed - invalid type in 'ab_id' field. type="+typeof w.ab_id+", value="+w.ab_id+", "+v),null}try{var U=w.ab_variant_id;P.ab_variant_id=U}catch(v){return I.w("validateInitRequestResponse failed - invalid type in 'ab_variant_id' field. type="+typeof w.ab_variant_id+", value="+w.ab_variant_id+", "+v),null}}return P},v.validateBuild=function(w){return!!v.validateShortString(w,!1)},v.validateSdkWrapperVersion=function(w){return!!P.stringMatch(w,/^(unity|unreal|gamemaker|cocos2d|construct|defold|godot) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},v.validateEngineVersion=function(w){return!(!w||!P.stringMatch(w,/^(unity|unreal|gamemaker|cocos2d|construct|defold|godot) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},v.validateUserId=function(w){return!!v.validateString(w,!1)||(I.w("Validation fail - user id: id cannot be (null), empty or above 64 characters."),!1)},v.validateShortString=function(w,v){return!(!v||w)||!(!w||w.length>32)},v.validateString=function(w,v){return!(!v||w)||!(!w||w.length>64)},v.validateLongString=function(w,v){return!(!v||w)||!(!w||w.length>8192)},v.validateConnectionType=function(w){return P.stringMatch(w,/^(wwan|wifi|lan|offline)$/)},v.validateCustomDimensions=function(w){return v.validateArrayOfStrings(20,32,!1,"custom dimensions",w)},v.validateResourceCurrencies=function(w){if(!v.validateArrayOfStrings(20,64,!1,"resource currencies",w))return!1;for(var u=0;u<w.length;++u)if(!P.stringMatch(w[u],/^[A-Za-z]+$/))return I.w("resource currencies validation failed: a resource currency can only be A-Z, a-z. String was: "+w[u]),!1;return!0},v.validateResourceItemTypes=function(w){if(!v.validateArrayOfStrings(20,32,!1,"resource item types",w))return!1;for(var P=0;P<w.length;++P)if(!v.validateEventPartCharacters(w[P]))return I.w("resource item types validation failed: a resource item type cannot contain other characters than A-z, 0-9, -_., ()!?. String was: "+w[P]),!1;return!0},v.validateDimension01=function(w,v){return!w||!!P.stringArrayContainsString(v,w)},v.validateDimension02=function(w,v){return!w||!!P.stringArrayContainsString(v,w)},v.validateDimension03=function(w,v){return!w||!!P.stringArrayContainsString(v,w)},v.validateArrayOfStrings=function(w,v,P,u,Q){var K=u;if(K||(K="Array"),!Q)return I.w(K+" validation failed: array cannot be null. "),!1;if(0==P&&0==Q.length)return I.w(K+" validation failed: array cannot be empty. "),!1;if(w>0&&Q.length>w)return I.w(K+" validation failed: array cannot exceed "+w+" values. It has "+Q.length+" values."),!1;for(var a=0;a<Q.length;++a){var U=Q[a]?Q[a].length:0;if(0===U)return I.w(K+" validation failed: contained an empty string. Array="+JSON.stringify(Q)),!1;if(v>0&&U>v)return I.w(K+" validation failed: a string exceeded max allowed length (which is: "+v+"). String was: "+Q[a]),!1}return!0},v.validateClientTs=function(w){return!(w<0||w>99999999999)},v}();v.GAValidator=p}(w.validators||(w.validators={}))}(u||(u={})),function(w){!function(w){var v=function(w,v,I){this.name=w,this.value=v,this.version=I};w.NameValueVersion=v;var I=function(w,v){this.name=w,this.version=v};w.NameVersion=I;var P=function(){function w(){}return w.touch=function(){},w.getRelevantSdkVersion=function(){return w.sdkGameEngineVersion?w.sdkGameEngineVersion:w.sdkWrapperVersion},w.getConnectionType=function(){return w.connectionType},w.updateConnectionType=function(){navigator.onLine?"ios"===w.buildPlatform||"android"===w.buildPlatform?w.connectionType="wwan":w.connectionType="lan":w.connectionType="offline"},w.getOSVersionString=function(){return w.buildPlatform+" "+w.osVersionPair.version},w.runtimePlatformToString=function(){return w.osVersionPair.name},w.getBrowserVersionString=function(){var v,I=navigator.userAgent,P=I.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident|fbav(?=\/))\/?\s*(\d+)/i)||[];if(0==P.length&&"ios"===w.buildPlatform)return"webkit_"+w.osVersion;if(/trident/i.test(P[1]))return"IE "+((v=/\brv[ :]+(\d+)/g.exec(I)||[])[1]||"");if("Chrome"===P[1]&&null!=(v=I.match(/\b(OPR|Edge|UBrowser)\/(\d+)/)))return v.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();if(P[1]&&"fbav"===P[1].toLowerCase()&&(P[1]="facebook",P[2]))return"facebook "+P[2];var u=P[2]?[P[1],P[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(v=I.match(/version\/(\d+)/i))&&u.splice(1,1,v[1]),u.join(" ").toLowerCase()},w.getDeviceModel=function(){return"unknown"},w.getDeviceManufacturer=function(){return"unknown"},w.matchItem=function(w,v){var P,u,Q,K,a=new I("unknown","0.0.0"),U=0,p=0;for(U=0;U<v.length;U+=1)if(new RegExp(v[U].value,"i").test(w)){if(P=new RegExp(v[U].version+"[- /:;]([\\d._]+)","i"),K="",(u=w.match(P))&&u[1]&&(Q=u[1]),Q){var r=Q.split(/[._]+/);for(p=0;p<Math.min(r.length,3);p+=1)K+=r[p]+(p<Math.min(r.length,3)-1?".":"")}else K="0.0.0";return a.name=v[U].name,a.version=K,a}return a},w.sdkWrapperVersion="javascript 4.1.6",w.osVersionPair=w.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor].join(" "),[new v("windows_phone","Windows Phone","OS"),new v("windows","Win","NT"),new v("ios","iPhone","OS"),new v("ios","iPad","OS"),new v("ios","iPod","OS"),new v("android","Android","Android"),new v("blackBerry","BlackBerry","/"),new v("mac_osx","Mac","OS X"),new v("tizen","Tizen","Tizen"),new v("linux","Linux","rv"),new v("kai_os","KAIOS","KAIOS")]),w.buildPlatform=w.runtimePlatformToString(),w.deviceModel=w.getDeviceModel(),w.deviceManufacturer=w.getDeviceManufacturer(),w.osVersion=w.getOSVersionString(),w.browserVersion=w.getBrowserVersionString(),w}();w.GADevice=P}(w.device||(w.device={}))}(u||(u={})),function(w){!function(w){var v=function(){function w(v){this.deadline=v,this.ignore=!1,this.async=!1,this.running=!1,this.id=++w.idCounter}return w.idCounter=0,w}();w.TimedBlock=v}(w.threading||(w.threading={}))}(u||(u={})),function(w){!function(w){var v=function(){function w(w){this.comparer=w,this._subQueues={},this._sortedKeys=[]}return w.prototype.enqueue=function(w,v){-1===this._sortedKeys.indexOf(w)&&this.addQueueOfPriority(w),this._subQueues[w].push(v)},w.prototype.addQueueOfPriority=function(w){var v=this;this._sortedKeys.push(w),this._sortedKeys.sort((function(w,I){return v.comparer.compare(w,I)})),this._subQueues[w]=[]},w.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},w.prototype.hasItems=function(){return this._sortedKeys.length>0},w.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},w.prototype.dequeueFromHighPriorityQueue=function(){var w=this._sortedKeys[0],v=this._subQueues[w].shift();return 0===this._subQueues[w].length&&(this._sortedKeys.shift(),delete this._subQueues[w]),v},w}();w.PriorityQueue=v}(w.threading||(w.threading={}))}(u||(u={})),function(w){!function(v){var I,P,u=w.logging.GALogger;!function(w){w[w.Equal=0]="Equal",w[w.LessOrEqual=1]="LessOrEqual",w[w.NotEqual=2]="NotEqual"}(I=v.EGAStoreArgsOperator||(v.EGAStoreArgsOperator={})),function(w){w[w.Events=0]="Events",w[w.Sessions=1]="Sessions",w[w.Progression=2]="Progression"}(P=v.EGAStore||(v.EGAStore={}));var Q=function(){function w(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"===typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),w.storageAvailable=!0):w.storageAvailable=!1}catch(w){}}return w.isStorageAvailable=function(){return w.storageAvailable},w.isStoreTooLargeForEvents=function(){return w.instance.eventsStore.length+w.instance.sessionsStore.length>w.MaxNumberOfEntries},w.select=function(v,P,u,Q){void 0===P&&(P=[]),void 0===u&&(u=!1),void 0===Q&&(Q=0);var K=w.getStore(v);if(!K)return null;for(var a=[],U=0;U<K.length;++U){for(var p=K[U],r=!0,Y=0;Y<P.length;++Y){var g=P[Y];if(p[g[0]])switch(g[1]){case I.Equal:r=p[g[0]]==g[2];break;case I.LessOrEqual:r=p[g[0]]<=g[2];break;case I.NotEqual:r=p[g[0]]!=g[2];break;default:r=!1}else r=!1;if(!r)break}r&&a.push(p)}return u&&a.sort((function(w,v){return w.client_ts-v.client_ts})),Q>0&&a.length>Q&&(a=a.slice(0,Q+1)),a},w.update=function(v,P,u){void 0===u&&(u=[]);var Q=w.getStore(v);if(!Q)return!1;for(var K=0;K<Q.length;++K){for(var a=Q[K],U=!0,p=0;p<u.length;++p){var r=u[p];if(a[r[0]])switch(r[1]){case I.Equal:U=a[r[0]]==r[2];break;case I.LessOrEqual:U=a[r[0]]<=r[2];break;case I.NotEqual:U=a[r[0]]!=r[2];break;default:U=!1}else U=!1;if(!U)break}if(U)for(p=0;p<P.length;++p){var Y=P[p];a[Y[0]]=Y[1]}}return!0},w.delete=function(v,P){var u=w.getStore(v);if(u)for(var Q=0;Q<u.length;++Q){for(var K=u[Q],a=!0,U=0;U<P.length;++U){var p=P[U];if(K[p[0]])switch(p[1]){case I.Equal:a=K[p[0]]==p[2];break;case I.LessOrEqual:a=K[p[0]]<=p[2];break;case I.NotEqual:a=K[p[0]]!=p[2];break;default:a=!1}else a=!1;if(!a)break}a&&(u.splice(Q,1),--Q)}},w.insert=function(v,I,P,u){void 0===P&&(P=!1),void 0===u&&(u=null);var Q=w.getStore(v);if(Q)if(P){if(!u)return;for(var K=!1,a=0;a<Q.length;++a){var U=Q[a];if(U[u]==I[u]){for(var p in I)U[p]=I[p];K=!0;break}}K||Q.push(I)}else Q.push(I)},w.save=function(v){w.isStorageAvailable()?(localStorage.setItem(w.StringFormat(w.KeyFormat,v,w.EventsStoreKey),JSON.stringify(w.instance.eventsStore)),localStorage.setItem(w.StringFormat(w.KeyFormat,v,w.SessionsStoreKey),JSON.stringify(w.instance.sessionsStore)),localStorage.setItem(w.StringFormat(w.KeyFormat,v,w.ProgressionStoreKey),JSON.stringify(w.instance.progressionStore)),localStorage.setItem(w.StringFormat(w.KeyFormat,v,w.ItemsStoreKey),JSON.stringify(w.instance.storeItems))):u.w("Storage is not available, cannot save.")},w.load=function(v){if(w.isStorageAvailable()){try{w.instance.eventsStore=JSON.parse(localStorage.getItem(w.StringFormat(w.KeyFormat,v,w.EventsStoreKey))),w.instance.eventsStore||(w.instance.eventsStore=[])}catch(v){u.w("Load failed for 'events' store. Using empty store."),w.instance.eventsStore=[]}try{w.instance.sessionsStore=JSON.parse(localStorage.getItem(w.StringFormat(w.KeyFormat,v,w.SessionsStoreKey))),w.instance.sessionsStore||(w.instance.sessionsStore=[])}catch(v){u.w("Load failed for 'sessions' store. Using empty store."),w.instance.sessionsStore=[]}try{w.instance.progressionStore=JSON.parse(localStorage.getItem(w.StringFormat(w.KeyFormat,v,w.ProgressionStoreKey))),w.instance.progressionStore||(w.instance.progressionStore=[])}catch(v){u.w("Load failed for 'progression' store. Using empty store."),w.instance.progressionStore=[]}try{w.instance.storeItems=JSON.parse(localStorage.getItem(w.StringFormat(w.KeyFormat,v,w.ItemsStoreKey))),w.instance.storeItems||(w.instance.storeItems={})}catch(v){u.w("Load failed for 'items' store. Using empty store."),w.instance.progressionStore=[]}}else u.w("Storage is not available, cannot load.")},w.setItem=function(v,I,P){var u=w.StringFormat(w.KeyFormat,v,I);P?w.instance.storeItems[u]=P:u in w.instance.storeItems&&delete w.instance.storeItems[u]},w.getItem=function(v,I){var P=w.StringFormat(w.KeyFormat,v,I);return P in w.instance.storeItems?w.instance.storeItems[P]:null},w.getStore=function(v){switch(v){case P.Events:return w.instance.eventsStore;case P.Sessions:return w.instance.sessionsStore;case P.Progression:return w.instance.progressionStore;default:return u.w("GAStore.getStore(): Cannot find store: "+v),null}},w.instance=new w,w.MaxNumberOfEntries=2e3,w.StringFormat=function(w){for(var v=[],I=1;I<arguments.length;I++)v[I-1]=arguments[I];return w.replace(/{(\d+)}/g,(function(w,I){return v[I]||""}))},w.KeyFormat="GA::{0}::{1}",w.EventsStoreKey="ga_event",w.SessionsStoreKey="ga_session",w.ProgressionStoreKey="ga_progression",w.ItemsStoreKey="ga_items",w}();v.GAStore=Q}(w.store||(w.store={}))}(u||(u={})),function(w){!function(v){var I=w.validators.GAValidator,P=w.utilities.GAUtilities,u=w.logging.GALogger,Q=w.store.GAStore,K=w.device.GADevice,a=w.store.EGAStore,U=w.store.EGAStoreArgsOperator,p=function(){function w(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.remoteConfigsListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={},this._isEventSubmissionEnabled=!0}return w.setUserId=function(v){w.instance.userId=v,w.cacheIdentifier()},w.getIdentifier=function(){return w.instance.identifier},w.isInitialized=function(){return w.instance.initialized},w.setInitialized=function(v){w.instance.initialized=v},w.getSessionStart=function(){return w.instance.sessionStart},w.getSessionNum=function(){return w.instance.sessionNum},w.getTransactionNum=function(){return w.instance.transactionNum},w.getSessionId=function(){return w.instance.sessionId},w.getCurrentCustomDimension01=function(){return w.instance.currentCustomDimension01},w.getCurrentCustomDimension02=function(){return w.instance.currentCustomDimension02},w.getCurrentCustomDimension03=function(){return w.instance.currentCustomDimension03},w.getGameKey=function(){return w.instance.gameKey},w.getGameSecret=function(){return w.instance.gameSecret},w.getAvailableCustomDimensions01=function(){return w.instance.availableCustomDimensions01},w.setAvailableCustomDimensions01=function(v){I.validateCustomDimensions(v)&&(w.instance.availableCustomDimensions01=v,w.validateAndFixCurrentDimensions(),u.i("Set available custom01 dimension values: ("+P.joinStringArray(v,", ")+")"))},w.getAvailableCustomDimensions02=function(){return w.instance.availableCustomDimensions02},w.setAvailableCustomDimensions02=function(v){I.validateCustomDimensions(v)&&(w.instance.availableCustomDimensions02=v,w.validateAndFixCurrentDimensions(),u.i("Set available custom02 dimension values: ("+P.joinStringArray(v,", ")+")"))},w.getAvailableCustomDimensions03=function(){return w.instance.availableCustomDimensions03},w.setAvailableCustomDimensions03=function(v){I.validateCustomDimensions(v)&&(w.instance.availableCustomDimensions03=v,w.validateAndFixCurrentDimensions(),u.i("Set available custom03 dimension values: ("+P.joinStringArray(v,", ")+")"))},w.getAvailableResourceCurrencies=function(){return w.instance.availableResourceCurrencies},w.setAvailableResourceCurrencies=function(v){I.validateResourceCurrencies(v)&&(w.instance.availableResourceCurrencies=v,u.i("Set available resource currencies: ("+P.joinStringArray(v,", ")+")"))},w.getAvailableResourceItemTypes=function(){return w.instance.availableResourceItemTypes},w.setAvailableResourceItemTypes=function(v){I.validateResourceItemTypes(v)&&(w.instance.availableResourceItemTypes=v,u.i("Set available resource item types: ("+P.joinStringArray(v,", ")+")"))},w.getBuild=function(){return w.instance.build},w.setBuild=function(v){w.instance.build=v,u.i("Set build version: "+v)},w.getUseManualSessionHandling=function(){return w.instance.useManualSessionHandling},w.isEventSubmissionEnabled=function(){return w.instance._isEventSubmissionEnabled},w.getABTestingId=function(){return w.instance.abId},w.getABTestingVariantId=function(){return w.instance.abVariantId},w.prototype.setDefaultId=function(v){this.defaultUserId=v||"",w.cacheIdentifier()},w.getDefaultId=function(){return w.instance.defaultUserId},w.getSdkConfig=function(){var v=0;for(var I in w.instance.sdkConfig)0===v&&(P=I),++v;if(P&&v>0)return w.instance.sdkConfig;var P;v=0;for(var I in w.instance.sdkConfigCached)0===v&&(P=I),++v;return P&&v>0?w.instance.sdkConfigCached:w.instance.sdkConfigDefault},w.isEnabled=function(){return!!w.instance.initAuthorized},w.setCustomDimension01=function(v){w.instance.currentCustomDimension01=v,Q.setItem(w.getGameKey(),w.Dimension01Key,v),u.i("Set custom01 dimension value: "+v)},w.setCustomDimension02=function(v){w.instance.currentCustomDimension02=v,Q.setItem(w.getGameKey(),w.Dimension02Key,v),u.i("Set custom02 dimension value: "+v)},w.setCustomDimension03=function(v){w.instance.currentCustomDimension03=v,Q.setItem(w.getGameKey(),w.Dimension03Key,v),u.i("Set custom03 dimension value: "+v)},w.incrementSessionNum=function(){var v=w.getSessionNum()+1;w.instance.sessionNum=v},w.incrementTransactionNum=function(){var v=w.getTransactionNum()+1;w.instance.transactionNum=v},w.incrementProgressionTries=function(v){var I=w.getProgressionTries(v)+1;w.instance.progressionTries[v]=I;var P={};P.progression=v,P.tries=I,Q.insert(a.Progression,P,!0,"progression")},w.getProgressionTries=function(v){return v in w.instance.progressionTries?w.instance.progressionTries[v]:0},w.clearProgressionTries=function(v){v in w.instance.progressionTries&&delete w.instance.progressionTries[v];var I=[];I.push(["progression",U.Equal,v]),Q.delete(a.Progression,I)},w.setKeys=function(v,I){w.instance.gameKey=v,w.instance.gameSecret=I},w.setManualSessionHandling=function(v){w.instance.useManualSessionHandling=v,u.i("Use manual session handling: "+v)},w.setEnabledEventSubmission=function(v){w.instance._isEventSubmissionEnabled=v},w.getEventAnnotations=function(){var v={v:2};v.user_id=w.instance.identifier,v.client_ts=w.getClientTsAdjusted(),v.sdk_version=K.getRelevantSdkVersion(),v.os_version=K.osVersion,v.manufacturer=K.deviceManufacturer,v.device=K.deviceModel,v.browser_version=K.browserVersion,v.platform=K.buildPlatform,v.session_id=w.instance.sessionId,v[w.SessionNumKey]=w.instance.sessionNum;var P=K.getConnectionType();if(I.validateConnectionType(P)&&(v.connection_type=P),K.gameEngineVersion&&(v.engine_version=K.gameEngineVersion),w.instance.configurations){var u=0;for(var Q in w.instance.configurations){u++;break}u>0&&(v.configurations=w.instance.configurations)}return w.instance.abId&&(v.ab_id=w.instance.abId),w.instance.abVariantId&&(v.ab_variant_id=w.instance.abVariantId),w.instance.build&&(v.build=w.instance.build),v},w.getSdkErrorEventAnnotations=function(){var v={v:2};v.category=w.CategorySdkError,v.sdk_version=K.getRelevantSdkVersion(),v.os_version=K.osVersion,v.manufacturer=K.deviceManufacturer,v.device=K.deviceModel,v.platform=K.buildPlatform;var P=K.getConnectionType();return I.validateConnectionType(P)&&(v.connection_type=P),K.gameEngineVersion&&(v.engine_version=K.gameEngineVersion),v},w.getInitAnnotations=function(){var v={};return w.getIdentifier()||w.cacheIdentifier(),v.user_id=w.getIdentifier(),v.sdk_version=K.getRelevantSdkVersion(),v.os_version=K.osVersion,v.platform=K.buildPlatform,w.getBuild()?v.build=w.getBuild():v.build=null,v.session_num=w.getSessionNum(),v.random_salt=w.getSessionNum(),v},w.getClientTsAdjusted=function(){var v=P.timeIntervalSince1970(),u=v+w.instance.clientServerTimeOffset;return I.validateClientTs(u)?u:v},w.sessionIsStarted=function(){return 0!=w.instance.sessionStart},w.cacheIdentifier=function(){w.instance.userId?w.instance.identifier=w.instance.userId:w.instance.defaultUserId&&(w.instance.identifier=w.instance.defaultUserId)},w.ensurePersistedStates=function(){Q.isStorageAvailable()&&Q.load(w.getGameKey());var v=w.instance;v.setDefaultId(null!=Q.getItem(w.getGameKey(),w.DefaultUserIdKey)?Q.getItem(w.getGameKey(),w.DefaultUserIdKey):P.createGuid()),v.sessionNum=null!=Q.getItem(w.getGameKey(),w.SessionNumKey)?Number(Q.getItem(w.getGameKey(),w.SessionNumKey)):0,v.transactionNum=null!=Q.getItem(w.getGameKey(),w.TransactionNumKey)?Number(Q.getItem(w.getGameKey(),w.TransactionNumKey)):0,v.currentCustomDimension01?Q.setItem(w.getGameKey(),w.Dimension01Key,v.currentCustomDimension01):(v.currentCustomDimension01=null!=Q.getItem(w.getGameKey(),w.Dimension01Key)?Q.getItem(w.getGameKey(),w.Dimension01Key):"",v.currentCustomDimension01),v.currentCustomDimension02?Q.setItem(w.getGameKey(),w.Dimension02Key,v.currentCustomDimension02):(v.currentCustomDimension02=null!=Q.getItem(w.getGameKey(),w.Dimension02Key)?Q.getItem(w.getGameKey(),w.Dimension02Key):"",v.currentCustomDimension02),v.currentCustomDimension03?Q.setItem(w.getGameKey(),w.Dimension03Key,v.currentCustomDimension03):(v.currentCustomDimension03=null!=Q.getItem(w.getGameKey(),w.Dimension03Key)?Q.getItem(w.getGameKey(),w.Dimension03Key):"",v.currentCustomDimension03);var I=null!=Q.getItem(w.getGameKey(),w.SdkConfigCachedKey)?Q.getItem(w.getGameKey(),w.SdkConfigCachedKey):"";if(I){var u=JSON.parse(P.decode64(I));u&&(v.sdkConfigCached=u)}var K=w.getSdkConfig();v.configsHash=K.configs_hash?K.configs_hash:"",v.abId=K.ab_id?K.ab_id:"",v.abVariantId=K.ab_variant_id?K.ab_variant_id:"";var U=Q.select(a.Progression);if(U)for(var p=0;p<U.length;++p){var r=U[p];r&&(v.progressionTries[r.progression]=r.tries)}},w.calculateServerTimeOffset=function(w){return w-P.timeIntervalSince1970()},w.validateAndCleanCustomFields=function(v){var I={};if(v){var Q=0;for(var K in v){var a=v[K];if(K&&a)if(Q<w.MAX_CUSTOM_FIELDS_COUNT){var U=new RegExp("^[a-zA-Z0-9_]{1,"+w.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(P.stringMatch(K,U)){var p=typeof a;if("string"===p||a instanceof String){var r=a;r.length<=w.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&r.length>0?(I[K]=r,++Q):u.w("validateAndCleanCustomFields: entry with key="+K+", value="+a+" has been omitted because its value is an empty string or exceeds the max number of characters ("+w.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH+")")}else if("number"===p||a instanceof Number){var Y=a;I[K]=Y,++Q}else u.w("validateAndCleanCustomFields: entry with key="+K+", value="+a+" has been omitted because its value is not a string or number")}else u.w("validateAndCleanCustomFields: entry with key="+K+", value="+a+" has been omitted because its key contains illegal character, is empty or exceeds the max number of characters ("+w.MAX_CUSTOM_FIELDS_KEY_LENGTH+")")}else u.w("validateAndCleanCustomFields: entry with key="+K+", value="+a+" has been omitted because it exceeds the max number of custom fields ("+w.MAX_CUSTOM_FIELDS_COUNT+")");else u.w("validateAndCleanCustomFields: entry with key="+K+", value="+a+" has been omitted because its key or value is null")}}return I},w.validateAndFixCurrentDimensions=function(){I.validateDimension01(w.getCurrentCustomDimension01(),w.getAvailableCustomDimensions01())||w.setCustomDimension01(""),I.validateDimension02(w.getCurrentCustomDimension02(),w.getAvailableCustomDimensions02())||w.setCustomDimension02(""),I.validateDimension03(w.getCurrentCustomDimension03(),w.getAvailableCustomDimensions03())||w.setCustomDimension03("")},w.getConfigurationStringValue=function(v,I){return w.instance.configurations[v]?w.instance.configurations[v].toString():I},w.isRemoteConfigsReady=function(){return w.instance.remoteConfigsIsReady},w.addRemoteConfigsListener=function(v){w.instance.remoteConfigsListeners.indexOf(v)<0&&w.instance.remoteConfigsListeners.push(v)},w.removeRemoteConfigsListener=function(v){var I=w.instance.remoteConfigsListeners.indexOf(v);I>-1&&w.instance.remoteConfigsListeners.splice(I,1)},w.getRemoteConfigsContentAsString=function(){return JSON.stringify(w.instance.configurations)},w.populateConfigurations=function(v){var I=v.configs;if(I){w.instance.configurations={};for(var P=0;P<I.length;++P){var u=I[P];if(u){var Q=u.key,K=u.value,a=u.start_ts?u.start_ts:Number.MIN_VALUE,U=u.end_ts?u.end_ts:Number.MAX_VALUE,p=w.getClientTsAdjusted();Q&&K&&p>a&&p<U&&(w.instance.configurations[Q]=K)}}}w.instance.remoteConfigsIsReady=!0;var r=w.instance.remoteConfigsListeners;for(P=0;P<r.length;++P)r[P]&&r[P].onRemoteConfigsUpdated()},w.CategorySdkError="sdk_error",w.MAX_CUSTOM_FIELDS_COUNT=50,w.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,w.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,w.instance=new w,w.DefaultUserIdKey="default_user_id",w.SessionNumKey="session_num",w.TransactionNumKey="transaction_num",w.Dimension01Key="dimension01",w.Dimension02Key="dimension02",w.Dimension03Key="dimension03",w.SdkConfigCachedKey="sdk_config_cached",w}();v.GAState=p}(w.state||(w.state={}))}(u||(u={})),function(w){!function(v){var I=w.utilities.GAUtilities,P=w.logging.GALogger,u=function(){function w(){}return w.execute=function(v,u,Q,K){var a=new Date;if(w.timestampMap[u]||(w.timestampMap[u]=a),w.countMap[u]||(w.countMap[u]=0),(a.getTime()-w.timestampMap[u].getTime())/1e3>=3600&&(w.timestampMap[u]=a,w.countMap[u]=0),!(w.countMap[u]>=w.MaxCount)){var U=I.getHmac(K,Q),p=new XMLHttpRequest;p.onreadystatechange=function(){if(4===p.readyState){if(!p.responseText)return;if(200!=p.status)return void P.w("sdk error failed. response code not 200. status code: "+p.status+", description: "+p.statusText+", body: "+p.responseText);w.countMap[u]=w.countMap[u]+1}},p.open("POST",v,!0),p.setRequestHeader("Content-Type","application/json"),p.setRequestHeader("Authorization",U);try{p.send(Q)}catch(w){console.error(w)}}},w.MaxCount=10,w.countMap={},w.timestampMap={},w}();v.SdkErrorTask=u}(w.tasks||(w.tasks={}))}(u||(u={})),function(w){!function(v){var I=w.state.GAState,P=w.logging.GALogger,u=w.utilities.GAUtilities,Q=w.validators.GAValidator,K=w.tasks.SdkErrorTask,a=w.events.EGASdkErrorCategory,U=w.events.EGASdkErrorArea,p=w.events.EGASdkErrorAction,r=w.events.EGASdkErrorParameter,Y=function(){function w(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.remoteConfigsVersion="v1",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.remoteConfigsBaseUrl=this.protocol+"://"+this.hostName+"/remote_configs/"+this.remoteConfigsVersion,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return w.prototype.requestInit=function(P,u){var Q=I.getGameKey(),K=this.remoteConfigsBaseUrl+"/"+this.initializeUrlPath+"?game_key="+Q+"&interval_seconds=0&configs_hash="+P,a=I.getInitAnnotations(),U=JSON.stringify(a);if(U){var p=this.createPayloadData(U,this.useGzip),r=[];r.push(U),w.sendRequest(K,p,r,this.useGzip,w.initRequestCallback,u)}else u(v.EGAHTTPApiResponse.JsonEncodeFailed,null)},w.prototype.sendEventsInArray=function(P,u,Q){if(0!=P.length){var K=I.getGameKey(),a=this.baseUrl+"/"+K+"/"+this.eventsUrlPath,U=JSON.stringify(P);if(U){var p=this.createPayloadData(U,this.useGzip),r=[];r.push(U),r.push(u),r.push(P.length.toString()),w.sendRequest(a,p,r,this.useGzip,w.sendEventInArrayRequestCallback,Q)}else Q(v.EGAHTTPApiResponse.JsonEncodeFailed,null,u,P.length)}},w.prototype.sendSdkErrorEvent=function(v,u,a,U,p,r,Y){if(I.isEventSubmissionEnabled()&&Q.validateSdkErrorEvent(r,Y,v,u,a)){var g,J=this.baseUrl+"/"+r+"/"+this.eventsUrlPath,l="",R=I.getSdkErrorEventAnnotations(),x=w.sdkErrorCategoryString(v);R.error_category=x,l+=x;var j=w.sdkErrorAreaString(u);R.error_area=j,l+=":"+j;var s=w.sdkErrorActionString(a);R.error_action=s;var B=w.sdkErrorParameterString(U);if(B.length>0&&(R.error_parameter=B),p.length>0){var t=p;if(p.length>w.MAX_ERROR_MESSAGE_LENGTH)t=p.substring(0,w.MAX_ERROR_MESSAGE_LENGTH);R.reason=t}var i=[];i.push(R),(g=JSON.stringify(i))?K.execute(J,l,g,Y):P.w("sendSdkErrorEvent: JSON encoding failed.")}},w.sendEventInArrayRequestCallback=function(P,u,Q,K){void 0===K&&(K=null);K[0],K[1];var Y,g,J=K[2],l=parseInt(K[3]);Y=P.responseText,g=P.status;var R=w.instance.processRequestResponse(g,P.statusText,Y,"Events");if(R==v.EGAHTTPApiResponse.Ok||R==v.EGAHTTPApiResponse.Created||R==v.EGAHTTPApiResponse.BadRequest){var x=Y?JSON.parse(Y):{};if(null==x)return Q(v.EGAHTTPApiResponse.JsonDecodeFailed,null,J,l),void w.instance.sendSdkErrorEvent(a.Http,U.EventsHttp,p.FailHttpJsonDecode,r.Undefined,Y,I.getGameKey(),I.getGameSecret());v.EGAHTTPApiResponse.BadRequest,Q(R,x,J,l)}else Q(R,null,J,l)},w.sendRequest=function(w,v,P,Q,K,a){var U=new XMLHttpRequest,p=I.getGameSecret(),r=u.getHmac(p,v),Y=[];for(var g in Y.push(r),P)Y.push(P[g]);if(U.onreadystatechange=function(){4===U.readyState&&K(U,w,a,Y)},U.open("POST",w,!0),U.setRequestHeader("Content-Type","application/json"),U.setRequestHeader("Authorization",r),Q)throw new Error("gzip not supported");try{U.send(v)}catch(w){console.error(w.stack)}},w.initRequestCallback=function(P,u,K,Y){void 0===Y&&(Y=null);var g,J;Y[0],Y[1];g=P.responseText,J=P.status;var l=g?JSON.parse(g):{},R=w.instance.processRequestResponse(J,P.statusText,g,"Init");if(R==v.EGAHTTPApiResponse.Ok||R==v.EGAHTTPApiResponse.Created||R==v.EGAHTTPApiResponse.BadRequest){if(null==l)return K(v.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0),void w.instance.sendSdkErrorEvent(a.Http,U.InitHttp,p.FailHttpJsonDecode,r.Undefined,g,I.getGameKey(),I.getGameSecret());if(R!==v.EGAHTTPApiResponse.BadRequest){var x=Q.validateAndCleanInitRequestResponse(l,R===v.EGAHTTPApiResponse.Created);x?K(R,x,"",0):K(v.EGAHTTPApiResponse.BadResponse,null,"",0)}else K(R,null,"",0)}else K(R,null,"",0)},w.prototype.createPayloadData=function(w,v){if(v)throw new Error("gzip not supported");return w},w.prototype.processRequestResponse=function(w,I,P,u){return P?200===w?v.EGAHTTPApiResponse.Ok:201===w?v.EGAHTTPApiResponse.Created:0===w||401===w?v.EGAHTTPApiResponse.Unauthorized:400===w?v.EGAHTTPApiResponse.BadRequest:500===w?v.EGAHTTPApiResponse.InternalServerError:v.EGAHTTPApiResponse.UnknownResponseCode:v.EGAHTTPApiResponse.NoResponse},w.sdkErrorCategoryString=function(w){switch(w){case a.EventValidation:return"event_validation";case a.Database:return"db";case a.Init:return"init";case a.Http:return"http";case a.Json:return"json"}return""},w.sdkErrorAreaString=function(w){switch(w){case U.BusinessEvent:return"business";case U.ResourceEvent:return"resource";case U.ProgressionEvent:return"progression";case U.DesignEvent:return"design";case U.ErrorEvent:return"error";case U.InitHttp:return"init_http";case U.EventsHttp:return"events_http";case U.ProcessEvents:return"process_events";case U.AddEventsToStore:return"add_events_to_store"}return""},w.sdkErrorActionString=function(w){switch(w){case p.InvalidCurrency:return"invalid_currency";case p.InvalidShortString:return"invalid_short_string";case p.InvalidEventPartLength:return"invalid_event_part_length";case p.InvalidEventPartCharacters:return"invalid_event_part_characters";case p.InvalidStore:return"invalid_store";case p.InvalidFlowType:return"invalid_flow_type";case p.StringEmptyOrNull:return"string_empty_or_null";case p.NotFoundInAvailableCurrencies:return"not_found_in_available_currencies";case p.InvalidAmount:return"invalid_amount";case p.NotFoundInAvailableItemTypes:return"not_found_in_available_item_types";case p.WrongProgressionOrder:return"wrong_progression_order";case p.InvalidEventIdLength:return"invalid_event_id_length";case p.InvalidEventIdCharacters:return"invalid_event_id_characters";case p.InvalidProgressionStatus:return"invalid_progression_status";case p.InvalidSeverity:return"invalid_severity";case p.InvalidLongString:return"invalid_long_string";case p.DatabaseTooLarge:return"db_too_large";case p.DatabaseOpenOrCreate:return"db_open_or_create";case p.JsonError:return"json_error";case p.FailHttpJsonDecode:return"fail_http_json_decode";case p.FailHttpJsonEncode:return"fail_http_json_encode"}return""},w.sdkErrorParameterString=function(w){switch(w){case r.Currency:return"currency";case r.CartType:return"cart_type";case r.ItemType:return"item_type";case r.ItemId:return"item_id";case r.Store:return"store";case r.FlowType:return"flow_type";case r.Amount:return"amount";case r.Progression01:return"progression01";case r.Progression02:return"progression02";case r.Progression03:return"progression03";case r.EventId:return"event_id";case r.ProgressionStatus:return"progression_status";case r.Severity:return"severity";case r.Message:return"message"}return""},w.instance=new w,w.MAX_ERROR_MESSAGE_LENGTH=256,w}();v.GAHTTPApi=Y}(w.http||(w.http={}))}(u||(u={})),function(w){!function(v){var I=w.store.GAStore,P=w.store.EGAStore,u=w.store.EGAStoreArgsOperator,Q=w.state.GAState,K=w.logging.GALogger,a=w.utilities.GAUtilities,U=w.http.EGAHTTPApiResponse,p=w.http.GAHTTPApi,r=w.validators.GAValidator,Y=function(){function Y(){}return Y.addSessionStartEvent=function(){if(Q.isEventSubmissionEnabled()){var w={};w.category=Y.CategorySessionStart,Q.incrementSessionNum(),I.setItem(Q.getGameKey(),Q.SessionNumKey,Q.getSessionNum().toString()),Y.addDimensionsToEvent(w),Y.addEventToStore(w),K.i("Add SESSION START event"),Y.processEvents(Y.CategorySessionStart,!1)}},Y.addSessionEndEvent=function(){if(Q.isEventSubmissionEnabled()){var w=Q.getSessionStart(),v=Q.getClientTsAdjusted()-w;v<0&&(K.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),v=0);var I={};I.category=Y.CategorySessionEnd,I.length=v,Y.addDimensionsToEvent(I),Y.addEventToStore(I),K.i("Add SESSION END event."),Y.processEvents("",!1)}},Y.addBusinessEvent=function(w,v,P,u,a,U){if(void 0===a&&(a=null),Q.isEventSubmissionEnabled()){var g=r.validateBusinessEvent(w,v,a,P,u);if(null==g){var J={};Q.incrementTransactionNum(),I.setItem(Q.getGameKey(),Q.TransactionNumKey,Q.getTransactionNum().toString()),J.event_id=P+":"+u,J.category=Y.CategoryBusiness,J.currency=w,J.amount=v,J[Q.TransactionNumKey]=Q.getTransactionNum(),a&&(J.cart_type=a),Y.addDimensionsToEvent(J),Y.addFieldsToEvent(J,Q.validateAndCleanCustomFields(U)),K.i("Add BUSINESS event: {currency:"+w+", amount:"+v+", itemType:"+P+", itemId:"+u+", cartType:"+a+"}"),Y.addEventToStore(J)}else p.instance.sendSdkErrorEvent(g.category,g.area,g.action,g.parameter,g.reason,Q.getGameKey(),Q.getGameSecret())}},Y.addResourceEvent=function(v,I,P,u,a,U){if(Q.isEventSubmissionEnabled()){var g=r.validateResourceEvent(v,I,P,u,a,Q.getAvailableResourceCurrencies(),Q.getAvailableResourceItemTypes());if(null==g){v===w.EGAResourceFlowType.Sink&&(P*=-1);var J={},l=Y.resourceFlowTypeToString(v);J.event_id=l+":"+I+":"+u+":"+a,J.category=Y.CategoryResource,J.amount=P,Y.addDimensionsToEvent(J),Y.addFieldsToEvent(J,Q.validateAndCleanCustomFields(U)),K.i("Add RESOURCE event: {currency:"+I+", amount:"+P+", itemType:"+u+", itemId:"+a+"}"),Y.addEventToStore(J)}else p.instance.sendSdkErrorEvent(g.category,g.area,g.action,g.parameter,g.reason,Q.getGameKey(),Q.getGameSecret())}},Y.addProgressionEvent=function(v,I,P,u,a,U,g){if(Q.isEventSubmissionEnabled()){var J=Y.progressionStatusToString(v),l=r.validateProgressionEvent(v,I,P,u);if(null==l){var R,x={};R=P?u?I+":"+P+":"+u:I+":"+P:I,x.category=Y.CategoryProgression,x.event_id=J+":"+R;var j=0;U&&v!=w.EGAProgressionStatus.Start&&(x.score=a),v===w.EGAProgressionStatus.Fail&&Q.incrementProgressionTries(R),v===w.EGAProgressionStatus.Complete&&(Q.incrementProgressionTries(R),j=Q.getProgressionTries(R),x.attempt_num=j,Q.clearProgressionTries(R)),Y.addDimensionsToEvent(x),Y.addFieldsToEvent(x,Q.validateAndCleanCustomFields(g)),K.i("Add PROGRESSION event: {status:"+J+", progression01:"+I+", progression02:"+P+", progression03:"+u+", score:"+a+", attempt:"+j+"}"),Y.addEventToStore(x)}else p.instance.sendSdkErrorEvent(l.category,l.area,l.action,l.parameter,l.reason,Q.getGameKey(),Q.getGameSecret())}},Y.addDesignEvent=function(w,v,I,P){if(Q.isEventSubmissionEnabled()){var u=r.validateDesignEvent(w);if(null==u){var a={};a.category=Y.CategoryDesign,a.event_id=w,I&&(a.value=v),Y.addDimensionsToEvent(a),Y.addFieldsToEvent(a,Q.validateAndCleanCustomFields(P)),K.i("Add DESIGN event: {eventId:"+w+", value:"+v+"}"),Y.addEventToStore(a)}else p.instance.sendSdkErrorEvent(u.category,u.area,u.action,u.parameter,u.reason,Q.getGameKey(),Q.getGameSecret())}},Y.addErrorEvent=function(w,v,I){if(Q.isEventSubmissionEnabled()){var P=Y.errorSeverityToString(w),u=r.validateErrorEvent(w,v);if(null==u){var a={};a.category=Y.CategoryError,a.severity=P,a.message=v,Y.addDimensionsToEvent(a),Y.addFieldsToEvent(a,Q.validateAndCleanCustomFields(I)),K.i("Add ERROR event: {severity:"+P+", message:"+v+"}"),Y.addEventToStore(a)}else p.instance.sendSdkErrorEvent(u.category,u.area,u.action,u.parameter,u.reason,Q.getGameKey(),Q.getGameSecret())}},Y.addAdEvent=function(v,I,P,u,a,U,g,J){if(Q.isEventSubmissionEnabled()){var l=Y.adActionToString(v),R=Y.adTypeToString(I),x=Y.adErrorToString(a),j=r.validateAdEvent(v,I,P,u);if(null==j){var s={};s.category=Y.CategoryAds,s.ad_sdk_name=P,s.ad_placement=u,s.ad_type=R,s.ad_action=l,v==w.EGAAdAction.FailedShow&&x.length>0&&(s.ad_fail_show_reason=x),!g||I!=w.EGAAdType.RewardedVideo&&I!=w.EGAAdType.Video||(s.ad_duration=U),Y.addDimensionsToEvent(s),Y.addFieldsToEvent(s,Q.validateAndCleanCustomFields(J)),K.i("Add AD event: {ad_sdk_name:"+P+", ad_placement:"+u+", ad_type:"+R+", ad_action:"+l+(v==w.EGAAdAction.FailedShow&&x.length>0?", ad_fail_show_reason:"+x:"")+(!g||I!=w.EGAAdType.RewardedVideo&&I!=w.EGAAdType.Video?"":", ad_duration:"+U)+"}"),Y.addEventToStore(s)}else p.instance.sendSdkErrorEvent(j.category,j.area,j.action,j.parameter,j.reason,Q.getGameKey(),Q.getGameSecret())}},Y.processEvents=function(w,U){if(Q.isEventSubmissionEnabled())try{var g=a.createGuid();U&&(Y.cleanupEvents(),Y.fixMissingSessionEndEvents());var J=[];J.push(["status",u.Equal,"new"]);var l=[];l.push(["status",u.Equal,"new"]),w&&(J.push(["category",u.Equal,w]),l.push(["category",u.Equal,w]));var R=[];R.push(["status",g]);var x=I.select(P.Events,J);if(!x||0==x.length)return K.i("Event queue: No events to send"),void Y.updateSessionStore();if(x.length>Y.MaxEventCount){if(!(x=I.select(P.Events,J,!0,Y.MaxEventCount)))return;var j=x[x.length-1].client_ts;if(J.push(["client_ts",u.LessOrEqual,j]),!(x=I.select(P.Events,J)))return;l.push(["client_ts",u.LessOrEqual,j])}if(K.i("Event queue: Sending "+x.length+" events."),!I.update(P.Events,R,l))return;for(var s=[],B=0;B<x.length;++B){var t=x[B],i=JSON.parse(a.decode64(t.event));if(0!=i.length){var z=i.client_ts;z&&!r.validateClientTs(z)&&delete i.client_ts,s.push(i)}}p.instance.sendEventsInArray(s,g,Y.processEventsCallback)}catch(w){K.e("Error during ProcessEvents(): "+w.stack),p.instance.sendSdkErrorEvent(v.EGASdkErrorCategory.Json,v.EGASdkErrorArea.ProcessEvents,v.EGASdkErrorAction.JsonError,v.EGASdkErrorParameter.Undefined,w.stack,Q.getGameKey(),Q.getGameSecret())}},Y.processEventsCallback=function(w,v,Q,a){var p=[];if(p.push(["status",u.Equal,Q]),w===U.Ok)I.delete(P.Events,p),K.i("Event queue: "+a+" events sent.");else if(w===U.NoResponse){var r=[];r.push(["status","new"]),K.w("Event queue: Failed to send events to collector - Retrying next time"),I.update(P.Events,r,p)}else{if(v){var Y,g=0;for(var J in v)0==g&&(Y=v[J]),++g;w===U.BadRequest&&Y.constructor===Array?K.w("Event queue: "+a+" events sent. "+g+" events failed GA server validation."):K.w("Event queue: Failed to send events.")}else K.w("Event queue: Failed to send events.");I.delete(P.Events,p)}},Y.cleanupEvents=function(){I.update(P.Events,[["status","new"]])},Y.fixMissingSessionEndEvents=function(){if(Q.isEventSubmissionEnabled()){var w=[];w.push(["session_id",u.NotEqual,Q.getSessionId()]);var v=I.select(P.Sessions,w);if(v&&0!=v.length){K.i(v.length+" session(s) located with missing session_end event.");for(var U=0;U<v.length;++U){var p=JSON.parse(a.decode64(v[U].event)),r=p.client_ts-v[U].timestamp;r=Math.max(0,r),p.category=Y.CategorySessionEnd,p.length=r,Y.addEventToStore(p)}}}},Y.addEventToStore=function(w){if(Q.isEventSubmissionEnabled())if(Q.isInitialized())try{if(I.isStoreTooLargeForEvents()&&!a.stringMatch(w.category,/^(user|session_end|business)$/))return K.w("Database too large. Event has been blocked."),void p.instance.sendSdkErrorEvent(v.EGASdkErrorCategory.Database,v.EGASdkErrorArea.AddEventsToStore,v.EGASdkErrorAction.DatabaseTooLarge,v.EGASdkErrorParameter.Undefined,"",Q.getGameKey(),Q.getGameSecret());var U=Q.getEventAnnotations(),r=a.encode64(JSON.stringify(U));for(var g in w)U[g]=w[g];var J=JSON.stringify(U);K.ii("Event added to queue: "+J);var l={status:"new"};l.category=U.category,l.session_id=U.session_id,l.client_ts=U.client_ts,l.event=a.encode64(JSON.stringify(U)),I.insert(P.Events,l),w.category==Y.CategorySessionEnd?I.delete(P.Sessions,[["session_id",u.Equal,U.session_id]]):((l={}).session_id=U.session_id,l.timestamp=Q.getSessionStart(),l.event=r,I.insert(P.Sessions,l,!0,"session_id")),I.isStorageAvailable()&&I.save(Q.getGameKey())}catch(g){K.e("addEventToStore: error"),K.e(g.stack),p.instance.sendSdkErrorEvent(v.EGASdkErrorCategory.Database,v.EGASdkErrorArea.AddEventsToStore,v.EGASdkErrorAction.DatabaseTooLarge,v.EGASdkErrorParameter.Undefined,g.stack,Q.getGameKey(),Q.getGameSecret())}else K.w("Could not add event: SDK is not initialized")},Y.updateSessionStore=function(){if(Q.sessionIsStarted()){var w={};w.session_id=Q.instance.sessionId,w.timestamp=Q.getSessionStart(),w.event=a.encode64(JSON.stringify(Q.getEventAnnotations())),I.insert(P.Sessions,w,!0,"session_id"),I.isStorageAvailable()&&I.save(Q.getGameKey())}},Y.addDimensionsToEvent=function(w){w&&(Q.getCurrentCustomDimension01()&&(w.custom_01=Q.getCurrentCustomDimension01()),Q.getCurrentCustomDimension02()&&(w.custom_02=Q.getCurrentCustomDimension02()),Q.getCurrentCustomDimension03()&&(w.custom_03=Q.getCurrentCustomDimension03()))},Y.addFieldsToEvent=function(w,v){w&&v&&Object.keys(v).length>0&&(w.custom_fields=v)},Y.resourceFlowTypeToString=function(v){return v==w.EGAResourceFlowType.Source||v==w.EGAResourceFlowType[w.EGAResourceFlowType.Source]?"Source":v==w.EGAResourceFlowType.Sink||v==w.EGAResourceFlowType[w.EGAResourceFlowType.Sink]?"Sink":""},Y.progressionStatusToString=function(v){return v==w.EGAProgressionStatus.Start||v==w.EGAProgressionStatus[w.EGAProgressionStatus.Start]?"Start":v==w.EGAProgressionStatus.Complete||v==w.EGAProgressionStatus[w.EGAProgressionStatus.Complete]?"Complete":v==w.EGAProgressionStatus.Fail||v==w.EGAProgressionStatus[w.EGAProgressionStatus.Fail]?"Fail":""},Y.errorSeverityToString=function(v){return v==w.EGAErrorSeverity.Debug||v==w.EGAErrorSeverity[w.EGAErrorSeverity.Debug]?"debug":v==w.EGAErrorSeverity.Info||v==w.EGAErrorSeverity[w.EGAErrorSeverity.Info]?"info":v==w.EGAErrorSeverity.Warning||v==w.EGAErrorSeverity[w.EGAErrorSeverity.Warning]?"warning":v==w.EGAErrorSeverity.Error||v==w.EGAErrorSeverity[w.EGAErrorSeverity.Error]?"error":v==w.EGAErrorSeverity.Critical||v==w.EGAErrorSeverity[w.EGAErrorSeverity.Critical]?"critical":""},Y.adActionToString=function(v){return v==w.EGAAdAction.Clicked||v==w.EGAAdAction[w.EGAAdAction.Clicked]?"clicked":v==w.EGAAdAction.Show||v==w.EGAAdAction[w.EGAAdAction.Show]?"show":v==w.EGAAdAction.FailedShow||v==w.EGAAdAction[w.EGAAdAction.FailedShow]?"failed_show":v==w.EGAAdAction.RewardReceived||v==w.EGAAdAction[w.EGAAdAction.RewardReceived]?"reward_received":""},Y.adErrorToString=function(v){return v==w.EGAAdError.Unknown||v==w.EGAAdError[w.EGAAdError.Unknown]?"unknown":v==w.EGAAdError.Offline||v==w.EGAAdError[w.EGAAdError.Offline]?"offline":v==w.EGAAdError.NoFill||v==w.EGAAdError[w.EGAAdError.NoFill]?"no_fill":v==w.EGAAdError.InternalError||v==w.EGAAdError[w.EGAAdError.InternalError]?"internal_error":v==w.EGAAdError.InvalidRequest||v==w.EGAAdError[w.EGAAdError.InvalidRequest]?"invalid_request":v==w.EGAAdError.UnableToPrecache||v==w.EGAAdError[w.EGAAdError.UnableToPrecache]?"unable_to_precache":""},Y.adTypeToString=function(v){return v==w.EGAAdType.Video||v==w.EGAAdType[w.EGAAdType.Video]?"video":v==w.EGAAdType.RewardedVideo||v==w.EGAAdError[w.EGAAdType.RewardedVideo]?"rewarded_video":v==w.EGAAdType.Playable||v==w.EGAAdError[w.EGAAdType.Playable]?"playable":v==w.EGAAdType.Interstitial||v==w.EGAAdError[w.EGAAdType.Interstitial]?"interstitial":v==w.EGAAdType.OfferWall||v==w.EGAAdError[w.EGAAdType.OfferWall]?"offer_wall":v==w.EGAAdType.Banner||v==w.EGAAdError[w.EGAAdType.Banner]?"banner":""},Y.CategorySessionStart="user",Y.CategorySessionEnd="session_end",Y.CategoryDesign="design",Y.CategoryBusiness="business",Y.CategoryProgression="progression",Y.CategoryResource="resource",Y.CategoryError="error",Y.CategoryAds="ads",Y.MaxEventCount=500,Y}();v.GAEvents=Y}(w.events||(w.events={}))}(u||(u={})),function(w){!function(v){var I=w.logging.GALogger,P=w.state.GAState,u=w.events.GAEvents,Q=function(){function w(){this.blocks=new v.PriorityQueue({compare:function(w,v){return w-v}}),this.id2TimedBlockMap={},w.startThread()}return w.createTimedBlock=function(w){void 0===w&&(w=0);var I=new Date;return I.setSeconds(I.getSeconds()+w),new v.TimedBlock(I)},w.performTaskOnGAThread=function(I,P){void 0===P&&(P=0);var u=new Date;u.setSeconds(u.getSeconds()+P);var Q=new v.TimedBlock(u);Q.block=I,w.instance.id2TimedBlockMap[Q.id]=Q,w.instance.addTimedBlock(Q)},w.performTimedBlockOnGAThread=function(v){w.instance.id2TimedBlockMap[v.id]=v,w.instance.addTimedBlock(v)},w.scheduleTimer=function(I,P){var u=new Date;u.setSeconds(u.getSeconds()+I);var Q=new v.TimedBlock(u);return Q.block=P,w.instance.id2TimedBlockMap[Q.id]=Q,w.instance.addTimedBlock(Q),Q.id},w.getTimedBlockById=function(v){return v in w.instance.id2TimedBlockMap?w.instance.id2TimedBlockMap[v]:null},w.ensureEventQueueIsRunning=function(){w.instance.keepRunning=!0,w.instance.isRunning||(w.instance.isRunning=!0,w.scheduleTimer(w.ProcessEventsIntervalInSeconds,w.processEventQueue))},w.endSessionAndStopQueue=function(){P.isInitialized()&&(I.i("Ending session."),w.stopEventQueue(),P.isEnabled()&&P.sessionIsStarted()&&(u.addSessionEndEvent(),P.instance.sessionStart=0))},w.stopEventQueue=function(){w.instance.keepRunning=!1},w.ignoreTimer=function(v){v in w.instance.id2TimedBlockMap&&(w.instance.id2TimedBlockMap[v].ignore=!0)},w.setEventProcessInterval=function(v){v>0&&(w.ProcessEventsIntervalInSeconds=v)},w.prototype.addTimedBlock=function(w){this.blocks.enqueue(w.deadline.getTime(),w)},w.run=function(){clearTimeout(w.runTimeoutId);try{for(var v;v=w.getNextBlock();)if(!v.ignore)if(v.async){if(!v.running){v.running=!0,v.block();break}}else v.block();return void(w.runTimeoutId=setTimeout(w.run,w.ThreadWaitTimeInMs))}catch(w){I.e("Error on GA thread"),I.e(w.stack)}},w.startThread=function(){w.runTimeoutId=setTimeout(w.run,0)},w.getNextBlock=function(){var v=new Date;return w.instance.blocks.hasItems()&&w.instance.blocks.peek().deadline.getTime()<=v.getTime()?w.instance.blocks.peek().async&&w.instance.blocks.peek().running?w.instance.blocks.peek():w.instance.blocks.dequeue():null},w.processEventQueue=function(){u.processEvents("",!0),w.instance.keepRunning?w.scheduleTimer(w.ProcessEventsIntervalInSeconds,w.processEventQueue):w.instance.isRunning=!1},w.instance=new w,w.ThreadWaitTimeInMs=1e3,w.ProcessEventsIntervalInSeconds=8,w}();v.GAThreading=Q}(w.threading||(w.threading={}))}(u||(u={})),function(w){var v=w.threading.GAThreading,P=w.logging.GALogger,u=w.store.GAStore,Q=w.state.GAState,K=w.http.GAHTTPApi,a=w.device.GADevice,U=w.validators.GAValidator,p=w.http.EGAHTTPApiResponse,r=w.utilities.GAUtilities,Y=w.events.GAEvents,g=function(){function g(){}return g.getGlobalObject=function(){return"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof I.g?I.g:void 0},g.init=function(){if(a.touch(),g.methodMap.configureAvailableCustomDimensions01=g.configureAvailableCustomDimensions01,g.methodMap.configureAvailableCustomDimensions02=g.configureAvailableCustomDimensions02,g.methodMap.configureAvailableCustomDimensions03=g.configureAvailableCustomDimensions03,g.methodMap.configureAvailableResourceCurrencies=g.configureAvailableResourceCurrencies,g.methodMap.configureAvailableResourceItemTypes=g.configureAvailableResourceItemTypes,g.methodMap.configureBuild=g.configureBuild,g.methodMap.configureSdkGameEngineVersion=g.configureSdkGameEngineVersion,g.methodMap.configureGameEngineVersion=g.configureGameEngineVersion,g.methodMap.configureUserId=g.configureUserId,g.methodMap.initialize=g.initialize,g.methodMap.addBusinessEvent=g.addBusinessEvent,g.methodMap.addResourceEvent=g.addResourceEvent,g.methodMap.addProgressionEvent=g.addProgressionEvent,g.methodMap.addDesignEvent=g.addDesignEvent,g.methodMap.addErrorEvent=g.addErrorEvent,g.methodMap.addErrorEvent=g.addErrorEvent,g.methodMap.setEnabledInfoLog=g.setEnabledInfoLog,g.methodMap.setEnabledVerboseLog=g.setEnabledVerboseLog,g.methodMap.setEnabledManualSessionHandling=g.setEnabledManualSessionHandling,g.methodMap.setEnabledEventSubmission=g.setEnabledEventSubmission,g.methodMap.setCustomDimension01=g.setCustomDimension01,g.methodMap.setCustomDimension02=g.setCustomDimension02,g.methodMap.setCustomDimension03=g.setCustomDimension03,g.methodMap.setEventProcessInterval=g.setEventProcessInterval,g.methodMap.startSession=g.startSession,g.methodMap.endSession=g.endSession,g.methodMap.onStop=g.onStop,g.methodMap.onResume=g.onResume,g.methodMap.addRemoteConfigsListener=g.addRemoteConfigsListener,g.methodMap.removeRemoteConfigsListener=g.removeRemoteConfigsListener,g.methodMap.getRemoteConfigsValueAsString=g.getRemoteConfigsValueAsString,g.methodMap.isRemoteConfigsReady=g.isRemoteConfigsReady,g.methodMap.getRemoteConfigsContentAsString=g.getRemoteConfigsContentAsString,"undefined"!==typeof g.getGlobalObject()&&"undefined"!==typeof g.getGlobalObject().GameAnalytics&&"undefined"!==typeof g.getGlobalObject().GameAnalytics.q){var w=g.getGlobalObject().GameAnalytics.q;for(var I in w)g.gaCommand.apply(null,w[I])}window.addEventListener("beforeunload",(function(){console.log("addEventListener unload"),v.endSessionAndStopQueue()}))},g.gaCommand=function(){for(var v=[],I=0;I<arguments.length;I++)v[I]=arguments[I];v.length>0&&v[0]in w.GameAnalytics.methodMap&&(v.length>1?w.GameAnalytics.methodMap[v[0]].apply(null,Array.prototype.slice.call(v,1)):w.GameAnalytics.methodMap[v[0]]())},g.configureAvailableCustomDimensions01=function(w){void 0===w&&(w=[]),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)?P.w("Available custom dimensions must be set before SDK is initialized"):Q.setAvailableCustomDimensions01(w)}))},g.configureAvailableCustomDimensions02=function(w){void 0===w&&(w=[]),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)?P.w("Available custom dimensions must be set before SDK is initialized"):Q.setAvailableCustomDimensions02(w)}))},g.configureAvailableCustomDimensions03=function(w){void 0===w&&(w=[]),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)?P.w("Available custom dimensions must be set before SDK is initialized"):Q.setAvailableCustomDimensions03(w)}))},g.configureAvailableResourceCurrencies=function(w){void 0===w&&(w=[]),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)?P.w("Available resource currencies must be set before SDK is initialized"):Q.setAvailableResourceCurrencies(w)}))},g.configureAvailableResourceItemTypes=function(w){void 0===w&&(w=[]),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)?P.w("Available resource item types must be set before SDK is initialized"):Q.setAvailableResourceItemTypes(w)}))},g.configureBuild=function(w){void 0===w&&(w=""),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)?P.w("Build version must be set before SDK is initialized."):U.validateBuild(w)?Q.setBuild(w):P.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+w)}))},g.configureSdkGameEngineVersion=function(w){void 0===w&&(w=""),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)||(U.validateSdkWrapperVersion(w)?a.sdkGameEngineVersion=w:P.i("Validation fail - configure sdk version: Sdk version not supported. String: "+w))}))},g.configureGameEngineVersion=function(w){void 0===w&&(w=""),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)||(U.validateEngineVersion(w)?a.gameEngineVersion=w:P.i("Validation fail - configure game engine version: Game engine version not supported. String: "+w))}))},g.configureUserId=function(w){void 0===w&&(w=""),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!1)?P.w("A custom user id must be set before SDK is initialized."):U.validateUserId(w)?Q.setUserId(w):P.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+w)}))},g.initialize=function(w,I){void 0===w&&(w=""),void 0===I&&(I=""),a.updateConnectionType();var u=v.createTimedBlock();u.async=!0,g.initTimedBlockId=u.id,u.block=function(){g.isSdkReady(!0,!1)?P.w("SDK already initialized. Can only be called once."):U.validateKeys(w,I)?(Q.setKeys(w,I),g.internalInitialize()):P.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+w+", secretKey: "+I)},v.performTimedBlockOnGAThread(u)},g.addBusinessEvent=function(w,I,P,u,Q){void 0===w&&(w=""),void 0===I&&(I=0),void 0===P&&(P=""),void 0===u&&(u=""),void 0===Q&&(Q=""),a.updateConnectionType(),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!0,"Could not add business event")&&Y.addBusinessEvent(w,I,P,u,Q,{})}))},g.addResourceEvent=function(I,P,u,Q,K){void 0===I&&(I=w.EGAResourceFlowType.Undefined),void 0===P&&(P=""),void 0===u&&(u=0),void 0===Q&&(Q=""),void 0===K&&(K=""),a.updateConnectionType(),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!0,"Could not add resource event")&&Y.addResourceEvent(I,P,u,Q,K,{})}))},g.addProgressionEvent=function(I,P,u,Q,K){void 0===I&&(I=w.EGAProgressionStatus.Undefined),void 0===P&&(P=""),void 0===u&&(u=""),void 0===Q&&(Q=""),a.updateConnectionType(),v.performTaskOnGAThread((function(){if(g.isSdkReady(!0,!0,"Could not add progression event")){var w="number"===typeof K;Y.addProgressionEvent(I,P,u,Q,w?K:0,w,{})}}))},g.addDesignEvent=function(w,I){a.updateConnectionType(),v.performTaskOnGAThread((function(){if(g.isSdkReady(!0,!0,"Could not add design event")){var v="number"===typeof I;Y.addDesignEvent(w,v?I:0,v,{})}}))},g.addErrorEvent=function(I,P){void 0===I&&(I=w.EGAErrorSeverity.Undefined),void 0===P&&(P=""),a.updateConnectionType(),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!0,"Could not add error event")&&Y.addErrorEvent(I,P,{})}))},g.addAdEventWithNoAdReason=function(I,P,u,Q,K){void 0===I&&(I=w.EGAAdAction.Undefined),void 0===P&&(P=w.EGAAdType.Undefined),void 0===u&&(u=""),void 0===Q&&(Q=""),void 0===K&&(K=w.EGAAdError.Undefined),a.updateConnectionType(),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!0,"Could not add ad event")&&Y.addAdEvent(I,P,u,Q,K,0,!1,{})}))},g.addAdEventWithDuration=function(I,P,u,Q,K){void 0===I&&(I=w.EGAAdAction.Undefined),void 0===P&&(P=w.EGAAdType.Undefined),void 0===u&&(u=""),void 0===Q&&(Q=""),void 0===K&&(K=0),a.updateConnectionType(),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!0,"Could not add ad event")&&Y.addAdEvent(I,P,u,Q,w.EGAAdError.Undefined,K,!0,{})}))},g.addAdEvent=function(I,P,u,Q){void 0===I&&(I=w.EGAAdAction.Undefined),void 0===P&&(P=w.EGAAdType.Undefined),void 0===u&&(u=""),void 0===Q&&(Q=""),a.updateConnectionType(),v.performTaskOnGAThread((function(){g.isSdkReady(!0,!0,"Could not add ad event")&&Y.addAdEvent(I,P,u,Q,w.EGAAdError.Undefined,0,!1,{})}))},g.setEnabledInfoLog=function(w){void 0===w&&(w=!1),v.performTaskOnGAThread((function(){w?(P.setInfoLog(w),P.i("Info logging enabled")):(P.i("Info logging disabled"),P.setInfoLog(w))}))},g.setEnabledVerboseLog=function(w){void 0===w&&(w=!1),v.performTaskOnGAThread((function(){w?(P.setVerboseLog(w),P.i("Verbose logging enabled")):(P.i("Verbose logging disabled"),P.setVerboseLog(w))}))},g.setEnabledManualSessionHandling=function(w){void 0===w&&(w=!1),v.performTaskOnGAThread((function(){Q.setManualSessionHandling(w)}))},g.setEnabledEventSubmission=function(w){void 0===w&&(w=!1),v.performTaskOnGAThread((function(){w?(Q.setEnabledEventSubmission(w),P.i("Event submission enabled")):(P.i("Event submission disabled"),Q.setEnabledEventSubmission(w))}))},g.setCustomDimension01=function(w){void 0===w&&(w=""),v.performTaskOnGAThread((function(){U.validateDimension01(w,Q.getAvailableCustomDimensions01())?Q.setCustomDimension01(w):P.w("Could not set custom01 dimension value to '"+w+"'. Value not found in available custom01 dimension values")}))},g.setCustomDimension02=function(w){void 0===w&&(w=""),v.performTaskOnGAThread((function(){U.validateDimension02(w,Q.getAvailableCustomDimensions02())?Q.setCustomDimension02(w):P.w("Could not set custom02 dimension value to '"+w+"'. Value not found in available custom02 dimension values")}))},g.setCustomDimension03=function(w){void 0===w&&(w=""),v.performTaskOnGAThread((function(){U.validateDimension03(w,Q.getAvailableCustomDimensions03())?Q.setCustomDimension03(w):P.w("Could not set custom03 dimension value to '"+w+"'. Value not found in available custom03 dimension values")}))},g.setEventProcessInterval=function(w){v.performTaskOnGAThread((function(){v.setEventProcessInterval(w)}))},g.startSession=function(){if(Q.isInitialized()){var w=v.createTimedBlock();w.async=!0,g.initTimedBlockId=w.id,w.block=function(){Q.isEnabled()&&Q.sessionIsStarted()&&v.endSessionAndStopQueue(),g.resumeSessionAndStartQueue()},v.performTimedBlockOnGAThread(w)}},g.endSession=function(){g.onStop()},g.onStop=function(){v.performTaskOnGAThread((function(){try{v.endSessionAndStopQueue()}catch(w){}}))},g.onResume=function(){var w=v.createTimedBlock();w.async=!0,g.initTimedBlockId=w.id,w.block=function(){g.resumeSessionAndStartQueue()},v.performTimedBlockOnGAThread(w)},g.getRemoteConfigsValueAsString=function(w,v){return void 0===v&&(v=null),Q.getConfigurationStringValue(w,v)},g.isRemoteConfigsReady=function(){return Q.isRemoteConfigsReady()},g.addRemoteConfigsListener=function(w){Q.addRemoteConfigsListener(w)},g.removeRemoteConfigsListener=function(w){Q.removeRemoteConfigsListener(w)},g.getRemoteConfigsContentAsString=function(){return Q.getRemoteConfigsContentAsString()},g.getABTestingId=function(){return Q.getABTestingId()},g.getABTestingVariantId=function(){return Q.getABTestingVariantId()},g.internalInitialize=function(){Q.ensurePersistedStates(),u.setItem(Q.getGameKey(),Q.DefaultUserIdKey,Q.getDefaultId()),Q.setInitialized(!0),g.newSession(),Q.isEnabled()&&v.ensureEventQueueIsRunning()},g.newSession=function(){P.i("Starting a new session."),Q.validateAndFixCurrentDimensions(),K.instance.requestInit(Q.instance.configsHash,g.startNewSessionCallback)},g.startNewSessionCallback=function(w,I){if(w!==p.Ok&&w!==p.Created||!I)w==p.Unauthorized?(P.w("Initialize SDK failed - Unauthorized"),Q.instance.initAuthorized=!1):(w===p.NoResponse||w===p.RequestTimeout?P.i("Init call (session start) failed - no response. Could be offline or timeout."):w===p.BadResponse||w===p.JsonEncodeFailed||w===p.JsonDecodeFailed?P.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):w!==p.BadRequest&&w!==p.UnknownResponseCode||P.i("Init call (session start) failed - bad request or unknown response."),null==Q.instance.sdkConfig?null!=Q.instance.sdkConfigCached?(P.i("Init call (session start) failed - using cached init values."),Q.instance.sdkConfig=Q.instance.sdkConfigCached):(P.i("Init call (session start) failed - using default init values."),Q.instance.sdkConfig=Q.instance.sdkConfigDefault):P.i("Init call (session start) failed - using cached init values."),Q.instance.initAuthorized=!0);else{var K=0;if(I.server_ts){var a=I.server_ts;K=Q.calculateServerTimeOffset(a)}if(I.time_offset=K,w!=p.Created){var U=Q.getSdkConfig();U.configs&&(I.configs=U.configs),U.configs_hash&&(I.configs_hash=U.configs_hash),U.ab_id&&(I.ab_id=U.ab_id),U.ab_variant_id&&(I.ab_variant_id=U.ab_variant_id)}Q.instance.configsHash=I.configs_hash?I.configs_hash:"",Q.instance.abId=I.ab_id?I.ab_id:"",Q.instance.abVariantId=I.ab_variant_id?I.ab_variant_id:"",u.setItem(Q.getGameKey(),Q.SdkConfigCachedKey,r.encode64(JSON.stringify(I))),Q.instance.sdkConfigCached=I,Q.instance.sdkConfig=I,Q.instance.initAuthorized=!0}if(Q.instance.clientServerTimeOffset=Q.getSdkConfig().time_offset?Q.getSdkConfig().time_offset:0,Q.populateConfigurations(Q.getSdkConfig()),!Q.isEnabled())return P.w("Could not start session: SDK is disabled."),void v.stopEventQueue();v.ensureEventQueueIsRunning();var J=r.createGuid();Q.instance.sessionId=J,Q.instance.sessionStart=Q.getClientTsAdjusted(),Y.addSessionStartEvent();var l=v.getTimedBlockById(g.initTimedBlockId);null!=l&&(l.running=!1),g.initTimedBlockId=-1},g.resumeSessionAndStartQueue=function(){Q.isInitialized()&&(P.i("Resuming session."),Q.sessionIsStarted()||g.newSession())},g.isSdkReady=function(w,v,I){return void 0===v&&(v=!0),void 0===I&&(I=""),I&&(I+=": "),w&&!Q.isInitialized()?(v&&P.w(I+"SDK is not initialized"),!1):w&&!Q.isEnabled()?(v&&P.w(I+"SDK is disabled"),!1):!(w&&!Q.sessionIsStarted())||(v&&P.w(I+"Session has not started yet"),!1)},g.initTimedBlockId=-1,g.methodMap={},g}();w.GameAnalytics=g}(u||(u={})),u.GameAnalytics.init();u.GameAnalytics.gaCommand;w.exports=u},379:function(w){"use strict";w.exports=function(w){for(var v=new Array(w),I=0;I<w;++I)v[I]=I;return v}},23110:function(w){function v(w){return!!w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}w.exports=function(w){return null!=w&&(v(w)||function(w){return"function"===typeof w.readFloatLE&&"function"===typeof w.slice&&v(w.slice(0,0))}(w)||!!w._isBuffer)}},74654:function(w,v,I){w=I.nmd(w);var P="__lodash_hash_undefined__",u=9007199254740991,Q="[object Arguments]",K="[object Boolean]",a="[object Date]",U="[object Function]",p="[object GeneratorFunction]",r="[object Map]",Y="[object Number]",g="[object Object]",J="[object Promise]",l="[object RegExp]",R="[object Set]",x="[object String]",j="[object Symbol]",s="[object WeakMap]",B="[object ArrayBuffer]",t="[object DataView]",i="[object Float32Array]",z="[object Float64Array]",E="[object Int8Array]",o="[object Int16Array]",h="[object Int32Array]",n="[object Uint8Array]",W="[object Uint8ClampedArray]",V="[object Uint16Array]",F="[object Uint32Array]",O=/\w*$/,N=/^\[object .+?Constructor\]$/,q=/^(?:0|[1-9]\d*)$/,m={};m[Q]=m["[object Array]"]=m[B]=m[t]=m[K]=m[a]=m[i]=m[z]=m[E]=m[o]=m[h]=m[r]=m[Y]=m[g]=m[l]=m[R]=m[x]=m[j]=m[n]=m[W]=m[V]=m[F]=!0,m["[object Error]"]=m[U]=m[s]=!1;var c="object"==typeof I.g&&I.g&&I.g.Object===Object&&I.g,M="object"==typeof self&&self&&self.Object===Object&&self,S=c||M||Function("return this")(),e=v&&!v.nodeType&&v,H=e&&w&&!w.nodeType&&w,G=H&&H.exports===e;function L(w,v){return w.set(v[0],v[1]),w}function d(w,v){return w.add(v),w}function D(w,v,I,P){var u=-1,Q=w?w.length:0;for(P&&Q&&(I=w[++u]);++u<Q;)I=v(I,w[u],u,w);return I}function f(w){var v=!1;if(null!=w&&"function"!=typeof w.toString)try{v=!!(w+"")}catch(w){}return v}function b(w){var v=-1,I=Array(w.size);return w.forEach((function(w,P){I[++v]=[P,w]})),I}function k(w,v){return function(I){return w(v(I))}}function C(w){var v=-1,I=Array(w.size);return w.forEach((function(w){I[++v]=w})),I}var y=Array.prototype,T=Function.prototype,Z=Object.prototype,A=S["__core-js_shared__"],X=function(){var w=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||"");return w?"Symbol(src)_1."+w:""}(),ww=T.toString,vw=Z.hasOwnProperty,Iw=Z.toString,Pw=RegExp("^"+ww.call(vw).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),uw=G?S.Buffer:void 0,Qw=S.Symbol,Kw=S.Uint8Array,aw=k(Object.getPrototypeOf,Object),Uw=Object.create,pw=Z.propertyIsEnumerable,rw=y.splice,Yw=Object.getOwnPropertySymbols,gw=uw?uw.isBuffer:void 0,Jw=k(Object.keys,Object),lw=Gw(S,"DataView"),Rw=Gw(S,"Map"),xw=Gw(S,"Promise"),jw=Gw(S,"Set"),sw=Gw(S,"WeakMap"),Bw=Gw(Object,"create"),tw=bw(lw),iw=bw(Rw),zw=bw(xw),Ew=bw(jw),ow=bw(sw),hw=Qw?Qw.prototype:void 0,nw=hw?hw.valueOf:void 0;function Ww(w){var v=-1,I=w?w.length:0;for(this.clear();++v<I;){var P=w[v];this.set(P[0],P[1])}}function Vw(w){var v=-1,I=w?w.length:0;for(this.clear();++v<I;){var P=w[v];this.set(P[0],P[1])}}function Fw(w){var v=-1,I=w?w.length:0;for(this.clear();++v<I;){var P=w[v];this.set(P[0],P[1])}}function Ow(w){this.__data__=new Vw(w)}function Nw(w,v){var I=Cw(w)||function(w){return function(w){return function(w){return!!w&&"object"==typeof w}(w)&&yw(w)}(w)&&vw.call(w,"callee")&&(!pw.call(w,"callee")||Iw.call(w)==Q)}(w)?function(w,v){for(var I=-1,P=Array(w);++I<w;)P[I]=v(I);return P}(w.length,String):[],P=I.length,u=!!P;for(var K in w)!v&&!vw.call(w,K)||u&&("length"==K||Dw(K,P))||I.push(K);return I}function qw(w,v,I){var P=w[v];vw.call(w,v)&&kw(P,I)&&(void 0!==I||v in w)||(w[v]=I)}function mw(w,v){for(var I=w.length;I--;)if(kw(w[I][0],v))return I;return-1}function cw(w,v,I,P,u,J,s){var N;if(P&&(N=J?P(w,u,J,s):P(w)),void 0!==N)return N;if(!Aw(w))return w;var q=Cw(w);if(q){if(N=function(w){var v=w.length,I=w.constructor(v);v&&"string"==typeof w[0]&&vw.call(w,"index")&&(I.index=w.index,I.input=w.input);return I}(w),!v)return function(w,v){var I=-1,P=w.length;v||(v=Array(P));for(;++I<P;)v[I]=w[I];return v}(w,N)}else{var c=dw(w),M=c==U||c==p;if(Tw(w))return function(w,v){if(v)return w.slice();var I=new w.constructor(w.length);return w.copy(I),I}(w,v);if(c==g||c==Q||M&&!J){if(f(w))return J?w:{};if(N=function(w){return"function"!=typeof w.constructor||fw(w)?{}:(v=aw(w),Aw(v)?Uw(v):{});var v}(M?{}:w),!v)return function(w,v){return ew(w,Lw(w),v)}(w,function(w,v){return w&&ew(v,Xw(v),w)}(N,w))}else{if(!m[c])return J?w:{};N=function(w,v,I,P){var u=w.constructor;switch(v){case B:return Sw(w);case K:case a:return new u(+w);case t:return function(w,v){var I=v?Sw(w.buffer):w.buffer;return new w.constructor(I,w.byteOffset,w.byteLength)}(w,P);case i:case z:case E:case o:case h:case n:case W:case V:case F:return function(w,v){var I=v?Sw(w.buffer):w.buffer;return new w.constructor(I,w.byteOffset,w.length)}(w,P);case r:return function(w,v,I){return D(v?I(b(w),!0):b(w),L,new w.constructor)}(w,P,I);case Y:case x:return new u(w);case l:return function(w){var v=new w.constructor(w.source,O.exec(w));return v.lastIndex=w.lastIndex,v}(w);case R:return function(w,v,I){return D(v?I(C(w),!0):C(w),d,new w.constructor)}(w,P,I);case j:return Q=w,nw?Object(nw.call(Q)):{}}var Q}(w,c,cw,v)}}s||(s=new Ow);var S=s.get(w);if(S)return S;if(s.set(w,N),!q)var e=I?function(w){return function(w,v,I){var P=v(w);return Cw(w)?P:function(w,v){for(var I=-1,P=v.length,u=w.length;++I<P;)w[u+I]=v[I];return w}(P,I(w))}(w,Xw,Lw)}(w):Xw(w);return function(w,v){for(var I=-1,P=w?w.length:0;++I<P&&!1!==v(w[I],I,w););}(e||w,(function(u,Q){e&&(u=w[Q=u]),qw(N,Q,cw(u,v,I,P,Q,w,s))})),N}function Mw(w){return!(!Aw(w)||(v=w,X&&X in v))&&(Zw(w)||f(w)?Pw:N).test(bw(w));var v}function Sw(w){var v=new w.constructor(w.byteLength);return new Kw(v).set(new Kw(w)),v}function ew(w,v,I,P){I||(I={});for(var u=-1,Q=v.length;++u<Q;){var K=v[u],a=P?P(I[K],w[K],K,I,w):void 0;qw(I,K,void 0===a?w[K]:a)}return I}function Hw(w,v){var I=w.__data__;return function(w){var v=typeof w;return"string"==v||"number"==v||"symbol"==v||"boolean"==v?"__proto__"!==w:null===w}(v)?I["string"==typeof v?"string":"hash"]:I.map}function Gw(w,v){var I=function(w,v){return null==w?void 0:w[v]}(w,v);return Mw(I)?I:void 0}Ww.prototype.clear=function(){this.__data__=Bw?Bw(null):{}},Ww.prototype.delete=function(w){return this.has(w)&&delete this.__data__[w]},Ww.prototype.get=function(w){var v=this.__data__;if(Bw){var I=v[w];return I===P?void 0:I}return vw.call(v,w)?v[w]:void 0},Ww.prototype.has=function(w){var v=this.__data__;return Bw?void 0!==v[w]:vw.call(v,w)},Ww.prototype.set=function(w,v){return this.__data__[w]=Bw&&void 0===v?P:v,this},Vw.prototype.clear=function(){this.__data__=[]},Vw.prototype.delete=function(w){var v=this.__data__,I=mw(v,w);return!(I<0)&&(I==v.length-1?v.pop():rw.call(v,I,1),!0)},Vw.prototype.get=function(w){var v=this.__data__,I=mw(v,w);return I<0?void 0:v[I][1]},Vw.prototype.has=function(w){return mw(this.__data__,w)>-1},Vw.prototype.set=function(w,v){var I=this.__data__,P=mw(I,w);return P<0?I.push([w,v]):I[P][1]=v,this},Fw.prototype.clear=function(){this.__data__={hash:new Ww,map:new(Rw||Vw),string:new Ww}},Fw.prototype.delete=function(w){return Hw(this,w).delete(w)},Fw.prototype.get=function(w){return Hw(this,w).get(w)},Fw.prototype.has=function(w){return Hw(this,w).has(w)},Fw.prototype.set=function(w,v){return Hw(this,w).set(w,v),this},Ow.prototype.clear=function(){this.__data__=new Vw},Ow.prototype.delete=function(w){return this.__data__.delete(w)},Ow.prototype.get=function(w){return this.__data__.get(w)},Ow.prototype.has=function(w){return this.__data__.has(w)},Ow.prototype.set=function(w,v){var I=this.__data__;if(I instanceof Vw){var P=I.__data__;if(!Rw||P.length<199)return P.push([w,v]),this;I=this.__data__=new Fw(P)}return I.set(w,v),this};var Lw=Yw?k(Yw,Object):function(){return[]},dw=function(w){return Iw.call(w)};function Dw(w,v){return!!(v=null==v?u:v)&&("number"==typeof w||q.test(w))&&w>-1&&w%1==0&&w<v}function fw(w){var v=w&&w.constructor;return w===("function"==typeof v&&v.prototype||Z)}function bw(w){if(null!=w){try{return ww.call(w)}catch(w){}try{return w+""}catch(w){}}return""}function kw(w,v){return w===v||w!==w&&v!==v}(lw&&dw(new lw(new ArrayBuffer(1)))!=t||Rw&&dw(new Rw)!=r||xw&&dw(xw.resolve())!=J||jw&&dw(new jw)!=R||sw&&dw(new sw)!=s)&&(dw=function(w){var v=Iw.call(w),I=v==g?w.constructor:void 0,P=I?bw(I):void 0;if(P)switch(P){case tw:return t;case iw:return r;case zw:return J;case Ew:return R;case ow:return s}return v});var Cw=Array.isArray;function yw(w){return null!=w&&function(w){return"number"==typeof w&&w>-1&&w%1==0&&w<=u}(w.length)&&!Zw(w)}var Tw=gw||function(){return!1};function Zw(w){var v=Aw(w)?Iw.call(w):"";return v==U||v==p}function Aw(w){var v=typeof w;return!!w&&("object"==v||"function"==v)}function Xw(w){return yw(w)?Nw(w):function(w){if(!fw(w))return Jw(w);var v=[];for(var I in Object(w))vw.call(w,I)&&"constructor"!=I&&v.push(I);return v}(w)}w.exports=function(w){return cw(w,!0,!0)}},47786:function(w,v,I){var P=I(379),u=I(23110),Q="undefined"!==typeof Float64Array;function K(w,v){return w[0]-v[0]}function a(){var w,v=this.stride,I=new Array(v.length);for(w=0;w<I.length;++w)I[w]=[Math.abs(v[w]),w];I.sort(K);var P=new Array(I.length);for(w=0;w<P.length;++w)P[w]=I[w][1];return P}function U(w,v){var I=["View",v,"d",w].join("");v<0&&(I="View_Nil"+w);var u="generic"===w;if(-1===v){var Q="function "+I+"(a){this.data=a;};var proto="+I+".prototype;proto.dtype='"+w+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+I+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+I+"(a){return new "+I+"(a);}";return new Function(Q)()}if(0===v){Q="function "+I+"(a,d) {this.data = a;this.offset = d};var proto="+I+".prototype;proto.dtype='"+w+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+I+"_copy() {return new "+I+"(this.data,this.offset)};proto.pick=function "+I+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+I+"_get(){return "+(u?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+I+"_set(v){return "+(u?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+I+"(a,b,c,d){return new "+I+"(a,d)}";return new Function("TrivialArray",Q)(p[w][0])}Q=["'use strict'"];var K=P(v),U=K.map((function(w){return"i"+w})),r="this.offset+"+K.map((function(w){return"this.stride["+w+"]*i"+w})).join("+"),Y=K.map((function(w){return"b"+w})).join(","),g=K.map((function(w){return"c"+w})).join(",");Q.push("function "+I+"(a,"+Y+","+g+",d){this.data=a","this.shape=["+Y+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+I+".prototype","proto.dtype='"+w+"'","proto.dimension="+v),Q.push("Object.defineProperty(proto,'size',{get:function "+I+"_size(){return "+K.map((function(w){return"this.shape["+w+"]"})).join("*"),"}})"),1===v?Q.push("proto.order=[0]"):(Q.push("Object.defineProperty(proto,'order',{get:"),v<4?(Q.push("function "+I+"_order(){"),2===v?Q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&Q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Q.push("ORDER})")),Q.push("proto.set=function "+I+"_set("+U.join(",")+",v){"),u?Q.push("return this.data.set("+r+",v)}"):Q.push("return this.data["+r+"]=v}"),Q.push("proto.get=function "+I+"_get("+U.join(",")+"){"),u?Q.push("return this.data.get("+r+")}"):Q.push("return this.data["+r+"]}"),Q.push("proto.index=function "+I+"_index(",U.join(),"){return "+r+"}"),Q.push("proto.hi=function "+I+"_hi("+U.join(",")+"){return new "+I+"(this.data,"+K.map((function(w){return["(typeof i",w,"!=='number'||i",w,"<0)?this.shape[",w,"]:i",w,"|0"].join("")})).join(",")+","+K.map((function(w){return"this.stride["+w+"]"})).join(",")+",this.offset)}");var J=K.map((function(w){return"a"+w+"=this.shape["+w+"]"})),l=K.map((function(w){return"c"+w+"=this.stride["+w+"]"}));Q.push("proto.lo=function "+I+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+l.join(","));for(var R=0;R<v;++R)Q.push("if(typeof i"+R+"==='number'&&i"+R+">=0){d=i"+R+"|0;b+=c"+R+"*d;a"+R+"-=d}");Q.push("return new "+I+"(this.data,"+K.map((function(w){return"a"+w})).join(",")+","+K.map((function(w){return"c"+w})).join(",")+",b)}"),Q.push("proto.step=function "+I+"_step("+U.join(",")+"){var "+K.map((function(w){return"a"+w+"=this.shape["+w+"]"})).join(",")+","+K.map((function(w){return"b"+w+"=this.stride["+w+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(R=0;R<v;++R)Q.push("if(typeof i"+R+"==='number'){d=i"+R+"|0;if(d<0){c+=b"+R+"*(a"+R+"-1);a"+R+"=ceil(-a"+R+"/d)}else{a"+R+"=ceil(a"+R+"/d)}b"+R+"*=d}");Q.push("return new "+I+"(this.data,"+K.map((function(w){return"a"+w})).join(",")+","+K.map((function(w){return"b"+w})).join(",")+",c)}");var x=new Array(v),j=new Array(v);for(R=0;R<v;++R)x[R]="a[i"+R+"]",j[R]="b[i"+R+"]";Q.push("proto.transpose=function "+I+"_transpose("+U+"){"+U.map((function(w,v){return w+"=("+w+"===undefined?"+v+":"+w+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+I+"(this.data,"+x.join(",")+","+j.join(",")+",this.offset)}"),Q.push("proto.pick=function "+I+"_pick("+U+"){var a=[],b=[],c=this.offset");for(R=0;R<v;++R)Q.push("if(typeof i"+R+"==='number'&&i"+R+">=0){c=(c+this.stride["+R+"]*i"+R+")|0}else{a.push(this.shape["+R+"]);b.push(this.stride["+R+"])}");return Q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Q.push("return function construct_"+I+"(data,shape,stride,offset){return new "+I+"(data,"+K.map((function(w){return"shape["+w+"]"})).join(",")+","+K.map((function(w){return"stride["+w+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Q.join("\n"))(p[w],a)}var p={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};w.exports=function(w,v,I,P){if(void 0===w)return(0,p.array[0])([]);"number"===typeof w&&(w=[w]),void 0===v&&(v=[w.length]);var K=v.length;if(void 0===I){I=new Array(K);for(var a=K-1,r=1;a>=0;--a)I[a]=r,r*=v[a]}if(void 0===P){P=0;for(a=0;a<K;++a)I[a]<0&&(P-=(v[a]-1)*I[a])}for(var Y=function(w){if(u(w))return"buffer";if(Q)switch(Object.prototype.toString.call(w)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(w)?"array":"generic"}(w),g=p[Y];g.length<=K+1;)g.push(U(Y,g.length-1));return(0,g[K+1])(w,v,I,P)}},13529:function(w){window,w.exports=function(w){var v={};function I(P){if(v[P])return v[P].exports;var u=v[P]={i:P,l:!1,exports:{}};return w[P].call(u.exports,u,u.exports,I),u.l=!0,u.exports}return I.m=w,I.c=v,I.d=function(w,v,P){I.o(w,v)||Object.defineProperty(w,v,{enumerable:!0,get:P})},I.r=function(w){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(w,"__esModule",{value:!0})},I.t=function(w,v){if(1&v&&(w=I(w)),8&v)return w;if(4&v&&"object"==typeof w&&w&&w.__esModule)return w;var P=Object.create(null);if(I.r(P),Object.defineProperty(P,"default",{enumerable:!0,value:w}),2&v&&"string"!=typeof w)for(var u in w)I.d(P,u,function(v){return w[v]}.bind(null,u));return P},I.n=function(w){var v=w&&w.__esModule?function(){return w.default}:function(){return w};return I.d(v,"a",v),v},I.o=function(w,v){return Object.prototype.hasOwnProperty.call(w,v)},I.p="",I(I.s=0)}([function(w,v,I){"use strict";I.r(v);var P,u=function(w,v){var I=v.x-w.x,P=v.y-w.y;return Math.sqrt(I*I+P*P)},Q=function(w){return w*(Math.PI/180)},K=function(w){return w*(180/Math.PI)},a=new Map,U=function(w){a.has(w)&&clearTimeout(a.get(w)),a.set(w,setTimeout(w,100))},p=function(w,v,I){for(var P,u=v.split(/[ ,]+/g),Q=0;Q<u.length;Q+=1)P=u[Q],w.addEventListener?w.addEventListener(P,I,!1):w.attachEvent&&w.attachEvent(P,I)},r=function(w,v,I){for(var P,u=v.split(/[ ,]+/g),Q=0;Q<u.length;Q+=1)P=u[Q],w.removeEventListener?w.removeEventListener(P,I):w.detachEvent&&w.detachEvent(P,I)},Y=function(w){return w.preventDefault(),w.type.match(/^touch/)?w.changedTouches:w},g=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},J=function(w,v){v.top||v.right||v.bottom||v.left?(w.style.top=v.top,w.style.right=v.right,w.style.bottom=v.bottom,w.style.left=v.left):(w.style.left=v.x+"px",w.style.top=v.y+"px")},l=function(w,v,I){var P=R(w);for(var u in P)if(P.hasOwnProperty(u))if("string"==typeof v)P[u]=v+" "+I;else{for(var Q="",K=0,a=v.length;K<a;K+=1)Q+=v[K]+" "+I+", ";P[u]=Q.slice(0,-2)}return P},R=function(w){var v={};return v[w]="",["webkit","Moz","o"].forEach((function(I){v[I+w.charAt(0).toUpperCase()+w.slice(1)]=""})),v},x=function(w,v){for(var I in v)v.hasOwnProperty(I)&&(w[I]=v[I]);return w},j=function(w,v){if(w.length)for(var I=0,P=w.length;I<P;I+=1)v(w[I]);else v(w)},s=!!("ontouchstart"in window),B=!!window.PointerEvent,t=!!window.MSPointerEvent,i={start:"mousedown",move:"mousemove",end:"mouseup"},z={};function E(){}B?P={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:t?P={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:s?(P={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},z=i):P=i,E.prototype.on=function(w,v){var I,P=w.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var u=0;u<P.length;u+=1)I=P[u],this._handlers_[I]=this._handlers_[I]||[],this._handlers_[I].push(v);return this},E.prototype.off=function(w,v){return this._handlers_=this._handlers_||{},void 0===w?this._handlers_={}:void 0===v?this._handlers_[w]=null:this._handlers_[w]&&this._handlers_[w].indexOf(v)>=0&&this._handlers_[w].splice(this._handlers_[w].indexOf(v),1),this},E.prototype.trigger=function(w,v){var I,P=this,u=w.split(/[ ,]+/g);P._handlers_=P._handlers_||{};for(var Q=0;Q<u.length;Q+=1)I=u[Q],P._handlers_[I]&&P._handlers_[I].length&&P._handlers_[I].forEach((function(w){w.call(P,{type:I,target:P},v)}))},E.prototype.config=function(w){this.options=this.defaults||{},w&&(this.options=function(w,v){var I={};for(var P in w)w.hasOwnProperty(P)&&v.hasOwnProperty(P)?I[P]=v[P]:w.hasOwnProperty(P)&&(I[P]=w[P]);return I}(this.options,w))},E.prototype.bindEvt=function(w,v){var I=this;return I._domHandlers_=I._domHandlers_||{},I._domHandlers_[v]=function(){"function"==typeof I["on"+v]?I["on"+v].apply(I,arguments):console.warn('[WARNING] : Missing "on'+v+'" handler.')},p(w,P[v],I._domHandlers_[v]),z[v]&&p(w,z[v],I._domHandlers_[v]),I},E.prototype.unbindEvt=function(w,v){return this._domHandlers_=this._domHandlers_||{},r(w,P[v],this._domHandlers_[v]),z[v]&&r(w,z[v],this._domHandlers_[v]),delete this._domHandlers_[v],this};var o=E;function h(w,v){return this.identifier=v.identifier,this.position=v.position,this.frontPosition=v.frontPosition,this.collection=w,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(v),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=h.id,h.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}h.prototype=new o,h.constructor=h,h.id=0,h.prototype.buildEl=function(w){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},h.prototype.stylize=function(){if(this.options.dataOnly)return this;var w=this.options.fadeTime+"ms",v=function(w,v){var I=R("borderRadius");for(var P in I)I.hasOwnProperty(P)&&(I[P]=v);return I}(0,"50%"),I=l("transition","opacity",w),P={};return P.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},P.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},P.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},x(P.el,I),"circle"===this.options.shape&&x(P.back,v),x(P.front,v),this.applyStyles(P),this},h.prototype.applyStyles=function(w){for(var v in this.ui)if(this.ui.hasOwnProperty(v))for(var I in w[v])this.ui[v].style[I]=w[v][I];return this},h.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},h.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},h.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},h.prototype.show=function(w){var v=this;return v.options.dataOnly||(clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.addToDom(),v.restCallback(),setTimeout((function(){v.ui.el.style.opacity=1}),0),v.showTimeout=setTimeout((function(){v.trigger("shown",v.instance),"function"==typeof w&&w.call(this)}),v.options.fadeTime)),v},h.prototype.hide=function(w){var v=this;if(v.options.dataOnly)return v;if(v.ui.el.style.opacity=v.options.restOpacity,clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.removeTimeout=setTimeout((function(){var I="dynamic"===v.options.mode?"none":"block";v.ui.el.style.display=I,"function"==typeof w&&w.call(v),v.trigger("hidden",v.instance)}),v.options.fadeTime),v.options.restJoystick){var I=v.options.restJoystick,P={};P.x=!0===I||!1!==I.x?0:v.instance.frontPosition.x,P.y=!0===I||!1!==I.y?0:v.instance.frontPosition.y,v.setPosition(w,P)}return v},h.prototype.setPosition=function(w,v){var I=this;I.frontPosition={x:v.x,y:v.y};var P=I.options.fadeTime+"ms",u={};u.front=l("transition",["transform"],P);var Q={front:{}};Q.front={transform:"translate("+I.frontPosition.x+"px,"+I.frontPosition.y+"px)"},I.applyStyles(u),I.applyStyles(Q),I.restTimeout=setTimeout((function(){"function"==typeof w&&w.call(I),I.restCallback()}),I.options.fadeTime)},h.prototype.restCallback=function(){var w={};w.front=l("transition","none",""),this.applyStyles(w),this.trigger("rested",this.instance)},h.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},h.prototype.computeDirection=function(w){var v,I,P,u=w.angle.radian,Q=Math.PI/4,K=Math.PI/2;if(u>Q&&u<3*Q&&!w.lockX?v="up":u>-Q&&u<=Q&&!w.lockY?v="left":u>3*-Q&&u<=-Q&&!w.lockX?v="down":w.lockY||(v="right"),w.lockY||(I=u>-K&&u<K?"left":"right"),w.lockX||(P=u>0?"up":"down"),w.force>this.options.threshold){var a,U={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(U[a]=this.direction[a]);var p={};for(a in this.direction={x:I,y:P,angle:v},w.direction=this.direction,U)U[a]===this.direction[a]&&(p[a]=!0);if(p.x&&p.y&&p.angle)return w;p.x&&p.y||this.trigger("plain",w),p.x||this.trigger("plain:"+I,w),p.y||this.trigger("plain:"+P,w),p.angle||this.trigger("dir dir:"+v,w)}else this.resetDirection();return w};var n=h;function W(w,v){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=w,this.id=W.id,W.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(v),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var I=getComputedStyle(this.options.zone.parentElement);return I&&"flex"===I.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}W.prototype=new o,W.constructor=W,W.id=0,W.prototype.prepareNipples=function(){var w=this.nipples;w.on=this.on.bind(this),w.off=this.off.bind(this),w.options=this.options,w.destroy=this.destroy.bind(this),w.ids=this.ids,w.id=this.id,w.processOnMove=this.processOnMove.bind(this),w.processOnEnd=this.processOnEnd.bind(this),w.get=function(v){if(void 0===v)return w[0];for(var I=0,P=w.length;I<P;I+=1)if(w[I].identifier===v)return w[I];return!1}},W.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},W.prototype.begin=function(){var w=this.options;if("static"===w.mode){var v=this.createNipple(w.position,this.manager.getIdentifier());v.add(),this.idles.push(v)}},W.prototype.createNipple=function(w,v){var I=this.manager.scroll,P={},u=this.options,Q=this.parentIsFlex?I.x:I.x+this.box.left,K=this.parentIsFlex?I.y:I.y+this.box.top;if(w.x&&w.y)P={x:w.x-Q,y:w.y-K};else if(w.top||w.right||w.bottom||w.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=w.top,a.style.right=w.right,a.style.bottom=w.bottom,a.style.left=w.left,a.style.position="absolute",u.zone.appendChild(a);var U=a.getBoundingClientRect();u.zone.removeChild(a),P=w,w={x:U.left+I.x,y:U.top+I.y}}var p=new n(this,{color:u.color,size:u.size,threshold:u.threshold,fadeTime:u.fadeTime,dataOnly:u.dataOnly,restJoystick:u.restJoystick,restOpacity:u.restOpacity,mode:u.mode,identifier:v,position:w,zone:u.zone,frontPosition:{x:0,y:0},shape:u.shape});return u.dataOnly||(J(p.ui.el,P),J(p.ui.front,p.frontPosition)),this.nipples.push(p),this.trigger("added "+p.identifier+":added",p),this.manager.trigger("added "+p.identifier+":added",p),this.bindNipple(p),p},W.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},W.prototype.bindNipple=function(w){var v,I=this,P=function(w,P){v=w.type+" "+P.id+":"+w.type,I.trigger(v,P)};w.on("destroyed",I.onDestroyed.bind(I)),w.on("shown hidden rested dir plain",P),w.on("dir:up dir:right dir:down dir:left",P),w.on("plain:up plain:right plain:down plain:left",P)},W.prototype.pressureFn=function(w,v,I){var P=this,u=0;clearInterval(P.pressureIntervals[I]),P.pressureIntervals[I]=setInterval(function(){var I=w.force||w.pressure||w.webkitForce||0;I!==u&&(v.trigger("pressure",I),P.trigger("pressure "+v.identifier+":pressure",I),u=I)}.bind(P),100)},W.prototype.onstart=function(w){var v=this,I=v.options,P=w;return w=Y(w),v.updateBox(),j(w,(function(u){v.actives.length<I.maxNumberOfNipples?v.processOnStart(u):P.type.match(/^touch/)&&(Object.keys(v.manager.ids).forEach((function(I){if(Object.values(P.touches).findIndex((function(w){return w.identifier===I}))<0){var u=[w[0]];u.identifier=I,v.processOnEnd(u)}})),v.actives.length<I.maxNumberOfNipples&&v.processOnStart(u))})),v.manager.bindDocument(),!1},W.prototype.processOnStart=function(w){var v,I=this,P=I.options,Q=I.manager.getIdentifier(w),K=w.force||w.pressure||w.webkitForce||0,a={x:w.pageX,y:w.pageY},U=I.getOrCreate(Q,a);U.identifier!==Q&&I.manager.removeIdentifier(U.identifier),U.identifier=Q;var p=function(v){v.trigger("start",v),I.trigger("start "+v.id+":start",v),v.show(),K>0&&I.pressureFn(w,v,v.identifier),I.processOnMove(w)};if((v=I.idles.indexOf(U))>=0&&I.idles.splice(v,1),I.actives.push(U),I.ids.push(U.identifier),"semi"!==P.mode)p(U);else{if(!(u(a,U.position)<=P.catchDistance))return U.destroy(),void I.processOnStart(w);p(U)}return U},W.prototype.getOrCreate=function(w,v){var I,P=this.options;return/(semi|static)/.test(P.mode)?(I=this.idles[0])?(this.idles.splice(0,1),I):"semi"===P.mode?this.createNipple(v,w):(console.warn("Coudln't find the needed nipple."),!1):I=this.createNipple(v,w)},W.prototype.processOnMove=function(w){var v=this.options,I=this.manager.getIdentifier(w),P=this.nipples.get(I),a=this.manager.scroll;if(function(w){return isNaN(w.buttons)?0!==w.pressure:0!==w.buttons}(w)){if(!P)return console.error("Found zombie joystick with ID "+I),void this.manager.removeIdentifier(I);if(v.dynamicPage){var U=P.el.getBoundingClientRect();P.position={x:a.x+U.left,y:a.y+U.top}}P.identifier=I;var p=P.options.size/2,r={x:w.pageX,y:w.pageY};v.lockX&&(r.y=P.position.y),v.lockY&&(r.x=P.position.x);var Y,g,J,l,R,x,j,s,B,t,i=u(r,P.position),z=(Y=r,J=(g=P.position).x-Y.x,l=g.y-Y.y,K(Math.atan2(l,J))),E=Q(z),o=i/p,h={distance:i,position:r};if("circle"===P.options.shape?(R=Math.min(i,p),j=P.position,s=R,t={x:0,y:0},B=Q(B=z),t.x=j.x-s*Math.cos(B),t.y=j.y-s*Math.sin(B),x=t):(x=function(w,v,I){return{x:Math.min(Math.max(w.x,v.x-I),v.x+I),y:Math.min(Math.max(w.y,v.y-I),v.y+I)}}(r,P.position,p),R=u(x,P.position)),v.follow){if(i>p){var n=r.x-x.x,W=r.y-x.y;P.position.x+=n,P.position.y+=W,P.el.style.top=P.position.y-(this.box.top+a.y)+"px",P.el.style.left=P.position.x-(this.box.left+a.x)+"px",i=u(r,P.position)}}else r=x,i=R;var V=r.x-P.position.x,F=r.y-P.position.y;P.frontPosition={x:V,y:F},v.dataOnly||(P.ui.front.style.transform="translate("+V+"px,"+F+"px)");var O={identifier:P.identifier,position:r,force:o,pressure:w.force||w.pressure||w.webkitForce||0,distance:i,angle:{radian:E,degree:z},vector:{x:V/p,y:-F/p},raw:h,instance:P,lockX:v.lockX,lockY:v.lockY};(O=P.computeDirection(O)).angle={radian:Q(180-z),degree:180-z},P.trigger("move",O),this.trigger("move "+P.id+":move",O)}else this.processOnEnd(w)},W.prototype.processOnEnd=function(w){var v=this,I=v.options,P=v.manager.getIdentifier(w),u=v.nipples.get(P),Q=v.manager.removeIdentifier(u.identifier);u&&(I.dataOnly||u.hide((function(){"dynamic"===I.mode&&(u.trigger("removed",u),v.trigger("removed "+u.id+":removed",u),v.manager.trigger("removed "+u.id+":removed",u),u.destroy())})),clearInterval(v.pressureIntervals[u.identifier]),u.resetDirection(),u.trigger("end",u),v.trigger("end "+u.id+":end",u),v.ids.indexOf(u.identifier)>=0&&v.ids.splice(v.ids.indexOf(u.identifier),1),v.actives.indexOf(u)>=0&&v.actives.splice(v.actives.indexOf(u),1),/(semi|static)/.test(I.mode)?v.idles.push(u):v.nipples.indexOf(u)>=0&&v.nipples.splice(v.nipples.indexOf(u),1),v.manager.unbindDocument(),/(semi|static)/.test(I.mode)&&(v.manager.ids[Q.id]=Q.identifier))},W.prototype.onDestroyed=function(w,v){this.nipples.indexOf(v)>=0&&this.nipples.splice(this.nipples.indexOf(v),1),this.actives.indexOf(v)>=0&&this.actives.splice(this.actives.indexOf(v),1),this.idles.indexOf(v)>=0&&this.idles.splice(this.idles.indexOf(v),1),this.ids.indexOf(v.identifier)>=0&&this.ids.splice(this.ids.indexOf(v.identifier),1),this.manager.removeIdentifier(v.identifier),this.manager.unbindDocument()},W.prototype.destroy=function(){for(var w in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach((function(w){w.destroy()})),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(w)&&clearInterval(this.pressureIntervals[w]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var V=W;function F(w){var v=this;v.ids={},v.index=0,v.collections=[],v.scroll=g(),v.config(w),v.prepareCollections();var I=function(){var w;v.collections.forEach((function(I){I.forEach((function(I){w=I.el.getBoundingClientRect(),I.position={x:v.scroll.x+w.left,y:v.scroll.y+w.top}}))}))};p(window,"resize",(function(){U(I)}));var P=function(){v.scroll=g()};return p(window,"scroll",(function(){U(P)})),v.collections}F.prototype=new o,F.constructor=F,F.prototype.prepareCollections=function(){var w=this;w.collections.create=w.create.bind(w),w.collections.on=w.on.bind(w),w.collections.off=w.off.bind(w),w.collections.destroy=w.destroy.bind(w),w.collections.get=function(v){var I;return w.collections.every((function(w){return!(I=w.get(v))})),I}},F.prototype.create=function(w){return this.createCollection(w)},F.prototype.createCollection=function(w){var v=new V(this,w);return this.bindCollection(v),this.collections.push(v),v},F.prototype.bindCollection=function(w){var v,I=this,P=function(w,P){v=w.type+" "+P.id+":"+w.type,I.trigger(v,P)};w.on("destroyed",I.onDestroyed.bind(I)),w.on("shown hidden rested dir plain",P),w.on("dir:up dir:right dir:down dir:left",P),w.on("plain:up plain:right plain:down plain:left",P)},F.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},F.prototype.unbindDocument=function(w){Object.keys(this.ids).length&&!0!==w||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},F.prototype.getIdentifier=function(w){var v;return w?void 0===(v=void 0===w.identifier?w.pointerId:w.identifier)&&(v=this.latest||0):v=this.index,void 0===this.ids[v]&&(this.ids[v]=this.index,this.index+=1),this.latest=v,this.ids[v]},F.prototype.removeIdentifier=function(w){var v={};for(var I in this.ids)if(this.ids[I]===w){v.id=I,v.identifier=this.ids[I],delete this.ids[I];break}return v},F.prototype.onmove=function(w){return this.onAny("move",w),!1},F.prototype.onend=function(w){return this.onAny("end",w),!1},F.prototype.oncancel=function(w){return this.onAny("end",w),!1},F.prototype.onAny=function(w,v){var I,P=this,u="processOn"+w.charAt(0).toUpperCase()+w.slice(1);return v=Y(v),j(v,(function(w){I=P.getIdentifier(w),j(P.collections,function(w,v,I){I.ids.indexOf(v)>=0&&(I[u](w),w._found_=!0)}.bind(null,w,I)),w._found_||P.removeIdentifier(I)})),!1},F.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach((function(w){w.destroy()})),this.off()},F.prototype.onDestroyed=function(w,v){if(this.collections.indexOf(v)<0)return!1;this.collections.splice(this.collections.indexOf(v),1)};var O=new F;v.default={create:function(w){return O.create(w)},factory:O}}]).default},78295:function(w,v,I){"use strict";I.r(v),I.d(v,{default:function(){return Q}});var P=I(96137),u=I.n(P);function Q(w){var v=[];return{name:"collideEntities",order:70,state:{cylinder:!1,collideBits:1,collideMask:1,callback:null,widthExpandAmt:0,heightExpandAmt:0},onAdd:null,onRemove:null,system:function(P,Q){for(var K=w.ents,a=0;a<Q.length;a++){var U=Q[a].__id,p=K.getPositionData(U),r=Q[a].widthExpandAmt/2,Y=Q[a].heightExpandAmt/2;v[a]=[p._extents[0]-r,p._extents[1]-Y,p._extents[2]-r,p._extents[3]+r,p._extents[4]+Y,p._extents[5]+r]}v.length=Q.length,u()(v,(function(P,u){var K=Q[P],a=Q[u];K&&a&&(function(w,v,P,u){if(w.cylinder)return v.cylinder?function(w,v){var I=(w[3]-w[0])/2,P=(v[3]-v[0])/2,u=w[0]+I-(v[0]+P),Q=w[2]+I-(v[2]+P),K=I+P;return u*u+Q*Q<=K*K}(P,u):I(P,u);if(v.cylinder)return I(u,P);return!0}(K,a,v[P],v[u])&&function(w,v,I){var P=v.__id,u=I.__id;v.collideMask&I.collideBits&&v.callback&&v.callback(u);I.collideMask&v.collideBits&&I.callback&&I.callback(P);w.ents.onPairwiseEntityCollision(P,u)}(w,K,a))}))}};function I(w,v){var I=(w[3]-w[0])/2,u=w[0]+I,Q=w[2]+I,K=P(u,v[0],v[3])-u,a=P(Q,v[2],v[5])-Q;return K*K+a*a<=I*I}function P(w,v,I){return w<v?v:w>I?I:w}}},28506:function(w,v,I){"use strict";function P(w){return{name:"collideTerrain",order:0,state:{callback:null},onAdd:function(v,I){var P=w.entities;P.hasPhysics(v)&&(P.getPhysics(v).body.onCollide=function(I){var P=w.ents.getCollideTerrain(v).callback;P&&P(I,v)})},onRemove:function(v,I){var P=w.entities;P.hasPhysics(v)&&(P.getPhysics(v).body.onCollide=null)}}}I.r(v),I.d(v,{default:function(){return P}})},70183:function(w,v,I){"use strict";function P(w){return{name:"fadeOnZoom",order:99,state:{cutoff:1.5},onAdd:null,onRemove:null,system:function(v,I){for(var P=w.camera.currentZoom,Q=w.entities,K=0;K<I.length;K++)u(I[K],P,Q)}}}function u(w,v,I){if(I.hasMesh(w.__id)){var P=v>w.cutoff;I.getMeshData(w.__id).mesh.visibility=P}}I.r(v),I.d(v,{default:function(){return P}})},72384:function(w,v,I){"use strict";I.r(v),I.d(v,{default:function(){return Q}});var P=I(47077),u=I.n(P);function Q(w){return{name:"followsEntity",order:50,state:{entity:0,offset:null,onTargetMissing:null},onAdd:function(w,P){var Q=u().create();P.offset=P.offset?u().copy(Q,P.offset):Q,v(P),I(P)},onRemove:null,system:function(w,I){for(var P=0;P<I.length;P++)v(I[P])},renderSystem:function(w,v){for(var P=0;P<v.length;P++)I(v[P])}};function v(v){var I=v.__id,P=w.ents.getPositionData(I),Q=w.ents.getPositionData(v.entity);Q?u().add(P._localPosition,Q._localPosition,v.offset):(v.onTargetMissing&&v.onTargetMissing(I),w.ents.removeComponent(I,w.ents.names.followsEntity))}function I(v){var I=v.__id,P=w.ents.getPositionData(I),Q=w.ents.getPositionData(v.entity);Q&&u().add(P._renderPosition,Q._renderPosition,v.offset)}}},21235:function(w,v,I){"use strict";I.r(v),I.d(v,{default:function(){return Q}});var P=I(47077),u=I.n(P);function Q(w){return{name:"mesh",order:100,state:{mesh:null,offset:null,isPickable:!1,shouldAddMeshToScene:!0},onAdd:function(v,I){var P=w.ents.getPositionData(v);if(!I.mesh)throw new Error("Mesh component added without a mesh - probably a bug!");I.shouldAddMeshToScene&&w.rendering.addMeshToScene(I.mesh,!1,P.position,null,I.isPickable),I.offset||(I.offset=u().create());var Q=P._renderPosition;I.mesh.position.copyFromFloats(Q[0]+I.offset[0],Q[1]+I.offset[1],Q[2]+I.offset[2])},onRemove:function(w,v){v.mesh.dispose()},renderSystem:function(v,I){for(var P=0;P<I.length;P++){var u=I[P],Q=u.__id,K=w.ents.getPositionData(Q)._renderPosition;u.mesh.position.copyFromFloats(K[0]+u.offset[0],K[1]+u.offset[1],K[2]+u.offset[2])}}}}},66953:function(w,v,I){"use strict";I.r(v),I.d(v,{PhysicsState:function(){return a},default:function(){return U},setPhysicsFromPosition:function(){return r},setPositionFromPhysics:function(){return Y}});var P=I(43144),u=I(15671),Q=I(47077),K=I.n(Q),a=(0,P.c)((function w(){(0,u.e)(this,w),this.body=null}));function U(w){return{name:"physics",order:40,state:new a,onAdd:function(v,I){I.body=w.physics.addBody(),r(I,w.ents.getPositionData(I.__id))},onRemove:function(v,I){if(w.ents.hasPosition(I.__id)){var P=w.ents.getPositionData(I.__id);Y(I,P),g(I,P,0,!1)}w.physics.removeBody(I.body)},system:function(v,I){for(var P=0;P<I.length;P++){var u=I[P];Y(u,w.ents.getPositionData(u.__id))}},renderSystem:function(v,I){for(var P=w.positionInCurrentTick,u=1e3/w.container._shell.tickRate,Q=P*(u*=w.timeScale),K=Math.min((Q-u)/1e3,0),a=0;a<I.length;a++){var U=I[a],p=U.__id;g(U,w.ents.getPositionData(p),K,w.ents.cameraSmoothed(p))}}}}var p=K().create();function r(w,v){var I=w.body.aabb,P=v._extents;K().copy(I.base,P),K().set(I.vec,v.width,v.height,v.width),K().add(I.max,I.base,I.vec)}function Y(w,v){var I=w.body.aabb.base,P=v.width/2;K().set(v._localPosition,I[0]+P,I[1],I[2]+P)}function g(w,v,I,P){var u=w.body.velocity;K().scaleAndAdd(p,v._localPosition,u,I),P&&K().lerp(p,v._renderPosition,p,.3),K().copy(v._renderPosition,p)}},89:function(w,v,I){"use strict";I.r(v),I.d(v,{PositionState:function(){return K},default:function(){return a},updatePositionExtents:function(){return U}});var P=I(43144),u=I(15671),Q=I(47077),K=(0,P.c)((function w(){(0,u.e)(this,w),this.position=null,this.width=.8,this.height=.8,this._localPosition=null,this._renderPosition=null,this._extents=null}));function a(w){return{name:"position",order:41,state:new K,onAdd:function(v,I){var P=[0,0,0];I.position&&Q.copy(P,I.position),I.position=P,I._localPosition=Q.create(),I._renderPosition=Q.create(),I._extents=new Float32Array(6),w.globalToLocal(I.position,null,I._localPosition),Q.copy(I._renderPosition,I._localPosition),U(I)},onRemove:null,system:function(v,I){for(var P=w.worldOriginOffset,u=0;u<I.length;u++){var K=I[u];Q.add(K.position,K._localPosition,P),U(K)}}}}function U(w){var v=w.width/2,I=w._localPosition,P=w._extents;P[0]=I[0]-v,P[1]=I[1],P[2]=I[2]-v,P[3]=I[0]+v,P[4]=I[1]+w.height,P[5]=I[2]+v}},88044:function(w,v,I){"use strict";I.r(v),I.d(v,{default:function(){return K}});var P=I(9488),u=I(60612),Q=(I(35941),I(47077));function K(w,v){var I=v,Q=w.rendering.getScene(),K=(0,u.e)("shadow",{radius:.75,tessellation:30},Q);K.rotation.x=Math.PI/2;var a=w.rendering.makeStandardMaterial("shadowMat");return a.diffuseColor=P.b.Black(),a.ambientColor=P.b.Black(),a.alpha=.5,K.material=a,K.setEnabled(!1),a.freeze(),K.alwaysSelectAsActiveMesh=!0,K.doNotSyncBoundingInfo=!0,Q.removeMesh(K),{name:"shadow",order:80,state:{size:.5,_mesh:null,enabledCombinator:null},onAdd:function(v,I){var P=K.createInstance("shadow_instance");w.rendering.addMeshToScene(P),P.alwaysSelectAsActiveMesh=!0,P.doNotSyncBoundingInfo=!0,I._mesh=P,P.setEnabled(!1)},onRemove:function(w,v){v._mesh.dispose()},system:function(v,P){for(var u=w.camera._localGetPosition(),Q=I,K=0;K<P.length;K++){var a=P[K],U=w.ents.getPositionData(a.__id),r=w.ents.getPhysics(a.__id);p(w,U,r,a._mesh,a.size,Q,u,a.enabledCombinator)}},renderSystem:function(v,I){for(var P=0;P<I.length;P++){var u=I[P],Q=w.ents.getPositionData(u.__id)._renderPosition,K=u._mesh.position;K.x=Q[0],K.z=Q[2]}}}}var a=Q.fromValues(0,0,0),U=Q.fromValues(0,-1,0);function p(w,v,I,P,u,K,p,r){var Y;if(I&&(I.body.resting[1]<0||Number.isInteger(v._renderPosition[1])))Y=v._renderPosition[1];else{var g=w._localPick(v._renderPosition,U,K);if(!g){if(r){var J=r.setBooleanType("placeToPutShadowExists",!1);P.setEnabled(J)}else P.setEnabled(!1);return}Y=g.position[1]-w.worldOriginOffset[1]}Y=Math.round(Y),Q.copy(a,v._localPosition),a[1]=Y;var l=.01+Q.squaredDistance(p,a)/1600*.1;l>.1&&(l=.1),P.position.y=Y+l;var R=.7*u*(1-(v._localPosition[1]-Y)/K);if(P.scaling.copyFromFloats(R,R,R),r){var x=r.setBooleanType("placeToPutShadowExists",!0);P.setEnabled(x)}else P.setEnabled(!0)}},69448:function(w,v,I){"use strict";function P(w){var v="smoothCamera";return{name:v,order:99,state:{time:100.1},onAdd:null,onRemove:null,system:function(I,P){for(var u=0;u<P.length;u++){var Q=P[u];Q.time-=I,Q.time<0&&w.ents.removeComponent(Q.__id,v)}}}}I.r(v),I.d(v,{default:function(){return P}})},18114:function(w,v,I){"use strict";I.d(v,{e:function(){return yv}});var P=I(15671),u=I(43144),Q=I(97326),K=I(60136),a=I(43668),U=(I(51810),I(68041)),p=I(47077),r=I.n(p),Y=I(47786),g=I.n(Y),J=I(97413),l=I.n(J),R=(0,u.c)((function w(v){var I=this,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,P.e)(this,w),this.stickyPointerLock=!1,this.stickyFullscreen=!1,this.tickRate=30,this.maxRenderRate=0,this.pointerLock=!1,this.fullscreen=!1,this.onTick=function(w){},this.onRender=function(){},this.onInit=function(){},this.onResize=function(){},this.onPointerLockChanged=function(w){},this.onFullscreenChanged=function(w){},i((function(){x(I,u),B(I,v),I.onInit()}))}));function x(w,v){w._nowObject=performance||Date,w._lastTick=0,w._renderAccum=0,w._rt=0,w._frameCB=s.bind(null,w),requestAnimationFrame(w._frameCB),v>0&&(w._intervalCB=j.bind(null,w),w._interval=setInterval(w._intervalCB,Math.max(v,1e3/w.tickRate/2)))}function j(w){for(var v=1e3/w.tickRate,I=w._nowObject.now()+20,P=0;w._nowObject.now()>=w._lastTick+v&&w._nowObject.now()<I&&++P<=3;)w.onTick(v),w._lastTick+=v;var u=5*(v+5),Q=w._nowObject.now();if(Q-w._lastTick>u)for(;Q>=w._lastTick+v;)w._lastTick+=v}function s(w){requestAnimationFrame(w._frameCB),j(w);var v=w._nowObject.now(),I=v-w._rt;if(w._rt=v,w.maxRenderRate>0){w._renderAccum+=I;var P=1e3/w.maxRenderRate;if(w._renderAccum<P)return;w._renderAccum=Math.min(w._renderAccum-P,P)}var u=1e3/w.tickRate,Q=(v-w._lastTick)/u;w.onRender(I,Q,u)}function B(w,v){if(v){var I=!1,P=!1;document.addEventListener("pointerlockchange",(function(P){I=document.pointerLockElement===v,w.onPointerLockChanged(I)})),document.addEventListener("fullscreenchange",(function(I){P=document.fullscreenElement===v,w.onFullscreenChanged(P)})),Object.defineProperty(w,"pointerLock",{get:function(){return I},set:function(w){w&&!I?t(v):I&&!w&&function(w){w.exitPointerLock&&w.exitPointerLock()}(document)}}),Object.defineProperty(w,"fullscreen",{get:function(){return P},set:function(w){w&&!P?v.requestFullscreen():P&&!w&&document.exitFullscreen()}}),v.addEventListener("click",(function(u){w.stickyPointerLock&&!I&&t(v),w.stickyFullscreen&&!P&&v.requestFullscreen()}));var u=function(){return w.onResize()};if(window.ResizeObserver)new ResizeObserver(u).observe(v);else window.addEventListener("resize",u)}}function t(w){w.requestPointerLock&&w.requestPointerLock()}var i=function(w){if("loading"===document.readyState){document.addEventListener("readystatechange",(function v(){document.removeEventListener("readystatechange",v),w()}))}else setTimeout(w,1)},z=function(w){(0,K.e)(I,w);var v=(0,a.d)(I);function I(w,u){var K;(0,P.e)(this,I),u=u||{},(K=v.call(this)).noa=w;var a=u.domElement||null;"string"===typeof a&&(a=document.querySelector(a)),K.element=a||function(){var w=document.createElement("div");return w.tabIndex=1,w.style.position="fixed",w.style.left="0px",w.style.right="0px",w.style.top="0px",w.style.bottom="0px",w.style.height="100%",w.style.overflow="hidden",document.body.appendChild(w),document.body.style.height="100%",w.id="noa-container",w}(),K.canvas=function(w){var v=w.querySelector("canvas");v||((v=document.createElement("canvas")).style.position="absolute",v.style.left="0px",v.style.top="0px",v.style.height="100%",v.style.width="100%",v.id="noa-canvas",w.insertBefore(v,w.firstChild));return v}(K.element),function(w){var v=5,I=setInterval((function(){var P=w.width;w.width=P+1,w.width=P,v--<0&&clearInterval(I)}),100)}(K.canvas),K.supportsPointerLock=!1,K.pointerInGame=!1,K.isFocused=!!document.hasFocus(),K.hasPointerLock=!1;return K._shell=new R(K.element,10),K._shell.tickRate=u.tickRate,K._shell.maxRenderRate=u.maxRenderRate,K._shell.stickyPointerLock=u.stickyPointerLock,K._shell.stickyFullscreen=u.stickyFullscreen,K._shell.onTick=w.tick.bind(w),K._shell.onRender=w.render.bind(w),K._shell.onPointerLockChanged=function(w){K.hasPointerLock=w,K.emit(w?"gainedPointerLock":"lostPointerLock"),w&&(K.pointerInGame=!0)},K._shell.onInit=function(){K._shell.onResize=w.rendering.resize.bind(w.rendering),function(w){if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){w.supportsPointerLock=!0;var v=function v(I){w.supportsPointerLock=!1,document.removeEventListener(I.type,v)};document.addEventListener("touchmove",v)}}((0,Q.d)(K)),K.element.addEventListener("mouseenter",(function(){K.pointerInGame=!0})),K.element.addEventListener("mouseleave",(function(){K.pointerInGame=!1})),window.addEventListener("focus",(function(){K.isFocused=!0})),window.addEventListener("blur",(function(){K.isFocused=!1}));K.element.addEventListener("mousedown",(function w(){K.pointerInGame=!0,K.isFocused=!0,K.element.removeEventListener("mousedown",w)})),K.emit("DOMready"),K._shell.onInit=null},K}return(0,u.c)(I,[{key:"appendTo",value:function(w){this.element.appendChild(w)}},{key:"setPointerLock",value:function(){var w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._shell.pointerLock=!!w}}]),I}(U.EventEmitter);var E=I(80105),o=I(21901),h=I(86724),n=function(){function w(w,v,I,P,u,Q){this.entries=new Array,this._boundingVectors=new Array,this._capacity=I,this._depth=P,this._maxDepth=u,this._creationFunc=Q,this._minPoint=w,this._maxPoint=v,this._boundingVectors.push(w.clone()),this._boundingVectors.push(v.clone()),this._boundingVectors.push(w.clone()),this._boundingVectors[2].x=v.x,this._boundingVectors.push(w.clone()),this._boundingVectors[3].y=v.y,this._boundingVectors.push(w.clone()),this._boundingVectors[4].z=v.z,this._boundingVectors.push(v.clone()),this._boundingVectors[5].z=w.z,this._boundingVectors.push(v.clone()),this._boundingVectors[6].x=w.x,this._boundingVectors.push(v.clone()),this._boundingVectors[7].y=w.y}return Object.defineProperty(w.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!1,configurable:!0}),w.prototype.addEntry=function(w){if(this.blocks)for(var v=0;v<this.blocks.length;v++){this.blocks[v].addEntry(w)}else this._creationFunc(w,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},w.prototype.removeEntry=function(w){if(this.blocks)for(var v=0;v<this.blocks.length;v++){this.blocks[v].removeEntry(w)}else{var I=this.entries.indexOf(w);I>-1&&this.entries.splice(I,1)}},w.prototype.addEntries=function(w){for(var v=0;v<w.length;v++){var I=w[v];this.addEntry(I)}},w.prototype.select=function(w,v,I){if(h.e.IsInFrustum(this._boundingVectors,w)){if(this.blocks){for(var P=0;P<this.blocks.length;P++){this.blocks[P].select(w,v,I)}return}I?v.concat(this.entries):v.concatWithNoDuplicate(this.entries)}},w.prototype.intersects=function(w,v,I,P){if(h.e.IntersectsSphere(this._minPoint,this._maxPoint,w,v)){if(this.blocks){for(var u=0;u<this.blocks.length;u++){this.blocks[u].intersects(w,v,I,P)}return}P?I.concat(this.entries):I.concatWithNoDuplicate(this.entries)}},w.prototype.intersectsRay=function(w,v){if(w.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var I=0;I<this.blocks.length;I++){this.blocks[I].intersectsRay(w,v)}return}v.concatWithNoDuplicate(this.entries)}},w.prototype.createInnerBlocks=function(){w._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},w._CreateBlocks=function(v,I,P,u,Q,K,a,U){a.blocks=new Array;for(var p=new E.l((I.x-v.x)/2,(I.y-v.y)/2,(I.z-v.z)/2),r=0;r<2;r++)for(var Y=0;Y<2;Y++)for(var g=0;g<2;g++){var J=new w(v.add(p.multiplyByFloats(r,Y,g)),v.add(p.multiplyByFloats(r+1,Y+1,g+1)),u,Q+1,K,U);J.addEntries(P),a.blocks.push(J)}},w}(),W=function(){function w(w,v,I){void 0===I&&(I=2),this.maxDepth=I,this.dynamicContent=new Array,this._maxBlockCapacity=v||64,this._selectionContent=new o.c(1024),this._creationFunc=w}return w.prototype.update=function(w,v,I){n._CreateBlocks(w,v,I,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},w.prototype.addMesh=function(w){for(var v=0;v<this.blocks.length;v++){this.blocks[v].addEntry(w)}},w.prototype.removeMesh=function(w){for(var v=0;v<this.blocks.length;v++){this.blocks[v].removeEntry(w)}},w.prototype.select=function(w,v){this._selectionContent.reset();for(var I=0;I<this.blocks.length;I++){this.blocks[I].select(w,this._selectionContent,v)}return v?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},w.prototype.intersects=function(w,v,I){this._selectionContent.reset();for(var P=0;P<this.blocks.length;P++){this.blocks[P].intersects(w,v,this._selectionContent,I)}return I?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},w.prototype.intersectsRay=function(w){this._selectionContent.reset();for(var v=0;v<this.blocks.length;v++){this.blocks[v].intersectsRay(w,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},w.CreationFuncForMeshes=function(w,v){var I=w.getBoundingInfo();!w.isBlocked&&I.boundingBox.intersectsMinMax(v.minPoint,v.maxPoint)&&v.entries.push(w)},w.CreationFuncForSubMeshes=function(w,v){w.getBoundingInfo().boundingBox.intersectsMinMax(v.minPoint,v.maxPoint)&&v.entries.push(w)},w}(),V=I(37105),F=I(52644),O=I(11126),N=I(21693),q=I(78588);V.d.prototype.createOrUpdateSelectionOctree=function(w,v){void 0===w&&(w=64),void 0===v&&(v=2);var I=this._getComponent(N.c.NAME_OCTREE);I||(I=new m(this),this._addComponent(I)),this._selectionOctree||(this._selectionOctree=new W(W.CreationFuncForMeshes,w,v));var P=this.getWorldExtends();return this._selectionOctree.update(P.min,P.max,this.meshes),this._selectionOctree},Object.defineProperty(V.d.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),F.b.prototype.createOrUpdateSubmeshesOctree=function(w,v){void 0===w&&(w=64),void 0===v&&(v=2);var I=this.getScene(),P=I._getComponent(N.c.NAME_OCTREE);P||(P=new m(I),I._addComponent(P)),this._submeshesOctree||(this._submeshesOctree=new W(W.CreationFuncForSubMeshes,w,v)),this.computeWorldMatrix(!0);var u=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(u.minimumWorld,u.maximumWorld,this.subMeshes),this._submeshesOctree};var m=function(){function w(w){this.name=N.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new O.d(E.l.Zero(),new E.l(1,1,1)),(w=w||q.e.LastCreatedScene)&&(this.scene=w,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this))}return w.prototype.register=function(){var w=this;this.scene.onMeshRemovedObservable.add((function(v){var I=w.scene.selectionOctree;if(void 0!==I&&null!==I){var P=I.dynamicContent.indexOf(v);-1!==P&&I.dynamicContent.splice(P,1)}})),this.scene.onMeshImportedObservable.add((function(v){var I=w.scene.selectionOctree;void 0!==I&&null!==I&&I.addMesh(v)}))},w.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},w.prototype.getActiveSubMeshCandidates=function(w){return w._submeshesOctree&&w.useOctreeForRenderingSelection?w._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(w)},w.prototype.getIntersectingSubMeshCandidates=function(w,v){return w._submeshesOctree&&w.useOctreeForPicking?(O.d.TransformToRef(v,w.getWorldMatrix(),this._tempRay),w._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(w)},w.prototype.getCollidingSubMeshCandidates=function(w,v){if(w._submeshesOctree&&w.useOctreeForCollisions){var I=v._velocityWorldLength+Math.max(v._radius.x,v._radius.y,v._radius.z);return w._submeshesOctree.intersects(v._basePointWorld,I)}return this.scene._getDefaultSubMeshCandidates(w)},w.prototype.rebuild=function(){},w.prototype.dispose=function(){},w}(),c=I(65596),M=(0,u.c)((function w(v,I){(0,P.e)(this,w);var u=v._scene;u._addComponent(new m(u));var Q=new W(a);u._selectionOctree=Q,Q.blocks=[];var K={};this.rebase=function(w){p(Q,w)},this.includesMesh=function(w){return!!w.metadata&&(void 0!==w.metadata._noaContainingBlockId||w.metadata._noaIsDynamicContent)},this.addMesh=function(w,I,P){if(!I)return w.metadata._noaIsDynamicContent=!0,void Q.dynamicContent.push(w);var u=Math.floor(P[0]/U),a=Math.floor(P[1]/U),p=Math.floor(P[2]/U),Y=(0,c.h)(u,a,p),g=K[Y];if(!g){var J=[u*U,a*U,p*U],l=[0,0,0];v.noa.globalToLocal(J,null,l),g=r(l,U),Q.blocks.push(g),K[Y]=g}g.entries.push(w),w.metadata._noaContainingBlockId=Y,w.alwaysSelectAsActiveMesh=!0},this.removeMesh=function(w){if(w.metadata._noaIsDynamicContent&&(w.metadata._noaIsDynamicContent=null,(0,c.q)(Q.dynamicContent,w)),void 0!==w.metadata._noaContainingBlockId){var v=K[w.metadata._noaContainingBlockId];(0,c.q)(v.entries,w),0===v.entries.length&&(delete K[w.metadata._noaContainingBlockId],(0,c.q)(Q.blocks,v))}};var a=function(){},U=I*v.noa.world._chunkSize,p=function w(v,I){v.blocks.forEach((function(v){v.minPoint.subtractInPlace(I),v.maxPoint.subtractInPlace(I),v._boundingVectors.forEach((function(w){return w.subtractInPlace(I)})),v.blocks&&w(v,I)}))},r=function(w,v){var I=new E.l(w[0],w[1],w[2]),P=new E.l(w[0]+v,w[1]+v,w[2]+v);return new n(I,P,void 0,void 0,void 0,a)}})),S=I(35958),e=(I(15099),I(84468),I(90673),I(35941),I(82325),I(16708),I(44811),I(90690)),H=I(78502),G=I(9127),L=I(60766),d=I(82419),D=I(30899),f=I(61803),b=I(52311),k=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},C=(function(w){function v(v){void 0===v&&(v=new k);var I=w.call(this,null)||this;e.d.Instances.push(I),void 0===v.deterministicLockstep&&(v.deterministicLockstep=!1),void 0===v.lockstepMaxSteps&&(v.lockstepMaxSteps=4),I._options=v,D.c.SetMatrixPrecision(!!v.useHighPrecisionMatrix),I._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,supportOcclusionQuery:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1,canUseGLInstanceID:!1,canUseGLVertexID:!1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:!1,textureMaxLevel:!1,texture2DArrayMaxLayerCount:128},I._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:!1,supportDepthStencilTexture:!1,supportShadowSamplers:!1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:!1,basisNeedsPOT:!1,support3DTextures:!1,needTypeSuffixInShaderConstants:!1,supportMSAA:!1,supportSSAO2:!1,supportExtendedTextureFormats:!1,supportSwitchCaseInShader:!1,supportSyncTextureRead:!1,needsInvertingBitmap:!1,useUBOBindingCache:!1,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!0,_collectUbosUpdatedInFrame:!1},G.e.Log("Babylon.js v".concat(e.d.Version," - Null engine"));var P="undefined"!==typeof self?self:"undefined"!==typeof global?global:window;return"undefined"===typeof URL&&(P.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"===typeof Blob&&(P.Blob=function(){}),I}(0,H.m)(v,w),v.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},v.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},v.prototype.getHardwareScalingLevel=function(){return 1},v.prototype.createVertexBuffer=function(w){var v=new d.c;return v.references=1,v},v.prototype.createIndexBuffer=function(w){var v=new d.c;return v.references=1,v},v.prototype.clear=function(w,v,I,P){void 0===P&&(P=!1)},v.prototype.getRenderWidth=function(w){return void 0===w&&(w=!1),!w&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},v.prototype.getRenderHeight=function(w){return void 0===w&&(w=!1),!w&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},v.prototype.setViewport=function(w,v,I){this._cachedViewport=w},v.prototype.createShaderProgram=function(w,v,I,P,u){return{__SPECTOR_rebuildProgram:null}},v.prototype.getUniforms=function(w,v){return[]},v.prototype.getAttributes=function(w,v){return[]},v.prototype.bindSamplers=function(w){this._currentEffect=null},v.prototype.enableEffect=function(w){w=null!==w&&f.c.IsWrapper(w)?w.effect:w,this._currentEffect=w,w&&(w.onBind&&w.onBind(w),w._onBindObservable&&w._onBindObservable.notifyObservers(w))},v.prototype.setState=function(w,v,I,P,u,Q,K){void 0===v&&(v=0),void 0===P&&(P=!1),void 0===K&&(K=0)},v.prototype.setIntArray=function(w,v){return!0},v.prototype.setIntArray2=function(w,v){return!0},v.prototype.setIntArray3=function(w,v){return!0},v.prototype.setIntArray4=function(w,v){return!0},v.prototype.setFloatArray=function(w,v){return!0},v.prototype.setFloatArray2=function(w,v){return!0},v.prototype.setFloatArray3=function(w,v){return!0},v.prototype.setFloatArray4=function(w,v){return!0},v.prototype.setArray=function(w,v){return!0},v.prototype.setArray2=function(w,v){return!0},v.prototype.setArray3=function(w,v){return!0},v.prototype.setArray4=function(w,v){return!0},v.prototype.setMatrices=function(w,v){return!0},v.prototype.setMatrix3x3=function(w,v){return!0},v.prototype.setMatrix2x2=function(w,v){return!0},v.prototype.setFloat=function(w,v){return!0},v.prototype.setFloat2=function(w,v,I){return!0},v.prototype.setFloat3=function(w,v,I,P){return!0},v.prototype.setBool=function(w,v){return!0},v.prototype.setFloat4=function(w,v,I,P,u){return!0},v.prototype.setAlphaMode=function(w,v){void 0===v&&(v=!1),this._alphaMode!==w&&(this.alphaState.alphaBlend=0!==w,v||this.setDepthWrite(0===w),this._alphaMode=w)},v.prototype.bindBuffers=function(w,v,I){},v.prototype.wipeCaches=function(w){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,w&&(this._currentProgram=null,this._stencilStateComposer.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},v.prototype.draw=function(w,v,I,P){},v.prototype.drawElementsType=function(w,v,I,P){},v.prototype.drawArraysType=function(w,v,I,P){},v.prototype._createTexture=function(){return{}},v.prototype._releaseTexture=function(w){},v.prototype.createTexture=function(w,v,I,P,u,Q,K,a,U,p,r,Y){void 0===u&&(u=3),void 0===Q&&(Q=null),void 0===K&&(K=null),void 0===a&&(a=null),void 0===U&&(U=null),void 0===p&&(p=null),void 0===r&&(r=null);var g=new L.h(this,L.e.Url),J=String(w);return g.url=J,g.generateMipMaps=!v,g.samplingMode=u,g.invertY=I,g.baseWidth=this._options.textureSize,g.baseHeight=this._options.textureSize,g.width=this._options.textureSize,g.height=this._options.textureSize,p&&(g.format=p),g.isReady=!0,Q&&setTimeout((function(){Q(g)})),this._internalTexturesCache.push(g),g},v.prototype._createHardwareRenderTargetWrapper=function(w,v,I){var P=new b.e(w,v,I,this);return this._renderTargetWrapperCache.push(P),P},v.prototype.createRenderTargetTexture=function(w,v){var I=this._createHardwareRenderTargetWrapper(!1,!1,w),P={};void 0!==v&&"object"===typeof v?(P.generateMipMaps=v.generateMipMaps,P.generateDepthBuffer=void 0===v.generateDepthBuffer||v.generateDepthBuffer,P.generateStencilBuffer=P.generateDepthBuffer&&v.generateStencilBuffer,P.type=void 0===v.type?0:v.type,P.samplingMode=void 0===v.samplingMode?3:v.samplingMode):(P.generateMipMaps=v,P.generateDepthBuffer=!0,P.generateStencilBuffer=!1,P.type=0,P.samplingMode=3);var u=new L.h(this,L.e.RenderTarget),Q=w.width||w,K=w.height||w;return I._generateDepthBuffer=P.generateDepthBuffer,I._generateStencilBuffer=!!P.generateStencilBuffer,u.baseWidth=Q,u.baseHeight=K,u.width=Q,u.height=K,u.isReady=!0,u.samples=1,u.generateMipMaps=!!P.generateMipMaps,u.samplingMode=P.samplingMode,u.type=P.type,this._internalTexturesCache.push(u),I},v.prototype.updateTextureSamplingMode=function(w,v){v.samplingMode=w},v.prototype.createRawTexture=function(w,v,I,P,u,Q,K,a,U,p,r){void 0===a&&(a=null),void 0===U&&(U=0),void 0===p&&(p=0),void 0===r&&(r=!1);var Y=new L.h(this,L.e.Raw);return Y.baseWidth=v,Y.baseHeight=I,Y.width=v,Y.height=I,Y.format=P,Y.generateMipMaps=u,Y.samplingMode=K,Y.invertY=Q,Y._compression=a,Y.type=U,Y._useSRGBBuffer=r,this._doNotHandleContextLost||(Y._bufferView=w),Y},v.prototype.updateRawTexture=function(w,v,I,P,u,Q,K){void 0===u&&(u=null),void 0===Q&&(Q=0),void 0===K&&(K=!1),w&&(w._bufferView=v,w.format=I,w.invertY=P,w._compression=u,w.type=Q,w._useSRGBBuffer=K)},v.prototype.bindFramebuffer=function(w,v,I,P,u){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=w,this._currentFramebuffer=null,this._cachedViewport&&!u&&this.setViewport(this._cachedViewport,I,P)},v.prototype.unBindFramebuffer=function(w,v,I){void 0===v&&(v=!1),this._currentRenderTarget=null,I&&I(),this._currentFramebuffer=null},v.prototype.createDynamicVertexBuffer=function(w){var v=new d.c;return v.references=1,v.capacity=1,v},v.prototype.updateDynamicTexture=function(w,v,I,P,u){void 0===P&&(P=!1)},v.prototype.areAllEffectsReady=function(){return!0},v.prototype.getError=function(){return 0},v.prototype._getUnpackAlignement=function(){return 1},v.prototype._unpackFlipY=function(w){},v.prototype.updateDynamicIndexBuffer=function(w,v,I){void 0===I&&(I=0)},v.prototype.updateDynamicVertexBuffer=function(w,v,I,P){},v.prototype._bindTextureDirectly=function(w,v){return this._boundTexturesCache[this._activeChannel]!==v&&(this._boundTexturesCache[this._activeChannel]=v,!0)},v.prototype._bindTexture=function(w,v){w<0||this._bindTextureDirectly(0,v)},v.prototype._deleteBuffer=function(w){},v.prototype.releaseEffects=function(){},v.prototype.displayLoadingUI=function(){},v.prototype.hideLoadingUI=function(){},Object.defineProperty(v.prototype,"loadingUIText",{set:function(w){},enumerable:!1,configurable:!0}),v.prototype._uploadCompressedDataToTextureDirectly=function(w,v,I,P,u,Q,K){void 0===Q&&(Q=0),void 0===K&&(K=0)},v.prototype._uploadDataToTextureDirectly=function(w,v,I,P){void 0===I&&(I=0),void 0===P&&(P=0)},v.prototype._uploadArrayBufferViewToTexture=function(w,v,I,P){void 0===I&&(I=0),void 0===P&&(P=0)},v.prototype._uploadImageToTexture=function(w,v,I,P){void 0===I&&(I=0),void 0===P&&(P=0)}}(e.d),I(23056)),y=I(87683),T=I(9488),Z=I(77129),A=I(55706),X=I(49620),ww={showFPS:!1,antiAlias:!0,clearColor:[.8,.9,1],ambientColor:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],groundLightColor:[.5,.5,.5],useAO:!0,AOmultipliers:[.93,.8,.5],reverseAOmultiplier:1,preserveDrawingBuffer:!0,octreeBlockSize:2,renderOnResize:!0};function vw(){this.markAsDirtyOnRebase=!1,this.eId=null,this.gltf=null,this._noaIsDynamicContent=!1,this._noaContainingBlockId=void 0}var Iw=function(){function w(v,I,u){(0,P.e)(this,w),I=Object.assign({},ww,I),this.noa=v,this.renderOnResize=!!I.renderOnResize,this.useAO=!!I.useAO,this.aoVals=I.AOmultipliers,this.revAoVal=I.reverseAOmultiplier,this.meshingCutoffTime=6,this._scene=null,this._engine=null,this._octreeManager=null,this.initScene(u,I),this.MeshMetadataType=vw,this._highlightMesh=null,I.showFPS&&function(){var w=document.createElement("div");w.id="noa_fps",w.style.position="absolute",w.style.top="0",w.style.right="0",w.style.zIndex="0",w.style.color="white",w.style.backgroundColor="rgba(0,0,0,0.5)",w.style.font="14px monospace",w.style.textAlign="center",w.style.minWidth="2em",w.style.margin="4px",document.body.appendChild(w);var v=1e3,I=0,P=0,u=performance.now(),Q=u;Qw=function(){I++;var K=performance.now();if(K-Q>P&&(P=K-Q),Q=K,!(K-u<v)){var a=Math.round(I/(K-u)*1e3),U=Math.round(1/P*1e3);w.innerHTML=a+"<br>"+U,I=0,P=0,u=K}}}()}return(0,u.c)(w,[{key:"initScene",value:function(w,v){this._engine=new e.d(w,v.antiAlias,{preserveDrawingBuffer:v.preserveDrawingBuffer}),this._scene=new V.d(this._engine);var I=this._scene;I.detachControl();var P=Math.round(v.octreeBlockSize);this._octreeManager=new M(this,P),this._cameraHolder=new Z.d("camHolder",I),this._camera=new S.e("camera",new E.l(0,0,0),I),this._camera.parent=this._cameraHolder,this._camera.minZ=.01,this._camScreen=(0,X.e)("camScreen",{size:10},I),this.addMeshToScene(this._camScreen),this._camScreen.position.z=.1,this._camScreen.parent=this._camera,this._camScreenMat=this.makeStandardMaterial("camscreenmat"),this._camScreen.material=this._camScreenMat,this._camScreen.setEnabled(!1),this._camScreenMat.freeze(),this._camLocBlock=0;var u=new E.l(.1,1,.3);function Q(w){return new T.b(w[0],w[1],w[2])}this._light=new C.c("light",u,I),I.clearColor=T.f.FromColor3(Q(v.clearColor)),I.ambientColor=Q(v.ambientColor),this._light.diffuse=Q(v.lightDiffuse),this._light.specular=Q(v.lightSpecular),this._light.groundColor=Q(v.groundLightColor),I.skipPointerMovePicking=!0}}]),w}();Iw.prototype.getScene=function(){return this._scene},Iw.prototype.tick=function(w){},Iw.prototype.render=function(){uw("start"),function(w){var v=w.noa.camera,I=v._localGetTargetPosition();w._cameraHolder.position.copyFromFloats(I[0],I[1],I[2]),w._cameraHolder.rotation.x=v.pitch,w._cameraHolder.rotation.y=v.heading,w._camera.position.z=-v.currentZoom;var P=v._localGetPosition(),u=w.noa.worldOriginOffset,Q=Math.floor(P[0]+u[0]),K=Math.floor(P[1]+u[1]),a=Math.floor(P[2]+u[2]),U=w.noa.getBlock(Q,K,a);!function(w,v){if(v===w._camLocBlock)return;if(0===v)w._camScreen.setEnabled(!1);else{var I=w.noa.registry.getBlockFaceMaterial(v,0);if(I){var P=w.noa.registry.getMaterialData(I),u=P.color,Q=P.alpha;u&&Q&&Q<1&&(w._camScreenMat.diffuseColor.set(0,0,0),w._camScreenMat.ambientColor.set(u[0],u[1],u[2]),w._camScreenMat.alpha=Q,w._camScreen.setEnabled(!0))}}w._camLocBlock=v}(w,U)}(this),uw("updateCamera"),this._engine.beginFrame(),uw("beginFrame"),this._scene.render(),uw("render"),Qw(),this._engine.endFrame(),uw("endFrame"),uw("end")},Iw.prototype.postRender=function(){},Iw.prototype.resize=function(){this._engine.resize(),this.noa._paused&&this.renderOnResize&&this._scene.render()},Iw.prototype.highlightBlockFace=function(w,v,I){var P=function(w){var v=w._highlightMesh;if(!v){v=(0,X.e)("highlight",{size:1},w._scene);var I=w.makeStandardMaterial("highlightMat");I.backFaceCulling=!1,I.emissiveColor=new T.b(1,1,1),I.alpha=.2,I.freeze(),v.material=I;var P=.5,u=(0,A.j)("hightlightLines",{points:[new E.l(P,P,0),new E.l(P,-P,0),new E.l(-P,-P,0),new E.l(-P,P,0),new E.l(P,P,0)]},w._scene);u.color=new T.b(1,1,1),u.parent=v,w.addMeshToScene(v),w.addMeshToScene(u),w._highlightMesh=v}return v}(this);if(w){this.noa.globalToLocal(v,null,Pw);for(var u=0;u<3;u++)Pw[u]+=.5;P.position.copyFromFloats(Pw[0],Pw[1],Pw[2])}P.setEnabled(w)};var Pw=[];Iw.prototype.addMeshToScene=function(w){var v=this,I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this._octreeManager.includesMesh(w)){if(!w.parent){P||(P=[w.position.x,w.position.y,w.position.z]);var Q=[];this.noa.globalToLocal(P,null,Q),w.position.copyFromFloats(Q[0],Q[1],Q[2])}I&&(w.freezeWorldMatrix(),w.freezeNormals&&w.freezeNormals(),w.doNotSyncBoundingInfo=!0),w.isPickable=u,w.metadata||(w.metadata=new vw),this._octreeManager.addMesh(w,I,P),w.onDisposeObservable.add((function(){v._octreeManager.removeMesh(w)}))}},Iw.prototype.makeStandardMaterial=function(w){var v=new y.b(w,this._scene);return v.specularColor.copyFromFloats(0,0,0),v.ambientColor.copyFromFloats(1,1,1),v.diffuseColor.copyFromFloats(1,1,1),this.postMaterialCreationHook(v),v},Iw.prototype.postMaterialCreationHook=function(w){w.freeze()},Iw.prototype.prepareChunkForRendering=function(w){},Iw.prototype.disposeChunkForRendering=function(w){},Iw.prototype._rebaseOrigin=function(w){var v=new E.l(w[0],w[1],w[2]);this._scene.meshes.forEach((function(w){w.parent||"__root__"===w.name||(w.position.subtractInPlace(v),w.metadata&&w.metadata.markAsDirtyOnRebase&&w.markAsDirty(),w.isWorldMatrixFrozen&&w.freezeWorldMatrix())})),this._octreeManager.rebase(v)},Iw.prototype.debug_SceneCheck=function(){var w=this._scene.meshes,v=this._scene._selectionOctree,I=v.dynamicContent,P=[],u=0,Q=0,K=this._scene.materials,a=[];K.forEach((function(w){w.subMaterials?w.subMaterials.forEach((function(w){return a.push(w)})):a.push(w)})),v.blocks.forEach((function(w){u++,w.entries.forEach((function(w){return P.push(w)}))})),w.forEach((function(w){if(w.isDisposed&&r(w,"disposed mesh in scene"),!function(w){return 0===w.getIndices().length}(w))if(Y(w,I,P)&&r(w,"non-empty mesh missing from octree"),w.material){Q+=w.subMeshes?w.subMeshes.length:1;var v=w.material.subMaterials||[w.material];v.forEach((function(w){Y(w,v)&&r(w,"mesh material not in scene")}))}else r(w,"non-empty scene mesh with no material")}));var U=[];a.forEach((function(v){var I=!1;w.forEach((function(w){(w.material===v&&(I=!0),w.material)&&((w.material.subMaterials||[w.material]).includes(v)&&(I=!0))})),I||U.push(v.name)})),U.length&&console.warn("Materials unused by any mesh: ",U.join(", ")),I.forEach((function(v){Y(v,w)&&r(v,"octree/dynamic mesh not in scene")})),P.forEach((function(v){Y(v,w)&&r(v,"octree block mesh not in scene")}));var p=Math.round(10*P.length/u)/10;function r(w,v){console.warn(w.name+" --- "+v)}function Y(w,v,I){return!!w&&(!v.includes(w)&&(!I||!I.includes(w)))}return console.log("meshes - octree:",P.length,"  dynamic:",I.length,"   subMeshes:",Q,"   avg meshes/octreeBlock:",p),"done."},Iw.prototype.debug_MeshCount=function(){var w={};for(var v in this._scene.meshes.forEach((function(v){var I=v.name||"";I=(I=(I=(I=I.replace(/-\d+.*/,"#")).replace(/\d+.*/,"#")).replace(/(rotHolder|camHolder|camScreen)/,"rendering use")).replace(/atlas sprite .*/,"atlas sprites"),w[I]=w[I]||0,w[I]++})),w)console.log("   "+(w[v]+"       ").substr(0,7)+v)};var uw=function(){},Qw=function(){};var Kw=I(85630),aw=I(93433);function Uw(){this.preventDefaults=!1,this.stopPropagation=!1,this.allowContextMenu=!1,this.disabled=!1}console.log("Here");var pw=function(){function w(v,I){var u=this;(0,P.e)(this,w),this.version="0.7.0";var Q=Object.assign({},new Uw,I||{});this.element=v||document,this.preventDefaults=!!Q.preventDefaults,this.stopPropagation=!!Q.stopPropagation,this.allowContextMenu=!!Q.allowContextMenu,this.disabled=!!Q.disabled,this.filterEvents=function(w,v){return!0},this.down=new U.EventEmitter,this.up=new U.EventEmitter,this.state={},this.pointerState={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?Yw(this):document.addEventListener("DOMContentLoaded",(function(w){Yw(u)}),{once:!0})}return(0,u.c)(w,[{key:"bind",value:function(w){for(var v=this,I=arguments.length,P=new Array(I>1?I-1:0),u=1;u<I;u++)P[u-1]=arguments[u];P.forEach((function(I){var P=v._keyBindmap[I]||[];P.includes(w)||(P.push(w),v._keyBindmap[I]=P)})),this.state[w]=!!this.state[w],this.pressCount[w]=this.pressCount[w]||0,this.releaseCount[w]=this.releaseCount[w]||0}},{key:"unbind",value:function(w){for(var v in this._keyBindmap){var I=this._keyBindmap[v],P=I.indexOf(w);P>-1&&I.splice(P,1)}}},{key:"getBindings",value:function(){var w={};for(var v in this._keyBindmap){this._keyBindmap[v].forEach((function(I){w[I]=w[I]||[],w[I].push(v)}))}return w}},{key:"tick",value:function(){rw(this.pointerState),rw(this.pressCount),rw(this.releaseCount)}}]),w}();function rw(w){for(var v in w)w[v]=0}function Yw(w){window.addEventListener("keydown",sw.bind(null,w,!0),!1),window.addEventListener("keyup",sw.bind(null,w,!1),!1);var v={passive:!0};w.element.addEventListener("touchstart",Rw.bind(void 0,w),{passive:!1}),w.element.addEventListener("touchend",jw.bind(void 0,w),v),w.element.addEventListener("mousedown",Bw.bind(null,w,!0),v),window.document.addEventListener("mouseup",Bw.bind(null,w,!1),v),w.element.addEventListener("touchmove",tw.bind(null,w),v),w.element.addEventListener("mousemove",tw.bind(null,w),v),window.PointerEvent,w.element.addEventListener("wheel",iw.bind(null,w),v),w.element.addEventListener("contextmenu",zw.bind(null,w),!1),window.addEventListener("blur",Ew.bind(null,w),!1)}var gw=0,Jw=0,lw=null;function Rw(w,v){v.preventDefault(),xw(v)}function xw(w){for(var v=!1,I=0;I<w.touches.length;++I)if(w.touches[I].identifier===lw){v=!0;break}if(!v){var P=w.changedTouches[0];gw=P.clientX,Jw=P.clientY,lw=P.identifier}}function jw(w,v){for(var I=v.changedTouches,P=0;P<I.length;++P)I[P].identifier===lw&&(lw=null)}function sw(w,v,I){ow(I.code,v,w,I)}function Bw(w,v,I){if("pointerId"in I)if(v){if(null!==w._touches.currID)return;w._touches.currID=I.pointerId}else{if(w._touches.currID!==I.pointerId)return;w._touches.currID=null}return ow("Mouse"+("button"in I?I.button+1:1),v,w,I),!1}function tw(w,v){var I=v.movementX||v.mozMovementX||0,P=v.movementY||v.mozMovementY||0;if(v.touches&&0===(I|P)){var u=function(w){xw(w);for(var v=0;v<w.changedTouches.length;++v)if(w.changedTouches[v].identifier==lw){var I=w.changedTouches[v],P=[I.clientX-gw,I.clientY-Jw];return gw=I.clientX,Jw=I.clientY,P}return console.error("Did not find touch id ".concat(lw)),[0,0]}(v);I=u[0],P=u[1]}w.pointerState.dx+=I,w.pointerState.dy+=P}function iw(w,v){var I=1;switch(v.deltaMode){case 0:I=1;break;case 1:I=12;break;case 2:I=w.element.clientHeight||window.innerHeight}w.pointerState.scrollx+=(v.deltaX||0)*I,w.pointerState.scrolly+=(v.deltaY||0)*I,w.pointerState.scrollz+=(v.deltaZ||0)*I}function zw(w,v){if(!w.allowContextMenu)return v.preventDefault(),!1}function Ew(w){for(var v in w._keyStates)w._keyStates[v]&&(/^Mouse\d/.test(v)||ow(v,!1,w,{code:v,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:function(){},stopPropagation:function(){}}))}function ow(w,v,I,P){var u=I._keyBindmap[w];u&&(hw(I._keyStates[w],v)&&(I._keyStates[w]=v,u.forEach((function(w){(!I.filterEvents||I.filterEvents(P,w))&&function(w,v,I,P){var u=v?I.pressCount:I.releaseCount;u[w]=(u[w]||0)+1;var Q=I._bindPressCount[w]||0;(Q+=v?1:-1)<0&&(Q=0);if(I._bindPressCount[w]=Q,hw(I.state[w],Q)){I.state[w]=Q>0;var K=v?I.down:I.up;I.disabled||K.emit(w,P)}}(w,v,I,P)}))),"button"in P||(I.preventDefaults&&!P.defaultPrevented&&P.preventDefault(),I.stopPropagation&&P.stopPropagation()))}function hw(w,v){return w?!v:v}var nw={preventDefaults:!1,stopPropagation:!1,allowContextMenu:!1},Ww={forward:["KeyW","ArrowUp"],backward:["KeyS","ArrowDown"],left:["KeyA","ArrowLeft"],right:["KeyD","ArrowRight"],fire:"Mouse1","mid-fire":["Mouse2"],"alt-fire":["Mouse3","KeyE"],jump:"Space",sprint:["ShiftLeft","ShiftRight"],crouch:["ControlLeft","KeyC","CapsLock","KeyZ","Backslash","IntlBackslash","ControlRight"]},Vw=function(w){(0,K.e)(I,w);var v=(0,a.d)(I);function I(w,u,Q){var K;(0,P.e)(this,I),u=Object.assign({},nw,u),K=v.call(this,Q,u);var a=u.bindings||Ww;for(var U in a){var p,r=Array.isArray(a[U])?a[U]:[a[U]];(p=K).bind.apply(p,[U].concat((0,aw.d)(r)))}return K}return(0,u.c)(I)}(pw),Fw=I(25191),Ow=I(47077),Nw=function(){function w(v,I,u,Q,K,a,U){(0,P.e)(this,w),this.aabb=new Fw(v.base,v.vec),this.mass=I,this.friction=u,this.restitution=Q,this.gravityMultiplier=K,this.onCollide=a,this.autoStep=!!U,this.airDrag=-1,this.fluidDrag=-1,this.onStep=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.velocity=Ow.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=Ow.create(),this._impulses=Ow.create(),this._sleepFrameCount=10}return(0,u.c)(w,[{key:"loadFromCopy",value:function(w){Ow.copy(this.aabb.base,w.aabb.base),Ow.copy(this.aabb.vec,w.aabb.vec),Ow.copy(this.aabb.max,w.aabb.max),this.aabb.mag=w.aabb.mag,this.mass=w.mass,this.friction=w.friction,this.restitution=w.restitution,this.gravityMultiplier=w.gravityMultiplier,this.onCollide=w.onCollide,this.autoStep=w.autoStep,this.airDrag=w.airDrag,this.fluidDrag=w.fluidDrag,this.onStep=w.onStep,this.preventFallOffEdge=w.preventFallOffEdge,this.rolledBackLastTick=w.rolledBackLastTick,Ow.copy(this.velocity,w.velocity),Ow.copy(this.resting,w.resting),this.inFluid=w.inFluid,this._ratioInFluid=w._ratioInFluid,Ow.copy(this._forces,w._forces),Ow.copy(this._impulses,w._impulses),this._sleepFrameCount=w._sleepFrameCount}},{key:"setPosition",value:function(w){qw(w),Ow.subtract(w,w,this.aabb.base),this.aabb.translate(w),this._markActive()}},{key:"getPosition",value:function(){return Ow.clone(this.aabb.base)}},{key:"applyForce",value:function(w){qw(w),Ow.add(this._forces,this._forces,w),this._markActive()}},{key:"applyImpulse",value:function(w){qw(w),Ow.add(this._impulses,this._impulses,w),this._markActive()}},{key:"_markActive",value:function(){this._sleepFrameCount=10}},{key:"atRestX",value:function(){return this.resting[0]}},{key:"atRestY",value:function(){return this.resting[1]}},{key:"atRestZ",value:function(){return this.resting[2]}}]),w}(),qw=function(w){};var mw=I(25191),cw=I(47077),Mw=I(44642);function Sw(){this.airDrag=.1,this.fluidDrag=.4,this.fluidDensity=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function ew(w,v,I){w=Object.assign(new Sw,w),this.gravity=w.gravity||[0,-10,0],this.airDrag=w.airDrag||.1,this.fluidDensity=w.fluidDensity||2,this.fluidDrag=w.fluidDrag||.4,this.minBounceImpulse=w.minBounceImpulse,this.bodies=[],this.isBodyInsideUnloadedBlock=w.isBodyInsideUnloadedBlock,this.testSolid=v,this.testFluid=I}ew.prototype.addBody=function(w,v,I,P,u,Q){w=w||new mw([0,0,0],[1,1,1]),"undefined"==typeof v&&(v=1),"undefined"==typeof I&&(I=1),"undefined"==typeof P&&(P=0),"undefined"==typeof u&&(u=1);var K=new Nw(w,v,I,P,u,Q);return this.bodies.push(K),K},ew.prototype.removeBody=function(w){var v=this.bodies.indexOf(w);v<0||(this.bodies.splice(v,1),w.aabb=w.onCollide=null)};var Hw=cw.create(),Gw=cw.create(),Lw=cw.create(),dw=cw.create(),Dw=cw.create(),fw=cw.create(),bw=cw.create(),kw=new mw([0,0,0],[1,1,1]),Cw=new Nw(kw,1,1,0,1,(function(){}),!1);ew.prototype.tick=function(w){var v=this;w/=1e3;var I=pv(0,cw.squaredLength(this.gravity));this.bodies.forEach((function(P){return function(w,v,I,P){cw.copy(Dw,v.resting),w.isBodyInsideUnloadedBlock&&Cw.loadFromCopy(v);if(v.mass<=0)return cw.set(v.velocity,0,0,0),cw.set(v._forces,0,0,0),void cw.set(v._impulses,0,0,0);var u=P||0===v.gravityMultiplier;if(function(w,v,I,P){if(v._sleepFrameCount>0)return!1;if(P)return!0;var u=!1,Q=.5*I*I*v.gravityMultiplier;return cw.scale(Uv,w.gravity,Q),Mw(w.testSolid,v.aabb,Uv,(function(){return u=!0,!0}),!0),u}(w,v,I,u))return;v._sleepFrameCount--,function(w,v){var I=v.aabb,P=Math.floor(I.base[0]),u=Math.floor(I.base[2]),Q=Math.floor(I.base[1]),K=Math.floor(I.max[1]);if(!w.testFluid(P,Q,u))return v.inFluid=!1,void(v.ratioInFluid=0);var a=1,U=Q+1;for(;U<=K&&w.testFluid(P,U,u);)a++,U++;var p=(Q+a-I.base[1])/I.vec[1];p>1&&(p=1);var r=I.vec[0]*I.vec[1]*I.vec[2]*p,Y=yw;cw.scale(Y,w.gravity,-w.fluidDensity*r*v.gravityMultiplier),v.applyForce(Y),v.inFluid=!0,v.ratioInFluid=p}(w,v),Yv(v._forces),Yv(v._impulses),Yv(v.velocity),Yv(v.resting),cw.scale(Hw,v._forces,1/v.mass),cw.scaleAndAdd(Hw,Hw,w.gravity,v.gravityMultiplier),cw.scale(Gw,v._impulses,1/v.mass),cw.scaleAndAdd(Gw,Gw,Hw,I),cw.add(v.velocity,v.velocity,Gw),v.friction&&(Tw(w,0,v,Gw,I),Tw(w,1,v,Gw,I),Tw(w,2,v,Gw,I));var Q=v.airDrag>=0?v.airDrag:w.airDrag;v.inFluid&&(Q=v.fluidDrag>=0?v.fluidDrag:w.fluidDrag,Q*=1-Math.pow(1-v.ratioInFluid,2));var K=Math.max(1-Q*I/v.mass,0);cw.scale(v.velocity,v.velocity,K),cw.scale(Lw,v.velocity,I),cw.set(v._forces,0,0,0),cw.set(v._impulses,0,0,0),v.autoStep&&rv(Xw,v.aabb);cw.copy(fw,Lw),cw.set(bw,0,0,0),v.preventFallOffEdge&&function(w,v,I,P){if(!v.resting[1]||I[1]>0)return;var u=Qv;rv(u,v.aabb);for(var Q=0;Q<3;Q+=2){cw.set(uv,0,0,0),uv[Q]=I[Q];var K=!0;(K=(K=(K=(K=K&&!av(w,u.base[0]+uv[0]+1e-5,u.base[1],u.base[2]+uv[2]+1e-5))&&!av(w,u.max[0]+uv[0]-1e-5,u.base[1],u.base[2]+uv[2]+1e-5))&&!av(w,u.base[0]+uv[0]+1e-5,u.base[1],u.max[2]+uv[2]-1e-5))&&!av(w,u.max[0]+uv[0]-1e-5,u.base[1],u.max[2]+uv[2]-1e-5))?(P[Q]=I[Q]>0?1:-1,I[Q]=0):0===Q&&(cw.set(Kv,I[0],0,0),Aw(w,u,Kv,P,v.slideOnCollision))}}(w,v,Lw,bw);Aw(w,v.aabb,Lw,v.resting,v.slideOnCollision),v.autoStep&&function(w,v,I,P){if(v.resting[1]>=0&&!v.inFluid)return;var u=0!==v.resting[0],Q=0!==v.resting[2];if(!u&&!Q)return;var K=Math.abs(P[0]/P[2]),a=4;if(!u&&K>a)return;if(!Q&&K<1/a)return;cw.add(vv,I.base,P);var U=w.testSolid;Mw(U,I,P,(function(w,v,I,P){if(1!==v)return!0;P[v]=0}));var p=I.base[1],r=Math.floor(p+1.001)-p;cw.set(Iv,0,r,0);var Y=!1;if(Mw(U,I,Iv,(function(w,v,I,P){return Y=!0,!0})),Y)return;cw.subtract(Pv,vv,I.base),Pv[1]=0,Aw(w,I,Pv,wv,!0);var g=pv(I.base[0],vv[0]),J=pv(I.base[2],vv[2]);if(u&&!g&&(!J||!Q))return;if(Q&&(!g||!u)&&!J)return;var l=!0;if(l=(l=(l=(l=l&&!av(w,I.base[0]+1e-5,I.base[1],I.base[2]+1e-5))&&!av(w,I.max[0]-1e-5,I.base[1],I.base[2]+1e-5))&&!av(w,I.base[0]+1e-5,I.base[1],I.max[2]-1e-5))&&!av(w,I.max[0]-1e-5,I.base[1],I.max[2]-1e-5))return;rv(v.aabb,I),v.resting[0]=wv[0],v.resting[2]=wv[2],v.onStep&&v.onStep()}(w,v,Xw,fw);for(var a=0;a<3;++a)v.resting[a]=v.resting[a]||bw[a],dw[a]=0,v.resting[a]&&(Dw[a]||(dw[a]=-v.velocity[a]),v.velocity[a]=0);var U=cw.length(dw);U>.001&&(cw.scale(dw,dw,v.mass),v.onCollide&&v.onCollide(dw),v.restitution>0&&U>w.minBounceImpulse&&(cw.scale(dw,dw,v.restitution),v.applyImpulse(dw)));cw.squaredLength(v.velocity)>1e-5&&v._markActive();w.isBodyInsideUnloadedBlock&&w.isBodyInsideUnloadedBlock(v)?(v.loadFromCopy(Cw),v.rolledBackLastTick=!0):v.rolledBackLastTick=!1}(v,P,w,I)}))};var yw=cw.create();function Tw(w,v,I,P,u){var Q=I.resting[v],K=P[v];if(!I.alwaysApplyHorizFriction||1!==v){if(0===Q)return;if(Q*K<=0)return}cw.copy(Zw,I.velocity),Zw[v]=0;var a=cw.length(Zw);if(!pv(a,0)){var U=Math.abs(I.friction*w.gravity[v]*u),p=a>U?(a-U)/a:0;I.velocity[(v+1)%3]*=p,I.velocity[(v+2)%3]*=p}}var Zw=cw.create();function Aw(w,v,I,P,u){return cw.set(P,0,0,0),Mw(w.testSolid,v,I,(function(w,v,I,Q){P[v]=I,Q[v]=0,u||(Q[0]=0,Q[1]=0,Q[2]=0)}))}var Xw=new mw([],[]),wv=cw.create(),vv=cw.create(),Iv=cw.create(),Pv=cw.create();var uv=cw.create(),Qv=new mw([],[]),Kv=cw.create();function av(w,v,I,P){return w.testSolid(Math.floor(v),Math.floor(I-1),Math.floor(P))}var Uv=cw.create();function pv(w,v){return Math.abs(w-v)<1e-5}function rv(w,v){for(var I=0;I<3;I++)w.base[I]=v.base[I],w.max[I]=v.max[I],w.vec[I]=v.vec[I]}var Yv=function(w){};var gv={gravity:[0,-10,0],airDrag:.1},Jv=function(w){(0,K.e)(I,w);var v=(0,a.d)(I);function I(w,u){(0,P.e)(this,I),u=Object.assign({},gv,u);var Q=w.world,K=(w.registry._solidityLookup,w.registry._fluidityLookup),a=w.worldOriginOffset;return v.call(this,u,(function(w,v,I){return Q.getBlockSolidity(w+a[0],v+a[1],I+a[2])}),(function(w,v,I){var P=Q.getBlockID(w+a[0],v+a[1],I+a[2]);return K[P]}))}return(0,u.c)(I)}(ew),lv=I(56434),Rv=I(82936),xv=I(30877),jv=(I(14313),function(w){this.rootNode=new Z.d("objectMeshRoot",w.rendering._scene);var v=[0,0,0],I=!1,P=new Z.d(""),u={},Q=function(v){if(u[v])return u[v];var I=w.registry._blockMeshLookup[v];for(var P in u){var Q=u[P].mesh;if(Q===I||Q.geometry===I.geometry)return u[v]=u[P]}return u[v]=new sv(w,I)};this.initChunk=function(w){w._objectBlocks={}},this.setObjectBlock=function(I,u,K,a,U){var p=I.x+K,r=I.y+a,Y=I.z+U,g="".concat(p,":").concat(r,":").concat(Y),J=I._objectBlocks[g]||0;if(J!==u){if(J>0)Q(J).removeInstance(I,g);if(u>0){var l=w.registry._blockHandlerLookup[u],R=l&&l.onCustomMeshCreate;R&&(P.position.copyFromFloats(.5,.5,.5),P.scaling.setAll(1),P.rotation.setAll(0),R(P,p,r,Y,u));var x=Q(u),j=R?P:null;x.addInstance(I,g,K,a,U,j,v)}J>0&&!u&&delete I._objectBlocks[g],u>0&&(I._objectBlocks[g]=u)}},this.buildObjectMeshes=function(){for(var w in iv("start"),u){var v=u[w];v.updateMatrix(),0===v.count&&v.dispose(),v.disposed&&delete u[w]}iv("rebuilt"),iv("end")},this.disposeChunk=function(w){for(var v in w._objectBlocks){var P=w._objectBlocks[v];if(P>0)Q(P).removeInstance(w,v)}w._objectBlocks=null,I=!0},this.tick=function(){I&&(this.buildObjectMeshes(),I=!1)},this._rebaseOrigin=function(w){for(var P in v[0]+=w[0],v[1]+=w[1],v[2]+=w[2],u)u[P].rebased=!1;for(var Q in u){var K=u[Q];if(!K.rebased){for(var a=0;a<K.count;a++){var U=a<<4;K.buffer[U+12]-=w[0],K.buffer[U+13]-=w[1],K.buffer[U+14]-=w[2]}K.rebased=!0,K.dirty=!0}}I=!0}});function sv(w,v){this.mesh=v,this.buffer=null,this.capacity=0,this.count=0,this.dirty=!1,this.rebased=!0,this.disposed=!1,this.keyToIndex={},this.locToKey=[],this.mesh.position.setAll(0),this.mesh.parent=w._objectMesher.rootNode,this.mesh.isVisible=!0,w.rendering.addMeshToScene(this.mesh,!1),this.mesh.doNotSyncBoundingInfo=!0,this.mesh.alwaysSelectAsActiveMesh=!0}sv.prototype.dispose=function(){this.disposed||(this.mesh.thinInstanceCount=0,this.setCapacity(0),this.mesh.isVisible=!1,this.mesh=null,this.keyToIndex=null,this.locToKey=null,this.disposed=!0)},sv.prototype.addInstance=function(w,v,I,P,u,Q,K){!function(w){if(w.count<w.capacity)return;var v=Math.max(8,2*w.capacity);w.setCapacity(v)}(this);var a=this.count<<4;if(this.locToKey[this.count]=v,this.keyToIndex[v]=a,Q){Q.position.x+=w.x-K[0]+I,Q.position.y+=w.y-K[1]+P,Q.position.z+=w.z-K[2]+u,Q.computeWorldMatrix(!0),tv(Q._localMatrix._m,0,this.buffer,a)}else{var U=Bv;U[12]=w.x-K[0]+I+.5,U[13]=w.y-K[1]+P+.5,U[14]=w.z-K[2]+u+.5,tv(U,0,this.buffer,a)}this.count++,this.dirty=!0},sv.prototype.removeInstance=function(w,v){var I=this.keyToIndex[v];if(!(I>=0))throw"tried to remove object instance not in storage";delete this.keyToIndex[v];var P=I>>4,u=this.count-1;if(P!==u){var Q=u<<4;tv(this.buffer,Q,this.buffer,I);var K=this.locToKey[u];this.keyToIndex[K]=I,this.locToKey[P]=K}this.count--,this.dirty=!0,function(w){if(w.count>.4*w.capacity)return;if(w.capacity<100)return;w.setCapacity(Math.round(w.capacity/2)),w.locToKey.length=Math.min(w.locToKey.length,w.capacity)}(this)},sv.prototype.updateMatrix=function(){this.dirty&&(this.mesh.thinInstanceCount=this.count,this.mesh.thinInstanceBufferUpdated("matrix"),this.mesh.isVisible=this.count>0,this.dirty=!1)},sv.prototype.setCapacity=function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;if(this.capacity=w,0===w)this.buffer=null;else{var v=new Float32Array(16*this.capacity);if(this.buffer)for(var I=Math.min(this.buffer.length,v.length),P=0;P<I;P++)v[P]=this.buffer[P];this.buffer=v}this.mesh.thinInstanceSetBuffer("matrix",this.buffer),this.updateMatrix()};var Bv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function tv(w,v,I,P){for(var u=0;u<16;u++)I[P+u]=w[v+u]}var iv=function(){},zv=I(29439),Ev=I(4942),ov=I(37762);I(38040);function hv(w,v,I,P,u){var Q,K,a,U;this._defaultMaterial=v._defaultMat;var p=null!==(Q=u.chunkSize)&&void 0!==Q?Q:32;Vv=new qv(p),Fv=new mv(p),Ov=new cv;this.initChunk=function(w){w._terrainMeshes.length=0},this.disposeChunk=function(w){w._terrainMeshes.forEach((function(w){return w.dispose()})),w._terrainMeshes.length=0};var r={chunkI:0,chunkJ:0,chunkK:0,size:0,_isEmpty:!1,_isFull:!1,_wholeLayerVoxel:null,requestID:"",_neighbors:null,_neighborsData:null};this.meshChunk=function(Q){!function(){if(!U){var Q=w.registry._solidityLookup,r=w.rendering.useAO,Y=w.rendering.revAoVal===w.rendering.aoVals[0],g=w.registry._opacityLookup,J=w.registry.blockMats,l=v._blockMatIDtoTerrainID,R=w.rendering.aoVals,x=w.rendering.revAoVal,j=w.registry._matAtlasIndexLookup,s=w.registry._materialColorLookup;a=new Wv(Q,r,Y,g,J,l,p),K=new Mv(w,v,r,R,x,j,s,I,P),(U=u.getMeshingWorker()).postMessage({type:"meshingInit",data:{chunkSize:p,solidLookupArr:Q,doAO:r,skipRevAo:Y,opacityLookup:g,blockFaceToMatId:J,matIdToTerrainId:l,aoVals:R,revAoVal:x,atlasIndexLookup:j,matColorLookup:s}}),U.onmessage=function(v){var P,u=v.data,Q=u.chunkI,a=u.chunkJ,U=u.chunkK,p=u.vertexDataInfo,r=u.reusableChunkArrs,Y=(0,ov.b)(r);try{for(Y.s();!(P=Y.n()).done;){var g=P.value;Vv.release(g)}}catch(w){Y.e(w)}finally{Y.f()}var J=w.world._storage.getChunkByIndexes(Q,a,U);J?(J._terrainMeshes.forEach((function(w){return w.dispose()})),J._terrainMeshes.length=0,K.buildMesh(p).forEach((function(v){w.rendering.addMeshToScene(v,!0,J.pos),v.cullingStrategy=I.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,J._terrainMeshes.push(v)}))):console.error("Meshed chunk but no chunk object. Probably not an issue but perhaps useful for debugging purposes.")}}}();var Y=a.copyNeighborChunksForMesh(Q),g=Y.copiedNeighbors,J=Y.transferableBuffers,l=Q.i,R=Q.j,x=Q.k,j=Q.size,s=Q._isEmpty,B=Q._isFull,t=Q._wholeLayerVoxel,i=Q.requestID;r.chunkI=l,r.chunkJ=R,r.chunkK=x,r.size=j,r._isEmpty=s,r._isFull=B,r._wholeLayerVoxel=t,r.requestID=i,r._neighbors=null,r._neighborsData=g.data,U.postMessage({type:"meshChunk",data:{chunk:r}},J)}}function nv(){this.terrainID=0,this.numFaces=0,this.matIDs=[],this.dirs=[],this.is=[],this.js=[],this.ks=[],this.wids=[],this.hts=[],this.packedAO=[]}function Wv(w,v,I,P,u,Q,K){var a=new Int16Array(16),U=new Int16Array(16),p=function(w,v){return u[6*w+v]},r=function(w){return Q[w]},Y=r,J=K-1,l=[1,1,1,1,1,-1,1,-1,1,-1,1,1,-1,-1,1,-1,1,-1,1,-1,-1,-1,-1,-1],R=[0,0,0,0,0,J,0,J,0,J,0,0,J,J,0,J,0,J,0,J,J,J,J,J],x=[0,1,1,0,1,-1,1,1,0,-1,1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,-1,1,0,-1,-1,1,-1,0,-1,-1,0],j=[0,0,0,1,0,0,0,0,J,1,0,J,0,0,0,0,0,1,J,0,0,J,0,1,0,0,0,0,1,0,J,0,0,J,1,0,0,0,J,0,1,J,J,0,J,J,1,J,0,J,0,1,J,0,0,J,J,1,J,J,0,J,0,0,J,1,J,J,0,J,J,1],s=[0,0,1,0,0,-1,0,1,0,0,-1,0,1,0,0,-1,0,0],B=[0,0,0,1,0,0,0,0,J,1,0,J,0,0,0,1,0,0,0,J,0,1,J,0,0,0,0,0,1,0,J,0,0,J,1,0],t=[0,0,0,0,1,0,0,0,J,0,1,J,0,0,0,0,0,1,0,J,0,0,J,1,0,0,0,0,0,1,J,0,0,J,0,1],i=[];function z(w,v){if(E=w.get(0,0,0),o=w,h.length!==v+1){h=[],n=[],W=[];for(var I=-1;I<v+1;I++){var P=I<0?0:I<v?1:2;h[I]=0|[-1,0,1][P],n[I]=0|[v-1,I,0][P],W[I]=0|[0,I,v-1][P]}}}this.copyNeighborChunksForMesh=function(w){for(var v=Ov.get(),I=w.size,P=0;P<l.length;P+=3){var u=l[P],Q=l[P+1],K=l[P+2],a=w._neighbors.get(u,Q,K);if(a){var U=Vv.get();v.set(u,Q,K,U);var p=Fv.get(U),r=R[P],Y=R[P+1],g=R[P+2];p.set(r,Y,g,a.voxels.get(r,Y,g)),Fv.release(p)}}for(var J=0;J<x.length;J+=3){var z=x[J],E=x[J+1],o=x[J+2],h=w._neighbors.get(z,E,o);if(h){var n=Vv.get();v.set(z,E,o,n);for(var W=Fv.get(n),V=j[2*J],F=j[2*J+1],O=j[2*J+2],N=j[2*J+3],q=j[2*J+4],m=j[2*J+5],c=W.index(V,F,O),M=W.index(N,q,m)-c,S=0,e=c;S<I;S++,e+=M)n[e]=h.voxels.data[e];Fv.release(W)}}for(var H=0;H<s.length;H+=3){var G=s[H],L=s[H+1],d=s[H+2],D=w._neighbors.get(G,L,d);if(D){var f=Vv.get();v.set(G,L,d,f);for(var b=Fv.get(f),k=B[2*H],C=B[2*H+1],y=B[2*H+2],T=B[2*H+3],Z=B[2*H+4],A=B[2*H+5],X=t[2*H],ww=t[2*H+1],vw=t[2*H+2],Iw=t[2*H+3],Pw=t[2*H+4],uw=t[2*H+5],Qw=b.index(k,C,y),Kw=b.index(T,Z,A)-Qw,aw=b.index(X,ww,vw),Uw=b.index(Iw,Pw,uw)-aw,pw=0,rw=Qw;pw<I;pw++,rw+=Kw)for(var Yw=0,gw=rw;Yw<I;Yw++,gw+=Uw)f[gw]=D.voxels.data[gw];Fv.release(b)}}var Jw=Vv.get();v.set(0,0,0,Jw);for(var lw=0;lw<w.voxels.data.length;lw++)Jw[lw]=w.voxels.data[lw];var Rw,xw=0,jw=(0,ov.b)(v.data);try{for(jw.s();!(Rw=jw.n()).done;){var sw=Rw.value;sw&&(i[xw++]=sw.buffer)}}catch(w){jw.e(w)}finally{jw.f()}return i.length=xw,Ov.release(v),{copiedNeighbors:v,transferableBuffers:i}},this.mesh=function(w){var v=w.size;Y=r;var I=w._isEmpty||w._isFull,P={};Nv.reset();for(var u=0;u<3;++u){var Q=2===u?0:2,K=1===u?0:1,p=w._neighbors.data.map((function(w){return w&&w.voxels?w.voxels.transpose(u,Q,K):null})),J=g()(p,[3,3,3]).lo(1,1,1).transpose(u,Q,K);a.length<v*v&&(a=new Int16Array(v*v),U=new Int16Array(v*v)),z(J,v);var l=J.get(-1,0,0),R=J.get(0,0,0);if(l){var x=l.lo(v,0,0),j=F(u,x,-1,R,0);j>0&&O(0,u,Q,K,v,v,j,P)}if(!I)for(var s=0;s<v-1;s++){if(1===u){var B=w._wholeLayerVoxel[s];if(B>=0&&B===w._wholeLayerVoxel[s+1])continue}var t=1===u?null:w._wholeLayerVoxel,i=F(u,R,s,R,s+1,t);i>0&&O(s+1,u,Q,K,v,v,i,P)}}return P};var E,o,h=[],n=[],W=[];function V(v,I,P){var u=0|h[v],Q=0|h[I],K=0|h[P];if(0===(u|Q|K))return w[E.get(v,I,P)];var a=o.get(u,Q,K);if(a){var U=0|n[v],p=0|n[I],r=0|n[P];return w[a.get(U,p,r)]}var Y=0|W[v],g=0|W[I],J=0|W[P];return w[E.get(Y,g,J)]}function F(w,u,Q,K,r){for(var Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=u.shape[1],J=a,l=U,R=2*w,x=0,j=u.index(Q,0,0),s=u.stride[1],B=u.stride[2],t=K.index(r,0,0),i=K.stride[1],z=K.stride[2],E=0,o=0;o<g;++o){var h=j,n=t;if(j+=B,t+=z,Y&&Y[o]>=0)x+=g;else for(var W=0;W<g;W++,x++,h+=s,n+=i){var F=u.data[h],O=K.data[n];if(F!==O){var N=P[F],q=P[O];if(!N||!q){var m=p(F,R),c=p(O,R+1);m!==c&&(N||0===c?(J[x]=m,v&&(l[x]=Sv(V,r,Q,W,o,I)),E++):(q||0===m)&&(J[x]=-c,v&&(l[x]=Sv(V,Q,r,W,o,I)),E++))}}}}return E}function O(w,I,P,u,Q,K,p,r){var g=a,J=U,l=0,R=2*I,x=[0,0,0];x[I]=w;for(var j=v?N:q,s=0;s<K;++s)for(var B=1,t=1,i=0;i<Q;i+=B,l+=B){var z=0|g[l];if(z){var E=0|J[l];for(B=1;B<Q-i&&j(l+B,g,z,J,E);++B);w:for(t=1;t<K-s;++t)for(var o=0;o<B;++o){if(!j(l+o+t*Q,g,z,J,E))break w}var h=Math.abs(z),n=Y(h);if(!(n in r)){var W=Nv.get();W.numFaces=0,W.terrainID=n,r[n]=W}var V=r[n],F=V.numFaces;V.numFaces++,V.matIDs[F]=h,x[P]=i,x[u]=s,V.is[F]=x[0],V.js[F]=x[1],V.ks[F]=x[2],V.wids[F]=B,V.hts[F]=t,V.packedAO[F]=E,V.dirs[F]=z>0?R:R+1;for(var O=0;O<t;++O)for(var m=0;m<B;++m)g[l+m+O*Q]=0;if(0===(p-=B*t))return}else B=1}}function N(w,v,I,P,u){return I===v[w]&&u===P[w]}function q(w,v,I,P,u){return I===v[w]}}var Vv,Fv,Ov,Nv=function(){var w=[],v=0;return{get:function(){return v>=w.length&&w.push(new nv),v++,w[v-1]},reset:function(){v=0}}}(),qv=function(){function w(v){(0,P.e)(this,w),(0,Ev.c)(this,"arr",[]),(0,Ev.c)(this,"cs",0),this.cs=v}return(0,u.c)(w,[{key:"get",value:function(){return 0===this.arr.length&&this.arr.push(new Uint16Array(this.cs*this.cs*this.cs)),this.arr.pop()}},{key:"release",value:function(w){this.arr.push(w)}}]),w}(),mv=function(){function w(v){(0,P.e)(this,w),(0,Ev.c)(this,"arr",[]),(0,Ev.c)(this,"cs",0),this.cs=v}return(0,u.c)(w,[{key:"get",value:function(w){0===this.arr.length&&this.arr.push(g()(new Uint16Array,[this.cs,this.cs,this.cs]));var v=this.arr.pop();return v.data=w,v}},{key:"release",value:function(w){w.data=null,this.arr.push(w)}}]),w}(),cv=function(){function w(){(0,P.e)(this,w),(0,Ev.c)(this,"arr",[])}return(0,u.c)(w,[{key:"get",value:function(){var w;if(0===this.arr.length)w=g()(Array.from(Array(27),(function(){return null})),[3,3,3]).lo(1,1,1);else{w=this.arr.pop();for(var v=0;v<w.data.length;v++)w.data[v]=null}return w}},{key:"release",value:function(w){this.arr.push(w)}}]),w}();function Mv(w,v,I,P,u,Q,K){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;function p(w,v,I,P,u,Q,K,a){var U=12*v,p=[I,P,u],r=[0,0,0],Y=[0,0,0];r[2===Q?0:2]=K,Y[1===Q?0:1]=a;for(var g=0;g<3;g++)w[U+g]=p[g],w[U+3+g]=p[g]+r[g],w[U+6+g]=p[g]+r[g]+Y[g],w[U+9+g]=p[g]+Y[g]}function r(w,v,I,P,u,Q){for(var K=8*v,a=.0015,U=0;U<8;U++)w[K+U]=a;0===I?(w[K+1]=w[K+3]=u-a,w[K+2]=w[K+4]=Q*(P-a),w[K+0]=w[K+6]=Q*a):1===I?(w[K+1]=w[K+7]=P-a,w[K+4]=w[K+6]=Q*(u-a),w[K+0]=w[K+2]=Q*a):(w[K+1]=w[K+3]=u-a,w[K+2]=w[K+4]=-Q*(P-a),w[K+0]=w[K+6]=-Q*a)}function Y(w,v,I){for(var P=12*v,u=0;u<12;u++)w[P+u]=I[u%3]}function g(w,v,I,P,u){var Q=6*v,K=4*v;0===I&&(P=-P);var a=P<0?0:1;u||(a+=2);for(var U=J[a],p=0;p<6;p++)w[Q+p]=K+U[p]}this.buildMesh=function(I){var P,u=w.rendering.getScene(),Q=[],K=(0,ov.b)(I);try{for(K.s();!(P=K.n()).done;){var p=P.value,r=p.positions,Y=p.indices,g=p.normals,J=p.colors,l=p.uvs,R=p.atlasIndexes,x=p.requestID,j=p.terrainID,s="chunk_".concat(x,"_").concat(j),B=new a(s,u),t=new U;t.positions=r,t.indices=Y,t.normals=g,t.colors=J,t.uvs=l,t.applyToMesh(B),B.doNotSyncBoundingInfo=!0,B._updateBoundingInfo=function(){return B},B._refreshBoundingInfo=function(){return B},R&&B.setVerticesData("texAtlasIndices",R,!1,1),B.material=v.getMaterial(j),Q.push(B)}}catch(w){K.e(w)}finally{K.f()}return Q},this.createMeshData=function(w,v){var a=[1,1,1],U=[];for(var J in w){var s=w[J],B=s.terrainID,t=!1;t=Q[s.matIDs[0]]>=0;var i,z=s.numFaces,E=new Uint16Array(6*z),o=new Float32Array(12*z),h=new Float32Array(12*z),n=new Float32Array(16*z),W=new Float32Array(8*z);t&&(i=new Float32Array(4*z));for(var V=0;V<s.numFaces;V++){var F=s.matIDs[V],O=s.dirs[V],N=s.is[V],q=s.js[V],m=s.ks[V],c=s.wids[V],M=s.hts[V],S=O/2|0,e=O%2?-1:1;p(o,V,N,q,m,S,c,M),r(W,V,S,c,M,e);var H=[0,0,0];H[S]=e,Y(h,V,H);var G=ev(s.packedAO[V]),L=(0,zv.e)(G,4),d=L[0],D=L[1],f=L[2],b=L[3];if(g(E,V,S,e,R(d,D,f,b)),t)l(i,V,Q[F]);var k=K[F]||a;I?j(n,V,k,P,u,d,D,f,b):x(n,V,k)}U.push({positions:o,indices:E,normals:h,colors:n,uvs:W,atlasIndexes:t?i:null,requestID:v.requestID,terrainID:B})}return U};var J=[[0,1,2,0,2,3],[0,2,1,0,3,2],[1,2,3,1,3,0],[1,3,2,1,0,3]];function l(w,v,I){for(var P=4*v,u=0;u<4;u++)w[P+u]=I}function R(w,v,I,P){return w===I?P!==v||2===P:P!==v&&w+I>P+v}function x(w,v,I){for(var P=16*v,u=0;u<16;u+=4)w[P+u]=I[0],w[P+u+1]=I[1],w[P+u+2]=I[2],w[P+u+3]=1}function j(w,v,I,P,u,Q,K,a,U){var p=16*v;s(w,p,I,Q,P,u),s(w,p+4,I,U,P,u),s(w,p+8,I,a,P,u),s(w,p+12,I,K,P,u)}function s(w,v,I,P,u,Q){var K=0===P?Q:u[P-1];w[v]=I[0]*K,w[v+1]=I[1]*K,w[v+2]=I[2]*K,w[v+3]=1}}function Sv(w,v,I,P,u){var Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=1,a=1,U=1,p=1;w(v,P+1,u)&&(++U,++p),w(v,P-1,u)&&(++K,++a),w(v,P,u+1)&&(++a,++p),w(v,P,u-1)&&(++K,++U);var r=w(v,P,u);return r?(p=3===p||w(v,P+1,u+1)?3:2,a=3===a||w(v,P-1,u+1)?3:2,p<<6|(U=3===U||w(v,P+1,u-1)?3:2)<<4|a<<2|(K=3===K||w(v,P-1,u-1)?3:2)):Q?(1===p&&w(v,P+1,u+1)&&(p=2),1===a&&w(v,P-1,u+1)&&(a=2),1===U&&w(v,P+1,u-1)&&(U=2),1===K&&w(v,P-1,u-1)&&(K=2),p<<6|U<<4|a<<2|K):(1===p&&(w(v,P+1,u+1)?p=2:w(I,P,u+1)&&w(I,P+1,u)&&w(I,P+1,u+1)||(p=0)),1===U&&(w(v,P+1,u-1)?U=2:w(I,P,u-1)&&w(I,P+1,u)&&w(I,P+1,u-1)||(U=0)),1===a&&(w(v,P-1,u+1)?a=2:w(I,P,u+1)&&w(I,P-1,u)&&w(I,P-1,u+1)||(a=0)),1===K&&(w(v,P-1,u-1)?K=2:w(I,P,u-1)&&w(I,P-1,u)&&w(I,P-1,u-1)||(K=0)),p<<6|U<<4|a<<2|K)}function ev(w){return[3&w,w>>2&3,w>>6&3,w>>4&3]}var Hv=I(65847),Gv=I(85779),Lv=I(70937),dv=I(96558),Dv=I(57194),fv=function(){function w(v){(0,P.e)(this,w),this._defaultMat=v.rendering.makeStandardMaterial("base-terrain"),this._defaultMat.freeze(),this.noa=v,this._idCounter=1e3,this._blockMatIDtoTerrainID={},this._terrainIDtoMatObject={},this._texURLtoTerrainID={},this._renderMatToTerrainID=new Map}return(0,u.c)(w,[{key:"getTerrainMatId",value:function(w){if(w in this._blockMatIDtoTerrainID)return this._blockMatIDtoTerrainID[w];var v=function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=w.noa.registry.getMaterialData(v);if(I.renderMat){var P=I.renderMat;return w._renderMatToTerrainID.has(P)||w._renderMatToTerrainID.set(P,w._idCounter++),w._renderMatToTerrainID.get(P)}if(I.texture){var u=I.texture;return u in w._texURLtoTerrainID||(w._texURLtoTerrainID[u]=w._idCounter++),w._texURLtoTerrainID[u]}var Q=I.alpha;return Q>0&&Q<1?10+Math.round(100*Q):1}(this,w);if(!(v in this._terrainIDtoMatObject)){var I=function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=w.noa.registry.getMaterialData(v);if(I.renderMat)return I.renderMat;if(!I.texture){if(!(I.alpha>0&&I.alpha<1))return w._defaultMat;var P="terrain-alpha-"+v,u=w.noa.rendering.makeStandardMaterial(P);return u.alpha=I.alpha,u.freeze(),u}var Q=w.noa.rendering.getScene(),K=w.noa.rendering.makeStandardMaterial("terrain-textured-"+v),a=I.texture,U=Lv.e.NEAREST_SAMPLINGMODE,p=new Lv.e(a,Q,!0,!1,U);I.texHasAlpha&&(p.hasAlpha=!0);K.diffuseTexture=p,I.atlasIndex>=0&&(new bv(K,p),w.noa.registry._textureNeedsAlpha(I.texture)&&(p.hasAlpha=!0));return K.freeze(),K}(this,w);this._terrainIDtoMatObject[v]=I}return this._blockMatIDtoTerrainID[w]=v,v}},{key:"getMaterial",value:function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this._terrainIDtoMatObject[w]}}]),w}();var bv=function(w){(0,K.e)(I,w);var v=(0,a.d)(I);function I(w,u){var Q;(0,P.e)(this,I);return(Q=v.call(this,w,"TestPlugin",200,{NOA_TWOD_ARRAY_TEXTURE:!1}))._enable(!0),Q._atlasTextureArray=null,u.onLoadObservable.add((function(w){Q.setTextureArrayData(w)})),Q}return(0,u.c)(I,[{key:"setTextureArrayData",value:function(w){var v=w.getSize(),I=v.width,P=v.height,u=Math.round(P/I);P=I;var Q=w._readPixelsSync(),K=e.d.TEXTUREFORMAT_RGBA,a=Lv.e.NEAREST_SAMPLINGMODE,U=w.getScene();this._atlasTextureArray=new Dv.e(Q,I,P,u,K,U,!0,!1,a)}},{key:"prepareDefines",value:function(w,v,I){w.NOA_TWOD_ARRAY_TEXTURE=!0}},{key:"getClassName",value:function(){return"TerrainMaterialPluginName"}},{key:"getSamplers",value:function(w){w.push("atlasTexture")}},{key:"getAttributes",value:function(w){w.push("texAtlasIndices")}},{key:"getUniforms",value:function(){return{ubo:[]}}},{key:"bindForSubMesh",value:function(w,v,I,P){this._atlasTextureArray&&w.setTexture("atlasTexture",this._atlasTextureArray)}},{key:"getCustomCode",value:function(w){return"vertex"===w?{CUSTOM_VERTEX_MAIN_BEGIN:"\n                texAtlasIndex = texAtlasIndices;\n            ",CUSTOM_VERTEX_DEFINITIONS:"\n                uniform highp sampler2DArray atlasTexture;\n                attribute float texAtlasIndices;\n                varying float texAtlasIndex;\n            "}:"fragment"===w?{"!baseColor\\=texture2D\\(diffuseSampler,vDiffuseUV\\+uvOffset\\);":"baseColor = texture(atlasTexture, vec3(vDiffuseUV, texAtlasIndex));",CUSTOM_FRAGMENT_DEFINITIONS:"\n                uniform highp sampler2DArray atlasTexture;\n                varying float texAtlasIndex;\n            "}:null}}]),I}(dv.d),kv="0.33.0",Cv={debug:!1,silent:!1,silentBabylon:!1,playerHeight:1.8,playerWidth:.6,playerStart:[0,10,0],playerAutoStep:!1,tickRate:30,maxRenderRate:0,blockTestDistance:10,stickyPointerLock:!0,dragCameraOutsidePointerLock:!0,stickyFullscreen:!1,skipDefaultHighlighting:!1,originRebaseDistance:25},yv=function(w){(0,K.e)(I,w);var v=(0,a.d)(I);function I(){var w,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,P.e)(this,I),w=v.call(this),u=Object.assign({},Cv,u),w.version=kv,!u.silent){var K=u.debug?" (debug)":"";console.log("noa-engine v".concat(w.version).concat(K))}w._paused=!1,w._dragOutsideLock=u.dragCameraOutsidePointerLock,w._originRebaseDistance=u.originRebaseDistance,w.worldOriginOffset=[0,0,0],w.positionInCurrentTick=0,w.worldName="default",w.timeScale=1,w.container=new z((0,Q.d)(w),u),w.world=new Kw.d((0,Q.d)(w),u),w.rendering=new Iw((0,Q.d)(w),u,w.container.canvas),w.tickRate=w.container._shell.tickRate,w.maxRenderRate=w.container._shell.maxRenderRate,w._terrainMatManager=new fv((0,Q.d)(w)),w.inputs=new Vw((0,Q.d)(w),u,w.container.element),w.registry=new Rv.c((0,Q.d)(w),u,w._terrainMatManager);var a=console.log;u.silentBabylon&&(console.log=function(){}),u.silentBabylon&&(console.log=a),w.physics=new Jv((0,Q.d)(w),u),w.entities=new xv.c((0,Q.d)(w),u),w.ents=w.entities;var U=w.entities;w.playerEntity=U.add(u.playerStart,u.playerWidth,u.playerHeight,null,null,!0,!0),U.addComponent(w.playerEntity,U.names.collideTerrain),U.addComponent(w.playerEntity,U.names.collideEntities);var p=U.getPhysics(w.playerEntity).body;if(p.gravityMultiplier=2,p.autoStep=u.playerAutoStep,w.camera=new lv.d((0,Q.d)(w),u),w.blockTestDistance=u.blockTestDistance,w.blockTargetIdCheck=w.registry.getBlockSolidity,w.targetedBlock=null,u.skipDefaultHighlighting||(w.defaultBlockHighlightFunction=function(v){!v||!w.serverSettings.canChange&&!w.world.canChangeBlock(v.position[0],v.position[1],v.position[2])&&!w.world.canChangeBlock(v.adjacent[0],v.adjacent[1],v.adjacent[2])||w.entities.hasComponent(w.playerEntity,"heldItem")&&!1===w.entities.getState(w.playerEntity,"heldItem").heldItem.canPlaceOrBreakBlock?w.rendering.highlightBlockFace(!1):w.rendering.highlightBlockFace(!0,v.position,v.normal)},w.on("targetBlockChanged",w.defaultBlockHighlightFunction)),w.bloxd=void 0,w.colyClient=void 0,w.GA=void 0,w.gaENums=void 0,w.logErrorMessage=function(w,v){throw v},w.serverSettings={},w.otherPlayerSettings={},w.playerNames={},w.colyRoom=void 0,w.serverPlayerEntity=void 0,w.actionOrigin=null,w.actionDirection=null,w.sounds={pvpSounds:null,pvpSoundsTrackName:null},w.room=null,w.pluginApi=null,w.isBodyInsideUnloadedBlock=u.isBodyInsideUnloadedBlock,w._terrainMesher=new hv((0,Q.d)(w),w._terrainMatManager,Hv.b,Gv.b,u),w._objectMesher=new jv((0,Q.d)(w)),w._targetedBlockDat={blockID:0,position:r().create(),normal:r().create(),adjacent:r().create()},w._prevTargetHash="",w._pickPos=r().create(),w._pickResult={_localPosition:r().create(),position:[0,0,0],normal:[0,0,0]},u.debug){w.vec3=r(),w.ndarray=g(),U.getMovement(1).airJumps=999;var Y=window;Y.noa=(0,Q.d)(w),Y.vec3=r(),Y.ndarray=g(),Y.scene=w.rendering._scene}return Zv((0,Q.d)(w)),w}return(0,u.c)(I,[{key:"tick",value:function(w){try{if(w*=this.timeScale||1,this._paused)return void(this.world.worldGenWhilePaused&&this.world.tick());if(Av("start"),function(w){var v=w.ents.getPositionData(w.playerEntity)._localPosition,I=w._originRebaseDistance;if(r().sqrLen(v)<I*I)return;for(var P=[],u=0;u<3;u++)P[u]=Math.floor(v[u]),w.worldOriginOffset[u]+=P[u];w.rendering._rebaseOrigin(P),w.entities._rebaseOrigin(P),w._objectMesher._rebaseOrigin(P)}(this),this.world.tick(),Av("world"),this.isBodyInsideUnloadedBlock&&this.isBodyInsideUnloadedBlock(this.ents.getPhysicsBody(this.playerEntity))||!this.world.playerChunkLoaded)return void this.rendering.tick(w);this.emit("beforePhysicsTick",w),this.physics.tick(w),Av("physics"),this._objectMesher.tick(),this.rendering.tick(w),Av("rendering"),this.updateBlockTargets(),Av("targets"),this.entities.tick(w),Av("entities"),this.emit("tick",w),Av("tick event"),Av("end");var v=this.inputs.pointerState;v.scrollx=v.scrolly=v.scrollz=0}catch(w){this.logErrorMessage("Error in noa tickloop",w)}}},{key:"render",value:function(w,v){try{if(w*=this.timeScale||1,this.positionInCurrentTick=v,this._paused)return void(this.world.worldGenWhilePaused&&this.world.render());Xv("start"),(this.container.hasPointerLock||!this.container.supportsPointerLock||this._dragOutsideLock&&this.inputs.state.fire)&&this.camera.applyInputsToCamera(),Av("init"),this.world.render(),Xv("meshing"),this.camera.updateBeforeEntityRenderSystems(w),this.entities.render(w),this.camera.updateAfterEntityRenderSystems(),Av("entities"),this.emit("beforeRender",w),Xv("before render"),this.rendering.render(),this.rendering.postRender(),Xv("render"),this.emit("afterRender",w),Xv("after render"),Xv("end"),this.inputs.pointerState.dx=this.inputs.pointerState.dy=0}catch(w){this.logErrorMessage("Error in noa renderloop",w)}}},{key:"setPaused",value:function(){var w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._paused=!!w,w||(this.inputs.pointerState.dx=this.inputs.pointerState.dy=0)}},{key:"getBlock",value:function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return w.length?this.world.getBlockID(w[0],w[1],w[2]):this.world.getBlockID(w,v,I)}},{key:"setBlock",value:function(w,v){var I,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return I=v.length?this.world.setBlockID(w,v[0],v[1],v[2]):this.world.setBlockID(w,v,P,u),this._targetedBlockDat.blockID=this.world.getBlockID(this._targetedBlockDat.position[0],this._targetedBlockDat.position[1],this._targetedBlockDat.position[2]),I}},{key:"addBlock",value:function(w,v){var I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(v.length){if(this.entities.isTerrainBlocked(v[0],v[1],v[2]))return;return this.world.setBlockID(w,v[0],v[1],v[2]),w}if(!this.entities.isTerrainBlocked(v,I,P))return this.world.setBlockID(w,v,I,P),w}},{key:"globalToLocal",value:function(w,v,I){var P=this.worldOriginOffset;if(v){for(var u=0;u<3;u++){var Q=w[u]-P[u];Q+=v[u],I[u]=Q}return I}return r().subtract(I,w,P)}},{key:"localToGlobal",value:function(w,v){var I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=this.worldOriginOffset;if(I){for(var u=0;u<3;u++){var Q=Math.floor(w[u]);v[u]=Q+P[u],I[u]=w[u]-Q}return v}return r().add(v,w,P)}},{key:"pick",value:function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(0===I)return null;var u=this._pickPos;return w&&(this.globalToLocal(w,null,u),w=u),this._localPick(w,v,I,P)}},{key:"_localPick",value:function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(0===I)return null;var u=P||this.registry.getBlockSolidity,Q=this.world,K=this.worldOriginOffset,a=function(w,v,I){var P=Q.getBlockID(w+K[0],v+K[1],I+K[2]);return u(P)};w||(w=this.camera._localGetTargetPosition()),v=v||this.camera.getDirection(),(I=I||-1)<0&&(I=this.blockTestDistance);var U=this._pickResult,p=U._localPosition,Y=U.normal,g=l()(a,w,v,I,p,Y);return g?(r().scaleAndAdd(p,p,Y,.01),this.localToGlobal(p,U.position),U):null}},{key:"pickBlock",value:function(w,v,I,P){var u={blockID:0,position:[],normal:[],adjacent:[]},Q=this.pick(w,v,I,P);return Q?(Tv(this,Q,u),u):null}},{key:"updateBlockTargets",value:function(){var w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v="",I=this.blockTargetIdCheck||this.registry.getBlockSolidity,P=this.actionOrigin,u=this.actionDirection,Q=this._localPick(P,u,null,I);if(Q){var K=this._targetedBlockDat;Tv(this,Q,K),this.targetedBlock=K;var a=K.position;K.normal;v="".concat(a[0],"|").concat(a[1],"|").concat(a[2],"|").concat(K.blockID)}else this.targetedBlock=null;(v!=this._prevTargetHash||w)&&(this.emit("targetBlockChanged",this.targetedBlock),this._prevTargetHash=v)}}]),I}(U.EventEmitter);function Tv(w,v,I){r().floor(I.adjacent,v.position),r().copy(I.normal,v.normal),r().sub(I.position,I.adjacent,I.normal),I.blockID=w.world.getBlockID(I.position[0],I.position[1],I.position[2])}function Zv(w){}var Av=function(){},Xv=function(){}},56434:function(w,v,I){"use strict";I.d(v,{d:function(){return l},g:function(){return t},i:function(){return i}});var P=I(15671),u=I(43144),Q=I(47077),K=I.n(Q),a=I(25191),U=I.n(a),p=I(44642),r=I.n(p),Y={inverseX:!1,inverseY:!1,sensitivityX:10,sensitivityY:10,initialZoom:0,zoomSpeed:.2},g=[K().create(),K().create(),K().create()],J=K().create(),l=function(){function w(v,I){(0,P.e)(this,w),I=Object.assign({},Y,I),this.noa=v,this.sensitivityX=+I.sensitivityX,this.sensitivityY=+I.sensitivityY,this.inverseX=!!I.inverseX,this.inverseY=!!I.inverseY,this.inputsDisabled=!1,this.heading=0,this.pitch=0,this.cameraTarget=this.noa.ents.createEntity(["position"]);var u=.9*v.ents.getPositionData(v.playerEntity).height;v.ents.addComponent(this.cameraTarget,"followsEntity",{entity:v.playerEntity,offset:[0,u,0]}),this.zoomDistance=I.initialZoom,this.zoomSpeed=I.zoomSpeed,this.currentZoom=I.initialZoom,this._dirVector=K().fromValues(0,0,1),this.currentZoom=I.initialZoom,this.onCurrentZoomChange=null,this.onCurrentZoomSetFromInternals=null,this.targetX=0,this.targetY=0,this._targetKickback=0,this._appliedKickback=0,this._approachTargetKickbackRate=.009,this._lastUpdateBeforeEntityRender=Date.now(),this._kickbackDiffToApply=0,this._kickbackDecreaseRate=0,this.previousZoom=0,this._dirVector=K().fromValues(0,1,0)}return(0,u.c)(w,[{key:"_localGetTargetPosition",value:function(){var w=this.noa.ents.getPositionData(this.cameraTarget),v=g[0];return K().copy(v,w._renderPosition)}},{key:"_localGetPosition",value:function(){var w=this._localGetTargetPosition();return 0===this.currentZoom?w:K().scaleAndAdd(w,w,this._dirVector,-this.currentZoom)}},{key:"getTargetPosition",value:function(){var w=this._localGetTargetPosition(),v=g[1];return this.noa.localToGlobal(w,v)}},{key:"getPosition",value:function(){var w=this._localGetPosition(),v=g[2];return this.noa.localToGlobal(w,v)}},{key:"getUpDirection",value:function(){return t(this.heading,this.pitch+Math.PI/2)}},{key:"setZoomDistance",value:function(w){this.previousZoom=this.zoomDistance,this.zoomDistance=w,this.onCurrentZoomSetFromInternals&&this.onCurrentZoomSetFromInternals(this.previousZoom,w)}},{key:"addKickback",value:function(w){this._targetKickback+=w}},{key:"setKickbackDecreaseRate",value:function(w){this._kickbackDecreaseRate=w}},{key:"getDirection",value:function(){return this._dirVector}},{key:"applyInputsToCamera",value:function(){var w=this.noa.inputs.pointerState;!function(w){var v=w.dx,I=w.dy,P=Math.abs(v)>100&&Math.abs(v/z)>4,u=Math.abs(I)>100&&Math.abs(I/E)>4;P||u?(w.dx=z,w.dy=E,z=(z+v)/2,E=(E+I)/2):(z=v||1,E=I||1)}(w);var v=.0066*Math.PI/180,I=w.dy*this.sensitivityY*v,P=w.dx*this.sensitivityX*v;this.inverseY&&(I=-I),this.inverseX&&(P=-P),this.inputsDisabled&&(P=I=0),I-=this._kickbackDiffToApply,this._kickbackDiffToApply=0;var u=2*Math.PI;this.heading+=P<0?P+u:P,this.heading>u&&(this.heading-=u);var Q=Math.PI/2-.001;this.pitch=Math.max(-Q,Math.min(Q,this.pitch+I)),K().set(this._dirVector,0,0,1);var a=this._dirVector,U=J;K().rotateX(a,a,U,this.pitch),K().rotateY(a,a,U,this.heading)}},{key:"updateBeforeEntityRenderSystems",value:function(w){var v=(this.zoomDistance-this.currentZoom)*this.zoomSpeed;Math.abs(v)<1e-4?this.currentZoom=this.zoomDistance:this.currentZoom+=v,0!==v&&this.onCurrentZoomChange&&this.onCurrentZoomChange(this.currentZoom,this.currentZoom-v);var I=this._targetKickback*this._kickbackDecreaseRate*w;I<1e-4?(this._targetKickback=0,this._kickbackDiffToApply=-this._appliedKickback,this._appliedKickback=0):this._targetKickback-=I;var P=Date.now(),u=(this._targetKickback-this._appliedKickback)*this._approachTargetKickbackRate*(P-this._lastUpdateBeforeEntityRender);Math.abs(u)<1e-5?this._appliedKickback=this._targetKickback:(this._kickbackDiffToApply+=u,this._appliedKickback+=u),this._lastUpdateBeforeEntityRender=P}},{key:"updateAfterEntityRenderSystems",value:function(){var w=Math.max(function(w){if(!R){var v=w.noa.worldOriginOffset;R=new(U())([0,0,0],K().clone(j)),x=function(I,P,u){return w.noa.world.getBlockSolidity(I+v[0],P+v[1],u+v[2])},K().scale(j,j,-.5)}R.setPosition(w._localGetTargetPosition()),R.translate(j);var I=Math.max(w.zoomDistance,w.currentZoom)+.5;return K().scale(s,w.getDirection(),-I),r()(x,R,s,B,!0)}(this)-.2,0);if(this.currentZoom>w&&(this.currentZoom=w),this.noa.rendering._camera.position.x||this.noa.rendering._camera.position.y){var v=Math.max(function(w){R.setPosition(w._localGetPosition()),R.translate(j);var v=Math.max(w.targetY,w.noa.rendering._camera.position.y)+.5,I=w.getUpDirection();return K().scale(s,I,v),r()(x,R,s,B,!0)}(this)-.2,0);this.noa.rendering._camera.position.y>v&&(this.noa.rendering._camera.position.y=v);var I=Math.max(function(w){var v=w._localGetPosition(),I=t(w.heading,w.pitch+Math.PI/2);K().scaleAndAdd(v,v,I,w.noa.rendering._camera.position.y),R.setPosition(v),R.translate(j);var P=Math.max(w.targetX,w.noa.rendering._camera.position.x)+.5,u=t(w.heading-Math.PI/2,0);return K().scale(s,u,P),r()(x,R,s,B,!0)}(this)-.2,0);this.noa.rendering._camera.position.x>I&&(this.noa.rendering._camera.position.x=I)}}}]),w}();var R,x,j=K().fromValues(.2,.2,.2),s=K().create(),B=function(){return!0};function t(w,v){return v=Math.PI/2-v,w=-w,[Math.sin(v)*Math.sin(w),Math.cos(v),-(Math.sin(v)*Math.cos(w))]}function i(w){var v=w[0],I=w[1],P=w[2],u=-Math.atan2(v,-P),Q=Math.pow(Math.pow(v,2)+Math.pow(P,2),.5);return{theta:u,phi:Math.atan2(I,Q)}}var z=0,E=0},38040:function(w,v,I){"use strict";I.d(v,{e:function(){return U}});var P=I(29439),u=I(65596),Q=I(47786),K=I.n(Q);function a(w,v,I,P,Q,a,U,p){var Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;this.noa=w,this.isDisposed=!1,this.requestID=v,this.voxels=U,this.userData=p,this.i=I,this.j=P,this.k=Q,this.size=a,this.x=I*a,this.y=P*a,this.z=Q*a,this.pos=[this.x,this.y,this.z],this._terrainDirty=!1,this._objectsDirty=!1,this._terrainMeshes=[],w._terrainMesher.initChunk(this),w._objectMesher.initChunk(this),this._isFull=!1,this._isEmpty=!1,this._wholeLayerVoxel=Array(a).fill(-1),Y>=0&&(this.voxels.data.fill(Y,0,this.voxels.size),this._wholeLayerVoxel.fill(Y));var g=Array.from(Array(27),(function(){return null}));this._neighbors=K()(g,[3,3,3]).lo(1,1,1),this._neighbors.set(0,0,0,this),this._neighborCount=0,this._timesMeshed=0,this._blockHandlerLocs=new u.f,r(this)}function U(w){var v=new Uint16Array(w*w*w);return K()(v,[w,w,w])}function p(w,v,I,P,u,Q){var K=v[I];K&&K(w.x+P,w.y+u,w.z+Q)}function r(w){for(var v=w.voxels,I=v.data,P=v.shape[0],u=w.noa.registry._opacityLookup,Q=w.noa.registry._blockHandlerLookup,K=w.noa.registry._objectLookup,a=w.noa.registry._blockIsPlainLookup,U=w.noa._objectMesher,r=!0,Y=!0,g=0;g<P;++g){var J=w._wholeLayerVoxel[g];if(J>=0&&!U[J]&&!Q[J])u[J]||(r=!1),0!==J&&(Y=!1);else{for(var l=v.get(0,g,0),R=0;R<P;++R)for(var x=v.index(R,g,0),j=0;j<P;++j,++x){var s=I[x];if(l>=0&&s!==l&&(l=-1),0!==s)if(a[s])Y=!1;else{r=r&&u[s],Y=!1,K[s]&&(U.setObjectBlock(w,s,R,g,j),w._objectsDirty=!0);var B=Q[s];B&&(w._blockHandlerLocs.add(R,g,j),p(w,B,"onLoad",R,g,j))}else r=!1}l>=0&&(w._wholeLayerVoxel[g]=l)}}w._isFull=r,w._isEmpty=Y,w._terrainDirty=!w._isEmpty}function Y(w,v){var I=w.voxels,u=w.noa.registry._blockHandlerLookup;w._blockHandlerLocs.arr.forEach((function(Q){var K=(0,P.e)(Q,3),a=K[0],U=K[1],r=K[2],Y=I.get(a,U,r);p(w,u[Y],v,a,U,r)}))}v.g=a,a.prototype._updateVoxelArray=function(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;Y(this,"onUnload"),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels=w,this._terrainDirty=!1,this._objectsDirty=!1,this._blockHandlerLocs.empty(),this.noa._objectMesher.initChunk(this),this.noa._terrainMesher.initChunk(this),v>=0?this._wholeLayerVoxel.fill(v):this._wholeLayerVoxel.fill(-1),r(this)},a.prototype.get=function(w,v,I){return this.voxels.get(w,v,I)},a.prototype.getSolidityAt=function(w,v,I){return this.noa.registry._solidityLookup[this.voxels.get(w,v,I)]},a.prototype.set=function(w,v,I,P){var u=this.voxels.get(w,v,I);if(P!==u){this.voxels.set(w,v,I,P);var Q=this.noa.registry._solidityLookup,K=this.noa.registry._objectLookup,a=this.noa.registry._opacityLookup,U=this.noa.registry._blockHandlerLookup;a[P]||(this._isFull=!1),0!==P&&(this._isEmpty=!1),this._wholeLayerVoxel[v]!==P&&(this._wholeLayerVoxel[v]=-1);var r=U[u],Y=U[P];r&&p(this,r,"onUnset",w,v,I),Y?(p(this,Y,"onSet",w,v,I),this._blockHandlerLocs.add(w,v,I)):this._blockHandlerLocs.remove(w,v,I);var g=this.noa._objectMesher,J=K[u],l=K[P];J&&g.setObjectBlock(this,0,w,v,I),l&&g.setObjectBlock(this,P,w,v,I);var R=Q[u]!==Q[P],x=a[u]!==a[P],j=!J&&0!==u,s=!l&&0!==P;if((J||l)&&(this._objectsDirty=!0),(R||x||j||s)&&(this._terrainDirty=!0),(this._terrainDirty||this._objectsDirty)&&this.noa.world._queueChunkForRemesh(this),R||x||j||s)for(var B=this.size-1,t=0===v?-1:0,i=0===I?-1:0,z=w===B?1:0,E=v===B?1:0,o=I===B?1:0,h=0===w?-1:0;h<=z;h++)for(var n=t;n<=E;n++)for(var W=i;W<=o;W++)if(0!==(h|n|W)){var V=this._neighbors.get(h,n,W);V&&(V._terrainDirty=!0,this.noa.world._queueChunkForRemesh(V))}}},a.prototype.updateMeshes=function(){this._terrainDirty&&(this.noa._terrainMesher.meshChunk(this),this._timesMeshed++,this._terrainDirty=!1),this._objectsDirty&&(this.noa._objectMesher.buildObjectMeshes(),this._objectsDirty=!1)},a.prototype.dispose=function(){Y(this,"onUnload"),this._blockHandlerLocs.empty(),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels.data=null,this.voxels=null,this._neighbors.data=null,this._neighbors=null,this.isDisposed=!0}},30877:function(w,v,I){"use strict";I.d(v,{c:function(){return j}});var P=I(37762),u=I(1413),Q=I(15671),K=I(43144),a=I(60136),U=I(43668),p=I(6547),r=I.n(p),Y=I(47077),g=I.n(Y),J=I(89),l=I(66953),R={shadowDistance:10},x={physics:{fn:I(66953),server:!0},position:{fn:I(89),server:!0},shadow:{},smoothCamera:{fn:I(69448),server:!0},collideEntities:{fn:I(78295),server:!0},collideTerrain:{fn:I(28506),server:!0},fadeOnZoom:{},followsEntity:{fn:I(72384),server:!0},mesh:{}},j=function(w){(0,a.e)(p,w);var v=(0,U.d)(p);function p(w,I){var P;return(0,Q.e)(this,p),(P=v.call(this)).noa=w,P.opts=Object.assign({},R,I),P.names={},P.createComponentsClient(),P.assignFieldsAndHelpers(),P}return(0,K.c)(p,[{key:"createComponentsClient",value:function(){var w={shadow:this.opts.shadowDistance},v=(0,u.b)((0,u.b)({},x),{},{shadow:{fn:I(88044),server:!1},smoothCamera:{fn:I(69448),server:!1},collideEntities:{fn:I(78295),server:!1},fadeOnZoom:{fn:I(70183),server:!1},followsEntity:{fn:I(72384),server:!1},mesh:{fn:I(21235),server:!1}});for(var P in v)v[P].fn?(v[P].fn.default&&(v[P].fn=v[P].fn.default),this.createComponent(v[P].fn(this.noa,w[P]))):this.createComponent({name:P}),this.names[P]=P}},{key:"createComponentsServer",value:function(){var w={shadow:this.opts.shadowDistance};for(var v in x)x[v].fn?(x[v].fn.default&&(x[v].fn=x[v].fn.default),this.createComponent(x[v].fn(this.noa,w[v]))):this.createComponent({name:v}),this.names[v]=v}},{key:"assignFieldsAndHelpers",value:function(){var w=this,v=this.noa;this.isPlayer=function(w){return w===v.playerEntity},this.cameraSmoothed=this.getComponentAccessor(this.names.smoothCamera),this.hasPhysics=this.getComponentAccessor(this.names.physics),this.hasPosition=this.getComponentAccessor(this.names.position),this.getPositionData=this.getStateAccessor(this.names.position),this.getPosition=function(v){var I=w.getPositionData(v);return I?I.position:null},this.getPhysics=this.getStateAccessor(this.names.physics),this.getPhysicsBody=function(v){var I=w.getPhysics(v);return I?I.body:null},this.hasMesh=this.getComponentAccessor(this.names.mesh),this.getMeshData=this.getStateAccessor(this.names.mesh),this.getMovement=null,this.getCollideTerrain=this.getStateAccessor(this.names.collideTerrain),this.getCollideEntities=this.getStateAccessor(this.names.collideEntities),this.getMoveState=null,this.getGenericPlayerState=null,this.getHeldItemState=null,this.getHeldItem=null,this.getPlayerMeshState=null,this.getHitboxState=null,this.getReceivesInputs=null,this.getInventoryState=null,this.getInventory=null,this.getInvenOps=null,this.hasInventory=null,this.onPairwiseEntityCollision=function(w,v){}}},{key:"setPosition",value:function(w,v){var I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;"number"===typeof v&&(v=[v,I,P]);var u=this.noa.globalToLocal(v,null,[]);this._localSetPosition(w,u)}},{key:"setEntitySize",value:function(w,v,I,P){var u=this.getPositionData(w);u.width=(v+P)/2,u.height=I,this._updateDerivedPositionData(w,u)}},{key:"_rebaseOrigin",value:function(w){var v,I=(0,P.b)(this.getStatesList(this.names.position));try{for(I.s();!(v=I.n()).done;){var u=v.value,Q=u._localPosition,K=u.width/2;s(Q,0,-K,K,u.__id),s(Q,1,0,u.height,u.__id),s(Q,2,-K,K,u.__id),g().subtract(Q,Q,w),this._updateDerivedPositionData(u.__id,u)}}catch(w){I.e(w)}finally{I.f()}}},{key:"_localGetPosition",value:function(w){return this.getPositionData(w)._localPosition}},{key:"_localSetPosition",value:function(w,v){var I=this.getPositionData(w);g().copy(I._localPosition,v),this._updateDerivedPositionData(w,I)}},{key:"_updateDerivedPositionData",value:function(w,v){g().copy(v._renderPosition,v._localPosition);var I=this.noa.worldOriginOffset;g().add(v.position,v._localPosition,I),(0,J.updatePositionExtents)(v);var P=this.getPhysics(w);P&&(0,l.setPhysicsFromPosition)(P,v)}},{key:"addComponentAgain",value:function(w,v,I){this.hasComponent(w,v)&&this.removeComponent(w,v),this.addComponent(w,v,I)}},{key:"isTerrainBlocked",value:function(w,v,I){for(var P=this.noa.worldOriginOffset,u=Math.floor(w-P[0]),Q=Math.floor(v-P[1]),K=Math.floor(I-P[2]),a=[u+.001,Q+.001,K+.001,u+.999,Q+.999,K+.999],U=this.getStatesList(this.names.collideTerrain),p=0;p<U.length;p++){var r=U[p].__id;if(B(a,this.getPositionData(r)._extents))return!0}return!1}},{key:"getEntitiesInAABB",value:function(w,v){var I,u=this.noa.worldOriginOffset,Q=[w.base[0]-u[0],w.base[1]-u[1],w.base[2]-u[2],w.max[0]-u[0],w.max[1]-u[1],w.max[2]-u[2]];if(v){I=[];var K,a=(0,P.b)(this.getStatesList(v));try{for(a.s();!(K=a.n()).done;){var U=K.value,p=this.getPositionData(U.__id);p&&I.push(p)}}catch(w){a.e(w)}finally{a.f()}}else I=this.getStatesList(this.names.position);for(var r=[],Y=0;Y<I.length;Y++){var g=I[Y];B(Q,g._extents)&&r.push(g.__id)}return r}},{key:"add",value:function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,U=this,p=a||this.createEntity();if(this.addComponent(p,this.names.position,{position:w||g().create(),width:v,height:I}),Q){this.addComponent(p,this.names.physics);var r=this.getPhysicsBody(p),Y=this.names.smoothCamera;r.onStep=function(){U.addComponentAgain(p,Y)}}return P&&(u||(u=g().create()),this.addComponent(p,this.names.mesh,{mesh:P,offset:u})),K&&this.addComponent(p,this.names.shadow,{size:v}),p}}]),p}(r());function s(w,v,I,P,u){var Q=w[v]+I,K=w[v]+P;Math.abs(Q-Math.round(Q))<.002&&(w[v]+=.002),Math.abs(K-Math.round(K))<.001&&(w[v]-=.001)}function B(w,v){return!(w[0]>v[3])&&(!(w[1]>v[4])&&(!(w[2]>v[5])&&(!(w[3]<v[0])&&(!(w[4]<v[1])&&!(w[5]<v[2])))))}},82936:function(w,v,I){"use strict";I.d(v,{c:function(){return K}});var P=I(43144),u=I(15671),Q={texturePath:""},K=(0,P.c)((function w(v,I,P){(0,u.e)(this,w),I=Object.assign({},Q,I),this.noa=v,this._texturePath=I.texturePath;var K={},Y=[!1],g=[!1],J=[!1],l=[!1],R=[null],x=[null],j=[null],s=[!1];this.blockMats=[0,0,0,0,0,0];var B=[null],t=[-1],i=[];this.registerBlock=function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=new p(v&&v.fluid),P=Object.assign({},I,v||{});if(w<1||w>65535)throw"Block id out of range: "+w;for(;w>Y.length;)this.registerBlock(Y.length,{});Y[w]=!!P.solid,g[w]=!!P.opaque,J[w]=!!P.fluid,l[w]=!!P.blockMesh,x[w]=P.blockMesh||null;var u,Q=P.material||null;if(Q)if("string"==typeof Q)u=[Q,Q,Q,Q,Q,Q];else if(Q.length&&2==Q.length)u=[Q[1],Q[1],Q[0],Q[0],Q[1],Q[1]];else if(Q.length&&3==Q.length)u=[Q[2],Q[2],Q[0],Q[1],Q[2],Q[2]];else{if(!Q.length||6!=Q.length)throw"Invalid material parameter: "+Q;u=Q}else u=[null,null,null,null,null,null];for(var r=0;r<6;++r)this.blockMats[6*w+r]=a(this,K,u[r],!0);R[w]={},J[w]&&(R[w].fluidDensity=P.fluidDensity,R[w].viscosity=P.viscosity);var B=P.onLoad||P.onUnload||P.onSet||P.onUnset||P.onCustomMeshCreate;j[w]=B?new U(P):null;var t=Y[w]&&g[w]&&!B&&!J[w]&&!l[w];return s[w]=t,w},this.registerMaterial=function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"?",v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(Array.isArray(v)||arguments[2])throw'This API changed signatures in v0.33, please use: `noa.registry.registerMaterial("name", optionsObj)`';var I=Object.assign(new r,v||{}),u=K[w]||i.length;K[w]=u;var Q=I.textureURL?this._texturePath+I.textureURL:"",a=1,U=I.color||[1,1,1];4===U.length&&(a=U.pop()),Q&&(U=null),B[u]=U,t[u]=I.atlasIndex,i[u]={color:U,alpha:a,texture:Q,texHasAlpha:!!I.texHasAlpha,atlasIndex:I.atlasIndex,renderMat:I.renderMaterial};var p=P.getTerrainMatId(u);if(I.atlasIndex>=0&&I.texHasAlpha){var Y=P.getMaterial(p);Y.diffuseTexture.hasAlpha=!0}return u},this.getBlockSolidity=function(w){return Y[w]},this.getBlockOpacity=function(w){return g[w]},this.getBlockFluidity=function(w){return J[w]},this.getBlockProps=function(w){return R[w]},this.getBlockFaceMaterial=function(w,v){return this.blockMats[6*w+v]},this.getMaterialData=function(w){return i[w]},this._textureNeedsAlpha=function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return i.some((function(v){return v.texture===w&&v.texHasAlpha}))},this._solidityLookup=Y,this._opacityLookup=g,this._fluidityLookup=J,this._objectLookup=l,this._blockMeshLookup=x,this._blockHandlerLookup=j,this._blockIsPlainLookup=s,this._materialColorLookup=B,this._matAtlasIndexLookup=t}));function a(w,v,I,P){if(!I)return 0;var u=v[I];return void 0===u&&P&&(u=w.registerMaterial(I)),u}function U(w){this.onLoad=w.onLoad||null,this.onUnload=w.onUnload||null,this.onSet=w.onSet||null,this.onUnset=w.onUnset||null,this.onCustomMeshCreate=w.onCustomMeshCreate||null}function p(){var w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.solid=!w,this.opaque=!w,this.fluid=!1,this.material=null,this.blockMesh=null,this.fluidDensity=1,this.viscosity=.5,this.onLoad=null,this.onUnload=null,this.onSet=null,this.onUnset=null,this.onCustomMeshCreate=null}function r(){this.color=null,this.textureURL=null,this.texHasAlpha=!1,this.atlasIndex=-1,this.renderMaterial=null}},51810:function(){"undefined"===typeof window||window.global||(window.global=window.globalThis||{})},65596:function(w,v,I){"use strict";I.d(v,{c:function(){return p},f:function(){return r},h:function(){return U},l:function(){return a},n:function(){return g},q:function(){return K}});var P=I(37762),u=I(15671),Q=I(43144);function K(w,v){var I=w.indexOf(v);I<0||(I===w.length-1?w.pop():w[I]=w.pop())}function a(w,v,I){var P=I||performance.now();if(!v()){var u=performance.now(),Q=P+w-(u-I)/2;if(!(u>Q))for(var K=0;K<1e3;K++)if(v()||performance.now()>Q)return}}function U(w,v,I){return 1023&w|(1023&v)<<10|(1023&I)<<20}function p(){var w={};this.getChunkByIndexes=function(v,I,P){return w[U(v,I,P)]||null},this.storeChunkByIndexes=function(v,I,P,u){w[U(v,I,P)]=u},this.removeChunkByIndexes=function(v,I,P){delete w[U(v,I,P)]}}var r=function(){function w(){(0,u.e)(this,w),this.arr=[],this.hash={}}return(0,Q.c)(w,[{key:"forEach",value:function(w,v){this.arr.forEach(w,v)}},{key:"includes",value:function(w,v,I){var P=U(w,v,I);return!!this.hash[P]}},{key:"add",value:function(w,v,I){var P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=U(w,v,I);this.hash[u]||(P?this.arr.unshift([w,v,I,u]):this.arr.push([w,v,I,u]),this.hash[u]=!0)}},{key:"removeByIndex",value:function(w){var v=this.arr[w];delete this.hash[v[3]],this.arr.splice(w,1)}},{key:"remove",value:function(w,v,I){var P=U(w,v,I);if(this.hash[P]){delete this.hash[P];for(var u=0;u<this.arr.length;u++)if(P===this.arr[u][3])return void this.arr.splice(u,1);throw"internal bug with location queue - hash value overlapped"}}},{key:"count",value:function(){return this.arr.length}},{key:"isEmpty",value:function(){return 0===this.arr.length}},{key:"empty",value:function(){this.arr=[],this.hash={}}},{key:"pop",value:function(){var w=this.arr.pop();return delete this.hash[w[3]],w}},{key:"copyFrom",value:function(w){for(var v in this.arr=w.arr.slice(),this.hash={},w.hash)this.hash[v]=!0}},{key:"sortByDistance",value:function(w){var v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=this.arr.length,u=I&&P>1e3;if(u){var Q=this.arr.slice(0,100).concat(this.arr.slice(P-100));Y(Q,w,v);for(var K=0;K<100;K++)this.arr[K]=Q[K],this.arr[P-K-1]=Q[200-K-1]}else Y(this.arr,w,v)}}]),w}();function Y(w,v,I){var u,Q={},K=(0,P.b)(w);try{for(K.s();!(u=K.n()).done;){var a=u.value;Q[a[3]]=v(a[0],a[1],a[2])}}catch(w){K.e(w)}finally{K.f()}I?w.sort((function(w,v){return Q[w[3]]-Q[v[3]]})):w.sort((function(w,v){return Q[v[3]]-Q[w[3]]})),Q=null}function g(w){var v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",I=arguments.length>2?arguments[2]:void 0;if(!(w>0))return function(){};var P={},u=0,Q=0,K=0,a=0,U=function(){u=Q=performance.now(),K++},p=function(w){var v=performance.now();P[w]=(P[w]||0)+(v-Q),Q=v},r=function(){if(a+=performance.now()-u,!(K<w)){var Q="".concat(v,": ").concat((a/w).toFixed(2),"ms  --  ");Q+=Object.keys(P).map((function(w){return I&&P[w]/a<.05?"":"".concat(w,": ").concat((P[w]/K).toFixed(2),"ms")})).join("  "),console.log(Q+"    (avg over ".concat(w," runs)")),P={},K=a=0}};return function(w){"start"===w?U():"end"===w?r():p(w)}}},85630:function(w,v,I){"use strict";I.d(v,{d:function(){return R},g:function(){return s}});var P=I(37762),u=I(29439),Q=I(43144),K=I(15671),a=I(97326),U=I(60136),p=I(43668),r=I(68041),Y=I.n(r),g=I(38040),J=I(65596),l={chunkSize:32,chunkAddDistance:[2,2],chunkRemoveDistance:[3,3],worldGenWhilePaused:!1,manuallyControlChunkLoading:!1},R=function(w){(0,U.e)(I,w);var v=(0,p.d)(I);function I(w,P){var u,Q;(0,K.e)(this,I),u=v.call(this),P=Object.assign({},l,P),u.noa=w,u.playerChunkLoaded=!1,u.Chunk=g.g,u.manuallyControlChunkLoading=!!P.manuallyControlChunkLoading,u.chunkSortingDistFn=m,u.minNeighborsToMesh=6,u.worldGenWhilePaused=!!P.worldGenWhilePaused,u.maxChunksPendingCreation=10,u.maxChunksPendingMeshing=10,u.maxProcessingPerTick=2,u.maxProcessingPerRender=5,u._chunkSize=P.chunkSize,u._chunkAddDistance=[2,2],u._chunkRemoveDistance=[3,3],u._addDistanceFn=null,u._remDistanceFn=null,u._prevWorldName="",u._prevPlayerChunkHash=0,u._chunkAddSearchFrom=0,u._prevSortingFn=null,u._chunksKnown=null,u._chunksPending=null,u._chunksToRequest=null,u._chunksToRemove=null,u._chunksToMesh=null,u._chunksToMeshFirst=null,u._chunksSortedLocs=null,(Q=(0,a.d)(u))._chunksKnown=new J.f,Q._chunksToMesh=new J.f,Q._chunksPending=new J.f,Q._chunksToRemove=new J.f,Q._chunksToRequest=new J.f,Q._chunksToMeshFirst=new J.f,Q._chunksSortedLocs=new J.f,u.setAddRemoveDistance(P.chunkAddDistance,P.chunkRemoveDistance),u._storage=new J.c;var U=u._chunkSize;return u._coordsToChunkIndexes=V,u._coordsToChunkLocals=F,0===(U&U-1)&&(u._coordShiftBits=0|Math.log2(U),u._coordMask=U-1|0,u._coordsToChunkIndexes=O,u._coordsToChunkLocals=N),u.canChangeBlockCoord=new Set,u.canChangeBlockType=new Set,u.canChangeBlockRect=[],u.cantChangeBlockCoord=new Set,u.cantChangeBlockType=new Set,u.cantChangeBlockRect=[],u.walkThroughType=new Set,u.walkThroughRect=[],u.meshingTick=1,u}return(0,Q.c)(I)}(Y());R.prototype.getBlockID=function(w,v,I){var P=this._coordsToChunkIndexes(w,v,I),Q=(0,u.e)(P,3),K=Q[0],a=Q[1],U=Q[2],p=this._storage.getChunkByIndexes(K,a,U);if(!p)return 0;var r=this._coordsToChunkLocals(w,v,I),Y=(0,u.e)(r,3),g=Y[0],J=Y[1],l=Y[2];return p.voxels.get(g,J,l)},R.prototype.getBlockSolidity=function(w,v,I){var Q=this._coordsToChunkIndexes(w,v,I),K=(0,u.e)(Q,3),a=K[0],U=K[1],p=K[2],r=this._storage.getChunkByIndexes(a,U,p);if(!r)return!1;var Y=this._coordsToChunkLocals(w,v,I),g=(0,u.e)(Y,3),J=g[0],l=g[1],R=g[2],x=r.get(J,l,R);if(0===x)return!1;if(this.walkThroughType.has(x))return!1;var s,B=(0,P.b)(this.walkThroughRect);try{for(B.s();!(s=B.n()).done;){if(j(w,v,I,s.value))return!1}}catch(w){B.e(w)}finally{B.f()}return!!r.getSolidityAt(J,l,R)},R.prototype.getBlockOpacity=function(w,v,I){var P=this.getBlockID(w,v,I);return this.noa.registry.getBlockOpacity(P)},R.prototype.getBlockFluidity=function(w,v,I){var P=this.getBlockID(w,v,I);return this.noa.registry.getBlockFluidity(P)},R.prototype.getBlockProperties=function(w,v,I){var P=this.getBlockID(w,v,I);return this.noa.registry.getBlockProps(P)},R.prototype.setBlockID=function(w,v,I,P){var Q=this._coordsToChunkIndexes(v,I,P),K=(0,u.e)(Q,3),a=K[0],U=K[1],p=K[2],r=this._storage.getChunkByIndexes(a,U,p);if(r){var Y=this._coordsToChunkLocals(v,I,P),g=(0,u.e)(Y,3),J=g[0],l=g[1],R=g[2];return r.set(J,l,R,w,v,I,P)}},R.prototype.hasChunkWithBlockCoordinates=function(w,v,I){var P=this._coordsToChunkIndexes(w,v,I),Q=(0,u.e)(P,3),K=Q[0],a=Q[1],U=Q[2];return!!this._storage.getChunkByIndexes(K,a,U)},R.prototype.isBoxUnobstructed=function(w){for(var v=w.base,I=w.max,P=Math.floor(v[0]);P<I[0]+1;P++)for(var u=Math.floor(v[1]);u<I[1]+1;u++)for(var Q=Math.floor(v[2]);Q<I[2]+1;Q++)if(this.getBlockSolidity(P,u,Q))return!1;return!0},R.prototype.setChunkData=function(w,v){var I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;return W(this,w,v,I,P)},R.prototype.setAddRemoveDistance=function(){var w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,I=Array.isArray(w)?w:[w,w],P=Array.isArray(v)?v:[v,v],u=1;P[0]<I[0]+u&&(P[0]=I[0]+u),P[1]<I[1]+u&&(P[1]=I[1]+u),this._chunkAddDistance=I,this._chunkRemoveDistance=P,this._addDistanceFn=M(I[0],I[1]),this._remDistanceFn=M(P[0],P[1]),this._chunksSortedLocs.empty();for(var Q=0;Q<=I[0];Q++)for(var K=0;K<=Q;K++)for(var a=0;a<=I[1];a++)this._addDistanceFn(Q,a,K)&&this._chunksSortedLocs.add(Q,a,K);this._prevSortingFn=null,this._chunkAddSearchFrom=0},R.prototype.invalidateVoxelsInAABB=function(w){!function(w,v){for(var I=w._coordsToChunkIndexes(v.base[0],v.base[1],v.base[2]),P=w._coordsToChunkIndexes(v.max[0],v.max[1],v.max[2]),u=0;u<3;u++)Number.isFinite(v.base[u])||(I[u]=v.base[u]),Number.isFinite(v.max[u])||(P[u]=v.max[u]);w._chunksKnown.forEach((function(v){for(var u=0;u<3;u++)if(v[u]<I[u]||v[u]>P[u])return;w._chunksToRemove.add(v[0],v[1],v[2]),w._chunksToMesh.remove(v[0],v[1],v[2]),w._chunksToRequest.remove(v[0],v[1],v[2]),w._chunksToMeshFirst.remove(v[0],v[1],v[2])}));for(;!o(w););w._chunkAddSearchFrom=0}(this,w)},R.prototype.manuallyLoadChunk=function(w,v,I){if(!this.manuallyControlChunkLoading)throw x;var P=this._coordsToChunkIndexes(w,v,I),Q=(0,u.e)(P,3),K=Q[0],a=Q[1],U=Q[2];this._chunksKnown.add(K,a,U),this._chunksToRequest.add(K,a,U)},R.prototype.manuallyUnloadChunk=function(w,v,I){var P=this._coordsToChunkIndexes(w,v,I),Q=(0,u.e)(P,3),K=Q[0],a=Q[1],U=Q[2];for(this._chunksToRemove.add(K,a,U),this._chunksToMesh.remove(K,a,U),this._chunksToRequest.remove(K,a,U),this._chunksToMeshFirst.remove(K,a,U),this._chunksPending.remove(K,a,U);!o(this););this._chunkAddSearchFrom=0};var x="Set `noa.world.manuallyControlChunkLoading` if you need this API";function j(w,v,I,P){var Q=(0,u.e)(P,6),K=Q[0],a=Q[1],U=Q[2],p=Q[3],r=Q[4],Y=Q[5];return w>=K&&v>=a&&I>=U&&w<=p&&v<=r&&I<=Y}function s(w,v,I,u,Q,K,a,U,p,r,Y){var g="".concat(w,"|").concat(v,"|").concat(I);if(Q.has(g))return Y;if(K.has(g))return!Y;var J,l=(0,P.b)(p);try{for(l.s();!(J=l.n()).done;){if(j(w,v,I,J.value))return Y}}catch(w){l.e(w)}finally{l.f()}var R,x=(0,P.b)(r);try{for(x.s();!(R=x.n()).done;){if(j(w,v,I,R.value))return!Y}}catch(w){x.e(w)}finally{x.f()}return a.has(u)?Y:(U.has(u),!Y)}function B(w){var v=w.noa.entities.getPosition(w.noa.playerEntity),I=(0,u.e)(v,3),P=I[0],Q=I[1],K=I[2];return w._coordsToChunkIndexes(Math.floor(P),Math.floor(Q),Math.floor(K))}R.prototype.canChangeBlock=function(w,v,I){return this.noa.serverSettings.canChange?s(w,v,I,this.getBlockID(w,v,I),this.cantChangeBlockCoord,this.canChangeBlockCoord,this.cantChangeBlockType,this.canChangeBlockType,this.cantChangeBlockRect,this.canChangeBlockRect,!1):s(w,v,I,this.getBlockID(w,v,I),this.canChangeBlockCoord,this.cantChangeBlockCoord,this.canChangeBlockType,this.cantChangeBlockType,this.canChangeBlockRect,this.cantChangeBlockRect,!0)},R.prototype.tick=function(){var w=this,v=performance.now(),I=B(this),P=(0,u.e)(I,3),Q=P[0],K=P[1],a=P[2],U=(0,J.h)(Q,K,a),p=U!==this._prevPlayerChunkHash;if(p&&(this.emit("playerEnteredChunk",Q,K,a),this._prevPlayerChunkHash=U,this._chunkAddSearchFrom=0),this._prevWorldName!==this.noa.worldName&&(this.markAllChunksForRemoval(),this._prevWorldName=this.noa.worldName,this._chunkAddSearchFrom=0,o(this)),e("start"),H("start"),this.manuallyControlChunkLoading||(p&&(!function(w,v,I,P){var Q=w._remDistanceFn,K=w._chunksToRemove;w._chunksKnown.forEach((function(a){var U=(0,u.e)(a,3),p=U[0],r=U[1],Y=U[2];K.includes(p,r,Y)||Q(p-v,r-I,Y-P)||(w._chunksToRemove.add(p,r,Y),w._chunksToMesh.remove(p,r,Y),w._chunksToRequest.remove(p,r,Y),w._chunksToMeshFirst.remove(p,r,Y))})),q(K,v,I,P,w.chunkSortingDistFn,!1,!0)}(this,Q,K,a),e("remQueue")),function(w,v,I,P){var Q=w._chunksToRequest,K=w._chunkAddSearchFrom,a=w._chunksSortedLocs;if(K>=a.arr.length)return;if(w._chunksToRequest.count()>50)return;w._prevSortingFn!==w.chunkSortingDistFn&&(w.chunkSortingDistFn||(w.chunkSortingDistFn=m),q(a,0,0,0,w.chunkSortingDistFn,!0),w._prevSortingFn=w.chunkSortingDistFn);t.removals=0,t.ci=v,t.cj=I,t.ck=P;for(var U=w._chunksSortedLocs.arr,p=K;p<U.length;p++){var r=(0,u.e)(U[p],3),Y=r[0],g=r[1],J=r[2];if(i(w,t,Y,g,J),0===t.removals){if(w._chunkAddSearchFrom=p+1,Q.count()>100)break;if(p-K>50)break}else{if(Q.count()>50)break;if(p-K>5)break}}q(Q,v,I,P,w.chunkSortingDistFn,!1,!0)}(this,Q,K,a),e("addQueue")),3===this.meshingTick){var r=Math.max(1,this.maxProcessingPerTick||0),Y=!1,l=!1,R=!1;(0,J.l)(r,(function(){return Y||(Y=function(w){var v=w._chunksToRequest;if(v.isEmpty())return!0;var I=w._chunksPending.count(),P=w._chunksToMesh.count();if(I>=w.maxChunksPendingCreation)return!0;if(P>=w.maxChunksPendingMeshing)return!0;var Q=v.pop(),K=(0,u.e)(Q,3),a=K[0],U=K[1],p=K[2];return function(w,v,I,P){var u=w._chunkSize,Q=(0,g.e)(w._chunkSize),K=w.noa.worldName,a=[v,I,P,K].join("|"),U=v*u,p=I*u,r=P*u;w._chunksPending.add(v,I,P),w.emit("worldDataNeeded",a,Q,U,p,r,K),H("request")}(w,a,U,p),v.isEmpty()}(w)),l?l=!0:(l=h(w,!1),w.meshingTick=0),R||(R=o(w)),Y&&l&&R}),v),(r-=performance.now()-v)>.5&&(!function(w){var v=5,I=w._chunksToMesh.count()+w._chunksToMeshFirst.count();if(I>v)return;for(var P=w._chunksKnown.arr,Q=Math.min(50,P.length),K=0;K<Q;K++){E=(E+1)%P.length;var a=(0,u.e)(P[E],3),U=a[0],p=a[1],r=a[2],Y=w._storage.getChunkByIndexes(U,p,r);if(Y)if(n(w,Y)&&I++,I>v)return}}(this),(0,J.l)(r,(function(){return h(w,!1)}),v))}this.meshingTick++;var x=this._storage.getChunkByIndexes(Q,K,a);this.playerChunkLoaded=!!x,H("end",this),e("end")},R.prototype.render=function(){var w=this,v=this.maxProcessingPerRender;v>0&&(0,J.l)(v,(function(){return h(w,!0)}))},R.prototype._getChunkByCoords=function(w,v,I){var P=this._coordsToChunkIndexes(w,v,I),Q=(0,u.e)(P,3),K=Q[0],a=Q[1],U=Q[2];return this._storage.getChunkByIndexes(K,a,U)},R.prototype._queueChunkForRemesh=function(w){n(this,w)};var t={},i=function w(v,I,P,u,Q){z(v,I,I.ci+P,I.cj+u,I.ck+Q),P!==Q&&z(v,I,I.ci+Q,I.cj+u,I.ck+P),P>0&&w(v,I,-P,u,Q),u>0&&w(v,I,P,-u,Q),Q>0&&w(v,I,P,u,-Q)},z=function(w,v,I,P,u){w._chunksKnown.includes(I,P,u)?w._chunksToRemove.includes(I,P,u)&&v.removals++:(w._chunksKnown.add(I,P,u),w._chunksToRequest.add(I,P,u,!0))};R.prototype.markAllChunksForRemoval=function(){for(this._chunksToRemove.copyFrom(this._chunksKnown),this._chunksToRequest.empty(),this._chunksToMesh.empty(),this._chunksToMeshFirst.empty();!o(this););var w=B(this),v=(0,u.e)(w,3),I=v[0],P=v[1],Q=v[2];q(this._chunksToRemove,I,P,Q,this.chunkSortingDistFn,!1,!0),this._chunkAddSearchFrom=0};var E=-1;function o(w){var v=w._chunksToRemove;if(v.isEmpty())return!0;var I=v.pop(),P=(0,u.e)(I,3);return function(w,v,I,P){var u=w._storage.getChunkByIndexes(v,I,P);u&&(w.emit("chunkBeingRemoved",u.requestID,u.voxels,u.userData),w.noa.rendering.disposeChunkForRendering(u),u.dispose(),H("dispose"),c(w,v,I,P,null));w._storage.removeChunkByIndexes(v,I,P),w._chunksKnown.remove(v,I,P),w._chunksToMesh.remove(v,I,P),w._chunksToMeshFirst.remove(v,I,P)}(w,P[0],P[1],P[2]),v.isEmpty()}function h(w,v){var I=w._chunksToMeshFirst;if(I.isEmpty()&&!v&&(I=w._chunksToMesh),I.isEmpty())return!0;var P=I.pop(),Q=(0,u.e)(P,3),K=Q[0],a=Q[1],U=Q[2];if(!w._chunksToRemove.includes(K,a,U)){var p=w._storage.getChunkByIndexes(K,a,U);p&&function(w,v){w._chunksToMesh.remove(v.i,v.j,v.k),w._chunksToMeshFirst.remove(v.i,v.j,v.k),v.updateMeshes(),H("mesh")}(w,p)}}function n(w,v){return!(!v._terrainDirty&&!v._objectsDirty)&&(!w._chunksToMesh.includes(v.i,v.j,v.k)&&(!w._chunksToMeshFirst.includes(v.i,v.j,v.k)&&((26===v._neighborCount?w._chunksToMeshFirst:w._chunksToMesh).add(v.i,v.j,v.k),!0)))}function W(w,v,I,P,u){var Q=v.split("|"),K=parseInt(Q.shift()),a=parseInt(Q.shift()),U=parseInt(Q.shift()),p=Q.join("|");if(w._chunksPending.remove(K,a,U),p!==w.noa.worldName)return!1;if(!w._chunksKnown.includes(K,a,U))return!1;if(w._chunksToRemove.includes(K,a,U))return!1;var r=w._storage.getChunkByIndexes(K,a,U);if(r)r._updateVoxelArray(I,u);else{var Y=w._chunkSize;r=new g.g(w.noa,v,K,a,U,Y,I,P,u),w._storage.storeChunkByIndexes(K,a,U,r),w.noa.rendering.prepareChunkForRendering(r),w.emit("chunkAdded",r)}return n(w,r),c(w,K,a,U,r),H("receive"),!0}function V(w,v,I){var P=this._chunkSize;return[0|Math.floor(w/P),0|Math.floor(v/P),0|Math.floor(I/P)]}function F(w,v,I){var P=this._chunkSize,u=w%P|0;u<0&&(u+=P);var Q=v%P|0;Q<0&&(Q+=P);var K=I%P|0;return K<0&&(K+=P),[u,Q,K]}function O(w,v,I){var P=this._coordShiftBits;return[w>>P|0,v>>P|0,I>>P|0]}function N(w,v,I){var P=this._coordMask;return[w&P|0,v&P|0,I&P|0]}function q(w,v,I,P,u){var Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=function(w,Q,K){return u(v-w,I-Q,P-K)};w.sortByDistance(a,Q,K)}var m=function(w,v,I){return w*w+v*v+I*I};function c(w,v,I,P,u){for(var Q=!u||u&&!u.isEmpty,K=-1;K<=1;K++)for(var a=-1;a<=1;a++)for(var U=-1;U<=1;U++)if(0!==(K|a|U)){var p=w._storage.getChunkByIndexes(v+K,I+a,P+U);if(p){Q&&(p._terrainDirty=!0),u&&!u._neighbors.get(K,a,U)&&(u._neighborCount++,u._neighbors.set(K,a,U,p));var r=p._neighbors.get(-K,-a,-U);u&&!r&&(p._neighborCount++,p._neighbors.set(-K,-a,-U,u),26===p._neighborCount&&n(w,p)),!u&&r&&(p._neighborCount--,p._neighbors.set(-K,-a,-U,null))}}}function M(w,v){var I=w*w,P=v*v;return w===v?function(w,v,P){return w*w+v*v+P*P<=I}:w>v?function(w,P,u){return!(Math.abs(P)>v)&&w*w+P*P+u*u<=I}:function(w,v,u){var Q=w*w+u*u;return!(Q>I)&&Q+v*v<=P}}function S(w,v,I,P){var u=0,Q=0,K=0,a=0,U=[];I.forEach((function(v){var I=w._storage.getChunkByIndexes(v[0],v[1],v[2]);I&&(K++,U.push(I._timesMeshed),I._isFull&&u++,I._isEmpty&&Q++,26===I._neighborCount&&a++)}));var p=I.length.toString().padEnd(8);if(p+=("exist: "+K).padEnd(12),p+=("full: "+u).padEnd(12),p+=("empty: "+Q).padEnd(12),p+=("surr: "+a).padEnd(12),P){var r=U.reduce((function(w,v){return w+v}),0),Y=U.reduce((function(w,v){return Math.max(w,v)}),0),g=U.reduce((function(w,v){return Math.min(w,v)}),0);p+="times meshed: avg "+(r/K).toFixed(2),p+="  max "+Y,p+="  min "+g}console.log(v,p)}R.prototype.report=function(){console.log("World report - playerChunkLoaded: ",this.playerChunkLoaded),S(this,"  known:     ",this._chunksKnown.arr,!0),S(this,"  to request:",this._chunksToRequest.arr,0),S(this,"  to remove: ",this._chunksToRemove.arr,0),S(this,"  creating:  ",this._chunksPending.arr,0),S(this,"  to mesh:   ",this._chunksToMesh.arr.concat(this._chunksToMeshFirst.arr),0)};var e=(0,J.n)(0,"world ticks:",1),H=function(){}},77604:function(w,v,I){"use strict";var P=I(70547),u=P.Deflate,Q=P.deflate,K=P.deflateRaw,a=P.gzip,U=I(74785),p=U.Inflate,r=U.inflate,Y=U.inflateRaw,g=U.ungzip,J=I(27572);w.exports.Deflate=u,w.exports.deflate=Q,w.exports.deflateRaw=K,w.exports.gzip=a,w.exports.Inflate=p,w.exports.inflate=r,w.exports.inflateRaw=Y,w.exports.ungzip=g,w.exports.constants=J},70547:function(w,v,I){"use strict";var P=I(38106),u=I(16931),Q=I(58415),K=I(74274),a=I(70400),U=Object.prototype.toString,p=I(27572),r=p.Z_NO_FLUSH,Y=p.Z_SYNC_FLUSH,g=p.Z_FULL_FLUSH,J=p.Z_FINISH,l=p.Z_OK,R=p.Z_STREAM_END,x=p.Z_DEFAULT_COMPRESSION,j=p.Z_DEFAULT_STRATEGY,s=p.Z_DEFLATED;function B(w){this.options=u.assign({level:x,method:s,chunkSize:16384,windowBits:15,memLevel:8,strategy:j},w||{});var v=this.options;v.raw&&v.windowBits>0?v.windowBits=-v.windowBits:v.gzip&&v.windowBits>0&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var I=P.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(I!==l)throw new Error(K[I]);if(v.header&&P.deflateSetHeader(this.strm,v.header),v.dictionary){var p;if(p="string"===typeof v.dictionary?Q.string2buf(v.dictionary):"[object ArrayBuffer]"===U.call(v.dictionary)?new Uint8Array(v.dictionary):v.dictionary,(I=P.deflateSetDictionary(this.strm,p))!==l)throw new Error(K[I]);this._dict_set=!0}}function t(w,v){var I=new B(v);if(I.push(w,!0),I.err)throw I.msg||K[I.err];return I.result}B.prototype.push=function(w,v){var I,u,K=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(u=v===~~v?v:!0===v?J:r,"string"===typeof w?K.input=Q.string2buf(w):"[object ArrayBuffer]"===U.call(w)?K.input=new Uint8Array(w):K.input=w,K.next_in=0,K.avail_in=K.input.length;;)if(0===K.avail_out&&(K.output=new Uint8Array(a),K.next_out=0,K.avail_out=a),(u===Y||u===g)&&K.avail_out<=6)this.onData(K.output.subarray(0,K.next_out)),K.avail_out=0;else{if((I=P.deflate(K,u))===R)return K.next_out>0&&this.onData(K.output.subarray(0,K.next_out)),I=P.deflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===l;if(0!==K.avail_out){if(u>0&&K.next_out>0)this.onData(K.output.subarray(0,K.next_out)),K.avail_out=0;else if(0===K.avail_in)break}else this.onData(K.output)}return!0},B.prototype.onData=function(w){this.chunks.push(w)},B.prototype.onEnd=function(w){w===l&&(this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},w.exports.Deflate=B,w.exports.deflate=t,w.exports.deflateRaw=function(w,v){return(v=v||{}).raw=!0,t(w,v)},w.exports.gzip=function(w,v){return(v=v||{}).gzip=!0,t(w,v)},w.exports.constants=I(27572)},74785:function(w,v,I){"use strict";var P=I(31833),u=I(16931),Q=I(58415),K=I(74274),a=I(70400),U=I(84284),p=Object.prototype.toString,r=I(27572),Y=r.Z_NO_FLUSH,g=r.Z_FINISH,J=r.Z_OK,l=r.Z_STREAM_END,R=r.Z_NEED_DICT,x=r.Z_STREAM_ERROR,j=r.Z_DATA_ERROR,s=r.Z_MEM_ERROR;function B(w){this.options=u.assign({chunkSize:65536,windowBits:15,to:""},w||{});var v=this.options;v.raw&&v.windowBits>=0&&v.windowBits<16&&(v.windowBits=-v.windowBits,0===v.windowBits&&(v.windowBits=-15)),!(v.windowBits>=0&&v.windowBits<16)||w&&w.windowBits||(v.windowBits+=32),v.windowBits>15&&v.windowBits<48&&0===(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var I=P.inflateInit2(this.strm,v.windowBits);if(I!==J)throw new Error(K[I]);if(this.header=new U,P.inflateGetHeader(this.strm,this.header),v.dictionary&&("string"===typeof v.dictionary?v.dictionary=Q.string2buf(v.dictionary):"[object ArrayBuffer]"===p.call(v.dictionary)&&(v.dictionary=new Uint8Array(v.dictionary)),v.raw&&(I=P.inflateSetDictionary(this.strm,v.dictionary))!==J))throw new Error(K[I])}function t(w,v){var I=new B(v);if(I.push(w),I.err)throw I.msg||K[I.err];return I.result}B.prototype.push=function(w,v){var I,u,K,a=this.strm,U=this.options.chunkSize,r=this.options.dictionary;if(this.ended)return!1;for(u=v===~~v?v:!0===v?g:Y,"[object ArrayBuffer]"===p.call(w)?a.input=new Uint8Array(w):a.input=w,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(U),a.next_out=0,a.avail_out=U),(I=P.inflate(a,u))===R&&r&&((I=P.inflateSetDictionary(a,r))===J?I=P.inflate(a,u):I===j&&(I=R));a.avail_in>0&&I===l&&a.state.wrap>0&&0!==w[a.next_in];)P.inflateReset(a),I=P.inflate(a,u);switch(I){case x:case j:case R:case s:return this.onEnd(I),this.ended=!0,!1}if(K=a.avail_out,a.next_out&&(0===a.avail_out||I===l))if("string"===this.options.to){var B=Q.utf8border(a.output,a.next_out),t=a.next_out-B,i=Q.buf2string(a.output,B);a.next_out=t,a.avail_out=U-t,t&&a.output.set(a.output.subarray(B,B+t),0),this.onData(i)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(I!==J||0!==K){if(I===l)return I=P.inflateEnd(this.strm),this.onEnd(I),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},B.prototype.onData=function(w){this.chunks.push(w)},B.prototype.onEnd=function(w){w===J&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},w.exports.Inflate=B,w.exports.inflate=t,w.exports.inflateRaw=function(w,v){return(v=v||{}).raw=!0,t(w,v)},w.exports.ungzip=t,w.exports.constants=I(27572)},16931:function(w){"use strict";var v=function(w,v){return Object.prototype.hasOwnProperty.call(w,v)};w.exports.assign=function(w){for(var I=Array.prototype.slice.call(arguments,1);I.length;){var P=I.shift();if(P){if("object"!==typeof P)throw new TypeError(P+"must be non-object");for(var u in P)v(P,u)&&(w[u]=P[u])}}return w},w.exports.flattenChunks=function(w){for(var v=0,I=0,P=w.length;I<P;I++)v+=w[I].length;for(var u=new Uint8Array(v),Q=0,K=0,a=w.length;Q<a;Q++){var U=w[Q];u.set(U,K),K+=U.length}return u}},58415:function(w){"use strict";var v=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(w){v=!1}for(var I=new Uint8Array(256),P=0;P<256;P++)I[P]=P>=252?6:P>=248?5:P>=240?4:P>=224?3:P>=192?2:1;I[254]=I[254]=1,w.exports.string2buf=function(w){if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(w);var v,I,P,u,Q,K=w.length,a=0;for(u=0;u<K;u++)55296===(64512&(I=w.charCodeAt(u)))&&u+1<K&&56320===(64512&(P=w.charCodeAt(u+1)))&&(I=65536+(I-55296<<10)+(P-56320),u++),a+=I<128?1:I<2048?2:I<65536?3:4;for(v=new Uint8Array(a),Q=0,u=0;Q<a;u++)55296===(64512&(I=w.charCodeAt(u)))&&u+1<K&&56320===(64512&(P=w.charCodeAt(u+1)))&&(I=65536+(I-55296<<10)+(P-56320),u++),I<128?v[Q++]=I:I<2048?(v[Q++]=192|I>>>6,v[Q++]=128|63&I):I<65536?(v[Q++]=224|I>>>12,v[Q++]=128|I>>>6&63,v[Q++]=128|63&I):(v[Q++]=240|I>>>18,v[Q++]=128|I>>>12&63,v[Q++]=128|I>>>6&63,v[Q++]=128|63&I);return v};w.exports.buf2string=function(w,P){var u,Q,K=P||w.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(w.subarray(0,P));var a=new Array(2*K);for(Q=0,u=0;u<K;){var U=w[u++];if(U<128)a[Q++]=U;else{var p=I[U];if(p>4)a[Q++]=65533,u+=p-1;else{for(U&=2===p?31:3===p?15:7;p>1&&u<K;)U=U<<6|63&w[u++],p--;p>1?a[Q++]=65533:U<65536?a[Q++]=U:(U-=65536,a[Q++]=55296|U>>10&1023,a[Q++]=56320|1023&U)}}}return function(w,I){if(I<65534&&w.subarray&&v)return String.fromCharCode.apply(null,w.length===I?w:w.subarray(0,I));for(var P="",u=0;u<I;u++)P+=String.fromCharCode(w[u]);return P}(a,Q)},w.exports.utf8border=function(w,v){(v=v||w.length)>w.length&&(v=w.length);for(var P=v-1;P>=0&&128===(192&w[P]);)P--;return P<0||0===P?v:P+I[w[P]]>v?P:v}},3040:function(w){"use strict";w.exports=function(w,v,I,P){for(var u=65535&w|0,Q=w>>>16&65535|0,K=0;0!==I;){I-=K=I>2e3?2e3:I;do{Q=Q+(u=u+v[P++]|0)|0}while(--K);u%=65521,Q%=65521}return u|Q<<16|0}},27572:function(w){"use strict";w.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},36558:function(w){"use strict";var v=new Uint32Array(function(){for(var w,v=[],I=0;I<256;I++){w=I;for(var P=0;P<8;P++)w=1&w?3988292384^w>>>1:w>>>1;v[I]=w}return v}());w.exports=function(w,I,P,u){var Q=v,K=u+P;w^=-1;for(var a=u;a<K;a++)w=w>>>8^Q[255&(w^I[a])];return-1^w}},38106:function(w,v,I){"use strict";var P=I(53226),u=P._tr_init,Q=P._tr_stored_block,K=P._tr_flush_block,a=P._tr_tally,U=P._tr_align,p=I(3040),r=I(36558),Y=I(74274),g=I(27572),J=g.Z_NO_FLUSH,l=g.Z_PARTIAL_FLUSH,R=g.Z_FULL_FLUSH,x=g.Z_FINISH,j=g.Z_BLOCK,s=g.Z_OK,B=g.Z_STREAM_END,t=g.Z_STREAM_ERROR,i=g.Z_DATA_ERROR,z=g.Z_BUF_ERROR,E=g.Z_DEFAULT_COMPRESSION,o=g.Z_FILTERED,h=g.Z_HUFFMAN_ONLY,n=g.Z_RLE,W=g.Z_FIXED,V=g.Z_DEFAULT_STRATEGY,F=g.Z_UNKNOWN,O=g.Z_DEFLATED,N=258,q=262,m=103,c=113,M=666,S=function(w,v){return w.msg=Y[v],v},e=function(w){return(w<<1)-(w>4?9:0)},H=function(w){for(var v=w.length;--v>=0;)w[v]=0},G=function(w,v,I){return(v<<w.hash_shift^I)&w.hash_mask},L=function(w){var v=w.state,I=v.pending;I>w.avail_out&&(I=w.avail_out),0!==I&&(w.output.set(v.pending_buf.subarray(v.pending_out,v.pending_out+I),w.next_out),w.next_out+=I,v.pending_out+=I,w.total_out+=I,w.avail_out-=I,v.pending-=I,0===v.pending&&(v.pending_out=0))},d=function(w,v){K(w,w.block_start>=0?w.block_start:-1,w.strstart-w.block_start,v),w.block_start=w.strstart,L(w.strm)},D=function(w,v){w.pending_buf[w.pending++]=v},f=function(w,v){w.pending_buf[w.pending++]=v>>>8&255,w.pending_buf[w.pending++]=255&v},b=function(w,v,I,P){var u=w.avail_in;return u>P&&(u=P),0===u?0:(w.avail_in-=u,v.set(w.input.subarray(w.next_in,w.next_in+u),I),1===w.state.wrap?w.adler=p(w.adler,v,u,I):2===w.state.wrap&&(w.adler=r(w.adler,v,u,I)),w.next_in+=u,w.total_in+=u,u)},k=function(w,v){var I,P,u=w.max_chain_length,Q=w.strstart,K=w.prev_length,a=w.nice_match,U=w.strstart>w.w_size-q?w.strstart-(w.w_size-q):0,p=w.window,r=w.w_mask,Y=w.prev,g=w.strstart+N,J=p[Q+K-1],l=p[Q+K];w.prev_length>=w.good_match&&(u>>=2),a>w.lookahead&&(a=w.lookahead);do{if(p[(I=v)+K]===l&&p[I+K-1]===J&&p[I]===p[Q]&&p[++I]===p[Q+1]){Q+=2,I++;do{}while(p[++Q]===p[++I]&&p[++Q]===p[++I]&&p[++Q]===p[++I]&&p[++Q]===p[++I]&&p[++Q]===p[++I]&&p[++Q]===p[++I]&&p[++Q]===p[++I]&&p[++Q]===p[++I]&&Q<g);if(P=N-(g-Q),Q=g-N,P>K){if(w.match_start=v,K=P,P>=a)break;J=p[Q+K-1],l=p[Q+K]}}}while((v=Y[v&r])>U&&0!==--u);return K<=w.lookahead?K:w.lookahead},C=function(w){var v,I,P,u,Q,K=w.w_size;do{if(u=w.window_size-w.lookahead-w.strstart,w.strstart>=K+(K-q)){w.window.set(w.window.subarray(K,K+K),0),w.match_start-=K,w.strstart-=K,w.block_start-=K,v=I=w.hash_size;do{P=w.head[--v],w.head[v]=P>=K?P-K:0}while(--I);v=I=K;do{P=w.prev[--v],w.prev[v]=P>=K?P-K:0}while(--I);u+=K}if(0===w.strm.avail_in)break;if(I=b(w.strm,w.window,w.strstart+w.lookahead,u),w.lookahead+=I,w.lookahead+w.insert>=3)for(Q=w.strstart-w.insert,w.ins_h=w.window[Q],w.ins_h=G(w,w.ins_h,w.window[Q+1]);w.insert&&(w.ins_h=G(w,w.ins_h,w.window[Q+3-1]),w.prev[Q&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=Q,Q++,w.insert--,!(w.lookahead+w.insert<3)););}while(w.lookahead<q&&0!==w.strm.avail_in)},y=function(w,v){for(var I,P;;){if(w.lookahead<q){if(C(w),w.lookahead<q&&v===J)return 1;if(0===w.lookahead)break}if(I=0,w.lookahead>=3&&(w.ins_h=G(w,w.ins_h,w.window[w.strstart+3-1]),I=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),0!==I&&w.strstart-I<=w.w_size-q&&(w.match_length=k(w,I)),w.match_length>=3)if(P=a(w,w.strstart-w.match_start,w.match_length-3),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=3){w.match_length--;do{w.strstart++,w.ins_h=G(w,w.ins_h,w.window[w.strstart+3-1]),I=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart}while(0!==--w.match_length);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=G(w,w.ins_h,w.window[w.strstart+1]);else P=a(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(P&&(d(w,!1),0===w.strm.avail_out))return 1}return w.insert=w.strstart<2?w.strstart:2,v===x?(d(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(d(w,!1),0===w.strm.avail_out)?1:2},T=function(w,v){for(var I,P,u;;){if(w.lookahead<q){if(C(w),w.lookahead<q&&v===J)return 1;if(0===w.lookahead)break}if(I=0,w.lookahead>=3&&(w.ins_h=G(w,w.ins_h,w.window[w.strstart+3-1]),I=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=2,0!==I&&w.prev_length<w.max_lazy_match&&w.strstart-I<=w.w_size-q&&(w.match_length=k(w,I),w.match_length<=5&&(w.strategy===o||3===w.match_length&&w.strstart-w.match_start>4096)&&(w.match_length=2)),w.prev_length>=3&&w.match_length<=w.prev_length){u=w.strstart+w.lookahead-3,P=a(w,w.strstart-1-w.prev_match,w.prev_length-3),w.lookahead-=w.prev_length-1,w.prev_length-=2;do{++w.strstart<=u&&(w.ins_h=G(w,w.ins_h,w.window[w.strstart+3-1]),I=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart)}while(0!==--w.prev_length);if(w.match_available=0,w.match_length=2,w.strstart++,P&&(d(w,!1),0===w.strm.avail_out))return 1}else if(w.match_available){if((P=a(w,0,w.window[w.strstart-1]))&&d(w,!1),w.strstart++,w.lookahead--,0===w.strm.avail_out)return 1}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(P=a(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<2?w.strstart:2,v===x?(d(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(d(w,!1),0===w.strm.avail_out)?1:2};function Z(w,v,I,P,u){this.good_length=w,this.max_lazy=v,this.nice_length=I,this.max_chain=P,this.func=u}var A=[new Z(0,0,0,0,(function(w,v){var I=65535;for(I>w.pending_buf_size-5&&(I=w.pending_buf_size-5);;){if(w.lookahead<=1){if(C(w),0===w.lookahead&&v===J)return 1;if(0===w.lookahead)break}w.strstart+=w.lookahead,w.lookahead=0;var P=w.block_start+I;if((0===w.strstart||w.strstart>=P)&&(w.lookahead=w.strstart-P,w.strstart=P,d(w,!1),0===w.strm.avail_out))return 1;if(w.strstart-w.block_start>=w.w_size-q&&(d(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,v===x?(d(w,!0),0===w.strm.avail_out?3:4):(w.strstart>w.block_start&&(d(w,!1),w.strm.avail_out),1)})),new Z(4,4,8,4,y),new Z(4,5,16,8,y),new Z(4,6,32,32,y),new Z(4,4,16,16,T),new Z(8,16,32,32,T),new Z(8,16,128,128,T),new Z(8,32,128,256,T),new Z(32,128,258,1024,T),new Z(32,258,258,4096,T)];function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=O,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),H(this.dyn_ltree),H(this.dyn_dtree),H(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),H(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),H(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var ww=function(w){if(!w||!w.state)return S(w,t);w.total_in=w.total_out=0,w.data_type=F;var v=w.state;return v.pending=0,v.pending_out=0,v.wrap<0&&(v.wrap=-v.wrap),v.status=v.wrap?42:c,w.adler=2===v.wrap?0:1,v.last_flush=J,u(v),s},vw=function(w){var v,I=ww(w);return I===s&&((v=w.state).window_size=2*v.w_size,H(v.head),v.max_lazy_match=A[v.level].max_lazy,v.good_match=A[v.level].good_length,v.nice_match=A[v.level].nice_length,v.max_chain_length=A[v.level].max_chain,v.strstart=0,v.block_start=0,v.lookahead=0,v.insert=0,v.match_length=v.prev_length=2,v.match_available=0,v.ins_h=0),I},Iw=function(w,v,I,P,u,Q){if(!w)return t;var K=1;if(v===E&&(v=6),P<0?(K=0,P=-P):P>15&&(K=2,P-=16),u<1||u>9||I!==O||P<8||P>15||v<0||v>9||Q<0||Q>W)return S(w,t);8===P&&(P=9);var a=new X;return w.state=a,a.strm=w,a.wrap=K,a.gzhead=null,a.w_bits=P,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=u+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<u+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=v,a.strategy=Q,a.method=I,vw(w)};w.exports.deflateInit=function(w,v){return Iw(w,v,O,15,8,V)},w.exports.deflateInit2=Iw,w.exports.deflateReset=vw,w.exports.deflateResetKeep=ww,w.exports.deflateSetHeader=function(w,v){return w&&w.state?2!==w.state.wrap?t:(w.state.gzhead=v,s):t},w.exports.deflate=function(w,v){var I,P;if(!w||!w.state||v>j||v<0)return w?S(w,t):t;var u=w.state;if(!w.output||!w.input&&0!==w.avail_in||u.status===M&&v!==x)return S(w,0===w.avail_out?z:t);u.strm=w;var K=u.last_flush;if(u.last_flush=v,42===u.status)if(2===u.wrap)w.adler=0,D(u,31),D(u,139),D(u,8),u.gzhead?(D(u,(u.gzhead.text?1:0)+(u.gzhead.hcrc?2:0)+(u.gzhead.extra?4:0)+(u.gzhead.name?8:0)+(u.gzhead.comment?16:0)),D(u,255&u.gzhead.time),D(u,u.gzhead.time>>8&255),D(u,u.gzhead.time>>16&255),D(u,u.gzhead.time>>24&255),D(u,9===u.level?2:u.strategy>=h||u.level<2?4:0),D(u,255&u.gzhead.os),u.gzhead.extra&&u.gzhead.extra.length&&(D(u,255&u.gzhead.extra.length),D(u,u.gzhead.extra.length>>8&255)),u.gzhead.hcrc&&(w.adler=r(w.adler,u.pending_buf,u.pending,0)),u.gzindex=0,u.status=69):(D(u,0),D(u,0),D(u,0),D(u,0),D(u,0),D(u,9===u.level?2:u.strategy>=h||u.level<2?4:0),D(u,3),u.status=c);else{var p=O+(u.w_bits-8<<4)<<8;p|=(u.strategy>=h||u.level<2?0:u.level<6?1:6===u.level?2:3)<<6,0!==u.strstart&&(p|=32),p+=31-p%31,u.status=c,f(u,p),0!==u.strstart&&(f(u,w.adler>>>16),f(u,65535&w.adler)),w.adler=1}if(69===u.status)if(u.gzhead.extra){for(I=u.pending;u.gzindex<(65535&u.gzhead.extra.length)&&(u.pending!==u.pending_buf_size||(u.gzhead.hcrc&&u.pending>I&&(w.adler=r(w.adler,u.pending_buf,u.pending-I,I)),L(w),I=u.pending,u.pending!==u.pending_buf_size));)D(u,255&u.gzhead.extra[u.gzindex]),u.gzindex++;u.gzhead.hcrc&&u.pending>I&&(w.adler=r(w.adler,u.pending_buf,u.pending-I,I)),u.gzindex===u.gzhead.extra.length&&(u.gzindex=0,u.status=73)}else u.status=73;if(73===u.status)if(u.gzhead.name){I=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>I&&(w.adler=r(w.adler,u.pending_buf,u.pending-I,I)),L(w),I=u.pending,u.pending===u.pending_buf_size)){P=1;break}P=u.gzindex<u.gzhead.name.length?255&u.gzhead.name.charCodeAt(u.gzindex++):0,D(u,P)}while(0!==P);u.gzhead.hcrc&&u.pending>I&&(w.adler=r(w.adler,u.pending_buf,u.pending-I,I)),0===P&&(u.gzindex=0,u.status=91)}else u.status=91;if(91===u.status)if(u.gzhead.comment){I=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>I&&(w.adler=r(w.adler,u.pending_buf,u.pending-I,I)),L(w),I=u.pending,u.pending===u.pending_buf_size)){P=1;break}P=u.gzindex<u.gzhead.comment.length?255&u.gzhead.comment.charCodeAt(u.gzindex++):0,D(u,P)}while(0!==P);u.gzhead.hcrc&&u.pending>I&&(w.adler=r(w.adler,u.pending_buf,u.pending-I,I)),0===P&&(u.status=m)}else u.status=m;if(u.status===m&&(u.gzhead.hcrc?(u.pending+2>u.pending_buf_size&&L(w),u.pending+2<=u.pending_buf_size&&(D(u,255&w.adler),D(u,w.adler>>8&255),w.adler=0,u.status=c)):u.status=c),0!==u.pending){if(L(w),0===w.avail_out)return u.last_flush=-1,s}else if(0===w.avail_in&&e(v)<=e(K)&&v!==x)return S(w,z);if(u.status===M&&0!==w.avail_in)return S(w,z);if(0!==w.avail_in||0!==u.lookahead||v!==J&&u.status!==M){var Y=u.strategy===h?function(w,v){for(var I;;){if(0===w.lookahead&&(C(w),0===w.lookahead)){if(v===J)return 1;break}if(w.match_length=0,I=a(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++,I&&(d(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,v===x?(d(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(d(w,!1),0===w.strm.avail_out)?1:2}(u,v):u.strategy===n?function(w,v){for(var I,P,u,Q,K=w.window;;){if(w.lookahead<=N){if(C(w),w.lookahead<=N&&v===J)return 1;if(0===w.lookahead)break}if(w.match_length=0,w.lookahead>=3&&w.strstart>0&&(P=K[u=w.strstart-1])===K[++u]&&P===K[++u]&&P===K[++u]){Q=w.strstart+N;do{}while(P===K[++u]&&P===K[++u]&&P===K[++u]&&P===K[++u]&&P===K[++u]&&P===K[++u]&&P===K[++u]&&P===K[++u]&&u<Q);w.match_length=N-(Q-u),w.match_length>w.lookahead&&(w.match_length=w.lookahead)}if(w.match_length>=3?(I=a(w,1,w.match_length-3),w.lookahead-=w.match_length,w.strstart+=w.match_length,w.match_length=0):(I=a(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++),I&&(d(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,v===x?(d(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(d(w,!1),0===w.strm.avail_out)?1:2}(u,v):A[u.level].func(u,v);if(3!==Y&&4!==Y||(u.status=M),1===Y||3===Y)return 0===w.avail_out&&(u.last_flush=-1),s;if(2===Y&&(v===l?U(u):v!==j&&(Q(u,0,0,!1),v===R&&(H(u.head),0===u.lookahead&&(u.strstart=0,u.block_start=0,u.insert=0))),L(w),0===w.avail_out))return u.last_flush=-1,s}return v!==x?s:u.wrap<=0?B:(2===u.wrap?(D(u,255&w.adler),D(u,w.adler>>8&255),D(u,w.adler>>16&255),D(u,w.adler>>24&255),D(u,255&w.total_in),D(u,w.total_in>>8&255),D(u,w.total_in>>16&255),D(u,w.total_in>>24&255)):(f(u,w.adler>>>16),f(u,65535&w.adler)),L(w),u.wrap>0&&(u.wrap=-u.wrap),0!==u.pending?s:B)},w.exports.deflateEnd=function(w){if(!w||!w.state)return t;var v=w.state.status;return 42!==v&&69!==v&&73!==v&&91!==v&&v!==m&&v!==c&&v!==M?S(w,t):(w.state=null,v===c?S(w,i):s)},w.exports.deflateSetDictionary=function(w,v){var I=v.length;if(!w||!w.state)return t;var P=w.state,u=P.wrap;if(2===u||1===u&&42!==P.status||P.lookahead)return t;if(1===u&&(w.adler=p(w.adler,v,I,0)),P.wrap=0,I>=P.w_size){0===u&&(H(P.head),P.strstart=0,P.block_start=0,P.insert=0);var Q=new Uint8Array(P.w_size);Q.set(v.subarray(I-P.w_size,I),0),v=Q,I=P.w_size}var K=w.avail_in,a=w.next_in,U=w.input;for(w.avail_in=I,w.next_in=0,w.input=v,C(P);P.lookahead>=3;){var r=P.strstart,Y=P.lookahead-2;do{P.ins_h=G(P,P.ins_h,P.window[r+3-1]),P.prev[r&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=r,r++}while(--Y);P.strstart=r,P.lookahead=2,C(P)}return P.strstart+=P.lookahead,P.block_start=P.strstart,P.insert=P.lookahead,P.lookahead=0,P.match_length=P.prev_length=2,P.match_available=0,w.next_in=a,w.input=U,w.avail_in=K,P.wrap=u,s},w.exports.deflateInfo="pako deflate (from Nodeca project)"},84284:function(w){"use strict";w.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},36997:function(w){"use strict";w.exports=function(w,v){var I,P,u,Q,K,a,U,p,r,Y,g,J,l,R,x,j,s,B,t,i,z,E,o,h,n=w.state;I=w.next_in,o=w.input,P=I+(w.avail_in-5),u=w.next_out,h=w.output,Q=u-(v-w.avail_out),K=u+(w.avail_out-257),a=n.dmax,U=n.wsize,p=n.whave,r=n.wnext,Y=n.window,g=n.hold,J=n.bits,l=n.lencode,R=n.distcode,x=(1<<n.lenbits)-1,j=(1<<n.distbits)-1;w:do{J<15&&(g+=o[I++]<<J,J+=8,g+=o[I++]<<J,J+=8),s=l[g&x];v:for(;;){if(g>>>=B=s>>>24,J-=B,0===(B=s>>>16&255))h[u++]=65535&s;else{if(!(16&B)){if(0===(64&B)){s=l[(65535&s)+(g&(1<<B)-1)];continue v}if(32&B){n.mode=12;break w}w.msg="invalid literal/length code",n.mode=30;break w}t=65535&s,(B&=15)&&(J<B&&(g+=o[I++]<<J,J+=8),t+=g&(1<<B)-1,g>>>=B,J-=B),J<15&&(g+=o[I++]<<J,J+=8,g+=o[I++]<<J,J+=8),s=R[g&j];I:for(;;){if(g>>>=B=s>>>24,J-=B,!(16&(B=s>>>16&255))){if(0===(64&B)){s=R[(65535&s)+(g&(1<<B)-1)];continue I}w.msg="invalid distance code",n.mode=30;break w}if(i=65535&s,J<(B&=15)&&(g+=o[I++]<<J,(J+=8)<B&&(g+=o[I++]<<J,J+=8)),(i+=g&(1<<B)-1)>a){w.msg="invalid distance too far back",n.mode=30;break w}if(g>>>=B,J-=B,i>(B=u-Q)){if((B=i-B)>p&&n.sane){w.msg="invalid distance too far back",n.mode=30;break w}if(z=0,E=Y,0===r){if(z+=U-B,B<t){t-=B;do{h[u++]=Y[z++]}while(--B);z=u-i,E=h}}else if(r<B){if(z+=U+r-B,(B-=r)<t){t-=B;do{h[u++]=Y[z++]}while(--B);if(z=0,r<t){t-=B=r;do{h[u++]=Y[z++]}while(--B);z=u-i,E=h}}}else if(z+=r-B,B<t){t-=B;do{h[u++]=Y[z++]}while(--B);z=u-i,E=h}for(;t>2;)h[u++]=E[z++],h[u++]=E[z++],h[u++]=E[z++],t-=3;t&&(h[u++]=E[z++],t>1&&(h[u++]=E[z++]))}else{z=u-i;do{h[u++]=h[z++],h[u++]=h[z++],h[u++]=h[z++],t-=3}while(t>2);t&&(h[u++]=h[z++],t>1&&(h[u++]=h[z++]))}break}}break}}while(I<P&&u<K);I-=t=J>>3,g&=(1<<(J-=t<<3))-1,w.next_in=I,w.next_out=u,w.avail_in=I<P?P-I+5:5-(I-P),w.avail_out=u<K?K-u+257:257-(u-K),n.hold=g,n.bits=J}},31833:function(w,v,I){"use strict";var P=I(3040),u=I(36558),Q=I(36997),K=I(33443),a=I(27572),U=a.Z_FINISH,p=a.Z_BLOCK,r=a.Z_TREES,Y=a.Z_OK,g=a.Z_STREAM_END,J=a.Z_NEED_DICT,l=a.Z_STREAM_ERROR,R=a.Z_DATA_ERROR,x=a.Z_MEM_ERROR,j=a.Z_BUF_ERROR,s=a.Z_DEFLATED,B=12,t=30,i=function(w){return(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24)};function z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var E,o,h=function(w){if(!w||!w.state)return l;var v=w.state;return w.total_in=w.total_out=v.total=0,w.msg="",v.wrap&&(w.adler=1&v.wrap),v.mode=1,v.last=0,v.havedict=0,v.dmax=32768,v.head=null,v.hold=0,v.bits=0,v.lencode=v.lendyn=new Int32Array(852),v.distcode=v.distdyn=new Int32Array(592),v.sane=1,v.back=-1,Y},n=function(w){if(!w||!w.state)return l;var v=w.state;return v.wsize=0,v.whave=0,v.wnext=0,h(w)},W=function(w,v){var I;if(!w||!w.state)return l;var P=w.state;return v<0?(I=0,v=-v):(I=1+(v>>4),v<48&&(v&=15)),v&&(v<8||v>15)?l:(null!==P.window&&P.wbits!==v&&(P.window=null),P.wrap=I,P.wbits=v,n(w))},V=function(w,v){if(!w)return l;var I=new z;w.state=I,I.window=null;var P=W(w,v);return P!==Y&&(w.state=null),P},F=!0,O=function(w){if(F){E=new Int32Array(512),o=new Int32Array(32);for(var v=0;v<144;)w.lens[v++]=8;for(;v<256;)w.lens[v++]=9;for(;v<280;)w.lens[v++]=7;for(;v<288;)w.lens[v++]=8;for(K(1,w.lens,0,288,E,0,w.work,{bits:9}),v=0;v<32;)w.lens[v++]=5;K(2,w.lens,0,32,o,0,w.work,{bits:5}),F=!1}w.lencode=E,w.lenbits=9,w.distcode=o,w.distbits=5},N=function(w,v,I,P){var u,Q=w.state;return null===Q.window&&(Q.wsize=1<<Q.wbits,Q.wnext=0,Q.whave=0,Q.window=new Uint8Array(Q.wsize)),P>=Q.wsize?(Q.window.set(v.subarray(I-Q.wsize,I),0),Q.wnext=0,Q.whave=Q.wsize):((u=Q.wsize-Q.wnext)>P&&(u=P),Q.window.set(v.subarray(I-P,I-P+u),Q.wnext),(P-=u)?(Q.window.set(v.subarray(I-P,I),0),Q.wnext=P,Q.whave=Q.wsize):(Q.wnext+=u,Q.wnext===Q.wsize&&(Q.wnext=0),Q.whave<Q.wsize&&(Q.whave+=u))),0};w.exports.inflateReset=n,w.exports.inflateReset2=W,w.exports.inflateResetKeep=h,w.exports.inflateInit=function(w){return V(w,15)},w.exports.inflateInit2=V,w.exports.inflate=function(w,v){var I,a,z,E,o,h,n,W,V,F,q,m,c,M,S,e,H,G,L,d,D,f,b,k,C=0,y=new Uint8Array(4),T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!w||!w.state||!w.output||!w.input&&0!==w.avail_in)return l;(I=w.state).mode===B&&(I.mode=13),o=w.next_out,z=w.output,n=w.avail_out,E=w.next_in,a=w.input,h=w.avail_in,W=I.hold,V=I.bits,F=h,q=n,f=Y;w:for(;;)switch(I.mode){case 1:if(0===I.wrap){I.mode=13;break}for(;V<16;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(2&I.wrap&&35615===W){I.check=0,y[0]=255&W,y[1]=W>>>8&255,I.check=u(I.check,y,2,0),W=0,V=0,I.mode=2;break}if(I.flags=0,I.head&&(I.head.done=!1),!(1&I.wrap)||(((255&W)<<8)+(W>>8))%31){w.msg="incorrect header check",I.mode=t;break}if((15&W)!==s){w.msg="unknown compression method",I.mode=t;break}if(V-=4,D=8+(15&(W>>>=4)),0===I.wbits)I.wbits=D;else if(D>I.wbits){w.msg="invalid window size",I.mode=t;break}I.dmax=1<<I.wbits,w.adler=I.check=1,I.mode=512&W?10:B,W=0,V=0;break;case 2:for(;V<16;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(I.flags=W,(255&I.flags)!==s){w.msg="unknown compression method",I.mode=t;break}if(57344&I.flags){w.msg="unknown header flags set",I.mode=t;break}I.head&&(I.head.text=W>>8&1),512&I.flags&&(y[0]=255&W,y[1]=W>>>8&255,I.check=u(I.check,y,2,0)),W=0,V=0,I.mode=3;case 3:for(;V<32;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}I.head&&(I.head.time=W),512&I.flags&&(y[0]=255&W,y[1]=W>>>8&255,y[2]=W>>>16&255,y[3]=W>>>24&255,I.check=u(I.check,y,4,0)),W=0,V=0,I.mode=4;case 4:for(;V<16;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}I.head&&(I.head.xflags=255&W,I.head.os=W>>8),512&I.flags&&(y[0]=255&W,y[1]=W>>>8&255,I.check=u(I.check,y,2,0)),W=0,V=0,I.mode=5;case 5:if(1024&I.flags){for(;V<16;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}I.length=W,I.head&&(I.head.extra_len=W),512&I.flags&&(y[0]=255&W,y[1]=W>>>8&255,I.check=u(I.check,y,2,0)),W=0,V=0}else I.head&&(I.head.extra=null);I.mode=6;case 6:if(1024&I.flags&&((m=I.length)>h&&(m=h),m&&(I.head&&(D=I.head.extra_len-I.length,I.head.extra||(I.head.extra=new Uint8Array(I.head.extra_len)),I.head.extra.set(a.subarray(E,E+m),D)),512&I.flags&&(I.check=u(I.check,a,m,E)),h-=m,E+=m,I.length-=m),I.length))break w;I.length=0,I.mode=7;case 7:if(2048&I.flags){if(0===h)break w;m=0;do{D=a[E+m++],I.head&&D&&I.length<65536&&(I.head.name+=String.fromCharCode(D))}while(D&&m<h);if(512&I.flags&&(I.check=u(I.check,a,m,E)),h-=m,E+=m,D)break w}else I.head&&(I.head.name=null);I.length=0,I.mode=8;case 8:if(4096&I.flags){if(0===h)break w;m=0;do{D=a[E+m++],I.head&&D&&I.length<65536&&(I.head.comment+=String.fromCharCode(D))}while(D&&m<h);if(512&I.flags&&(I.check=u(I.check,a,m,E)),h-=m,E+=m,D)break w}else I.head&&(I.head.comment=null);I.mode=9;case 9:if(512&I.flags){for(;V<16;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(W!==(65535&I.check)){w.msg="header crc mismatch",I.mode=t;break}W=0,V=0}I.head&&(I.head.hcrc=I.flags>>9&1,I.head.done=!0),w.adler=I.check=0,I.mode=B;break;case 10:for(;V<32;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}w.adler=I.check=i(W),W=0,V=0,I.mode=11;case 11:if(0===I.havedict)return w.next_out=o,w.avail_out=n,w.next_in=E,w.avail_in=h,I.hold=W,I.bits=V,J;w.adler=I.check=1,I.mode=B;case B:if(v===p||v===r)break w;case 13:if(I.last){W>>>=7&V,V-=7&V,I.mode=27;break}for(;V<3;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}switch(I.last=1&W,V-=1,3&(W>>>=1)){case 0:I.mode=14;break;case 1:if(O(I),I.mode=20,v===r){W>>>=2,V-=2;break w}break;case 2:I.mode=17;break;case 3:w.msg="invalid block type",I.mode=t}W>>>=2,V-=2;break;case 14:for(W>>>=7&V,V-=7&V;V<32;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if((65535&W)!==(W>>>16^65535)){w.msg="invalid stored block lengths",I.mode=t;break}if(I.length=65535&W,W=0,V=0,I.mode=15,v===r)break w;case 15:I.mode=16;case 16:if(m=I.length){if(m>h&&(m=h),m>n&&(m=n),0===m)break w;z.set(a.subarray(E,E+m),o),h-=m,E+=m,n-=m,o+=m,I.length-=m;break}I.mode=B;break;case 17:for(;V<14;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(I.nlen=257+(31&W),W>>>=5,V-=5,I.ndist=1+(31&W),W>>>=5,V-=5,I.ncode=4+(15&W),W>>>=4,V-=4,I.nlen>286||I.ndist>30){w.msg="too many length or distance symbols",I.mode=t;break}I.have=0,I.mode=18;case 18:for(;I.have<I.ncode;){for(;V<3;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}I.lens[T[I.have++]]=7&W,W>>>=3,V-=3}for(;I.have<19;)I.lens[T[I.have++]]=0;if(I.lencode=I.lendyn,I.lenbits=7,b={bits:I.lenbits},f=K(0,I.lens,0,19,I.lencode,0,I.work,b),I.lenbits=b.bits,f){w.msg="invalid code lengths set",I.mode=t;break}I.have=0,I.mode=19;case 19:for(;I.have<I.nlen+I.ndist;){for(;e=(C=I.lencode[W&(1<<I.lenbits)-1])>>>16&255,H=65535&C,!((S=C>>>24)<=V);){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(H<16)W>>>=S,V-=S,I.lens[I.have++]=H;else{if(16===H){for(k=S+2;V<k;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(W>>>=S,V-=S,0===I.have){w.msg="invalid bit length repeat",I.mode=t;break}D=I.lens[I.have-1],m=3+(3&W),W>>>=2,V-=2}else if(17===H){for(k=S+3;V<k;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}V-=S,D=0,m=3+(7&(W>>>=S)),W>>>=3,V-=3}else{for(k=S+7;V<k;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}V-=S,D=0,m=11+(127&(W>>>=S)),W>>>=7,V-=7}if(I.have+m>I.nlen+I.ndist){w.msg="invalid bit length repeat",I.mode=t;break}for(;m--;)I.lens[I.have++]=D}}if(I.mode===t)break;if(0===I.lens[256]){w.msg="invalid code -- missing end-of-block",I.mode=t;break}if(I.lenbits=9,b={bits:I.lenbits},f=K(1,I.lens,0,I.nlen,I.lencode,0,I.work,b),I.lenbits=b.bits,f){w.msg="invalid literal/lengths set",I.mode=t;break}if(I.distbits=6,I.distcode=I.distdyn,b={bits:I.distbits},f=K(2,I.lens,I.nlen,I.ndist,I.distcode,0,I.work,b),I.distbits=b.bits,f){w.msg="invalid distances set",I.mode=t;break}if(I.mode=20,v===r)break w;case 20:I.mode=21;case 21:if(h>=6&&n>=258){w.next_out=o,w.avail_out=n,w.next_in=E,w.avail_in=h,I.hold=W,I.bits=V,Q(w,q),o=w.next_out,z=w.output,n=w.avail_out,E=w.next_in,a=w.input,h=w.avail_in,W=I.hold,V=I.bits,I.mode===B&&(I.back=-1);break}for(I.back=0;e=(C=I.lencode[W&(1<<I.lenbits)-1])>>>16&255,H=65535&C,!((S=C>>>24)<=V);){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(e&&0===(240&e)){for(G=S,L=e,d=H;e=(C=I.lencode[d+((W&(1<<G+L)-1)>>G)])>>>16&255,H=65535&C,!(G+(S=C>>>24)<=V);){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}W>>>=G,V-=G,I.back+=G}if(W>>>=S,V-=S,I.back+=S,I.length=H,0===e){I.mode=26;break}if(32&e){I.back=-1,I.mode=B;break}if(64&e){w.msg="invalid literal/length code",I.mode=t;break}I.extra=15&e,I.mode=22;case 22:if(I.extra){for(k=I.extra;V<k;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}I.length+=W&(1<<I.extra)-1,W>>>=I.extra,V-=I.extra,I.back+=I.extra}I.was=I.length,I.mode=23;case 23:for(;e=(C=I.distcode[W&(1<<I.distbits)-1])>>>16&255,H=65535&C,!((S=C>>>24)<=V);){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(0===(240&e)){for(G=S,L=e,d=H;e=(C=I.distcode[d+((W&(1<<G+L)-1)>>G)])>>>16&255,H=65535&C,!(G+(S=C>>>24)<=V);){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}W>>>=G,V-=G,I.back+=G}if(W>>>=S,V-=S,I.back+=S,64&e){w.msg="invalid distance code",I.mode=t;break}I.offset=H,I.extra=15&e,I.mode=24;case 24:if(I.extra){for(k=I.extra;V<k;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}I.offset+=W&(1<<I.extra)-1,W>>>=I.extra,V-=I.extra,I.back+=I.extra}if(I.offset>I.dmax){w.msg="invalid distance too far back",I.mode=t;break}I.mode=25;case 25:if(0===n)break w;if(m=q-n,I.offset>m){if((m=I.offset-m)>I.whave&&I.sane){w.msg="invalid distance too far back",I.mode=t;break}m>I.wnext?(m-=I.wnext,c=I.wsize-m):c=I.wnext-m,m>I.length&&(m=I.length),M=I.window}else M=z,c=o-I.offset,m=I.length;m>n&&(m=n),n-=m,I.length-=m;do{z[o++]=M[c++]}while(--m);0===I.length&&(I.mode=21);break;case 26:if(0===n)break w;z[o++]=I.length,n--,I.mode=21;break;case 27:if(I.wrap){for(;V<32;){if(0===h)break w;h--,W|=a[E++]<<V,V+=8}if(q-=n,w.total_out+=q,I.total+=q,q&&(w.adler=I.check=I.flags?u(I.check,z,q,o-q):P(I.check,z,q,o-q)),q=n,(I.flags?W:i(W))!==I.check){w.msg="incorrect data check",I.mode=t;break}W=0,V=0}I.mode=28;case 28:if(I.wrap&&I.flags){for(;V<32;){if(0===h)break w;h--,W+=a[E++]<<V,V+=8}if(W!==(4294967295&I.total)){w.msg="incorrect length check",I.mode=t;break}W=0,V=0}I.mode=29;case 29:f=g;break w;case t:f=R;break w;case 31:return x;default:return l}return w.next_out=o,w.avail_out=n,w.next_in=E,w.avail_in=h,I.hold=W,I.bits=V,(I.wsize||q!==w.avail_out&&I.mode<t&&(I.mode<27||v!==U))&&N(w,w.output,w.next_out,q-w.avail_out)?(I.mode=31,x):(F-=w.avail_in,q-=w.avail_out,w.total_in+=F,w.total_out+=q,I.total+=q,I.wrap&&q&&(w.adler=I.check=I.flags?u(I.check,z,q,w.next_out-q):P(I.check,z,q,w.next_out-q)),w.data_type=I.bits+(I.last?64:0)+(I.mode===B?128:0)+(20===I.mode||15===I.mode?256:0),(0===F&&0===q||v===U)&&f===Y&&(f=j),f)},w.exports.inflateEnd=function(w){if(!w||!w.state)return l;var v=w.state;return v.window&&(v.window=null),w.state=null,Y},w.exports.inflateGetHeader=function(w,v){if(!w||!w.state)return l;var I=w.state;return 0===(2&I.wrap)?l:(I.head=v,v.done=!1,Y)},w.exports.inflateSetDictionary=function(w,v){var I,u=v.length;return w&&w.state?0!==(I=w.state).wrap&&11!==I.mode?l:11===I.mode&&P(1,v,u,0)!==I.check?R:N(w,v,u,u)?(I.mode=31,x):(I.havedict=1,Y):l},w.exports.inflateInfo="pako inflate (from Nodeca project)"},33443:function(w){"use strict";var v=15,I=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),P=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),u=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Q=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);w.exports=function(w,K,a,U,p,r,Y,g){var J,l,R,x,j,s,B,t,i,z=g.bits,E=0,o=0,h=0,n=0,W=0,V=0,F=0,O=0,N=0,q=0,m=null,c=0,M=new Uint16Array(16),S=new Uint16Array(16),e=null,H=0;for(E=0;E<=v;E++)M[E]=0;for(o=0;o<U;o++)M[K[a+o]]++;for(W=z,n=v;n>=1&&0===M[n];n--);if(W>n&&(W=n),0===n)return p[r++]=20971520,p[r++]=20971520,g.bits=1,0;for(h=1;h<n&&0===M[h];h++);for(W<h&&(W=h),O=1,E=1;E<=v;E++)if(O<<=1,(O-=M[E])<0)return-1;if(O>0&&(0===w||1!==n))return-1;for(S[1]=0,E=1;E<v;E++)S[E+1]=S[E]+M[E];for(o=0;o<U;o++)0!==K[a+o]&&(Y[S[K[a+o]]++]=o);if(0===w?(m=e=Y,s=19):1===w?(m=I,c-=257,e=P,H-=257,s=256):(m=u,e=Q,s=-1),q=0,o=0,E=h,j=r,V=W,F=0,R=-1,x=(N=1<<W)-1,1===w&&N>852||2===w&&N>592)return 1;for(;;){B=E-F,Y[o]<s?(t=0,i=Y[o]):Y[o]>s?(t=e[H+Y[o]],i=m[c+Y[o]]):(t=96,i=0),J=1<<E-F,h=l=1<<V;do{p[j+(q>>F)+(l-=J)]=B<<24|t<<16|i|0}while(0!==l);for(J=1<<E-1;q&J;)J>>=1;if(0!==J?(q&=J-1,q+=J):q=0,o++,0===--M[E]){if(E===n)break;E=K[a+Y[o]]}if(E>W&&(q&x)!==R){for(0===F&&(F=W),j+=h,O=1<<(V=E-F);V+F<n&&!((O-=M[V+F])<=0);)V++,O<<=1;if(N+=1<<V,1===w&&N>852||2===w&&N>592)return 1;p[R=q&x]=W<<24|V<<16|j-r|0}}return 0!==q&&(p[j+q]=E-F<<24|64<<16|0),g.bits=W,0}},74274:function(w){"use strict";w.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},53226:function(w){"use strict";function v(w){for(var v=w.length;--v>=0;)w[v]=0}var I=256,P=286,u=30,Q=15,K=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new Array(576);v(r);var Y=new Array(60);v(Y);var g=new Array(512);v(g);var J=new Array(256);v(J);var l=new Array(29);v(l);var R,x,j,s=new Array(u);function B(w,v,I,P,u){this.static_tree=w,this.extra_bits=v,this.extra_base=I,this.elems=P,this.max_length=u,this.has_stree=w&&w.length}function t(w,v){this.dyn_tree=w,this.max_code=0,this.stat_desc=v}v(s);var i=function(w){return w<256?g[w]:g[256+(w>>>7)]},z=function(w,v){w.pending_buf[w.pending++]=255&v,w.pending_buf[w.pending++]=v>>>8&255},E=function(w,v,I){w.bi_valid>16-I?(w.bi_buf|=v<<w.bi_valid&65535,z(w,w.bi_buf),w.bi_buf=v>>16-w.bi_valid,w.bi_valid+=I-16):(w.bi_buf|=v<<w.bi_valid&65535,w.bi_valid+=I)},o=function(w,v,I){E(w,I[2*v],I[2*v+1])},h=function(w,v){var I=0;do{I|=1&w,w>>>=1,I<<=1}while(--v>0);return I>>>1},n=function(w,v,I){var P,u,K=new Array(16),a=0;for(P=1;P<=Q;P++)K[P]=a=a+I[P-1]<<1;for(u=0;u<=v;u++){var U=w[2*u+1];0!==U&&(w[2*u]=h(K[U]++,U))}},W=function(w){var v;for(v=0;v<P;v++)w.dyn_ltree[2*v]=0;for(v=0;v<u;v++)w.dyn_dtree[2*v]=0;for(v=0;v<19;v++)w.bl_tree[2*v]=0;w.dyn_ltree[512]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0},V=function(w){w.bi_valid>8?z(w,w.bi_buf):w.bi_valid>0&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0},F=function(w,v,I,P){var u=2*v,Q=2*I;return w[u]<w[Q]||w[u]===w[Q]&&P[v]<=P[I]},O=function(w,v,I){for(var P=w.heap[I],u=I<<1;u<=w.heap_len&&(u<w.heap_len&&F(v,w.heap[u+1],w.heap[u],w.depth)&&u++,!F(v,P,w.heap[u],w.depth));)w.heap[I]=w.heap[u],I=u,u<<=1;w.heap[I]=P},N=function(w,v,P){var u,Q,U,p,r=0;if(0!==w.last_lit)do{u=w.pending_buf[w.d_buf+2*r]<<8|w.pending_buf[w.d_buf+2*r+1],Q=w.pending_buf[w.l_buf+r],r++,0===u?o(w,Q,v):(U=J[Q],o(w,U+I+1,v),0!==(p=K[U])&&(Q-=l[U],E(w,Q,p)),u--,U=i(u),o(w,U,P),0!==(p=a[U])&&(u-=s[U],E(w,u,p)))}while(r<w.last_lit);o(w,256,v)},q=function(w,v){var I,P,u,K=v.dyn_tree,a=v.stat_desc.static_tree,U=v.stat_desc.has_stree,p=v.stat_desc.elems,r=-1;for(w.heap_len=0,w.heap_max=573,I=0;I<p;I++)0!==K[2*I]?(w.heap[++w.heap_len]=r=I,w.depth[I]=0):K[2*I+1]=0;for(;w.heap_len<2;)K[2*(u=w.heap[++w.heap_len]=r<2?++r:0)]=1,w.depth[u]=0,w.opt_len--,U&&(w.static_len-=a[2*u+1]);for(v.max_code=r,I=w.heap_len>>1;I>=1;I--)O(w,K,I);u=p;do{I=w.heap[1],w.heap[1]=w.heap[w.heap_len--],O(w,K,1),P=w.heap[1],w.heap[--w.heap_max]=I,w.heap[--w.heap_max]=P,K[2*u]=K[2*I]+K[2*P],w.depth[u]=(w.depth[I]>=w.depth[P]?w.depth[I]:w.depth[P])+1,K[2*I+1]=K[2*P+1]=u,w.heap[1]=u++,O(w,K,1)}while(w.heap_len>=2);w.heap[--w.heap_max]=w.heap[1],function(w,v){var I,P,u,K,a,U,p=v.dyn_tree,r=v.max_code,Y=v.stat_desc.static_tree,g=v.stat_desc.has_stree,J=v.stat_desc.extra_bits,l=v.stat_desc.extra_base,R=v.stat_desc.max_length,x=0;for(K=0;K<=Q;K++)w.bl_count[K]=0;for(p[2*w.heap[w.heap_max]+1]=0,I=w.heap_max+1;I<573;I++)(K=p[2*p[2*(P=w.heap[I])+1]+1]+1)>R&&(K=R,x++),p[2*P+1]=K,P>r||(w.bl_count[K]++,a=0,P>=l&&(a=J[P-l]),U=p[2*P],w.opt_len+=U*(K+a),g&&(w.static_len+=U*(Y[2*P+1]+a)));if(0!==x){do{for(K=R-1;0===w.bl_count[K];)K--;w.bl_count[K]--,w.bl_count[K+1]+=2,w.bl_count[R]--,x-=2}while(x>0);for(K=R;0!==K;K--)for(P=w.bl_count[K];0!==P;)(u=w.heap[--I])>r||(p[2*u+1]!==K&&(w.opt_len+=(K-p[2*u+1])*p[2*u],p[2*u+1]=K),P--)}}(w,v),n(K,r,w.bl_count)},m=function(w,v,I){var P,u,Q=-1,K=v[1],a=0,U=7,p=4;for(0===K&&(U=138,p=3),v[2*(I+1)+1]=65535,P=0;P<=I;P++)u=K,K=v[2*(P+1)+1],++a<U&&u===K||(a<p?w.bl_tree[2*u]+=a:0!==u?(u!==Q&&w.bl_tree[2*u]++,w.bl_tree[32]++):a<=10?w.bl_tree[34]++:w.bl_tree[36]++,a=0,Q=u,0===K?(U=138,p=3):u===K?(U=6,p=3):(U=7,p=4))},c=function(w,v,I){var P,u,Q=-1,K=v[1],a=0,U=7,p=4;for(0===K&&(U=138,p=3),P=0;P<=I;P++)if(u=K,K=v[2*(P+1)+1],!(++a<U&&u===K)){if(a<p)do{o(w,u,w.bl_tree)}while(0!==--a);else 0!==u?(u!==Q&&(o(w,u,w.bl_tree),a--),o(w,16,w.bl_tree),E(w,a-3,2)):a<=10?(o(w,17,w.bl_tree),E(w,a-3,3)):(o(w,18,w.bl_tree),E(w,a-11,7));a=0,Q=u,0===K?(U=138,p=3):u===K?(U=6,p=3):(U=7,p=4)}},M=!1,S=function(w,v,I,P){E(w,0+(P?1:0),3),function(w,v,I,P){V(w),P&&(z(w,I),z(w,~I)),w.pending_buf.set(w.window.subarray(v,v+I),w.pending),w.pending+=I}(w,v,I,!0)};w.exports._tr_init=function(w){M||(!function(){var w,v,I,p,t,i=new Array(16);for(I=0,p=0;p<28;p++)for(l[p]=I,w=0;w<1<<K[p];w++)J[I++]=p;for(J[I-1]=p,t=0,p=0;p<16;p++)for(s[p]=t,w=0;w<1<<a[p];w++)g[t++]=p;for(t>>=7;p<u;p++)for(s[p]=t<<7,w=0;w<1<<a[p]-7;w++)g[256+t++]=p;for(v=0;v<=Q;v++)i[v]=0;for(w=0;w<=143;)r[2*w+1]=8,w++,i[8]++;for(;w<=255;)r[2*w+1]=9,w++,i[9]++;for(;w<=279;)r[2*w+1]=7,w++,i[7]++;for(;w<=287;)r[2*w+1]=8,w++,i[8]++;for(n(r,287,i),w=0;w<u;w++)Y[2*w+1]=5,Y[2*w]=h(w,5);R=new B(r,K,257,P,Q),x=new B(Y,a,0,u,Q),j=new B(new Array(0),U,0,19,7)}(),M=!0),w.l_desc=new t(w.dyn_ltree,R),w.d_desc=new t(w.dyn_dtree,x),w.bl_desc=new t(w.bl_tree,j),w.bi_buf=0,w.bi_valid=0,W(w)},w.exports._tr_stored_block=S,w.exports._tr_flush_block=function(w,v,P,u){var Q,K,a=0;w.level>0?(2===w.strm.data_type&&(w.strm.data_type=function(w){var v,P=4093624447;for(v=0;v<=31;v++,P>>>=1)if(1&P&&0!==w.dyn_ltree[2*v])return 0;if(0!==w.dyn_ltree[18]||0!==w.dyn_ltree[20]||0!==w.dyn_ltree[26])return 1;for(v=32;v<I;v++)if(0!==w.dyn_ltree[2*v])return 1;return 0}(w)),q(w,w.l_desc),q(w,w.d_desc),a=function(w){var v;for(m(w,w.dyn_ltree,w.l_desc.max_code),m(w,w.dyn_dtree,w.d_desc.max_code),q(w,w.bl_desc),v=18;v>=3&&0===w.bl_tree[2*p[v]+1];v--);return w.opt_len+=3*(v+1)+5+5+4,v}(w),Q=w.opt_len+3+7>>>3,(K=w.static_len+3+7>>>3)<=Q&&(Q=K)):Q=K=P+5,P+4<=Q&&-1!==v?S(w,v,P,u):4===w.strategy||K===Q?(E(w,2+(u?1:0),3),N(w,r,Y)):(E(w,4+(u?1:0),3),function(w,v,I,P){var u;for(E(w,v-257,5),E(w,I-1,5),E(w,P-4,4),u=0;u<P;u++)E(w,w.bl_tree[2*p[u]+1],3);c(w,w.dyn_ltree,v-1),c(w,w.dyn_dtree,I-1)}(w,w.l_desc.max_code+1,w.d_desc.max_code+1,a+1),N(w,w.dyn_ltree,w.dyn_dtree)),W(w),u&&V(w)},w.exports._tr_tally=function(w,v,P){return w.pending_buf[w.d_buf+2*w.last_lit]=v>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&v,w.pending_buf[w.l_buf+w.last_lit]=255&P,w.last_lit++,0===v?w.dyn_ltree[2*P]++:(w.matches++,v--,w.dyn_ltree[2*(J[P]+I+1)]++,w.dyn_dtree[2*i(v)]++),w.last_lit===w.lit_bufsize-1},w.exports._tr_align=function(w){E(w,2,3),o(w,256,r),function(w){16===w.bi_valid?(z(w,w.bi_buf),w.bi_buf=0,w.bi_valid=0):w.bi_valid>=8&&(w.pending_buf[w.pending++]=255&w.bi_buf,w.bi_buf>>=8,w.bi_valid-=8)}(w)}},70400:function(w){"use strict";w.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},53984:function(w){function v(w,v,I){for(var P=w.length,u=-1/0,Q=1/0,K=0;K<P;K++){var a=(I[0][K]-w[K])/v[K],U=(I[1][K]-w[K])/v[K];if(a>U){var p=a;a=U,U=p}if(U<u||a>Q)return 1/0;a>u&&(u=a),U<Q&&(Q=U)}return u>Q?1/0:u}w.exports=function(w,I,P,u){var Q=v(I,P,u);if(Q===1/0)w=null;else{w=w||[];for(var K=0;K<I.length;K++)w[K]=I[K]+P[K]*Q}return w},w.exports.distance=v},95319:function(w,v,I){"use strict";I.d(v,{b:function(){return Q}});var P=I(47313),u=I(24898),Q=function(w){var v=(0,u.e)(w);(0,P.useEffect)((function(){var w=function(w){var I;if(null!=v.current&&(I=v.current(w)),w.defaultPrevented&&(w.returnValue=""),"string"===typeof I)return w.returnValue=I,I};return window.addEventListener("beforeunload",w),function(){window.removeEventListener("beforeunload",w)}}),[])}},52796:function(w,v,I){"use strict";var P=I(41065),u=Array.prototype.concat,Q=Array.prototype.slice,K=w.exports=function(w){for(var v=[],I=0,K=w.length;I<K;I++){var a=w[I];P(a)?v=u.call(v,Q.call(a)):v.push(a)}return v};K.wrap=function(w){return function(){return w(K(arguments))}}},41065:function(w){w.exports=function(w){return!(!w||"string"===typeof w)&&(w instanceof Array||Array.isArray(w)||w.length>=0&&(w.splice instanceof Function||Object.getOwnPropertyDescriptor(w,w.length-1)&&"String"!==w.constructor.name))}},44642:function(w){"use strict";var v=[],I=[],P=[],u=[],Q=[],K=[],a=[],U=[],p=[],r=[],Y=[],g=[];w.exports=function(w,J,l,R,x,j){for(var s=a,B=p,t=r,i=g,z=0;z<3;z++)s[z]=+l[z],t[z]=+J.max[z],B[z]=+J.base[z];j||(j=1e-10);var E=function(w,a,p,r,g,J){var l=v,R=I,x=P,j=u,s=Q,B=K,t=U,i=Math.floor,z=0,E=0,o=0,h=0,n=0;if(W(),0===o)return 0;for(h=O();E<=o;){if(V(h)&&F())return z;h=O()}for(z+=o,n=0;n<3;n++)r[n]+=p[n],g[n]+=p[n];return z;function W(){if(E=0,0!==(o=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])))for(var w=0;w<3;w++){var v=p[w]>=0;j[w]=v?1:-1;var I=v?g[w]:r[w];l[w]=v?r[w]:g[w],R[w]=N(I,j[w]),x[w]=q(l[w],j[w]),t[w]=p[w]/o,s[w]=Math.abs(1/t[w]);var P=v?R[w]+1-I:I-R[w];B[w]=s[w]<1/0?s[w]*P:1/0}}function V(v){for(var I=j[0],P=0===v?R[0]:x[0],u=R[0]+I,Q=j[1],K=1===v?R[1]:x[1],a=R[1]+Q,U=j[2],p=2===v?R[2]:x[2],r=R[2]+U,Y=P;Y!=u;Y+=I)for(var g=K;g!=a;g+=Q)for(var J=p;J!=r;J+=U)if(w(Y,g,J))return!0;return!1}function F(){z+=E;var w=j[h],v=E/o,I=Y;for(n=0;n<3;n++){var P=p[n]*v;r[n]+=P,g[n]+=P,I[n]=p[n]-P}if(w>0?g[h]=Math.round(g[h]):r[h]=Math.round(r[h]),a(z,h,w,I))return!0;for(n=0;n<3;n++)p[n]=I[n];return W(),0===o}function O(){var w=B[0]<B[1]?B[0]<B[2]?0:2:B[1]<B[2]?1:2,v=B[w]-E;for(E=B[w],R[w]+=j[w],B[w]+=s[w],n=0;n<3;n++)l[n]+=v*t[n],x[n]=q(l[n],j[n]);return w}function N(w,v){return i(w-v*J)}function q(w,v){return i(w+v*J)}}(w,R,s,B,t,j);if(!x){for(z=0;z<3;z++)i[z]=l[z]>0?t[z]-J.max[z]:B[z]-J.base[z];J.translate(i)}return E}},85882:function(w,v,I){var P=I(83895);function u(w){for(var v,I,u=0,Q=w.length,K=0;K<w.length;){for(v=w[K],I=0;K<Q&&w[K]===v;)++K,++I;u+=P.log2(I)/7|0,u+=P.log2(v>>>0)/7|0,u+=2}return u}v.size=u,v.encode=function(w,v){v||(v=new Uint8Array(u(w)));for(var I,P,Q=0,K=v.length,a=0;a<w.length;){for(I=w[a],P=0;a<w.length&&w[a]===I;)++a,++P;for(;Q<K&&P>=128;)v[Q++]=128+(127&P),P>>>=7;if(Q>=K)throw new Error("RLE buffer overflow");for(v[Q++]=P,I>>>=0;Q<K&&I>=128;)v[Q++]=128+(127&I),I>>>=7;if(Q>=K)throw new Error("RLE buffer overflow");v[Q++]=I}return v},v.decode=function(w,v){for(var I,P,u,Q,K=v.length,a=w.length,U=0,p=0;p<a;){for(I=0,P=0;p<a&&w[p]>=128;)I+=(127&w[p++])<<P,P+=7;if(I+=w[p++]<<P,p>=a)throw new Error("RLE buffer underrun");if(U+I>K)throw new Error("Chunk buffer overflow");for(u=0,P=0;p<a&&w[p]>=128;)u+=(127&w[p++])<<P,P+=7;if(p>=a)throw new Error("RLE buffer underrun");for(u+=w[p++]<<P,Q=0;Q<I;++Q)v[U++]=u}return v}},83895:function(w,v){"use strict";function I(w){var v=32;return(w&=-w)&&v--,65535&w&&(v-=16),16711935&w&&(v-=8),252645135&w&&(v-=4),858993459&w&&(v-=2),1431655765&w&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(w){return(w>0)-(w<0)},v.abs=function(w){var v=w>>31;return(w^v)-v},v.min=function(w,v){return v^(w^v)&-(w<v)},v.max=function(w,v){return w^(w^v)&-(w<v)},v.isPow2=function(w){return!(w&w-1)&&!!w},v.log2=function(w){var v,I;return v=(w>65535)<<4,v|=I=((w>>>=v)>255)<<3,v|=I=((w>>>=I)>15)<<2,(v|=I=((w>>>=I)>3)<<1)|(w>>>=I)>>1},v.log10=function(w){return w>=1e9?9:w>=1e8?8:w>=1e7?7:w>=1e6?6:w>=1e5?5:w>=1e4?4:w>=1e3?3:w>=100?2:w>=10?1:0},v.popCount=function(w){return 16843009*((w=(858993459&(w-=w>>>1&1431655765))+(w>>>2&858993459))+(w>>>4)&252645135)>>>24},v.countTrailingZeros=I,v.nextPow2=function(w){return w+=0===w,--w,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)+1},v.prevPow2=function(w){return w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)-(w>>>1)},v.parity=function(w){return w^=w>>>16,w^=w>>>8,w^=w>>>4,27030>>>(w&=15)&1};var P=new Array(256);!function(w){for(var v=0;v<256;++v){var I=v,P=v,u=7;for(I>>>=1;I;I>>>=1)P<<=1,P|=1&I,--u;w[v]=P<<u&255}}(P),v.reverse=function(w){return P[255&w]<<24|P[w>>>8&255]<<16|P[w>>>16&255]<<8|P[w>>>24&255]},v.interleave2=function(w,v){return(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(w,v){return(w=65535&((w=16711935&((w=252645135&((w=858993459&((w=w>>>v&1431655765)|w>>>1))|w>>>2))|w>>>4))|w>>>16))<<16>>16},v.interleave3=function(w,v,I){return w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2),(w|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<2},v.deinterleave3=function(w,v){return(w=1023&((w=4278190335&((w=251719695&((w=3272356035&((w=w>>>v&1227133513)|w>>>2))|w>>>4))|w>>>8))|w>>>16))<<22>>22},v.nextCombination=function(w){var v=w|w-1;return v+1|(~v&-~v)-1>>>I(w)+1}},20477:function(w){"use strict";w.exports=function(w,v,I,P){var u=self||window;try{try{var Q;try{Q=new u.Blob([w])}catch(v){(Q=new(u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder)).append(w),Q=Q.getBlob()}var K=u.URL||u.webkitURL,a=K.createObjectURL(Q),U=new u[v](a,I);return K.revokeObjectURL(a),U}catch(P){return new u[v]("data:application/javascript,".concat(encodeURIComponent(w)),I)}}catch(w){if(!P)throw Error("Inline worker is not supported");return new u[v](P,I)}}},53229:function(w,v,I){"use strict";function P(w,v,I,P,u){var Q={};return Object.keys(P).forEach((function(w){Q[w]=P[w]})),Q.enumerable=!!Q.enumerable,Q.configurable=!!Q.configurable,("value"in Q||Q.initializer)&&(Q.writable=!0),Q=I.slice().reverse().reduce((function(I,P){return P(w,v,I)||I}),Q),u&&void 0!==Q.initializer&&(Q.value=Q.initializer?Q.initializer.call(u):void 0,Q.initializer=void 0),void 0===Q.initializer&&(Object.defineProperty(w,v,Q),Q=null),Q}I.d(v,{c:function(){return P}})},5647:function(w,v,I){"use strict";I.d(v,{e:function(){return Q}});var P=I(89611),u=I(78814);function Q(w,v,I){return Q=(0,u.e)()?Reflect.construct.bind():function(w,v,I){var u=[null];u.push.apply(u,v);var Q=new(Function.bind.apply(w,u));return I&&(0,P.c)(Q,I.prototype),Q},Q.apply(null,arguments)}},11752:function(w,v,I){"use strict";I.d(v,{c:function(){return Q}});var P=I(61120);function u(w,v){for(;!Object.prototype.hasOwnProperty.call(w,v)&&null!==(w=(0,P.d)(w)););return w}function Q(){return Q="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(w,v,I){var P=u(w,v);if(P){var Q=Object.getOwnPropertyDescriptor(P,v);return Q.get?Q.get.call(arguments.length<3?w:I):Q.value}},Q.apply(this,arguments)}},43269:function(w,v,I){"use strict";function P(w,v,I,P){I&&Object.defineProperty(w,v,{enumerable:I.enumerable,configurable:I.configurable,writable:I.writable,value:I.initializer?I.initializer.call(P):void 0})}I.d(v,{d:function(){return P}})},21664:function(w,v,I){"use strict";I.d(v,{b:function(){return J}});var P=I(80105),u=I(9488),Q=I(96658),K=I(9892),a=I(31709),U=I(25488),p=I(7686),r=I(74134),Y=I(2111),g=I(67935),J=function(){function w(v,I,P,u,Q,K){this.name=v,this.targetProperty=I,this.framePerSecond=P,this.dataType=u,this.loopMode=Q,this.enableBlending=K,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=I.split("."),this.dataType=u,this.loopMode=void 0===Q?w.ANIMATIONLOOPMODE_CYCLE:Q,this.uniqueId=w._UniqueIdGenerator++}return w._PrepareAnimation=function(v,I,Q,K,a,U,p,r){var g=void 0;if(!isNaN(parseFloat(a))&&isFinite(a)?g=w.ANIMATIONTYPE_FLOAT:a instanceof P.f?g=w.ANIMATIONTYPE_QUATERNION:a instanceof P.l?g=w.ANIMATIONTYPE_VECTOR3:a instanceof P.k?g=w.ANIMATIONTYPE_VECTOR2:a instanceof u.b?g=w.ANIMATIONTYPE_COLOR3:a instanceof u.f?g=w.ANIMATIONTYPE_COLOR4:a instanceof Y.c&&(g=w.ANIMATIONTYPE_SIZE),void 0==g)return null;var J=new w(v,I,Q,g,p),l=[{frame:0,value:a},{frame:K,value:U}];return J.setKeys(l),void 0!==r&&J.setEasingFunction(r),J},w.CreateAnimation=function(v,I,P,u){var Q=new w(v+"Animation",v,P,I,w.ANIMATIONLOOPMODE_CONSTANT);return Q.setEasingFunction(u),Q},w.CreateAndStartAnimation=function(v,I,P,u,Q,K,a,U,p,r,Y){var g=w._PrepareAnimation(v,P,u,Q,K,a,U,p);return g?(I.getScene&&(Y=I.getScene()),Y?Y.beginDirectAnimation(I,[g],0,Q,1===g.loopMode,1,r):null):null},w.CreateAndStartHierarchyAnimation=function(v,I,P,u,Q,K,a,U,p,r,Y){var g=w._PrepareAnimation(v,u,Q,K,a,U,p,r);return g?I.getScene().beginDirectHierarchyAnimation(I,P,[g],0,K,1===g.loopMode,1,Y):null},w.CreateMergeAndStartAnimation=function(v,I,P,u,Q,K,a,U,p,r){var Y=w._PrepareAnimation(v,P,u,Q,K,a,U,p);return Y?(I.animations.push(Y),I.getScene().beginAnimation(I,0,Q,1===Y.loopMode,1,r)):null},w.MakeAnimationAdditive=function(v,I,u,Q,K){void 0===I&&(I=0),void 0===Q&&(Q=!1);var a=v;if(Q&&((a=v.clone()).name=K||a.name),!a._keys.length)return a;I=I>=0?I:0;var U=0,p=a._keys[0],r=a._keys.length-1,Y=a._keys[r],g={referenceValue:p.value,referencePosition:P.i.Vector3[0],referenceQuaternion:P.i.Quaternion[0],referenceScaling:P.i.Vector3[1],keyPosition:P.i.Vector3[2],keyQuaternion:P.i.Quaternion[1],keyScaling:P.i.Vector3[3]},J=!1,l=p.frame,R=Y.frame;if(u){var x=a.getRange(u);x&&(l=x.from,R=x.to)}var j=p.frame===l,s=Y.frame===R;if(1===a._keys.length){var B=a._getKeyValue(a._keys[0]);g.referenceValue=B.clone?B.clone():B,J=!0}else if(I<=p.frame){B=a._getKeyValue(p.value);g.referenceValue=B.clone?B.clone():B,J=!0}else if(I>=Y.frame){B=a._getKeyValue(Y.value);g.referenceValue=B.clone?B.clone():B,J=!0}for(var t=0;!J||!j||!s&&t<a._keys.length-1;){var i=a._keys[t],z=a._keys[t+1];if(!J&&I>=i.frame&&I<=z.frame){B=void 0;if(I===i.frame)B=a._getKeyValue(i.value);else if(I===z.frame)B=a._getKeyValue(z.value);else{var E={key:t,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};B=a._interpolate(I,E)}g.referenceValue=B.clone?B.clone():B,J=!0}if(!j&&l>=i.frame&&l<=z.frame){if(l===i.frame)U=t;else if(l===z.frame)U=t+1;else{E={key:t,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};var o={frame:l,value:(B=a._interpolate(l,E)).clone?B.clone():B};a._keys.splice(t+1,0,o),U=t+1}j=!0}if(!s&&R>=i.frame&&R<=z.frame){if(R===i.frame)r=t;else if(R===z.frame)r=t+1;else{E={key:t,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},o={frame:R,value:(B=a._interpolate(R,E)).clone?B.clone():B};a._keys.splice(t+1,0,o),r=t+1}s=!0}t++}for(a.dataType===w.ANIMATIONTYPE_QUATERNION?g.referenceValue.normalize().conjugateInPlace():a.dataType===w.ANIMATIONTYPE_MATRIX&&(g.referenceValue.decompose(g.referenceScaling,g.referenceQuaternion,g.referencePosition),g.referenceQuaternion.normalize().conjugateInPlace()),t=U;t<=r;t++){o=a._keys[t];if(!t||a.dataType===w.ANIMATIONTYPE_FLOAT||o.value!==p.value)switch(a.dataType){case w.ANIMATIONTYPE_MATRIX:o.value.decompose(g.keyScaling,g.keyQuaternion,g.keyPosition),g.keyPosition.subtractInPlace(g.referencePosition),g.keyScaling.divideInPlace(g.referenceScaling),g.referenceQuaternion.multiplyToRef(g.keyQuaternion,g.keyQuaternion),P.e.ComposeToRef(g.keyScaling,g.keyQuaternion,g.keyPosition,o.value);break;case w.ANIMATIONTYPE_QUATERNION:g.referenceValue.multiplyToRef(o.value,o.value);break;case w.ANIMATIONTYPE_VECTOR2:case w.ANIMATIONTYPE_VECTOR3:case w.ANIMATIONTYPE_COLOR3:case w.ANIMATIONTYPE_COLOR4:o.value.subtractToRef(g.referenceValue,o.value);break;case w.ANIMATIONTYPE_SIZE:o.value.width-=g.referenceValue.width,o.value.height-=g.referenceValue.height;break;default:o.value-=g.referenceValue}}return a},w.TransitionTo=function(w,v,I,P,u,Q,K,a){if(void 0===a&&(a=null),K<=0)return I[w]=v,a&&a(),null;var U=u*(K/1e3);Q.setKeys([{frame:0,value:I[w].clone?I[w].clone():I[w]},{frame:U,value:v}]),I.animations||(I.animations=[]),I.animations.push(Q);var p=P.beginAnimation(I,0,U,!1);return p.onAnimationEnd=a,p},Object.defineProperty(w.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var w=0,v=this._runtimeAnimations;w<v.length;w++){if(!v[w].isStopped())return!0}return!1},enumerable:!1,configurable:!0}),w.prototype.toString=function(w){var v="Name: "+this.name+", property: "+this.targetProperty;if(v+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],v+=", nKeys: "+(this._keys?this._keys.length:"none"),v+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),w){v+=", Ranges: {";var I=!0;for(var P in this._ranges)I&&(v+=", ",I=!1),v+=P;v+="}"}return v},w.prototype.addEvent=function(w){this._events.push(w),this._events.sort((function(w,v){return w.frame-v.frame}))},w.prototype.removeEvents=function(w){for(var v=0;v<this._events.length;v++)this._events[v].frame===w&&(this._events.splice(v,1),v--)},w.prototype.getEvents=function(){return this._events},w.prototype.createRange=function(w,v,I){this._ranges[w]||(this._ranges[w]=new p.d(w,v,I))},w.prototype.deleteRange=function(w,v){void 0===v&&(v=!0);var I=this._ranges[w];if(I){if(v)for(var P=I.from,u=I.to,Q=this._keys.length-1;Q>=0;Q--)this._keys[Q].frame>=P&&this._keys[Q].frame<=u&&this._keys.splice(Q,1);this._ranges[w]=null}},w.prototype.getRange=function(w){return this._ranges[w]},w.prototype.getKeys=function(){return this._keys},w.prototype.getHighestFrame=function(){for(var w=0,v=0,I=this._keys.length;v<I;v++)w<this._keys[v].frame&&(w=this._keys[v].frame);return w},w.prototype.getEasingFunction=function(){return this._easingFunction},w.prototype.setEasingFunction=function(w){this._easingFunction=w},w.prototype.floatInterpolateFunction=function(w,v,I){return Q.b.Lerp(w,v,I)},w.prototype.floatInterpolateFunctionWithTangents=function(w,v,I,P,u){return Q.b.Hermite(w,v,I,P,u)},w.prototype.quaternionInterpolateFunction=function(w,v,I){return P.f.Slerp(w,v,I)},w.prototype.quaternionInterpolateFunctionWithTangents=function(w,v,I,u,Q){return P.f.Hermite(w,v,I,u,Q).normalize()},w.prototype.vector3InterpolateFunction=function(w,v,I){return P.l.Lerp(w,v,I)},w.prototype.vector3InterpolateFunctionWithTangents=function(w,v,I,u,Q){return P.l.Hermite(w,v,I,u,Q)},w.prototype.vector2InterpolateFunction=function(w,v,I){return P.k.Lerp(w,v,I)},w.prototype.vector2InterpolateFunctionWithTangents=function(w,v,I,u,Q){return P.k.Hermite(w,v,I,u,Q)},w.prototype.sizeInterpolateFunction=function(w,v,I){return Y.c.Lerp(w,v,I)},w.prototype.color3InterpolateFunction=function(w,v,I){return u.b.Lerp(w,v,I)},w.prototype.color3InterpolateFunctionWithTangents=function(w,v,I,P,Q){return u.b.Hermite(w,v,I,P,Q)},w.prototype.color4InterpolateFunction=function(w,v,I){return u.f.Lerp(w,v,I)},w.prototype.color4InterpolateFunctionWithTangents=function(w,v,I,P,Q){return u.f.Hermite(w,v,I,P,Q)},w.prototype._getKeyValue=function(w){return"function"===typeof w?w():w},w.prototype.evaluate=function(v){return this._interpolate(v,{key:0,repeatCount:0,loopMode:w.ANIMATIONLOOPMODE_CONSTANT})},w.prototype._interpolate=function(v,I){if(I.loopMode===w.ANIMATIONLOOPMODE_CONSTANT&&I.repeatCount>0)return I.highLimitValue.clone?I.highLimitValue.clone():I.highLimitValue;var P=this._keys;if(1===P.length)return this._getKeyValue(P[0].value);var u=I.key;if(P[u].frame>=v)for(;u-1>=0&&P[u].frame>=v;)u--;for(var Q=u;Q<P.length-1;Q++){var K=P[Q+1];if(K.frame>=v){I.key=Q;var a=P[Q],p=this._getKeyValue(a.value),r=this._getKeyValue(K.value);if(a.interpolation===U.d.STEP)return K.frame>v?p:r;var Y=void 0!==a.outTangent&&void 0!==K.inTangent,g=K.frame-a.frame,J=(v-a.frame)/g,l=this.getEasingFunction();switch(null!==l&&(J=l.ease(J)),this.dataType){case w.ANIMATIONTYPE_FLOAT:var R=Y?this.floatInterpolateFunctionWithTangents(p,a.outTangent*g,r,K.inTangent*g,J):this.floatInterpolateFunction(p,r,J);switch(I.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:return R;case w.ANIMATIONLOOPMODE_RELATIVE:return I.offsetValue*I.repeatCount+R}break;case w.ANIMATIONTYPE_QUATERNION:var x=Y?this.quaternionInterpolateFunctionWithTangents(p,a.outTangent.scale(g),r,K.inTangent.scale(g),J):this.quaternionInterpolateFunction(p,r,J);switch(I.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:return x;case w.ANIMATIONLOOPMODE_RELATIVE:return x.addInPlace(I.offsetValue.scale(I.repeatCount))}return x;case w.ANIMATIONTYPE_VECTOR3:var j=Y?this.vector3InterpolateFunctionWithTangents(p,a.outTangent.scale(g),r,K.inTangent.scale(g),J):this.vector3InterpolateFunction(p,r,J);switch(I.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:return j;case w.ANIMATIONLOOPMODE_RELATIVE:return j.add(I.offsetValue.scale(I.repeatCount))}break;case w.ANIMATIONTYPE_VECTOR2:var s=Y?this.vector2InterpolateFunctionWithTangents(p,a.outTangent.scale(g),r,K.inTangent.scale(g),J):this.vector2InterpolateFunction(p,r,J);switch(I.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:return s;case w.ANIMATIONLOOPMODE_RELATIVE:return s.add(I.offsetValue.scale(I.repeatCount))}break;case w.ANIMATIONTYPE_SIZE:switch(I.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(p,r,J);case w.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(p,r,J).add(I.offsetValue.scale(I.repeatCount))}break;case w.ANIMATIONTYPE_COLOR3:var B=Y?this.color3InterpolateFunctionWithTangents(p,a.outTangent.scale(g),r,K.inTangent.scale(g),J):this.color3InterpolateFunction(p,r,J);switch(I.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:return B;case w.ANIMATIONLOOPMODE_RELATIVE:return B.add(I.offsetValue.scale(I.repeatCount))}break;case w.ANIMATIONTYPE_COLOR4:var t=Y?this.color4InterpolateFunctionWithTangents(p,a.outTangent.scale(g),r,K.inTangent.scale(g),J):this.color4InterpolateFunction(p,r,J);switch(I.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:return t;case w.ANIMATIONLOOPMODE_RELATIVE:return t.add(I.offsetValue.scale(I.repeatCount))}break;case w.ANIMATIONTYPE_MATRIX:switch(I.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:return w.AllowMatricesInterpolation?this.matrixInterpolateFunction(p,r,J,I.workValue):p;case w.ANIMATIONLOOPMODE_RELATIVE:return p}}break}}return this._getKeyValue(P[P.length-1].value)},w.prototype.matrixInterpolateFunction=function(v,I,u,Q){return w.AllowMatrixDecomposeForInterpolation?Q?(P.e.DecomposeLerpToRef(v,I,u,Q),Q):P.e.DecomposeLerp(v,I,u):Q?(P.e.LerpToRef(v,I,u,Q),Q):P.e.Lerp(v,I,u)},w.prototype.clone=function(){var v=new w(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(v.enableBlending=this.enableBlending,v.blendingSpeed=this.blendingSpeed,this._keys&&v.setKeys(this._keys),this._ranges)for(var I in v._ranges={},this._ranges){var P=this._ranges[I];P&&(v._ranges[I]=P.clone())}return v},w.prototype.setKeys=function(w){this._keys=w.slice(0)},w.prototype.serialize=function(){var v={};v.name=this.name,v.property=this.targetProperty,v.framePerSecond=this.framePerSecond,v.dataType=this.dataType,v.loopBehavior=this.loopMode,v.enableBlending=this.enableBlending,v.blendingSpeed=this.blendingSpeed;var I=this.dataType;v.keys=[];for(var P=this.getKeys(),u=0;u<P.length;u++){var Q=P[u],K={};switch(K.frame=Q.frame,I){case w.ANIMATIONTYPE_FLOAT:K.values=[Q.value],void 0!==Q.inTangent&&K.values.push(Q.inTangent),void 0!==Q.outTangent&&(void 0===Q.inTangent&&K.values.push(void 0),K.values.push(Q.outTangent)),void 0!==Q.interpolation&&(void 0===Q.inTangent&&K.values.push(void 0),void 0===Q.outTangent&&K.values.push(void 0),K.values.push(Q.interpolation));break;case w.ANIMATIONTYPE_QUATERNION:case w.ANIMATIONTYPE_MATRIX:case w.ANIMATIONTYPE_VECTOR3:case w.ANIMATIONTYPE_COLOR3:case w.ANIMATIONTYPE_COLOR4:K.values=Q.value.asArray(),void 0!=Q.inTangent&&K.values.push(Q.inTangent.asArray()),void 0!=Q.outTangent&&(void 0===Q.inTangent&&K.values.push(void 0),K.values.push(Q.outTangent.asArray())),void 0!==Q.interpolation&&(void 0===Q.inTangent&&K.values.push(void 0),void 0===Q.outTangent&&K.values.push(void 0),K.values.push(Q.interpolation))}v.keys.push(K)}for(var a in v.ranges=[],this._ranges){var U=this._ranges[a];if(U){var p={};p.name=a,p.from=U.from,p.to=U.to,v.ranges.push(p)}}return v},w._UniversalLerp=function(w,v,I){var P=w.constructor;return P.Lerp?P.Lerp(w,v,I):P.Slerp?P.Slerp(w,v,I):w.toFixed?w*(1-I)+I*v:v},w.Parse=function(v){var I,Q,K=new w(v.name,v.property,v.framePerSecond,v.dataType,v.loopBehavior),a=v.dataType,U=[];for(v.enableBlending&&(K.enableBlending=v.enableBlending),v.blendingSpeed&&(K.blendingSpeed=v.blendingSpeed),Q=0;Q<v.keys.length;Q++){var p=v.keys[Q],r=void 0,Y=void 0,g=void 0;switch(a){case w.ANIMATIONTYPE_FLOAT:I=p.values[0],p.values.length>=2&&(r=p.values[1]),p.values.length>=3&&(Y=p.values[2]),p.values.length>=4&&(g=p.values[3]);break;case w.ANIMATIONTYPE_QUATERNION:if(I=P.f.FromArray(p.values),p.values.length>=8){var J=P.f.FromArray(p.values.slice(4,8));J.equals(P.f.Zero())||(r=J)}if(p.values.length>=12){var l=P.f.FromArray(p.values.slice(8,12));l.equals(P.f.Zero())||(Y=l)}p.values.length>=13&&(g=p.values[12]);break;case w.ANIMATIONTYPE_MATRIX:I=P.e.FromArray(p.values),p.values.length>=17&&(g=p.values[16]);break;case w.ANIMATIONTYPE_COLOR3:I=u.b.FromArray(p.values),p.values[3]&&(r=u.b.FromArray(p.values[3])),p.values[4]&&(Y=u.b.FromArray(p.values[4])),p.values[5]&&(g=p.values[5]);break;case w.ANIMATIONTYPE_COLOR4:I=u.f.FromArray(p.values),p.values[4]&&(r=u.f.FromArray(p.values[4])),p.values[5]&&(Y=u.f.FromArray(p.values[5])),p.values[6]&&(g=u.f.FromArray(p.values[6]));break;case w.ANIMATIONTYPE_VECTOR3:default:I=P.l.FromArray(p.values),p.values[3]&&(r=P.l.FromArray(p.values[3])),p.values[4]&&(Y=P.l.FromArray(p.values[4])),p.values[5]&&(g=p.values[5])}var R={};R.frame=p.frame,R.value=I,void 0!=r&&(R.inTangent=r),void 0!=Y&&(R.outTangent=Y),void 0!=g&&(R.interpolation=g),U.push(R)}if(K.setKeys(U),v.ranges)for(Q=0;Q<v.ranges.length;Q++)I=v.ranges[Q],K.createRange(I.name,I.from,I.to);return K},w.AppendSerializedAnimations=function(w,v){K.e.AppendSerializedAnimations(w,v)},w.ParseFromFileAsync=function(w,v){var I=this;return new Promise((function(P,u){var Q=new g.b;Q.addEventListener("readystatechange",(function(){if(4==Q.readyState)if(200==Q.status){var v=JSON.parse(Q.responseText);if(v.animations&&(v=v.animations),v.length){for(var K=new Array,a=0,U=v;a<U.length;a++){var p=U[a];K.push(I.Parse(p))}P(K)}else{K=I.Parse(v);w&&(K.name=w),P(K)}}else u("Unable to load the animation")})),Q.open("GET",v),Q.send()}))},w.CreateFromSnippetAsync=function(w){var v=this;return new Promise((function(I,P){var u=new g.b;u.addEventListener("readystatechange",(function(){if(4==u.readyState)if(200==u.status){var Q=JSON.parse(JSON.parse(u.responseText).jsonPayload);if(Q.animations){for(var K=JSON.parse(Q.animations),a=new Array,U=0,p=K.animations;U<p.length;U++){var r=p[U];(Y=v.Parse(r)).snippetId=w,a.push(Y)}I(a)}else{var Y;K=JSON.parse(Q.animation);(Y=v.Parse(K)).snippetId=w,I(Y)}}else P("Unable to load the snippet "+w)})),u.open("GET",v.SnippetUrl+"/"+w.replace(/#/g,"/")),u.send()}))},w._UniqueIdGenerator=0,w.AllowMatricesInterpolation=!1,w.AllowMatrixDecomposeForInterpolation=!0,w.SnippetUrl="https://snippet.babylonjs.com",w.ANIMATIONTYPE_FLOAT=0,w.ANIMATIONTYPE_VECTOR3=1,w.ANIMATIONTYPE_QUATERNION=2,w.ANIMATIONTYPE_MATRIX=3,w.ANIMATIONTYPE_COLOR3=4,w.ANIMATIONTYPE_COLOR4=7,w.ANIMATIONTYPE_VECTOR2=5,w.ANIMATIONTYPE_SIZE=6,w.ANIMATIONLOOPMODE_RELATIVE=0,w.ANIMATIONLOOPMODE_CYCLE=1,w.ANIMATIONLOOPMODE_CONSTANT=2,w}();(0,a.g)("BABYLON.Animation",J),r.b._AnimationRangeFactory=function(w,v,I){return new p.d(w,v,I)}},25488:function(w,v,I){"use strict";var P;I.d(v,{d:function(){return P}}),function(w){w[w.NONE=0]="NONE",w[w.STEP=1]="STEP"}(P||(P={}))},7686:function(w,v,I){"use strict";I.d(v,{d:function(){return P}});var P=function(){function w(w,v,I){this.name=w,this.from=v,this.to=I}return w.prototype.clone=function(){return new w(this.name,this.from,this.to)},w}()},43251:function(w,v,I){"use strict";I.d(v,{c:function(){return u},f:function(){return Q}});var P=I(82419),u=function(){function w(w,v,I,u,Q,K,a,U){void 0===u&&(u=0),void 0===Q&&(Q=!1),void 0===K&&(K=!1),void 0===a&&(a=!1),this._isAlreadyOwned=!1,w.getScene?this._engine=w.getScene().getEngine():this._engine=w,this._updatable=I,this._instanced=K,this._divisor=U||1,v instanceof P.c?(this._data=null,this._buffer=v):(this._data=v,this._buffer=null),this.byteStride=a?u:u*Float32Array.BYTES_PER_ELEMENT,Q||this.create()}return w.prototype.createVertexBuffer=function(w,v,I,P,u,K,a){void 0===K&&(K=!1);var U=K?v:v*Float32Array.BYTES_PER_ELEMENT,p=P?K?P:P*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Q(this._engine,this,w,this._updatable,!0,p,void 0===u?this._instanced:u,U,I,void 0,void 0,!0,this._divisor||a)},w.prototype.isUpdatable=function(){return this._updatable},w.prototype.getData=function(){return this._data},w.prototype.getBuffer=function(){return this._buffer},w.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},w.prototype.create=function(w){void 0===w&&(w=null),!w&&this._buffer||(w=w||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,w),this._data=w):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(w),this._data=w):this._buffer=this._engine.createVertexBuffer(w))},w.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},w.prototype.update=function(w){this.create(w)},w.prototype.updateDirectly=function(w,v,I,P){void 0===P&&(P=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,w,P?v:v*Float32Array.BYTES_PER_ELEMENT,I?I*this.byteStride:void 0),this._data=0===v&&void 0===I?w:null)},w.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},w.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},w}(),Q=function(){function w(v,I,P,Q,K,a,U,p,r,Y,g,J,l,R){if(void 0===g&&(g=!1),void 0===J&&(J=!1),void 0===l&&(l=1),void 0===R&&(R=!1),I instanceof u?(this._buffer=I,this._ownsBuffer=R):(this._buffer=new u(v,I,Q,a,K,U,J),this._ownsBuffer=!0),this.uniqueId=w._Counter++,this._kind=P,void 0==Y){var x=this.getData();this.type=w.FLOAT,x instanceof Int8Array?this.type=w.BYTE:x instanceof Uint8Array?this.type=w.UNSIGNED_BYTE:x instanceof Int16Array?this.type=w.SHORT:x instanceof Uint16Array?this.type=w.UNSIGNED_SHORT:x instanceof Int32Array?this.type=w.INT:x instanceof Uint32Array&&(this.type=w.UNSIGNED_INT)}else this.type=Y;var j=w.GetTypeByteLength(this.type);J?(this._size=r||(a?a/j:w.DeduceStride(P)),this.byteStride=a||this._buffer.byteStride||this._size*j,this.byteOffset=p||0):(this._size=r||a||w.DeduceStride(P),this.byteStride=a?a*j:this._buffer.byteStride||this._size*j,this.byteOffset=(p||0)*j),this.normalized=g,this._instanced=void 0!==U&&U,this._instanceDivisor=U?l:0,this._computeHashCode()}return Object.defineProperty(w.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(w){this._instanceDivisor=w,this._instanced=0!=w,this._computeHashCode()},enumerable:!1,configurable:!0}),w.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},w.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},w.prototype.getKind=function(){return this._kind},w.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},w.prototype.getData=function(){return this._buffer.getData()},w.prototype.getFloatData=function(v,I){var P=this.getData();if(!P)return null;var u=this.getSize()*w.GetTypeByteLength(this.type),Q=v*this.getSize();if(this.type!==w.FLOAT||this.byteStride!==u){var K=new Float32Array(Q);return this.forEach(Q,(function(w,v){return K[v]=w})),K}if(!(P instanceof Array||P instanceof Float32Array)||0!==this.byteOffset||P.length!==Q){if(P instanceof Array){var a=this.byteOffset/4;return P.slice(a,a+Q)}if(P instanceof ArrayBuffer)return new Float32Array(P,this.byteOffset,Q);a=P.byteOffset+this.byteOffset;if(I){var U=new Float32Array(Q),p=new Float32Array(P.buffer,a,Q);return U.set(p),U}var r=a%4;return r&&(a=Math.max(0,a-r)),new Float32Array(P.buffer,a,Q)}return I?P.slice():P},w.prototype.getBuffer=function(){return this._buffer.getBuffer()},w.prototype.getStrideSize=function(){return this.byteStride/w.GetTypeByteLength(this.type)},w.prototype.getOffset=function(){return this.byteOffset/w.GetTypeByteLength(this.type)},w.prototype.getSize=function(v){return void 0===v&&(v=!1),v?this._size*w.GetTypeByteLength(this.type):this._size},w.prototype.getIsInstanced=function(){return this._instanced},w.prototype.getInstanceDivisor=function(){return this._instanceDivisor},w.prototype.create=function(w){this._buffer.create(w)},w.prototype.update=function(w){this._buffer.update(w)},w.prototype.updateDirectly=function(w,v,I){void 0===I&&(I=!1),this._buffer.updateDirectly(w,v,void 0,I)},w.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},w.prototype.forEach=function(v,I){w.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,v,this.normalized,I)},w.DeduceStride=function(v){switch(v){case w.UVKind:case w.UV2Kind:case w.UV3Kind:case w.UV4Kind:case w.UV5Kind:case w.UV6Kind:return 2;case w.NormalKind:case w.PositionKind:return 3;case w.ColorKind:case w.MatricesIndicesKind:case w.MatricesIndicesExtraKind:case w.MatricesWeightsKind:case w.MatricesWeightsExtraKind:case w.TangentKind:return 4;default:throw new Error("Invalid kind '"+v+"'")}},w.GetTypeByteLength=function(v){switch(v){case w.BYTE:case w.UNSIGNED_BYTE:return 1;case w.SHORT:case w.UNSIGNED_SHORT:return 2;case w.INT:case w.UNSIGNED_INT:case w.FLOAT:return 4;default:throw new Error("Invalid type '".concat(v,"'"))}},w.ForEach=function(v,I,P,u,Q,K,a,U){if(v instanceof Array)for(var p=I/4,r=P/4,Y=0;Y<K;Y+=u){for(var g=0;g<u;g++)U(v[p+g],Y+g);p+=r}else{var J=v instanceof ArrayBuffer?new DataView(v):new DataView(v.buffer,v.byteOffset,v.byteLength),l=w.GetTypeByteLength(Q);for(Y=0;Y<K;Y+=u){var R=I;for(g=0;g<u;g++){U(w._GetFloatValue(J,Q,R,a),Y+g),R+=l}I+=P}}},w._GetFloatValue=function(v,I,P,u){switch(I){case w.BYTE:var Q=v.getInt8(P);return u&&(Q=Math.max(Q/127,-1)),Q;case w.UNSIGNED_BYTE:Q=v.getUint8(P);return u&&(Q/=255),Q;case w.SHORT:Q=v.getInt16(P,!0);return u&&(Q=Math.max(Q/32767,-1)),Q;case w.UNSIGNED_SHORT:Q=v.getUint16(P,!0);return u&&(Q/=65535),Q;case w.INT:return v.getInt32(P,!0);case w.UNSIGNED_INT:return v.getUint32(P,!0);case w.FLOAT:return v.getFloat32(P,!0);default:throw new Error("Invalid component type ".concat(I))}},w._Counter=0,w.BYTE=5120,w.UNSIGNED_BYTE=5121,w.SHORT=5122,w.UNSIGNED_SHORT=5123,w.INT=5124,w.UNSIGNED_INT=5125,w.FLOAT=5126,w.PositionKind="position",w.NormalKind="normal",w.TangentKind="tangent",w.UVKind="uv",w.UV2Kind="uv2",w.UV3Kind="uv3",w.UV4Kind="uv4",w.UV5Kind="uv5",w.UV6Kind="uv6",w.ColorKind="color",w.ColorInstanceKind="instanceColor",w.MatricesIndicesKind="matricesIndices",w.MatricesWeightsKind="matricesWeights",w.MatricesIndicesExtraKind="matricesIndicesExtra",w.MatricesWeightsExtraKind="matricesWeightsExtra",w}()},82419:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=w._Counter++}return Object.defineProperty(w.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),w._Counter=0,w}()},4268:function(w,v,I){"use strict";I.d(v,{c:function(){return m}});var P=I(78502),u=I(9892),Q=I(9271),K=I(80105),a=I(74134),U=I(65847),p=I(25239),r=I(19500),Y=I(61686),g=function(){function w(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(w.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(w){this._zoomStopsAnimation=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(w){this._idleRotationSpeed=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(w){this._idleRotationWaitTime=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(w){this._idleRotationSpinupTime=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),w.prototype.init=function(){},w.prototype.attach=function(w){var v=this;this._attachedCamera=w;var I=this._attachedCamera.getScene();this._onPrePointerObservableObserver=I.onPrePointerObservable.add((function(w){w.type!==p.e.POINTERDOWN?w.type===p.e.POINTERUP&&(v._isPointerDown=!1):v._isPointerDown=!0})),this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((function(){if(!v._reachTargetAlpha()){var w=r.b.Now,I=0;null!=v._lastFrameTime&&(I=w-v._lastFrameTime),v._lastFrameTime=w,v._applyUserInteraction();var P=w-v._lastInteractionTime-v._idleRotationWaitTime,u=Math.max(Math.min(P/v._idleRotationSpinupTime,1),0);v._cameraRotationSpeed=v._idleRotationSpeed*u,v._attachedCamera&&(v._attachedCamera.alpha-=v._cameraRotationSpeed*(I/1e3))}}))},w.prototype.detach=function(){if(this._attachedCamera){var w=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&w.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},w.prototype.resetLastInteractionTime=function(w){this._lastInteractionTime=null!==w&&void 0!==w?w:r.b.Now},w.prototype._reachTargetAlpha=function(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Y.e},w.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},w.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var w=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(w=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?w:this._userIsZooming()},w.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=r.b.Now)},w.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},w}(),J=I(12476),l=function(){function w(){this._easingMode=w.EASINGMODE_EASEIN}return w.prototype.setEasingMode=function(w){var v=Math.min(Math.max(w,0),2);this._easingMode=v},w.prototype.getEasingMode=function(){return this._easingMode},w.prototype.easeInCore=function(w){throw new Error("You must implement this method")},w.prototype.ease=function(v){switch(this._easingMode){case w.EASINGMODE_EASEIN:return this.easeInCore(v);case w.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-v)}return v>=.5?.5*(1-this.easeInCore(2*(1-v)))+.5:.5*this.easeInCore(2*v)},w.EASINGMODE_EASEIN=0,w.EASINGMODE_EASEOUT=1,w.EASINGMODE_EASEINOUT=2,w}(),R=(function(w){function v(){return null!==w&&w.apply(this,arguments)||this}(0,P.m)(v,w),v.prototype.easeInCore=function(w){return w=Math.max(0,Math.min(1,w)),1-Math.sqrt(1-w*w)}}(l),function(w){function v(v){void 0===v&&(v=1);var I=w.call(this)||this;return I.amplitude=v,I}return(0,P.m)(v,w),v.prototype.easeInCore=function(w){var v=Math.max(0,this.amplitude);return Math.pow(w,3)-w*v*Math.sin(3.141592653589793*w)},v}(l)),x=(function(w){function v(v,I){void 0===v&&(v=3),void 0===I&&(I=2);var P=w.call(this)||this;return P.bounces=v,P.bounciness=I,P}(0,P.m)(v,w),v.prototype.easeInCore=function(w){var v=Math.max(0,this.bounces),I=this.bounciness;I<=1&&(I=1.001);var P=Math.pow(I,v),u=1-I,Q=(1-P)/u+.5*P,K=w*Q,a=Math.log(-K*(1-I)+1)/Math.log(I),U=Math.floor(a),p=U+1,r=(1-Math.pow(I,U))/(u*Q),Y=.5*(r+(1-Math.pow(I,p))/(u*Q)),g=w-Y,J=Y-r;return-Math.pow(1/I,v-U)/(J*J)*(g-J)*(g+J)}}(l),function(w){function v(){return null!==w&&w.apply(this,arguments)||this}(0,P.m)(v,w),v.prototype.easeInCore=function(w){return w*w*w}}(l),function(w){function v(v,I){void 0===v&&(v=3),void 0===I&&(I=3);var P=w.call(this)||this;return P.oscillations=v,P.springiness=I,P}(0,P.m)(v,w),v.prototype.easeInCore=function(w){var v=Math.max(0,this.oscillations),I=Math.max(0,this.springiness);return(0==I?w:(Math.exp(I*w)-1)/(Math.exp(I)-1))*Math.sin((6.283185307179586*v+1.5707963267948966)*w)}}(l),function(w){function v(v){void 0===v&&(v=2);var I=w.call(this)||this;return I.exponent=v,I}return(0,P.m)(v,w),v.prototype.easeInCore=function(w){return this.exponent<=0?w:(Math.exp(this.exponent*w)-1)/(Math.exp(this.exponent)-1)},v}(l)),j=(function(w){function v(v){void 0===v&&(v=2);var I=w.call(this)||this;return I.power=v,I}(0,P.m)(v,w),v.prototype.easeInCore=function(w){var v=Math.max(0,this.power);return Math.pow(w,v)}}(l),function(w){function v(){return null!==w&&w.apply(this,arguments)||this}(0,P.m)(v,w),v.prototype.easeInCore=function(w){return w*w}}(l),function(w){function v(){return null!==w&&w.apply(this,arguments)||this}(0,P.m)(v,w),v.prototype.easeInCore=function(w){return w*w*w*w}}(l),function(w){function v(){return null!==w&&w.apply(this,arguments)||this}(0,P.m)(v,w),v.prototype.easeInCore=function(w){return w*w*w*w*w}}(l),function(w){function v(){return null!==w&&w.apply(this,arguments)||this}(0,P.m)(v,w),v.prototype.easeInCore=function(w){return 1-Math.sin(1.5707963267948966*(1-w))}}(l),function(w){function v(v,I,P,u){void 0===v&&(v=0),void 0===I&&(I=0),void 0===P&&(P=1),void 0===u&&(u=1);var Q=w.call(this)||this;return Q.x1=v,Q.y1=I,Q.x2=P,Q.y2=u,Q}(0,P.m)(v,w),v.prototype.easeInCore=function(w){return J.c.Interpolate(w,this.x1,this.y1,this.x2,this.y2)}}(l),I(21664)),s=function(){function w(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(w.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(w){var v=this;if(this._autoTransitionRange!==w){this._autoTransitionRange=w;var I=this._attachedCamera;I&&(w?this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((function(w){if(w){w.computeWorldMatrix(!0);var I=w.getBoundingInfo().diagonalLength;v.lowerRadiusTransitionRange=.05*I,v.upperRadiusTransitionRange=.05*I}})):this._onMeshTargetChangedObserver&&I.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),w.prototype.init=function(){},w.prototype.attach=function(w){var v=this;this._attachedCamera=w,this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((function(){v._attachedCamera&&(v._isRadiusAtLimit(v._attachedCamera.lowerRadiusLimit)&&v._applyBoundRadiusAnimation(v.lowerRadiusTransitionRange),v._isRadiusAtLimit(v._attachedCamera.upperRadiusLimit)&&v._applyBoundRadiusAnimation(v.upperRadiusTransitionRange))}))},w.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},w.prototype._isRadiusAtLimit=function(w){return!!this._attachedCamera&&(this._attachedCamera.radius===w&&!this._radiusIsAnimating)},w.prototype._applyBoundRadiusAnimation=function(v){var I=this;if(this._attachedCamera){this._radiusBounceTransition||(w.EasingFunction.setEasingMode(w.EasingMode),this._radiusBounceTransition=j.b.CreateAnimation("radius",j.b.ANIMATIONTYPE_FLOAT,60,w.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var P=j.b.TransitionTo("radius",this._attachedCamera.radius+v,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(function(){return I._clearAnimationLocks()}));P&&this._animatables.push(P)}},w.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},w.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},w.EasingFunction=new R(.3),w.EasingMode=l.EASINGMODE_EASEOUT,w}(),B=function(){function w(){this.onTargetFramingAnimationEndObservable=new Q.c,this._mode=w.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(w.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"mode",{get:function(){return this._mode},set:function(w){this._mode=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(w){this._radiusScale=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"positionScale",{get:function(){return this._positionScale},set:function(w){this._positionScale=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(w){this._defaultElevation=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(w){this._elevationReturnTime=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(w){this._elevationReturnWaitTime=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(w){this._zoomStopsAnimation=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"framingTime",{get:function(){return this._framingTime},set:function(w){this._framingTime=w},enumerable:!1,configurable:!0}),w.prototype.init=function(){},w.prototype.attach=function(v){var I=this;this._attachedCamera=v;var P=this._attachedCamera.getScene();w.EasingFunction.setEasingMode(w.EasingMode),this._onPrePointerObservableObserver=P.onPrePointerObservable.add((function(w){w.type!==p.e.POINTERDOWN?w.type===p.e.POINTERUP&&(I._isPointerDown=!1):I._isPointerDown=!0})),this._onMeshTargetChangedObserver=v.onMeshTargetChangedObservable.add((function(w){w&&I.zoomOnMesh(w,void 0,(function(){I.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((function(){I._applyUserInteraction(),I._maintainCameraAboveGround()}))},w.prototype.detach=function(){if(this._attachedCamera){var w=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&w.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},w.prototype.zoomOnMesh=function(w,v,I){void 0===v&&(v=!1),void 0===I&&(I=null),w.computeWorldMatrix(!0);var P=w.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(P.minimumWorld,P.maximumWorld,v,I)},w.prototype.zoomOnMeshHierarchy=function(w,v,I){void 0===v&&(v=!1),void 0===I&&(I=null),w.computeWorldMatrix(!0);var P=w.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(P.min,P.max,v,I)},w.prototype.zoomOnMeshesHierarchy=function(w,v,I){void 0===v&&(v=!1),void 0===I&&(I=null);for(var P=new K.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new K.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Q=0;Q<w.length;Q++){var a=w[Q].getHierarchyBoundingVectors(!0);K.l.CheckExtends(a.min,P,u),K.l.CheckExtends(a.max,P,u)}this.zoomOnBoundingInfo(P,u,v,I)},w.prototype.zoomOnBoundingInfo=function(v,I,P,u){var Q,a=this;if(void 0===P&&(P=!1),void 0===u&&(u=null),this._attachedCamera){var U=v.y,p=U+(I.y-U)*this._positionScale,r=I.subtract(v).scale(.5);if(P)Q=new K.l(0,p,0);else{var Y=v.add(r);Q=new K.l(Y.x,p,Y.z)}this._vectorTransition||(this._vectorTransition=j.b.CreateAnimation("target",j.b.ANIMATIONTYPE_VECTOR3,60,w.EasingFunction)),this._betaIsAnimating=!0;var g=j.b.TransitionTo("target",Q,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);g&&this._animatables.push(g);var J=0;if(this._mode===w.FitFrustumSidesMode){var l=this._calculateLowerRadiusFromModelBoundingSphere(v,I);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=r.length()+this._attachedCamera.minZ),J=l}else this._mode===w.IgnoreBoundsSizeMode&&(J=this._calculateLowerRadiusFromModelBoundingSphere(v,I),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var R=I.subtract(v).length();this._attachedCamera.panningSensibility=5e3/R,this._attachedCamera.wheelPrecision=100/J}this._radiusTransition||(this._radiusTransition=j.b.CreateAnimation("radius",j.b.ANIMATIONTYPE_FLOAT,60,w.EasingFunction)),(g=j.b.TransitionTo("radius",J,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(function(){a.stopAllAnimations(),u&&u(),a._attachedCamera&&a._attachedCamera.useInputToRestoreState&&a._attachedCamera.storeState()})))&&this._animatables.push(g)}},w.prototype._calculateLowerRadiusFromModelBoundingSphere=function(v,I){var P=I.subtract(v).length(),u=this._getFrustumSlope(),Q=.5*P*this._radiusScale,K=Q*Math.sqrt(1+1/(u.x*u.x)),a=Q*Math.sqrt(1+1/(u.y*u.y)),U=Math.max(K,a),p=this._attachedCamera;return p?(p.lowerRadiusLimit&&this._mode===w.IgnoreBoundsSizeMode&&(U=U<p.lowerRadiusLimit?p.lowerRadiusLimit:U),p.upperRadiusLimit&&(U=U>p.upperRadiusLimit?p.upperRadiusLimit:U),U):0},w.prototype._maintainCameraAboveGround=function(){var v=this;if(!(this._elevationReturnTime<0)){var I=r.b.Now-this._lastInteractionTime,P=.5*Math.PI-this._defaultElevation,u=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>u&&I>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=j.b.CreateAnimation("beta",j.b.ANIMATIONTYPE_FLOAT,60,w.EasingFunction));var Q=j.b.TransitionTo("beta",P,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(function(){v._clearAnimationLocks(),v.stopAllAnimations()}));Q&&this._animatables.push(Q)}}},w.prototype._getFrustumSlope=function(){var w=this._attachedCamera;if(!w)return K.k.Zero();var v=w.getScene().getEngine().getAspectRatio(w),I=Math.tan(w.fov/2),P=I*v;return new K.k(P,I)},w.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},w.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=r.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())},w.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(w.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!1,configurable:!0}),w.EasingFunction=new x,w.EasingMode=l.EASINGMODE_EASEINOUT,w.IgnoreBoundsSizeMode=0,w.FitFrustumSidesMode=1,w}(),t=I(37643),i=I(2517),z=I(49815),E=I(9217),o=function(){function w(){this._currentActiveButton=-1,this.buttons=[0,1,2]}return w.prototype.attachControl=function(w){var v=this;w=E.i.BackCompatCameraNoPreventDefault(arguments);var I=this.camera.getEngine(),P=I.getInputElement(),u=0,Q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(K){var a=K.event,U="touch"===a.pointerType;if(!I.isInVRExclusivePointerMode&&(K.type===p.e.POINTERMOVE||-1!==v.buttons.indexOf(a.button))){var r=a.srcElement||a.target;if(v._altKey=a.altKey,v._ctrlKey=a.ctrlKey,v._metaKey=a.metaKey,v._shiftKey=a.shiftKey,v._buttonsPressed=a.buttons,I.isPointerLock){var Y=a.movementX||a.mozMovementX||a.webkitMovementX||a.msMovementX||0,g=a.movementY||a.mozMovementY||a.webkitMovementY||a.msMovementY||0;v.onTouch(null,Y,g),v._pointA=null,v._pointB=null}else if(K.type!==p.e.POINTERDOWN||-1!==v._currentActiveButton&&!U)if(K.type===p.e.POINTERDOUBLETAP)v.onDoubleTap(a.pointerType);else if(K.type!==p.e.POINTERUP||v._currentActiveButton!==a.button&&!U){if(K.type===p.e.POINTERMOVE)if(w||a.preventDefault(),v._pointA&&null===v._pointB){Y=a.clientX-v._pointA.x,g=a.clientY-v._pointA.y;v.onTouch(v._pointA,Y,g),v._pointA.x=a.clientX,v._pointA.y=a.clientY}else if(v._pointA&&v._pointB){var J=v._pointA.pointerId===a.pointerId?v._pointA:v._pointB;J.x=a.clientX,J.y=a.clientY;var l=v._pointA.x-v._pointB.x,R=v._pointA.y-v._pointB.y,x=l*l+R*R,j={x:(v._pointA.x+v._pointB.x)/2,y:(v._pointA.y+v._pointB.y)/2,pointerId:a.pointerId,type:K.type};v.onMultiTouch(v._pointA,v._pointB,u,x,Q,j),Q=j,u=x}}else{try{null===r||void 0===r||r.releasePointerCapture(a.pointerId)}catch(w){}U||(v._pointB=null),I._badOS?v._pointA=v._pointB=null:v._pointB&&v._pointA&&v._pointA.pointerId==a.pointerId?(v._pointA=v._pointB,v._pointB=null):v._pointA&&v._pointB&&v._pointB.pointerId==a.pointerId?v._pointB=null:v._pointA=v._pointB=null,(0!==u||Q)&&(v.onMultiTouch(v._pointA,v._pointB,u,0,Q,null),u=0,Q=null),v._currentActiveButton=-1,v.onButtonUp(a),w||a.preventDefault()}else{try{null===r||void 0===r||r.setPointerCapture(a.pointerId)}catch(w){}null===v._pointA?v._pointA={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType}:null===v._pointB&&(v._pointB={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType}),-1!==v._currentActiveButton||U||(v._currentActiveButton=a.button),v.onButtonDown(a),w||(a.preventDefault(),P&&P.focus())}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,p.e.POINTERDOWN|p.e.POINTERUP|p.e.POINTERMOVE|p.e.POINTERDOUBLETAP),this._onLostFocus=function(){v._pointA=v._pointB=null,u=0,Q=null,v.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),P&&P.addEventListener("contextmenu",this._contextMenuBind,!1);var K=this.camera.getScene().getEngine().getHostWindow();K&&E.i.RegisterTopRootEvents(K,[{name:"blur",handler:this._onLostFocus}])},w.prototype.detachControl=function(){if(this._onLostFocus){var w=this.camera.getScene().getEngine().getHostWindow();w&&E.i.UnregisterTopRootEvents(w,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._contextMenuBind){var v=this.camera.getScene().getEngine().getInputElement();v&&v.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1},w.prototype.getClassName=function(){return"BaseCameraPointersInput"},w.prototype.getSimpleName=function(){return"pointers"},w.prototype.onDoubleTap=function(w){},w.prototype.onTouch=function(w,v,I){},w.prototype.onMultiTouch=function(w,v,I,P,u,Q){},w.prototype.onContextMenu=function(w){w.preventDefault()},w.prototype.onButtonDown=function(w){},w.prototype.onButtonUp=function(w){},w.prototype.onLostFocus=function(){},(0,P.i)([(0,u.J)()],w.prototype,"buttons",void 0),w}(),h=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.buttons=[0,1,2],v.angularSensibilityX=1e3,v.angularSensibilityY=1e3,v.pinchPrecision=12,v.pinchDeltaPercentage=0,v.useNaturalPinchZoom=!1,v.pinchZoom=!0,v.panningSensibility=1e3,v.multiTouchPanning=!0,v.multiTouchPanAndZoom=!0,v.pinchInwards=!0,v._isPanClick=!1,v._twoFingerActivityCount=0,v._isPinching=!1,v}return(0,P.m)(v,w),v.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},v.prototype._computeMultiTouchPanning=function(w,v){if(0!==this.panningSensibility&&w&&v){var I=v.x-w.x,P=v.y-w.y;this.camera.inertialPanningX+=-I/this.panningSensibility,this.camera.inertialPanningY+=P/this.panningSensibility}},v.prototype._computePinchZoom=function(w,I){var P=this.camera.radius||v.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=P*Math.sqrt(w)/Math.sqrt(I):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(I-w)*P*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(I-w)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)},v.prototype.onTouch=function(w,v,I){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-v/this.panningSensibility,this.camera.inertialPanningY+=I/this.panningSensibility):(this.camera.inertialAlphaOffset-=v/this.angularSensibilityX,this.camera.inertialBetaOffset-=I/this.angularSensibilityY)},v.prototype.onDoubleTap=function(){this.camera.useInputToRestoreState&&this.camera.restoreState()},v.prototype.onMultiTouch=function(w,v,I,P,u,Q){0===I&&null===u||0===P&&null===Q||(this.multiTouchPanAndZoom?(this._computePinchZoom(I,P),this._computeMultiTouchPanning(u,Q)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(P)-Math.sqrt(I))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(I,P),this._isPinching=!0):this._computeMultiTouchPanning(u,Q)):this.multiTouchPanning?this._computeMultiTouchPanning(u,Q):this.pinchZoom&&this._computePinchZoom(I,P))},v.prototype.onButtonDown=function(w){this._isPanClick=w.button===this.camera._panningMouseButton},v.prototype.onButtonUp=function(){this._twoFingerActivityCount=0,this._isPinching=!1},v.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},v.MinimumRadiusForPinch=.001,(0,P.i)([(0,u.J)()],v.prototype,"buttons",void 0),(0,P.i)([(0,u.J)()],v.prototype,"angularSensibilityX",void 0),(0,P.i)([(0,u.J)()],v.prototype,"angularSensibilityY",void 0),(0,P.i)([(0,u.J)()],v.prototype,"pinchPrecision",void 0),(0,P.i)([(0,u.J)()],v.prototype,"pinchDeltaPercentage",void 0),(0,P.i)([(0,u.J)()],v.prototype,"useNaturalPinchZoom",void 0),(0,P.i)([(0,u.J)()],v.prototype,"pinchZoom",void 0),(0,P.i)([(0,u.J)()],v.prototype,"panningSensibility",void 0),(0,P.i)([(0,u.J)()],v.prototype,"multiTouchPanning",void 0),(0,P.i)([(0,u.J)()],v.prototype,"multiTouchPanAndZoom",void 0),v}(o);z.b.ArcRotateCameraPointersInput=h;var n=I(45591),W=function(){function w(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return w.prototype.attachControl=function(w){var v=this;w=E.i.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){v._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(I){var P,u=I.event;u.metaKey||(I.type===n.d.KEYDOWN?(v._ctrlPressed=u.ctrlKey,v._altPressed=u.altKey,(-1!==v.keysUp.indexOf(u.keyCode)||-1!==v.keysDown.indexOf(u.keyCode)||-1!==v.keysLeft.indexOf(u.keyCode)||-1!==v.keysRight.indexOf(u.keyCode)||-1!==v.keysReset.indexOf(u.keyCode))&&(-1===(P=v._keys.indexOf(u.keyCode))&&v._keys.push(u.keyCode),u.preventDefault&&(w||u.preventDefault()))):-1===v.keysUp.indexOf(u.keyCode)&&-1===v.keysDown.indexOf(u.keyCode)&&-1===v.keysLeft.indexOf(u.keyCode)&&-1===v.keysRight.indexOf(u.keyCode)&&-1===v.keysReset.indexOf(u.keyCode)||((P=v._keys.indexOf(u.keyCode))>=0&&v._keys.splice(P,1),u.preventDefault&&(w||u.preventDefault())))})))},w.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},w.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var w=this.camera,v=0;v<this._keys.length;v++){var I=this._keys[v];-1!==this.keysLeft.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningX-=1/this.panningSensibility:w.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?w.inertialRadiusOffset+=1/this.zoomingSensibility:w.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningX+=1/this.panningSensibility:w.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(I)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?w.inertialRadiusOffset-=1/this.zoomingSensibility:w.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(I)&&w.useInputToRestoreState&&w.restoreState()}},w.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},w.prototype.getSimpleName=function(){return"keyboard"},(0,P.i)([(0,u.J)()],w.prototype,"keysUp",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysDown",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysLeft",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysRight",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysReset",void 0),(0,P.i)([(0,u.J)()],w.prototype,"panningSensibility",void 0),(0,P.i)([(0,u.J)()],w.prototype,"zoomingSensibility",void 0),(0,P.i)([(0,u.J)()],w.prototype,"useAltToZoom",void 0),(0,P.i)([(0,u.J)()],w.prototype,"angularSpeed",void 0),w}();z.b.ArcRotateCameraKeyboardMoveInput=W;var V=I(85567),F=I(13316),O=I(96658),N=function(){function w(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=K.l.Zero()}return w.prototype._computeDeltaFromMouseWheelLegacyEvent=function(w,v){var I=.01*w*this.wheelDeltaPercentage*v;return w>0?I/(1+this.wheelDeltaPercentage):I*(1+this.wheelDeltaPercentage)},w.prototype.attachControl=function(w){var v=this;this._wheel=function(w){if(w.type===p.e.POINTERWHEEL){var I=w.event,P=0,u=I,Q=0,K=I.deltaMode===F.b.DOM_DELTA_LINE?40:1;if(Q=void 0!==I.deltaY?-I.deltaY*K:void 0!==I.wheelDeltaY?-I.wheelDeltaY*K:u.wheelDelta,v.customComputeDeltaFromMouseWheel)P=v.customComputeDeltaFromMouseWheel(Q,v,I);else if(v.wheelDeltaPercentage){if((P=v._computeDeltaFromMouseWheelLegacyEvent(Q,v.camera.radius))>0){for(var a=v.camera.radius,U=v.camera.inertialRadiusOffset+P,r=0;r<20&&Math.abs(U)>.001;r++)a-=U,U*=v.camera.inertia;a=O.b.Clamp(a,0,Number.MAX_VALUE),P=v._computeDeltaFromMouseWheelLegacyEvent(Q,a)}}else P=Q/(40*v.wheelPrecision);P&&(v.zoomToMouseLocation&&v._hitPlane?v._zoomToMouse(P):v.camera.inertialRadiusOffset+=P)}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,p.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)},w.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},w.prototype.checkInputs=function(){if(this.zoomToMouseLocation){var w=this.camera;0+w.inertialAlphaOffset+w.inertialBetaOffset+w.inertialRadiusOffset&&(this._updateHitPlane(),w.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(w.inertia),this._zeroIfClose(this._inertialPanning))}},w.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},w.prototype.getSimpleName=function(){return"mousewheel"},w.prototype._updateHitPlane=function(){var w=this.camera,v=w.target.subtract(w.position);this._hitPlane=V.e.FromPositionAndNormal(w.target,v)},w.prototype._getPosition=function(){var w,v=this.camera,I=v.getScene(),P=I.createPickingRay(I.pointerX,I.pointerY,K.e.Identity(),v,!1),u=0;return this._hitPlane&&(u=null!==(w=P.intersectsPlane(this._hitPlane))&&void 0!==w?w:0),P.origin.addInPlace(P.direction.scaleInPlace(u))},w.prototype._zoomToMouse=function(w){var v,I,P=this.camera,u=1-P.inertia;if(P.lowerRadiusLimit){var Q=null!==(v=P.lowerRadiusLimit)&&void 0!==v?v:0;P.radius-(P.inertialRadiusOffset+w)/u<Q&&(w=(P.radius-Q)*u-P.inertialRadiusOffset)}if(P.upperRadiusLimit){var a=null!==(I=P.upperRadiusLimit)&&void 0!==I?I:0;P.radius-(P.inertialRadiusOffset+w)/u>a&&(w=(P.radius-a)*u-P.inertialRadiusOffset)}var U=w/u/P.radius,p=this._getPosition(),r=K.i.Vector3[6];p.subtractToRef(P.target,r),r.scaleInPlace(U),r.scaleInPlace(u),this._inertialPanning.addInPlace(r),P.inertialRadiusOffset+=w},w.prototype._zeroIfClose=function(w){Math.abs(w.x)<Y.e&&(w.x=0),Math.abs(w.y)<Y.e&&(w.y=0),Math.abs(w.z)<Y.e&&(w.z=0)},(0,P.i)([(0,u.J)()],w.prototype,"wheelPrecision",void 0),(0,P.i)([(0,u.J)()],w.prototype,"zoomToMouseLocation",void 0),(0,P.i)([(0,u.J)()],w.prototype,"wheelDeltaPercentage",void 0),w}();z.b.ArcRotateCameraMouseWheelInput=N;var q=function(w){function v(v){return w.call(this,v)||this}return(0,P.m)(v,w),v.prototype.addMouseWheel=function(){return this.add(new N),this},v.prototype.addPointers=function(){return this.add(new h),this},v.prototype.addKeyboard=function(){return this.add(new W),this},v}(z.c);a.b.AddNodeConstructor("ArcRotateCamera",(function(w,v){return function(){return new m(w,0,0,1,K.l.Zero(),v)}}));var m=function(w){function v(v,I,P,u,a,U,p){void 0===p&&(p=!0);var r=w.call(this,v,K.l.Zero(),U,p)||this;return r.inertialAlphaOffset=0,r.inertialBetaOffset=0,r.inertialRadiusOffset=0,r.lowerAlphaLimit=null,r.upperAlphaLimit=null,r.lowerBetaLimit=.01,r.upperBetaLimit=Math.PI-.01,r.lowerRadiusLimit=null,r.upperRadiusLimit=null,r.inertialPanningX=0,r.inertialPanningY=0,r.pinchToPanMaxDistance=20,r.panningDistanceLimit=null,r.panningOriginTarget=K.l.Zero(),r.panningInertia=.9,r.zoomOnFactor=1,r.targetScreenOffset=K.k.Zero(),r.allowUpsideDown=!0,r.useInputToRestoreState=!0,r._viewMatrix=new K.e,r.panningAxis=new K.l(1,1,0),r._transformedDirection=new K.l,r.mapPanning=!1,r.onMeshTargetChangedObservable=new Q.c,r.checkCollisions=!1,r.collisionRadius=new K.l(.5,.5,.5),r._previousPosition=K.l.Zero(),r._collisionVelocity=K.l.Zero(),r._newPosition=K.l.Zero(),r._computationVector=K.l.Zero(),r._onCollisionPositionChange=function(w,v,I){void 0===I&&(I=null),I?(r.setPosition(v),r.onCollide&&r.onCollide(I)):r._previousPosition.copyFrom(r._position);var P=Math.cos(r.alpha),u=Math.sin(r.alpha),Q=Math.cos(r.beta),K=Math.sin(r.beta);0===K&&(K=1e-4);var a=r._getTargetPosition();r._computationVector.copyFromFloats(r.radius*P*K,r.radius*Q,r.radius*u*K),a.addToRef(r._computationVector,r._newPosition),r._position.copyFrom(r._newPosition);var U=r.upVector;r.allowUpsideDown&&r.beta<0&&(U=(U=U.clone()).negate()),r._computeViewMatrix(r._position,a,U),r._viewMatrix.addAtIndex(12,r.targetScreenOffset.x),r._viewMatrix.addAtIndex(13,r.targetScreenOffset.y),r._collisionTriggered=!1},r._target=K.l.Zero(),a&&r.setTarget(a),r.alpha=I,r.beta=P,r.radius=u,r.getViewMatrix(),r.inputs=new q(r),r.inputs.addKeyboard().addMouseWheel().addPointers(),r}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"target",{get:function(){return this._target},set:function(w){this.setTarget(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"targetHost",{get:function(){return this._targetHost},set:function(w){w&&this.setTarget(w)},enumerable:!1,configurable:!0}),v.prototype.getTarget=function(){return this.target},Object.defineProperty(v.prototype,"position",{get:function(){return this._position},set:function(w){this.setPosition(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"upVector",{get:function(){return this._upVector},set:function(w){this._upToYMatrix||(this._yToUpMatrix=new K.e,this._upToYMatrix=new K.e,this._upVector=K.l.Zero()),w.normalize(),this._upVector.copyFrom(w),this.setMatUp()},enumerable:!1,configurable:!0}),v.prototype.setMatUp=function(){K.e.RotationAlignToRef(K.l.UpReadOnly,this._upVector,this._yToUpMatrix),K.e.RotationAlignToRef(this._upVector,K.l.UpReadOnly,this._upToYMatrix)},Object.defineProperty(v.prototype,"angularSensibilityX",{get:function(){var w=this.inputs.attached.pointers;return w?w.angularSensibilityX:0},set:function(w){var v=this.inputs.attached.pointers;v&&(v.angularSensibilityX=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"angularSensibilityY",{get:function(){var w=this.inputs.attached.pointers;return w?w.angularSensibilityY:0},set:function(w){var v=this.inputs.attached.pointers;v&&(v.angularSensibilityY=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"pinchPrecision",{get:function(){var w=this.inputs.attached.pointers;return w?w.pinchPrecision:0},set:function(w){var v=this.inputs.attached.pointers;v&&(v.pinchPrecision=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"pinchDeltaPercentage",{get:function(){var w=this.inputs.attached.pointers;return w?w.pinchDeltaPercentage:0},set:function(w){var v=this.inputs.attached.pointers;v&&(v.pinchDeltaPercentage=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"useNaturalPinchZoom",{get:function(){var w=this.inputs.attached.pointers;return!!w&&w.useNaturalPinchZoom},set:function(w){var v=this.inputs.attached.pointers;v&&(v.useNaturalPinchZoom=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"panningSensibility",{get:function(){var w=this.inputs.attached.pointers;return w?w.panningSensibility:0},set:function(w){var v=this.inputs.attached.pointers;v&&(v.panningSensibility=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysUp",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysUp:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysUp=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysDown",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysDown:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysDown=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysLeft",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysLeft:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysLeft=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysRight",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysRight:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysRight=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelPrecision",{get:function(){var w=this.inputs.attached.mousewheel;return w?w.wheelPrecision:0},set:function(w){var v=this.inputs.attached.mousewheel;v&&(v.wheelPrecision=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"zoomToMouseLocation",{get:function(){var w=this.inputs.attached.mousewheel;return!!w&&w.zoomToMouseLocation},set:function(w){var v=this.inputs.attached.mousewheel;v&&(v.zoomToMouseLocation=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelDeltaPercentage",{get:function(){var w=this.inputs.attached.mousewheel;return w?w.wheelDeltaPercentage:0},set:function(w){var v=this.inputs.attached.mousewheel;v&&(v.wheelDeltaPercentage=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(w){w!==this.useBouncingBehavior&&(w?(this._bouncingBehavior=new s,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(w){w!==this.useFramingBehavior&&(w?(this._framingBehavior=new B,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(w){w!==this.useAutoRotationBehavior&&(w?(this._autoRotationBehavior=new g,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),v.prototype._initCache=function(){w.prototype._initCache.call(this),this._cache._target=new K.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=K.k.Zero()},v.prototype._updateCache=function(v){v||w.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},v.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var w=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?w.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(w)}var v=this._getLockedTargetPosition();return v||this._target},v.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),w.prototype.storeState.call(this)},v.prototype._restoreStateValues=function(){return!!w.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},v.prototype._isSynchronizedViewMatrix=function(){return!!w.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},v.prototype.attachControl=function(w,v,I,P){var u=this;void 0===I&&(I=!0),void 0===P&&(P=2);var Q=arguments;v=E.i.BackCompatCameraNoPreventDefault(Q),this._useCtrlForPanning=I,this._panningMouseButton=P,"boolean"===typeof Q[0]&&(Q.length>1&&(this._useCtrlForPanning=Q[1]),Q.length>2&&(this._panningMouseButton=Q[2])),this.inputs.attachElement(v),this._reset=function(){u.inertialAlphaOffset=0,u.inertialBetaOffset=0,u.inertialRadiusOffset=0,u.inertialPanningX=0,u.inertialPanningY=0}},v.prototype.detachControl=function(){this.inputs.detachElement(),this._reset&&this._reset()},v.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var v=this.inertialAlphaOffset;this.beta<=0&&(v*=-1),this.getScene().useRightHandedSystem&&(v*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(v*=-1),this.alpha+=v,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Y.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Y.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Y.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){var I=new K.l(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),I.multiplyInPlace(this.panningAxis),K.l.TransformNormalToRef(I,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),K.l.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Y.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Y.e&&(this.inertialPanningY=0)}this._checkLimits(),w.prototype._checkInputs.call(this)}},v.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},v.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||K.l.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);var w=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var v=Math.round((w-this.alpha)/(2*Math.PI));this.alpha+=2*v*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},v.prototype.setPosition=function(w){this._position.equals(w)||(this._position.copyFrom(w),this.rebuildAnglesAndRadius())},v.prototype.setTarget=function(w,v,I,P){var u;if(void 0===v&&(v=!1),void 0===I&&(I=!1),void 0===P&&(P=!1),P=null!==(u=this.overrideCloneAlphaBetaRadius)&&void 0!==u?u:P,w.getBoundingInfo)this._targetBoundingCenter=v?w.getBoundingInfo().boundingBox.centerWorld.clone():null,w.computeWorldMatrix(),this._targetHost=w,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var Q=w,K=this._getTargetPosition();if(K&&!I&&K.equals(Q))return;this._targetHost=null,this._target=Q,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}P||this.rebuildAnglesAndRadius()},v.prototype._getViewMatrix=function(){var w=Math.cos(this.alpha),v=Math.sin(this.alpha),I=Math.cos(this.beta),P=Math.sin(this.beta);0===P&&(P=1e-4),0===this.radius&&(this.radius=1e-4);var u=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*w*P,this.radius*I,this.radius*v*P),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||K.l.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),u.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var Q=this.getScene().collisionCoordinator;this._collider||(this._collider=Q.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Q.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var a=this.upVector;this.allowUpsideDown&&P<0&&(a=a.negate()),this._computeViewMatrix(this._position,u,a),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=u,this._viewMatrix},v.prototype.zoomOn=function(w,v){void 0===v&&(v=!1),w=w||this.getScene().meshes;var I=U.b.MinMax(w),P=K.l.Distance(I.min,I.max);this.radius=P*this.zoomOnFactor,this.focusOn({min:I.min,max:I.max,distance:P},v)},v.prototype.focusOn=function(w,v){var I,P;if(void 0===v&&(v=!1),void 0===w.min){var u=w||this.getScene().meshes;I=U.b.MinMax(u),P=K.l.Distance(I.min,I.max)}else{I=w,P=w.distance}this._target=U.b.Center(I),v||(this.maxZ=2*P)},v.prototype.createRigCamera=function(w,I){var P=0;switch(this.cameraRigMode){case t.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case t.e.RIG_MODE_VR:P=this._cameraRigParams.stereoHalfAngle*(0===I?1:-1);break;case t.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:P=this._cameraRigParams.stereoHalfAngle*(0===I?-1:1)}var u=new v(w,this.alpha+P,this.beta,this.radius,this._target,this.getScene());return u._cameraRigParams={},u.isRigCamera=!0,u.rigParent=this,u.upVector=this.upVector,u},v.prototype._updateRigCameras=function(){var v=this._rigCameras[0],I=this._rigCameras[1];switch(v.beta=I.beta=this.beta,this.cameraRigMode){case t.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case t.e.RIG_MODE_VR:v.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case t.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:v.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}w.prototype._updateRigCameras.call(this)},v.prototype.dispose=function(){this.inputs.clear(),w.prototype.dispose.call(this)},v.prototype.getClassName=function(){return"ArcRotateCamera"},(0,P.i)([(0,u.J)()],v.prototype,"alpha",void 0),(0,P.i)([(0,u.J)()],v.prototype,"beta",void 0),(0,P.i)([(0,u.J)()],v.prototype,"radius",void 0),(0,P.i)([(0,u.J)()],v.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,P.i)([(0,u.G)("target")],v.prototype,"_target",void 0),(0,P.i)([(0,u.w)("targetHost")],v.prototype,"_targetHost",void 0),(0,P.i)([(0,u.J)()],v.prototype,"inertialAlphaOffset",void 0),(0,P.i)([(0,u.J)()],v.prototype,"inertialBetaOffset",void 0),(0,P.i)([(0,u.J)()],v.prototype,"inertialRadiusOffset",void 0),(0,P.i)([(0,u.J)()],v.prototype,"lowerAlphaLimit",void 0),(0,P.i)([(0,u.J)()],v.prototype,"upperAlphaLimit",void 0),(0,P.i)([(0,u.J)()],v.prototype,"lowerBetaLimit",void 0),(0,P.i)([(0,u.J)()],v.prototype,"upperBetaLimit",void 0),(0,P.i)([(0,u.J)()],v.prototype,"lowerRadiusLimit",void 0),(0,P.i)([(0,u.J)()],v.prototype,"upperRadiusLimit",void 0),(0,P.i)([(0,u.J)()],v.prototype,"inertialPanningX",void 0),(0,P.i)([(0,u.J)()],v.prototype,"inertialPanningY",void 0),(0,P.i)([(0,u.J)()],v.prototype,"pinchToPanMaxDistance",void 0),(0,P.i)([(0,u.J)()],v.prototype,"panningDistanceLimit",void 0),(0,P.i)([(0,u.G)()],v.prototype,"panningOriginTarget",void 0),(0,P.i)([(0,u.J)()],v.prototype,"panningInertia",void 0),(0,P.i)([(0,u.J)()],v.prototype,"zoomToMouseLocation",null),(0,P.i)([(0,u.J)()],v.prototype,"zoomOnFactor",void 0),(0,P.i)([(0,u.D)()],v.prototype,"targetScreenOffset",void 0),(0,P.i)([(0,u.J)()],v.prototype,"allowUpsideDown",void 0),(0,P.i)([(0,u.J)()],v.prototype,"useInputToRestoreState",void 0),v}(i.c)},37643:function(w,v,I){"use strict";I.d(v,{e:function(){return R}});var P=I(78502),u=I(9892),Q=I(21901),K=I(9217),a=I(9271),U=I(80105),p=I(74134),r=I(9127),Y=I(31709),g=I(50504),J=I(57278),l=I(46647),R=function(w){function v(I,P,u,K){void 0===K&&(K=!0);var p=w.call(this,I,u)||this;return p._position=U.l.Zero(),p._upVector=U.l.Up(),p.orthoLeft=null,p.orthoRight=null,p.orthoBottom=null,p.orthoTop=null,p.fov=.8,p.projectionPlaneTilt=0,p.minZ=1,p.maxZ=1e4,p.inertia=.9,p.mode=v.PERSPECTIVE_CAMERA,p.isIntermediate=!1,p.viewport=new J.d(0,0,1,1),p.layerMask=268435455,p.fovMode=v.FOVMODE_VERTICAL_FIXED,p.cameraRigMode=v.RIG_MODE_NONE,p.customRenderTargets=new Array,p.outputRenderTarget=null,p.onViewMatrixChangedObservable=new a.c,p.onProjectionMatrixChangedObservable=new a.c,p.onAfterCheckInputsObservable=new a.c,p.onRestoreStateObservable=new a.c,p.isRigCamera=!1,p._rigCameras=new Array,p._webvrViewMatrix=U.e.Identity(),p._skipRendering=!1,p._projectionMatrix=new U.e,p._postProcesses=new Array,p._activeMeshes=new Q.g(256),p._globalPosition=U.l.Zero(),p._computedViewMatrix=U.e.Identity(),p._doNotComputeProjectionMatrix=!1,p._transformMatrix=U.e.Zero(),p._refreshFrustumPlanes=!0,p._absoluteRotation=U.f.Identity(),p._isCamera=!0,p._isLeftCamera=!1,p._isRightCamera=!1,p.getScene().addCamera(p),K&&!p.getScene().activeCamera&&(p.getScene().activeCamera=p),p.position=P,p.renderPassId=p.getScene().getEngine().createRenderPassId("Camera ".concat(I)),p}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"position",{get:function(){return this._position},set:function(w){this._position=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"upVector",{get:function(){return this._upVector},set:function(w){this._upVector=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"screenArea",{get:function(){var w,I,P,u,Q=0,K=0;if(this.mode===v.PERSPECTIVE_CAMERA)this.fovMode===v.FOVMODE_VERTICAL_FIXED?(K=2*this.minZ*Math.tan(this.fov/2),Q=this.getEngine().getAspectRatio(this)*K):K=(Q=2*this.minZ*Math.tan(this.fov/2))/this.getEngine().getAspectRatio(this);else{var a=this.getEngine().getRenderWidth()/2,U=this.getEngine().getRenderHeight()/2;Q=(null!==(w=this.orthoRight)&&void 0!==w?w:a)-(null!==(I=this.orthoLeft)&&void 0!==I?I:-a),K=(null!==(P=this.orthoTop)&&void 0!==P?P:U)-(null!==(u=this.orthoBottom)&&void 0!==u?u:-U)}return Q*K},enumerable:!1,configurable:!0}),v.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},v.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},v.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},v.prototype.getClassName=function(){return"Camera"},v.prototype.toString=function(w){var v="Name: "+this.name;if(v+=", type: "+this.getClassName(),this.animations)for(var I=0;I<this.animations.length;I++)v+=", animation[0]: "+this.animations[I].toString(w);return v},v.prototype.applyVerticalCorrection=function(){var w=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-w.x:w.x},Object.defineProperty(v.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),v.prototype.getActiveMeshes=function(){return this._activeMeshes},v.prototype.isActiveMesh=function(w){return-1!==this._activeMeshes.indexOf(w)},v.prototype.isReady=function(v){if(void 0===v&&(v=!1),v)for(var I=0,P=this._postProcesses;I<P.length;I++){var u=P[I];if(u&&!u.isReady())return!1}return w.prototype.isReady.call(this,v)},v.prototype._initCache=function(){w.prototype._initCache.call(this),this._cache.position=new U.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new U.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},v.prototype._updateCache=function(v){v||w.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},v.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},v.prototype._isSynchronizedViewMatrix=function(){return!!w.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},v.prototype._isSynchronizedProjectionMatrix=function(){var w=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!w)return!1;var I=this.getEngine();return w=this.mode===v.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===I.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===I.getRenderWidth()&&this._cache.renderHeight===I.getRenderHeight()},v.prototype.attachControl=function(w,v){},v.prototype.detachControl=function(w){},v.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==v.RIG_MODE_NONE&&this._updateRigCameras()},v.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(v.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),v.prototype._getFirstPostProcess=function(){for(var w=0;w<this._postProcesses.length;w++)if(null!==this._postProcesses[w])return this._postProcesses[w];return null},v.prototype._cascadePostProcessesToRigCams=function(){var w=this._getFirstPostProcess();w&&w.markTextureDirty();for(var v=0,I=this._rigCameras.length;v<I;v++){var P=this._rigCameras[v],u=P._rigPostProcess;if(u)"pass"===u.getEffectName()&&(P.isIntermediate=0===this._postProcesses.length),P._postProcesses=this._postProcesses.slice(0).concat(u),u.markTextureDirty();else P._postProcesses=this._postProcesses.slice(0)}},v.prototype.attachPostProcess=function(w,v){return void 0===v&&(v=null),!w.isReusable()&&this._postProcesses.indexOf(w)>-1?(r.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==v||v<0?this._postProcesses.push(w):null===this._postProcesses[v]?this._postProcesses[v]=w:this._postProcesses.splice(v,0,w),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(w))},v.prototype.detachPostProcess=function(w){var v=this._postProcesses.indexOf(w);-1!==v&&(this._postProcesses[v]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},v.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},v.prototype._getViewMatrix=function(){return U.e.Identity()},v.prototype.getViewMatrix=function(w){return!w&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},v.prototype.freezeProjectionMatrix=function(w){this._doNotComputeProjectionMatrix=!0,void 0!==w&&(this._projectionMatrix=w)},v.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},v.prototype.getProjectionMatrix=function(w){var I,P,u,Q,K,a,p,r;if(this._doNotComputeProjectionMatrix||!w&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var Y=this.getEngine(),g=this.getScene();if(this.mode===v.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=Y.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);var J=Y.useReverseDepthBuffer;(g.useRightHandedSystem?U.e.PerspectiveFovRHToRef:U.e.PerspectiveFovLHToRef)(this.fov,Y.getAspectRatio(this),J?this.maxZ:this.minZ,J?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===v.FOVMODE_VERTICAL_FIXED,Y.isNDCHalfZRange,this.projectionPlaneTilt,Y.useReverseDepthBuffer)}else{var l=Y.getRenderWidth()/2,R=Y.getRenderHeight()/2;g.useRightHandedSystem?U.e.OrthoOffCenterRHToRef(null!==(I=this.orthoLeft)&&void 0!==I?I:-l,null!==(P=this.orthoRight)&&void 0!==P?P:l,null!==(u=this.orthoBottom)&&void 0!==u?u:-R,null!==(Q=this.orthoTop)&&void 0!==Q?Q:R,this.minZ,this.maxZ,this._projectionMatrix,Y.isNDCHalfZRange):U.e.OrthoOffCenterLHToRef(null!==(K=this.orthoLeft)&&void 0!==K?K:-l,null!==(a=this.orthoRight)&&void 0!==a?a:l,null!==(p=this.orthoBottom)&&void 0!==p?p:-R,null!==(r=this.orthoTop)&&void 0!==r?r:R,this.minZ,this.maxZ,this._projectionMatrix,Y.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=Y.getRenderWidth(),this._cache.renderHeight=Y.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},v.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},v.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?l.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=l.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},v.prototype.isInFrustum=function(w,v){if(void 0===v&&(v=!1),this._updateFrustumPlanes(),v&&this.rigCameras.length>0){var I=!1;return this.rigCameras.forEach((function(v){v._updateFrustumPlanes(),I=I||w.isInFrustum(v._frustumPlanes)})),I}return w.isInFrustum(this._frustumPlanes)},v.prototype.isCompletelyInFrustum=function(w){return this._updateFrustumPlanes(),w.isCompletelyInFrustum(this._frustumPlanes)},v.prototype.getForwardRay=function(w,v,I){throw void 0===w&&(w=100),(0,g.e)("Ray")},v.prototype.getForwardRayToRef=function(w,v,I,P){throw void 0===v&&(v=100),(0,g.e)("Ray")},v.prototype.dispose=function(I,P){for(void 0===P&&(P=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var u=this._rigCameras.pop();u&&u.dispose()}if(this._parentContainer){var Q=this._parentContainer.cameras.indexOf(this);Q>-1&&this._parentContainer.cameras.splice(Q,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==v.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var K=this._postProcesses.length;--K>=0;){var a=this._postProcesses[K];a&&a.dispose(this)}for(var U=this.customRenderTargets.length;--U>=0;)this.customRenderTargets[U].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),w.prototype.dispose.call(this,I,P)},Object.defineProperty(v.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),v.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},v.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},v.prototype.setCameraRigMode=function(w,I){if(this.cameraRigMode!==w){for(;this._rigCameras.length>0;){var P=this._rigCameras.pop();P&&P.dispose()}if(this.cameraRigMode=w,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=I.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=K.i.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==v.RIG_MODE_NONE){var u=this.createRigCamera(this.name+"_L",0);u&&(u._isLeftCamera=!0);var Q=this.createRigCamera(this.name+"_R",1);Q&&(Q._isRightCamera=!0),u&&Q&&(this._rigCameras.push(u),this._rigCameras.push(Q))}this._setRigMode(I),this._cascadePostProcessesToRigCams(),this.update()}},v.prototype._setRigMode=function(w){},v.prototype._getVRProjectionMatrix=function(){return U.e.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},v.prototype._updateCameraRotationMatrix=function(){},v.prototype._updateWebVRCameraRotationMatrix=function(){},v.prototype._getWebVRProjectionMatrix=function(){return U.e.Identity()},v.prototype._getWebVRViewMatrix=function(){return U.e.Identity()},v.prototype.setCameraRigParameter=function(w,v){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[w]=v,"interaxialDistance"===w&&(this._cameraRigParams.stereoHalfAngle=K.i.ToRadians(v/.0637))},v.prototype.createRigCamera=function(w,v){return null},v.prototype._updateRigCameras=function(){for(var w=0;w<this._rigCameras.length;w++)this._rigCameras[w].minZ=this.minZ,this._rigCameras[w].maxZ=this.maxZ,this._rigCameras[w].fov=this.fov,this._rigCameras[w].upVector.copyFrom(this.upVector);this.cameraRigMode===v.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},v.prototype._setupInputs=function(){},v.prototype.serialize=function(){var w=u.e.Serialize(this);return w.uniqueId=this.uniqueId,w.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(w),this.inputs&&this.inputs.serialize(w),u.e.AppendSerializedAnimations(this,w),w.ranges=this.serializeAnimationRanges(),w.isEnabled=this.isEnabled(),w},v.prototype.clone=function(w,I){void 0===I&&(I=null);var P=u.e.Clone(v.GetConstructorFromName(this.getClassName(),w,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return P.name=w,P.parent=I,this.onClonedObservable.notifyObservers(P),P},v.prototype.getDirection=function(w){var v=U.l.Zero();return this.getDirectionToRef(w,v),v},Object.defineProperty(v.prototype,"absoluteRotation",{get:function(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation},enumerable:!1,configurable:!0}),v.prototype.getDirectionToRef=function(w,v){U.l.TransformNormalToRef(w,this.getWorldMatrix(),v)},v.GetConstructorFromName=function(w,I,P,u,Q){void 0===u&&(u=0),void 0===Q&&(Q=!0);var K=p.b.Construct(w,I,P,{interaxial_distance:u,isStereoscopicSideBySide:Q});return K||function(){return v._CreateDefaultParsedCamera(I,P)}},v.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},v.Parse=function(w,I){var P=w.type,Q=v.GetConstructorFromName(P,w.name,I,w.interaxial_distance,w.isStereoscopicSideBySide),K=u.e.Parse(Q,w,I);if(void 0!==w.parentId&&(K._waitingParentId=w.parentId),void 0!==w.parentInstanceIndex&&(K._waitingParentInstanceIndex=w.parentInstanceIndex),K.inputs&&(K.inputs.parse(w),K._setupInputs()),w.upVector&&(K.upVector=U.l.FromArray(w.upVector)),K.setPosition&&(K.position.copyFromFloats(0,0,0),K.setPosition(U.l.FromArray(w.position))),w.target&&K.setTarget&&K.setTarget(U.l.FromArray(w.target)),w.cameraRigMode){var a=w.interaxial_distance?{interaxialDistance:w.interaxial_distance}:{};K.setCameraRigMode(w.cameraRigMode,a)}if(w.animations){for(var r=0;r<w.animations.length;r++){var g=w.animations[r],J=(0,Y.c)("BABYLON.Animation");J&&K.animations.push(J.Parse(g))}p.b.ParseAnimationRanges(K,w,I)}return w.autoAnimate&&I.beginAnimation(K,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),void 0!==w.isEnabled&&K.setEnabled(w.isEnabled),K},v._CreateDefaultParsedCamera=function(w,v){throw(0,g.e)("UniversalCamera")},v.PERSPECTIVE_CAMERA=0,v.ORTHOGRAPHIC_CAMERA=1,v.FOVMODE_VERTICAL_FIXED=0,v.FOVMODE_HORIZONTAL_FIXED=1,v.RIG_MODE_NONE=0,v.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,v.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,v.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,v.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,v.RIG_MODE_STEREOSCOPIC_INTERLACED=14,v.RIG_MODE_VR=20,v.RIG_MODE_WEBVR=21,v.RIG_MODE_CUSTOM=22,v.ForceAttachControlToAlwaysPreventDefault=!1,(0,P.i)([(0,u.G)("position")],v.prototype,"_position",void 0),(0,P.i)([(0,u.G)("upVector")],v.prototype,"_upVector",void 0),(0,P.i)([(0,u.J)()],v.prototype,"orthoLeft",void 0),(0,P.i)([(0,u.J)()],v.prototype,"orthoRight",void 0),(0,P.i)([(0,u.J)()],v.prototype,"orthoBottom",void 0),(0,P.i)([(0,u.J)()],v.prototype,"orthoTop",void 0),(0,P.i)([(0,u.J)()],v.prototype,"fov",void 0),(0,P.i)([(0,u.J)()],v.prototype,"projectionPlaneTilt",void 0),(0,P.i)([(0,u.J)()],v.prototype,"minZ",void 0),(0,P.i)([(0,u.J)()],v.prototype,"maxZ",void 0),(0,P.i)([(0,u.J)()],v.prototype,"inertia",void 0),(0,P.i)([(0,u.J)()],v.prototype,"mode",void 0),(0,P.i)([(0,u.J)()],v.prototype,"layerMask",void 0),(0,P.i)([(0,u.J)()],v.prototype,"fovMode",void 0),(0,P.i)([(0,u.J)()],v.prototype,"cameraRigMode",void 0),(0,P.i)([(0,u.J)()],v.prototype,"interaxialDistance",void 0),(0,P.i)([(0,u.J)()],v.prototype,"isStereoscopicSideBySide",void 0),v}(p.b)},49815:function(w,v,I){"use strict";I.d(v,{b:function(){return K},c:function(){return a}});var P=I(9127),u=I(9892),Q=I(37643),K={},a=function(){function w(w){this.attachedToElement=!1,this.attached={},this.camera=w,this.checkInputs=function(){}}return w.prototype.add=function(w){var v=w.getSimpleName();this.attached[v]?P.e.Warn("camera input of type "+v+" already exists on camera"):(this.attached[v]=w,w.camera=this.camera,w.checkInputs&&(this.checkInputs=this._addCheckInputs(w.checkInputs.bind(w))),this.attachedToElement&&w.attachControl())},w.prototype.remove=function(w){for(var v in this.attached){var I=this.attached[v];I===w&&(I.detachControl(),I.camera=null,delete this.attached[v],this.rebuildInputCheck())}},w.prototype.removeByType=function(w){for(var v in this.attached){var I=this.attached[v];I.getClassName()===w&&(I.detachControl(),I.camera=null,delete this.attached[v],this.rebuildInputCheck())}},w.prototype._addCheckInputs=function(w){var v=this.checkInputs;return function(){v(),w()}},w.prototype.attachInput=function(w){this.attachedToElement&&w.attachControl(this.noPreventDefault)},w.prototype.attachElement=function(w){if(void 0===w&&(w=!1),!this.attachedToElement)for(var v in w=!Q.e.ForceAttachControlToAlwaysPreventDefault&&w,this.attachedToElement=!0,this.noPreventDefault=w,this.attached)this.attached[v].attachControl(w)},w.prototype.detachElement=function(w){for(var v in void 0===w&&(w=!1),this.attached)this.attached[v].detachControl(),w&&(this.attached[v].camera=null);this.attachedToElement=!1},w.prototype.rebuildInputCheck=function(){for(var w in this.checkInputs=function(){},this.attached){var v=this.attached[w];v.checkInputs&&(this.checkInputs=this._addCheckInputs(v.checkInputs.bind(v)))}},w.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},w.prototype.serialize=function(w){var v={};for(var I in this.attached){var P=this.attached[I],Q=u.e.Serialize(P);v[P.getClassName()]=Q}w.inputsmgr=v},w.prototype.parse=function(w){var v=w.inputsmgr;if(v){this.clear();var I=function(w){var I=K[w];if(I){var Q=v[w],a=u.e.Parse((function(){return new I}),Q,null);P.add(a)}},P=this;for(var Q in v)I(Q)}else{var a=function(v){var I=K[U.attached[v].getClassName()];if(I){var P=u.e.Parse((function(){return new I}),w,null);U.remove(U.attached[v]),U.add(P)}},U=this;for(var Q in this.attached)a(Q)}},w}()},35958:function(w,v,I){"use strict";I.d(v,{e:function(){return z}});var P=I(78502),u=I(9892),Q=I(80105),K=I(90690),a=I(2517),U=I(49815),p=I(45591),r=I(9217),Y=function(){function w(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this._keys=new Array}return w.prototype.attachControl=function(w){var v=this;w=r.i.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){v._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(I){var P,u=I.event;u.metaKey||(I.type===p.d.KEYDOWN?-1===v.keysUp.indexOf(u.keyCode)&&-1===v.keysDown.indexOf(u.keyCode)&&-1===v.keysLeft.indexOf(u.keyCode)&&-1===v.keysRight.indexOf(u.keyCode)&&-1===v.keysUpward.indexOf(u.keyCode)&&-1===v.keysDownward.indexOf(u.keyCode)&&-1===v.keysRotateLeft.indexOf(u.keyCode)&&-1===v.keysRotateRight.indexOf(u.keyCode)||(-1===(P=v._keys.indexOf(u.keyCode))&&v._keys.push(u.keyCode),w||u.preventDefault()):-1===v.keysUp.indexOf(u.keyCode)&&-1===v.keysDown.indexOf(u.keyCode)&&-1===v.keysLeft.indexOf(u.keyCode)&&-1===v.keysRight.indexOf(u.keyCode)&&-1===v.keysUpward.indexOf(u.keyCode)&&-1===v.keysDownward.indexOf(u.keyCode)&&-1===v.keysRotateLeft.indexOf(u.keyCode)&&-1===v.keysRotateRight.indexOf(u.keyCode)||((P=v._keys.indexOf(u.keyCode))>=0&&v._keys.splice(P,1),w||u.preventDefault()))})))},w.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},w.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var w=this.camera,v=0;v<this._keys.length;v++){var I=this._keys[v],P=w._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(I)?w._localDirection.copyFromFloats(-P,0,0):-1!==this.keysUp.indexOf(I)?w._localDirection.copyFromFloats(0,0,P):-1!==this.keysRight.indexOf(I)?w._localDirection.copyFromFloats(P,0,0):-1!==this.keysDown.indexOf(I)?w._localDirection.copyFromFloats(0,0,-P):-1!==this.keysUpward.indexOf(I)?w._localDirection.copyFromFloats(0,P,0):-1!==this.keysDownward.indexOf(I)?w._localDirection.copyFromFloats(0,-P,0):-1!==this.keysRotateLeft.indexOf(I)?(w._localDirection.copyFromFloats(0,0,0),w.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(I)&&(w._localDirection.copyFromFloats(0,0,0),w.cameraRotation.y+=this._getLocalRotation()),w.getScene().useRightHandedSystem&&(w._localDirection.z*=-1),w.getViewMatrix().invertToRef(w._cameraTransformMatrix),Q.l.TransformNormalToRef(w._localDirection,w._cameraTransformMatrix,w._transformedDirection),w.cameraDirection.addInPlace(w._transformedDirection)}},w.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},w.prototype._onLostFocus=function(){this._keys=[]},w.prototype.getSimpleName=function(){return"keyboard"},w.prototype._getLocalRotation=function(){var w=this.rotationSpeed*this._engine.getDeltaTime()/1e3;return this.camera.getScene().useRightHandedSystem&&(w*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(w*=-1),w},(0,P.i)([(0,u.J)()],w.prototype,"keysUp",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysUpward",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysDown",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysDownward",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysLeft",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysRight",void 0),(0,P.i)([(0,u.J)()],w.prototype,"rotationSpeed",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysRotateLeft",void 0),(0,P.i)([(0,u.J)()],w.prototype,"keysRotateRight",void 0),w}();U.b.FreeCameraKeyboardMoveInput=Y;var g=I(9271),J=I(25239),l=function(){function w(w){void 0===w&&(w=!0),this.touchEnabled=w,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new g.c,this._allowCameraRotation=!0,this._currentActiveButton=-1}return w.prototype.attachControl=function(w){var v=this;w=r.i.BackCompatCameraNoPreventDefault(arguments);var I=this.camera.getEngine(),P=I.getInputElement();this._pointerInput||(this._pointerInput=function(u){var Q=u.event,K="touch"===Q.pointerType;if(!I.isInVRExclusivePointerMode&&(v.touchEnabled||!K)&&(u.type===J.e.POINTERMOVE||-1!==v.buttons.indexOf(Q.button))){var a=Q.srcElement||Q.target;if(u.type!==J.e.POINTERDOWN||-1!==v._currentActiveButton&&!K)if(u.type!==J.e.POINTERUP||v._currentActiveButton!==Q.button&&!K){if(u.type===J.e.POINTERMOVE)if(I.isPointerLock&&v._onMouseMove)v._onMouseMove(u.event);else if(v._previousPosition){var U=Q.clientX-v._previousPosition.x,p=Q.clientY-v._previousPosition.y;v.camera.getScene().useRightHandedSystem&&(U*=-1),v.camera.parent&&v.camera.parent._getWorldMatrixDeterminant()<0&&(U*=-1),v._allowCameraRotation&&(v.camera.cameraRotation.y+=U/v.angularSensibility,v.camera.cameraRotation.x+=p/v.angularSensibility),v.onPointerMovedObservable.notifyObservers({offsetX:U,offsetY:p}),v._previousPosition={x:Q.clientX,y:Q.clientY},w||Q.preventDefault()}}else{try{null===a||void 0===a||a.releasePointerCapture(Q.pointerId)}catch(w){}v._currentActiveButton=-1,v._previousPosition=null,w||Q.preventDefault()}else{try{null===a||void 0===a||a.setPointerCapture(Q.pointerId)}catch(w){}-1===v._currentActiveButton&&(v._currentActiveButton=Q.button),v._previousPosition={x:Q.clientX,y:Q.clientY},w||(Q.preventDefault(),P&&P.focus()),I.isPointerLock&&v._onMouseMove&&v._onMouseMove(u.event)}}}),this._onMouseMove=function(P){if(I.isPointerLock&&!I.isInVRExclusivePointerMode){var u=P.movementX||P.mozMovementX||P.webkitMovementX||P.msMovementX||0;v.camera.getScene().useRightHandedSystem&&(u*=-1),v.camera.parent&&v.camera.parent._getWorldMatrixDeterminant()<0&&(u*=-1),v.camera.cameraRotation.y+=u/v.angularSensibility;var Q=P.movementY||P.mozMovementY||P.webkitMovementY||P.msMovementY||0;v.camera.cameraRotation.x+=Q/v.angularSensibility,v._previousPosition=null,w||P.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,J.e.POINTERDOWN|J.e.POINTERUP|J.e.POINTERMOVE),P&&(this._contextMenuBind=this.onContextMenu.bind(this),P.addEventListener("contextmenu",this._contextMenuBind,!1))},w.prototype.onContextMenu=function(w){w.preventDefault()},w.prototype.detachControl=function(){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._contextMenuBind){var w=this.camera.getEngine().getInputElement();w&&w.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._currentActiveButton=-1},w.prototype.getClassName=function(){return"FreeCameraMouseInput"},w.prototype.getSimpleName=function(){return"mouse"},(0,P.i)([(0,u.J)()],w.prototype,"buttons",void 0),(0,P.i)([(0,u.J)()],w.prototype,"angularSensibility",void 0),w}();U.b.FreeCameraMouseInput=l;var R,x=I(13316),j=function(){function w(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new g.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return w.prototype.attachControl=function(w){var v=this;this._wheel=function(w){if(w.type===J.e.POINTERWHEEL){var I=w.event,P=I.deltaMode===x.b.DOM_DELTA_LINE?v._ffMultiplier:1;void 0!==I.deltaY?(v._wheelDeltaX+=v.wheelPrecisionX*P*I.deltaX/v._normalize,v._wheelDeltaY-=v.wheelPrecisionY*P*I.deltaY/v._normalize,v._wheelDeltaZ+=v.wheelPrecisionZ*P*I.deltaZ/v._normalize):void 0!==I.wheelDeltaY?(v._wheelDeltaX+=v.wheelPrecisionX*P*I.wheelDeltaX/v._normalize,v._wheelDeltaY-=v.wheelPrecisionY*P*I.wheelDeltaY/v._normalize,v._wheelDeltaZ+=v.wheelPrecisionZ*P*I.wheelDeltaZ/v._normalize):I.wheelDelta&&(v._wheelDeltaY-=v.wheelPrecisionY*I.wheelDelta/v._normalize)}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,J.e.POINTERWHEEL)},w.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},w.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},w.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},w.prototype.getSimpleName=function(){return"mousewheel"},(0,P.i)([(0,u.J)()],w.prototype,"wheelPrecisionX",void 0),(0,P.i)([(0,u.J)()],w.prototype,"wheelPrecisionY",void 0),(0,P.i)([(0,u.J)()],w.prototype,"wheelPrecisionZ",void 0),w}(),s=I(54044);!function(w){w[w.MoveRelative=0]="MoveRelative",w[w.RotateRelative=1]="RotateRelative",w[w.MoveScene=2]="MoveScene"}(R||(R={}));var B=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v._moveRelative=Q.l.Zero(),v._rotateRelative=Q.l.Zero(),v._moveScene=Q.l.Zero(),v._wheelXAction=R.MoveRelative,v._wheelXActionCoordinate=s.g.X,v._wheelYAction=R.MoveRelative,v._wheelYActionCoordinate=s.g.Z,v._wheelZAction=null,v._wheelZActionCoordinate=null,v}return(0,P.m)(v,w),v.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(v.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==R.MoveRelative?null:this._wheelXActionCoordinate},set:function(w){null===w&&this._wheelXAction!==R.MoveRelative||(this._wheelXAction=R.MoveRelative,this._wheelXActionCoordinate=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==R.MoveRelative?null:this._wheelYActionCoordinate},set:function(w){null===w&&this._wheelYAction!==R.MoveRelative||(this._wheelYAction=R.MoveRelative,this._wheelYActionCoordinate=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==R.MoveRelative?null:this._wheelZActionCoordinate},set:function(w){null===w&&this._wheelZAction!==R.MoveRelative||(this._wheelZAction=R.MoveRelative,this._wheelZActionCoordinate=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==R.RotateRelative?null:this._wheelXActionCoordinate},set:function(w){null===w&&this._wheelXAction!==R.RotateRelative||(this._wheelXAction=R.RotateRelative,this._wheelXActionCoordinate=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==R.RotateRelative?null:this._wheelYActionCoordinate},set:function(w){null===w&&this._wheelYAction!==R.RotateRelative||(this._wheelYAction=R.RotateRelative,this._wheelYActionCoordinate=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==R.RotateRelative?null:this._wheelZActionCoordinate},set:function(w){null===w&&this._wheelZAction!==R.RotateRelative||(this._wheelZAction=R.RotateRelative,this._wheelZActionCoordinate=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==R.MoveScene?null:this._wheelXActionCoordinate},set:function(w){null===w&&this._wheelXAction!==R.MoveScene||(this._wheelXAction=R.MoveScene,this._wheelXActionCoordinate=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==R.MoveScene?null:this._wheelYActionCoordinate},set:function(w){null===w&&this._wheelYAction!==R.MoveScene||(this._wheelYAction=R.MoveScene,this._wheelYActionCoordinate=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==R.MoveScene?null:this._wheelZActionCoordinate},set:function(w){null===w&&this._wheelZAction!==R.MoveScene||(this._wheelZAction=R.MoveScene,this._wheelZActionCoordinate=w)},enumerable:!1,configurable:!0}),v.prototype.checkInputs=function(){if(0!==this._wheelDeltaX||0!==this._wheelDeltaY||0!=this._wheelDeltaZ){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var v=Q.e.Zero();this.camera.getViewMatrix().invertToRef(v);var I=Q.l.Zero();Q.l.TransformNormalToRef(this._moveRelative,v,I),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(I),this.camera.cameraDirection.addInPlace(this._moveScene),w.prototype.checkInputs.call(this)}},v.prototype._updateCamera=function(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},v.prototype._updateCameraProperty=function(w,v,I){if(0!==w&&null!==v&&null!==I){var P=null;switch(v){case R.MoveRelative:P=this._moveRelative;break;case R.RotateRelative:P=this._rotateRelative;break;case R.MoveScene:P=this._moveScene}switch(I){case s.g.X:P.set(w,0,0);break;case s.g.Y:P.set(0,w,0);break;case s.g.Z:P.set(0,0,w)}}},(0,P.i)([(0,u.J)()],v.prototype,"wheelXMoveRelative",null),(0,P.i)([(0,u.J)()],v.prototype,"wheelYMoveRelative",null),(0,P.i)([(0,u.J)()],v.prototype,"wheelZMoveRelative",null),(0,P.i)([(0,u.J)()],v.prototype,"wheelXRotateRelative",null),(0,P.i)([(0,u.J)()],v.prototype,"wheelYRotateRelative",null),(0,P.i)([(0,u.J)()],v.prototype,"wheelZRotateRelative",null),(0,P.i)([(0,u.J)()],v.prototype,"wheelXMoveScene",null),(0,P.i)([(0,u.J)()],v.prototype,"wheelYMoveScene",null),(0,P.i)([(0,u.J)()],v.prototype,"wheelZMoveScene",null),v}(j);U.b.FreeCameraMouseWheelInput=B;var t=function(){function w(w){void 0===w&&(w=!1),this.allowMouse=w,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=r.i.IsSafari()}return w.prototype.attachControl=function(w){var v=this;w=r.i.BackCompatCameraNoPreventDefault(arguments);var I=null;if(void 0===this._pointerInput&&(this._onLostFocus=function(){v._offsetX=null,v._offsetY=null},this._pointerInput=function(P){var u=P.event,Q="mouse"===u.pointerType||v._isSafari&&"undefined"===typeof u.pointerType;if(v.allowMouse||!Q)if(P.type===J.e.POINTERDOWN){if(w||u.preventDefault(),v._pointerPressed.push(u.pointerId),1!==v._pointerPressed.length)return;I={x:u.clientX,y:u.clientY}}else if(P.type===J.e.POINTERUP){if(w||u.preventDefault(),-1===(K=v._pointerPressed.indexOf(u.pointerId)))return;if(v._pointerPressed.splice(K,1),0!=K)return;I=null,v._offsetX=null,v._offsetY=null}else if(P.type===J.e.POINTERMOVE){if(w||u.preventDefault(),!I)return;var K;if(0!=(K=v._pointerPressed.indexOf(u.pointerId)))return;v._offsetX=u.clientX-I.x,v._offsetY=-(u.clientY-I.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,J.e.POINTERDOWN|J.e.POINTERUP|J.e.POINTERMOVE),this._onLostFocus){var P=this.camera.getEngine(),u=P.getInputElement();u&&u.addEventListener("blur",this._onLostFocus)}},w.prototype.detachControl=function(){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var w=this.camera.getEngine().getInputElement();w&&w.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed=[],this._offsetX=null,this._offsetY=null}},w.prototype.checkInputs=function(){if(null!==this._offsetX&&null!==this._offsetY&&(0!==this._offsetX||0!==this._offsetY)){var w=this.camera;if(w.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)w.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var v=w._computeLocalCameraSpeed(),I=new Q.l(0,0,0!==this.touchMoveSensibility?v*this._offsetY/this.touchMoveSensibility:0);Q.e.RotationYawPitchRollToRef(w.rotation.y,w.rotation.x,0,w._cameraRotationMatrix),w.cameraDirection.addInPlace(Q.l.TransformCoordinates(I,w._cameraRotationMatrix))}}},w.prototype.getClassName=function(){return"FreeCameraTouchInput"},w.prototype.getSimpleName=function(){return"touch"},(0,P.i)([(0,u.J)()],w.prototype,"touchAngularSensibility",void 0),(0,P.i)([(0,u.J)()],w.prototype,"touchMoveSensibility",void 0),w}();U.b.FreeCameraTouchInput=t;var i=function(w){function v(v){var I=w.call(this,v)||this;return I._mouseInput=null,I._mouseWheelInput=null,I}return(0,P.m)(v,w),v.prototype.addKeyboard=function(){return this.add(new Y),this},v.prototype.addMouse=function(w){return void 0===w&&(w=!0),this._mouseInput||(this._mouseInput=new l(w),this.add(this._mouseInput)),this},v.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},v.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new B,this.add(this._mouseWheelInput)),this},v.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},v.prototype.addTouch=function(){return this.add(new t),this},v.prototype.clear=function(){w.prototype.clear.call(this),this._mouseInput=null},v}(U.c),z=function(w){function v(v,I,P,u){void 0===u&&(u=!0);var a=w.call(this,v,I,P,u)||this;return a.ellipsoid=new Q.l(.5,1,.5),a.ellipsoidOffset=new Q.l(0,0,0),a.checkCollisions=!1,a.applyGravity=!1,a._needMoveForGravity=!1,a._oldPosition=Q.l.Zero(),a._diffPosition=Q.l.Zero(),a._newPosition=Q.l.Zero(),a._collisionMask=-1,a._onCollisionPositionChange=function(w,v,I){void 0===I&&(I=null);var P;P=v,a._newPosition.copyFrom(P),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>K.d.CollisionsEpsilon&&(a.position.addInPlace(a._diffPosition),a.onCollide&&I&&a.onCollide(I))},a.inputs=new i(a),a.inputs.addKeyboard().addMouse(),a}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"angularSensibility",{get:function(){var w=this.inputs.attached.mouse;return w?w.angularSensibility:0},set:function(w){var v=this.inputs.attached.mouse;v&&(v.angularSensibility=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysUp",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysUp:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysUp=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysUpward",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysUpward:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysUpward=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysDown",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysDown:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysDown=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysDownward",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysDownward:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysDownward=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysLeft",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysLeft:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysLeft=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysRight",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysRight:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysRight=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysRotateLeft",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysRotateLeft:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysRotateLeft=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"keysRotateRight",{get:function(){var w=this.inputs.attached.keyboard;return w?w.keysRotateRight:[]},set:function(w){var v=this.inputs.attached.keyboard;v&&(v.keysRotateRight=w)},enumerable:!1,configurable:!0}),v.prototype.attachControl=function(w,v){v=r.i.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(v)},v.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new Q.l(0,0,0),this.cameraRotation=new Q.k(0,0)},Object.defineProperty(v.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(w){this._collisionMask=isNaN(w)?-1:w},enumerable:!1,configurable:!0}),v.prototype._collideWithWorld=function(w){(this.parent?Q.l.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var v=this.getScene().collisionCoordinator;this._collider||(this._collider=v.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var I=w;this.applyGravity&&(I=w.add(this.getScene().gravity)),v.getNewPosition(this._oldPosition,I,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},v.prototype._checkInputs=function(){this._localDirection||(this._localDirection=Q.l.Zero(),this._transformedDirection=Q.l.Zero()),this.inputs.checkInputs(),w.prototype._checkInputs.call(this)},v.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},v.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):w.prototype._updatePosition.call(this)},v.prototype.dispose=function(){this.inputs.clear(),w.prototype.dispose.call(this)},v.prototype.getClassName=function(){return"FreeCamera"},(0,P.i)([(0,u.G)()],v.prototype,"ellipsoid",void 0),(0,P.i)([(0,u.G)()],v.prototype,"ellipsoidOffset",void 0),(0,P.i)([(0,u.J)()],v.prototype,"checkCollisions",void 0),(0,P.i)([(0,u.J)()],v.prototype,"applyGravity",void 0),v}(a.c)},2517:function(w,v,I){"use strict";I.d(v,{c:function(){return p}});var P=I(78502),u=I(9892),Q=I(37643),K=I(80105),a=I(61686),U=I(54044),p=function(w){function v(v,I,P,u){void 0===u&&(u=!0);var Q=w.call(this,v,I,P,u)||this;return Q._tmpUpVector=K.l.Zero(),Q._tmpTargetVector=K.l.Zero(),Q.cameraDirection=new K.l(0,0,0),Q.cameraRotation=new K.k(0,0),Q.ignoreParentScaling=!1,Q.updateUpVectorFromRotation=!1,Q._tmpQuaternion=new K.f,Q.rotation=new K.l(0,0,0),Q.speed=2,Q.noRotationConstraint=!1,Q.invertRotation=!1,Q.inverseRotationSpeed=.2,Q.lockedTarget=null,Q._currentTarget=K.l.Zero(),Q._initialFocalDistance=1,Q._viewMatrix=K.e.Zero(),Q._camMatrix=K.e.Zero(),Q._cameraTransformMatrix=K.e.Zero(),Q._cameraRotationMatrix=K.e.Zero(),Q._referencePoint=new K.l(0,0,1),Q._transformedReferencePoint=K.l.Zero(),Q._defaultUp=K.l.Up(),Q._cachedRotationZ=0,Q._cachedQuaternionRotationZ=0,Q}return(0,P.m)(v,w),v.prototype.getFrontPosition=function(w){this.getWorldMatrix();var v=this.getTarget().subtract(this.position);return v.normalize(),v.scaleInPlace(w),this.globalPosition.add(v)},v.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},v.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),w.prototype.storeState.call(this)},v.prototype._restoreStateValues=function(){return!!w.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},v.prototype._initCache=function(){w.prototype._initCache.call(this),this._cache.lockedTarget=new K.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new K.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new K.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},v.prototype._updateCache=function(v){v||w.prototype._updateCache.call(this);var I=this._getLockedTargetPosition();I?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(I):this._cache.lockedTarget=I.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},v.prototype._isSynchronizedViewMatrix=function(){if(!w.prototype._isSynchronizedViewMatrix.call(this))return!1;var v=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(v):!v)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},v.prototype._computeLocalCameraSpeed=function(){var w=this.getEngine();return this.speed*Math.sqrt(w.getDeltaTime()/(100*w.getFps()))},v.prototype.setTarget=function(w){this.upVector.normalize(),this._initialFocalDistance=w.subtract(this.position).length(),this.position.z===w.z&&(this.position.z+=a.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),K.e.LookAtLHToRef(this.position,w,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var v=w.subtract(this.position);v.x>=0?this.rotation.y=-Math.atan(v.z/v.x)+Math.PI/2:this.rotation.y=-Math.atan(v.z/v.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&K.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(v.prototype,"target",{get:function(){return this.getTarget()},set:function(w){this.setTarget(w)},enumerable:!1,configurable:!0}),v.prototype.getTarget=function(){return this._currentTarget},v.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},v.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(K.i.Matrix[0]),K.l.TransformNormalToRef(this.cameraDirection,K.i.Matrix[0],K.i.Vector3[0]),void this.position.addInPlace(K.i.Vector3[0]);this.position.addInPlace(this.cameraDirection)},v.prototype._checkInputs=function(){var v=this.invertRotation?-this.inverseRotationSpeed:1,I=this._decideIfNeedsToMove(),P=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(I&&this._updatePosition(),P){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*v,this.rotation.y+=this.cameraRotation.y*v,!this.noRotationConstraint){var u=1.570796;this.rotation.x>u&&(this.rotation.x=u),this.rotation.x<-u&&(this.rotation.x=-u)}if(this.rotationQuaternion)this.rotation.lengthSquared()&&K.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}I&&(Math.abs(this.cameraDirection.x)<this.speed*a.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*a.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*a.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),P&&(Math.abs(this.cameraRotation.x)<this.speed*a.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*a.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),w.prototype._checkInputs.call(this)},v.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):K.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},v.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return K.l.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},v.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),K.l.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?U.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(K.f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),U.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},v.prototype._computeViewMatrix=function(w,v,I){if(this.ignoreParentScaling){if(this.parent){var P=this.parent.getWorldMatrix();K.l.TransformCoordinatesToRef(w,P,this._globalPosition),K.l.TransformCoordinatesToRef(v,P,this._tmpTargetVector),K.l.TransformNormalToRef(I,P,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(w),this._tmpTargetVector.copyFrom(v),this._tmpUpVector.copyFrom(I);this.getScene().useRightHandedSystem?K.e.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):K.e.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?K.e.LookAtRHToRef(w,v,I,this._viewMatrix):K.e.LookAtLHToRef(w,v,I,this._viewMatrix),this.parent){P=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(P,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(w)},v.prototype.createRigCamera=function(w,I){if(this.cameraRigMode!==Q.e.RIG_MODE_NONE){var P=new v(w,this.position.clone(),this.getScene());return P.isRigCamera=!0,P.rigParent=this,this.cameraRigMode!==Q.e.RIG_MODE_VR&&this.cameraRigMode!==Q.e.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new K.f),P._cameraRigParams={},P.rotationQuaternion=new K.f),P}return null},v.prototype._updateRigCameras=function(){var v=this._rigCameras[0],I=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Q.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Q.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Q.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Q.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Q.e.RIG_MODE_STEREOSCOPIC_INTERLACED:var P=this.cameraRigMode===Q.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,u=this.cameraRigMode===Q.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*P,v),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*u,I);break;case Q.e.RIG_MODE_VR:v.rotationQuaternion?(v.rotationQuaternion.copyFrom(this.rotationQuaternion),I.rotationQuaternion.copyFrom(this.rotationQuaternion)):(v.rotation.copyFrom(this.rotation),I.rotation.copyFrom(this.rotation)),v.position.copyFrom(this.position),I.position.copyFrom(this.position)}w.prototype._updateRigCameras.call(this)},v.prototype._getRigCamPositionAndTarget=function(w,I){this.getTarget().subtractToRef(this.position,v._TargetFocalPoint),v._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var P=v._TargetFocalPoint.addInPlace(this.position);K.e.TranslationToRef(-P.x,-P.y,-P.z,v._TargetTransformMatrix),v._TargetTransformMatrix.multiplyToRef(K.e.RotationAxis(I.upVector,w),v._RigCamTransformMatrix),K.e.TranslationToRef(P.x,P.y,P.z,v._TargetTransformMatrix),v._RigCamTransformMatrix.multiplyToRef(v._TargetTransformMatrix,v._RigCamTransformMatrix),K.l.TransformCoordinatesToRef(this.position,v._RigCamTransformMatrix,I.position),I.setTarget(P)},v.prototype.getClassName=function(){return"TargetCamera"},v._RigCamTransformMatrix=new K.e,v._TargetTransformMatrix=new K.e,v._TargetFocalPoint=new K.l,(0,P.i)([(0,u.G)()],v.prototype,"rotation",void 0),(0,P.i)([(0,u.J)()],v.prototype,"speed",void 0),(0,P.i)([(0,u.w)("lockedTargetId")],v.prototype,"lockedTarget",void 0),v}(Q.e)},16035:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(w,v,I){this.bu=w,this.bv=v,this.distance=I,this.faceId=0,this.subMeshId=0}},44904:function(w,v,I){"use strict";I.d(v,{d:function(){return Q}});var P=I(80105),u=I(43251),Q=function(){function w(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return w.prototype.getNormal=function(w,v){if(void 0===w&&(w=!1),void 0===v&&(v=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(u.f.NormalKind))return null;var I,Q=this.pickedMesh.getIndices();if(!Q)return null;if(v){var K=this.pickedMesh.getVerticesData(u.f.NormalKind),a=P.l.FromArray(K,3*Q[3*this.faceId]),U=P.l.FromArray(K,3*Q[3*this.faceId+1]),p=P.l.FromArray(K,3*Q[3*this.faceId+2]);a=a.scale(this.bu),U=U.scale(this.bv),p=p.scale(1-this.bu-this.bv),I=new P.l(a.x+U.x+p.x,a.y+U.y+p.y,a.z+U.z+p.z)}else{var r=this.pickedMesh.getVerticesData(u.f.PositionKind),Y=P.l.FromArray(r,3*Q[3*this.faceId]),g=P.l.FromArray(r,3*Q[3*this.faceId+1]),J=P.l.FromArray(r,3*Q[3*this.faceId+2]),l=Y.subtract(g),R=J.subtract(g);I=P.l.Cross(l,R)}if(w){var x=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(P.i.Matrix[0].copyFrom(x),(x=P.i.Matrix[0]).setTranslationFromFloats(0,0,0),x.invert(),x.transposeToRef(P.i.Matrix[1]),x=P.i.Matrix[1]),I=P.l.TransformNormal(I,x)}return I.normalize(),I},w.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(u.f.UVKind))return null;var w=this.pickedMesh.getIndices();if(!w)return null;var v=this.pickedMesh.getVerticesData(u.f.UVKind);if(!v)return null;var I=P.k.FromArray(v,2*w[3*this.faceId]),Q=P.k.FromArray(v,2*w[3*this.faceId+1]),K=P.k.FromArray(v,2*w[3*this.faceId+2]);return I=I.scale(this.bu),Q=Q.scale(this.bv),K=K.scale(1-this.bu-this.bv),new P.k(I.x+Q.x+K.x,I.y+Q.y+K.y)},w}()},20334:function(w,v,I){"use strict";I.d(v,{e:function(){return P}});var P=function(){function w(){}return w.UseOpenGLOrientationForUV=!1,w}()},86724:function(w,v,I){"use strict";I.d(v,{e:function(){return K}});var P=I(89214),u=I(80105),Q=I(61686),K=function(){function w(w,v,I){this.vectors=P.c.BuildArray(8,u.l.Zero),this.center=u.l.Zero(),this.centerWorld=u.l.Zero(),this.extendSize=u.l.Zero(),this.extendSizeWorld=u.l.Zero(),this.directions=P.c.BuildArray(3,u.l.Zero),this.vectorsWorld=P.c.BuildArray(8,u.l.Zero),this.minimumWorld=u.l.Zero(),this.maximumWorld=u.l.Zero(),this.minimum=u.l.Zero(),this.maximum=u.l.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(w,v,I)}return w.prototype.reConstruct=function(w,v,I){var P=w.x,Q=w.y,K=w.z,a=v.x,U=v.y,p=v.z,r=this.vectors;this.minimum.copyFromFloats(P,Q,K),this.maximum.copyFromFloats(a,U,p),r[0].copyFromFloats(P,Q,K),r[1].copyFromFloats(a,U,p),r[2].copyFromFloats(a,Q,K),r[3].copyFromFloats(P,U,K),r[4].copyFromFloats(P,Q,p),r[5].copyFromFloats(a,U,K),r[6].copyFromFloats(P,U,p),r[7].copyFromFloats(a,Q,p),v.addToRef(w,this.center).scaleInPlace(.5),v.subtractToRef(w,this.extendSize).scaleInPlace(.5),this._worldMatrix=I||u.e.IdentityReadOnly,this._update(this._worldMatrix)},w.prototype.scale=function(v){var I=w._TmpVector3,P=this.maximum.subtractToRef(this.minimum,I[0]),u=P.length();P.normalizeFromLength(u);var Q=u*v,K=P.scaleInPlace(.5*Q),a=this.center.subtractToRef(K,I[1]),U=this.center.addToRef(K,I[2]);return this.reConstruct(a,U,this._worldMatrix),this},w.prototype.getWorldMatrix=function(){return this._worldMatrix},w.prototype._update=function(w){var v=this.minimumWorld,I=this.maximumWorld,P=this.directions,Q=this.vectorsWorld,K=this.vectors;if(w.isIdentity()){v.copyFrom(this.minimum),I.copyFrom(this.maximum);for(a=0;a<8;++a)Q[a].copyFrom(K[a]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{v.setAll(Number.MAX_VALUE),I.setAll(-Number.MAX_VALUE);for(var a=0;a<8;++a){var U=Q[a];u.l.TransformCoordinatesToRef(K[a],w,U),v.minimizeInPlace(U),I.maximizeInPlace(U)}I.subtractToRef(v,this.extendSizeWorld).scaleInPlace(.5),I.addToRef(v,this.centerWorld).scaleInPlace(.5)}u.l.FromArrayToRef(w.m,0,P[0]),u.l.FromArrayToRef(w.m,4,P[1]),u.l.FromArrayToRef(w.m,8,P[2]),this._worldMatrix=w},w.prototype.isInFrustum=function(v){return w.IsInFrustum(this.vectorsWorld,v)},w.prototype.isCompletelyInFrustum=function(v){return w.IsCompletelyInFrustum(this.vectorsWorld,v)},w.prototype.intersectsPoint=function(w){var v=this.minimumWorld,I=this.maximumWorld,P=v.x,u=v.y,K=v.z,a=I.x,U=I.y,p=I.z,r=w.x,Y=w.y,g=w.z,J=-Q.e;return!(a-r<J||J>r-P)&&(!(U-Y<J||J>Y-u)&&!(p-g<J||J>g-K))},w.prototype.intersectsSphere=function(v){return w.IntersectsSphere(this.minimumWorld,this.maximumWorld,v.centerWorld,v.radiusWorld)},w.prototype.intersectsMinMax=function(w,v){var I=this.minimumWorld,P=this.maximumWorld,u=I.x,Q=I.y,K=I.z,a=P.x,U=P.y,p=P.z,r=w.x,Y=w.y,g=w.z,J=v.x,l=v.y,R=v.z;return!(a<r||u>J)&&(!(U<Y||Q>l)&&!(p<g||K>R))},w.prototype.dispose=function(){var w,v;null===(w=this._drawWrapperFront)||void 0===w||w.dispose(),null===(v=this._drawWrapperBack)||void 0===v||v.dispose()},w.Intersects=function(w,v){return w.intersectsMinMax(v.minimumWorld,v.maximumWorld)},w.IntersectsSphere=function(v,I,P,Q){var K=w._TmpVector3[0];return u.l.ClampToRef(P,v,I,K),u.l.DistanceSquared(P,K)<=Q*Q},w.IsCompletelyInFrustum=function(w,v){for(var I=0;I<6;++I)for(var P=v[I],u=0;u<8;++u)if(P.dotCoordinate(w[u])<0)return!1;return!0},w.IsInFrustum=function(w,v){for(var I=0;I<6;++I){for(var P=!0,u=v[I],Q=0;Q<8;++Q)if(u.dotCoordinate(w[Q])>=0){P=!1;break}if(P)return!1}return!0},w._TmpVector3=P.c.BuildArray(3,u.l.Zero),w}()},97918:function(w,v,I){"use strict";I.d(v,{e:function(){return Y}});var P=I(89214),u=I(80105),Q=I(86724),K=I(70176),a={min:0,max:0},U={min:0,max:0},p=function(w,v,I){var P=u.l.Dot(v.centerWorld,w),Q=Math.abs(u.l.Dot(v.directions[0],w))*v.extendSize.x+Math.abs(u.l.Dot(v.directions[1],w))*v.extendSize.y+Math.abs(u.l.Dot(v.directions[2],w))*v.extendSize.z;I.min=P-Q,I.max=P+Q},r=function(w,v,I){return p(w,v,a),p(w,I,U),!(a.min>U.max||U.min>a.max)},Y=function(){function w(w,v,I){this._isLocked=!1,this.boundingBox=new Q.e(w,v,I),this.boundingSphere=new K.d(w,v,I)}return w.prototype.reConstruct=function(w,v,I){this.boundingBox.reConstruct(w,v,I),this.boundingSphere.reConstruct(w,v,I)},Object.defineProperty(w.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isLocked",{get:function(){return this._isLocked},set:function(w){this._isLocked=w},enumerable:!1,configurable:!0}),w.prototype.update=function(w){this._isLocked||(this.boundingBox._update(w),this.boundingSphere._update(w))},w.prototype.centerOn=function(v,I){var P=w._TmpVector3[0].copyFrom(v).subtractInPlace(I),u=w._TmpVector3[1].copyFrom(v).addInPlace(I);return this.boundingBox.reConstruct(P,u,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(P,u,this.boundingBox.getWorldMatrix()),this},w.prototype.encapsulate=function(w){var v=u.l.Minimize(this.minimum,w),I=u.l.Maximize(this.maximum,w);return this.reConstruct(v,I,this.boundingBox.getWorldMatrix()),this},w.prototype.encapsulateBoundingInfo=function(w){return this.encapsulate(w.boundingBox.centerWorld.subtract(w.boundingBox.extendSizeWorld)),this.encapsulate(w.boundingBox.centerWorld.add(w.boundingBox.extendSizeWorld)),this},w.prototype.scale=function(w){return this.boundingBox.scale(w),this.boundingSphere.scale(w),this},w.prototype.isInFrustum=function(w,v){return void 0===v&&(v=0),!(2!==v&&3!==v||!this.boundingSphere.isCenterInFrustum(w))||!!this.boundingSphere.isInFrustum(w)&&(!(1!==v&&3!==v)||this.boundingBox.isInFrustum(w))},Object.defineProperty(w.prototype,"diagonalLength",{get:function(){var v=this.boundingBox;return v.maximumWorld.subtractToRef(v.minimumWorld,w._TmpVector3[0]).length()},enumerable:!1,configurable:!0}),w.prototype.isCompletelyInFrustum=function(w){return this.boundingBox.isCompletelyInFrustum(w)},w.prototype._checkCollision=function(w){return w._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},w.prototype.intersectsPoint=function(w){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(w)&&!!this.boundingBox.intersectsPoint(w))},w.prototype.intersects=function(w,v){if(!K.d.Intersects(this.boundingSphere,w.boundingSphere))return!1;if(!Q.e.Intersects(this.boundingBox,w.boundingBox))return!1;if(!v)return!0;var I=this.boundingBox,P=w.boundingBox;return!!r(I.directions[0],I,P)&&(!!r(I.directions[1],I,P)&&(!!r(I.directions[2],I,P)&&(!!r(P.directions[0],I,P)&&(!!r(P.directions[1],I,P)&&(!!r(P.directions[2],I,P)&&(!!r(u.l.Cross(I.directions[0],P.directions[0]),I,P)&&(!!r(u.l.Cross(I.directions[0],P.directions[1]),I,P)&&(!!r(u.l.Cross(I.directions[0],P.directions[2]),I,P)&&(!!r(u.l.Cross(I.directions[1],P.directions[0]),I,P)&&(!!r(u.l.Cross(I.directions[1],P.directions[1]),I,P)&&(!!r(u.l.Cross(I.directions[1],P.directions[2]),I,P)&&(!!r(u.l.Cross(I.directions[2],P.directions[0]),I,P)&&(!!r(u.l.Cross(I.directions[2],P.directions[1]),I,P)&&!!r(u.l.Cross(I.directions[2],P.directions[2]),I,P))))))))))))))},w._TmpVector3=P.c.BuildArray(2,u.l.Zero),w}()},70176:function(w,v,I){"use strict";I.d(v,{d:function(){return Q}});var P=I(89214),u=I(80105),Q=function(){function w(w,v,I){this.center=u.l.Zero(),this.centerWorld=u.l.Zero(),this.minimum=u.l.Zero(),this.maximum=u.l.Zero(),this.reConstruct(w,v,I)}return w.prototype.reConstruct=function(w,v,I){this.minimum.copyFrom(w),this.maximum.copyFrom(v);var P=u.l.Distance(w,v);v.addToRef(w,this.center).scaleInPlace(.5),this.radius=.5*P,this._update(I||u.e.IdentityReadOnly)},w.prototype.scale=function(v){var I=this.radius*v,P=w._TmpVector3,u=P[0].setAll(I),Q=this.center.subtractToRef(u,P[1]),K=this.center.addToRef(u,P[2]);return this.reConstruct(Q,K,this._worldMatrix),this},w.prototype.getWorldMatrix=function(){return this._worldMatrix},w.prototype._update=function(v){if(v.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{u.l.TransformCoordinatesToRef(this.center,v,this.centerWorld);var I=w._TmpVector3[0];u.l.TransformNormalFromFloatsToRef(1,1,1,v,I),this.radiusWorld=Math.max(Math.abs(I.x),Math.abs(I.y),Math.abs(I.z))*this.radius}},w.prototype.isInFrustum=function(w){for(var v=this.centerWorld,I=this.radiusWorld,P=0;P<6;P++)if(w[P].dotCoordinate(v)<=-I)return!1;return!0},w.prototype.isCenterInFrustum=function(w){for(var v=this.centerWorld,I=0;I<6;I++)if(w[I].dotCoordinate(v)<0)return!1;return!0},w.prototype.intersectsPoint=function(w){var v=u.l.DistanceSquared(this.centerWorld,w);return!(this.radiusWorld*this.radiusWorld<v)},w.Intersects=function(w,v){var I=u.l.DistanceSquared(w.centerWorld,v.centerWorld),P=w.radiusWorld+v.radiusWorld;return!(P*P<I)},w.CreateFromCenterAndRadius=function(v,I,P){this._TmpVector3[0].copyFrom(v),this._TmpVector3[1].copyFromFloats(0,0,I),this._TmpVector3[2].copyFrom(v),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);var Q=new w(this._TmpVector3[0],this._TmpVector3[2]);return Q._worldMatrix=P||u.e.Identity(),Q},w._TmpVector3=P.c.BuildArray(3,u.l.Zero),w}()},11126:function(w,v,I){"use strict";I.d(v,{d:function(){return r}});var P=I(89214),u=I(80105),Q=I(44904),K=I(16035),a=I(37105),U=I(37643),p=I(78588),r=function(){function w(w,v,I){void 0===I&&(I=Number.MAX_VALUE),this.origin=w,this.direction=v,this.length=I}return w.prototype.clone=function(){return new w(this.origin.clone(),this.direction.clone(),this.length)},w.prototype.intersectsBoxMinMax=function(v,I,P){void 0===P&&(P=0);var u,Q,K,a,U=w._TmpVector3[0].copyFromFloats(v.x-P,v.y-P,v.z-P),p=w._TmpVector3[1].copyFromFloats(I.x+P,I.y+P,I.z+P),r=0,Y=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<U.x||this.origin.x>p.x)return!1}else if(u=1/this.direction.x,Q=(U.x-this.origin.x)*u,(K=(p.x-this.origin.x)*u)===-1/0&&(K=1/0),Q>K&&(a=Q,Q=K,K=a),(r=Math.max(Q,r))>(Y=Math.min(K,Y)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<U.y||this.origin.y>p.y)return!1}else if(u=1/this.direction.y,Q=(U.y-this.origin.y)*u,(K=(p.y-this.origin.y)*u)===-1/0&&(K=1/0),Q>K&&(a=Q,Q=K,K=a),(r=Math.max(Q,r))>(Y=Math.min(K,Y)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<U.z||this.origin.z>p.z)return!1}else if(u=1/this.direction.z,Q=(U.z-this.origin.z)*u,(K=(p.z-this.origin.z)*u)===-1/0&&(K=1/0),Q>K&&(a=Q,Q=K,K=a),(r=Math.max(Q,r))>(Y=Math.min(K,Y)))return!1;return!0},w.prototype.intersectsBox=function(w,v){return void 0===v&&(v=0),this.intersectsBoxMinMax(w.minimum,w.maximum,v)},w.prototype.intersectsSphere=function(w,v){void 0===v&&(v=0);var I=w.center.x-this.origin.x,P=w.center.y-this.origin.y,u=w.center.z-this.origin.z,Q=I*I+P*P+u*u,K=w.radius+v,a=K*K;if(Q<=a)return!0;var U=I*this.direction.x+P*this.direction.y+u*this.direction.z;return!(U<0)&&Q-U*U<=a},w.prototype.intersectsTriangle=function(v,I,P){var Q=w._TmpVector3[0],a=w._TmpVector3[1],U=w._TmpVector3[2],p=w._TmpVector3[3],r=w._TmpVector3[4];I.subtractToRef(v,Q),P.subtractToRef(v,a),u.l.CrossToRef(this.direction,a,U);var Y=u.l.Dot(Q,U);if(0===Y)return null;var g=1/Y;this.origin.subtractToRef(v,p);var J=u.l.Dot(p,U)*g;if(J<0||J>1)return null;u.l.CrossToRef(p,Q,r);var l=u.l.Dot(this.direction,r)*g;if(l<0||J+l>1)return null;var R=u.l.Dot(a,r)*g;return R>this.length?null:new K.c(1-J-l,J,R)},w.prototype.intersectsPlane=function(w){var v,I=u.l.Dot(w.normal,this.direction);if(Math.abs(I)<9.99999997475243e-7)return null;var P=u.l.Dot(w.normal,this.origin);return(v=(-w.d-P)/I)<0?v<-9.99999997475243e-7?null:0:v},w.prototype.intersectsAxis=function(w,v){switch(void 0===v&&(v=0),w){case"y":return(I=(this.origin.y-v)/this.direction.y)>0?null:new u.l(this.origin.x+this.direction.x*-I,v,this.origin.z+this.direction.z*-I);case"x":return(I=(this.origin.x-v)/this.direction.x)>0?null:new u.l(v,this.origin.y+this.direction.y*-I,this.origin.z+this.direction.z*-I);case"z":var I;return(I=(this.origin.z-v)/this.direction.z)>0?null:new u.l(this.origin.x+this.direction.x*-I,this.origin.y+this.direction.y*-I,v);default:return null}},w.prototype.intersectsMesh=function(v,I){var P=u.i.Matrix[0];return v.getWorldMatrix().invertToRef(P),this._tmpRay?w.TransformToRef(this,P,this._tmpRay):this._tmpRay=w.Transform(this,P),v.intersects(this._tmpRay,I)},w.prototype.intersectsMeshes=function(w,v,I){I?I.length=0:I=[];for(var P=0;P<w.length;P++){var u=this.intersectsMesh(w[P],v);u.hit&&I.push(u)}return I.sort(this._comparePickingInfo),I},w.prototype._comparePickingInfo=function(w,v){return w.distance<v.distance?-1:w.distance>v.distance?1:0},w.prototype.intersectionSegment=function(v,I,P){var Q=this.origin,K=u.i.Vector3[0],a=u.i.Vector3[1],U=u.i.Vector3[2],p=u.i.Vector3[3];I.subtractToRef(v,K),this.direction.scaleToRef(w._Rayl,U),Q.addToRef(U,a),v.subtractToRef(Q,p);var r,Y,g=u.l.Dot(K,K),J=u.l.Dot(K,U),l=u.l.Dot(U,U),R=u.l.Dot(K,p),x=u.l.Dot(U,p),j=g*l-J*J,s=j,B=j;j<w._Smallnum?(r=0,s=1,Y=x,B=l):(Y=g*x-J*R,(r=J*x-l*R)<0?(r=0,Y=x,B=l):r>s&&(r=s,Y=x+J,B=l)),Y<0?(Y=0,-R<0?r=0:-R>g?r=s:(r=-R,s=g)):Y>B&&(Y=B,-R+J<0?r=0:-R+J>g?r=s:(r=-R+J,s=g));var t=Math.abs(r)<w._Smallnum?0:r/s,i=Math.abs(Y)<w._Smallnum?0:Y/B,z=u.i.Vector3[4];U.scaleToRef(i,z);var E=u.i.Vector3[5];K.scaleToRef(t,E),E.addInPlace(p);var o=u.i.Vector3[6];return E.subtractToRef(z,o),i>0&&i<=this.length&&o.lengthSquared()<P*P?E.length():-1},w.prototype.update=function(v,I,P,Q,K,a,U,p){if(void 0===p&&(p=!1),p){w._RayDistant||(w._RayDistant=w.Zero()),w._RayDistant.unprojectRayToRef(v,I,P,Q,u.e.IdentityReadOnly,a,U);var r=u.i.Matrix[0];K.invertToRef(r),w.TransformToRef(w._RayDistant,r,this)}else this.unprojectRayToRef(v,I,P,Q,K,a,U);return this},w.Zero=function(){return new w(u.l.Zero(),u.l.Zero())},w.CreateNew=function(v,I,P,u,Q,K,a){return w.Zero().update(v,I,P,u,Q,K,a)},w.CreateNewFromTo=function(v,I,P){void 0===P&&(P=u.e.IdentityReadOnly);var Q=I.subtract(v),K=Math.sqrt(Q.x*Q.x+Q.y*Q.y+Q.z*Q.z);return Q.normalize(),w.Transform(new w(v,Q,K),P)},w.Transform=function(v,I){var P=new w(new u.l(0,0,0),new u.l(0,0,0));return w.TransformToRef(v,I,P),P},w.TransformToRef=function(w,v,I){u.l.TransformCoordinatesToRef(w.origin,v,I.origin),u.l.TransformNormalToRef(w.direction,v,I.direction),I.length=w.length;var P=I.direction,Q=P.length();if(0!==Q&&1!==Q){var K=1/Q;P.x*=K,P.y*=K,P.z*=K,I.length*=Q}},w.prototype.unprojectRayToRef=function(w,v,I,P,Q,K,a){var U,r=u.i.Matrix[0];Q.multiplyToRef(K,r),r.multiplyToRef(a,r),r.invert();var Y=u.i.Vector3[0];Y.x=w/I*2-1,Y.y=-(v/P*2-1),Y.z=(null===(U=p.e.LastCreatedEngine)||void 0===U?void 0:U.isNDCHalfZRange)?0:-1;var g=u.i.Vector3[1].copyFromFloats(Y.x,Y.y,1-1e-8),J=u.i.Vector3[2],l=u.i.Vector3[3];u.l._UnprojectFromInvertedMatrixToRef(Y,r,J),u.l._UnprojectFromInvertedMatrixToRef(g,r,l),this.origin.copyFrom(J),l.subtractToRef(J,this.direction),this.direction.normalize()},w._TmpVector3=P.c.BuildArray(6,u.l.Zero),w._RayDistant=w.Zero(),w._Smallnum=1e-8,w._Rayl=1e9,w}();a.d.prototype.createPickingRay=function(w,v,I,P,u){void 0===u&&(u=!1);var Q=r.Zero();return this.createPickingRayToRef(w,v,I,Q,P,u),Q},a.d.prototype.createPickingRayToRef=function(w,v,I,P,Q,K,a){void 0===K&&(K=!1),void 0===a&&(a=!1);var U=this.getEngine();if(!Q){if(!this.activeCamera)return this;Q=this.activeCamera}var p=Q.viewport.toGlobal(U.getRenderWidth(),U.getRenderHeight());return w=w/U.getHardwareScalingLevel()-p.x,v=v/U.getHardwareScalingLevel()-(U.getRenderHeight()-p.y-p.height),P.update(w,v,p.width,p.height,I||u.e.IdentityReadOnly,K?u.e.IdentityReadOnly:Q.getViewMatrix(),Q.getProjectionMatrix(),a),this},a.d.prototype.createPickingRayInCameraSpace=function(w,v,I){var P=r.Zero();return this.createPickingRayInCameraSpaceToRef(w,v,P,I),P},a.d.prototype.createPickingRayInCameraSpaceToRef=function(w,v,I,P){if(!Q.d)return this;var K=this.getEngine();if(!P){if(!this.activeCamera)throw new Error("Active camera not set");P=this.activeCamera}var a=P.viewport.toGlobal(K.getRenderWidth(),K.getRenderHeight()),U=u.e.Identity();return w=w/K.getHardwareScalingLevel()-a.x,v=v/K.getHardwareScalingLevel()-(K.getRenderHeight()-a.y-a.height),I.update(w,v,a.width,a.height,U,U,P.getProjectionMatrix()),this},a.d.prototype._internalPickForMesh=function(w,v,I,P,u,Q,K,a){var U=v(P,I.enableDistantPicking),p=I.intersects(U,u,K,Q,P,a);return p&&p.hit?!u&&null!=w&&p.distance>=w.distance?null:p:null},a.d.prototype._internalPick=function(w,v,I,P,K){if(!Q.d)return null;for(var a=null,U=0;U<this.meshes.length;U++){var p=this.meshes[U];if(v){if(!v(p))continue}else if(!p.isEnabled()||!p.isVisible||!p.isPickable)continue;var r,Y=p.getWorldMatrix();if(p.hasThinInstances&&p.thinInstanceEnablePicking){if(r=this._internalPickForMesh(a,w,p,Y,!0,!0,K)){if(P)return r;for(var g=u.i.Matrix[1],J=p.thinInstanceGetWorldMatrices(),l=0;l<J.length;l++){J[l].multiplyToRef(Y,g);var R=this._internalPickForMesh(a,w,p,g,I,P,K,!0);if(R&&((a=R).thinInstanceIndex=l,I))return a}}}else if((r=this._internalPickForMesh(a,w,p,Y,I,P,K))&&(a=r,I))return a}return a||new Q.d},a.d.prototype._internalMultiPick=function(w,v,I){if(!Q.d)return null;for(var P=new Array,K=0;K<this.meshes.length;K++){var a=this.meshes[K];if(v){if(!v(a))continue}else if(!a.isEnabled()||!a.isVisible||!a.isPickable)continue;var U,p=a.getWorldMatrix();if(a.hasThinInstances&&a.thinInstanceEnablePicking){if(U=this._internalPickForMesh(null,w,a,p,!0,!0,I))for(var r=u.i.Matrix[1],Y=a.thinInstanceGetWorldMatrices(),g=0;g<Y.length;g++){Y[g].multiplyToRef(p,r);var J=this._internalPickForMesh(null,w,a,r,!1,!1,I,!0);J&&(J.thinInstanceIndex=g,P.push(J))}}else(U=this._internalPickForMesh(null,w,a,p,!1,!1,I))&&P.push(U)}return P},a.d.prototype.pickWithBoundingInfo=function(w,v,I,P,K){var a=this;if(!Q.d)return null;var U=this._internalPick((function(I){return a._tempPickingRay||(a._tempPickingRay=r.Zero()),a.createPickingRayToRef(w,v,I,a._tempPickingRay,K||null),a._tempPickingRay}),I,P,!0);return U&&(U.ray=this.createPickingRay(w,v,u.e.Identity(),K||null)),U},a.d.prototype.pick=function(w,v,I,P,K,a,U){var p=this;if(void 0===U&&(U=!1),!Q.d)return null;var Y=this._internalPick((function(I,P){return p._tempPickingRay||(p._tempPickingRay=r.Zero()),p.createPickingRayToRef(w,v,I,p._tempPickingRay,K||null,!1,P),p._tempPickingRay}),I,P,!1,a);return Y&&(Y.ray=this.createPickingRay(w,v,u.e.Identity(),K||null)),Y},a.d.prototype.pickWithRay=function(w,v,I,P){var Q=this,K=this._internalPick((function(v){return Q._pickWithRayInverseMatrix||(Q._pickWithRayInverseMatrix=u.e.Identity()),v.invertToRef(Q._pickWithRayInverseMatrix),Q._cachedRayForTransform||(Q._cachedRayForTransform=r.Zero()),r.TransformToRef(w,Q._pickWithRayInverseMatrix,Q._cachedRayForTransform),Q._cachedRayForTransform}),v,I,!1,P);return K&&(K.ray=w),K},a.d.prototype.multiPick=function(w,v,I,P,u){var Q=this;return this._internalMultiPick((function(I){return Q.createPickingRay(w,v,I,P||null)}),I,u)},a.d.prototype.multiPickWithRay=function(w,v,I){var P=this;return this._internalMultiPick((function(v){return P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=u.e.Identity()),v.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=r.Zero()),r.TransformToRef(w,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform}),v,I)},U.e.prototype.getForwardRay=function(w,v,I){return void 0===w&&(w=100),this.getForwardRayToRef(new r(u.l.Zero(),u.l.Zero(),w),w,v,I)},U.e.prototype.getForwardRayToRef=function(w,v,I,P){return void 0===v&&(v=100),I||(I=this.getWorldMatrix()),w.length=v,P?w.origin.copyFrom(P):w.origin.copyFrom(this.position),u.i.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),u.l.TransformNormalToRef(u.i.Vector3[2],I,u.i.Vector3[3]),u.l.NormalizeToRef(u.i.Vector3[3],w.direction),w}},54980:function(w,v,I){"use strict";var P=I(72284);P.d.prototype.setAlphaConstants=function(w,v,I,P){this._alphaState.setAlphaBlendConstants(w,v,I,P)},P.d.prototype.setAlphaMode=function(w,v){if(void 0===v&&(v=!1),this._alphaMode!==w){switch(w){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}v||(this.depthCullingState.depthMask=0===w),this._alphaMode=w}},P.d.prototype.getAlphaMode=function(){return this._alphaMode},P.d.prototype.setAlphaEquation=function(w){if(this._alphaEquation!==w){switch(w){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=w}},P.d.prototype.getAlphaEquation=function(){return this._alphaEquation}},37855:function(w,v,I){"use strict";var P=I(72284);P.d.prototype.updateDynamicIndexBuffer=function(w,v,I){var P;void 0===I&&(I=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(w),P=w.is32Bits?v instanceof Uint32Array?v:new Uint32Array(v):v instanceof Uint16Array?v:new Uint16Array(v),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,P,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},P.d.prototype.updateDynamicVertexBuffer=function(w,v,I,P){this.bindArrayBuffer(w),void 0===I&&(I=0);var u=v.byteLength||v.length;void 0===P||P>=u&&0===I?v instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,I,new Float32Array(v)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,I,v):v instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(v).subarray(I,I+P)):(v=v instanceof ArrayBuffer?new Uint8Array(v,I,P):new Uint8Array(v.buffer,v.byteOffset+I,P),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,v)),this._resetVertexBufferBinding()}},36125:function(w,v,I){"use strict";var P=I(60766),u=I(9127),Q=I(9217),K=I(72284);function a(w,v,I,P){var u,Q=1;1===P?u=new Float32Array(v*I*4):2===P?(u=new Uint16Array(v*I*4),Q=15360):u=7===P?new Uint32Array(v*I*4):new Uint8Array(v*I*4);for(var K=0;K<v;K++)for(var a=0;a<I;a++){var U=3*(a*v+K),p=4*(a*v+K);u[p+0]=w[U+0],u[p+1]=w[U+1],u[p+2]=w[U+2],u[p+3]=Q}return u}function U(w){return function(v,I,u,Q,K,a,U,p,r,Y){void 0===r&&(r=null),void 0===Y&&(Y=0);var g=w?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,J=w?P.e.Raw3D:P.e.Raw2DArray,l=new P.h(this,J);l.baseWidth=I,l.baseHeight=u,l.baseDepth=Q,l.width=I,l.height=u,l.depth=Q,l.format=K,l.type=Y,l.generateMipMaps=a,l.samplingMode=p,w?l.is3D=!0:l.is2DArray=!0,this._doNotHandleContextLost||(l._bufferView=v),w?this.updateRawTexture3D(l,v,K,U,r,Y):this.updateRawTexture2DArray(l,v,K,U,r,Y),this._bindTextureDirectly(g,l,!0);var R=this._getSamplingParameters(p,a);return this._gl.texParameteri(g,this._gl.TEXTURE_MAG_FILTER,R.mag),this._gl.texParameteri(g,this._gl.TEXTURE_MIN_FILTER,R.min),a&&this._gl.generateMipmap(g),this._bindTextureDirectly(g,null),this._internalTexturesCache.push(l),l}}function p(w){return function(v,I,P,u,Q,K){void 0===Q&&(Q=null),void 0===K&&(K=0);var a=w?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,U=this._getWebGLTextureType(K),p=this._getInternalFormat(P),r=this._getRGBABufferInternalSizedFormat(K,P);this._bindTextureDirectly(a,v,!0),this._unpackFlipY(void 0===u||!!u),this._doNotHandleContextLost||(v._bufferView=I,v.format=P,v.invertY=u,v._compression=Q),v.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),Q&&I?this._gl.compressedTexImage3D(a,0,this.getCaps().s3tc[Q],v.width,v.height,v.depth,0,I):this._gl.texImage3D(a,0,r,v.width,v.height,v.depth,0,p,U,I),v.generateMipMaps&&this._gl.generateMipmap(a),this._bindTextureDirectly(a,null),v.isReady=!0}}K.d.prototype.updateRawTexture=function(w,v,I,P,u,Q,K){if(void 0===u&&(u=null),void 0===Q&&(Q=0),void 0===K&&(K=!1),w){var a=this._getRGBABufferInternalSizedFormat(Q,I,K),U=this._getInternalFormat(I),p=this._getWebGLTextureType(Q);this._bindTextureDirectly(this._gl.TEXTURE_2D,w,!0),this._unpackFlipY(void 0===P||!!P),this._doNotHandleContextLost||(w._bufferView=v,w.format=I,w.type=Q,w.invertY=P,w._compression=u),w.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),u&&v?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[u],w.width,w.height,0,v):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,w.width,w.height,0,U,p,v),w.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),w.isReady=!0}},K.d.prototype.createRawTexture=function(w,v,I,u,Q,K,a,U,p,r,Y){void 0===U&&(U=null),void 0===p&&(p=0),void 0===r&&(r=0),void 0===Y&&(Y=!1);var g=new P.h(this,P.e.Raw);g.baseWidth=v,g.baseHeight=I,g.width=v,g.height=I,g.format=u,g.generateMipMaps=Q,g.samplingMode=a,g.invertY=K,g._compression=U,g.type=p,g._useSRGBBuffer=this._getUseSRGBBuffer(Y,!Q),this._doNotHandleContextLost||(g._bufferView=w),this.updateRawTexture(g,w,u,K,U,p,g._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,g,!0);var J=this._getSamplingParameters(a,Q);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,J.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,J.min),Q&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(g),g},K.d.prototype.createRawCubeTexture=function(w,v,I,K,a,U,p,r){void 0===r&&(r=null);var Y=this._gl,g=new P.h(this,P.e.CubeRaw);g.isCube=!0,g.format=I,g.type=K,this._doNotHandleContextLost||(g._bufferViewArray=w);var J=this._getWebGLTextureType(K),l=this._getInternalFormat(I);l===Y.RGB&&(l=Y.RGBA),J!==Y.FLOAT||this._caps.textureFloatLinearFiltering?J!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?J!==Y.FLOAT||this._caps.textureFloatRender?J!==Y.HALF_FLOAT||this._caps.colorBufferFloat||(a=!1,u.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(a=!1,u.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(a=!1,p=1,u.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(a=!1,p=1,u.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var R=v,x=R;g.width=R,g.height=x,!this.needPOTTextures||Q.i.IsExponentOfTwo(g.width)&&Q.i.IsExponentOfTwo(g.height)||(a=!1),w&&this.updateRawCubeTexture(g,w,I,K,U,r),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,g,!0),w&&a&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var j=this._getSamplingParameters(p,a);return Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,j.mag),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,j.min),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),this._bindTextureDirectly(Y.TEXTURE_CUBE_MAP,null),g.generateMipMaps=a,g.samplingMode=p,g},K.d.prototype.updateRawCubeTexture=function(w,v,I,P,u,K,U){void 0===K&&(K=null),void 0===U&&(U=0),w._bufferViewArray=v,w.format=I,w.type=P,w.invertY=u,w._compression=K;var p=this._gl,r=this._getWebGLTextureType(P),Y=this._getInternalFormat(I),g=this._getRGBABufferInternalSizedFormat(P),J=!1;Y===p.RGB&&(Y=p.RGBA,J=!0),this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,w,!0),this._unpackFlipY(void 0===u||!!u),w.width%4!==0&&p.pixelStorei(p.UNPACK_ALIGNMENT,1);for(var l=0;l<6;l++){var R=v[l];K?p.compressedTexImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+l,U,this.getCaps().s3tc[K],w.width,w.height,0,R):(J&&(R=a(R,w.width,w.height,P)),p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+l,U,g,w.width,w.height,0,Y,r,R))}(!this.needPOTTextures||Q.i.IsExponentOfTwo(w.width)&&Q.i.IsExponentOfTwo(w.height))&&w.generateMipMaps&&0===U&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),w.isReady=!0},K.d.prototype.createRawCubeTextureFromUrl=function(w,v,I,P,u,Q,K,U,p,r,Y,g){var J=this;void 0===p&&(p=null),void 0===r&&(r=null),void 0===Y&&(Y=3),void 0===g&&(g=!1);var l=this._gl,R=this.createRawCubeTexture(null,I,P,u,!Q,g,Y,null);null===v||void 0===v||v._addPendingData(R),R.url=w,this._internalTexturesCache.push(R);return this._loadFile(w,(function(w){!function(w){var I=R.width,Q=K(w);if(Q){if(U){var r=J._getWebGLTextureType(u),Y=J._getInternalFormat(P),x=J._getRGBABufferInternalSizedFormat(u),j=!1;Y===l.RGB&&(Y=l.RGBA,j=!0),J._bindTextureDirectly(l.TEXTURE_CUBE_MAP,R,!0),J._unpackFlipY(!1);for(var s=U(Q),B=0;B<s.length;B++)for(var t=I>>B,i=0;i<6;i++){var z=s[B][i];j&&(z=a(z,t,t,u)),l.texImage2D(i,B,x,t,t,0,Y,r,z)}J._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null)}else J.updateRawCubeTexture(R,Q,P,u,g);R.isReady=!0,null===v||void 0===v||v._removePendingData(R),R.onLoadedObservable.notifyObservers(R),R.onLoadedObservable.clear(),p&&p()}}(w)}),void 0,null===v||void 0===v?void 0:v.offlineProvider,!0,(function(w,I){null===v||void 0===v||v._removePendingData(R),r&&w&&r(w.status+" "+w.statusText,I)})),R},K.d.prototype.createRawTexture2DArray=U(!1),K.d.prototype.createRawTexture3D=U(!0),K.d.prototype.updateRawTexture2DArray=p(!1),K.d.prototype.updateRawTexture3D=p(!0)},91156:function(w,v,I){"use strict";var P=I(72284);P.d.prototype._readTexturePixelsSync=function(w,v,I,P,u,Q,K,a,U,p){var r,Y;void 0===P&&(P=-1),void 0===u&&(u=0),void 0===Q&&(Q=null),void 0===K&&(K=!0),void 0===a&&(a=!1),void 0===U&&(U=0),void 0===p&&(p=0);var g=this._gl;if(!g)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var J=g.createFramebuffer();if(!J)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=J}g.bindFramebuffer(g.FRAMEBUFFER,this._dummyFramebuffer),P>-1?g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+P,null===(r=w._hardwareTexture)||void 0===r?void 0:r.underlyingResource,u):g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,null===(Y=w._hardwareTexture)||void 0===Y?void 0:Y.underlyingResource,u);var l=void 0!==w.type?this._getWebGLTextureType(w.type):g.UNSIGNED_BYTE;if(a)Q||(Q=function(w,v,I,P){switch(void 0===I&&(I=!1),w){case 3:var u=(ArrayBuffer,new Int8Array(v));return P&&u.set(new Int8Array(P)),u;case 0:var Q=(ArrayBuffer,new Uint8Array(v));return P&&Q.set(new Uint8Array(P)),Q;case 4:var K=v instanceof ArrayBuffer?new Int16Array(v):new Int16Array(I?v/2:v);return P&&K.set(new Int16Array(P)),K;case 5:case 8:case 9:case 10:case 2:var a=v instanceof ArrayBuffer?new Uint16Array(v):new Uint16Array(I?v/2:v);return P&&a.set(new Uint16Array(P)),a;case 6:var U=v instanceof ArrayBuffer?new Int32Array(v):new Int32Array(I?v/4:v);return P&&U.set(new Int32Array(P)),U;case 7:case 11:case 12:case 13:case 14:case 15:var p=v instanceof ArrayBuffer?new Uint32Array(v):new Uint32Array(I?v/4:v);return P&&p.set(new Uint32Array(P)),p;case 1:var r=v instanceof ArrayBuffer?new Float32Array(v):new Float32Array(I?v/4:v);return P&&r.set(new Float32Array(P)),r}var Y=(ArrayBuffer,new Uint8Array(v));return P&&Y.set(new Uint8Array(P)),Y}(w.type,4*v*I));else if(l===g.UNSIGNED_BYTE)Q||(Q=new Uint8Array(4*v*I)),l=g.UNSIGNED_BYTE;else Q||(Q=new Float32Array(4*v*I)),l=g.FLOAT;return K&&this.flushFramebuffer(),g.readPixels(U,p,v,I,g.RGBA,l,Q),g.bindFramebuffer(g.FRAMEBUFFER,this._currentFramebuffer),Q},P.d.prototype._readTexturePixels=function(w,v,I,P,u,Q,K,a,U,p){return void 0===P&&(P=-1),void 0===u&&(u=0),void 0===Q&&(Q=null),void 0===K&&(K=!0),void 0===a&&(a=!1),void 0===U&&(U=0),void 0===p&&(p=0),Promise.resolve(this._readTexturePixelsSync(w,v,I,P,u,Q,K,a,U,p))}},84468:function(w,v,I){"use strict";var P=I(78502),u=I(60766),Q=I(9127),K=I(72284),a=function(w){function v(v,I,P,u,Q){var K=w.call(this,v,I,P,u)||this;return K._framebuffer=null,K._depthStencilBuffer=null,K._MSAAFramebuffer=null,K._colorTextureArray=null,K._depthStencilTextureArray=null,K._context=Q,K}return(0,P.m)(v,w),v.prototype._cloneRenderTargetWrapper=function(){var v=null;return this._colorTextureArray&&this._depthStencilTextureArray?(v=this._engine.createMultiviewRenderTargetTexture(this.width,this.height)).texture.isReady=!0:v=w.prototype._cloneRenderTargetWrapper.call(this),v},v.prototype._swapRenderTargetWrapper=function(v){w.prototype._swapRenderTargetWrapper.call(this,v),v._framebuffer=this._framebuffer,v._depthStencilBuffer=this._depthStencilBuffer,v._MSAAFramebuffer=this._MSAAFramebuffer,v._colorTextureArray=this._colorTextureArray,v._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null},v.prototype._shareDepth=function(v){w.prototype._shareDepth.call(this,v);var I=this._context,P=this._depthStencilBuffer,u=v._framebuffer;v._depthStencilBuffer&&I.deleteRenderbuffer(v._depthStencilBuffer),v._depthStencilBuffer=this._depthStencilBuffer,this._engine._bindUnboundFramebuffer(u),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.DEPTH_ATTACHMENT,I.RENDERBUFFER,P),this._engine._bindUnboundFramebuffer(null)},v.prototype._bindTextureRenderTarget=function(w,v,I,P){if(void 0===v&&(v=0),void 0===I&&(I=-1),void 0===P&&(P=0),w._hardwareTexture){var u=this._context,Q=this._framebuffer,K=this._engine._currentFramebuffer;this._engine._bindUnboundFramebuffer(Q);var a=u[this._engine.webGLVersion>1?"COLOR_ATTACHMENT"+v:"COLOR_ATTACHMENT"+v+"_WEBGL"],U=-1!==I?u.TEXTURE_CUBE_MAP_POSITIVE_X+I:u.TEXTURE_2D;u.framebufferTexture2D(u.FRAMEBUFFER,a,U,w._hardwareTexture.underlyingResource,P),this._engine._bindUnboundFramebuffer(K)}},v.prototype.setTexture=function(v,I,P){void 0===I&&(I=0),void 0===P&&(P=!0),w.prototype.setTexture.call(this,v,I,P),this._bindTextureRenderTarget(v,I)},v.prototype.dispose=function(v){void 0===v&&(v=!1);var I=this._context;v||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(I.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(I.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(I.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),w.prototype.dispose.call(this,v)},v}(I(52311).e);K.d.prototype._createHardwareRenderTargetWrapper=function(w,v,I){var P=new a(w,v,I,this,this._gl);return this._renderTargetWrapperCache.push(P),P},K.d.prototype.createRenderTargetTexture=function(w,v){var I=this._createHardwareRenderTargetWrapper(!1,!1,w),P={};void 0!==v&&"object"===typeof v?(P.generateDepthBuffer=!!v.generateDepthBuffer,P.generateStencilBuffer=!!v.generateStencilBuffer,P.noColorTarget=!!v.noColorTarget):(P.generateDepthBuffer=!0,P.generateStencilBuffer=!1,P.noColorTarget=!1);var Q=P.noColorTarget?null:this._createInternalTexture(w,v,!0,u.e.RenderTarget),K=w.width||w,a=w.height||w,U=this._currentFramebuffer,p=this._gl,r=p.createFramebuffer();return this._bindUnboundFramebuffer(r),I._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!P.generateStencilBuffer,P.generateDepthBuffer,K,a),Q&&!Q.is2DArray&&p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,Q._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(U),I._framebuffer=r,I._generateDepthBuffer=P.generateDepthBuffer,I._generateStencilBuffer=!!P.generateStencilBuffer,I.setTextures(Q),I},K.d.prototype.createDepthStencilTexture=function(w,v,I){if(v.isCube){var P=w.width||w;return this._createDepthStencilCubeTexture(P,v,I)}return this._createDepthStencilTexture(w,v,I)},K.d.prototype._createDepthStencilTexture=function(w,v,I){var K=this._gl,a=w.layers||0,U=0!==a?K.TEXTURE_2D_ARRAY:K.TEXTURE_2D,p=new u.h(this,u.e.DepthStencil);if(!this._caps.depthTextureExtension)return Q.e.Error("Depth texture is not supported by your browser or hardware."),p;var r=(0,P.d)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},v);if(this._bindTextureDirectly(U,p,!0),this._setupDepthStencilTexture(p,w,r.generateStencil,0!==r.comparisonFunction&&r.bilinearFiltering,r.comparisonFunction),void 0!==r.depthTextureFormat){if(15!==r.depthTextureFormat&&16!==r.depthTextureFormat&&17!==r.depthTextureFormat&&13!==r.depthTextureFormat&&14!==r.depthTextureFormat&&18!==r.depthTextureFormat)return Q.e.Error("Depth texture format is not supported."),p;p.format=r.depthTextureFormat}else p.format=r.generateStencil?13:16;var Y=17===p.format||13===p.format||18===p.format;I._depthStencilTexture=p,I._depthStencilTextureWithStencil=Y;var g=K.UNSIGNED_INT;15===p.format?g=K.UNSIGNED_SHORT:17===p.format||13===p.format?g=K.UNSIGNED_INT_24_8:14===p.format?g=K.FLOAT:18===p.format&&(g=K.FLOAT_32_UNSIGNED_INT_24_8_REV);var J=Y?K.DEPTH_STENCIL:K.DEPTH_COMPONENT,l=J;this.webGLVersion>1&&(15===p.format?l=K.DEPTH_COMPONENT16:16===p.format?l=K.DEPTH_COMPONENT24:17===p.format||13===p.format?l=K.DEPTH24_STENCIL8:14===p.format?l=K.DEPTH_COMPONENT32F:18===p.format&&(l=K.DEPTH32F_STENCIL8)),p.is2DArray?K.texImage3D(U,0,l,p.width,p.height,a,0,J,g,null):K.texImage2D(U,0,l,p.width,p.height,0,J,g,null),this._bindTextureDirectly(U,null),this._internalTexturesCache.push(p);var R=I;if(R._depthStencilBuffer){var x=this._currentFramebuffer;this._bindUnboundFramebuffer(R._framebuffer),K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_STENCIL_ATTACHMENT,K.RENDERBUFFER,null),K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_ATTACHMENT,K.RENDERBUFFER,null),K.framebufferRenderbuffer(K.FRAMEBUFFER,K.STENCIL_ATTACHMENT,K.RENDERBUFFER,null),this._bindUnboundFramebuffer(x),K.deleteRenderbuffer(R._depthStencilBuffer),R._depthStencilBuffer=null}return p},K.d.prototype.updateRenderTargetTextureSampleCount=function(w,v){if(this.webGLVersion<2||!w||!w.texture)return 1;if(w.samples===v)return v;var I=this._gl;v=Math.min(v,this.getCaps().maxMSAASamples),w._depthStencilBuffer&&(I.deleteRenderbuffer(w._depthStencilBuffer),w._depthStencilBuffer=null),w._MSAAFramebuffer&&(I.deleteFramebuffer(w._MSAAFramebuffer),w._MSAAFramebuffer=null);var P=w.texture._hardwareTexture;if(P._MSAARenderBuffer&&(I.deleteRenderbuffer(P._MSAARenderBuffer),P._MSAARenderBuffer=null),v>1&&I.renderbufferStorageMultisample){var u=I.createFramebuffer();if(!u)throw new Error("Unable to create multi sampled framebuffer");w._MSAAFramebuffer=u,this._bindUnboundFramebuffer(w._MSAAFramebuffer);var Q=this._createRenderBuffer(w.texture.width,w.texture.height,v,-1,this._getRGBAMultiSampleBufferFormat(w.texture.type),I.COLOR_ATTACHMENT0,!1);if(!Q)throw new Error("Unable to create multi sampled framebuffer");P._MSAARenderBuffer=Q}else this._bindUnboundFramebuffer(w._framebuffer);return w.texture.samples=v,w._depthStencilBuffer=this._setupFramebufferDepthAttachments(w._generateStencilBuffer,w._generateDepthBuffer,w.texture.width,w.texture.height,v),this._bindUnboundFramebuffer(null),v}},42373:function(w,v,I){"use strict";var P=I(78502),u=I(60766),Q=I(9127);I(72284).d.prototype.createRenderTargetCubeTexture=function(w,v){var I=this._createHardwareRenderTargetWrapper(!1,!0,w),K=(0,P.d)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},v);K.generateStencilBuffer=K.generateDepthBuffer&&K.generateStencilBuffer,(1!==K.type||this._caps.textureFloatLinearFiltering)&&(2!==K.type||this._caps.textureHalfFloatLinearFiltering)||(K.samplingMode=1);var a=this._gl,U=new u.h(this,u.e.RenderTarget);this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,U,!0);var p=this._getSamplingParameters(K.samplingMode,K.generateMipMaps);1!==K.type||this._caps.textureFloat||(K.type=0,Q.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,p.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,p.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(var r=0;r<6;r++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,this._getRGBABufferInternalSizedFormat(K.type,K.format),w,w,0,this._getInternalFormat(K.format),this._getWebGLTextureType(K.type),null);var Y=a.createFramebuffer();return this._bindUnboundFramebuffer(Y),I._depthStencilBuffer=this._setupFramebufferDepthAttachments(K.generateStencilBuffer,K.generateDepthBuffer,w,w),K.generateMipMaps&&a.generateMipmap(a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),I._framebuffer=Y,I._generateDepthBuffer=K.generateDepthBuffer,I._generateStencilBuffer=K.generateStencilBuffer,U.width=w,U.height=w,U.isReady=!0,U.isCube=!0,U.samples=1,U.generateMipMaps=K.generateMipMaps,U.samplingMode=K.samplingMode,U.type=K.type,U.format=K.format,this._internalTexturesCache.push(U),I.setTextures(U),I}},42647:function(w,v,I){"use strict";I.d(v,{c:function(){return s}});var P=function(){function w(){this.children=[]}return w.prototype.isValid=function(w){return!0},w.prototype.process=function(w,v){var I="";if(this.line){var P=this.line,u=v.processor;if(u){if(u.lineProcessor&&(P=u.lineProcessor(P,v.isFragment,v.processingContext)),u.attributeProcessor&&this.line.startsWith("attribute"))P=u.attributeProcessor(this.line,w,v.processingContext);else if(u.varyingProcessor&&this.line.startsWith("varying"))P=u.varyingProcessor(this.line,v.isFragment,w,v.processingContext);else if(u.uniformProcessor&&u.uniformRegexp&&u.uniformRegexp.test(this.line))v.lookForClosingBracketForUniformBuffer||(P=u.uniformProcessor(this.line,v.isFragment,w,v.processingContext));else if(u.uniformBufferProcessor&&u.uniformBufferRegexp&&u.uniformBufferRegexp.test(this.line))v.lookForClosingBracketForUniformBuffer||(P=u.uniformBufferProcessor(this.line,v.isFragment,v.processingContext),v.lookForClosingBracketForUniformBuffer=!0);else if(u.textureProcessor&&u.textureRegexp&&u.textureRegexp.test(this.line))P=u.textureProcessor(this.line,v.isFragment,w,v.processingContext);else if((u.uniformProcessor||u.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!v.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?u.uniformProcessor&&(P=u.uniformProcessor(this.line,v.isFragment,w,v.processingContext)):u.uniformBufferProcessor&&(P=u.uniformBufferProcessor(this.line,v.isFragment,v.processingContext),v.lookForClosingBracketForUniformBuffer=!0)}v.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(v.lookForClosingBracketForUniformBuffer=!1,u.endOfUniformBufferProcessor&&(P=u.endOfUniformBufferProcessor(this.line,v.isFragment,v.processingContext)))}I+=P+"\r\n"}return this.children.forEach((function(P){I+=P.process(w,v)})),this.additionalDefineKey&&(w[this.additionalDefineKey]=this.additionalDefineValue||"true"),I},w}(),u=function(){function w(){}return Object.defineProperty(w.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"lines",{set:function(w){this._lines=[];for(var v=0,I=w;v<I.length;v++){var P=I[v];if("#"!==P[0])if(P.trim().startsWith("//"))this._lines.push(P);else for(var u=P.split(";"),Q=0;Q<u.length;Q++){var K=u[Q];(K=K.trim())&&this._lines.push(K+(Q!==u.length-1?";":""))}else this._lines.push(P)}},enumerable:!1,configurable:!0}),w}(),Q=I(78502),K=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return(0,Q.m)(v,w),v.prototype.process=function(w,v){for(var I=0;I<this.children.length;I++){var P=this.children[I];if(P.isValid(w))return P.process(w,v)}return""},v}(P),a=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return(0,Q.m)(v,w),v.prototype.isValid=function(w){return this.testExpression.isTrue(w)},v}(P),U=function(){function w(){}return w.prototype.isTrue=function(w){return!0},w.postfixToInfix=function(v){for(var I=[],P=0,u=v;P<u.length;P++){var Q=u[P];if(void 0===w._OperatorPriority[Q])I.push(Q);else{var K=I[I.length-1],a=I[I.length-2];I.length-=2,I.push("(".concat(a).concat(Q).concat(K,")"))}}return I[I.length-1]},w.infixToPostfix=function(v){for(var I=[],P=-1,u=function(){""!==(p=p.trim())&&(I.push(p),p="")},Q=function(v){P<w._Stack.length-1&&(w._Stack[++P]=v)},K=function(){return w._Stack[P]},a=function(){return-1===P?"!!INVALID EXPRESSION!!":w._Stack[P--]},U=0,p="";U<v.length;){var r=v.charAt(U),Y=U<v.length-1?v.substr(U,2):"";if("("===r)p="",Q(r);else if(")"===r){for(u();-1!==P&&"("!==K();)I.push(a());a()}else if(w._OperatorPriority[Y]>1){for(u();-1!==P&&w._OperatorPriority[K()]>=w._OperatorPriority[Y];)I.push(a());Q(Y),U++}else p+=r;U++}for(u();-1!==P;)"("===K()?a():I.push(a());return I},w._OperatorPriority={")":0,"(":1,"||":2,"&&":3},w._Stack=["","","","","","","","","","","","","","","","","","","",""],w}(),p=function(w){function v(v,I){void 0===I&&(I=!1);var P=w.call(this)||this;return P.define=v,P.not=I,P}return(0,Q.m)(v,w),v.prototype.isTrue=function(w){var v=void 0!==w[this.define];return this.not&&(v=!v),v},v}(U),r=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return(0,Q.m)(v,w),v.prototype.isTrue=function(w){return this.leftOperand.isTrue(w)||this.rightOperand.isTrue(w)},v}(U),Y=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return(0,Q.m)(v,w),v.prototype.isTrue=function(w){return this.leftOperand.isTrue(w)&&this.rightOperand.isTrue(w)},v}(U),g=function(w){function v(v,I,P){var u=w.call(this)||this;return u.define=v,u.operand=I,u.testValue=P,u}return(0,Q.m)(v,w),v.prototype.isTrue=function(w){var v=w[this.define];void 0===v&&(v=this.define);var I=!1,P=parseInt(v),u=parseInt(this.testValue);switch(this.operand){case">":I=P>u;break;case"<":I=P<u;break;case"<=":I=P<=u;break;case">=":I=P>=u;break;case"==":I=P===u}return I},v}(U),J=I(50504),l=I(56591),R=/defined\s*?\((.+?)\)/g,x=/defined\s*?\[(.+?)\]/g,j=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,s=function(){function w(){}return w.Initialize=function(w){w.processor&&w.processor.initializeShaders&&w.processor.initializeShaders(w.processingContext)},w.Process=function(w,v,I,P){var u,Q=this;(null===(u=v.processor)||void 0===u?void 0:u.preProcessShaderCode)&&(w=v.processor.preProcessShaderCode(w,v.isFragment)),this._ProcessIncludes(w,v,(function(w){v.processCodeAfterIncludes&&(w=v.processCodeAfterIncludes(v.isFragment?"fragment":"vertex",w));var u=Q._ProcessShaderConversion(w,v,P);I(u)}))},w.PreProcess=function(w,v,I,P){var u,Q=this;(null===(u=v.processor)||void 0===u?void 0:u.preProcessShaderCode)&&(w=v.processor.preProcessShaderCode(w,v.isFragment)),this._ProcessIncludes(w,v,(function(w){v.processCodeAfterIncludes&&(w=v.processCodeAfterIncludes(v.isFragment?"fragment":"vertex",w));var u=Q._ApplyPreProcessing(w,v,P);I(u)}))},w.Finalize=function(w,v,I){return I.processor&&I.processor.finalizeShaders?I.processor.finalizeShaders(w,v,I.processingContext):{vertexCode:w,fragmentCode:v}},w._ProcessPrecision=function(w,v){var I;if(null===(I=v.processor)||void 0===I?void 0:I.noPrecision)return w;var P=v.shouldUseHighPrecisionShader;return-1===w.indexOf("precision highp float")?w=P?"precision highp float;\n"+w:"precision mediump float;\n"+w:P||(w=w.replace("precision highp float","precision mediump float")),w},w._ExtractOperation=function(w){var v=/defined\((.+)\)/.exec(w);if(v&&v.length)return new p(v[1].trim(),"!"===w[0]);for(var I="",P=0,u=0,Q=["==",">=","<=","<",">"];u<Q.length&&(I=Q[u],!((P=w.indexOf(I))>-1));u++);if(-1===P)return new p(w);var K=w.substring(0,P).trim(),a=w.substring(P+I.length).trim();return new g(K,I,a)},w._BuildSubExpression=function(w){w=w.replace(R,"defined[$1]");for(var v=[],I=0,P=U.infixToPostfix(w);I<P.length;I++){var u=P[I];if("||"!==u&&"&&"!==u)v.push(u);else if(v.length>=2){var Q=v[v.length-1],K=v[v.length-2];v.length-=2;var a="&&"==u?new Y:new r;"string"===typeof Q&&(Q=Q.replace(x,"defined($1)")),"string"===typeof K&&(K=K.replace(x,"defined($1)")),a.leftOperand="string"===typeof K?this._ExtractOperation(K):K,a.rightOperand="string"===typeof Q?this._ExtractOperation(Q):Q,v.push(a)}}var p=v[v.length-1];return"string"===typeof p&&(p=p.replace(x,"defined($1)")),"string"===typeof p?this._ExtractOperation(p):p},w._BuildExpression=function(w,v){var I=new a,P=w.substring(0,v),u=w.substring(v);return u=u.substring(0,(u.indexOf("//")+1||u.length+1)-1).trim(),I.testExpression="#ifdef"===P?new p(u):"#ifndef"===P?new p(u,!0):this._BuildSubExpression(u),I},w._MoveCursorWithinIf=function(w,v,I){for(var u=w.currentLine;this._MoveCursor(w,I);){var Q=(u=w.currentLine).substring(0,5).toLowerCase();if("#else"===Q){var K=new P;return v.children.push(K),void this._MoveCursor(w,K)}if("#elif"===Q){var a=this._BuildExpression(u,5);v.children.push(a),I=a}}},w._MoveCursor=function(w,v){for(;w.canRead;){w.lineIndex++;var I=w.currentLine,u=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(I);if(u&&u.length){switch(u[0]){case"#ifdef":var Q=new K;v.children.push(Q);var a=this._BuildExpression(I,6);Q.children.push(a),this._MoveCursorWithinIf(w,Q,a);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":Q=new K;v.children.push(Q);a=this._BuildExpression(I,7);Q.children.push(a),this._MoveCursorWithinIf(w,Q,a);break;case"#if":Q=new K,a=this._BuildExpression(I,3);v.children.push(Q),Q.children.push(a),this._MoveCursorWithinIf(w,Q,a)}}else{var U=new P;if(U.line=I,v.children.push(U),"#"===I[0]&&"d"===I[1]){var p=I.replace(";","").split(" ");U.additionalDefineKey=p[1],3===p.length&&(U.additionalDefineValue=p[2])}}}return!1},w._EvaluatePreProcessors=function(w,v,I){var Q=new P,K=new u;return K.lineIndex=-1,K.lines=w.split("\n"),this._MoveCursor(K,Q),Q.process(v,I)},w._PreparePreProcessors=function(w,v){for(var I,P={},u=0,Q=w.defines;u<Q.length;u++){var K=Q[u].replace("#define","").replace(";","").trim().split(" ");P[K[0]]=K.length>1?K[1]:""}return(null===(I=w.processor)||void 0===I?void 0:I.shaderLanguage)===l.d.GLSL&&(P.GL_ES="true"),P.__VERSION__=w.version,P[w.platformName]="true",v._getGlobalDefines(P),P},w._ProcessShaderConversion=function(w,v,I){var P=this._ProcessPrecision(w,v);if(!v.processor)return P;if(v.processor.shaderLanguage===l.d.GLSL&&-1!==P.indexOf("#version 3"))return P.replace("#version 300 es","");var u=v.defines,Q=this._PreparePreProcessors(v,I);return v.processor.preProcessor&&(P=v.processor.preProcessor(P,u,v.isFragment,v.processingContext)),P=this._EvaluatePreProcessors(P,Q,v),v.processor.postProcessor&&(P=v.processor.postProcessor(P,u,v.isFragment,v.processingContext,I)),I._features.needShaderCodeInlining&&(P=I.inlineShaderCode(P)),P},w._ApplyPreProcessing=function(w,v,I){var P,u,Q=w,K=v.defines,a=this._PreparePreProcessors(v,I);return(null===(P=v.processor)||void 0===P?void 0:P.preProcessor)&&(Q=v.processor.preProcessor(Q,K,v.isFragment,v.processingContext)),Q=this._EvaluatePreProcessors(Q,a,v),(null===(u=v.processor)||void 0===u?void 0:u.postProcessor)&&(Q=v.processor.postProcessor(Q,K,v.isFragment,v.processingContext,I)),I._features.needShaderCodeInlining&&(Q=I.inlineShaderCode(Q)),Q},w._ProcessIncludes=function(v,I,P){for(var u=this,Q=j.exec(v),K=new String(v),a=!1,U=function(){var U=Q[1];if(-1!==U.indexOf("__decl__")&&(U=U.replace(/__decl__/,""),I.supportsUniformBuffers&&(U=(U=U.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),U+="Declaration"),!I.includesShadersStore[U]){var p=I.shadersRepository+"ShadersInclude/"+U+".fx";return w._FileToolsLoadFile(p,(function(w){I.includesShadersStore[U]=w,u._ProcessIncludes(K,I,P)})),{value:void 0}}var r=I.includesShadersStore[U];if(Q[2])for(var Y=Q[3].split(","),g=0;g<Y.length;g+=2){var J=new RegExp(Y[g],"g"),l=Y[g+1];r=r.replace(J,l)}if(Q[4]){var R=Q[5];if(-1!==R.indexOf("..")){var x=R.split(".."),s=parseInt(x[0]),B=parseInt(x[1]),t=r.slice(0);r="",isNaN(B)&&(B=I.indexParameters[x[1]]);for(var i=s;i<B;i++)I.supportsUniformBuffers||(t=t.replace(/light\{X\}.(\w*)/g,(function(w,v){return v+"{X}"}))),r+=t.replace(/\{X\}/g,i.toString())+"\n"}else I.supportsUniformBuffers||(r=r.replace(/light\{X\}.(\w*)/g,(function(w,v){return v+"{X}"}))),r=r.replace(/\{X\}/g,R)}K=K.replace(Q[0],r),a=a||r.indexOf("#include<")>=0||r.indexOf("#include <")>=0,Q=j.exec(v)};null!=Q;){var p=U();if("object"===typeof p)return p.value}a?this._ProcessIncludes(K.toString(),I,P):P(K)},w._FileToolsLoadFile=function(w,v,I,P,u,Q){throw(0,J.e)("FileTools")},w}()},21867:function(w,v,I){"use strict";I.d(v,{d:function(){return P}});var P=function(){function w(w,v){if(void 0===w&&(w=null),this._MSAARenderBuffer=null,this._context=v,!w&&!(w=v.createTexture()))throw new Error("Unable to create webGL texture");this.set(w)}return Object.defineProperty(w.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),w.prototype.setUsage=function(){},w.prototype.set=function(w){this._webGLTexture=w},w.prototype.reset=function(){this._webGLTexture=null,this._MSAARenderBuffer=null},w.prototype.release=function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},w}()},90690:function(w,v,I){"use strict";I.d(v,{d:function(){return j}});var P=I(78502),u=I(9271),Q=I(60766),K=I(60985),a=I(78588),U=I(50504),p=I(72284),r=I(19500),Y=function(){function w(w){void 0===w&&(w=30),this._enabled=!0,this._rollingFrameTime=new g(w)}return w.prototype.sampleFrame=function(w){if(void 0===w&&(w=r.b.Now),this._enabled){if(null!=this._lastFrameTimeMs){var v=w-this._lastFrameTimeMs;this._rollingFrameTime.add(v)}this._lastFrameTimeMs=w}},Object.defineProperty(w.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"instantaneousFPS",{get:function(){var w=this._rollingFrameTime.history(0);return 0===w?0:1e3/w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),w.prototype.enable=function(){this._enabled=!0},w.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(w.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),w.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},w}(),g=function(){function w(w){this._samples=new Array(w),this.reset()}return w.prototype.add=function(w){var v;if(this.isSaturated()){var I=this._samples[this._pos];v=I-this.average,this.average-=v/(this._sampleCount-1),this._m2-=v*(I-this.average)}else this._sampleCount++;v=w-this.average,this.average+=v/this._sampleCount,this._m2+=v*(w-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=w,this._pos++,this._pos%=this._samples.length},w.prototype.history=function(w){if(w>=this._sampleCount||w>=this._samples.length)return 0;var v=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(v-w)]},w.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},w.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},w.prototype._wrapPosition=function(w){var v=this._samples.length;return(w%v+v)%v},w}(),J=I(16945),l=I(12753),R=I(9127),x=I(21867),j=(I(54980),I(91156),I(37855),function(w){function v(I,P,Q,a){void 0===a&&(a=!1);var U=w.call(this,I,P,Q,a)||this;if(U.enableOfflineSupport=!1,U.disableManifestCheck=!1,U.disableContextMenu=!0,U.scenes=new Array,U._virtualScenes=new Array,U.onNewSceneAddedObservable=new u.c,U.postProcesses=new Array,U.isPointerLock=!1,U.onResizeObservable=new u.c,U.onCanvasBlurObservable=new u.c,U.onCanvasFocusObservable=new u.c,U.onCanvasPointerOutObservable=new u.c,U.onBeginFrameObservable=new u.c,U.customAnimationFrameRequester=null,U.onEndFrameObservable=new u.c,U.onBeforeShaderCompilationObservable=new u.c,U.onAfterShaderCompilationObservable=new u.c,U._deterministicLockstep=!1,U._lockstepMaxSteps=4,U._timeStep=1/60,U._fps=60,U._deltaTime=0,U._drawCalls=new J.e,U.canvasTabIndex=1,U.disablePerformanceMonitorInBackground=!1,U._performanceMonitor=new Y,U._compatibilityMode=!0,U.currentRenderPassId=0,U._renderPassNames=["main"],v.Instances.push(U),!I)return U;if(U._features.supportRenderPasses=!0,Q=U._creationOptions,I.getContext){var p=I;if(U._sharedInit(p,!!Q.doNotHandleTouchAction,Q.audioEngine),(0,K.r)()){var r=document;U._onFullscreenChange=function(){void 0!==r.fullscreen?U.isFullscreen=r.fullscreen:void 0!==r.mozFullScreen?U.isFullscreen=r.mozFullScreen:void 0!==r.webkitIsFullScreen?U.isFullscreen=r.webkitIsFullScreen:void 0!==r.msIsFullScreen&&(U.isFullscreen=r.msIsFullScreen),U.isFullscreen&&U._pointerLockRequested&&p&&v._RequestPointerlock(p)},document.addEventListener("fullscreenchange",U._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",U._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",U._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",U._onFullscreenChange,!1),U._onPointerLockChange=function(){U.isPointerLock=r.mozPointerLockElement===p||r.webkitPointerLockElement===p||r.msPointerLockElement===p||r.pointerLockElement===p},document.addEventListener("pointerlockchange",U._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",U._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",U._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",U._onPointerLockChange,!1),!v.audioEngine&&Q.audioEngine&&v.AudioEngineFactory&&(v.audioEngine=v.AudioEngineFactory(U.getRenderingCanvas(),U.getAudioContext(),U.getAudioDestination()))}U._connectVREvents(),U.enableOfflineSupport=void 0!==v.OfflineProviderFactory,U._deterministicLockstep=!!Q.deterministicLockstep,U._lockstepMaxSteps=Q.lockstepMaxSteps||0,U._timeStep=Q.timeStep||1/60}return U._prepareVRComponent(),Q.autoEnableWebVR&&U.initWebVR(),U}return(0,P.m)(v,w),Object.defineProperty(v,"NpmPackage",{get:function(){return p.d.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(v,"Version",{get:function(){return p.d.Version},enumerable:!1,configurable:!0}),Object.defineProperty(v,"Instances",{get:function(){return a.e.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(v,"LastCreatedEngine",{get:function(){return a.e.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(v,"LastCreatedScene",{get:function(){return a.e.LastCreatedScene},enumerable:!1,configurable:!0}),v.prototype._createImageBitmapFromSource=function(w,v){var I=this;return new Promise((function(P,u){var Q=new Image;Q.onload=function(){Q.decode().then((function(){I.createImageBitmap(Q,v).then((function(w){P(w)}))}))},Q.onerror=function(){u("Error loading image ".concat(Q.src))},Q.src=w}))},v.prototype.createImageBitmap=function(w,v){return createImageBitmap(w,v)},v.prototype.resizeImageBitmap=function(w,v,I){var P=this.createCanvas(v,I).getContext("2d");if(!P)throw new Error("Unable to get 2d context for resizeImageBitmap");return P.drawImage(w,0,0),P.getImageData(0,0,v,I).data},v.MarkAllMaterialsAsDirty=function(w,I){for(var P=0;P<v.Instances.length;P++)for(var u=v.Instances[P],Q=0;Q<u.scenes.length;Q++)u.scenes[Q].markAllMaterialsAsDirty(w,I)},v.DefaultLoadingScreenFactory=function(w){throw(0,U.e)("LoadingScreen")},Object.defineProperty(v.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!v._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(w){this._compatibilityMode=!0},enumerable:!1,configurable:!0}),v.prototype.getInputElement=function(){return this._renderingCanvas},v.prototype._sharedInit=function(I,P,u){var Q=this;if(w.prototype._sharedInit.call(this,I,P,u),this._onCanvasFocus=function(){Q.onCanvasFocusObservable.notifyObservers(Q)},this._onCanvasBlur=function(){Q.onCanvasBlurObservable.notifyObservers(Q)},this._onCanvasContextMenu=function(w){Q.disableContextMenu&&w.preventDefault()},I.addEventListener("focus",this._onCanvasFocus),I.addEventListener("blur",this._onCanvasBlur),I.addEventListener("contextmenu",this._onCanvasContextMenu),this._onBlur=function(){Q.disablePerformanceMonitorInBackground&&Q._performanceMonitor.disable(),Q._windowIsBackground=!0},this._onFocus=function(){Q.disablePerformanceMonitorInBackground&&Q._performanceMonitor.enable(),Q._windowIsBackground=!1},this._onCanvasPointerOut=function(w){document.elementFromPoint(w.clientX,w.clientY)!==I&&Q.onCanvasPointerOutObservable.notifyObservers(w)},(0,K.r)()){var a=this.getHostWindow();a&&(a.addEventListener("blur",this._onBlur),a.addEventListener("focus",this._onFocus))}I.addEventListener("pointerout",this._onCanvasPointerOut),P||this._disableTouchAction(),!v.audioEngine&&u&&v.AudioEngineFactory&&(v.audioEngine=v.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))},v.prototype.getAspectRatio=function(w,v){void 0===v&&(v=!1);var I=w.viewport;return this.getRenderWidth(v)*I.width/(this.getRenderHeight(v)*I.height)},v.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},v.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},v.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},v.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},v.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},v.prototype.getTimeStep=function(){return 1e3*this._timeStep},v.prototype.generateMipMapsForCubemap=function(w,v){if(void 0===v&&(v=!0),w.generateMipMaps){var I=this._gl;this._bindTextureDirectly(I.TEXTURE_CUBE_MAP,w,!0),I.generateMipmap(I.TEXTURE_CUBE_MAP),v&&this._bindTextureDirectly(I.TEXTURE_CUBE_MAP,null)}},v.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},v.prototype.setDepthBuffer=function(w){this._depthCullingState.depthTest=w},v.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},v.prototype.setDepthWrite=function(w){this._depthCullingState.depthMask=w},v.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},v.prototype.setStencilBuffer=function(w){this._stencilState.stencilTest=w},v.prototype.getStencilMask=function(){return this._stencilState.stencilMask},v.prototype.setStencilMask=function(w){this._stencilState.stencilMask=w},v.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},v.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},v.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},v.prototype.setStencilFunction=function(w){this._stencilState.stencilFunc=w},v.prototype.setStencilFunctionReference=function(w){this._stencilState.stencilFuncRef=w},v.prototype.setStencilFunctionMask=function(w){this._stencilState.stencilFuncMask=w},v.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},v.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},v.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},v.prototype.setStencilOperationFail=function(w){this._stencilState.stencilOpStencilFail=w},v.prototype.setStencilOperationDepthFail=function(w){this._stencilState.stencilOpDepthFail=w},v.prototype.setStencilOperationPass=function(w){this._stencilState.stencilOpStencilDepthPass=w},v.prototype.setDitheringState=function(w){w?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},v.prototype.setRasterizerState=function(w){w?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},v.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},v.prototype.setDepthFunction=function(w){this._depthCullingState.depthFunc=w},v.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},v.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},v.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},v.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},v.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},v.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},v.prototype.setDirectViewport=function(w,v,I,P){var u=this._cachedViewport;return this._cachedViewport=null,this._viewport(w,v,I,P),u},v.prototype.scissorClear=function(w,v,I,P,u){this.enableScissor(w,v,I,P),this.clear(u,!0,!0,!0),this.disableScissor()},v.prototype.enableScissor=function(w,v,I,P){var u=this._gl;u.enable(u.SCISSOR_TEST),u.scissor(w,v,I,P)},v.prototype.disableScissor=function(){var w=this._gl;w.disable(w.SCISSOR_TEST)},v.prototype._reportDrawCall=function(w){void 0===w&&(w=1),this._drawCalls.addCount(w,!1)},v.prototype.initWebVR=function(){throw(0,U.e)("WebVRCamera")},v.prototype._prepareVRComponent=function(){},v.prototype._connectVREvents=function(w,v){},v.prototype._submitVRFrame=function(){},v.prototype.disableVR=function(){},v.prototype.isVRPresenting=function(){return!1},v.prototype._requestVRFrame=function(){},v.prototype._loadFileAsync=function(w,v,I){var P=this;return new Promise((function(u,Q){P._loadFile(w,(function(w){u(w)}),void 0,v,I,(function(w,v){Q(v)}))}))},v.prototype.getVertexShaderSource=function(w){var v=this._gl.getAttachedShaders(w);return v?this._gl.getShaderSource(v[0]):null},v.prototype.getFragmentShaderSource=function(w){var v=this._gl.getAttachedShaders(w);return v?this._gl.getShaderSource(v[1]):null},v.prototype.setDepthStencilTexture=function(w,v,I,P){void 0!==w&&(v&&(this._boundUniforms[w]=v),I&&I.depthStencilTexture?this._setTexture(w,I,!1,!0,P):this._setTexture(w,null,void 0,void 0,P))},v.prototype.setTextureFromPostProcess=function(w,v,I){var P,u=null;v&&(v._textures.data[v._currentRenderTextureInd]?u=v._textures.data[v._currentRenderTextureInd]:v._forcedOutputTexture&&(u=v._forcedOutputTexture)),this._bindTexture(w,null!==(P=null===u||void 0===u?void 0:u.texture)&&void 0!==P?P:null,I)},v.prototype.setTextureFromPostProcessOutput=function(w,v,I){var P,u;this._bindTexture(w,null!==(u=null===(P=null===v||void 0===v?void 0:v._outputTexture)||void 0===P?void 0:P.texture)&&void 0!==u?u:null,I)},v.prototype._rebuildBuffers=function(){for(var v=0,I=this.scenes;v<I.length;v++){(Q=I[v]).resetCachedMaterial(),Q._rebuildGeometries(),Q._rebuildTextures()}for(var P=0,u=this._virtualScenes;P<u.length;P++){var Q;(Q=u[P]).resetCachedMaterial(),Q._rebuildGeometries(),Q._rebuildTextures()}w.prototype._rebuildBuffers.call(this)},v.prototype._renderFrame=function(){for(var w=0;w<this._activeRenderLoops.length;w++){(0,this._activeRenderLoops[w])()}},v.prototype._renderLoop=function(){if(!this._contextWasLost){var w=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(w=!1),w&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},v.prototype._renderViews=function(){return!1},v.prototype.switchFullscreen=function(w){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(w)},v.prototype.enterFullscreen=function(w){this.isFullscreen||(this._pointerLockRequested=w,this._renderingCanvas&&v._RequestFullscreen(this._renderingCanvas))},v.prototype.exitFullscreen=function(){this.isFullscreen&&v._ExitFullscreen()},v.prototype.enterPointerlock=function(){this._renderingCanvas&&v._RequestPointerlock(this._renderingCanvas)},v.prototype.exitPointerlock=function(){v._ExitPointerlock()},v.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),w.prototype.beginFrame.call(this)},v.prototype.endFrame=function(){w.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},v.prototype.resize=function(v){void 0===v&&(v=!1),this.isVRPresenting()||w.prototype.resize.call(this,v)},v.prototype.setSize=function(v,I,P){if(void 0===P&&(P=!1),!this._renderingCanvas)return!1;if(!w.prototype.setSize.call(this,v,I,P))return!1;if(this.scenes){for(var u=0;u<this.scenes.length;u++)for(var Q=this.scenes[u],K=0;K<Q.cameras.length;K++){Q.cameras[K]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},v.prototype._deletePipelineContext=function(v){var I=v;I&&I.program&&I.transformFeedback&&(this.deleteTransformFeedback(I.transformFeedback),I.transformFeedback=null),w.prototype._deletePipelineContext.call(this,v)},v.prototype.createShaderProgram=function(v,I,P,u,Q,K){void 0===K&&(K=null),Q=Q||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var a=w.prototype.createShaderProgram.call(this,v,I,P,u,Q,K);return this.onAfterShaderCompilationObservable.notifyObservers(this),a},v.prototype._createShaderProgram=function(w,v,I,P,u){void 0===u&&(u=null);var Q=P.createProgram();if(w.program=Q,!Q)throw new Error("Unable to create program");if(P.attachShader(Q,v),P.attachShader(Q,I),this.webGLVersion>1&&u){var K=this.createTransformFeedback();this.bindTransformFeedback(K),this.setTranformFeedbackVaryings(Q,u),w.transformFeedback=K}return P.linkProgram(Q),this.webGLVersion>1&&u&&this.bindTransformFeedback(null),w.context=P,w.vertexShader=v,w.fragmentShader=I,w.isParallelCompiled||this._finalizePipelineContext(w),Q},v.prototype._releaseTexture=function(v){w.prototype._releaseTexture.call(this,v)},v.prototype._releaseRenderTargetWrapper=function(v){w.prototype._releaseRenderTargetWrapper.call(this,v),this.scenes.forEach((function(w){w.postProcesses.forEach((function(w){w._outputTexture===v&&(w._outputTexture=null)})),w.cameras.forEach((function(w){w._postProcesses.forEach((function(w){w&&w._outputTexture===v&&(w._outputTexture=null)}))}))}))},v.prototype.getRenderPassNames=function(){return this._renderPassNames},v.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},v.prototype.createRenderPassId=function(w){var I=++v._RenderPassIdCounter;return this._renderPassNames[I]=null!==w&&void 0!==w?w:"NONAME",I},v.prototype.releaseRenderPassId=function(w){this._renderPassNames[w]=void 0;for(var v=0;v<this.scenes.length;++v)for(var I=this.scenes[v],P=0;P<I.meshes.length;++P){var u=I.meshes[P];if(u.subMeshes)for(var Q=0;Q<u.subMeshes.length;++Q){u.subMeshes[Q]._removeDrawWrapper(w)}}},v.prototype._rescaleTexture=function(w,I,P,u,Q){var K=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var a=this.createRenderTargetTexture({width:I.width,height:I.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&v._RescalePostProcessFactory&&(this._rescalePostProcess=v._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((function(){K._rescalePostProcess.onApply=function(v){v._bindTexture("textureSampler",w)};var v=P;v||(v=K.scenes[K.scenes.length-1]),v.postProcessManager.directRender([K._rescalePostProcess],a,!0),K._bindTextureDirectly(K._gl.TEXTURE_2D,I,!0),K._gl.copyTexImage2D(K._gl.TEXTURE_2D,0,u,0,0,I.width,I.height,0),K.unBindFramebuffer(a),a.dispose(),Q&&Q()}))},v.prototype.getFps=function(){return this._fps},v.prototype.getDeltaTime=function(){return this._deltaTime},v.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},v.prototype.wrapWebGLTexture=function(w){var v=new x.d(w,this._gl),I=new Q.h(this,Q.e.Unknown,!0);return I._hardwareTexture=v,I.isReady=!0,I},v.prototype._uploadImageToTexture=function(w,v,I,P){void 0===I&&(I=0),void 0===P&&(P=0);var u=this._gl,Q=this._getWebGLTextureType(w.type),K=this._getInternalFormat(w.format),a=this._getRGBABufferInternalSizedFormat(w.type,K),U=w.isCube?u.TEXTURE_CUBE_MAP:u.TEXTURE_2D;this._bindTextureDirectly(U,w,!0),this._unpackFlipY(w.invertY);var p=u.TEXTURE_2D;w.isCube&&(p=u.TEXTURE_CUBE_MAP_POSITIVE_X+I),u.texImage2D(p,P,a,K,Q,v),this._bindTextureDirectly(U,null,!0)},v.prototype.updateTextureComparisonFunction=function(w,v){if(1!==this.webGLVersion){var I=this._gl;w.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,w,!0),0===v?(I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_COMPARE_FUNC,515),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_COMPARE_MODE,I.NONE)):(I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_COMPARE_FUNC,v),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_COMPARE_MODE,I.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,w,!0),0===v?(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_COMPARE_FUNC,515),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_COMPARE_MODE,I.NONE)):(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_COMPARE_FUNC,v),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_COMPARE_MODE,I.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),w._comparisonFunction=v}else R.e.Error("WebGL 1 does not support texture comparison.")},v.prototype.createInstancesBuffer=function(w){var v=this._gl.createBuffer();if(!v)throw new Error("Unable to create instance buffer");var I=new l.e(v);return I.capacity=w,this.bindArrayBuffer(I),this._gl.bufferData(this._gl.ARRAY_BUFFER,w,this._gl.DYNAMIC_DRAW),I.references=1,I},v.prototype.deleteInstancesBuffer=function(w){this._gl.deleteBuffer(w)},v.prototype._clientWaitAsync=function(w,v,I){void 0===v&&(v=0),void 0===I&&(I=10);var P=this._gl;return new Promise((function(u,Q){!function K(){var a=P.clientWaitSync(w,v,0);a!=P.WAIT_FAILED?a!=P.TIMEOUT_EXPIRED?u():setTimeout(K,I):Q()}()}))},v.prototype._readPixelsAsync=function(w,v,I,P,u,Q,K){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var a=this._gl,U=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,U),a.bufferData(a.PIXEL_PACK_BUFFER,K.byteLength,a.STREAM_READ),a.readPixels(w,v,I,P,u,Q,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var p=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return p?(a.flush(),this._clientWaitAsync(p,0,10).then((function(){return a.deleteSync(p),a.bindBuffer(a.PIXEL_PACK_BUFFER,U),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,K),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(U),K}))):null},v.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===v.Instances.length&&v.audioEngine&&(v.audioEngine.dispose(),v.audioEngine=null),this.disableVR(),(0,K.r)()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu)),(0,K.l)()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),w.prototype.dispose.call(this);var I=v.Instances.indexOf(this);I>=0&&v.Instances.splice(I,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},v.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")},v.prototype.displayLoadingUI=function(){if((0,K.r)()){var w=this.loadingScreen;w&&w.displayLoadingUI()}},v.prototype.hideLoadingUI=function(){if((0,K.r)()){var w=this._loadingScreen;w&&w.hideLoadingUI()}},Object.defineProperty(v.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=v.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(w){this._loadingScreen=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"loadingUIText",{set:function(w){this.loadingScreen.loadingUIText=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"loadingUIBackgroundColor",{set:function(w){this.loadingScreen.loadingUIBackgroundColor=w},enumerable:!1,configurable:!0}),v.prototype.createVideoElement=function(w){return document.createElement("video")},v._RequestPointerlock=function(w){w.requestPointerLock=w.requestPointerLock||w.msRequestPointerLock||w.mozRequestPointerLock||w.webkitRequestPointerLock,w.requestPointerLock&&(w.requestPointerLock(),w.focus())},v._ExitPointerlock=function(){var w=document;document.exitPointerLock=document.exitPointerLock||w.msExitPointerLock||w.mozExitPointerLock||w.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},v._RequestFullscreen=function(w){var v=w.requestFullscreen||w.msRequestFullscreen||w.webkitRequestFullscreen||w.mozRequestFullScreen;v&&v.call(w)},v._ExitFullscreen=function(){var w=document;document.exitFullscreen?document.exitFullscreen():w.mozCancelFullScreen?w.mozCancelFullScreen():w.webkitCancelFullScreen?w.webkitCancelFullScreen():w.msCancelFullScreen&&w.msCancelFullScreen()},v.prototype.getFontOffset=function(w){var v=document.createElement("span");v.innerHTML="Hg",v.setAttribute("style","font: ".concat(w," !important"));var I=document.createElement("div");I.style.display="inline-block",I.style.width="1px",I.style.height="0px",I.style.verticalAlign="bottom";var P=document.createElement("div");P.style.whiteSpace="nowrap",P.appendChild(v),P.appendChild(I),document.body.appendChild(P);var u=0,Q=0;try{Q=I.getBoundingClientRect().top-v.getBoundingClientRect().top,I.style.verticalAlign="baseline",u=I.getBoundingClientRect().top-v.getBoundingClientRect().top}finally{document.body.removeChild(P)}return{ascent:u,height:Q,descent:Q-u}},v.ALPHA_DISABLE=0,v.ALPHA_ADD=1,v.ALPHA_COMBINE=2,v.ALPHA_SUBTRACT=3,v.ALPHA_MULTIPLY=4,v.ALPHA_MAXIMIZED=5,v.ALPHA_ONEONE=6,v.ALPHA_PREMULTIPLIED=7,v.ALPHA_PREMULTIPLIED_PORTERDUFF=8,v.ALPHA_INTERPOLATE=9,v.ALPHA_SCREENMODE=10,v.DELAYLOADSTATE_NONE=0,v.DELAYLOADSTATE_LOADED=1,v.DELAYLOADSTATE_LOADING=2,v.DELAYLOADSTATE_NOTLOADED=4,v.NEVER=512,v.ALWAYS=519,v.LESS=513,v.EQUAL=514,v.LEQUAL=515,v.GREATER=516,v.GEQUAL=518,v.NOTEQUAL=517,v.KEEP=7680,v.REPLACE=7681,v.INCR=7682,v.DECR=7683,v.INVERT=5386,v.INCR_WRAP=34055,v.DECR_WRAP=34056,v.TEXTURE_CLAMP_ADDRESSMODE=0,v.TEXTURE_WRAP_ADDRESSMODE=1,v.TEXTURE_MIRROR_ADDRESSMODE=2,v.TEXTUREFORMAT_ALPHA=0,v.TEXTUREFORMAT_LUMINANCE=1,v.TEXTUREFORMAT_LUMINANCE_ALPHA=2,v.TEXTUREFORMAT_RGB=4,v.TEXTUREFORMAT_RGBA=5,v.TEXTUREFORMAT_RED=6,v.TEXTUREFORMAT_R=6,v.TEXTUREFORMAT_RG=7,v.TEXTUREFORMAT_RED_INTEGER=8,v.TEXTUREFORMAT_R_INTEGER=8,v.TEXTUREFORMAT_RG_INTEGER=9,v.TEXTUREFORMAT_RGB_INTEGER=10,v.TEXTUREFORMAT_RGBA_INTEGER=11,v.TEXTURETYPE_UNSIGNED_BYTE=0,v.TEXTURETYPE_UNSIGNED_INT=0,v.TEXTURETYPE_FLOAT=1,v.TEXTURETYPE_HALF_FLOAT=2,v.TEXTURETYPE_BYTE=3,v.TEXTURETYPE_SHORT=4,v.TEXTURETYPE_UNSIGNED_SHORT=5,v.TEXTURETYPE_INT=6,v.TEXTURETYPE_UNSIGNED_INTEGER=7,v.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,v.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,v.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,v.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,v.TEXTURETYPE_UNSIGNED_INT_24_8=12,v.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,v.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,v.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,v.TEXTURE_NEAREST_SAMPLINGMODE=1,v.TEXTURE_BILINEAR_SAMPLINGMODE=2,v.TEXTURE_TRILINEAR_SAMPLINGMODE=3,v.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,v.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,v.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,v.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,v.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,v.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,v.TEXTURE_NEAREST_LINEAR=7,v.TEXTURE_NEAREST_NEAREST=1,v.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,v.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,v.TEXTURE_LINEAR_LINEAR=2,v.TEXTURE_LINEAR_NEAREST=12,v.TEXTURE_EXPLICIT_MODE=0,v.TEXTURE_SPHERICAL_MODE=1,v.TEXTURE_PLANAR_MODE=2,v.TEXTURE_CUBIC_MODE=3,v.TEXTURE_PROJECTION_MODE=4,v.TEXTURE_SKYBOX_MODE=5,v.TEXTURE_INVCUBIC_MODE=6,v.TEXTURE_EQUIRECTANGULAR_MODE=7,v.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,v.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,v.SCALEMODE_FLOOR=1,v.SCALEMODE_NEAREST=2,v.SCALEMODE_CEILING=3,v._RescalePostProcessFactory=null,v._RenderPassIdCounter=0,v}(p.d))},78588:function(w,v,I){"use strict";I.d(v,{e:function(){return P}});var P=function(){function w(){}return Object.defineProperty(w,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(w,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),w.Instances=new Array,w._LastCreatedScene=null,w.UseFallbackTexture=!0,w.FallbackTexture="",w}()},30899:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(){}return w.SetMatrixPrecision=function(v){if(w.MatrixTrackPrecisionChange=!1,v&&!w.MatrixUse64Bits&&w.MatrixTrackedMatrices)for(var I=0;I<w.MatrixTrackedMatrices.length;++I){var P=w.MatrixTrackedMatrices[I],u=P._m;P._m=new Array(16);for(var Q=0;Q<16;++Q)P._m[Q]=u[Q]}w.MatrixUse64Bits=v,w.MatrixCurrentType=w.MatrixUse64Bits?Array:Float32Array,w.MatrixTrackedMatrices=null},w.MatrixUse64Bits=!1,w.MatrixTrackPrecisionChange=!0,w.MatrixCurrentType=Float32Array,w.MatrixTrackedMatrices=[],w}()},52311:function(w,v,I){"use strict";I.d(v,{e:function(){return u}});var P=I(60766),u=function(){function w(w,v,I,P){this._textures=null,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=w,this._isCube=v,this._size=I,this._engine=P,this._depthStencilTexture=null}return Object.defineProperty(w.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"depthStencilTextureWithStencil",{get:function(){return this._depthStencilTextureWithStencil},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isCube",{get:function(){return this._isCube},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isMulti",{get:function(){return this._isMulti},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"is2DArray",{get:function(){return this.layers>0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"size",{get:function(){return this.width},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"width",{get:function(){return this._size.width||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"height",{get:function(){return this._size.height||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"layers",{get:function(){return this._size.layers||0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"texture",{get:function(){var w,v;return null!==(v=null===(w=this._textures)||void 0===w?void 0:w[0])&&void 0!==v?v:null},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"samples",{get:function(){var w,v;return null!==(v=null===(w=this.texture)||void 0===w?void 0:w.samples)&&void 0!==v?v:1},enumerable:!1,configurable:!0}),w.prototype.setSamples=function(w,v,I){return void 0===v&&(v=!0),void 0===I&&(I=!1),this.samples!==w||I?this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,w,v):this._engine.updateRenderTargetTextureSampleCount(this,w):w},w.prototype.setTextures=function(w){Array.isArray(w)?this._textures=w:this._textures=w?[w]:null},w.prototype.setTexture=function(w,v,I){void 0===v&&(v=0),void 0===I&&(I=!0),this._textures||(this._textures=[]),this._textures[v]&&I&&this._textures[v].dispose(),this._textures[v]=w},w.prototype.createDepthStencilTexture=function(w,v,I,P,u){var Q;return void 0===w&&(w=0),void 0===v&&(v=!0),void 0===I&&(I=!1),void 0===P&&(P=1),void 0===u&&(u=14),null===(Q=this._depthStencilTexture)||void 0===Q||Q.dispose(),this._depthStencilTextureWithStencil=I,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:v,comparisonFunction:w,generateStencil:I,isCube:this._isCube,samples:P,depthTextureFormat:u},this),this._depthStencilTexture},w.prototype._shareDepth=function(w){this._depthStencilTexture&&(w._depthStencilTexture&&w._depthStencilTexture.dispose(),w._depthStencilTexture=this._depthStencilTexture,this._depthStencilTexture.incrementReferences())},w.prototype._swapAndDie=function(w){this.texture&&this.texture._swapAndDie(w),this._textures=null,this.dispose(!0)},w.prototype._cloneRenderTargetWrapper=function(){var w,v,I,u,Q,K,a=null;if(this._isMulti){var U=this.textures;if(U&&U.length>0){var p=!1,r=U.length,Y=U[U.length-1]._source;Y!==P.e.Depth&&Y!==P.e.DepthStencil||(p=!0,r--);for(var g=[],J=[],l=0;l<r;++l){var R=U[l];g.push(R.samplingMode),J.push(R.type)}var x={samplingModes:g,generateMipMaps:U[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:p,types:J,textureCount:r},j={width:this.width,height:this.height};a=this._engine.createMultipleRenderTarget(j,x)}}else{var s={};if(s.generateDepthBuffer=this._generateDepthBuffer,s.generateMipMaps=null!==(v=null===(w=this.texture)||void 0===w?void 0:w.generateMipMaps)&&void 0!==v&&v,s.generateStencilBuffer=this._generateStencilBuffer,s.samplingMode=null===(I=this.texture)||void 0===I?void 0:I.samplingMode,s.type=null===(u=this.texture)||void 0===u?void 0:u.type,s.format=null===(Q=this.texture)||void 0===Q?void 0:Q.format,this.isCube)a=this._engine.createRenderTargetCubeTexture(this.width,s);else{j={width:this.width,height:this.height,layers:this.is2DArray?null===(K=this.texture)||void 0===K?void 0:K.depth:void 0};a=this._engine.createRenderTargetTexture(j,s)}a.texture.isReady=!0}return a},w.prototype._swapRenderTargetWrapper=function(w){if(this._textures&&w._textures)for(var v=0;v<this._textures.length;++v)this._textures[v]._swapAndDie(w._textures[v],!1),w._textures[v].isReady=!0;this._depthStencilTexture&&w._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(w._depthStencilTexture),w._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null},w.prototype._rebuild=function(){var w=this._cloneRenderTargetWrapper();if(w){if(this._depthStencilTexture){var v=this._depthStencilTexture.samplingMode,I=2===v||3===v||11===v;w.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,I,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples)}this.samples>1&&w.setSamples(this.samples),w._swapRenderTargetWrapper(this),w.dispose()}},w.prototype.releaseTextures=function(){var w,v;if(this._textures)for(var I=0;null!==(v=I<(null===(w=this._textures)||void 0===w?void 0:w.length))&&void 0!==v&&v;++I)this._textures[I].dispose();this._textures=null},w.prototype.dispose=function(w){var v;void 0===w&&(w=!1),w||(null===(v=this._depthStencilTexture)||void 0===v||v.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)},w}()},16179:function(w,v,I){"use strict";I.d(v,{c:function(){return u}});var P=I(56591),u=function(){function w(){}return w.GetShadersRepository=function(v){return void 0===v&&(v=P.d.GLSL),v===P.d.GLSL?w.ShadersRepository:w.ShadersRepositoryWGSL},w.GetShadersStore=function(v){return void 0===v&&(v=P.d.GLSL),v===P.d.GLSL?w.ShadersStore:w.ShadersStoreWGSL},w.GetIncludesShadersStore=function(v){return void 0===v&&(v=P.d.GLSL),v===P.d.GLSL?w.IncludesShadersStore:w.IncludesShadersStoreWGSL},w.ShadersRepository="src/Shaders/",w.ShadersStore={},w.IncludesShadersStore={},w.ShadersRepositoryWGSL="src/ShadersWGSL/",w.ShadersStoreWGSL={},w.IncludesShadersStoreWGSL={},w}()},72284:function(w,v,I){"use strict";I.d(v,{d:function(){return o}});var P=I(78502),u=I(78588),Q=I(90559),K=I(50504),a=I(9271),U=function(){function w(w){void 0===w&&(w=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,w&&this.reset()}return Object.defineProperty(w.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"zOffset",{get:function(){return this._zOffset},set:function(w){this._zOffset!==w&&(this._zOffset=w,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(w){this._zOffsetUnits!==w&&(this._zOffsetUnits=w,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"cullFace",{get:function(){return this._cullFace},set:function(w){this._cullFace!==w&&(this._cullFace=w,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"cull",{get:function(){return this._cull},set:function(w){this._cull!==w&&(this._cull=w,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(w){this._depthFunc!==w&&(this._depthFunc=w,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"depthMask",{get:function(){return this._depthMask},set:function(w){this._depthMask!==w&&(this._depthMask=w,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"depthTest",{get:function(){return this._depthTest},set:function(w){this._depthTest!==w&&(this._depthTest=w,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"frontFace",{get:function(){return this._frontFace},set:function(w){this._frontFace!==w&&(this._frontFace=w,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),w.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},w.prototype.apply=function(w){this.isDirty&&(this._isCullDirty&&(this.cull?w.enable(w.CULL_FACE):w.disable(w.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(w.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(w.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?w.enable(w.DEPTH_TEST):w.disable(w.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(w.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(w.enable(w.POLYGON_OFFSET_FILL),w.polygonOffset(this.zOffset,this.zOffsetUnits)):w.disable(w.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(w.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},w}(),p=function(){function w(){this.reset()}return w.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=w.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=w.KEEP,this.opDepthFail=w.KEEP,this.opStencilDepthPass=w.REPLACE},Object.defineProperty(w.prototype,"stencilFunc",{get:function(){return this.func},set:function(w){this.func=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(w){this.funcRef=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(w){this.funcMask=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilOpStencilFail",{get:function(){return this.opStencilFail},set:function(w){this.opStencilFail=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilOpDepthFail",{get:function(){return this.opDepthFail},set:function(w){this.opDepthFail=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilOpStencilDepthPass",{get:function(){return this.opStencilDepthPass},set:function(w){this.opStencilDepthPass=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilMask",{get:function(){return this.mask},set:function(w){this.mask=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilTest",{get:function(){return this.enabled},set:function(w){this.enabled=w},enumerable:!1,configurable:!0}),w.ALWAYS=519,w.KEEP=7680,w.REPLACE=7681,w}(),r=function(){function w(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return Object.defineProperty(w.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(w){this._alphaBlend!==w&&(this._alphaBlend=w,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),w.prototype.setAlphaBlendConstants=function(w,v,I,P){this._blendConstants[0]===w&&this._blendConstants[1]===v&&this._blendConstants[2]===I&&this._blendConstants[3]===P||(this._blendConstants[0]=w,this._blendConstants[1]=v,this._blendConstants[2]=I,this._blendConstants[3]=P,this._isBlendConstantsDirty=!0)},w.prototype.setAlphaBlendFunctionParameters=function(w,v,I,P){this._blendFunctionParameters[0]===w&&this._blendFunctionParameters[1]===v&&this._blendFunctionParameters[2]===I&&this._blendFunctionParameters[3]===P||(this._blendFunctionParameters[0]=w,this._blendFunctionParameters[1]=v,this._blendFunctionParameters[2]=I,this._blendFunctionParameters[3]=P,this._isBlendFunctionParametersDirty=!0)},w.prototype.setAlphaEquationParameters=function(w,v){this._blendEquationParameters[0]===w&&this._blendEquationParameters[1]===v||(this._blendEquationParameters[0]=w,this._blendEquationParameters[1]=v,this._isBlendEquationParametersDirty=!0)},w.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},w.prototype.apply=function(w){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?w.enable(w.BLEND):w.disable(w.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(w.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(w.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(w.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},w}(),Y=I(60766),g=I(9127),J=I(60985),l=I(56591),R=function(){function w(){this.shaderLanguage=l.d.GLSL}return w.prototype.postProcessor=function(w,v,I,P,u){if(!u.getCaps().drawBuffersExtension){w=w.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")}return w},w}(),x=function(){function w(){this.shaderLanguage=l.d.GLSL}return w.prototype.attributeProcessor=function(w){return w.replace("attribute","in")},w.prototype.varyingProcessor=function(w,v){return w.replace("varying",v?"in":"out")},w.prototype.postProcessor=function(w,v,I){var P=-1!==w.search(/#extension.+GL_EXT_draw_buffers.+require/);if(w=(w=w.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),I)w=(w=(w=(w=(w=(w=(w=w.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(P?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==v.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+w;return w},w}(),j=I(12753),s=function(){function w(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(w.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),w.prototype._handlesSpectorRebuildCallback=function(w){w&&this.program&&w(this.program)},w.prototype._fillEffectInformation=function(w,v,I,P,u,Q,K,a){var U,p=this.engine;if(p.supportsUniformBuffers)for(var r in v)w.bindUniformBlock(r,v[r]);for(this.engine.getUniforms(this,I).forEach((function(w,v){P[I[v]]=w})),this._uniforms=P,U=0;U<u.length;U++){null==w.getUniform(u[U])&&(u.splice(U,1),U--)}u.forEach((function(w,v){Q[w]=v}));for(var Y=0,g=p.getAttributes(this,K);Y<g.length;Y++){var J=g[Y];a.push(J)}},w.prototype.dispose=function(){this._uniforms={}},w.prototype._cacheMatrix=function(w,v){var I=this._valueCache[w],P=v.updateFlag;return(void 0===I||I!==P)&&(this._valueCache[w]=P,!0)},w.prototype._cacheFloat2=function(w,v,I){var P=this._valueCache[w];if(!P||2!==P.length)return P=[v,I],this._valueCache[w]=P,!0;var u=!1;return P[0]!==v&&(P[0]=v,u=!0),P[1]!==I&&(P[1]=I,u=!0),u},w.prototype._cacheFloat3=function(w,v,I,P){var u=this._valueCache[w];if(!u||3!==u.length)return u=[v,I,P],this._valueCache[w]=u,!0;var Q=!1;return u[0]!==v&&(u[0]=v,Q=!0),u[1]!==I&&(u[1]=I,Q=!0),u[2]!==P&&(u[2]=P,Q=!0),Q},w.prototype._cacheFloat4=function(w,v,I,P,u){var Q=this._valueCache[w];if(!Q||4!==Q.length)return Q=[v,I,P,u],this._valueCache[w]=Q,!0;var K=!1;return Q[0]!==v&&(Q[0]=v,K=!0),Q[1]!==I&&(Q[1]=I,K=!0),Q[2]!==P&&(Q[2]=P,K=!0),Q[3]!==u&&(Q[3]=u,K=!0),K},w.prototype.setInt=function(w,v){var I=this._valueCache[w];void 0!==I&&I===v||this.engine.setInt(this._uniforms[w],v)&&(this._valueCache[w]=v)},w.prototype.setInt2=function(w,v,I){this._cacheFloat2(w,v,I)&&(this.engine.setInt2(this._uniforms[w],v,I)||(this._valueCache[w]=null))},w.prototype.setInt3=function(w,v,I,P){this._cacheFloat3(w,v,I,P)&&(this.engine.setInt3(this._uniforms[w],v,I,P)||(this._valueCache[w]=null))},w.prototype.setInt4=function(w,v,I,P,u){this._cacheFloat4(w,v,I,P,u)&&(this.engine.setInt4(this._uniforms[w],v,I,P,u)||(this._valueCache[w]=null))},w.prototype.setIntArray=function(w,v){this._valueCache[w]=null,this.engine.setIntArray(this._uniforms[w],v)},w.prototype.setIntArray2=function(w,v){this._valueCache[w]=null,this.engine.setIntArray2(this._uniforms[w],v)},w.prototype.setIntArray3=function(w,v){this._valueCache[w]=null,this.engine.setIntArray3(this._uniforms[w],v)},w.prototype.setIntArray4=function(w,v){this._valueCache[w]=null,this.engine.setIntArray4(this._uniforms[w],v)},w.prototype.setArray=function(w,v){this._valueCache[w]=null,this.engine.setArray(this._uniforms[w],v)},w.prototype.setArray2=function(w,v){this._valueCache[w]=null,this.engine.setArray2(this._uniforms[w],v)},w.prototype.setArray3=function(w,v){this._valueCache[w]=null,this.engine.setArray3(this._uniforms[w],v)},w.prototype.setArray4=function(w,v){this._valueCache[w]=null,this.engine.setArray4(this._uniforms[w],v)},w.prototype.setMatrices=function(w,v){v&&(this._valueCache[w]=null,this.engine.setMatrices(this._uniforms[w],v))},w.prototype.setMatrix=function(w,v){this._cacheMatrix(w,v)&&(this.engine.setMatrices(this._uniforms[w],v.toArray())||(this._valueCache[w]=null))},w.prototype.setMatrix3x3=function(w,v){this._valueCache[w]=null,this.engine.setMatrix3x3(this._uniforms[w],v)},w.prototype.setMatrix2x2=function(w,v){this._valueCache[w]=null,this.engine.setMatrix2x2(this._uniforms[w],v)},w.prototype.setFloat=function(w,v){var I=this._valueCache[w];void 0!==I&&I===v||this.engine.setFloat(this._uniforms[w],v)&&(this._valueCache[w]=v)},w.prototype.setVector2=function(w,v){this._cacheFloat2(w,v.x,v.y)&&(this.engine.setFloat2(this._uniforms[w],v.x,v.y)||(this._valueCache[w]=null))},w.prototype.setFloat2=function(w,v,I){this._cacheFloat2(w,v,I)&&(this.engine.setFloat2(this._uniforms[w],v,I)||(this._valueCache[w]=null))},w.prototype.setVector3=function(w,v){this._cacheFloat3(w,v.x,v.y,v.z)&&(this.engine.setFloat3(this._uniforms[w],v.x,v.y,v.z)||(this._valueCache[w]=null))},w.prototype.setFloat3=function(w,v,I,P){this._cacheFloat3(w,v,I,P)&&(this.engine.setFloat3(this._uniforms[w],v,I,P)||(this._valueCache[w]=null))},w.prototype.setVector4=function(w,v){this._cacheFloat4(w,v.x,v.y,v.z,v.w)&&(this.engine.setFloat4(this._uniforms[w],v.x,v.y,v.z,v.w)||(this._valueCache[w]=null))},w.prototype.setQuaternion=function(w,v){this._cacheFloat4(w,v.x,v.y,v.z,v.w)&&(this.engine.setFloat4(this._uniforms[w],v.x,v.y,v.z,v.w)||(this._valueCache[w]=null))},w.prototype.setFloat4=function(w,v,I,P,u){this._cacheFloat4(w,v,I,P,u)&&(this.engine.setFloat4(this._uniforms[w],v,I,P,u)||(this._valueCache[w]=null))},w.prototype.setColor3=function(w,v){this._cacheFloat3(w,v.r,v.g,v.b)&&(this.engine.setFloat3(this._uniforms[w],v.r,v.g,v.b)||(this._valueCache[w]=null))},w.prototype.setColor4=function(w,v,I){this._cacheFloat4(w,v.r,v.g,v.b,I)&&(this.engine.setFloat4(this._uniforms[w],v.r,v.g,v.b,I)||(this._valueCache[w]=null))},w.prototype.setDirectColor4=function(w,v){this._cacheFloat4(w,v.r,v.g,v.b,v.a)&&(this.engine.setFloat4(this._uniforms[w],v.r,v.g,v.b,v.a)||(this._valueCache[w]=null))},w.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},w.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},w}(),B=I(30899),t=I(21867),i=I(61803),z=function(){function w(w){void 0===w&&(w=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,w&&this.reset()}return Object.defineProperty(w.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"func",{get:function(){return this._func},set:function(w){this._func!==w&&(this._func=w,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"funcRef",{get:function(){return this._funcRef},set:function(w){this._funcRef!==w&&(this._funcRef=w,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"funcMask",{get:function(){return this._funcMask},set:function(w){this._funcMask!==w&&(this._funcMask=w,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(w){this._opStencilFail!==w&&(this._opStencilFail=w,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(w){this._opDepthFail!==w&&(this._opDepthFail=w,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(w){this._opStencilDepthPass!==w&&(this._opStencilDepthPass=w,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"mask",{get:function(){return this._mask},set:function(w){this._mask!==w&&(this._mask=w,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"enabled",{get:function(){return this._enabled},set:function(w){this._enabled!==w&&(this._enabled=w,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),w.prototype.reset=function(){var w;this.stencilMaterial=void 0,null===(w=this.stencilGlobal)||void 0===w||w.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},w.prototype.apply=function(w){var v;if(w){var I=!this.useStencilGlobalOnly&&!!(null===(v=this.stencilMaterial)||void 0===v?void 0:v.enabled);this.enabled=I?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=I?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=I?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=I?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=I?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=I?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=I?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=I?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?w.enable(w.STENCIL_TEST):w.disable(w.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(w.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(w.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(w.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}},w}(),E=function(){},o=function(){function w(v,I,P,u){var Q=this;this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new a.c,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new a.c,this.onContextRestoredObservable=new a.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new U,this._stencilStateComposer=new z,this._stencilState=new p,this._alphaState=new r,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this._adaptToDeviceRatio=!1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new a.c,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={};var K=null;if(P=P||{},this._creationOptions=P,this._adaptToDeviceRatio=null!==u&&void 0!==u&&u,this._stencilStateComposer.stencilGlobal=this._stencilState,B.c.SetMatrixPrecision(!!P.useHighPrecisionMatrix),v){if(u=u||P.adaptToDeviceRatio||!1,v.getContext){if(K=v,this._renderingCanvas=K,void 0!==I&&(P.antialias=I),void 0===P.deterministicLockstep&&(P.deterministicLockstep=!1),void 0===P.lockstepMaxSteps&&(P.lockstepMaxSteps=4),void 0===P.timeStep&&(P.timeStep=1/60),void 0===P.preserveDrawingBuffer&&(P.preserveDrawingBuffer=!1),void 0===P.audioEngine&&(P.audioEngine=!0),void 0!==P.audioEngineOptions&&void 0!==P.audioEngineOptions.audioContext&&(this._audioContext=P.audioEngineOptions.audioContext),void 0!==P.audioEngineOptions&&void 0!==P.audioEngineOptions.audioDestination&&(this._audioDestination=P.audioEngineOptions.audioDestination),void 0===P.stencil&&(P.stencil=!0),!1===P.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===P.xrCompatible&&(P.xrCompatible=!0),this._doNotHandleContextLost=!!P.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var w=navigator.userAgent;Q.hostInformation.isMobile=-1!==w.indexOf("Mobile")||-1!==w.indexOf("Mac")&&(0,J.l)()&&"ontouchend"in document},this._checkForMobile(),(0,J.r)()&&window.addEventListener("resize",this._checkForMobile);for(var Y=navigator.userAgent,l=0,j=w.ExceptionList;l<j.length;l++){var s=j[l],t=s.key,i=s.targets;if(new RegExp(t).test(Y)){if(s.capture&&s.captureConstraint){var o=s.capture,h=s.captureConstraint,n=new RegExp(o).exec(Y);if(n&&n.length>0)if(parseInt(n[n.length-1])>=h)continue}for(var W=0,V=i;W<V.length;W++){switch(V[W]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":P.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(w){w.preventDefault(),Q._contextWasLost=!0,g.e.Warn("WebGL context lost."),Q.onContextLostObservable.notifyObservers(Q)},this._onContextRestored=function(){Q._restoreEngineAfterContextLost(Q._initGLContext.bind(Q))},K.addEventListener("webglcontextlost",this._onContextLost,!1),K.addEventListener("webglcontextrestored",this._onContextRestored,!1),P.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(P.xrCompatible=!1),!P.disableWebGL2Support)try{this._gl=K.getContext("webgl2",P)||K.getContext("experimental-webgl2",P),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(w){}if(!this._gl){if(!K)throw new Error("The provided canvas is null or undefined.");try{this._gl=K.getContext("webgl",P)||K.getContext("experimental-webgl",P)}catch(w){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=v,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var F=this._gl.getContextAttributes();F&&(P.stencil=F.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==P.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=P.useHighPrecisionFloats);var O=(0,J.r)()&&window.devicePixelRatio||1,N=P.limitDeviceRatio||O;this._hardwareScalingLevel=u?1/Math.min(N,O):1,this.resize(),this._isStencilEnable=!!P.stencil,this._initGLContext(),this._initFeatures();for(var q=0;q<this._caps.maxVertexAttribs;q++)this._currentBufferPointers[q]=new E;this._shaderProcessor=this.webGLVersion>1?new x:new R,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var m="Babylon.js v".concat(w.Version);console.log(m+" - ".concat(this.description)),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",m)}}return Object.defineProperty(w,"NpmPackage",{get:function(){return"babylonjs@5.14.1"},enumerable:!1,configurable:!0}),Object.defineProperty(w,"Version",{get:function(){return"5.14.1"},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"description",{get:function(){var w=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(w+=" - Parallel shader compilation"),w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"name",{get:function(){return this._name},set:function(w){this._name=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ShadersRepository",{get:function(){return Q.b.ShadersRepository},set:function(w){Q.b.ShadersRepository=w},enumerable:!1,configurable:!0}),w.prototype._getShaderProcessor=function(w){return this._shaderProcessor},Object.defineProperty(w.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(w){w!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=w,this._depthCullingState.depthFunc=w?518:515)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),w.prototype.getCreationOptions=function(){return this._creationOptions},Object.defineProperty(w.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(w){this._doNotHandleContextLost=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"framebufferDimensionsObject",{set:function(w){this._framebufferDimensionsObject=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var w=new Uint8Array(4),v=[w,w,w,w,w,w];this._emptyCubeTexture=this.createRawCubeTexture(v,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"snapshotRendering",{get:function(){return!1},set:function(w){},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(w){this._snapshotRenderingMode=w},enumerable:!1,configurable:!0}),w.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},w._CreateCanvas=function(w,v){if("undefined"===typeof document)return new OffscreenCanvas(w,v);var I=document.createElement("canvas");return I.width=w,I.height=v,I},w.prototype.createCanvas=function(v,I){return w._CreateCanvas(v,I)},w.prototype.createCanvasImage=function(){return document.createElement("img")},w.prototype._restoreEngineAfterContextLost=function(w){var v=this;setTimeout((function(){return(0,P.h)(v,void 0,void 0,(function(){var v,I,u,Q,K;return(0,P.p)(this,(function(P){switch(P.label){case 0:return this._dummyFramebuffer=null,v=this._depthCullingState.depthTest,I=this._depthCullingState.depthFunc,u=this._depthCullingState.depthMask,Q=this._stencilState.stencilTest,[4,w()];case 1:return P.sent(),this._rebuildEffects(),null===(K=this._rebuildComputeEffects)||void 0===K||K.call(this),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=v,this._depthCullingState.depthFunc=I,this._depthCullingState.depthMask=u,this._stencilState.stencilTest=Q,g.e.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}}))}))}),0)},w.prototype._sharedInit=function(w,v,I){this._renderingCanvas=w},w.prototype._getShaderProcessingContext=function(w){return null},w.prototype._rebuildInternalTextures=function(){for(var w=0,v=this._internalTexturesCache.slice();w<v.length;w++){v[w]._rebuild()}},w.prototype._rebuildRenderTargetWrappers=function(){for(var w=0,v=this._renderTargetWrapperCache.slice();w<v.length;w++){v[w]._rebuild()}},w.prototype._rebuildEffects=function(){for(var w in this._compiledEffects){var v=this._compiledEffects[w];v._pipelineContext=null,v._wasPreviouslyReady=!1,v._prepareEffect()}Q.b.ResetCache()},w.prototype.areAllEffectsReady=function(){for(var w in this._compiledEffects){if(!this._compiledEffects[w].isReady())return!1}return!0},w.prototype._rebuildBuffers=function(){for(var w=0,v=this._uniformBuffers;w<v.length;w++){v[w]._rebuild()}for(var I=0,P=this._storageBuffers;I<P.length;I++){P[I]._rebuild()}},w.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var w=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=w&&(this._glRenderer=this._gl.getParameter(w.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(w.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var v=this._gl.getExtension("WEBGL_draw_buffers");if(null!==v){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=v.drawBuffersWEBGL.bind(v),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var I=0;I<16;I++)this._gl["COLOR_ATTACHMENT"+I+"_WEBGL"]=v["COLOR_ATTACHMENT"+I+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var P=this._gl.getExtension("WEBGL_depth_texture");null!=P&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=P.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var u=this._gl.getExtension("OES_vertex_array_object");null!=u&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=u.createVertexArrayOES.bind(u),this._gl.bindVertexArray=u.bindVertexArrayOES.bind(u),this._gl.deleteVertexArray=u.deleteVertexArrayOES.bind(u))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var Q=this._gl.getExtension("ANGLE_instanced_arrays");null!=Q?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=Q.drawArraysInstancedANGLE.bind(Q),this._gl.drawElementsInstanced=Q.drawElementsInstancedANGLE.bind(Q),this._gl.vertexAttribDivisor=Q.vertexAttribDivisorANGLE.bind(Q)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var K=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);K&&a&&(this._caps.highPrecisionShaderSupported=0!==K.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var U=this._gl.getExtension("EXT_blend_minmax");null!=U&&(this._caps.blendMinMax=!0,this._gl.MAX=U.MAX_EXT,this._gl.MIN=U.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var p=this._gl.getExtension("EXT_sRGB");null!=p&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=p.SRGB_EXT,this._gl.SRGB8=p.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=p.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var r=0;r<this._maxSimultaneousTextures;r++)this._nextFreeTextureSlots.push(r)},w.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(w.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),w.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(w.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),w.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var w=this._workingCanvas.getContext("2d");w&&(this._workingContext=w)}},w.prototype.resetTextureCache=function(){for(var w in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,w)&&(this._boundTexturesCache[w]=null);this._currentTextureChannel=-1},w.prototype.getInfo=function(){return this.getGlInfo()},w.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},w.prototype.setHardwareScalingLevel=function(w){this._hardwareScalingLevel=w,this.resize()},w.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},w.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},w.prototype.getCaps=function(){return this._caps},w.prototype.stopRenderLoop=function(w){if(w){var v=this._activeRenderLoops.indexOf(w);v>=0&&this._activeRenderLoops.splice(v,1)}else this._activeRenderLoops=[]},w.prototype._renderLoop=function(){if(!this._contextWasLost){var w=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(w=!1),w){this.beginFrame();for(var v=0;v<this._activeRenderLoops.length;v++){(0,this._activeRenderLoops[v])()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},w.prototype.getRenderingCanvas=function(){return this._renderingCanvas},w.prototype.getAudioContext=function(){return this._audioContext},w.prototype.getAudioDestination=function(){return this._audioDestination},w.prototype.getHostWindow=function(){return(0,J.r)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},w.prototype.getRenderWidth=function(w){return void 0===w&&(w=!1),!w&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},w.prototype.getRenderHeight=function(w){return void 0===w&&(w=!1),!w&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},w.prototype._queueNewFrame=function(v,I){return w.QueueNewFrame(v,I)},w.prototype.runRenderLoop=function(w){-1===this._activeRenderLoops.indexOf(w)&&(this._activeRenderLoops.push(w),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},w.prototype.clear=function(w,v,I,P){void 0===P&&(P=!1);var u=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=u;var Q=0;v&&w&&(this._gl.clearColor(w.r,w.g,w.b,void 0!==w.a?w.a:1),Q|=this._gl.COLOR_BUFFER_BIT),I&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),Q|=this._gl.DEPTH_BUFFER_BIT),P&&(this._gl.clearStencil(0),Q|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(Q)},w.prototype._viewport=function(w,v,I,P){w===this._viewportCached.x&&v===this._viewportCached.y&&I===this._viewportCached.z&&P===this._viewportCached.w||(this._viewportCached.x=w,this._viewportCached.y=v,this._viewportCached.z=I,this._viewportCached.w=P,this._gl.viewport(w,v,I,P))},w.prototype.setViewport=function(w,v,I){var P=v||this.getRenderWidth(),u=I||this.getRenderHeight(),Q=w.x||0,K=w.y||0;this._cachedViewport=w,this._viewport(Q*P,K*u,P*w.width,u*w.height)},w.prototype.beginFrame=function(){},w.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},w.prototype.resize=function(w){var v,I;if(void 0===w&&(w=!1),this._adaptToDeviceRatio){var P=(0,J.r)()&&window.devicePixelRatio||1,u=this._creationOptions.limitDeviceRatio||P;this._hardwareScalingLevel=this._adaptToDeviceRatio?1/Math.min(u,P):1}(0,J.r)()?(v=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,I=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(v=this._renderingCanvas?this._renderingCanvas.width:100,I=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(v/this._hardwareScalingLevel,I/this._hardwareScalingLevel,w)},w.prototype.setSize=function(w,v,I){return void 0===I&&(I=!1),!!this._renderingCanvas&&(w|=0,v|=0,!(!I&&this._renderingCanvas.width===w&&this._renderingCanvas.height===v)&&(this._renderingCanvas.width=w,this._renderingCanvas.height=v,!0))},w.prototype.bindFramebuffer=function(w,v,I,P,u,Q,K){var a,U,p,r,Y;void 0===v&&(v=0),void 0===Q&&(Q=0),void 0===K&&(K=0);var g=w;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=w,this._bindUnboundFramebuffer(g._MSAAFramebuffer?g._MSAAFramebuffer:g._framebuffer);var J=this._gl;w.is2DArray?J.framebufferTextureLayer(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,null===(a=w.texture._hardwareTexture)||void 0===a?void 0:a.underlyingResource,Q,K):w.isCube&&J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_CUBE_MAP_POSITIVE_X+v,null===(U=w.texture._hardwareTexture)||void 0===U?void 0:U.underlyingResource,Q);var l=w._depthStencilTexture;if(l){var R=w._depthStencilTextureWithStencil?J.DEPTH_STENCIL_ATTACHMENT:J.DEPTH_ATTACHMENT;w.is2DArray?J.framebufferTextureLayer(J.FRAMEBUFFER,R,null===(p=l._hardwareTexture)||void 0===p?void 0:p.underlyingResource,Q,K):w.isCube?J.framebufferTexture2D(J.FRAMEBUFFER,R,J.TEXTURE_CUBE_MAP_POSITIVE_X+v,null===(r=l._hardwareTexture)||void 0===r?void 0:r.underlyingResource,Q):J.framebufferTexture2D(J.FRAMEBUFFER,R,J.TEXTURE_2D,null===(Y=l._hardwareTexture)||void 0===Y?void 0:Y.underlyingResource,Q)}this._cachedViewport&&!u?this.setViewport(this._cachedViewport,I,P):(I||(I=w.width,Q&&(I/=Math.pow(2,Q))),P||(P=w.height,Q&&(P/=Math.pow(2,Q))),this._viewport(0,0,I,P)),this.wipeCaches()},w.prototype.setState=function(w,v,I,P,u,Q,K){var a,U;void 0===v&&(v=0),void 0===P&&(P=!1),void 0===K&&(K=0),(this._depthCullingState.cull!==w||I)&&(this._depthCullingState.cull=w);var p=null===(U=null!==(a=this.cullBackFaces)&&void 0!==a?a:u)||void 0===U||U?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==p||I)&&(this._depthCullingState.cullFace=p),this.setZOffset(v),this.setZOffsetUnits(K);var r=P?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==r||I)&&(this._depthCullingState.frontFace=r),this._stencilStateComposer.stencilMaterial=Q},w.prototype.setZOffset=function(w){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-w:w},w.prototype.getZOffset=function(){var w=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-w:w},w.prototype.setZOffsetUnits=function(w){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-w:w},w.prototype.getZOffsetUnits=function(){var w=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-w:w},w.prototype._bindUnboundFramebuffer=function(w){this._currentFramebuffer!==w&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,w),this._currentFramebuffer=w)},w.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentFramebuffer},w.prototype.generateMipmaps=function(w){this._bindTextureDirectly(this._gl.TEXTURE_2D,w,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)},w.prototype.unBindFramebuffer=function(w,v,I){var P;void 0===v&&(v=!1);var u=w;this._currentRenderTarget=null;var Q=this._gl;if(u._MSAAFramebuffer){if(w.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(w,v,I);Q.bindFramebuffer(Q.READ_FRAMEBUFFER,u._MSAAFramebuffer),Q.bindFramebuffer(Q.DRAW_FRAMEBUFFER,u._framebuffer),Q.blitFramebuffer(0,0,w.width,w.height,0,0,w.width,w.height,Q.COLOR_BUFFER_BIT,Q.NEAREST)}!(null===(P=w.texture)||void 0===P?void 0:P.generateMipMaps)||v||w.isCube||this.generateMipmaps(w.texture),I&&(u._MSAAFramebuffer&&this._bindUnboundFramebuffer(u._framebuffer),I()),this._bindUnboundFramebuffer(null)},w.prototype.flushFramebuffer=function(){this._gl.flush()},w.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},w.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},w.prototype.createVertexBuffer=function(w){return this._createVertexBuffer(w,this._gl.STATIC_DRAW)},w.prototype._createVertexBuffer=function(w,v){var I=this._gl.createBuffer();if(!I)throw new Error("Unable to create vertex buffer");var P=new j.e(I);return this.bindArrayBuffer(P),w instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(w),v):this._gl.bufferData(this._gl.ARRAY_BUFFER,w,v),this._resetVertexBufferBinding(),P.references=1,P},w.prototype.createDynamicVertexBuffer=function(w){return this._createVertexBuffer(w,this._gl.DYNAMIC_DRAW)},w.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},w.prototype.createIndexBuffer=function(w,v){var I=this._gl.createBuffer(),P=new j.e(I);if(!I)throw new Error("Unable to create index buffer");this.bindIndexBuffer(P);var u=this._normalizeIndexData(w);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,u,v?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),P.references=1,P.is32Bits=4===u.BYTES_PER_ELEMENT,P},w.prototype._normalizeIndexData=function(w){if(2===w.BYTES_PER_ELEMENT)return w;if(this._caps.uintIndices){if(w instanceof Uint32Array)return w;for(var v=0;v<w.length;v++)if(w[v]>=65535)return new Uint32Array(w);return new Uint16Array(w)}return new Uint16Array(w)},w.prototype.bindArrayBuffer=function(w){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(w,this._gl.ARRAY_BUFFER)},w.prototype.bindUniformBlock=function(w,v,I){var P=w.program,u=this._gl.getUniformBlockIndex(P,v);this._gl.uniformBlockBinding(P,u,I)},w.prototype.bindIndexBuffer=function(w){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(w,this._gl.ELEMENT_ARRAY_BUFFER)},w.prototype._bindBuffer=function(w,v){(this._vaoRecordInProgress||this._currentBoundBuffer[v]!==w)&&(this._gl.bindBuffer(v,w?w.underlyingResource:null),this._currentBoundBuffer[v]=w)},w.prototype.updateArrayBuffer=function(w){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,w)},w.prototype._vertexAttribPointer=function(w,v,I,P,u,Q,K){var a=this._currentBufferPointers[v];if(a){var U=!1;a.active?(a.buffer!==w&&(a.buffer=w,U=!0),a.size!==I&&(a.size=I,U=!0),a.type!==P&&(a.type=P,U=!0),a.normalized!==u&&(a.normalized=u,U=!0),a.stride!==Q&&(a.stride=Q,U=!0),a.offset!==K&&(a.offset=K,U=!0)):(U=!0,a.active=!0,a.index=v,a.size=I,a.type=P,a.normalized=u,a.stride=Q,a.offset=K,a.buffer=w),(U||this._vaoRecordInProgress)&&(this.bindArrayBuffer(w),this._gl.vertexAttribPointer(v,I,P,u,Q,K))}},w.prototype._bindIndexBufferWithCache=function(w){null!=w&&this._cachedIndexBuffer!==w&&(this._cachedIndexBuffer=w,this.bindIndexBuffer(w),this._uintIndicesCurrentlySet=w.is32Bits)},w.prototype._bindVertexBuffersAttributes=function(w,v,I){var P=v.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var u=0;u<P.length;u++){var Q=v.getAttributeLocation(u);if(Q>=0){var K=P[u],a=null;if(I&&(a=I[K]),a||(a=w[K]),!a)continue;this._gl.enableVertexAttribArray(Q),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[Q]=!0);var U=a.getBuffer();U&&(this._vertexAttribPointer(U,Q,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(Q,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(Q),this._currentInstanceBuffers.push(U))))}}},w.prototype.recordVertexArrayObject=function(w,v,I,P){var u=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(u),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(w,I,P),this.bindIndexBuffer(v),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),u},w.prototype.bindVertexArrayObject=function(w,v){this._cachedVertexArrayObject!==w&&(this._cachedVertexArrayObject=w,this._gl.bindVertexArray(w),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=v&&v.is32Bits,this._mustWipeVertexAttributes=!0)},w.prototype.bindBuffersDirectly=function(w,v,I,P,u){if(this._cachedVertexBuffers!==w||this._cachedEffectForVertexBuffers!==u){this._cachedVertexBuffers=w,this._cachedEffectForVertexBuffers=u;var Q=u.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var K=0,a=0;a<Q;a++)if(a<I.length){var U=u.getAttributeLocation(a);U>=0&&(this._gl.enableVertexAttribArray(U),this._vertexAttribArraysEnabled[U]=!0,this._vertexAttribPointer(w,U,I[a],this._gl.FLOAT,!1,P,K)),K+=4*I[a]}}this._bindIndexBufferWithCache(v)},w.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},w.prototype.bindBuffers=function(w,v,I,P){this._cachedVertexBuffers===w&&this._cachedEffectForVertexBuffers===I||(this._cachedVertexBuffers=w,this._cachedEffectForVertexBuffers=I,this._bindVertexBuffersAttributes(w,I,P)),this._bindIndexBufferWithCache(v)},w.prototype.unbindInstanceAttributes=function(){for(var w,v=0,I=this._currentInstanceLocations.length;v<I;v++){var P=this._currentInstanceBuffers[v];w!=P&&P.references&&(w=P,this.bindArrayBuffer(P));var u=this._currentInstanceLocations[v];this._gl.vertexAttribDivisor(u,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},w.prototype.releaseVertexArrayObject=function(w){this._gl.deleteVertexArray(w)},w.prototype._releaseBuffer=function(w){return w.references--,0===w.references&&(this._deleteBuffer(w),!0)},w.prototype._deleteBuffer=function(w){this._gl.deleteBuffer(w.underlyingResource)},w.prototype.updateAndBindInstancesBuffer=function(w,v,I){if(this.bindArrayBuffer(w),v&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,v),void 0!==I[0].index)this.bindInstancesBuffer(w,I,!0);else for(var P=0;P<4;P++){var u=I[P];this._vertexAttribArraysEnabled[u]||(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0),this._vertexAttribPointer(w,u,4,this._gl.FLOAT,!1,64,16*P),this._gl.vertexAttribDivisor(u,1),this._currentInstanceLocations.push(u),this._currentInstanceBuffers.push(w)}},w.prototype.bindInstancesBuffer=function(w,v,I){void 0===I&&(I=!0),this.bindArrayBuffer(w);var P=0;if(I)for(var u=0;u<v.length;u++){P+=4*(Q=v[u]).attributeSize}for(u=0;u<v.length;u++){var Q;void 0===(Q=v[u]).index&&(Q.index=this._currentEffect.getAttributeLocationByName(Q.attributeName)),Q.index<0||(this._vertexAttribArraysEnabled[Q.index]||(this._gl.enableVertexAttribArray(Q.index),this._vertexAttribArraysEnabled[Q.index]=!0),this._vertexAttribPointer(w,Q.index,Q.attributeSize,Q.attributeType||this._gl.FLOAT,Q.normalized||!1,P,Q.offset),this._gl.vertexAttribDivisor(Q.index,void 0===Q.divisor?1:Q.divisor),this._currentInstanceLocations.push(Q.index),this._currentInstanceBuffers.push(w))}},w.prototype.disableInstanceAttributeByName=function(w){if(this._currentEffect){var v=this._currentEffect.getAttributeLocationByName(w);this.disableInstanceAttribute(v)}},w.prototype.disableInstanceAttribute=function(w){for(var v,I=!1;-1!==(v=this._currentInstanceLocations.indexOf(w));)this._currentInstanceLocations.splice(v,1),this._currentInstanceBuffers.splice(v,1),I=!0,v=this._currentInstanceLocations.indexOf(w);I&&(this._gl.vertexAttribDivisor(w,0),this.disableAttributeByIndex(w))},w.prototype.disableAttributeByIndex=function(w){this._gl.disableVertexAttribArray(w),this._vertexAttribArraysEnabled[w]=!1,this._currentBufferPointers[w].active=!1},w.prototype.draw=function(w,v,I,P){this.drawElementsType(w?0:1,v,I,P)},w.prototype.drawPointClouds=function(w,v,I){this.drawArraysType(2,w,v,I)},w.prototype.drawUnIndexed=function(w,v,I,P){this.drawArraysType(w?0:1,v,I,P)},w.prototype.drawElementsType=function(w,v,I,P){this.applyStates(),this._reportDrawCall();var u=this._drawMode(w),Q=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,K=this._uintIndicesCurrentlySet?4:2;P?this._gl.drawElementsInstanced(u,I,Q,v*K,P):this._gl.drawElements(u,I,Q,v*K)},w.prototype.drawArraysType=function(w,v,I,P){this.applyStates(),this._reportDrawCall();var u=this._drawMode(w);P?this._gl.drawArraysInstanced(u,v,I,P):this._gl.drawArrays(u,v,I)},w.prototype._drawMode=function(w){switch(w){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}},w.prototype._reportDrawCall=function(){},w.prototype._releaseEffect=function(w){if(this._compiledEffects[w._key]){delete this._compiledEffects[w._key];var v=w.getPipelineContext();v&&this._deletePipelineContext(v)}},w.prototype._deletePipelineContext=function(w){var v=w;v&&v.program&&(v.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(v.program))},w.prototype._getGlobalDefines=function(w){if(w)return this.isNDCHalfZRange?w.IS_NDC_HALF_ZRANGE="":delete w.IS_NDC_HALF_ZRANGE,void(this.useReverseDepthBuffer?w.USE_REVERSE_DEPTHBUFFER="":delete w.USE_REVERSE_DEPTHBUFFER);var v="";return this.isNDCHalfZRange&&(v+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(v&&(v+="\n"),v+="#define USE_REVERSE_DEPTHBUFFER"),v},w.prototype.createEffect=function(w,v,I,P,u,K,a,U,p,r){var Y;void 0===r&&(r=l.d.GLSL);var g=w.vertexElement||w.vertex||w.vertexToken||w.vertexSource||w,J=w.fragmentElement||w.fragment||w.fragmentToken||w.fragmentSource||w,R=this._getGlobalDefines(),x=null!==(Y=null!==u&&void 0!==u?u:v.defines)&&void 0!==Y?Y:"";R&&(x+=R);var j=g+"+"+J+"@"+x;if(this._compiledEffects[j]){var s=this._compiledEffects[j];return a&&s.isReady()&&a(s),s}var B=new Q.b(w,v,I,P,this,u,K,a,U,p,j,r);return this._compiledEffects[j]=B,B},w._ConcatenateShader=function(w,v,I){return void 0===I&&(I=""),I+(v?v+"\n":"")+w},w.prototype._compileShader=function(v,I,P,u){return this._compileRawShader(w._ConcatenateShader(v,P,u),I)},w.prototype._compileRawShader=function(w,v){var I=this._gl,P=I.createShader("vertex"===v?I.VERTEX_SHADER:I.FRAGMENT_SHADER);if(!P){for(var u=I.NO_ERROR,Q=I.NO_ERROR;(Q=I.getError())!==I.NO_ERROR;)u=Q;throw new Error("Something went wrong while creating a gl ".concat(v," shader object. gl error=").concat(u,", gl isContextLost=").concat(I.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))}return I.shaderSource(P,w),I.compileShader(P),P},w.prototype._getShaderSource=function(w){return this._gl.getShaderSource(w)},w.prototype.createRawShaderProgram=function(w,v,I,P,u){void 0===u&&(u=null),P=P||this._gl;var Q=this._compileRawShader(v,"vertex"),K=this._compileRawShader(I,"fragment");return this._createShaderProgram(w,Q,K,P,u)},w.prototype.createShaderProgram=function(w,v,I,P,u,Q){void 0===Q&&(Q=null),u=u||this._gl;var K=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(v,"vertex",P,K),U=this._compileShader(I,"fragment",P,K);return this._createShaderProgram(w,a,U,u,Q)},w.prototype.inlineShaderCode=function(w){return w},w.prototype.createPipelineContext=function(w){var v=new s;return v.engine=this,this._caps.parallelShaderCompile&&(v.isParallelCompiled=!0),v},w.prototype.createMaterialContext=function(){},w.prototype.createDrawContext=function(){},w.prototype._createShaderProgram=function(w,v,I,P,u){void 0===u&&(u=null);var Q=P.createProgram();if(w.program=Q,!Q)throw new Error("Unable to create program");return P.attachShader(Q,v),P.attachShader(Q,I),P.linkProgram(Q),w.context=P,w.vertexShader=v,w.fragmentShader=I,w.isParallelCompiled||this._finalizePipelineContext(w),Q},w.prototype._finalizePipelineContext=function(w){var v=w.context,I=w.vertexShader,P=w.fragmentShader,u=w.program;if(!v.getProgramParameter(u,v.LINK_STATUS)){var Q,K;if(!this._gl.getShaderParameter(I,this._gl.COMPILE_STATUS))if(Q=this._gl.getShaderInfoLog(I))throw w.vertexCompilationError=Q,new Error("VERTEX SHADER "+Q);if(!this._gl.getShaderParameter(P,this._gl.COMPILE_STATUS))if(Q=this._gl.getShaderInfoLog(P))throw w.fragmentCompilationError=Q,new Error("FRAGMENT SHADER "+Q);if(K=v.getProgramInfoLog(u))throw w.programLinkError=K,new Error(K)}if(this.validateShaderPrograms&&(v.validateProgram(u),!v.getProgramParameter(u,v.VALIDATE_STATUS)&&(K=v.getProgramInfoLog(u))))throw w.programValidationError=K,new Error(K);v.deleteShader(I),v.deleteShader(P),w.vertexShader=void 0,w.fragmentShader=void 0,w.onCompiled&&(w.onCompiled(),w.onCompiled=void 0)},w.prototype._preparePipelineContext=function(w,v,I,P,u,Q,K,a,U,p){var r=w;r.program=P?this.createRawShaderProgram(r,v,I,void 0,U):this.createShaderProgram(r,v,I,a,void 0,U),r.program.__SPECTOR_rebuildProgram=K},w.prototype._isRenderingStateCompiled=function(w){var v=w;return!!this._gl.getProgramParameter(v.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(v),!0)},w.prototype._executeWhenRenderingStateIsCompiled=function(w,v){var I=w;if(I.isParallelCompiled){var P=I.onCompiled;I.onCompiled=P?function(){P(),v()}:v}else v()},w.prototype.getUniforms=function(w,v){for(var I=new Array,P=w,u=0;u<v.length;u++)I.push(this._gl.getUniformLocation(P.program,v[u]));return I},w.prototype.getAttributes=function(w,v){for(var I=[],P=w,u=0;u<v.length;u++)try{I.push(this._gl.getAttribLocation(P.program,v[u]))}catch(w){I.push(-1)}return I},w.prototype.enableEffect=function(w){(w=null!==w&&i.c.IsWrapper(w)?w.effect:w)&&w!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,w=w,this.bindSamplers(w),this._currentEffect=w,w.onBind&&w.onBind(w),w._onBindObservable&&w._onBindObservable.notifyObservers(w))},w.prototype.setInt=function(w,v){return!!w&&(this._gl.uniform1i(w,v),!0)},w.prototype.setInt2=function(w,v,I){return!!w&&(this._gl.uniform2i(w,v,I),!0)},w.prototype.setInt3=function(w,v,I,P){return!!w&&(this._gl.uniform3i(w,v,I,P),!0)},w.prototype.setInt4=function(w,v,I,P,u){return!!w&&(this._gl.uniform4i(w,v,I,P,u),!0)},w.prototype.setIntArray=function(w,v){return!!w&&(this._gl.uniform1iv(w,v),!0)},w.prototype.setIntArray2=function(w,v){return!(!w||v.length%2!==0)&&(this._gl.uniform2iv(w,v),!0)},w.prototype.setIntArray3=function(w,v){return!(!w||v.length%3!==0)&&(this._gl.uniform3iv(w,v),!0)},w.prototype.setIntArray4=function(w,v){return!(!w||v.length%4!==0)&&(this._gl.uniform4iv(w,v),!0)},w.prototype.setArray=function(w,v){return!!w&&(!(v.length<1)&&(this._gl.uniform1fv(w,v),!0))},w.prototype.setArray2=function(w,v){return!(!w||v.length%2!==0)&&(this._gl.uniform2fv(w,v),!0)},w.prototype.setArray3=function(w,v){return!(!w||v.length%3!==0)&&(this._gl.uniform3fv(w,v),!0)},w.prototype.setArray4=function(w,v){return!(!w||v.length%4!==0)&&(this._gl.uniform4fv(w,v),!0)},w.prototype.setMatrices=function(w,v){return!!w&&(this._gl.uniformMatrix4fv(w,!1,v),!0)},w.prototype.setMatrix3x3=function(w,v){return!!w&&(this._gl.uniformMatrix3fv(w,!1,v),!0)},w.prototype.setMatrix2x2=function(w,v){return!!w&&(this._gl.uniformMatrix2fv(w,!1,v),!0)},w.prototype.setFloat=function(w,v){return!!w&&(this._gl.uniform1f(w,v),!0)},w.prototype.setFloat2=function(w,v,I){return!!w&&(this._gl.uniform2f(w,v,I),!0)},w.prototype.setFloat3=function(w,v,I,P){return!!w&&(this._gl.uniform3f(w,v,I,P),!0)},w.prototype.setFloat4=function(w,v,I,P,u){return!!w&&(this._gl.uniform4f(w,v,I,P,u),!0)},w.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var w=this._colorWrite;this._gl.colorMask(w,w,w,w)}},w.prototype.setColorWrite=function(w){w!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=w)},w.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(w.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),w.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},w.prototype.wipeCaches=function(w){this.preventCacheWipeBetweenFrames&&!w||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),w&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},w.prototype._getSamplingParameters=function(w,v){var I=this._gl,P=I.NEAREST,u=I.NEAREST;switch(w){case 11:P=I.LINEAR,u=v?I.LINEAR_MIPMAP_NEAREST:I.LINEAR;break;case 3:P=I.LINEAR,u=v?I.LINEAR_MIPMAP_LINEAR:I.LINEAR;break;case 8:P=I.NEAREST,u=v?I.NEAREST_MIPMAP_LINEAR:I.NEAREST;break;case 4:P=I.NEAREST,u=v?I.NEAREST_MIPMAP_NEAREST:I.NEAREST;break;case 5:P=I.NEAREST,u=v?I.LINEAR_MIPMAP_NEAREST:I.LINEAR;break;case 6:P=I.NEAREST,u=v?I.LINEAR_MIPMAP_LINEAR:I.LINEAR;break;case 7:P=I.NEAREST,u=I.LINEAR;break;case 1:P=I.NEAREST,u=I.NEAREST;break;case 9:P=I.LINEAR,u=v?I.NEAREST_MIPMAP_NEAREST:I.NEAREST;break;case 10:P=I.LINEAR,u=v?I.NEAREST_MIPMAP_LINEAR:I.NEAREST;break;case 2:P=I.LINEAR,u=I.LINEAR;break;case 12:P=I.LINEAR,u=I.NEAREST}return{min:u,mag:P}},w.prototype._createTexture=function(){var w=this._gl.createTexture();if(!w)throw new Error("Unable to create texture");return w},w.prototype._createHardwareTexture=function(){return new t.d(this._createTexture(),this._gl)},w.prototype._createInternalTexture=function(w,v,I,P){void 0===I&&(I=!0),void 0===P&&(P=Y.e.Unknown);var u={};void 0!==v&&"object"===typeof v?(u.generateMipMaps=v.generateMipMaps,u.type=void 0===v.type?0:v.type,u.samplingMode=void 0===v.samplingMode?3:v.samplingMode,u.format=void 0===v.format?5:v.format,u.useSRGBBuffer=void 0!==v.useSRGBBuffer&&v.useSRGBBuffer):(u.generateMipMaps=v,u.type=0,u.samplingMode=3,u.format=5,u.useSRGBBuffer=!1),u.useSRGBBuffer=u.useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU),(1!==u.type||this._caps.textureFloatLinearFiltering)&&(2!==u.type||this._caps.textureHalfFloatLinearFiltering)||(u.samplingMode=1),1!==u.type||this._caps.textureFloat||(u.type=0,g.e.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var Q=this._gl,K=new Y.h(this,P);K._useSRGBBuffer=!!u.useSRGBBuffer;var a=w.width||w,U=w.height||w,p=w.layers||0,r=this._getSamplingParameters(u.samplingMode,!!u.generateMipMaps),J=0!==p?Q.TEXTURE_2D_ARRAY:Q.TEXTURE_2D,l=this._getRGBABufferInternalSizedFormat(u.type,u.format,u.useSRGBBuffer),R=this._getInternalFormat(u.format),x=this._getWebGLTextureType(u.type);return this._bindTextureDirectly(J,K),0!==p?(K.is2DArray=!0,Q.texImage3D(J,0,l,a,U,p,0,R,x,null)):Q.texImage2D(J,0,l,a,U,0,R,x,null),Q.texParameteri(J,Q.TEXTURE_MAG_FILTER,r.mag),Q.texParameteri(J,Q.TEXTURE_MIN_FILTER,r.min),Q.texParameteri(J,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(J,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),u.generateMipMaps&&this._gl.generateMipmap(J),this._bindTextureDirectly(J,null),K.baseWidth=a,K.baseHeight=U,K.width=a,K.height=U,K.depth=p,K.isReady=!0,K.samples=1,K.generateMipMaps=!!u.generateMipMaps,K.samplingMode=u.samplingMode,K.type=u.type,K.format=u.format,this._internalTexturesCache.push(K),K},w.prototype._getUseSRGBBuffer=function(w,v){return w&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||v)},w.prototype._createTextureBase=function(v,I,P,Q,K,a,U,p,r,J,l,R,x,j,s,B){var t=this;void 0===K&&(K=3),void 0===a&&(a=null),void 0===U&&(U=null),void 0===J&&(J=null),void 0===l&&(l=null),void 0===R&&(R=null),void 0===x&&(x=null);var i="data:"===(v=v||"").substr(0,5),z="blob:"===v.substr(0,5),E=i&&-1!==v.indexOf(";base64,"),o=l||new Y.h(this,Y.e.Url),h=v;!this._transformTextureUrl||E||l||J||(v=this._transformTextureUrl(v)),h!==v&&(o._originalUrl=h);var n=v.lastIndexOf("."),W=x||(n>-1?v.substring(n).toLowerCase():""),V=null;W.indexOf("?")>-1&&(W=W.split("?")[0]);for(var F=0,O=w._TextureLoaders;F<O.length;F++){var N=O[F];if(N.canLoad(W,j)){V=N;break}}Q&&Q._addPendingData(o),o.url=v,o.generateMipMaps=!I,o.samplingMode=K,o.invertY=P,o._useSRGBBuffer=this._getUseSRGBBuffer(!!B,I),this._doNotHandleContextLost||(o._buffer=J);var q=null;a&&!l&&(q=o.onLoadedObservable.add(a)),l||this._internalTexturesCache.push(o);var m=function(w,P){Q&&Q._removePendingData(o),v===h?(q&&o.onLoadedObservable.remove(q),u.e.UseFallbackTexture&&t._createTextureBase(u.e.FallbackTexture,I,o.invertY,Q,K,null,U,p,r,J,o),w=(w||"Unknown error")+(u.e.UseFallbackTexture?" - Fallback texture was used":""),o.onErrorObservable.notifyObservers({message:w,exception:P}),U&&U(w,P)):(g.e.Warn("Failed to load ".concat(v,", falling back to ").concat(h)),t._createTextureBase(h,I,o.invertY,Q,K,a,U,p,r,J,o,R,x,j,s,B))};if(V){var c=function(w){V.loadData(w,o,(function(w,v,I,P,u,a){a?m("TextureLoader failed to load data"):p(o,W,Q,{width:w,height:v},o.invertY,!I,P,(function(){return u(),!1}),K)}),s)};J?J instanceof ArrayBuffer?c(new Uint8Array(J)):ArrayBuffer.isView(J)?c(J):U&&U("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(v,(function(w){return c(new Uint8Array(w))}),void 0,Q?Q.offlineProvider:void 0,!0,(function(w,v){m("Unable to load "+(w&&w.responseURL,v))}))}else{var M=function(w){z&&!t._doNotHandleContextLost&&(o._buffer=w),p(o,W,Q,w,o.invertY,I,!1,r,K)};!i||E?J&&("string"===typeof J.decoding||J.close)?M(J):w._FileToolsLoadImage(v,M,m,Q?Q.offlineProvider:null,j,o.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof J||J instanceof ArrayBuffer||ArrayBuffer.isView(J)||J instanceof Blob?w._FileToolsLoadImage(J,M,m,Q?Q.offlineProvider:null,j,o.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):J&&M(J)}return o},w.prototype.createTexture=function(w,v,I,P,u,Q,K,a,U,p,r,g,J,l,R){var x=this;return void 0===u&&(u=3),void 0===Q&&(Q=null),void 0===K&&(K=null),void 0===a&&(a=null),void 0===U&&(U=null),void 0===p&&(p=null),void 0===r&&(r=null),this._createTextureBase(w,v,I,P,u,Q,K,this._prepareWebGLTexture.bind(this),(function(w,v,I,u,Q,K){var a=x._gl,U=I.width===w&&I.height===v,r=p?x._getInternalFormat(p,Q._useSRGBBuffer):".jpg"!==u||Q._useSRGBBuffer?Q._useSRGBBuffer?a.SRGB8_ALPHA8:a.RGBA:a.RGB,g=p?x._getInternalFormat(p):".jpg"!==u||Q._useSRGBBuffer?a.RGBA:a.RGB;if(Q._useSRGBBuffer&&1===x.webGLVersion&&(g=r),U)return a.texImage2D(a.TEXTURE_2D,0,r,g,a.UNSIGNED_BYTE,I),!1;var J=x._caps.maxTextureSize;if(I.width>J||I.height>J||!x._supportsHardwareTextureRescaling)return x._prepareWorkingCanvas(),!(!x._workingCanvas||!x._workingContext)&&(x._workingCanvas.width=w,x._workingCanvas.height=v,x._workingContext.drawImage(I,0,0,I.width,I.height,0,0,w,v),a.texImage2D(a.TEXTURE_2D,0,r,g,a.UNSIGNED_BYTE,x._workingCanvas),Q.width=w,Q.height=v,!1);var l=new Y.h(x,Y.e.Temp);return x._bindTextureDirectly(a.TEXTURE_2D,l,!0),a.texImage2D(a.TEXTURE_2D,0,r,g,a.UNSIGNED_BYTE,I),x._rescaleTexture(l,Q,P,r,(function(){x._releaseTexture(l),x._bindTextureDirectly(a.TEXTURE_2D,Q,!0),K()})),!0}),a,U,p,r,g,J,R)},w._FileToolsLoadImage=function(w,v,I,P,u,Q){throw(0,K.e)("FileTools")},w.prototype._rescaleTexture=function(w,v,I,P,u){},w.prototype.createRawTexture=function(w,v,I,P,u,Q,a,U,p,r,Y){throw void 0===U&&(U=null),void 0===p&&(p=0),void 0===r&&(r=0),void 0===Y&&(Y=!1),(0,K.e)("Engine.RawTexture")},w.prototype.createRawCubeTexture=function(w,v,I,P,u,Q,a,U){throw void 0===U&&(U=null),(0,K.e)("Engine.RawTexture")},w.prototype.createRawTexture3D=function(w,v,I,P,u,Q,a,U,p,r){throw void 0===p&&(p=null),void 0===r&&(r=0),(0,K.e)("Engine.RawTexture")},w.prototype.createRawTexture2DArray=function(w,v,I,P,u,Q,a,U,p,r){throw void 0===p&&(p=null),void 0===r&&(r=0),(0,K.e)("Engine.RawTexture")},w.prototype._unpackFlipY=function(w){this._unpackFlipYCached!==w&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,w?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=w))},w.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},w.prototype._getTextureTarget=function(w){return w.isCube?this._gl.TEXTURE_CUBE_MAP:w.is3D?this._gl.TEXTURE_3D:w.is2DArray||w.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},w.prototype.updateTextureSamplingMode=function(w,v,I){void 0===I&&(I=!1);var P=this._getTextureTarget(v),u=this._getSamplingParameters(w,v.generateMipMaps||I);this._setTextureParameterInteger(P,this._gl.TEXTURE_MAG_FILTER,u.mag,v),this._setTextureParameterInteger(P,this._gl.TEXTURE_MIN_FILTER,u.min),I&&(v.generateMipMaps=!0,this._gl.generateMipmap(P)),this._bindTextureDirectly(P,null),v.samplingMode=w},w.prototype.updateTextureDimensions=function(w,v,I,P){void 0===P&&(P=1)},w.prototype.updateTextureWrappingMode=function(w,v,I,P){void 0===I&&(I=null),void 0===P&&(P=null);var u=this._getTextureTarget(w);null!==v&&(this._setTextureParameterInteger(u,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(v),w),w._cachedWrapU=v),null!==I&&(this._setTextureParameterInteger(u,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(I),w),w._cachedWrapV=I),(w.is2DArray||w.is3D)&&null!==P&&(this._setTextureParameterInteger(u,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(P),w),w._cachedWrapR=P),this._bindTextureDirectly(u,null)},w.prototype._setupDepthStencilTexture=function(w,v,I,P,u,Q){void 0===Q&&(Q=1);var K=v.width||v,a=v.height||v,U=v.layers||0;w.baseWidth=K,w.baseHeight=a,w.width=K,w.height=a,w.is2DArray=U>0,w.depth=U,w.isReady=!0,w.samples=Q,w.generateMipMaps=!1,w.samplingMode=P?2:1,w.type=0,w._comparisonFunction=u;var p=this._gl,r=this._getTextureTarget(w),Y=this._getSamplingParameters(w.samplingMode,!1);p.texParameteri(r,p.TEXTURE_MAG_FILTER,Y.mag),p.texParameteri(r,p.TEXTURE_MIN_FILTER,Y.min),p.texParameteri(r,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(r,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===u?(p.texParameteri(r,p.TEXTURE_COMPARE_FUNC,515),p.texParameteri(r,p.TEXTURE_COMPARE_MODE,p.NONE)):(p.texParameteri(r,p.TEXTURE_COMPARE_FUNC,u),p.texParameteri(r,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE)))},w.prototype._uploadCompressedDataToTextureDirectly=function(w,v,I,P,u,Q,K){void 0===Q&&(Q=0),void 0===K&&(K=0);var a=this._gl,U=a.TEXTURE_2D;if(w.isCube&&(U=a.TEXTURE_CUBE_MAP_POSITIVE_X+Q),w._useSRGBBuffer)switch(v){case 37492:case 36196:this._caps.etc2?v=a.COMPRESSED_SRGB8_ETC2:w._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?v=a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:w._useSRGBBuffer=!1;break;case 36492:v=a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:v=a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?v=a.COMPRESSED_SRGB_S3TC_DXT1_EXT:w._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?v=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:w._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?v=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:w._useSRGBBuffer=!1;break;default:w._useSRGBBuffer=!1}this._gl.compressedTexImage2D(U,K,v,I,P,0,u)},w.prototype._uploadDataToTextureDirectly=function(w,v,I,P,u,Q){void 0===I&&(I=0),void 0===P&&(P=0),void 0===Q&&(Q=!1);var K=this._gl,a=this._getWebGLTextureType(w.type),U=this._getInternalFormat(w.format),p=void 0===u?this._getRGBABufferInternalSizedFormat(w.type,w.format,w._useSRGBBuffer):this._getInternalFormat(u,w._useSRGBBuffer);this._unpackFlipY(w.invertY);var r=K.TEXTURE_2D;w.isCube&&(r=K.TEXTURE_CUBE_MAP_POSITIVE_X+I);var Y=Math.round(Math.log(w.width)*Math.LOG2E),g=Math.round(Math.log(w.height)*Math.LOG2E),J=Q?w.width:Math.pow(2,Math.max(Y-P,0)),l=Q?w.height:Math.pow(2,Math.max(g-P,0));K.texImage2D(r,P,p,J,l,0,U,a,v)},w.prototype.updateTextureData=function(w,v,I,P,u,Q,K,a,U){void 0===K&&(K=0),void 0===a&&(a=0),void 0===U&&(U=!1);var p=this._gl,r=this._getWebGLTextureType(w.type),Y=this._getInternalFormat(w.format);this._unpackFlipY(w.invertY);var g=p.TEXTURE_2D;w.isCube&&(g=p.TEXTURE_CUBE_MAP_POSITIVE_X+K),this._bindTextureDirectly(g,w,!0),p.texSubImage2D(g,a,I,P,u,Q,Y,r,v),U&&this._gl.generateMipmap(g),this._bindTextureDirectly(g,null)},w.prototype._uploadArrayBufferViewToTexture=function(w,v,I,P){void 0===I&&(I=0),void 0===P&&(P=0);var u=this._gl,Q=w.isCube?u.TEXTURE_CUBE_MAP:u.TEXTURE_2D;this._bindTextureDirectly(Q,w,!0),this._uploadDataToTextureDirectly(w,v,I,P),this._bindTextureDirectly(Q,null,!0)},w.prototype._prepareWebGLTextureContinuation=function(w,v,I,P,u){var Q=this._gl;if(Q){var K=this._getSamplingParameters(u,!I);Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,K.mag),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,K.min),I||P||Q.generateMipmap(Q.TEXTURE_2D),this._bindTextureDirectly(Q.TEXTURE_2D,null),v&&v._removePendingData(w),w.onLoadedObservable.notifyObservers(w),w.onLoadedObservable.clear()}},w.prototype._prepareWebGLTexture=function(v,I,P,u,Q,K,a,U,p){var r=this;void 0===p&&(p=3);var Y=this.getCaps().maxTextureSize,g=Math.min(Y,this.needPOTTextures?w.GetExponentOfTwo(u.width,Y):u.width),J=Math.min(Y,this.needPOTTextures?w.GetExponentOfTwo(u.height,Y):u.height),l=this._gl;l&&(v._hardwareTexture?(this._bindTextureDirectly(l.TEXTURE_2D,v,!0),this._unpackFlipY(void 0===Q||!!Q),v.baseWidth=u.width,v.baseHeight=u.height,v.width=g,v.height=J,v.isReady=!0,U(g,J,u,I,v,(function(){r._prepareWebGLTextureContinuation(v,P,K,a,p)}))||this._prepareWebGLTextureContinuation(v,P,K,a,p)):P&&P._removePendingData(v))},w.prototype._setupFramebufferDepthAttachments=function(w,v,I,P,u){void 0===u&&(u=1);var Q=this._gl;if(w&&v)return this._createRenderBuffer(I,P,u,Q.DEPTH_STENCIL,Q.DEPTH24_STENCIL8,Q.DEPTH_STENCIL_ATTACHMENT);if(v){var K=Q.DEPTH_COMPONENT16;return this._webGLVersion>1&&(K=Q.DEPTH_COMPONENT32F),this._createRenderBuffer(I,P,u,K,K,Q.DEPTH_ATTACHMENT)}return w?this._createRenderBuffer(I,P,u,Q.STENCIL_INDEX8,Q.STENCIL_INDEX8,Q.STENCIL_ATTACHMENT):null},w.prototype._createRenderBuffer=function(w,v,I,P,u,Q,K){void 0===K&&(K=!0);var a=this._gl,U=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,U),I>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,I,u,w,v):a.renderbufferStorage(a.RENDERBUFFER,P,w,v),a.framebufferRenderbuffer(a.FRAMEBUFFER,Q,a.RENDERBUFFER,U),K&&a.bindRenderbuffer(a.RENDERBUFFER,null),U},w.prototype._releaseTexture=function(w){var v;this._deleteTexture(null===(v=w._hardwareTexture)||void 0===v?void 0:v.underlyingResource),this.unbindAllTextures();var I=this._internalTexturesCache.indexOf(w);-1!==I&&this._internalTexturesCache.splice(I,1),w._lodTextureHigh&&w._lodTextureHigh.dispose(),w._lodTextureMid&&w._lodTextureMid.dispose(),w._lodTextureLow&&w._lodTextureLow.dispose(),w._irradianceTexture&&w._irradianceTexture.dispose()},w.prototype._releaseRenderTargetWrapper=function(w){var v=this._renderTargetWrapperCache.indexOf(w);-1!==v&&this._renderTargetWrapperCache.splice(v,1)},w.prototype._deleteTexture=function(w){w&&this._gl.deleteTexture(w)},w.prototype._setProgram=function(w){this._currentProgram!==w&&(this._gl.useProgram(w),this._currentProgram=w)},w.prototype.bindSamplers=function(w){var v=w.getPipelineContext();this._setProgram(v.program);for(var I=w.getSamplers(),P=0;P<I.length;P++){var u=w.getUniform(I[P]);u&&(this._boundUniforms[P]=u)}this._currentEffect=null},w.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},w.prototype._bindTextureDirectly=function(w,v,I,P){var u,Q;void 0===I&&(I=!1),void 0===P&&(P=!1);var K=!1,a=v&&v._associatedChannel>-1;if(I&&a&&(this._activeChannel=v._associatedChannel),this._boundTexturesCache[this._activeChannel]!==v||P){if(this._activateCurrentTexture(),v&&v.isMultiview)throw console.error(w,v),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(w,null!==(Q=null===(u=null===v||void 0===v?void 0:v._hardwareTexture)||void 0===u?void 0:u.underlyingResource)&&void 0!==Q?Q:null),this._boundTexturesCache[this._activeChannel]=v,v&&(v._associatedChannel=this._activeChannel)}else I&&(K=!0,this._activateCurrentTexture());return a&&!I&&this._bindSamplerUniformToChannel(v._associatedChannel,this._activeChannel),K},w.prototype._bindTexture=function(w,v,I){if(void 0!==w){v&&(v._associatedChannel=w),this._activeChannel=w;var P=v?this._getTextureTarget(v):this._gl.TEXTURE_2D;this._bindTextureDirectly(P,v)}},w.prototype.unbindAllTextures=function(){for(var w=0;w<this._maxSimultaneousTextures;w++)this._activeChannel=w,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},w.prototype.setTexture=function(w,v,I,P){void 0!==w&&(v&&(this._boundUniforms[w]=v),this._setTexture(w,I))},w.prototype._bindSamplerUniformToChannel=function(w,v){var I=this._boundUniforms[w];I&&I._currentState!==v&&(this._gl.uniform1i(I,v),I._currentState=v)},w.prototype._getTextureWrapMode=function(w){switch(w){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},w.prototype._setTexture=function(w,v,I,P,u){if(void 0===I&&(I=!1),void 0===P&&(P=!1),void 0===u&&(u=""),!v)return null!=this._boundTexturesCache[w]&&(this._activeChannel=w,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(v.video)this._activeChannel=w,v.update();else if(4===v.delayLoadState)return v.delayLoad(),!1;var Q;Q=P?v.depthStencilTexture:v.isReady()?v.getInternalTexture():v.isCube?this.emptyCubeTexture:v.is3D?this.emptyTexture3D:v.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!I&&Q&&(Q._associatedChannel=w);var K=!0;this._boundTexturesCache[w]===Q&&(I||this._bindSamplerUniformToChannel(Q._associatedChannel,w),K=!1),this._activeChannel=w;var a=this._getTextureTarget(Q);if(K&&this._bindTextureDirectly(a,Q,I),Q&&!Q.isMultiview){if(Q.isCube&&Q._cachedCoordinatesMode!==v.coordinatesMode){Q._cachedCoordinatesMode=v.coordinatesMode;var U=3!==v.coordinatesMode&&5!==v.coordinatesMode?1:0;v.wrapU=U,v.wrapV=U}Q._cachedWrapU!==v.wrapU&&(Q._cachedWrapU=v.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(v.wrapU),Q)),Q._cachedWrapV!==v.wrapV&&(Q._cachedWrapV=v.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(v.wrapV),Q)),Q.is3D&&Q._cachedWrapR!==v.wrapR&&(Q._cachedWrapR=v.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(v.wrapR),Q)),this._setAnisotropicLevel(a,Q,v.anisotropicFilteringLevel)}return!0},w.prototype.setTextureArray=function(w,v,I,P){if(void 0!==w&&v){this._textureUnits&&this._textureUnits.length===I.length||(this._textureUnits=new Int32Array(I.length));for(var u=0;u<I.length;u++){var Q=I[u].getInternalTexture();Q?(this._textureUnits[u]=w+u,Q._associatedChannel=w+u):this._textureUnits[u]=-1}this._gl.uniform1iv(v,this._textureUnits);for(var K=0;K<I.length;K++)this._setTexture(this._textureUnits[K],I[K],!0)}},w.prototype._setAnisotropicLevel=function(w,v,I){var P=this._caps.textureAnisotropicFilterExtension;11!==v.samplingMode&&3!==v.samplingMode&&2!==v.samplingMode&&(I=1),P&&v._cachedAnisotropicFilteringLevel!==I&&(this._setTextureParameterFloat(w,P.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(I,this._caps.maxAnisotropy),v),v._cachedAnisotropicFilteringLevel=I)},w.prototype._setTextureParameterFloat=function(w,v,I,P){this._bindTextureDirectly(w,P,!0,!0),this._gl.texParameterf(w,v,I)},w.prototype._setTextureParameterInteger=function(w,v,I,P){P&&this._bindTextureDirectly(w,P,!0,!0),this._gl.texParameteri(w,v,I)},w.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var w=0;w<this._caps.maxVertexAttribs;w++)this.disableAttributeByIndex(w)}else{w=0;for(var v=this._vertexAttribArraysEnabled.length;w<v;w++)w>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[w]||this.disableAttributeByIndex(w)}},w.prototype.releaseEffects=function(){for(var w in this._compiledEffects){var v=this._compiledEffects[w].getPipelineContext();this._deletePipelineContext(v)}this._compiledEffects={}},w.prototype.dispose=function(){var w;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null===(w=this.releaseComputeEffects)||void 0===w||w.call(this),this.unbindAllAttributes(),this._boundUniforms=[],(0,J.r)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,Q.b.ResetCache();for(var v=0,I=this._activeRequests;v<I.length;v++){I[v].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},w.prototype.attachContextLostEvent=function(w){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",w,!1)},w.prototype.attachContextRestoredEvent=function(w){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",w,!1)},w.prototype.getError=function(){return this._gl.getError()},w.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},w.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},w.prototype._canRenderToFramebuffer=function(w){for(var v=this._gl;v.getError()!==v.NO_ERROR;);var I=!0,P=v.createTexture();v.bindTexture(v.TEXTURE_2D,P),v.texImage2D(v.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(w),1,1,0,v.RGBA,this._getWebGLTextureType(w),null),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST);var u=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,u),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,P,0);var Q=v.checkFramebufferStatus(v.FRAMEBUFFER);if((I=(I=I&&Q===v.FRAMEBUFFER_COMPLETE)&&v.getError()===v.NO_ERROR)&&(v.clear(v.COLOR_BUFFER_BIT),I=I&&v.getError()===v.NO_ERROR),I){v.bindFramebuffer(v.FRAMEBUFFER,null);var K=v.RGBA,a=v.UNSIGNED_BYTE,U=new Uint8Array(4);v.readPixels(0,0,1,1,K,a,U),I=I&&v.getError()===v.NO_ERROR}for(v.deleteTexture(P),v.deleteFramebuffer(u),v.bindFramebuffer(v.FRAMEBUFFER,null);!I&&v.getError()!==v.NO_ERROR;);return I},w.prototype._getWebGLTextureType=function(w){if(1===this._webGLVersion){switch(w){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(w){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},w.prototype._getInternalFormat=function(w,v){void 0===v&&(v=!1);var I=v?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(w){case 0:I=this._gl.ALPHA;break;case 1:I=this._gl.LUMINANCE;break;case 2:I=this._gl.LUMINANCE_ALPHA;break;case 6:I=this._gl.RED;break;case 7:I=this._gl.RG;break;case 4:I=v?this._gl.SRGB:this._gl.RGB;break;case 5:I=v?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(w){case 8:I=this._gl.RED_INTEGER;break;case 9:I=this._gl.RG_INTEGER;break;case 10:I=this._gl.RGB_INTEGER;break;case 11:I=this._gl.RGBA_INTEGER}return I},w.prototype._getRGBABufferInternalSizedFormat=function(w,v,I){if(void 0===I&&(I=!1),1===this._webGLVersion){if(void 0!==v)switch(v){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return I?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(w){case 3:switch(v){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(v){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return I?this._gl.SRGB8:this._gl.RGB8;case 5:return I?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(v){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(v){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(v){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(v){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(v){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(v){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(v){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return I?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},w.prototype._getRGBAMultiSampleBufferFormat=function(w){return 1===w?this._gl.RGBA32F:2===w?this._gl.RGBA16F:this._gl.RGBA8},w.prototype._loadFile=function(v,I,P,u,Q,K){var a=this,U=w._FileToolsLoadFile(v,I,P,u,Q,K);return this._activeRequests.push(U),U.onCompleteObservable.add((function(w){a._activeRequests.splice(a._activeRequests.indexOf(w),1)})),U},w._FileToolsLoadFile=function(w,v,I,P,u,Q){throw(0,K.e)("FileTools")},w.prototype.readPixels=function(w,v,I,P,u,Q){void 0===u&&(u=!0),void 0===Q&&(Q=!0);var K=u?4:3,a=u?this._gl.RGBA:this._gl.RGB,U=new Uint8Array(P*I*K);return Q&&this.flushFramebuffer(),this._gl.readPixels(w,v,I,P,a,this._gl.UNSIGNED_BYTE,U),Promise.resolve(U)},Object.defineProperty(w,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(w,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),w.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var w=this._CreateCanvas(1,1),v=w.getContext("webgl")||w.getContext("experimental-webgl");this._IsSupported=null!=v&&!!window.WebGLRenderingContext}catch(w){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(w,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var w=this._CreateCanvas(1,1),v=w.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||w.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!v}catch(w){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),w.CeilingPOT=function(w){return w--,w|=w>>1,w|=w>>2,w|=w>>4,w|=w>>8,w|=w>>16,++w},w.FloorPOT=function(w){return w|=w>>1,w|=w>>2,w|=w>>4,w|=w>>8,(w|=w>>16)-(w>>1)},w.NearestPOT=function(v){var I=w.CeilingPOT(v),P=w.FloorPOT(v);return I-v>v-P?P:I},w.GetExponentOfTwo=function(v,I,P){var u;switch(void 0===P&&(P=2),P){case 1:u=w.FloorPOT(v);break;case 2:u=w.NearestPOT(v);break;default:u=w.CeilingPOT(v)}return Math.min(u,I)},w.QueueNewFrame=function(w,v){return(0,J.r)()?(v||(v=window),v.requestPostAnimationFrame?v.requestPostAnimationFrame(w):v.requestAnimationFrame?v.requestAnimationFrame(w):v.msRequestAnimationFrame?v.msRequestAnimationFrame(w):v.webkitRequestAnimationFrame?v.webkitRequestAnimationFrame(w):v.mozRequestAnimationFrame?v.mozRequestAnimationFrame(w):v.oRequestAnimationFrame?v.oRequestAnimationFrame(w):window.setTimeout(w,16)):"undefined"!==typeof requestAnimationFrame?requestAnimationFrame(w):setTimeout(w,16)},w.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,J.l)()?document:null},w.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],w._TextureLoaders=[],w.CollisionsEpsilon=.001,w._IsSupported=null,w._HasMajorPerformanceCaveat=null,w}()},13316:function(w,v,I){"use strict";var P;I.d(v,{b:function(){return u}}),function(w){w[w.PointerMove=0]="PointerMove",w[w.PointerDown=1]="PointerDown",w[w.PointerUp=2]="PointerUp"}(P||(P={}));var u=function(){function w(){}return w.DOM_DELTA_PIXEL=0,w.DOM_DELTA_LINE=1,w.DOM_DELTA_PAGE=2,w}()},45591:function(w,v,I){"use strict";I.d(v,{d:function(){return u},f:function(){return K},g:function(){return Q}});var P=I(78502),u=function(){function w(){}return w.KEYDOWN=1,w.KEYUP=2,w}(),Q=function(w,v){this.type=w,this.event=v},K=function(w){function v(v,I){var P=w.call(this,v,I)||this;return P.type=v,P.event=I,P.skipOnKeyboardObservable=!1,P}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"skipOnPointerObservable",{get:function(){return this.skipOnKeyboardObservable},set:function(w){this.skipOnKeyboardObservable=w},enumerable:!1,configurable:!0}),v}(Q)},25239:function(w,v,I){"use strict";I.d(v,{e:function(){return Q},i:function(){return a},m:function(){return U}});var P=I(78502),u=I(80105),Q=function(){function w(){}return w.POINTERDOWN=1,w.POINTERUP=2,w.POINTERMOVE=4,w.POINTERWHEEL=8,w.POINTERPICK=16,w.POINTERTAP=32,w.POINTERDOUBLETAP=64,w}(),K=function(w,v){this.type=w,this.event=v},a=function(w){function v(v,I,P,Q){var K=w.call(this,v,I)||this;return K.ray=null,K.skipOnPointerObservable=!1,K.localPosition=new u.k(P,Q),K}return(0,P.m)(v,w),v}(K),U=function(w){function v(v,I,P){var u=w.call(this,v,I)||this;return u.pickInfo=P,u}return(0,P.m)(v,w),v}(K)},23257:function(w,v,I){"use strict";I.r(v),I.d(v,{SceneInstrumentation:function(){return Q}});var P=I(9217),u=I(16945),Q=function(){function w(w){var v=this;this.scene=w,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new u.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new u.e,this._captureFrameTime=!1,this._frameTime=new u.e,this._captureRenderTime=!1,this._renderTime=new u.e,this._captureInterFrameTime=!1,this._interFrameTime=new u.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new u.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new u.e,this._capturePhysicsTime=!1,this._physicsTime=new u.e,this._captureAnimationsTime=!1,this._animationsTime=new u.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new u.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=w.onBeforeAnimationsObservable.add((function(){v._captureActiveMeshesEvaluationTime&&v._activeMeshesEvaluationTime.fetchNewFrame(),v._captureRenderTargetsRenderTime&&v._renderTargetsRenderTime.fetchNewFrame(),v._captureFrameTime&&(P.i.StartPerformanceCounter("Scene rendering"),v._frameTime.beginMonitoring()),v._captureInterFrameTime&&v._interFrameTime.endMonitoring(),v._captureParticlesRenderTime&&v._particlesRenderTime.fetchNewFrame(),v._captureSpritesRenderTime&&v._spritesRenderTime.fetchNewFrame(),v._captureAnimationsTime&&v._animationsTime.beginMonitoring(),v.scene.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=w.onAfterRenderObservable.add((function(){v._captureFrameTime&&(P.i.EndPerformanceCounter("Scene rendering"),v._frameTime.endMonitoring()),v._captureRenderTime&&v._renderTime.endMonitoring(!1),v._captureInterFrameTime&&v._interFrameTime.beginMonitoring()}))}return Object.defineProperty(w.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(w){var v=this;w!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=w,w?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add((function(){P.i.StartPerformanceCounter("Active meshes evaluation"),v._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add((function(){P.i.EndPerformanceCounter("Active meshes evaluation"),v._activeMeshesEvaluationTime.endMonitoring()}))):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(w){var v=this;w!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=w,w?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add((function(){P.i.StartPerformanceCounter("Render targets rendering"),v._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add((function(){P.i.EndPerformanceCounter("Render targets rendering"),v._renderTargetsRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(w){var v=this;w!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=w,w?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add((function(){P.i.StartPerformanceCounter("Particles"),v._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add((function(){P.i.EndPerformanceCounter("Particles"),v._particlesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(w){var v=this;w!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=w,this.scene.spriteManagers&&(w?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add((function(){P.i.StartPerformanceCounter("Sprites"),v._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add((function(){P.i.EndPerformanceCounter("Sprites"),v._spritesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(w){var v=this;w!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=w,w?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add((function(){P.i.StartPerformanceCounter("Physics"),v._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add((function(){P.i.EndPerformanceCounter("Physics"),v._physicsTime.endMonitoring()}))):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(w){var v=this;w!==this._captureAnimationsTime&&(this._captureAnimationsTime=w,w?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add((function(){v._animationsTime.endMonitoring()})):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(w){this._captureFrameTime=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(w){this._captureInterFrameTime=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(w){var v=this;w!==this._captureRenderTime&&(this._captureRenderTime=w,w?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add((function(){v._renderTime.beginMonitoring(),P.i.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add((function(){v._renderTime.endMonitoring(!1),P.i.EndPerformanceCounter("Main render")}))):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(w){var v=this;w!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=w,w?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add((function(w){v._cameraRenderTime.beginMonitoring(),P.i.StartPerformanceCounter("Rendering camera ".concat(w.name))})),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add((function(w){v._cameraRenderTime.endMonitoring(!1),P.i.EndPerformanceCounter("Rendering camera ".concat(w.name))}))):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!1,configurable:!0}),w.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},w}()},23056:function(w,v,I){"use strict";I.d(v,{c:function(){return p}});var P=I(78502),u=I(9892),Q=I(80105),K=I(9488),a=I(74134),U=I(315);a.b.AddNodeConstructor("Light_Type_3",(function(w,v){return function(){return new p(w,Q.l.Zero(),v)}}));var p=function(w){function v(v,I,P){var u=w.call(this,v,P)||this;return u.groundColor=new K.b(0,0,0),u.direction=I||Q.l.Up(),u}return(0,P.m)(v,w),v.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},v.prototype.getClassName=function(){return"HemisphericLight"},v.prototype.setDirectionToTarget=function(w){return this.direction=Q.l.Normalize(w.subtract(Q.l.Zero())),this.direction},v.prototype.getShadowGenerator=function(){return null},v.prototype.transferToEffect=function(w,v){var I=Q.l.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",I.x,I.y,I.z,0,v),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),v),this},v.prototype.transferToNodeMaterialEffect=function(w,v){var I=Q.l.Normalize(this.direction);return w.setFloat3(v,I.x,I.y,I.z),this},v.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=Q.e.Identity()),this._worldMatrix},v.prototype.getTypeID=function(){return U.d.LIGHTTYPEID_HEMISPHERICLIGHT},v.prototype.prepareLightSpecificDefines=function(w,v){w["HEMILIGHT"+v]=!0},(0,P.i)([(0,u.n)()],v.prototype,"groundColor",void 0),(0,P.i)([(0,u.G)()],v.prototype,"direction",void 0),v}(U.d)},315:function(w,v,I){"use strict";I.d(v,{d:function(){return Y}});var P=I(78502),u=I(9892),Q=I(80105),K=I(9488),a=I(74134),U=I(90534),p=I(31709),r=I(21876),Y=function(w){function v(I,P){var u=w.call(this,I,P)||this;return u.diffuse=new K.b(1,1,1),u.specular=new K.b(1,1,1),u.falloffType=v.FALLOFF_DEFAULT,u.intensity=1,u._range=Number.MAX_VALUE,u._inverseSquaredRange=0,u._photometricScale=1,u._intensityMode=v.INTENSITYMODE_AUTOMATIC,u._radius=1e-5,u.renderPriority=0,u._shadowEnabled=!0,u._excludeWithLayerMask=0,u._includeOnlyWithLayerMask=0,u._lightmapMode=0,u._excludedMeshesIds=new Array,u._includedOnlyMeshesIds=new Array,u._isLight=!0,u.getScene().addLight(u),u._uniformBuffer=new U.b(u.getScene().getEngine(),void 0,void 0,I),u._buildUniformLayout(),u.includedOnlyMeshes=new Array,u.excludedMeshes=new Array,u._resyncMeshes(),u}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"range",{get:function(){return this._range},set:function(w){this._range=w,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(w){this._intensityMode=w,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"radius",{get:function(){return this._radius},set:function(w){this._radius=w,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(w){this._shadowEnabled!==w&&(this._shadowEnabled=w,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(w){this._includedOnlyMeshes=w,this._hookArrayForIncludedOnly(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(w){this._excludedMeshes=w,this._hookArrayForExcluded(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(w){this._excludeWithLayerMask=w,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(w){this._includeOnlyWithLayerMask=w,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(w){this._lightmapMode!==w&&(this._lightmapMode=w,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),v.prototype.transferTexturesToEffect=function(w,v){return this},v.prototype._bindLight=function(w,v,I,P,u){void 0===u&&(u=!0);var Q=w.toString(),a=!1;if(this._uniformBuffer.bindToEffect(I,"Light"+Q),this._renderId!==v.getRenderId()||this._lastUseSpecular!==P||!this._uniformBuffer.useUbo){this._renderId=v.getRenderId(),this._lastUseSpecular=P;var U=this.getScaledIntensity();this.transferToEffect(I,Q),this.diffuse.scaleToRef(U,K.g.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",K.g.Color3[0],this.range,Q),P&&(this.specular.scaleToRef(U,K.g.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",K.g.Color3[1],this.radius,Q)),a=!0}if(this.transferTexturesToEffect(I,Q),v.shadowsEnabled&&this.shadowEnabled&&u){var p=this.getShadowGenerator();p&&(p.bindShadowLight(Q,I),a=!0)}a?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()},v.prototype.getClassName=function(){return"Light"},v.prototype.toString=function(w){var v="Name: "+this.name;if(v+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var I=0;I<this.animations.length;I++)v+=", animation[0]: "+this.animations[I].toString(w);return v},v.prototype._syncParentEnabledState=function(){w.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},v.prototype.setEnabled=function(v){w.prototype.setEnabled.call(this,v),this._resyncMeshes()},v.prototype.getShadowGenerator=function(){return this._shadowGenerator},v.prototype.getAbsolutePosition=function(){return Q.l.Zero()},v.prototype.canAffectMesh=function(w){return!w||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(w))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(w))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&w.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&w.layerMask)))},v.prototype.dispose=function(v,I){if(void 0===I&&(I=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this._parentContainer){var P=this._parentContainer.lights.indexOf(this);P>-1&&this._parentContainer.lights.splice(P,1),this._parentContainer=null}for(var u=0,Q=this.getScene().meshes;u<Q.length;u++){Q[u]._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),w.prototype.dispose.call(this,v,I)},v.prototype.getTypeID=function(){return 0},v.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},v.prototype.clone=function(w,I){void 0===I&&(I=null);var P=v.GetConstructorFromName(this.getTypeID(),w,this.getScene());if(!P)return null;var Q=u.e.Clone(P,this);return w&&(Q.name=w),I&&(Q.parent=I),Q.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(Q),Q},v.prototype.serialize=function(){var w=u.e.Serialize(this);return w.uniqueId=this.uniqueId,w.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(w),this.excludedMeshes.length>0&&(w.excludedMeshesIds=[],this.excludedMeshes.forEach((function(v){w.excludedMeshesIds.push(v.id)}))),this.includedOnlyMeshes.length>0&&(w.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(v){w.includedOnlyMeshesIds.push(v.id)}))),u.e.AppendSerializedAnimations(this,w),w.ranges=this.serializeAnimationRanges(),w.isEnabled=this.isEnabled(),w},v.GetConstructorFromName=function(w,v,I){var P=a.b.Construct("Light_Type_"+w,v,I);return P||null},v.Parse=function(w,I){var P=v.GetConstructorFromName(w.type,w.name,I);if(!P)return null;var Q=u.e.Parse(P,w,I);if(w.excludedMeshesIds&&(Q._excludedMeshesIds=w.excludedMeshesIds),w.includedOnlyMeshesIds&&(Q._includedOnlyMeshesIds=w.includedOnlyMeshesIds),void 0!==w.parentId&&(Q._waitingParentId=w.parentId),void 0!==w.parentInstanceIndex&&(Q._waitingParentInstanceIndex=w.parentInstanceIndex),void 0!==w.falloffType&&(Q.falloffType=w.falloffType),void 0!==w.lightmapMode&&(Q.lightmapMode=w.lightmapMode),w.animations){for(var K=0;K<w.animations.length;K++){var U=w.animations[K],r=(0,p.c)("BABYLON.Animation");r&&Q.animations.push(r.Parse(U))}a.b.ParseAnimationRanges(Q,w,I)}return w.autoAnimate&&I.beginAnimation(Q,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),void 0!==w.isEnabled&&Q.setEnabled(w.isEnabled),Q},v.prototype._hookArrayForExcluded=function(w){var v=this,I=w.push;w.push=function(){for(var P=[],u=0;u<arguments.length;u++)P[u]=arguments[u];for(var Q=I.apply(w,P),K=0,a=P;K<a.length;K++){var U=a[K];U._resyncLightSource(v)}return Q};var P=w.splice;w.splice=function(I,u){for(var Q=P.apply(w,[I,u]),K=0,a=Q;K<a.length;K++){a[K]._resyncLightSource(v)}return Q};for(var u=0,Q=w;u<Q.length;u++){Q[u]._resyncLightSource(this)}},v.prototype._hookArrayForIncludedOnly=function(w){var v=this,I=w.push;w.push=function(){for(var P=[],u=0;u<arguments.length;u++)P[u]=arguments[u];var Q=I.apply(w,P);return v._resyncMeshes(),Q};var P=w.splice;w.splice=function(I,u){var Q=P.apply(w,[I,u]);return v._resyncMeshes(),Q},this._resyncMeshes()},v.prototype._resyncMeshes=function(){for(var w=0,v=this.getScene().meshes;w<v.length;w++){v[w]._resyncLightSource(this)}},v.prototype._markMeshesAsLightDirty=function(){for(var w=0,v=this.getScene().meshes;w<v.length;w++){var I=v[w];-1!==I.lightSources.indexOf(this)&&I._markSubMeshesAsLightDirty()}},v.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},v.prototype._getPhotometricScale=function(){var w=0,I=this.getTypeID(),P=this.intensityMode;switch(P===v.INTENSITYMODE_AUTOMATIC&&(P=I===v.LIGHTTYPEID_DIRECTIONALLIGHT?v.INTENSITYMODE_ILLUMINANCE:v.INTENSITYMODE_LUMINOUSINTENSITY),I){case v.LIGHTTYPEID_POINTLIGHT:case v.LIGHTTYPEID_SPOTLIGHT:switch(P){case v.INTENSITYMODE_LUMINOUSPOWER:w=1/(4*Math.PI);break;case v.INTENSITYMODE_LUMINOUSINTENSITY:w=1;break;case v.INTENSITYMODE_LUMINANCE:w=this.radius*this.radius}break;case v.LIGHTTYPEID_DIRECTIONALLIGHT:switch(P){case v.INTENSITYMODE_ILLUMINANCE:w=1;break;case v.INTENSITYMODE_LUMINANCE:var u=this.radius;u=Math.max(u,.001),w=2*Math.PI*(1-Math.cos(u))}break;case v.LIGHTTYPEID_HEMISPHERICLIGHT:w=1}return w},v.prototype._reorderLightsInScene=function(){var w=this.getScene();0!=this._renderPriority&&(w.requireLightSorting=!0),this.getScene().sortLightsByPriority()},v.FALLOFF_DEFAULT=r.c.FALLOFF_DEFAULT,v.FALLOFF_PHYSICAL=r.c.FALLOFF_PHYSICAL,v.FALLOFF_GLTF=r.c.FALLOFF_GLTF,v.FALLOFF_STANDARD=r.c.FALLOFF_STANDARD,v.LIGHTMAP_DEFAULT=r.c.LIGHTMAP_DEFAULT,v.LIGHTMAP_SPECULAR=r.c.LIGHTMAP_SPECULAR,v.LIGHTMAP_SHADOWSONLY=r.c.LIGHTMAP_SHADOWSONLY,v.INTENSITYMODE_AUTOMATIC=r.c.INTENSITYMODE_AUTOMATIC,v.INTENSITYMODE_LUMINOUSPOWER=r.c.INTENSITYMODE_LUMINOUSPOWER,v.INTENSITYMODE_LUMINOUSINTENSITY=r.c.INTENSITYMODE_LUMINOUSINTENSITY,v.INTENSITYMODE_ILLUMINANCE=r.c.INTENSITYMODE_ILLUMINANCE,v.INTENSITYMODE_LUMINANCE=r.c.INTENSITYMODE_LUMINANCE,v.LIGHTTYPEID_POINTLIGHT=r.c.LIGHTTYPEID_POINTLIGHT,v.LIGHTTYPEID_DIRECTIONALLIGHT=r.c.LIGHTTYPEID_DIRECTIONALLIGHT,v.LIGHTTYPEID_SPOTLIGHT=r.c.LIGHTTYPEID_SPOTLIGHT,v.LIGHTTYPEID_HEMISPHERICLIGHT=r.c.LIGHTTYPEID_HEMISPHERICLIGHT,(0,P.i)([(0,u.n)()],v.prototype,"diffuse",void 0),(0,P.i)([(0,u.n)()],v.prototype,"specular",void 0),(0,P.i)([(0,u.J)()],v.prototype,"falloffType",void 0),(0,P.i)([(0,u.J)()],v.prototype,"intensity",void 0),(0,P.i)([(0,u.J)()],v.prototype,"range",null),(0,P.i)([(0,u.J)()],v.prototype,"intensityMode",null),(0,P.i)([(0,u.J)()],v.prototype,"radius",null),(0,P.i)([(0,u.J)()],v.prototype,"_renderPriority",void 0),(0,P.i)([(0,u.h)("_reorderLightsInScene")],v.prototype,"renderPriority",void 0),(0,P.i)([(0,u.J)("shadowEnabled")],v.prototype,"_shadowEnabled",void 0),(0,P.i)([(0,u.J)("excludeWithLayerMask")],v.prototype,"_excludeWithLayerMask",void 0),(0,P.i)([(0,u.J)("includeOnlyWithLayerMask")],v.prototype,"_includeOnlyWithLayerMask",void 0),(0,P.i)([(0,u.J)("lightmapMode")],v.prototype,"_lightmapMode",void 0),v}(a.b)},21876:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(){}return w.CompareLightsPriority=function(w,v){return w.shadowEnabled!==v.shadowEnabled?(v.shadowEnabled?1:0)-(w.shadowEnabled?1:0):v.renderPriority-w.renderPriority},w.FALLOFF_DEFAULT=0,w.FALLOFF_PHYSICAL=1,w.FALLOFF_GLTF=2,w.FALLOFF_STANDARD=3,w.LIGHTMAP_DEFAULT=0,w.LIGHTMAP_SPECULAR=1,w.LIGHTMAP_SHADOWSONLY=2,w.INTENSITYMODE_AUTOMATIC=0,w.INTENSITYMODE_LUMINOUSPOWER=1,w.INTENSITYMODE_LUMINOUSINTENSITY=2,w.INTENSITYMODE_ILLUMINANCE=3,w.INTENSITYMODE_LUMINANCE=4,w.LIGHTTYPEID_POINTLIGHT=0,w.LIGHTTYPEID_DIRECTIONALLIGHT=1,w.LIGHTTYPEID_SPOTLIGHT=2,w.LIGHTTYPEID_HEMISPHERICLIGHT=3,w}()},67269:function(w,v,I){"use strict";I.d(v,{e:function(){return J}});var P,u=I(9217),Q=I(9271),K=I(37105),a=I(90690),U=I(78588),p=I(9127),r=I(97964),Y=I(82790),g=I(39524);!function(w){w[w.Clean=0]="Clean",w[w.Stop=1]="Stop",w[w.Sync=2]="Sync",w[w.NoSync=3]="NoSync"}(P||(P={}));var J=function(){function w(){}return Object.defineProperty(w,"ForceFullSceneLoadingForIncremental",{get:function(){return r.c.ForceFullSceneLoadingForIncremental},set:function(w){r.c.ForceFullSceneLoadingForIncremental=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ShowLoadingScreen",{get:function(){return r.c.ShowLoadingScreen},set:function(w){r.c.ShowLoadingScreen=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"loggingLevel",{get:function(){return r.c.loggingLevel},set:function(w){r.c.loggingLevel=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"CleanBoneMatrixWeights",{get:function(){return r.c.CleanBoneMatrixWeights},set:function(w){r.c.CleanBoneMatrixWeights=w},enumerable:!1,configurable:!0}),w.GetDefaultPlugin=function(){return w._RegisteredPlugins[".babylon"]},w._GetPluginForExtension=function(v){var I=w._RegisteredPlugins[v];return I||(p.e.Warn("Unable to find a plugin to load "+v+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type"),w.GetDefaultPlugin())},w._GetPluginForDirectLoad=function(v){for(var I in w._RegisteredPlugins){var P=w._RegisteredPlugins[I].plugin;if(P.canDirectLoad&&P.canDirectLoad(v))return w._RegisteredPlugins[I]}return w.GetDefaultPlugin()},w._GetPluginForFilename=function(v){var I=v.indexOf("?");-1!==I&&(v=v.substring(0,I));var P=v.lastIndexOf("."),u=v.substring(P,v.length).toLowerCase();return w._GetPluginForExtension(u)},w._GetDirectLoad=function(w){return"data:"===w.substr(0,5)?w.substr(5):null},w._FormatErrorMessage=function(w,v,I){var P="Unable to load from "+w.url;return v?P+=": ".concat(v):I&&(P+=": ".concat(I)),P},w._LoadData=function(v,I,P,u,Q,K,U){var p,r=w._GetDirectLoad(v.url),g=U?w._GetPluginForExtension(U):r?w._GetPluginForDirectLoad(v.url):w._GetPluginForFilename(v.url);if(!(p=void 0!==g.plugin.createPlugin?g.plugin.createPlugin():g.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(w.OnPluginActivatedObservable.notifyObservers(p),r&&(p.canDirectLoad&&p.canDirectLoad(v.url)||!(0,Y.h)(v.url))){if(p.directLoad){var J=p.directLoad(I,r);J.then?J.then((function(w){P(p,w)})).catch((function(w){Q("Error in directLoad of _loadData: "+w,w)})):P(p,J)}else P(p,r);return p}var l=g.isBinary,R=function(w,v){I.isDisposed?Q("Scene has been disposed"):P(p,w,v)},x=null,j=!1,s=p.onDisposeObservable;s&&s.add((function(){j=!0,x&&(x.abort(),x=null),K()}));var B=function(){if(!j){var w=function(w,v){Q(null===w||void 0===w?void 0:w.statusText,v)},P=v.file||v.url;x=p.loadFile?p.loadFile(I,P,R,u,l,w):I._loadFile(P,R,u,!0,l,w)}},t=I.getEngine(),i=t.enableOfflineSupport;if(i){for(var z=!1,E=0,o=I.disableOfflineSupportExceptionRules;E<o.length;E++){if(o[E].test(v.url)){z=!0;break}}i=!z}return i&&a.d.OfflineProviderFactory?I.offlineProvider=a.d.OfflineProviderFactory(v.url,B,t.disableManifestCheck):B(),p},w._GetFileInfo=function(w,v){var I,P,Q=null;if(v)if(v.name){var K=v;I="file:".concat(K.name),P=K.name,Q=K}else if("string"===typeof v&&v.startsWith("data:"))I=v,P="";else{var a=v;if("/"===a.substr(0,1))return u.i.Error("Wrong sceneFilename parameter"),null;I=w+a,P=a}else I=w,P=u.i.GetFilename(w),w=u.i.GetFolderPath(w);return{url:I,rootUrl:w,name:P,file:Q}},w.GetPluginForExtension=function(v){return w._GetPluginForExtension(v).plugin},w.IsPluginForExtensionAvailable=function(v){return!!w._RegisteredPlugins[v]},w.RegisterPlugin=function(v){if("string"===typeof v.extensions){var I=v.extensions;w._RegisteredPlugins[I.toLowerCase()]={plugin:v,isBinary:!1}}else{var P=v.extensions;Object.keys(P).forEach((function(I){w._RegisteredPlugins[I.toLowerCase()]={plugin:v,isBinary:P[I].isBinary}}))}},w.ImportMesh=function(v,I,P,u,Q,K,a,r){if(void 0===P&&(P=""),void 0===u&&(u=U.e.LastCreatedScene),void 0===Q&&(Q=null),void 0===K&&(K=null),void 0===a&&(a=null),void 0===r&&(r=null),!u)return p.e.Error("No scene available to import mesh to"),null;var Y=w._GetFileInfo(I,P);if(!Y)return null;var J={};u._addPendingData(J);var l=function(){u._removePendingData(J)},R=function(v,I){var P=w._FormatErrorMessage(Y,v,I);a?a(u,P,new g.f(P,g.e.SceneLoaderError,I)):p.e.Error(P),l()},x=K?function(w){try{K(w)}catch(w){R("Error in onProgress callback: "+w,w)}}:void 0,j=function(w,v,I,P,K,a,U){if(u.importedMeshesFiles.push(Y.url),Q)try{Q(w,v,I,P,K,a,U)}catch(w){R("Error in onSuccess callback: "+w,w)}u._removePendingData(J)};return w._LoadData(Y,u,(function(w,I,P){if(w.rewriteRootURL&&(Y.rootUrl=w.rewriteRootURL(Y.rootUrl,P)),w.importMesh){var Q=w,K=new Array,a=new Array,U=new Array;if(!Q.importMesh(v,u,I,Y.rootUrl,K,a,U,R))return;u.loadingPluginName=w.name,j(K,a,U,[],[],[],[])}else{w.importMeshAsync(v,u,I,Y.rootUrl,x,Y.name).then((function(v){u.loadingPluginName=w.name,j(v.meshes,v.particleSystems,v.skeletons,v.animationGroups,v.transformNodes,v.geometries,v.lights)})).catch((function(w){R(w.message,w)}))}}),x,R,l,r)},w.ImportMeshAsync=function(v,I,P,u,Q,K){return void 0===P&&(P=""),void 0===u&&(u=U.e.LastCreatedScene),void 0===Q&&(Q=null),void 0===K&&(K=null),new Promise((function(a,U){w.ImportMesh(v,I,P,u,(function(w,v,I,P,u,Q,K){a({meshes:w,particleSystems:v,skeletons:I,animationGroups:P,transformNodes:u,geometries:Q,lights:K})}),Q,(function(w,v,I){U(I||new Error(v))}),K)}))},w.Load=function(v,I,P,Q,a,p,r){return void 0===I&&(I=""),void 0===P&&(P=U.e.LastCreatedEngine),void 0===Q&&(Q=null),void 0===a&&(a=null),void 0===p&&(p=null),void 0===r&&(r=null),P?w.Append(v,I,new K.d(P),Q,a,p,r):(u.i.Error("No engine available"),null)},w.LoadAsync=function(v,I,P,u,Q){return void 0===I&&(I=""),void 0===P&&(P=U.e.LastCreatedEngine),void 0===u&&(u=null),void 0===Q&&(Q=null),new Promise((function(K,a){w.Load(v,I,P,(function(w){K(w)}),u,(function(w,v,I){a(I||new Error(v))}),Q)}))},w.Append=function(v,I,P,u,Q,K,a){var r=this;if(void 0===I&&(I=""),void 0===P&&(P=U.e.LastCreatedScene),void 0===u&&(u=null),void 0===Q&&(Q=null),void 0===K&&(K=null),void 0===a&&(a=null),!P)return p.e.Error("No scene available to append to"),null;var Y=w._GetFileInfo(v,I);if(!Y)return null;w.ShowLoadingScreen&&!this._ShowingLoadingScreen&&(this._ShowingLoadingScreen=!0,P.getEngine().displayLoadingUI(),P.executeWhenReady((function(){P.getEngine().hideLoadingUI(),r._ShowingLoadingScreen=!1})));var J={};P._addPendingData(J);var l=function(){P._removePendingData(J)},R=function(v,I){var u=w._FormatErrorMessage(Y,v,I);K?K(P,u,new g.f(u,g.e.SceneLoaderError,I)):p.e.Error(u),l()},x=Q?function(w){try{Q(w)}catch(w){R("Error in onProgress callback",w)}}:void 0,j=function(){if(u)try{u(P)}catch(w){R("Error in onSuccess callback",w)}P._removePendingData(J)};return w._LoadData(Y,P,(function(w,v){if(w.load){if(!w.load(P,v,Y.rootUrl,R))return;P.loadingPluginName=w.name,j()}else{w.loadAsync(P,v,Y.rootUrl,x,Y.name).then((function(){P.loadingPluginName=w.name,j()})).catch((function(w){R(w.message,w)}))}}),x,R,l,a)},w.AppendAsync=function(v,I,P,u,Q){return void 0===I&&(I=""),void 0===P&&(P=U.e.LastCreatedScene),void 0===u&&(u=null),void 0===Q&&(Q=null),new Promise((function(K,a){w.Append(v,I,P,(function(w){K(w)}),u,(function(w,v,I){a(I||new Error(v))}),Q)}))},w.LoadAssetContainer=function(v,I,P,u,Q,K,a){if(void 0===I&&(I=""),void 0===P&&(P=U.e.LastCreatedScene),void 0===u&&(u=null),void 0===Q&&(Q=null),void 0===K&&(K=null),void 0===a&&(a=null),!P)return p.e.Error("No scene available to load asset container to"),null;var r=w._GetFileInfo(v,I);if(!r)return null;var Y={};P._addPendingData(Y);var J=function(){P._removePendingData(Y)},l=function(v,I){var u=w._FormatErrorMessage(r,v,I);K?K(P,u,new g.f(u,g.e.SceneLoaderError,I)):p.e.Error(u),J()},R=Q?function(w){try{Q(w)}catch(w){l("Error in onProgress callback",w)}}:void 0,x=function(w){if(u)try{u(w)}catch(w){l("Error in onSuccess callback",w)}P._removePendingData(Y)};return w._LoadData(r,P,(function(w,v){if(w.loadAssetContainer){var I=w.loadAssetContainer(P,v,r.rootUrl,l);if(!I)return;P.loadingPluginName=w.name,x(I)}else if(w.loadAssetContainerAsync){w.loadAssetContainerAsync(P,v,r.rootUrl,R,r.name).then((function(v){P.loadingPluginName=w.name,x(v)})).catch((function(w){l(w.message,w)}))}else l("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),R,l,J,a)},w.LoadAssetContainerAsync=function(v,I,P,u,Q){return void 0===I&&(I=""),void 0===P&&(P=U.e.LastCreatedScene),void 0===u&&(u=null),void 0===Q&&(Q=null),new Promise((function(K,a){w.LoadAssetContainer(v,I,P,(function(w){K(w)}),u,(function(w,v,I){a(I||new Error(v))}),Q)}))},w.ImportAnimations=function(w,v,I,u,Q,K,a,r,Y,g){if(void 0===v&&(v=""),void 0===I&&(I=U.e.LastCreatedScene),void 0===u&&(u=!0),void 0===Q&&(Q=P.Clean),void 0===K&&(K=null),void 0===a&&(a=null),void 0===r&&(r=null),void 0===Y&&(Y=null),void 0===g&&(g=null),I){if(u){for(var J=0,l=I.animatables;J<l.length;J++){l[J].reset()}I.stopAllAnimations(),I.animationGroups.slice().forEach((function(w){w.dispose()})),I.getNodes().forEach((function(w){w.animations&&(w.animations=[])}))}else switch(Q){case P.Clean:I.animationGroups.slice().forEach((function(w){w.dispose()}));break;case P.Stop:I.animationGroups.forEach((function(w){w.stop()}));break;case P.Sync:I.animationGroups.forEach((function(w){w.reset(),w.restart()}));break;case P.NoSync:break;default:return void p.e.Error("Unknown animation group loading mode value '"+Q+"'")}var R=I.animatables.length;this.LoadAssetContainer(w,v,I,(function(w){w.mergeAnimationsTo(I,I.animatables.slice(R),K),w.dispose(),I.onAnimationFileImportedObservable.notifyObservers(I),a&&a(I)}),r,Y,g)}else p.e.Error("No scene available to load animations to")},w.ImportAnimationsAsync=function(v,I,u,Q,K,a,p,r,Y,g){return void 0===I&&(I=""),void 0===u&&(u=U.e.LastCreatedScene),void 0===Q&&(Q=!0),void 0===K&&(K=P.Clean),void 0===a&&(a=null),void 0===p&&(p=null),void 0===r&&(r=null),void 0===Y&&(Y=null),void 0===g&&(g=null),new Promise((function(P,U){w.ImportAnimations(v,I,u,Q,K,a,(function(w){P(w)}),r,(function(w,v,I){U(I||new Error(v))}),g)}))},w.NO_LOGGING=0,w.MINIMAL_LOGGING=1,w.SUMMARY_LOGGING=2,w.DETAILED_LOGGING=3,w.OnPluginActivatedObservable=new Q.c,w._RegisteredPlugins={},w._ShowingLoadingScreen=!1,w}()},97964:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(){}return Object.defineProperty(w,"ForceFullSceneLoadingForIncremental",{get:function(){return w._ForceFullSceneLoadingForIncremental},set:function(v){w._ForceFullSceneLoadingForIncremental=v},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ShowLoadingScreen",{get:function(){return w._ShowLoadingScreen},set:function(v){w._ShowLoadingScreen=v},enumerable:!1,configurable:!0}),Object.defineProperty(w,"loggingLevel",{get:function(){return w._LoggingLevel},set:function(v){w._LoggingLevel=v},enumerable:!1,configurable:!0}),Object.defineProperty(w,"CleanBoneMatrixWeights",{get:function(){return w._CleanBoneMatrixWeights},set:function(v){w._CleanBoneMatrixWeights=v},enumerable:!1,configurable:!0}),w._ForceFullSceneLoadingForIncremental=!1,w._ShowLoadingScreen=!0,w._CleanBoneMatrixWeights=!1,w._LoggingLevel=0,w}()},82325:function(w,v,I){"use strict";I.d(v,{c:function(){return Vw}});var P=I(78502),u=I(9892),Q=I(9127),K=I(21901),a=I(5344),U=I(37105),p=I(80105),r=I(43251),Y=I(4241),g=I(96558),J=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.BRDF_V_HEIGHT_CORRELATED=!1,v.MS_BRDF_ENERGY_CONSERVATION=!1,v.SPHERICAL_HARMONICS=!1,v.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,v}return(0,P.m)(v,w),v}(Y.b),l=function(w){function v(I,P){void 0===P&&(P=!0);var u=w.call(this,I,"PBRBRDF",90,new J,P)||this;return u._useEnergyConservation=v.DEFAULT_USE_ENERGY_CONSERVATION,u.useEnergyConservation=v.DEFAULT_USE_ENERGY_CONSERVATION,u._useSmithVisibilityHeightCorrelated=v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,u.useSmithVisibilityHeightCorrelated=v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,u._useSphericalHarmonics=v.DEFAULT_USE_SPHERICAL_HARMONICS,u.useSphericalHarmonics=v.DEFAULT_USE_SPHERICAL_HARMONICS,u._useSpecularGlossinessInputEnergyConservation=v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,u.useSpecularGlossinessInputEnergyConservation=v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,u._internalMarkAllSubMeshesAsMiscDirty=I._dirtyCallbacks[16],u._enable(!0),u}return(0,P.m)(v,w),v.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},v.prototype.prepareDefines=function(w){w.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,w.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,w.SPHERICAL_HARMONICS=this._useSphericalHarmonics,w.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},v.prototype.getClassName=function(){return"PBRBRDFConfiguration"},v.DEFAULT_USE_ENERGY_CONSERVATION=!0,v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,v.DEFAULT_USE_SPHERICAL_HARMONICS=!0,v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useEnergyConservation",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSphericalHarmonics",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),v}(g.d),R=I(90888),x=I(9488),j=I(96658),s=I(23016),B=I(46907),t=I(38956),i=I(29553),z=I(33048),E=I(70937),o=I(37001),h=(I(28689),I(16179)),n=(I(74422),I(44184),"uniform vec4 vEyePosition;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec4 vMetallicReflectanceFactors;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\nuniform vec3 vAmbientColor;\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REALTIME_FILTERING\nuniform vec2 vReflectionFilteringInfo;\n#endif\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#if defined(SS_REFRACTION) && defined(SS_USE_LOCAL_REFRACTIONMAP_CUBIC)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n#ifdef IRIDESCENCE\nuniform vec4 vIridescenceParams;\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_ROUGHNESS\nuniform float vSheenRoughness;\n#endif\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#ifdef REALTIME_FILTERING\nuniform vec2 vRefractionFilteringInfo;\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;\nuniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;\nuniform mat4 translucencyIntensityMatrix;\n#endif\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n#endif\n#ifdef PREPASS\n#ifdef SS_SCATTERING\nuniform float scatteringDiffusionProfile;\n#endif\n#endif\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n#endif\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n");h.c.IncludesShadersStore.pbrFragmentDeclaration=n;I(88987),I(61496);var W="layout(std140,column_major) uniform;\nuniform Material {\nvec2 vAlbedoInfos;\nvec4 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec3 vReflectivityInfos;\nvec2 vMicroSurfaceSamplerInfos;\nvec2 vReflectionInfos;\nvec2 vReflectionFilteringInfo;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec3 vBumpInfos;\nmat4 albedoMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 reflectivityMatrix;\nmat4 microSurfaceSamplerMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nmat4 reflectionMatrix;\nvec3 vReflectionColor;\nvec4 vAlbedoColor;\nvec4 vLightingIntensity;\nvec3 vReflectionMicrosurfaceInfos;\nfloat pointSize;\nvec4 vReflectivityColor;\nvec3 vEmissiveColor;\nvec3 vAmbientColor;\nvec2 vDebugMode;\nvec4 vMetallicReflectanceFactors;\nvec2 vMetallicReflectanceInfos;\nmat4 metallicReflectanceMatrix;\nvec2 vReflectanceInfos;\nmat4 reflectanceMatrix;\nvec3 vSphericalL00;\nvec3 vSphericalL1_1;\nvec3 vSphericalL10;\nvec3 vSphericalL11;\nvec3 vSphericalL2_2;\nvec3 vSphericalL2_1;\nvec3 vSphericalL20;\nvec3 vSphericalL21;\nvec3 vSphericalL22;\nvec3 vSphericalX;\nvec3 vSphericalY;\nvec3 vSphericalZ;\nvec3 vSphericalXX_ZZ;\nvec3 vSphericalYY_ZZ;\nvec3 vSphericalZZ;\nvec3 vSphericalXY;\nvec3 vSphericalYZ;\nvec3 vSphericalZX;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";h.c.IncludesShadersStore.pbrUboDeclaration=W;I(87321);var V="varying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n";h.c.IncludesShadersStore.pbrFragmentExtraDeclaration=V;I(65084),I(45928),I(54587);var F="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n#endif\n";h.c.IncludesShadersStore.samplerFragmentAlternateDeclaration=F;var O="#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D clearCoatRoughnessSampler;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D sheenRoughnessSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;\nuniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D refractionSamplerLow;\nuniform sampler2D refractionSamplerHigh;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#endif\n";h.c.IncludesShadersStore.pbrFragmentSamplersDeclaration=O;I(23598),I(76578),I(96919),I(35850),I(83874);var N="bool testLightingForSSS(float diffusionProfile)\n{\nreturn diffusionProfile<1.;\n}";h.c.IncludesShadersStore.subSurfaceScatteringFunctions=N;var q="vec3 hemisphereCosSample(vec2 u) {\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=1.-u.y;\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { \nfloat phi=2.*PI*u.x;\nfloat sinTheta=pow(u.y,a/(2.*a+1.));\nfloat cosTheta=sqrt(1.-sinTheta*sinTheta);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}";h.c.IncludesShadersStore.importanceSampling=q;var m="#define RECIPROCAL_PI2 0.15915494\n#define RECIPROCAL_PI 0.31830988618\n#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{\nreturn square(roughness)+MINIMUMVARIANCE;\n}\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=saturate(reflectance0*25.0);\nreturn reflectance90;\n}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);\nvec3 nDfdy=dFdy(normalVector.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\nfloat geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\ngeometricAlphaGFactor*=0.75;\nreturn vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {\nfloat alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);\nfloat alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);\nreturn vec2(alphaT,alphaB);\n}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {\nvec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;\nvec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);\nvec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);\nvec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));\nreturn anisotropicNormal;\n}\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nvec3 cocaLambert(vec3 alpha,float distance) {\nreturn exp(-alpha*distance);\n}\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {\nreturn cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));\n}\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {\nreturn -log(color)/distance;\n}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);\nreturn clearCoatAbsorption;\n}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n#endif\n";h.c.IncludesShadersStore.pbrHelperFunctions=m;I(68923),I(35765);var c="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nreturn vSphericalL00\n+ vSphericalL1_1*(normal.y)\n+ vSphericalL10*(normal.z)\n+ vSphericalL11*(normal.x)\n+ vSphericalL2_2*(normal.y*normal.x)\n+ vSphericalL2_1*(normal.y*normal.z)\n+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ vSphericalL21*(normal.z*normal.x)\n+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));\n}\n#else\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz *Nz+C1;\nvec3 t2=a2 *Ny+t1;\nvec3 t3=b3 *Nx+t2;\nreturn t3;\n}\n#endif\n#endif\n";h.c.IncludesShadersStore.harmonicsFunctions=c;var M="struct preLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat lightDistance;\nfloat attenuation;\nvec3 L;\nvec3 H;\nfloat NdotV;\nfloat NdotLUnclamped;\nfloat NdotL;\nfloat VdotH;\nfloat roughness;\n#ifdef IRIDESCENCE\nfloat iridescenceIntensity;\n#endif\n};\npreLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nresult.lightDistance=sqrt(result.lightDistanceSquared);\nresult.L=normalize(result.lightOffset);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.lightDistance=length(-lightData.xyz);\nresult.L=normalize(-lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.NdotL=dot(N,lightData.xyz)*0.5+0.5;\nresult.NdotL=saturateEps(result.NdotL);\nresult.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;\n}";h.c.IncludesShadersStore.pbrDirectLightingSetupFunctions=M;var S="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/maxEps(lightDistanceSquared);\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nfloat lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=saturate(1.0-factor*factor);\nattenuation*=attenuation;\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=saturate(cd*lightAngleScale+lightAngleOffset);\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}";h.c.IncludesShadersStore.pbrDirectLightingFalloffFunctions=S;var e="#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\nvec2 UV=vec2(NdotV,perceptualRoughness);\nvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{\nfloat c=1.0-NdotV;\nfloat c3=c*c*c;\nreturn 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));\n}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);\nvec3 getIORTfromAirToSurfaceR0(vec3 f0) {\nvec3 sqrtF0=sqrt(f0);\nreturn (1.+sqrtF0)/(1.-sqrtF0);\n}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {\nreturn square((iorT-vec3(iorI))/(iorT+vec3(iorI)));\n}\nfloat getR0fromIORs(float iorT,float iorI) {\nreturn square((iorT-iorI)/(iorT+iorI));\n}\nvec3 evalSensitivity(float opd,vec3 shift) {\nfloat phase=2.0*PI*opd*1.0e-9;\nconst vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);\nconst vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);\nconst vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);\nvec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);\nxyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));\nxyz/=1.0685e-7;\nvec3 srgb=XYZ_TO_REC709*xyz;\nreturn srgb;\n}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {\nvec3 I=vec3(1.0);\nfloat iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));\nfloat sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));\nfloat cosTheta2Sq=1.0-sinTheta2Sq;\nif (cosTheta2Sq<0.0) {\nreturn I;\n}\nfloat cosTheta2=sqrt(cosTheta2Sq);\nfloat R0=getR0fromIORs(iridescenceIOR,outsideIOR);\nfloat R12=fresnelSchlickGGX(cosTheta1,R0,1.);\nfloat R21=R12;\nfloat T121=1.0-R12;\nfloat phi12=0.0;\nif (iridescenceIOR<outsideIOR) phi12=PI;\nfloat phi21=PI-phi12;\nvec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);\nvec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));\nvec3 phi23=vec3(0.0);\nif (baseIOR[0]<iridescenceIOR) phi23[0]=PI;\nif (baseIOR[1]<iridescenceIOR) phi23[1]=PI;\nif (baseIOR[2]<iridescenceIOR) phi23[2]=PI;\nfloat opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;\nvec3 phi=vec3(phi21)+phi23;\nvec3 R123=clamp(R12*R23,1e-5,0.9999);\nvec3 r123=sqrt(R123);\nvec3 Rs=square(T121)*R23/(vec3(1.0)-R123);\nvec3 C0=R12+Rs;\nI=C0;\nvec3 Cm=Rs-T121;\nfor (int m=1; m<=2; ++m)\n{\nCm*=r123;\nvec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);\nI+=Cm*Sm;\n}\nreturn max(I,vec3(0.0));\n}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\nreturn 0.25/(VdotH*VdotH); \n}\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{\nfloat oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);\nfloat a=mix(21.5473,25.3245,oneMinusAlphaSq);\nfloat b=mix(3.82987,3.32435,oneMinusAlphaSq);\nfloat c=mix(0.19823,0.16801,oneMinusAlphaSq);\nfloat d=mix(-1.97760,-1.27393,oneMinusAlphaSq);\nfloat e=mix(-4.32054,-4.85967,oneMinusAlphaSq);\nreturn a/(1.0+b*pow(x,c))+d*x+e;\n}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{\nreturn abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));\n}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{\nfloat G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));\nreturn G/(4.0*NdotV*NdotL);\n}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n";h.c.IncludesShadersStore.pbrBRDFFunctions=e;var H="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#if defined(WEBGL2) || defined(WEBGPU)\nfloat radicalInverse_VdC(uint bits) \n{\nbits=(bits<<16u) | (bits>>16u);\nbits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);\nbits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);\nbits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);\nbits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);\nreturn float(bits)*2.3283064365386963e-10; \n}\nvec2 hammersley(uint i,uint N)\n{\nreturn vec2(float(i)/float(N),radicalInverse_VdC(i));\n}\n#else\nfloat vanDerCorpus(int n,int base)\n{\nfloat invBase=1.0/float(base);\nfloat denom =1.0;\nfloat result =0.0;\nfor(int i=0; i<32; ++i)\n{\nif(n>0)\n{\ndenom =mod(float(n),2.0);\nresult+=denom*invBase;\ninvBase=invBase/2.0;\nn =int(float(n)/2.0);\n}\n}\nreturn result;\n}\nvec2 hammersley(int i,int N)\n{\nreturn vec2(float(i)/float(N),vanDerCorpus(i,2));\n}\n#endif\nfloat log4(float x) {\nreturn log2(x)/2.;\n}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);\nconst float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;\nconst float K=4.;\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nvec3 result=vec3(0.0);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\n#if defined(WEBGL2) || defined(WEBGPU)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 Ls=hemisphereCosSample(Xi);\nLs=normalize(Ls);\nvec3 Ns=vec3(0.,0.,1.);\nfloat NoL=dot(Ns,Ls);\nif (NoL>0.) {\nfloat pdf_inversed=PI/NoL;\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(l,0.0,maxLevel);\nvec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;\n}\n}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;\nreturn result;\n}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nif (alphaG==0.) {\nvec3 c=textureCube(inputTexture,n).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;\n} else {\nvec3 result=vec3(0.);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\nfloat weight=0.;\n#if defined(WEBGL2) || defined(WEBGPU)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);\nfloat NoV=1.;\nfloat NoH=H.z;\nfloat NoH2=H.z*H.z;\nfloat NoL=2.*NoH2-1.;\nvec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);\nL=normalize(L);\nif (NoL>0.) {\nfloat pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(float(l),0.0,maxLevel);\nweight+=NoL;\nvec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;\n}\n}\nresult=result/weight;\nreturn result;\n}\n}\n#endif\n#endif\n";h.c.IncludesShadersStore.hdrFilteringFunctions=H;var G="#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nfloat lightRoughness=lightRadius/lightDistance;\nfloat totalRoughness=saturate(lightRoughness+roughness);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\nreturn mix(groundColor,lightColor,info.NdotL);\n}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\nfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\nfloat NdotL=absEps(info.NdotLUnclamped);\nfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\nfloat trAdapt=step(0.,info.NdotLUnclamped);\nvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\nfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\n}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat TdotH=dot(T,info.H);\nfloat BdotH=dot(B,info.H);\nfloat TdotV=dot(T,V);\nfloat BdotV=dot(B,V);\nfloat TdotL=dot(T,info.L);\nfloat BdotL=dot(B,info.L);\nfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\nvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\nalphaTB=max(alphaTB,square(geometricRoughnessFactor));\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\nfloat smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\nfloat NccdotL=saturateEps(dot(Ncc,info.L));\nfloat NccdotH=saturateEps(dot(Ncc,info.H));\nfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\nfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnel*=clearCoatIntensity;\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\nfloat kelemenVisibility=visibility_Kelemen(info.VdotH);\nfloat clearCoatTerm=fresnel*distribution*kelemenVisibility;\nreturn vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);\n}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\nfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\nvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\nreturn absorption;\n}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat fresnel=1.;\nfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\n/*#ifdef SHEEN_SOFTER\nfloat visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\n/* #endif */\nfloat sheenTerm=fresnel*distribution*visibility;\nreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n";h.c.IncludesShadersStore.pbrDirectLightingFunctions=G;var L="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {\nfloat microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {\nfloat lod=log2(cubeMapDimensionPixels)*roughness;\nreturn lod;\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn saturate(square(temp)-1.0+ambientOcclusion);\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {\nvec3 reflection=reflect(view,normal);\nfloat temp=saturate(1.0+1.1*dot(reflection,geometricNormal));\nreturn square(temp);\n}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nreturn getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);\n}\n#endif\n";h.c.IncludesShadersStore.pbrIBLFunctions=L;I(72994),I(49904),I(31814);var d="struct albedoOpacityOutParams\n{\nvec3 surfaceAlbedo;\nfloat alpha;\n};\n#define pbr_inline\nvoid albedoOpacityBlock(\nin vec4 vAlbedoColor,\n#ifdef ALBEDO\nin vec4 albedoTexture,\nin vec2 albedoInfos,\n#endif\n#ifdef OPACITY\nin vec4 opacityMap,\nin vec2 vOpacityInfos,\n#endif\n#ifdef DETAIL\nin vec4 detailColor,\nin vec4 vDetailInfos,\n#endif\nout albedoOpacityOutParams outParams\n)\n{\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#ifdef DETAIL\nfloat detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);\nsurfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;\noutParams.alpha=alpha;\n}\n";h.c.IncludesShadersStore.pbrBlockAlbedoOpacity=d;var D="struct reflectivityOutParams\n{\nfloat microSurface;\nfloat roughness;\nvec3 surfaceReflectivityColor;\n#ifdef METALLICWORKFLOW\nvec3 surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nvec3 ambientOcclusionColor;\n#endif\n#if DEBUGMODE>0\nvec4 surfaceMetallicColorMap;\nvec4 surfaceReflectivityColorMap;\nvec2 metallicRoughness;\nvec3 metallicF0;\n#endif\n};\n#define pbr_inline\nvoid reflectivityBlock(\nin vec4 vReflectivityColor,\n#ifdef METALLICWORKFLOW\nin vec3 surfaceAlbedo,\nin vec4 metallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nin vec3 reflectivityInfos,\nin vec4 surfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nin vec3 ambientOcclusionColorIn,\n#endif\n#ifdef MICROSURFACEMAP\nin vec4 microSurfaceTexel,\n#endif\n#ifdef DETAIL\nin vec4 detailColor,\nin vec4 vDetailInfos,\n#endif\nout reflectivityOutParams outParams\n)\n{\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);\noutParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nfloat detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);\nfloat loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);\nfloat hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);\nmetallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;\nvec3 baseColor=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);\nsurfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);\nsurfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;\nmicroSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);\nfloat roughness=1.-microSurface;\noutParams.microSurface=microSurface;\noutParams.roughness=roughness;\noutParams.surfaceReflectivityColor=surfaceReflectivityColor;\n}\n";h.c.IncludesShadersStore.pbrBlockReflectivity=D;var f="struct ambientOcclusionOutParams\n{\nvec3 ambientOcclusionColor;\n#if DEBUGMODE>0\nvec3 ambientOcclusionColorMap;\n#endif\n};\n#define pbr_inline\nvoid ambientOcclusionBlock(\n#ifdef AMBIENT\nin vec3 ambientOcclusionColorMap_,\nin vec4 vAmbientInfos,\n#endif\nout ambientOcclusionOutParams outParams\n)\n{\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;\n}\n";h.c.IncludesShadersStore.pbrBlockAmbientOcclusion=f;var b="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{\nfloat alpha;\n};\n#define pbr_inline\nvoid alphaFresnelBlock(\nin vec3 normalW,\nin vec3 viewDirectionW,\nin float alpha,\nin float microSurface,\nout alphaFresnelOutParams outParams\n)\n{\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\noutParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\n}\n#endif\n#endif\n";h.c.IncludesShadersStore.pbrBlockAlphaFresnel=b;var k="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{\nfloat anisotropy;\nvec3 anisotropicTangent;\nvec3 anisotropicBitangent;\nvec3 anisotropicNormal;\n#if DEBUGMODE>0\nvec3 anisotropyMapData;\n#endif\n};\n#define pbr_inline\nvoid anisotropicBlock(\nin vec3 vAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nin vec3 anisotropyMapData,\n#endif\nin mat3 TBN,\nin vec3 normalW,\nin vec3 viewDirectionW,\nout anisotropicOutParams outParams\n)\n{\nfloat anisotropy=vAnisotropy.b;\nvec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nanisotropy*=anisotropyMapData.b;\nanisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));\nvec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);\nvec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));\noutParams.anisotropy=anisotropy;\noutParams.anisotropicTangent=anisotropicTangent;\noutParams.anisotropicBitangent=anisotropicBitangent;\noutParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);\n}\n#endif\n";h.c.IncludesShadersStore.pbrBlockAnisotropic=k;var C="#ifdef REFLECTION\nstruct reflectionOutParams\n{\nvec4 environmentRadiance;\nvec3 environmentIrradiance;\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords;\n#else\nvec2 reflectionCoords;\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nvec3 irradianceVector;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nvoid createReflectionCoords(\nin vec3 vPositionW,\nin vec3 normalW,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REFLECTIONMAP_3D\nout vec3 reflectionCoords\n#else\nout vec2 reflectionCoords\n#endif\n)\n{\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n}\n#define pbr_inline\n#define inline\nvoid sampleReflectionTexture(\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nconst vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nconst vec2 reflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout vec4 environmentRadiance\n)\n{\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);\nif (lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nenvironmentRadiance=mix(\nenvironmentMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\n}\n#define pbr_inline\n#define inline\nvoid reflectionBlock(\nin vec3 vPositionW,\nin vec3 normalW,\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\n#else\nin sampler2D reflectionSampler,\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nin vec3 vEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nin mat4 reflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nin samplerCube irradianceSampler,\n#else\nin sampler2D irradianceSampler,\n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout reflectionOutParams outParams\n)\n{\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=vec3(0.);\n#else\nvec2 reflectionCoords=vec2(0.);\n#endif\ncreateReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\nreflectionCoords\n);\nsampleReflectionTexture(\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionSampler,\nreflectionCoords,\n#else\nreflectionSampler,\nreflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentRadiance\n);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);\nenvironmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;\noutParams.environmentRadiance=environmentRadiance;\noutParams.environmentIrradiance=environmentIrradiance;\noutParams.reflectionCoords=reflectionCoords;\n}\n#endif\n";h.c.IncludesShadersStore.pbrBlockReflection=C;var y="#ifdef SHEEN\nstruct sheenOutParams\n{\nfloat sheenIntensity;\nvec3 sheenColor;\nfloat sheenRoughness;\n#ifdef SHEEN_LINKWITHALBEDO\nvec3 surfaceAlbedo;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfloat sheenAlbedoScaling;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 finalSheenRadianceScaled;\n#endif\n#if DEBUGMODE>0\nvec4 sheenMapData;\nvec3 sheenEnvironmentReflectance;\n#endif\n};\n#define pbr_inline\n#define inline\nvoid sheenBlock(\nin vec4 vSheenColor,\n#ifdef SHEEN_ROUGHNESS\nin float vSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nin vec4 sheenMapRoughnessData,\n#endif\n#endif\nin float roughness,\n#ifdef SHEEN_TEXTURE\nin vec4 sheenMapData,\nin float sheenMapLevel,\n#endif\nin float reflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nin vec3 baseColor,\nin vec3 surfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nin float NdotV,\nin vec3 environmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nin vec2 AARoughnessFactors,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\nin vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nin vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nin vec2 reflectionCoords,\n#endif\nin float NdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nin float seo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nin float eho,\n#endif\n#endif\nout sheenOutParams outParams\n)\n{\nfloat sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);\nvec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);\nfloat sheenRoughness=sheenIntensity;\noutParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#else\nsheenColor.rgb*=sheenMapData.rgb;\n#endif\nsheenColor.rgb*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nfloat sheenRoughness=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\n#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL\nsheenRoughness*=sheenMapData.a;\n#else\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#endif\n#else\nfloat sheenRoughness=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvec3 environmentSheenBrdf=vec3(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvec3 environmentSheenBrdf=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);\nsampleReflectionTexture(\nsheenAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nsheenRoughness,\n#endif\nreflectionSampler,\nreflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentSheenRadiance\n);\nvec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;\noutParams.sheenColor=sheenColor;\noutParams.sheenRoughness=sheenRoughness;\n}\n#endif\n";h.c.IncludesShadersStore.pbrBlockSheen=y;var T="struct clearcoatOutParams\n{\nvec3 specularEnvironmentR0;\nfloat conservationFactor;\nvec3 clearCoatNormalW;\nvec2 clearCoatAARoughnessFactors;\nfloat clearCoatIntensity;\nfloat clearCoatRoughness;\n#ifdef REFLECTION\nvec3 finalClearCoatRadianceScaled;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 absorption;\nfloat clearCoatNdotVRefract;\nvec3 clearCoatColor;\nfloat clearCoatThickness;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nvec3 energyConservationFactorClearCoat;\n#endif\n#if DEBUGMODE>0\nmat3 TBNClearCoat;\nvec2 clearCoatMapData;\nvec4 clearCoatTintMapData;\nvec4 environmentClearCoatRadiance;\nfloat clearCoatNdotV;\nvec3 clearCoatEnvironmentReflectance;\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\n#define inline\nvoid clearcoatBlock(\nin vec3 vPositionW,\nin vec3 geometricNormalW,\nin vec3 viewDirectionW,\nin vec2 vClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nin vec4 clearCoatMapRoughnessData,\n#endif\nin vec3 specularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nin vec2 clearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nin vec4 vClearCoatTintParams,\nin float clearCoatColorAtDistance,\nin vec4 vClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nin vec4 clearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nin vec2 vClearCoatBumpInfos,\nin vec4 clearCoatBumpMapData,\nin vec2 vClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nin mat3 vTBN,\n#else\nin vec2 vClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nin mat4 normalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nin vec3 faceNormal,\n#endif\n#ifdef REFLECTION\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\nin vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\n#else\nin sampler2D reflectionSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nin float ambientMonochrome,\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\nin float frontFacingMultiplier,\n#endif\nout clearcoatOutParams outParams\n)\n{\nfloat clearCoatIntensity=vClearCoatParams.x;\nfloat clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL\nclearCoatRoughness*=clearCoatMapData.y;\n#else\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;\noutParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;\nfloat clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);\noutParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvec3 specularEnvironmentR0Updated=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);\nvec3 clearCoatNormalW=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nvec2 TBNClearCoatUV=vClearCoatBumpUV*frontFacingMultiplier;\nmat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);\nclearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;\noutParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);\nfloat clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);\nfloat clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatVRefract=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);\noutParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);\nvec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nsampleReflectionTexture(\nclearCoatAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nclearCoatNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nclearCoatRoughness,\n#endif\nreflectionSampler,\nclearCoatReflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentClearCoatRadiance\n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef RADIANCEOCCLUSION\nfloat clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);\nclearCoatEnvironmentReflectance*=clearCoatSeo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);\nclearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnelIBLClearCoat*=clearCoatIntensity;\noutParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\n}\n#endif\n";h.c.IncludesShadersStore.pbrBlockClearcoat=T;var Z="struct iridescenceOutParams\n{\nfloat iridescenceIntensity;\nfloat iridescenceIOR;\nfloat iridescenceThickness;\nvec3 specularEnvironmentR0;\n};\n#ifdef IRIDESCENCE\n#define pbr_inline\n#define inline\nvoid iridescenceBlock(\nin vec4 vIridescenceParams,\nin float viewAngle,\nin vec3 specularEnvironmentR0,\n#ifdef IRIDESCENCE_TEXTURE\nin vec2 iridescenceMapData,\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nin vec2 iridescenceThicknessMapData,\n#endif\n#ifdef CLEARCOAT\nin float NdotVUnclamped,\n#ifdef CLEARCOAT_TEXTURE\nin vec2 clearCoatMapData,\n#endif\n#endif\nout iridescenceOutParams outParams\n)\n{\nfloat iridescenceIntensity=vIridescenceParams.x;\nfloat iridescenceIOR=vIridescenceParams.y;\nfloat iridescenceThicknessMin=vIridescenceParams.z;\nfloat iridescenceThicknessMax=vIridescenceParams.w;\nfloat iridescenceThicknessWeight=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#ifdef IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE\niridescenceThicknessWeight=iridescenceMapData.g;\n#endif\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nfloat iridescenceThickness=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);\nfloat topIor=1.; \n#ifdef CLEARCOAT\nfloat clearCoatIntensity=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,vClearCoatRefractionParams.w-1.,clearCoatIntensity);\nviewAngle=sqrt(1.0+square(1.0/topIor)*(square(NdotVUnclamped)-1.0));\n#endif\nvec3 iridescenceFresnel=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);\noutParams.iridescenceIntensity=iridescenceIntensity;\noutParams.iridescenceThickness=iridescenceThickness;\noutParams.iridescenceIOR=iridescenceIOR;\n}\n#endif\n";h.c.IncludesShadersStore.pbrBlockIridescence=Z;var A="struct subSurfaceOutParams\n{\nvec3 specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvec3 finalRefraction;\nvec3 surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nfloat alpha;\n#endif\n#ifdef REFLECTION\nfloat refractionFactorForIrradiance;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvec3 transmittance;\nfloat translucencyIntensity;\n#ifdef REFLECTION\nvec3 refractionIrradiance;\n#endif\n#endif\n#if DEBUGMODE>0\nvec4 thicknessMap;\nvec4 environmentRefraction;\nvec3 refractionTransmittance;\n#endif\n};\n#ifdef SUBSURFACE\n#define pbr_inline\n#define inline\nvoid subSurfaceBlock(\nin vec3 vSubSurfaceIntensity,\nin vec2 vThicknessParam,\nin vec4 vTintColor,\nin vec3 normalW,\nin vec3 specularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nin vec4 thicknessMap,\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nin vec4 refractionIntensityMap,\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nin vec4 translucencyIntensityMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nin mat4 reflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nin vec3 irradianceVector_,\n#endif\n#if defined(REALTIME_FILTERING)\nin samplerCube reflectionSampler,\nin vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nin samplerCube irradianceSampler,\n#else\nin sampler2D irradianceSampler,\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\nin vec3 surfaceAlbedo,\n#endif\n#ifdef SS_REFRACTION\nin vec3 vPositionW,\nin vec3 viewDirectionW,\nin mat4 view,\nin vec4 vRefractionInfos,\nin mat4 refractionMatrix,\nin vec4 vRefractionMicrosurfaceInfos,\nin vec4 vLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nin float alpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nin float NdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nin float roughness,\n#endif\nin float alphaG,\n#ifdef SS_REFRACTIONMAP_3D\nin samplerCube refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nin samplerCube refractionSamplerLow,\nin samplerCube refractionSamplerHigh,\n#endif\n#else\nin sampler2D refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nin sampler2D refractionSamplerLow,\nin sampler2D refractionSamplerHigh,\n#endif\n#endif\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vRefractionFilteringInfo,\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nin vec3 refractionPosition,\nin vec3 refractionSize,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nin vec3 vDiffusionDistance,\n#endif\nout subSurfaceOutParams outParams\n)\n{\noutParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);\noutParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#if defined(SS_USE_GLTF_TEXTURES)\nfloat thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#ifdef SS_MASK_FROM_THICKNESS_TEXTURE\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE)\n#if defined(SS_USE_GLTF_TEXTURES)\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE)\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);\nvec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);\ntransmittance*=translucencyIntensity;\noutParams.transmittance=transmittance;\noutParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,vRefractionInfos.y);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*thickness,1.0)));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\n#endif\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef SS_HAS_THICKNESS\nfloat ior=vRefractionInfos.y;\n#else\nfloat ior=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionAlphaG=alphaG;\nrefractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionRoughness=alphaG;\nrefractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nfloat refractionAlphaG=alphaG;\nrefractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif (lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n} else {\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);\nvec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);\nenvironmentRefraction.rgb*=volumeAlbedo;\n#else\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\noutParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvec3 irradianceVector=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvec3 irradianceCoords=irradianceVector;\n#else\nvec2 irradianceCoords=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec4 refractionIrradiance=vec4(0.);\n#endif\nrefractionIrradiance.rgb*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance.rgb;\n#endif\n}\n#endif\n";h.c.IncludesShadersStore.pbrBlockSubSurface=A;I(69991),I(84098);var X="vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\nvec3 geometricNormalW=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;\n#endif\n";h.c.IncludesShadersStore.pbrBlockNormalGeometric=X;I(78767);var ww="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n";h.c.IncludesShadersStore.pbrBlockNormalFinal=ww;I(75060);var vw="#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n";h.c.IncludesShadersStore.pbrBlockLightmapInit=vw;var Iw="float NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=absEps(NdotVUnclamped);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=aoOut.ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n";h.c.IncludesShadersStore.pbrBlockGeometryInfo=Iw;var Pw="float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);\nvec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);\n#else \nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nspecularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n";h.c.IncludesShadersStore.pbrBlockReflectance0=Pw;var uw="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n";h.c.IncludesShadersStore.pbrBlockReflectance=uw;var Qw="vec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\npreLightingInfo preInfo;\nlightingInfo info;\nfloat shadow=1.; \n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvec3 absorption=vec3(0.);\n#endif\n";h.c.IncludesShadersStore.pbrBlockDirectLighting=Qw;I(57932);var Kw="#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvec3 finalIrradiance=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);\nfinalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;\nfinalIrradiance*=vLightingIntensity.z;\nfinalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvec3 finalRadiance=reflectionOut.environmentRadiance.rgb;\nfinalRadiance*=subSurfaceOut.specularEnvironmentReflectance;\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenOut.sheenColor;\nfinalSheen=max(finalSheen,0.0);\nvec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;\nfinalClearCoat=max(finalClearCoat,0.0);\nvec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n";h.c.IncludesShadersStore.pbrBlockFinalLitComponents=Kw;var aw="vec3 finalDiffuse=diffuseBase;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\nfinalDiffuse*=vLightingIntensity.x;\nvec3 finalAmbient=vAmbientColor;\nfinalAmbient*=surfaceAlbedo.rgb;\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= vEmissiveInfos.y;\n#endif\nfinalEmissive*=vLightingIntensity.y;\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;\nfinalDiffuse*=ambientOcclusionForDirectDiffuse;\n";h.c.IncludesShadersStore.pbrBlockFinalUnlitComponents=aw;var Uw="vec4 finalColor=vec4(\nfinalAmbient +\nfinalDiffuse +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalEmissive,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,0.0);\n";h.c.IncludesShadersStore.pbrBlockFinalColorComposition=Uw;I(84981),I(80345);var pw="#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\nfinalColor.rgb*=finalColor.a;\n#endif\n";h.c.IncludesShadersStore.pbrBlockImageProcessing=pw;var rw="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {\n#if DEBUGMODE==1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#elif DEBUGMODE==21 && defined(AMBIENT)\ngl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ngl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE==64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE==65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE==87\ngl_FragColor.rgb=vec3(alpha);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#ifdef PREPASS\ngl_FragData[0]=toLinearSpace(gl_FragColor); \ngl_FragData[1]=vec4(0.,0.,0.,0.); \n#endif\nreturn;\n}\n#endif\n";h.c.IncludesShadersStore.pbrDebug=rw;var Yw="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\nprecision highp float;\n#include<oitDeclaration>\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockIridescence>\n#include<pbrBlockSubSurface>\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<oitFragment>\n#include<clipPlaneFragment>\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\nalbedoOpacityOutParams albedoOpacityOut;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#endif\nalbedoOpacityBlock(\nvAlbedoColor,\n#ifdef ALBEDO\nalbedoTexture,\nvAlbedoInfos,\n#endif\n#ifdef OPACITY\nopacityMap,\nvOpacityInfos,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nalbedoOpacityOut\n);\nvec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;\nfloat alpha=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\nambientOcclusionOutParams aoOut;\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;\n#endif\nambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nvAmbientInfos,\n#endif\naoOut\n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\nvec3 baseColor=surfaceAlbedo;\nreflectivityOutParams reflectivityOut;\n#if defined(REFLECTIVITY)\nvec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nvec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\n#ifdef REFLECTIVITY_GAMMA\nsurfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);\n#endif\nsurfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvec4 metallicReflectanceFactors=vMetallicReflectanceFactors;\n#ifdef REFLECTANCE\nvec4 reflectanceFactorsMap=texture2D(reflectanceSampler,vReflectanceUV+uvOffset);\n#ifdef REFLECTANCE_GAMMA\nreflectanceFactorsMap=toLinearSpace(reflectanceFactorsMap);\n#endif\nmetallicReflectanceFactors.rgb*=reflectanceFactorsMap.rgb;\n#endif\n#ifdef METALLIC_REFLECTANCE\nvec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);\n#ifdef METALLIC_REFLECTANCE_GAMMA\nmetallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);\n#endif\n#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY\nmetallicReflectanceFactors.rgb*=metallicReflectanceFactorsMap.rgb;\n#endif\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap.a;\n#endif\n#endif\nreflectivityBlock(\nvReflectivityColor,\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo,\nmetallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nvReflectivityInfos,\nsurfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor,\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurfaceTexel,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nreflectivityOut\n);\nfloat microSurface=reflectivityOut.microSurface;\nfloat roughness=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nalphaFresnelOutParams alphaFresnelOut;\nalphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface,\nalphaFresnelOut\n);\nalpha=alphaFresnelOut.alpha;\n#endif\n#endif\n#include<pbrBlockGeometryInfo>\n#ifdef ANISOTROPIC\nanisotropicOutParams anisotropicOut;\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\n#endif\nanisotropicBlock(\nvAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW,\nanisotropicOut\n);\n#endif\n#ifdef REFLECTION\nreflectionOutParams reflectionOut;\n#ifndef USE_CUSTOM_REFLECTION\nreflectionBlock(\nvPositionW,\nnormalW,\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\nreflectionSampler,\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nvEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nreflectionOut\n);\n#else\n#define CUSTOM_REFLECTION\n#endif\n#endif\n#include<pbrBlockReflectance0>\n#ifdef SHEEN\nsheenOutParams sheenOut;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset);\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;\n#endif\nsheenBlock(\nvSheenColor,\n#ifdef SHEEN_ROUGHNESS\nvSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nsheenMapRoughnessData,\n#endif\n#endif\nroughness,\n#ifdef SHEEN_TEXTURE\nsheenMapData,\nvSheenInfos.y,\n#endif\nreflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nbaseColor,\nsurfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nNdotV,\nenvironmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nAARoughnessFactors,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\nreflectionOut.reflectionCoords,\nNdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nseo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\neho,\n#endif\n#endif\nsheenOut\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\n#endif\n#endif\n#ifdef IRIDESCENCE\niridescenceOutParams iridescenceOut;\n#ifdef IRIDESCENCE_TEXTURE\nvec2 iridescenceMapData=texture2D(iridescenceSampler,vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nvec2 iridescenceThicknessMapData=texture2D(iridescenceThicknessSampler,vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;\n#endif\niridescenceBlock(\nvIridescenceParams,\nNdotV,\nspecularEnvironmentR0,\n#ifdef IRIDESCENCE_TEXTURE\niridescenceMapData,\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\niridescenceThicknessMapData,\n#endif\n#ifdef CLEARCOAT\nNdotVUnclamped,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#endif\niridescenceOut\n);\nfloat iridescenceIntensity=iridescenceOut.iridescenceIntensity;\nspecularEnvironmentR0=iridescenceOut.specularEnvironmentR0;\n#endif\nclearcoatOutParams clearcoatOut;\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\n#endif\n#ifdef CLEARCOAT_BUMP\nvec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatBlock(\nvPositionW,\ngeometricNormalW,\nviewDirectionW,\nvClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatMapRoughnessData,\n#endif\nspecularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nvClearCoatTintParams,\nclearCoatColorAtDistance,\nvClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nclearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nvClearCoatBumpInfos,\nclearCoatBumpMapData,\nvClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nvTBN,\n#else\nvClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nnormalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nfaceNormal,\n#endif\n#ifdef REFLECTION\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nambientMonochrome,\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n(gl_FrontFacing ? 1. : -1.),\n#endif\nclearcoatOut\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n#include<pbrBlockReflectance>\nsubSurfaceOutParams subSurfaceOut;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nvec4 refractionIntensityMap=texture2D(refractionIntensitySampler,vRefractionIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nvec4 translucencyIntensityMap=texture2D(translucencyIntensitySampler,vTranslucencyIntensityUV+uvOffset);\n#endif\nsubSurfaceBlock(\nvSubSurfaceIntensity,\nvThicknessParam,\nvTintColor,\nnormalW,\nspecularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nthicknessMap,\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nrefractionIntensityMap,\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\ntranslucencyIntensityMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nreflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionOut.irradianceVector,\n#endif\n#if defined(REALTIME_FILTERING)\nreflectionSampler,\nvReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\nsurfaceAlbedo,\n#endif\n#ifdef SS_REFRACTION\nvPositionW,\nviewDirectionW,\nview,\nvRefractionInfos,\nrefractionMatrix,\nvRefractionMicrosurfaceInfos,\nvLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nNdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nroughness,\n#endif\nalphaG,\nrefractionSampler,\n#ifndef LODBASEDMICROSFURACE\nrefractionSamplerLow,\nrefractionSamplerHigh,\n#endif\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nvRefractionFilteringInfo,\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nvRefractionPosition,\nvRefractionSize,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvDiffusionDistance,\n#endif\nsubSurfaceOut\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n#include<pbrBlockFinalLitComponents>\n#endif \n#include<pbrBlockFinalUnlitComponents>\n#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=finalColor.a>0.4 ? 1.0 : 0.0;\n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nvec3 sqAlbedo=sqrt(surfaceAlbedo); \n#endif\n#ifdef PREPASS_IRRADIANCE\nvec3 irradiance=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\n#ifdef SS_SCATTERING\ngl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a); \nirradiance/=sqAlbedo;\n#else\ngl_FragData[0]=finalColor; \nfloat scatteringDiffusionProfile=255.;\n#endif\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(clamp(irradiance,vec3(0.),vec3(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); \n#else\ngl_FragData[0]=vec4(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4((view*vec4(normalW,0.0)).rgb,writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(sqAlbedo,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toGammaSpace(specularEnvironmentR0),microSurface)*writeGeometryInfo;\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=finalColor;\n#endif\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=finalColor.rgb*finalColor.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-finalColor.a);\n} else {\nbackColor+=finalColor;\n}\n#endif\n#include<pbrDebug>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";h.c.ShadersStore.pbrPixelShader=Yw;var gw="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef METALLIC_REFLECTANCE\nuniform vec2 vMetallicReflectanceInfos;\nuniform mat4 metallicReflectanceMatrix;\n#endif\n#ifdef REFLECTANCE\nuniform vec2 vReflectanceInfos;\nuniform mat4 reflectanceMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#ifdef IRIDESCENCE\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;\nuniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;\nuniform mat4 translucencyIntensityMatrix;\n#endif\n#endif\n#ifdef NORMAL\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n#endif\n#endif\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";h.c.IncludesShadersStore.pbrVertexDeclaration=gw;I(94040),I(31377),I(54001),I(16554),I(63201),I(138),I(20142),I(49329),I(23654),I(65359),I(58003),I(36062),I(83700),I(63886),I(48767),I(50511),I(97202),I(48623),I(32875),I(3970),I(58878),I(70179),I(61906),I(32560),I(70323),I(35738),I(30242);var Jw="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)\n#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#ifdef CLEARCOAT\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)\n#endif\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#ifdef CLEARCOAT\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)\n#endif\n#ifdef SHEEN\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.z)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";h.c.ShadersStore.pbrVertexShader=Jw;var lw=I(54497),Rw=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.CLEARCOAT=!1,v.CLEARCOAT_DEFAULTIOR=!1,v.CLEARCOAT_TEXTURE=!1,v.CLEARCOAT_TEXTURE_ROUGHNESS=!1,v.CLEARCOAT_TEXTUREDIRECTUV=0,v.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,v.CLEARCOAT_BUMP=!1,v.CLEARCOAT_BUMPDIRECTUV=0,v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,v.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,v.CLEARCOAT_REMAP_F0=!1,v.CLEARCOAT_TINT=!1,v.CLEARCOAT_TINT_TEXTURE=!1,v.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,v.CLEARCOAT_TINT_GAMMATEXTURE=!1,v}return(0,P.m)(v,w),v}(Y.b),xw=function(w){function v(I,P){void 0===P&&(P=!0);var u=w.call(this,I,"PBRClearCoat",100,new Rw,P)||this;return u._isEnabled=!1,u.isEnabled=!1,u.intensity=1,u.roughness=0,u._indexOfRefraction=v._DefaultIndexOfRefraction,u.indexOfRefraction=v._DefaultIndexOfRefraction,u._texture=null,u.texture=null,u._useRoughnessFromMainTexture=!0,u.useRoughnessFromMainTexture=!0,u._textureRoughness=null,u.textureRoughness=null,u._remapF0OnInterfaceChange=!0,u.remapF0OnInterfaceChange=!0,u._bumpTexture=null,u.bumpTexture=null,u._isTintEnabled=!1,u.isTintEnabled=!1,u.tintColor=x.b.White(),u.tintColorAtDistance=1,u.tintThickness=1,u._tintTexture=null,u.tintTexture=null,u._internalMarkAllSubMeshesAsTexturesDirty=I._dirtyCallbacks[1],u}return(0,P.m)(v,w),v.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},v.prototype.isReadyForSubMesh=function(w,v,I){if(!this._isEnabled)return!0;var P=this._material._disableBumpMap;if(w._areTexturesDirty&&v.texturesEnabled){if(this._texture&&o.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&o.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(I.getCaps().standardDerivatives&&this._bumpTexture&&o.d.ClearCoatBumpTextureEnabled&&!P&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&o.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},v.prototype.prepareDefines=function(w,I){var P;this._isEnabled?(w.CLEARCOAT=!0,w.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,w.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(P=this._textureRoughness)||void 0===P?void 0:P._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),w.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,w._areTexturesDirty&&I.texturesEnabled&&(this._texture&&o.d.ClearCoatTextureEnabled?z.e.PrepareDefinesForMergedUV(this._texture,w,"CLEARCOAT_TEXTURE"):w.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&o.d.ClearCoatTextureEnabled?z.e.PrepareDefinesForMergedUV(this._textureRoughness,w,"CLEARCOAT_TEXTURE_ROUGHNESS"):w.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&o.d.ClearCoatBumpTextureEnabled?z.e.PrepareDefinesForMergedUV(this._bumpTexture,w,"CLEARCOAT_BUMP"):w.CLEARCOAT_BUMP=!1,w.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===v._DefaultIndexOfRefraction,this._isTintEnabled?(w.CLEARCOAT_TINT=!0,this._tintTexture&&o.d.ClearCoatTintTextureEnabled?(z.e.PrepareDefinesForMergedUV(this._tintTexture,w,"CLEARCOAT_TINT_TEXTURE"),w.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):w.CLEARCOAT_TINT_TEXTURE=!1):(w.CLEARCOAT_TINT=!1,w.CLEARCOAT_TINT_TEXTURE=!1))):(w.CLEARCOAT=!1,w.CLEARCOAT_TEXTURE=!1,w.CLEARCOAT_TEXTURE_ROUGHNESS=!1,w.CLEARCOAT_BUMP=!1,w.CLEARCOAT_TINT=!1,w.CLEARCOAT_TINT_TEXTURE=!1,w.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,w.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1)},v.prototype.bindForSubMesh=function(w,v,I,P){var u,Q,K,a,U,p,r,Y;if(this._isEnabled){var g=P.materialDefines,J=this._material.isFrozen,l=this._material._disableBumpMap,R=this._material._invertNormalMapX,x=this._material._invertNormalMapY,j=g.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!w.useUbo||!J||!w.isSync){j&&o.d.ClearCoatTextureEnabled?(w.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),z.e.BindTextureMatrix(this._texture,w,"clearCoat")):(this._texture||this._textureRoughness)&&o.d.ClearCoatTextureEnabled&&(w.updateFloat4("vClearCoatInfos",null!==(Q=null===(u=this._texture)||void 0===u?void 0:u.coordinatesIndex)&&void 0!==Q?Q:0,null!==(a=null===(K=this._texture)||void 0===K?void 0:K.level)&&void 0!==a?a:0,null!==(p=null===(U=this._textureRoughness)||void 0===U?void 0:U.coordinatesIndex)&&void 0!==p?p:0,null!==(Y=null===(r=this._textureRoughness)||void 0===r?void 0:r.level)&&void 0!==Y?Y:0),this._texture&&z.e.BindTextureMatrix(this._texture,w,"clearCoat"),!this._textureRoughness||j||g.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE||z.e.BindTextureMatrix(this._textureRoughness,w,"clearCoatRoughness")),this._bumpTexture&&I.getCaps().standardDerivatives&&o.d.ClearCoatTextureEnabled&&!l&&(w.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),z.e.BindTextureMatrix(this._bumpTexture,w,"clearCoatBump"),v._mirroredCameraPosition?w.updateFloat2("vClearCoatTangentSpaceParams",R?1:-1,x?1:-1):w.updateFloat2("vClearCoatTangentSpaceParams",R?-1:1,x?-1:1)),this._tintTexture&&o.d.ClearCoatTintTextureEnabled&&(w.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),z.e.BindTextureMatrix(this._tintTexture,w,"clearCoatTint")),w.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var s=1-this._indexOfRefraction,B=1+this._indexOfRefraction,t=Math.pow(-s/B,2),i=1/this._indexOfRefraction;w.updateFloat4("vClearCoatRefractionParams",t,i,s,B),this._isTintEnabled&&(w.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),w.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}v.texturesEnabled&&(this._texture&&o.d.ClearCoatTextureEnabled&&w.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!j&&!g.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&o.d.ClearCoatTextureEnabled&&w.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&I.getCaps().standardDerivatives&&o.d.ClearCoatBumpTextureEnabled&&!l&&w.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&o.d.ClearCoatTintTextureEnabled&&w.setTexture("clearCoatTintSampler",this._tintTexture))}},v.prototype.hasTexture=function(w){return this._texture===w||(this._textureRoughness===w||(this._bumpTexture===w||this._tintTexture===w))},v.prototype.getActiveTextures=function(w){this._texture&&w.push(this._texture),this._textureRoughness&&w.push(this._textureRoughness),this._bumpTexture&&w.push(this._bumpTexture),this._tintTexture&&w.push(this._tintTexture)},v.prototype.getAnimatables=function(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&w.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&w.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&w.push(this._tintTexture)},v.prototype.dispose=function(w){var v,I,P,u;w&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(I=this._textureRoughness)||void 0===I||I.dispose(),null===(P=this._bumpTexture)||void 0===P||P.dispose(),null===(u=this._tintTexture)||void 0===u||u.dispose())},v.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},v.prototype.addFallbacks=function(w,v,I){return w.CLEARCOAT_BUMP&&v.addFallback(I++,"CLEARCOAT_BUMP"),w.CLEARCOAT_TINT&&v.addFallback(I++,"CLEARCOAT_TINT"),w.CLEARCOAT&&v.addFallback(I++,"CLEARCOAT"),I},v.prototype.getSamplers=function(w){w.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")},v.prototype.getUniforms=function(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}},v._DefaultIndexOfRefraction=1.5,(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,P.i)([(0,u.J)()],v.prototype,"intensity",void 0),(0,P.i)([(0,u.J)()],v.prototype,"roughness",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"indexOfRefraction",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMainTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"textureRoughness",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"remapF0OnInterfaceChange",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"bumpTexture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isTintEnabled",void 0),(0,P.i)([(0,u.n)()],v.prototype,"tintColor",void 0),(0,P.i)([(0,u.J)()],v.prototype,"tintColorAtDistance",void 0),(0,P.i)([(0,u.J)()],v.prototype,"tintThickness",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"tintTexture",void 0),v}(g.d),jw=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.IRIDESCENCE=!1,v.IRIDESCENCE_TEXTURE=!1,v.IRIDESCENCE_TEXTUREDIRECTUV=0,v.IRIDESCENCE_THICKNESS_TEXTURE=!1,v.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0,v.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1,v}return(0,P.m)(v,w),v}(Y.b),sw=function(w){function v(I,P){void 0===P&&(P=!0);var u=w.call(this,I,"PBRIridescence",110,new jw,P)||this;return u._isEnabled=!1,u.isEnabled=!1,u.intensity=1,u.minimumThickness=v._DefaultMinimumThickness,u.maximumThickness=v._DefaultMaximumThickness,u.indexOfRefraction=v._DefaultIndexOfRefraction,u._texture=null,u.texture=null,u._thicknessTexture=null,u.thicknessTexture=null,u._internalMarkAllSubMeshesAsTexturesDirty=I._dirtyCallbacks[1],u}return(0,P.m)(v,w),v.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},v.prototype.isReadyForSubMesh=function(w,v){if(!this._isEnabled)return!0;if(w._areTexturesDirty&&v.texturesEnabled){if(this._texture&&o.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&o.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0},v.prototype.prepareDefines=function(w,v){var I;this._isEnabled?(w.IRIDESCENCE=!0,w.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=null!==this._texture&&this._texture._texture===(null===(I=this._thicknessTexture)||void 0===I?void 0:I._texture)&&this._texture.checkTransformsAreIdentical(this._thicknessTexture),w._areTexturesDirty&&v.texturesEnabled&&(this._texture&&o.d.IridescenceTextureEnabled?z.e.PrepareDefinesForMergedUV(this._texture,w,"IRIDESCENCE_TEXTURE"):w.IRIDESCENCE_TEXTURE=!1,!w.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&this._thicknessTexture&&o.d.IridescenceTextureEnabled?z.e.PrepareDefinesForMergedUV(this._thicknessTexture,w,"IRIDESCENCE_THICKNESS_TEXTURE"):w.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(w.IRIDESCENCE=!1,w.IRIDESCENCE_TEXTURE=!1,w.IRIDESCENCE_THICKNESS_TEXTURE=!1,w.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1)},v.prototype.bindForSubMesh=function(w,v,I,P){var u,Q,K,a,U,p,r,Y;if(this._isEnabled){var g=P.materialDefines,J=this._material.isFrozen,l=g.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE;w.useUbo&&J&&w.isSync||(l&&o.d.IridescenceTextureEnabled?(w.updateFloat4("vIridescenceInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),z.e.BindTextureMatrix(this._texture,w,"iridescence")):(this._texture||this._thicknessTexture)&&o.d.IridescenceTextureEnabled&&(w.updateFloat4("vIridescenceInfos",null!==(Q=null===(u=this._texture)||void 0===u?void 0:u.coordinatesIndex)&&void 0!==Q?Q:0,null!==(a=null===(K=this._texture)||void 0===K?void 0:K.level)&&void 0!==a?a:0,null!==(p=null===(U=this._thicknessTexture)||void 0===U?void 0:U.coordinatesIndex)&&void 0!==p?p:0,null!==(Y=null===(r=this._thicknessTexture)||void 0===r?void 0:r.level)&&void 0!==Y?Y:0),this._texture&&z.e.BindTextureMatrix(this._texture,w,"iridescence"),!this._thicknessTexture||l||g.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE||z.e.BindTextureMatrix(this._thicknessTexture,w,"iridescenceThickness")),w.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),v.texturesEnabled&&(this._texture&&o.d.IridescenceTextureEnabled&&w.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&!l&&!g.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&o.d.IridescenceTextureEnabled&&w.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}},v.prototype.hasTexture=function(w){return this._texture===w||this._thicknessTexture===w},v.prototype.getActiveTextures=function(w){this._texture&&w.push(this._texture),this._thicknessTexture&&w.push(this._thicknessTexture)},v.prototype.getAnimatables=function(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&w.push(this._thicknessTexture)},v.prototype.dispose=function(w){var v,I;w&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(I=this._thicknessTexture)||void 0===I||I.dispose())},v.prototype.getClassName=function(){return"PBRIridescenceConfiguration"},v.prototype.addFallbacks=function(w,v,I){return w.IRIDESCENCE&&v.addFallback(I++,"IRIDESCENCE"),I},v.prototype.getSamplers=function(w){w.push("iridescenceSampler","iridescenceThicknessSampler")},v.prototype.getUniforms=function(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}},v._DefaultMinimumThickness=100,v._DefaultMaximumThickness=400,v._DefaultIndexOfRefraction=1.3,(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,P.i)([(0,u.J)()],v.prototype,"intensity",void 0),(0,P.i)([(0,u.J)()],v.prototype,"minimumThickness",void 0),(0,P.i)([(0,u.J)()],v.prototype,"maximumThickness",void 0),(0,P.i)([(0,u.J)()],v.prototype,"indexOfRefraction",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"thicknessTexture",void 0),v}(g.d),Bw=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.ANISOTROPIC=!1,v.ANISOTROPIC_TEXTURE=!1,v.ANISOTROPIC_TEXTUREDIRECTUV=0,v.MAINUV1=!1,v}return(0,P.m)(v,w),v}(Y.b),tw=function(w){function v(v,I){void 0===I&&(I=!0);var P=w.call(this,v,"PBRAnisotropic",110,new Bw,I)||this;return P._isEnabled=!1,P.isEnabled=!1,P.intensity=1,P.direction=new p.k(1,0),P._texture=null,P.texture=null,P._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1],P}return(0,P.m)(v,w),v.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},v.prototype.isReadyForSubMesh=function(w,v){return!this._isEnabled||!(w._areTexturesDirty&&v.texturesEnabled&&this._texture&&o.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},v.prototype.prepareDefinesBeforeAttributes=function(w,v,I){this._isEnabled?(w.ANISOTROPIC=this._isEnabled,this._isEnabled&&!I.isVerticesDataPresent(r.f.TangentKind)&&(w._needUVs=!0,w.MAINUV1=!0),w._areTexturesDirty&&v.texturesEnabled&&(this._texture&&o.d.AnisotropicTextureEnabled?z.e.PrepareDefinesForMergedUV(this._texture,w,"ANISOTROPIC_TEXTURE"):w.ANISOTROPIC_TEXTURE=!1)):(w.ANISOTROPIC=!1,w.ANISOTROPIC_TEXTURE=!1)},v.prototype.bindForSubMesh=function(w,v){if(this._isEnabled){var I=this._material.isFrozen;w.useUbo&&I&&w.isSync||(this._texture&&o.d.AnisotropicTextureEnabled&&(w.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),z.e.BindTextureMatrix(this._texture,w,"anisotropy")),w.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),v.texturesEnabled&&this._texture&&o.d.AnisotropicTextureEnabled&&w.setTexture("anisotropySampler",this._texture)}},v.prototype.hasTexture=function(w){return this._texture===w},v.prototype.getActiveTextures=function(w){this._texture&&w.push(this._texture)},v.prototype.getAnimatables=function(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture)},v.prototype.dispose=function(w){w&&this._texture&&this._texture.dispose()},v.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},v.prototype.addFallbacks=function(w,v,I){return w.ANISOTROPIC&&v.addFallback(I++,"ANISOTROPIC"),I},v.prototype.getSamplers=function(w){w.push("anisotropySampler")},v.prototype.getUniforms=function(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}},(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,P.i)([(0,u.J)()],v.prototype,"intensity",void 0),(0,P.i)([(0,u.D)()],v.prototype,"direction",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),v}(g.d),iw=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.SHEEN=!1,v.SHEEN_TEXTURE=!1,v.SHEEN_GAMMATEXTURE=!1,v.SHEEN_TEXTURE_ROUGHNESS=!1,v.SHEEN_TEXTUREDIRECTUV=0,v.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,v.SHEEN_LINKWITHALBEDO=!1,v.SHEEN_ROUGHNESS=!1,v.SHEEN_ALBEDOSCALING=!1,v.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,v.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,v}return(0,P.m)(v,w),v}(Y.b),zw=function(w){function v(v,I){void 0===I&&(I=!0);var P=w.call(this,v,"Sheen",120,new iw,I)||this;return P._isEnabled=!1,P.isEnabled=!1,P._linkSheenWithAlbedo=!1,P.linkSheenWithAlbedo=!1,P.intensity=1,P.color=x.b.White(),P._texture=null,P.texture=null,P._useRoughnessFromMainTexture=!0,P.useRoughnessFromMainTexture=!0,P._roughness=null,P.roughness=null,P._textureRoughness=null,P.textureRoughness=null,P._albedoScaling=!1,P.albedoScaling=!1,P._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1],P}return(0,P.m)(v,w),v.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},v.prototype.isReadyForSubMesh=function(w,v){if(!this._isEnabled)return!0;if(w._areTexturesDirty&&v.texturesEnabled){if(this._texture&&o.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&o.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0},v.prototype.prepareDefines=function(w,v){var I;this._isEnabled?(w.SHEEN=!0,w.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,w.SHEEN_ROUGHNESS=null!==this._roughness,w.SHEEN_ALBEDOSCALING=this._albedoScaling,w.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,w.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(I=this._textureRoughness)||void 0===I?void 0:I._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),w._areTexturesDirty&&v.texturesEnabled&&(this._texture&&o.d.SheenTextureEnabled?(z.e.PrepareDefinesForMergedUV(this._texture,w,"SHEEN_TEXTURE"),w.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):w.SHEEN_TEXTURE=!1,this._textureRoughness&&o.d.SheenTextureEnabled?z.e.PrepareDefinesForMergedUV(this._textureRoughness,w,"SHEEN_TEXTURE_ROUGHNESS"):w.SHEEN_TEXTURE_ROUGHNESS=!1)):(w.SHEEN=!1,w.SHEEN_TEXTURE=!1,w.SHEEN_TEXTURE_ROUGHNESS=!1,w.SHEEN_LINKWITHALBEDO=!1,w.SHEEN_ROUGHNESS=!1,w.SHEEN_ALBEDOSCALING=!1,w.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,w.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1)},v.prototype.bindForSubMesh=function(w,v,I,P){var u,Q,K,a,U,p,r,Y;if(this._isEnabled){var g=P.materialDefines,J=this._material.isFrozen,l=g.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;w.useUbo&&J&&w.isSync||(l&&o.d.SheenTextureEnabled?(w.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),z.e.BindTextureMatrix(this._texture,w,"sheen")):(this._texture||this._textureRoughness)&&o.d.SheenTextureEnabled&&(w.updateFloat4("vSheenInfos",null!==(Q=null===(u=this._texture)||void 0===u?void 0:u.coordinatesIndex)&&void 0!==Q?Q:0,null!==(a=null===(K=this._texture)||void 0===K?void 0:K.level)&&void 0!==a?a:0,null!==(p=null===(U=this._textureRoughness)||void 0===U?void 0:U.coordinatesIndex)&&void 0!==p?p:0,null!==(Y=null===(r=this._textureRoughness)||void 0===r?void 0:r.level)&&void 0!==Y?Y:0),this._texture&&z.e.BindTextureMatrix(this._texture,w,"sheen"),!this._textureRoughness||l||g.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE||z.e.BindTextureMatrix(this._textureRoughness,w,"sheenRoughness")),w.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&w.updateFloat("vSheenRoughness",this._roughness)),v.texturesEnabled&&(this._texture&&o.d.SheenTextureEnabled&&w.setTexture("sheenSampler",this._texture),this._textureRoughness&&!l&&!g.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&o.d.SheenTextureEnabled&&w.setTexture("sheenRoughnessSampler",this._textureRoughness))}},v.prototype.hasTexture=function(w){return this._texture===w||this._textureRoughness===w},v.prototype.getActiveTextures=function(w){this._texture&&w.push(this._texture),this._textureRoughness&&w.push(this._textureRoughness)},v.prototype.getAnimatables=function(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&w.push(this._textureRoughness)},v.prototype.dispose=function(w){var v,I;w&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(I=this._textureRoughness)||void 0===I||I.dispose())},v.prototype.getClassName=function(){return"PBRSheenConfiguration"},v.prototype.addFallbacks=function(w,v,I){return w.SHEEN&&v.addFallback(I++,"SHEEN"),I},v.prototype.getSamplers=function(w){w.push("sheenSampler","sheenRoughnessSampler")},v.prototype.getUniforms=function(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}},(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"linkSheenWithAlbedo",void 0),(0,P.i)([(0,u.J)()],v.prototype,"intensity",void 0),(0,P.i)([(0,u.n)()],v.prototype,"color",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMainTexture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"textureRoughness",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoScaling",void 0),v}(g.d),Ew=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.SUBSURFACE=!1,v.SS_REFRACTION=!1,v.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,v.SS_TRANSLUCENCY=!1,v.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,v.SS_SCATTERING=!1,v.SS_THICKNESSANDMASK_TEXTURE=!1,v.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,v.SS_HAS_THICKNESS=!1,v.SS_REFRACTIONINTENSITY_TEXTURE=!1,v.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,v.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,v.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,v.SS_REFRACTIONMAP_3D=!1,v.SS_REFRACTIONMAP_OPPOSITEZ=!1,v.SS_LODINREFRACTIONALPHA=!1,v.SS_GAMMAREFRACTION=!1,v.SS_RGBDREFRACTION=!1,v.SS_LINEARSPECULARREFRACTION=!1,v.SS_LINKREFRACTIONTOTRANSPARENCY=!1,v.SS_ALBEDOFORREFRACTIONTINT=!1,v.SS_ALBEDOFORTRANSLUCENCYTINT=!1,v.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,v.SS_USE_THICKNESS_AS_DEPTH=!1,v.SS_MASK_FROM_THICKNESS_TEXTURE=!1,v.SS_USE_GLTF_TEXTURES=!1,v}return(0,P.m)(v,w),v}(Y.b),ow=function(w){function v(v,I){void 0===I&&(I=!0);var P=w.call(this,v,"PBRSubSurface",130,new Ew,I)||this;return P._isRefractionEnabled=!1,P.isRefractionEnabled=!1,P._isTranslucencyEnabled=!1,P.isTranslucencyEnabled=!1,P._isScatteringEnabled=!1,P.isScatteringEnabled=!1,P._scatteringDiffusionProfileIndex=0,P.refractionIntensity=1,P.translucencyIntensity=1,P.useAlbedoToTintRefraction=!1,P.useAlbedoToTintTranslucency=!1,P._thicknessTexture=null,P.thicknessTexture=null,P._refractionTexture=null,P.refractionTexture=null,P._indexOfRefraction=1.5,P.indexOfRefraction=1.5,P._volumeIndexOfRefraction=-1,P._invertRefractionY=!1,P.invertRefractionY=!1,P._linkRefractionWithTransparency=!1,P.linkRefractionWithTransparency=!1,P.minimumThickness=0,P.maximumThickness=1,P.useThicknessAsDepth=!1,P.tintColor=x.b.White(),P.tintColorAtDistance=1,P.diffusionDistance=x.b.White(),P._useMaskFromThicknessTexture=!1,P.useMaskFromThicknessTexture=!1,P._refractionIntensityTexture=null,P.refractionIntensityTexture=null,P._translucencyIntensityTexture=null,P.translucencyIntensityTexture=null,P._useGltfStyleTextures=!1,P.useGltfStyleTextures=!1,P._scene=v.getScene(),P.registerForExtraEvents=!0,P._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1],P._internalMarkScenePrePassDirty=v._dirtyCallbacks[32],P}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"scatteringDiffusionProfile",{get:function(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null},set:function(w){this._scene.enableSubSurfaceForPrePass()&&w&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(w))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"volumeIndexOfRefraction",{get:function(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction},set:function(w){this._volumeIndexOfRefraction=w>=1?w:-1},enumerable:!1,configurable:!0}),v.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},v.prototype._markScenePrePassDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()},v.prototype.isReadyForSubMesh=function(w,v){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(w._areTexturesDirty&&v.texturesEnabled){if(this._thicknessTexture&&o.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var I=this._getRefractionTexture(v);if(I&&o.d.RefractionTextureEnabled&&!I.isReadyOrNotBlocking())return!1}return!0},v.prototype.prepareDefines=function(w,v){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return w.SUBSURFACE=!1,w.SS_TRANSLUCENCY=!1,w.SS_SCATTERING=!1,void(w.SS_REFRACTION=!1);if(w._areTexturesDirty){w.SUBSURFACE=!0,w.SS_TRANSLUCENCY=this._isTranslucencyEnabled,w.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,w.SS_SCATTERING=this._isScatteringEnabled,w.SS_THICKNESSANDMASK_TEXTURE=!1,w.SS_REFRACTIONINTENSITY_TEXTURE=!1,w.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,w.SS_HAS_THICKNESS=!1,w.SS_MASK_FROM_THICKNESS_TEXTURE=!1,w.SS_USE_GLTF_TEXTURES=!1,w.SS_REFRACTION=!1,w.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,w.SS_REFRACTIONMAP_3D=!1,w.SS_GAMMAREFRACTION=!1,w.SS_RGBDREFRACTION=!1,w.SS_LINEARSPECULARREFRACTION=!1,w.SS_REFRACTIONMAP_OPPOSITEZ=!1,w.SS_LODINREFRACTIONALPHA=!1,w.SS_LINKREFRACTIONTOTRANSPARENCY=!1,w.SS_ALBEDOFORREFRACTIONTINT=!1,w.SS_ALBEDOFORTRANSLUCENCYTINT=!1,w.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,w.SS_USE_THICKNESS_AS_DEPTH=!1;var I=!!this._thicknessTexture&&!!this._refractionIntensityTexture&&this._refractionIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._refractionIntensityTexture._texture===this._thicknessTexture._texture,P=!!this._thicknessTexture&&!!this._translucencyIntensityTexture&&this._translucencyIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._translucencyIntensityTexture._texture===this._thicknessTexture._texture,u=(I||!this._refractionIntensityTexture)&&(P||!this._translucencyIntensityTexture);if(w._areTexturesDirty&&v.texturesEnabled&&(this._thicknessTexture&&o.d.ThicknessTextureEnabled&&z.e.PrepareDefinesForMergedUV(this._thicknessTexture,w,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&o.d.RefractionIntensityTextureEnabled&&!u&&z.e.PrepareDefinesForMergedUV(this._refractionIntensityTexture,w,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&o.d.TranslucencyIntensityTextureEnabled&&!u&&z.e.PrepareDefinesForMergedUV(this._translucencyIntensityTexture,w,"SS_TRANSLUCENCYINTENSITY_TEXTURE")),w.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,w.SS_MASK_FROM_THICKNESS_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture||!!this._translucencyIntensityTexture)&&u,w.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,w.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture)&&u,w.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._translucencyIntensityTexture)&&u,this._isRefractionEnabled&&v.texturesEnabled){var Q=this._getRefractionTexture(v);Q&&o.d.RefractionTextureEnabled&&(w.SS_REFRACTION=!0,w.SS_REFRACTIONMAP_3D=Q.isCube,w.SS_GAMMAREFRACTION=Q.gammaSpace,w.SS_RGBDREFRACTION=Q.isRGBD,w.SS_LINEARSPECULARREFRACTION=Q.linearSpecularLOD,w.SS_REFRACTIONMAP_OPPOSITEZ=Q.invertZ,w.SS_LODINREFRACTIONALPHA=Q.lodLevelInAlpha,w.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,w.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,w.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=Q.isCube&&Q.boundingBoxSize,w.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(w.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}},v.prototype.hardBindForSubMesh=function(w,v,I,P){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled){P.getRenderingMesh().getWorldMatrix().decompose(p.i.Vector3[0]);var u=Math.max(Math.abs(p.i.Vector3[0].x),Math.abs(p.i.Vector3[0].y),Math.abs(p.i.Vector3[0].z));w.updateFloat2("vThicknessParam",this.minimumThickness*u,(this.maximumThickness-this.minimumThickness)*u)}},v.prototype.bindForSubMesh=function(w,v,I,P){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled){var u=P.materialDefines,Q=this._material.isFrozen,K=this._material.realTimeFiltering,a=u.LODBASEDMICROSFURACE,U=this._getRefractionTexture(v);if(!w.useUbo||!Q||!w.isSync){if(this._thicknessTexture&&o.d.ThicknessTextureEnabled&&(w.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),z.e.BindTextureMatrix(this._thicknessTexture,w,"thickness")),this._refractionIntensityTexture&&o.d.RefractionIntensityTextureEnabled&&u.SS_REFRACTIONINTENSITY_TEXTURE&&(w.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),z.e.BindTextureMatrix(this._refractionIntensityTexture,w,"refractionIntensity")),this._translucencyIntensityTexture&&o.d.TranslucencyIntensityTextureEnabled&&u.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(w.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),z.e.BindTextureMatrix(this._translucencyIntensityTexture,w,"translucencyIntensity")),U&&o.d.RefractionTextureEnabled){w.updateMatrix("refractionMatrix",U.getReflectionTextureMatrix());var p=1;U.isCube||U.depth&&(p=U.depth);var r=U.getSize().width,Y=this.volumeIndexOfRefraction;if(w.updateFloat4("vRefractionInfos",U.level,1/Y,p,this._invertRefractionY?-1:1),w.updateFloat4("vRefractionMicrosurfaceInfos",r,U.lodGenerationScale,U.lodGenerationOffset,1/this.indexOfRefraction),K&&w.updateFloat2("vRefractionFilteringInfo",r,j.b.Log2(r)),U.boundingBoxSize){var g=U;w.updateVector3("vRefractionPosition",g.boundingBoxPosition),w.updateVector3("vRefractionSize",g.boundingBoxSize)}}this._isScatteringEnabled&&w.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),w.updateColor3("vDiffusionDistance",this.diffusionDistance),w.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),w.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0)}v.texturesEnabled&&(this._thicknessTexture&&o.d.ThicknessTextureEnabled&&w.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&o.d.RefractionIntensityTextureEnabled&&u.SS_REFRACTIONINTENSITY_TEXTURE&&w.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&o.d.TranslucencyIntensityTextureEnabled&&u.SS_TRANSLUCENCYINTENSITY_TEXTURE&&w.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),U&&o.d.RefractionTextureEnabled&&(a?w.setTexture("refractionSampler",U):(w.setTexture("refractionSampler",U._lodTextureMid||U),w.setTexture("refractionSamplerLow",U._lodTextureLow||U),w.setTexture("refractionSamplerHigh",U._lodTextureHigh||U))))}},v.prototype._getRefractionTexture=function(w){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?w.environmentTexture:null},Object.defineProperty(v.prototype,"disableAlphaBlending",{get:function(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!1,configurable:!0}),v.prototype.fillRenderTargetTextures=function(w){o.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&w.push(this._refractionTexture)},v.prototype.hasTexture=function(w){return this._thicknessTexture===w||this._refractionTexture===w},v.prototype.hasRenderTargetTextures=function(){return!!(o.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},v.prototype.getActiveTextures=function(w){this._thicknessTexture&&w.push(this._thicknessTexture),this._refractionTexture&&w.push(this._refractionTexture)},v.prototype.getAnimatables=function(w){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&w.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&w.push(this._refractionTexture)},v.prototype.dispose=function(w){w&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},v.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},v.prototype.addFallbacks=function(w,v,I){return w.SS_SCATTERING&&v.addFallback(I++,"SS_SCATTERING"),w.SS_TRANSLUCENCY&&v.addFallback(I++,"SS_TRANSLUCENCY"),I},v.prototype.getSamplers=function(w){w.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},v.prototype.getUniforms=function(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"}]}},(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isRefractionEnabled",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isTranslucencyEnabled",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markScenePrePassDirty")],v.prototype,"isScatteringEnabled",void 0),(0,P.i)([(0,u.J)()],v.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,P.i)([(0,u.J)()],v.prototype,"refractionIntensity",void 0),(0,P.i)([(0,u.J)()],v.prototype,"translucencyIntensity",void 0),(0,P.i)([(0,u.J)()],v.prototype,"useAlbedoToTintRefraction",void 0),(0,P.i)([(0,u.J)()],v.prototype,"useAlbedoToTintTranslucency",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"thicknessTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"refractionTexture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"indexOfRefraction",void 0),(0,P.i)([(0,u.J)()],v.prototype,"_volumeIndexOfRefraction",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"volumeIndexOfRefraction",null),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertRefractionY",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"linkRefractionWithTransparency",void 0),(0,P.i)([(0,u.J)()],v.prototype,"minimumThickness",void 0),(0,P.i)([(0,u.J)()],v.prototype,"maximumThickness",void 0),(0,P.i)([(0,u.J)()],v.prototype,"useThicknessAsDepth",void 0),(0,P.i)([(0,u.n)()],v.prototype,"tintColor",void 0),(0,P.i)([(0,u.J)()],v.prototype,"tintColorAtDistance",void 0),(0,P.i)([(0,u.n)()],v.prototype,"diffusionDistance",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useMaskFromThicknessTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"refractionIntensityTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"translucencyIntensityTexture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useGltfStyleTextures",void 0),v}(g.d),hw=I(56513),nw={effect:null,subMesh:null},Ww=function(w){function v(v){var I=w.call(this,v)||this;return I.PBR=!0,I.NUM_SAMPLES="0",I.REALTIME_FILTERING=!1,I.MAINUV1=!1,I.MAINUV2=!1,I.MAINUV3=!1,I.MAINUV4=!1,I.MAINUV5=!1,I.MAINUV6=!1,I.UV1=!1,I.UV2=!1,I.UV3=!1,I.UV4=!1,I.UV5=!1,I.UV6=!1,I.ALBEDO=!1,I.GAMMAALBEDO=!1,I.ALBEDODIRECTUV=0,I.VERTEXCOLOR=!1,I.BAKED_VERTEX_ANIMATION_TEXTURE=!1,I.AMBIENT=!1,I.AMBIENTDIRECTUV=0,I.AMBIENTINGRAYSCALE=!1,I.OPACITY=!1,I.VERTEXALPHA=!1,I.OPACITYDIRECTUV=0,I.OPACITYRGB=!1,I.ALPHATEST=!1,I.DEPTHPREPASS=!1,I.ALPHABLEND=!1,I.ALPHAFROMALBEDO=!1,I.ALPHATESTVALUE="0.5",I.SPECULAROVERALPHA=!1,I.RADIANCEOVERALPHA=!1,I.ALPHAFRESNEL=!1,I.LINEARALPHAFRESNEL=!1,I.PREMULTIPLYALPHA=!1,I.EMISSIVE=!1,I.EMISSIVEDIRECTUV=0,I.GAMMAEMISSIVE=!1,I.REFLECTIVITY=!1,I.REFLECTIVITY_GAMMA=!1,I.REFLECTIVITYDIRECTUV=0,I.SPECULARTERM=!1,I.MICROSURFACEFROMREFLECTIVITYMAP=!1,I.MICROSURFACEAUTOMATIC=!1,I.LODBASEDMICROSFURACE=!1,I.MICROSURFACEMAP=!1,I.MICROSURFACEMAPDIRECTUV=0,I.METALLICWORKFLOW=!1,I.ROUGHNESSSTOREINMETALMAPALPHA=!1,I.ROUGHNESSSTOREINMETALMAPGREEN=!1,I.METALLNESSSTOREINMETALMAPBLUE=!1,I.AOSTOREINMETALMAPRED=!1,I.METALLIC_REFLECTANCE=!1,I.METALLIC_REFLECTANCE_GAMMA=!1,I.METALLIC_REFLECTANCEDIRECTUV=0,I.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,I.REFLECTANCE=!1,I.REFLECTANCE_GAMMA=!1,I.REFLECTANCEDIRECTUV=0,I.ENVIRONMENTBRDF=!1,I.ENVIRONMENTBRDF_RGBD=!1,I.NORMAL=!1,I.TANGENT=!1,I.BUMP=!1,I.BUMPDIRECTUV=0,I.OBJECTSPACE_NORMALMAP=!1,I.PARALLAX=!1,I.PARALLAXOCCLUSION=!1,I.NORMALXYSCALE=!0,I.LIGHTMAP=!1,I.LIGHTMAPDIRECTUV=0,I.USELIGHTMAPASSHADOWMAP=!1,I.GAMMALIGHTMAP=!1,I.RGBDLIGHTMAP=!1,I.REFLECTION=!1,I.REFLECTIONMAP_3D=!1,I.REFLECTIONMAP_SPHERICAL=!1,I.REFLECTIONMAP_PLANAR=!1,I.REFLECTIONMAP_CUBIC=!1,I.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,I.REFLECTIONMAP_PROJECTION=!1,I.REFLECTIONMAP_SKYBOX=!1,I.REFLECTIONMAP_EXPLICIT=!1,I.REFLECTIONMAP_EQUIRECTANGULAR=!1,I.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,I.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,I.INVERTCUBICMAP=!1,I.USESPHERICALFROMREFLECTIONMAP=!1,I.USEIRRADIANCEMAP=!1,I.USESPHERICALINVERTEX=!1,I.REFLECTIONMAP_OPPOSITEZ=!1,I.LODINREFLECTIONALPHA=!1,I.GAMMAREFLECTION=!1,I.RGBDREFLECTION=!1,I.LINEARSPECULARREFLECTION=!1,I.RADIANCEOCCLUSION=!1,I.HORIZONOCCLUSION=!1,I.INSTANCES=!1,I.THIN_INSTANCES=!1,I.INSTANCESCOLOR=!1,I.PREPASS=!1,I.PREPASS_IRRADIANCE=!1,I.PREPASS_IRRADIANCE_INDEX=-1,I.PREPASS_ALBEDO_SQRT=!1,I.PREPASS_ALBEDO_SQRT_INDEX=-1,I.PREPASS_DEPTH=!1,I.PREPASS_DEPTH_INDEX=-1,I.PREPASS_NORMAL=!1,I.PREPASS_NORMAL_INDEX=-1,I.PREPASS_POSITION=!1,I.PREPASS_POSITION_INDEX=-1,I.PREPASS_VELOCITY=!1,I.PREPASS_VELOCITY_INDEX=-1,I.PREPASS_REFLECTIVITY=!1,I.PREPASS_REFLECTIVITY_INDEX=-1,I.SCENE_MRT_COUNT=0,I.NUM_BONE_INFLUENCERS=0,I.BonesPerMesh=0,I.BONETEXTURE=!1,I.BONES_VELOCITY_ENABLED=!1,I.NONUNIFORMSCALING=!1,I.MORPHTARGETS=!1,I.MORPHTARGETS_NORMAL=!1,I.MORPHTARGETS_TANGENT=!1,I.MORPHTARGETS_UV=!1,I.NUM_MORPH_INFLUENCERS=0,I.MORPHTARGETS_TEXTURE=!1,I.IMAGEPROCESSING=!1,I.VIGNETTE=!1,I.VIGNETTEBLENDMODEMULTIPLY=!1,I.VIGNETTEBLENDMODEOPAQUE=!1,I.TONEMAPPING=!1,I.TONEMAPPING_ACES=!1,I.CONTRAST=!1,I.COLORCURVES=!1,I.COLORGRADING=!1,I.COLORGRADING3D=!1,I.SAMPLER3DGREENDEPTH=!1,I.SAMPLER3DBGRMAP=!1,I.IMAGEPROCESSINGPOSTPROCESS=!1,I.SKIPFINALCOLORCLAMP=!1,I.EXPOSURE=!1,I.MULTIVIEW=!1,I.ORDER_INDEPENDENT_TRANSPARENCY=!1,I.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,I.USEPHYSICALLIGHTFALLOFF=!1,I.USEGLTFLIGHTFALLOFF=!1,I.TWOSIDEDLIGHTING=!1,I.SHADOWFLOAT=!1,I.CLIPPLANE=!1,I.CLIPPLANE2=!1,I.CLIPPLANE3=!1,I.CLIPPLANE4=!1,I.CLIPPLANE5=!1,I.CLIPPLANE6=!1,I.POINTSIZE=!1,I.FOG=!1,I.LOGARITHMICDEPTH=!1,I.FORCENORMALFORWARD=!1,I.SPECULARAA=!1,I.UNLIT=!1,I.DEBUGMODE=0,I.rebuild(),I}return(0,P.m)(v,w),v.prototype.reset=function(){w.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0},v}(Y.b),Vw=function(w){function v(I,P){var u=w.call(this,I,P)||this;return u._directIntensity=1,u._emissiveIntensity=1,u._environmentIntensity=1,u._specularIntensity=1,u._lightingInfos=new p.p(u._directIntensity,u._emissiveIntensity,u._environmentIntensity,u._specularIntensity),u._disableBumpMap=!1,u._albedoTexture=null,u._ambientTexture=null,u._ambientTextureStrength=1,u._ambientTextureImpactOnAnalyticalLights=v.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,u._opacityTexture=null,u._reflectionTexture=null,u._emissiveTexture=null,u._reflectivityTexture=null,u._metallicTexture=null,u._metallic=null,u._roughness=null,u._metallicF0Factor=1,u._metallicReflectanceColor=x.b.White(),u._useOnlyMetallicFromMetallicReflectanceTexture=!1,u._metallicReflectanceTexture=null,u._reflectanceTexture=null,u._microSurfaceTexture=null,u._bumpTexture=null,u._lightmapTexture=null,u._ambientColor=new x.b(0,0,0),u._albedoColor=new x.b(1,1,1),u._reflectivityColor=new x.b(1,1,1),u._reflectionColor=new x.b(1,1,1),u._emissiveColor=new x.b(0,0,0),u._microSurface=.9,u._useLightmapAsShadowmap=!1,u._useHorizonOcclusion=!0,u._useRadianceOcclusion=!0,u._useAlphaFromAlbedoTexture=!1,u._useSpecularOverAlpha=!0,u._useMicroSurfaceFromReflectivityMapAlpha=!1,u._useRoughnessFromMetallicTextureAlpha=!0,u._useRoughnessFromMetallicTextureGreen=!1,u._useMetallnessFromMetallicTextureBlue=!1,u._useAmbientOcclusionFromMetallicTextureRed=!1,u._useAmbientInGrayScale=!1,u._useAutoMicroSurfaceFromReflectivityMap=!1,u._lightFalloff=v.LIGHTFALLOFF_PHYSICAL,u._useRadianceOverAlpha=!0,u._useObjectSpaceNormalMap=!1,u._useParallax=!1,u._useParallaxOcclusion=!1,u._parallaxScaleBias=.05,u._disableLighting=!1,u._maxSimultaneousLights=4,u._invertNormalMapX=!1,u._invertNormalMapY=!1,u._twoSidedLighting=!1,u._alphaCutOff=.4,u._forceAlphaTest=!1,u._useAlphaFresnel=!1,u._useLinearAlphaFresnel=!1,u._environmentBRDFTexture=null,u._forceIrradianceInFragment=!1,u._realTimeFiltering=!1,u._realTimeFilteringQuality=8,u._forceNormalForward=!1,u._enableSpecularAntiAliasing=!1,u._imageProcessingObserver=null,u._renderTargets=new K.g(16),u._globalAmbientColor=new x.b(0,0,0),u._useLogarithmicDepth=!1,u._unlit=!1,u._debugMode=0,u.debugMode=0,u._debugLimit=-1,u._debugFactor=1,u._cacheHasRenderTargetTextures=!1,u.brdf=new l(u),u.clearCoat=new xw(u),u.iridescence=new sw(u),u.anisotropy=new tw(u),u.sheen=new zw(u),u.subSurface=new ow(u),u.detailMap=new hw.b(u),u._attachImageProcessingConfiguration(null),u.getRenderTargetTextures=function(){return u._renderTargets.reset(),o.d.ReflectionTextureEnabled&&u._reflectionTexture&&u._reflectionTexture.isRenderTarget&&u._renderTargets.push(u._reflectionTexture),u._eventInfo.renderTargets=u._renderTargets,u._callbackPluginEventFillRenderTargetTextures(u._eventInfo),u._renderTargets},u._environmentBRDFTexture=(0,a.b)(u.getScene()),u.prePassConfiguration=new R.c,u}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"realTimeFiltering",{get:function(){return this._realTimeFiltering},set:function(w){this._realTimeFiltering=w,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"realTimeFilteringQuality",{get:function(){return this._realTimeFilteringQuality},set:function(w){this._realTimeFilteringQuality=w,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),v.prototype._attachImageProcessingConfiguration=function(w){var v=this;w!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=w||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){v._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(v.prototype,"hasRenderTargetTextures",{get:function(){return!!(o.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isPrePassCapable",{get:function(){return!this.disableDepthWrite},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(v.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(w){this._useLogarithmicDepth=w&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"_disableAlphaBlending",{get:function(){var w;return this._transparencyMode===v.PBRMATERIAL_OPAQUE||this._transparencyMode===v.PBRMATERIAL_ALPHATEST||(null===(w=this.subSurface)||void 0===w?void 0:w.disableAlphaBlending)},enumerable:!1,configurable:!0}),v.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},v.prototype.needAlphaTesting=function(){var w;return!!this._forceAlphaTest||!(null===(w=this.subSurface)||void 0===w?void 0:w.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===v.PBRMATERIAL_ALPHATEST))},v.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==v.PBRMATERIAL_OPAQUE},v.prototype._hasAlphaChannel=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture},v.prototype.getAlphaTestTexture=function(){return this._albedoTexture},v.prototype.isReadyForSubMesh=function(w,v,I){if(this._uniformBufferLayoutBuilt||this.buildUniformLayout(),v.effect&&this.isFrozen&&v.effect._wasPreviouslyReady&&v.effect._wasPreviouslyUsingInstances===I)return!0;v.materialDefines||(this._callbackPluginEventGeneric(t.d.GetDefineNames,this._eventInfo),v.materialDefines=new Ww(this._eventInfo.defineNames));var P=v.materialDefines;if(this._isReadyForSubMesh(v))return!0;var u=this.getScene(),K=u.getEngine();if(P._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,u.texturesEnabled)){if(this._albedoTexture&&o.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&o.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&o.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var a=this._getReflectionTexture();if(a&&o.d.ReflectionTextureEnabled){if(!a.isReadyOrNotBlocking())return!1;if(a.irradianceTexture&&!a.irradianceTexture.isReadyOrNotBlocking())return!1}if(this._lightmapTexture&&o.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&o.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(o.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(K.getCaps().standardDerivatives&&this._bumpTexture&&o.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&o.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=P,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(P._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;K.getCaps().standardDerivatives||w.isVerticesDataPresent(r.f.NormalKind)||(w.createNormals(!0),Q.e.Warn("PBRMaterial: Normals have been created for the mesh: "+w.name));var U=v.effect,p=P._areLightsDisposed,Y=this._prepareEffect(w,P,this.onCompiled,this.onError,I,null,v.getRenderingMesh().hasThinInstances);if(Y)if(this._onEffectCreatedObservable&&(nw.effect=Y,nw.subMesh=v,this._onEffectCreatedObservable.notifyObservers(nw)),this.allowShaderHotSwapping&&U&&!Y.isReady()){if(Y=U,P.markAsUnprocessed(),p)return P._areLightsDisposed=!0,!1}else u.resetCachedMaterial(),v.setEffect(Y,P,this._materialContext);return!(!v.effect||!v.effect.isReady())&&(P._renderId=u.getRenderId(),v.effect._wasPreviouslyReady=!0,v.effect._wasPreviouslyUsingInstances=!!I,!0)},v.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},v.prototype._prepareEffect=function(w,v,I,P,u,Q,K){if(void 0===I&&(I=null),void 0===P&&(P=null),void 0===u&&(u=null),void 0===Q&&(Q=null),this._prepareDefines(w,v,u,Q,K),!v.isDirty)return null;v.markAsProcessed();var a=this.getScene().getEngine(),U=new lw.b,p=0;v.USESPHERICALINVERTEX&&U.addFallback(p++,"USESPHERICALINVERTEX"),v.FOG&&U.addFallback(p,"FOG"),v.SPECULARAA&&U.addFallback(p,"SPECULARAA"),v.POINTSIZE&&U.addFallback(p,"POINTSIZE"),v.LOGARITHMICDEPTH&&U.addFallback(p,"LOGARITHMICDEPTH"),v.PARALLAX&&U.addFallback(p,"PARALLAX"),v.PARALLAXOCCLUSION&&U.addFallback(p++,"PARALLAXOCCLUSION"),v.ENVIRONMENTBRDF&&U.addFallback(p++,"ENVIRONMENTBRDF"),v.TANGENT&&U.addFallback(p++,"TANGENT"),v.BUMP&&U.addFallback(p++,"BUMP"),p=z.e.HandleFallbacksForShadows(v,U,this._maxSimultaneousLights,p++),v.SPECULARTERM&&U.addFallback(p++,"SPECULARTERM"),v.USESPHERICALFROMREFLECTIONMAP&&U.addFallback(p++,"USESPHERICALFROMREFLECTIONMAP"),v.USEIRRADIANCEMAP&&U.addFallback(p++,"USEIRRADIANCEMAP"),v.LIGHTMAP&&U.addFallback(p++,"LIGHTMAP"),v.NORMAL&&U.addFallback(p++,"NORMAL"),v.AMBIENT&&U.addFallback(p++,"AMBIENT"),v.EMISSIVE&&U.addFallback(p++,"EMISSIVE"),v.VERTEXCOLOR&&U.addFallback(p++,"VERTEXCOLOR"),v.MORPHTARGETS&&U.addFallback(p++,"MORPHTARGETS"),v.MULTIVIEW&&U.addFallback(0,"MULTIVIEW");var Y=[r.f.PositionKind];v.NORMAL&&Y.push(r.f.NormalKind),v.TANGENT&&Y.push(r.f.TangentKind);for(var g=1;g<=6;++g)v["UV"+g]&&Y.push("uv".concat(1===g?"":g));v.VERTEXCOLOR&&Y.push(r.f.ColorKind),v.INSTANCESCOLOR&&Y.push(r.f.ColorInstanceKind),z.e.PrepareAttributesForBones(Y,w,v,U),z.e.PrepareAttributesForInstances(Y,v),z.e.PrepareAttributesForMorphTargets(Y,w,v),z.e.PrepareAttributesForBakedVertexAnimation(Y,w,v);var J="pbr",l=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],x=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],j=["Material","Scene","Mesh"];this._eventInfo.fallbacks=U,this._eventInfo.fallbackRank=p,this._eventInfo.defines=v,this._eventInfo.uniforms=l,this._eventInfo.attributes=Y,this._eventInfo.samplers=x,this._eventInfo.uniformBuffersNames=j,this._eventInfo.customCode=void 0,this._eventInfo.mesh=w,this._callbackPluginEventGeneric(t.d.PrepareEffect,this._eventInfo),R.c.AddUniforms(l),R.c.AddSamplers(x),s.e&&(s.e.PrepareUniforms(l,v),s.e.PrepareSamplers(x,v)),z.e.PrepareUniformsAndSamplersList({uniformsNames:l,uniformBuffersNames:j,samplers:x,defines:v,maxSimultaneousLights:this._maxSimultaneousLights});var B={};this.customShaderNameResolve&&(J=this.customShaderNameResolve(J,l,j,x,v,Y,B));var i=v.toString();return a.createEffect(J,{attributes:Y,uniformsNames:l,uniformBuffersNames:j,samplers:x,defines:i,fallbacks:U,onCompiled:I,onError:P,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:v.NUM_MORPH_INFLUENCERS},processFinalCode:B.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:v.PREPASS},a)},v.prototype._prepareDefines=function(w,I,P,u,Q){var K;void 0===P&&(P=null),void 0===u&&(u=null),void 0===Q&&(Q=!1);var a=this.getScene(),U=a.getEngine();z.e.PrepareDefinesForLights(a,w,I,!0,this._maxSimultaneousLights,this._disableLighting),I._needNormals=!0,z.e.PrepareDefinesForMultiview(a,I);var p=this.needAlphaBlendingForMesh(w)&&this.getScene().useOrderIndependentTransparency;if(z.e.PrepareDefinesForPrePass(a,I,this.canRenderToMRT&&!p),z.e.PrepareDefinesForOIT(a,I,p),I.METALLICWORKFLOW=this.isMetallicWorkflow(),I._areTexturesDirty){if(I._needUVs=!1,a.texturesEnabled){a.getEngine().getCaps().textureLOD&&(I.LODBASEDMICROSFURACE=!0),this._albedoTexture&&o.d.DiffuseTextureEnabled?(z.e.PrepareDefinesForMergedUV(this._albedoTexture,I,"ALBEDO"),I.GAMMAALBEDO=this._albedoTexture.gammaSpace):I.ALBEDO=!1,this._ambientTexture&&o.d.AmbientTextureEnabled?(z.e.PrepareDefinesForMergedUV(this._ambientTexture,I,"AMBIENT"),I.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):I.AMBIENT=!1,this._opacityTexture&&o.d.OpacityTextureEnabled?(z.e.PrepareDefinesForMergedUV(this._opacityTexture,I,"OPACITY"),I.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):I.OPACITY=!1;var Y=this._getReflectionTexture();if(Y&&o.d.ReflectionTextureEnabled){switch(I.REFLECTION=!0,I.GAMMAREFLECTION=Y.gammaSpace,I.RGBDREFLECTION=Y.isRGBD,I.LODINREFLECTIONALPHA=Y.lodLevelInAlpha,I.LINEARSPECULARREFLECTION=Y.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(I.NUM_SAMPLES=""+this.realTimeFilteringQuality,U._features.needTypeSuffixInShaderConstants&&(I.NUM_SAMPLES=I.NUM_SAMPLES+"u"),I.REALTIME_FILTERING=!0):I.REALTIME_FILTERING=!1,Y.coordinatesMode===E.e.INVCUBIC_MODE&&(I.INVERTCUBICMAP=!0),I.REFLECTIONMAP_3D=Y.isCube,I.REFLECTIONMAP_OPPOSITEZ=I.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!Y.invertZ:Y.invertZ,I.REFLECTIONMAP_CUBIC=!1,I.REFLECTIONMAP_EXPLICIT=!1,I.REFLECTIONMAP_PLANAR=!1,I.REFLECTIONMAP_PROJECTION=!1,I.REFLECTIONMAP_SKYBOX=!1,I.REFLECTIONMAP_SPHERICAL=!1,I.REFLECTIONMAP_EQUIRECTANGULAR=!1,I.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,I.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,Y.coordinatesMode){case E.e.EXPLICIT_MODE:I.REFLECTIONMAP_EXPLICIT=!0;break;case E.e.PLANAR_MODE:I.REFLECTIONMAP_PLANAR=!0;break;case E.e.PROJECTION_MODE:I.REFLECTIONMAP_PROJECTION=!0;break;case E.e.SKYBOX_MODE:I.REFLECTIONMAP_SKYBOX=!0;break;case E.e.SPHERICAL_MODE:I.REFLECTIONMAP_SPHERICAL=!0;break;case E.e.EQUIRECTANGULAR_MODE:I.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case E.e.FIXED_EQUIRECTANGULAR_MODE:I.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case E.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:I.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case E.e.CUBIC_MODE:case E.e.INVCUBIC_MODE:default:I.REFLECTIONMAP_CUBIC=!0,I.USE_LOCAL_REFLECTIONMAP_CUBIC=!!Y.boundingBoxSize}Y.coordinatesMode!==E.e.SKYBOX_MODE&&(Y.irradianceTexture?(I.USEIRRADIANCEMAP=!0,I.USESPHERICALFROMREFLECTIONMAP=!1):Y.isCube&&(I.USESPHERICALFROMREFLECTIONMAP=!0,I.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||a.getEngine().getCaps().maxVaryingVectors<=8?I.USESPHERICALINVERTEX=!1:I.USESPHERICALINVERTEX=!0))}else I.REFLECTION=!1,I.REFLECTIONMAP_3D=!1,I.REFLECTIONMAP_SPHERICAL=!1,I.REFLECTIONMAP_PLANAR=!1,I.REFLECTIONMAP_CUBIC=!1,I.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,I.REFLECTIONMAP_PROJECTION=!1,I.REFLECTIONMAP_SKYBOX=!1,I.REFLECTIONMAP_EXPLICIT=!1,I.REFLECTIONMAP_EQUIRECTANGULAR=!1,I.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,I.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,I.INVERTCUBICMAP=!1,I.USESPHERICALFROMREFLECTIONMAP=!1,I.USEIRRADIANCEMAP=!1,I.USESPHERICALINVERTEX=!1,I.REFLECTIONMAP_OPPOSITEZ=!1,I.LODINREFLECTIONALPHA=!1,I.GAMMAREFLECTION=!1,I.RGBDREFLECTION=!1,I.LINEARSPECULARREFLECTION=!1;if(this._lightmapTexture&&o.d.LightmapTextureEnabled?(z.e.PrepareDefinesForMergedUV(this._lightmapTexture,I,"LIGHTMAP"),I.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,I.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,I.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):I.LIGHTMAP=!1,this._emissiveTexture&&o.d.EmissiveTextureEnabled?(z.e.PrepareDefinesForMergedUV(this._emissiveTexture,I,"EMISSIVE"),I.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):I.EMISSIVE=!1,o.d.SpecularTextureEnabled){if(this._metallicTexture?(z.e.PrepareDefinesForMergedUV(this._metallicTexture,I,"REFLECTIVITY"),I.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,I.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,I.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,I.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,I.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(z.e.PrepareDefinesForMergedUV(this._reflectivityTexture,I,"REFLECTIVITY"),I.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,I.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,I.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):I.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture){var g=null!==this._metallicReflectanceTexture&&this._metallicReflectanceTexture._texture===(null===(K=this._reflectanceTexture)||void 0===K?void 0:K._texture)&&this._metallicReflectanceTexture.checkTransformsAreIdentical(this._reflectanceTexture);I.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture&&!g,this._metallicReflectanceTexture?(z.e.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,I,"METALLIC_REFLECTANCE"),I.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):I.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&!g&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(z.e.PrepareDefinesForMergedUV(this._reflectanceTexture,I,"REFLECTANCE"),I.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):I.REFLECTANCE=!1}else I.METALLIC_REFLECTANCE=!1,I.REFLECTANCE=!1;this._microSurfaceTexture?z.e.PrepareDefinesForMergedUV(this._microSurfaceTexture,I,"MICROSURFACEMAP"):I.MICROSURFACEMAP=!1}else I.REFLECTIVITY=!1,I.MICROSURFACEMAP=!1;a.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&o.d.BumpTextureEnabled&&!this._disableBumpMap?(z.e.PrepareDefinesForMergedUV(this._bumpTexture,I,"BUMP"),this._useParallax&&this._albedoTexture&&o.d.DiffuseTextureEnabled?(I.PARALLAX=!0,I.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):I.PARALLAX=!1,I.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(I.BUMP=!1,I.PARALLAX=!1,I.PARALLAXOCCLUSION=!1,I.PARALLAOBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&o.d.ReflectionTextureEnabled?(I.ENVIRONMENTBRDF=!0,I.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(I.ENVIRONMENTBRDF=!1,I.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?I.ALPHAFROMALBEDO=!0:I.ALPHAFROMALBEDO=!1}I.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===v.LIGHTFALLOFF_STANDARD?(I.USEPHYSICALLIGHTFALLOFF=!1,I.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===v.LIGHTFALLOFF_GLTF?(I.USEPHYSICALLIGHTFALLOFF=!1,I.USEGLTFLIGHTFALLOFF=!0):(I.USEPHYSICALLIGHTFALLOFF=!0,I.USEGLTFLIGHTFALLOFF=!1),I.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?I.TWOSIDEDLIGHTING=!0:I.TWOSIDEDLIGHTING=!1,I.SPECULARAA=a.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(I._areTexturesDirty||I._areMiscDirty)&&(I.ALPHATESTVALUE="".concat(this._alphaCutOff).concat(this._alphaCutOff%1===0?".":""),I.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,I.ALPHABLEND=this.needAlphaBlendingForMesh(w),I.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,I.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),I._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(I),I.FORCENORMALFORWARD=this._forceNormalForward,I.RADIANCEOCCLUSION=this._useRadianceOcclusion,I.HORIZONOCCLUSION=this._useHorizonOcclusion,I._areMiscDirty&&(z.e.PrepareDefinesForMisc(w,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(w)||this._forceAlphaTest,I),I.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!w.isVerticesDataPresent(r.f.NormalKind),I.DEBUGMODE=this._debugMode),z.e.PrepareDefinesForFrameBoundValues(a,U,I,!!P,u,Q),this._eventInfo.defines=I,this._eventInfo.mesh=w,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),z.e.PrepareDefinesForAttributes(w,I,!0,!0,!0,this._transparencyMode!==v.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)},v.prototype.forceCompilation=function(w,v,I){var u=this,Q=(0,P.d)({clipPlane:!1,useInstances:!1},I);this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(t.d.GetDefineNames,this._eventInfo);var K=new Ww(this._eventInfo.defineNames),a=this._prepareEffect(w,K,void 0,void 0,Q.useInstances,Q.clipPlane,w.hasThinInstances);this._onEffectCreatedObservable&&(nw.effect=a,nw.subMesh=null,this._onEffectCreatedObservable.notifyObservers(nw)),a.isReady()?v&&v(this):a.onCompileObservable.add((function(){v&&v(u)}))},v.prototype.buildUniformLayout=function(){var v=this._uniformBuffer;v.addUniform("vAlbedoInfos",2),v.addUniform("vAmbientInfos",4),v.addUniform("vOpacityInfos",2),v.addUniform("vEmissiveInfos",2),v.addUniform("vLightmapInfos",2),v.addUniform("vReflectivityInfos",3),v.addUniform("vMicroSurfaceSamplerInfos",2),v.addUniform("vReflectionInfos",2),v.addUniform("vReflectionFilteringInfo",2),v.addUniform("vReflectionPosition",3),v.addUniform("vReflectionSize",3),v.addUniform("vBumpInfos",3),v.addUniform("albedoMatrix",16),v.addUniform("ambientMatrix",16),v.addUniform("opacityMatrix",16),v.addUniform("emissiveMatrix",16),v.addUniform("lightmapMatrix",16),v.addUniform("reflectivityMatrix",16),v.addUniform("microSurfaceSamplerMatrix",16),v.addUniform("bumpMatrix",16),v.addUniform("vTangentSpaceParams",2),v.addUniform("reflectionMatrix",16),v.addUniform("vReflectionColor",3),v.addUniform("vAlbedoColor",4),v.addUniform("vLightingIntensity",4),v.addUniform("vReflectionMicrosurfaceInfos",3),v.addUniform("pointSize",1),v.addUniform("vReflectivityColor",4),v.addUniform("vEmissiveColor",3),v.addUniform("vAmbientColor",3),v.addUniform("vDebugMode",2),v.addUniform("vMetallicReflectanceFactors",4),v.addUniform("vMetallicReflectanceInfos",2),v.addUniform("metallicReflectanceMatrix",16),v.addUniform("vReflectanceInfos",2),v.addUniform("reflectanceMatrix",16),v.addUniform("vSphericalL00",3),v.addUniform("vSphericalL1_1",3),v.addUniform("vSphericalL10",3),v.addUniform("vSphericalL11",3),v.addUniform("vSphericalL2_2",3),v.addUniform("vSphericalL2_1",3),v.addUniform("vSphericalL20",3),v.addUniform("vSphericalL21",3),v.addUniform("vSphericalL22",3),v.addUniform("vSphericalX",3),v.addUniform("vSphericalY",3),v.addUniform("vSphericalZ",3),v.addUniform("vSphericalXX_ZZ",3),v.addUniform("vSphericalYY_ZZ",3),v.addUniform("vSphericalZZ",3),v.addUniform("vSphericalXY",3),v.addUniform("vSphericalYZ",3),v.addUniform("vSphericalZX",3),w.prototype.buildUniformLayout.call(this)},v.prototype.bindForSubMesh=function(w,v,I){var P,u,Q,K,a=this.getScene(),p=I.materialDefines;if(p){var r=I.effect;if(r){this._activeEffect=r,v.getMeshUniformBuffer().bindToEffect(r,"Mesh"),v.transferToEffect(w);var Y=a.getEngine();this._uniformBuffer.bindToEffect(r,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,v,w,this.isFrozen),this._eventInfo.subMesh=I,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),p.OBJECTSPACE_NORMALMAP&&(w.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var g=this._mustRebind(a,r,v.visibility);z.e.BindBonesParameters(v,this._activeEffect,this.prePassConfiguration);var J=null,l=this._uniformBuffer;if(g){if(this.bindViewProjection(r),J=this._getReflectionTexture(),!l.useUbo||!this.isFrozen||!l.isSync){if(a.texturesEnabled){if(this._albedoTexture&&o.d.DiffuseTextureEnabled&&(l.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),z.e.BindTextureMatrix(this._albedoTexture,l,"albedo")),this._ambientTexture&&o.d.AmbientTextureEnabled&&(l.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),z.e.BindTextureMatrix(this._ambientTexture,l,"ambient")),this._opacityTexture&&o.d.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),z.e.BindTextureMatrix(this._opacityTexture,l,"opacity")),J&&o.d.ReflectionTextureEnabled){if(l.updateMatrix("reflectionMatrix",J.getReflectionTextureMatrix()),l.updateFloat2("vReflectionInfos",J.level,0),J.boundingBoxSize){var R=J;l.updateVector3("vReflectionPosition",R.boundingBoxPosition),l.updateVector3("vReflectionSize",R.boundingBoxSize)}if(this.realTimeFiltering){var s=J.getSize().width;l.updateFloat2("vReflectionFilteringInfo",s,j.b.Log2(s))}if(!p.USEIRRADIANCEMAP){var B=J.sphericalPolynomial;if(p.USESPHERICALFROMREFLECTIONMAP&&B)if(p.SPHERICAL_HARMONICS){var t=B.preScaledHarmonics;l.updateVector3("vSphericalL00",t.l00),l.updateVector3("vSphericalL1_1",t.l1_1),l.updateVector3("vSphericalL10",t.l10),l.updateVector3("vSphericalL11",t.l11),l.updateVector3("vSphericalL2_2",t.l2_2),l.updateVector3("vSphericalL2_1",t.l2_1),l.updateVector3("vSphericalL20",t.l20),l.updateVector3("vSphericalL21",t.l21),l.updateVector3("vSphericalL22",t.l22)}else l.updateFloat3("vSphericalX",B.x.x,B.x.y,B.x.z),l.updateFloat3("vSphericalY",B.y.x,B.y.y,B.y.z),l.updateFloat3("vSphericalZ",B.z.x,B.z.y,B.z.z),l.updateFloat3("vSphericalXX_ZZ",B.xx.x-B.zz.x,B.xx.y-B.zz.y,B.xx.z-B.zz.z),l.updateFloat3("vSphericalYY_ZZ",B.yy.x-B.zz.x,B.yy.y-B.zz.y,B.yy.z-B.zz.z),l.updateFloat3("vSphericalZZ",B.zz.x,B.zz.y,B.zz.z),l.updateFloat3("vSphericalXY",B.xy.x,B.xy.y,B.xy.z),l.updateFloat3("vSphericalYZ",B.yz.x,B.yz.y,B.yz.z),l.updateFloat3("vSphericalZX",B.zx.x,B.zx.y,B.zx.z)}l.updateFloat3("vReflectionMicrosurfaceInfos",J.getSize().width,J.lodGenerationScale,J.lodGenerationOffset)}this._emissiveTexture&&o.d.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),z.e.BindTextureMatrix(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&o.d.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),z.e.BindTextureMatrix(this._lightmapTexture,l,"lightmap")),o.d.SpecularTextureEnabled&&(this._metallicTexture?(l.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),z.e.BindTextureMatrix(this._metallicTexture,l,"reflectivity")):this._reflectivityTexture&&(l.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),z.e.BindTextureMatrix(this._reflectivityTexture,l,"reflectivity")),this._metallicReflectanceTexture&&(l.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),z.e.BindTextureMatrix(this._metallicReflectanceTexture,l,"metallicReflectance")),this._reflectanceTexture&&p.REFLECTANCE&&(l.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),z.e.BindTextureMatrix(this._reflectanceTexture,l,"reflectance")),this._microSurfaceTexture&&(l.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),z.e.BindTextureMatrix(this._microSurfaceTexture,l,"microSurfaceSampler"))),this._bumpTexture&&Y.getCaps().standardDerivatives&&o.d.BumpTextureEnabled&&!this._disableBumpMap&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),z.e.BindTextureMatrix(this._bumpTexture,l,"bump"),a._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),p.METALLICWORKFLOW){x.g.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,x.g.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,l.updateColor4("vReflectivityColor",x.g.Color3[0],1);var i=null!==(u=null===(P=this.subSurface)||void 0===P?void 0:P._indexOfRefraction)&&void 0!==u?u:1.5,E=Math.pow((i-1)/(i+1),2);this._metallicReflectanceColor.scaleToRef(E*this._metallicF0Factor,x.g.Color3[0]);var h=this._metallicF0Factor;l.updateColor4("vMetallicReflectanceFactors",x.g.Color3[0],h)}else l.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);l.updateColor3("vEmissiveColor",o.d.EmissiveTextureEnabled?this._emissiveColor:x.b.BlackReadOnly),l.updateColor3("vReflectionColor",this._reflectionColor),!p.SS_REFRACTION&&(null===(Q=this.subSurface)||void 0===Q?void 0:Q._linkRefractionWithTransparency)?l.updateColor4("vAlbedoColor",this._albedoColor,1):l.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*a.environmentIntensity,this._lightingInfos.w=this._specularIntensity,l.updateVector4("vLightingIntensity",this._lightingInfos),a.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),l.updateColor3("vAmbientColor",this._globalAmbientColor),l.updateFloat2("vDebugMode",this._debugLimit,this._debugFactor)}a.texturesEnabled&&(this._albedoTexture&&o.d.DiffuseTextureEnabled&&l.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&o.d.AmbientTextureEnabled&&l.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&o.d.OpacityTextureEnabled&&l.setTexture("opacitySampler",this._opacityTexture),J&&o.d.ReflectionTextureEnabled&&(p.LODBASEDMICROSFURACE?l.setTexture("reflectionSampler",J):(l.setTexture("reflectionSampler",J._lodTextureMid||J),l.setTexture("reflectionSamplerLow",J._lodTextureLow||J),l.setTexture("reflectionSamplerHigh",J._lodTextureHigh||J)),p.USEIRRADIANCEMAP&&l.setTexture("irradianceSampler",J.irradianceTexture)),p.ENVIRONMENTBRDF&&l.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&o.d.EmissiveTextureEnabled&&l.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&o.d.LightmapTextureEnabled&&l.setTexture("lightmapSampler",this._lightmapTexture),o.d.SpecularTextureEnabled&&(this._metallicTexture?l.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&l.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&l.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&p.REFLECTANCE&&l.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&l.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&Y.getCaps().standardDerivatives&&o.d.BumpTextureEnabled&&!this._disableBumpMap&&l.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(v)&&this.getScene().depthPeelingRenderer.bind(r),this._eventInfo.subMesh=I,this._callbackPluginEventBindForSubMesh(this._eventInfo),z.e.BindClipPlane(this._activeEffect,a),this.bindEyePosition(r)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!g&&this.isFrozen||(a.lightsEnabled&&!this._disableLighting&&z.e.BindLights(a,v,this._activeEffect,p,this._maxSimultaneousLights),(a.fogEnabled&&v.applyFog&&a.fogMode!==U.d.FOGMODE_NONE||J||v.receiveShadows||p.PREPASS)&&this.bindView(r),z.e.BindFogParameters(a,v,this._activeEffect,!0),p.NUM_MORPH_INFLUENCERS&&z.e.BindMorphTargetParameters(v,this._activeEffect),p.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(K=v.bakedVertexAnimationManager)||void 0===K||K.bind(r,p.INSTANCES)),this._imageProcessingConfiguration.bind(this._activeEffect),z.e.BindLogDepth(p,this._activeEffect,a)),this._afterBind(v,this._activeEffect),l.update()}}},v.prototype.getAnimatables=function(){var v=w.prototype.getAnimatables.call(this);return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&v.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&v.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&v.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&v.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&v.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?v.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&v.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&v.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&v.push(this._lightmapTexture),v},v.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},v.prototype.getActiveTextures=function(){var v=w.prototype.getActiveTextures.call(this);return this._albedoTexture&&v.push(this._albedoTexture),this._ambientTexture&&v.push(this._ambientTexture),this._opacityTexture&&v.push(this._opacityTexture),this._reflectionTexture&&v.push(this._reflectionTexture),this._emissiveTexture&&v.push(this._emissiveTexture),this._reflectivityTexture&&v.push(this._reflectivityTexture),this._metallicTexture&&v.push(this._metallicTexture),this._metallicReflectanceTexture&&v.push(this._metallicReflectanceTexture),this._reflectanceTexture&&v.push(this._reflectanceTexture),this._microSurfaceTexture&&v.push(this._microSurfaceTexture),this._bumpTexture&&v.push(this._bumpTexture),this._lightmapTexture&&v.push(this._lightmapTexture),v},v.prototype.hasTexture=function(v){return!!w.prototype.hasTexture.call(this,v)||(this._albedoTexture===v||(this._ambientTexture===v||(this._opacityTexture===v||(this._reflectionTexture===v||(this._reflectivityTexture===v||(this._metallicTexture===v||(this._metallicReflectanceTexture===v||(this._reflectanceTexture===v||(this._microSurfaceTexture===v||(this._bumpTexture===v||this._lightmapTexture===v))))))))))},v.prototype.setPrePassRenderer=function(){var w;if(null===(w=this.subSurface)||void 0===w?void 0:w.isScatteringEnabled){var v=this.getScene().enableSubSurfaceForPrePass();return v&&(v.enabled=!0),!0}return!1},v.prototype.dispose=function(v,I){var P,u,Q,K,a,U,p,r,Y,g,J,l;I&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(P=this._albedoTexture)||void 0===P||P.dispose(),null===(u=this._ambientTexture)||void 0===u||u.dispose(),null===(Q=this._opacityTexture)||void 0===Q||Q.dispose(),null===(K=this._reflectionTexture)||void 0===K||K.dispose(),null===(a=this._emissiveTexture)||void 0===a||a.dispose(),null===(U=this._metallicTexture)||void 0===U||U.dispose(),null===(p=this._reflectivityTexture)||void 0===p||p.dispose(),null===(r=this._bumpTexture)||void 0===r||r.dispose(),null===(Y=this._lightmapTexture)||void 0===Y||Y.dispose(),null===(g=this._metallicReflectanceTexture)||void 0===g||g.dispose(),null===(J=this._reflectanceTexture)||void 0===J||J.dispose(),null===(l=this._microSurfaceTexture)||void 0===l||l.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),w.prototype.dispose.call(this,v,I)},v.PBRMATERIAL_OPAQUE=B.b.MATERIAL_OPAQUE,v.PBRMATERIAL_ALPHATEST=B.b.MATERIAL_ALPHATEST,v.PBRMATERIAL_ALPHABLEND=B.b.MATERIAL_ALPHABLEND,v.PBRMATERIAL_ALPHATESTANDBLEND=B.b.MATERIAL_ALPHATESTANDBLEND,v.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,v.LIGHTFALLOFF_PHYSICAL=0,v.LIGHTFALLOFF_GLTF=1,v.LIGHTFALLOFF_STANDARD=2,(0,P.i)([(0,u.u)()],v.prototype,"_imageProcessingConfiguration",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsMiscDirty")],v.prototype,"debugMode",void 0),(0,P.i)([(0,u.J)()],v.prototype,"useLogarithmicDepth",null),v}(i.d)},92366:function(w,v,I){"use strict";I.d(v,{d:function(){return p}});var P=I(78502),u=I(9892),Q=I(5344),K=I(9488),a=I(82325),U=I(31709),p=function(w){function v(I,P){var u=w.call(this,I,P)||this;return u.directIntensity=1,u.emissiveIntensity=1,u.environmentIntensity=1,u.specularIntensity=1,u.disableBumpMap=!1,u.ambientTextureStrength=1,u.ambientTextureImpactOnAnalyticalLights=v.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,u.metallicF0Factor=1,u.metallicReflectanceColor=K.b.White(),u.useOnlyMetallicFromMetallicReflectanceTexture=!1,u.ambientColor=new K.b(0,0,0),u.albedoColor=new K.b(1,1,1),u.reflectivityColor=new K.b(1,1,1),u.reflectionColor=new K.b(1,1,1),u.emissiveColor=new K.b(0,0,0),u.microSurface=1,u.useLightmapAsShadowmap=!1,u.useAlphaFromAlbedoTexture=!1,u.forceAlphaTest=!1,u.alphaCutOff=.4,u.useSpecularOverAlpha=!0,u.useMicroSurfaceFromReflectivityMapAlpha=!1,u.useRoughnessFromMetallicTextureAlpha=!0,u.useRoughnessFromMetallicTextureGreen=!1,u.useMetallnessFromMetallicTextureBlue=!1,u.useAmbientOcclusionFromMetallicTextureRed=!1,u.useAmbientInGrayScale=!1,u.useAutoMicroSurfaceFromReflectivityMap=!1,u.useRadianceOverAlpha=!0,u.useObjectSpaceNormalMap=!1,u.useParallax=!1,u.useParallaxOcclusion=!1,u.parallaxScaleBias=.05,u.disableLighting=!1,u.forceIrradianceInFragment=!1,u.maxSimultaneousLights=4,u.invertNormalMapX=!1,u.invertNormalMapY=!1,u.twoSidedLighting=!1,u.useAlphaFresnel=!1,u.useLinearAlphaFresnel=!1,u.environmentBRDFTexture=null,u.forceNormalForward=!1,u.enableSpecularAntiAliasing=!1,u.useHorizonOcclusion=!0,u.useRadianceOcclusion=!0,u.unlit=!1,u._environmentBRDFTexture=(0,Q.b)(u.getScene()),u}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(w){this.subSurface.refractionTexture=w,w?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"indexOfRefraction",{get:function(){return this.subSurface.indexOfRefraction},set:function(w){this.subSurface.indexOfRefraction=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(w){this.subSurface.invertRefractionY=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(w){this.subSurface.linkRefractionWithTransparency=w,w&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===a.c.LIGHTFALLOFF_PHYSICAL},set:function(w){w!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=w?a.c.LIGHTFALLOFF_PHYSICAL:a.c.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===a.c.LIGHTFALLOFF_GLTF},set:function(w){w!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=w?a.c.LIGHTFALLOFF_GLTF:a.c.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(w){this._attachImageProcessingConfiguration(w),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(w){this.imageProcessingConfiguration.colorCurvesEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(w){this.imageProcessingConfiguration.colorGradingEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(w){this._imageProcessingConfiguration.toneMappingEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(w){this._imageProcessingConfiguration.exposure=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(w){this._imageProcessingConfiguration.contrast=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(w){this._imageProcessingConfiguration.colorGradingTexture=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(w){this._imageProcessingConfiguration.colorCurves=w},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"PBRMaterial"},v.prototype.clone=function(w){var I=this,P=u.e.Clone((function(){return new v(w,I.getScene())}),this);return P.id=w,P.name=w,this.stencil.copyTo(P.stencil),this.clearCoat.copyTo(P.clearCoat),this.anisotropy.copyTo(P.anisotropy),this.brdf.copyTo(P.brdf),this.sheen.copyTo(P.sheen),this.subSurface.copyTo(P.subSurface),P},v.prototype.serialize=function(){var v=w.prototype.serialize.call(this);return v.customType="BABYLON.PBRMaterial",v.clearCoat=this.clearCoat.serialize(),v.anisotropy=this.anisotropy.serialize(),v.brdf=this.brdf.serialize(),v.sheen=this.sheen.serialize(),v.subSurface=this.subSurface.serialize(),v.iridescence=this.iridescence.serialize(),v},v.Parse=function(w,I,P){var Q=u.e.Parse((function(){return new v(w.name,I)}),w,I,P);return w.stencil&&Q.stencil.parse(w.stencil,I,P),w.clearCoat&&Q.clearCoat.parse(w.clearCoat,I,P),w.anisotropy&&Q.anisotropy.parse(w.anisotropy,I,P),w.brdf&&Q.brdf.parse(w.brdf,I,P),w.sheen&&Q.sheen.parse(w.sheen,I,P),w.subSurface&&Q.subSurface.parse(w.subSurface,I,P),w.iridescence&&Q.iridescence.parse(w.iridescence,I,P),Q},v.PBRMATERIAL_OPAQUE=a.c.PBRMATERIAL_OPAQUE,v.PBRMATERIAL_ALPHATEST=a.c.PBRMATERIAL_ALPHATEST,v.PBRMATERIAL_ALPHABLEND=a.c.PBRMATERIAL_ALPHABLEND,v.PBRMATERIAL_ALPHATESTANDBLEND=a.c.PBRMATERIAL_ALPHATESTANDBLEND,v.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=a.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"directIntensity",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveIntensity",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"environmentIntensity",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"specularIntensity",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"disableBumpMap",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTexture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTextureStrength",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"opacityTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectionTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectivityTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicTexture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallic",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicF0Factor",void 0),(0,P.i)([(0,u.n)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicReflectanceColor",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicReflectanceTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectanceTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"microSurfaceTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"bumpTexture",void 0),(0,P.i)([(0,u.B)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty",null)],v.prototype,"lightmapTexture",void 0),(0,P.i)([(0,u.n)("ambient"),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientColor",void 0),(0,P.i)([(0,u.n)("albedo"),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoColor",void 0),(0,P.i)([(0,u.n)("reflectivity"),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectivityColor",void 0),(0,P.i)([(0,u.n)("reflection"),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectionColor",void 0),(0,P.i)([(0,u.n)("emissive"),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveColor",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"microSurface",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useLightmapAsShadowmap",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"useAlphaFromAlbedoTexture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"forceAlphaTest",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"alphaCutOff",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useSpecularOverAlpha",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAmbientInGrayScale",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,P.i)([(0,u.J)()],v.prototype,"usePhysicalLightFalloff",null),(0,P.i)([(0,u.J)()],v.prototype,"useGLTFLightFalloff",null),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRadianceOverAlpha",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useObjectSpaceNormalMap",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallax",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallaxOcclusion",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"parallaxScaleBias",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsLightsDirty")],v.prototype,"disableLighting",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"forceIrradianceInFragment",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsLightsDirty")],v.prototype,"maxSimultaneousLights",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapX",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapY",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"twoSidedLighting",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAlphaFresnel",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useLinearAlphaFresnel",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"environmentBRDFTexture",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"forceNormalForward",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"enableSpecularAntiAliasing",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useHorizonOcclusion",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRadianceOcclusion",void 0),(0,P.i)([(0,u.J)(),(0,u.h)("_markAllSubMeshesAsMiscDirty")],v.prototype,"unlit",void 0),v}(a.c);(0,U.g)("BABYLON.PBRMaterial",p)},76384:function(w,v,I){"use strict";I.d(v,{c:function(){return r}});var P=I(78502),u=I(9892),Q=I(9271),K=I(80105),a=I(78588),U=I(28372),p=(I(82790),I(2111)),r=function(w){function v(I){var P=w.call(this,null)||this;return P.metadata=null,P.reservedDataStore=null,P._hasAlpha=!1,P._getAlphaFromRGB=!1,P.level=1,P._coordinatesIndex=0,P._coordinatesMode=0,P.wrapR=1,P.anisotropicFilteringLevel=v.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,P._isCube=!1,P._gammaSpace=!0,P.invertZ=!1,P.lodLevelInAlpha=!1,P.isRenderTarget=!1,P._prefiltered=!1,P._forceSerialize=!1,P.animations=new Array,P.onDisposeObservable=new Q.c,P._onDisposeObserver=null,P._scene=null,P._uid=null,P._parentContainer=null,P._loadingError=!1,I?v._IsScene(I)?P._scene=I:P._engine=I:P._scene=a.e.LastCreatedScene,P._scene&&(P.uniqueId=P._scene.getUniqueId(),P._scene.addTexture(P),P._engine=P._scene.getEngine()),P._uid=null,P}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(w){var v=this;this._hasAlpha!==w&&(this._hasAlpha=w,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(w){return w.hasTexture(v)})))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"getAlphaFromRGB",{get:function(){return this._getAlphaFromRGB},set:function(w){var v=this;this._getAlphaFromRGB!==w&&(this._getAlphaFromRGB=w,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(w){return w.hasTexture(v)})))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"coordinatesIndex",{get:function(){return this._coordinatesIndex},set:function(w){var v=this;this._coordinatesIndex!==w&&(this._coordinatesIndex=w,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(w){return w.hasTexture(v)})))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(w){var v=this;this._coordinatesMode!==w&&(this._coordinatesMode=w,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(w){return w.hasTexture(v)})))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wrapU",{get:function(){return this._wrapU},set:function(w){this._wrapU=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"wrapV",{get:function(){return this._wrapV},set:function(w){this._wrapV=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(w){this._texture?this._texture.isCube=w:this._isCube=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(w){this._texture&&(this._texture.is3D=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(w){this._texture&&(this._texture.is2DArray=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"gammaSpace",{get:function(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace},set:function(w){if(this._texture){if(this._texture._gammaSpace===w)return;this._texture._gammaSpace=w}else{if(this._gammaSpace===w)return;this._gammaSpace=w}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(w){this._texture&&(this._texture._isRGBD=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(w){this._texture&&(this._texture._lodGenerationOffset=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(w){this._texture&&(this._texture._lodGenerationScale=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(w){this._texture&&(this._texture._linearSpecularLOD=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(w){this._texture&&(this._texture._irradianceTexture=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"uid",{get:function(){return this._uid||(this._uid=(0,U.e)()),this._uid},enumerable:!1,configurable:!0}),v.prototype.toString=function(){return this.name},v.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(v.prototype,"onDispose",{set:function(w){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"loadingError",{get:function(){return this._loadingError},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!1,configurable:!0}),v.prototype.getScene=function(){return this._scene},v.prototype._getEngine=function(){return this._engine},v.prototype.checkTransformsAreIdentical=function(w){return null!==w},v.prototype.getTextureMatrix=function(){return K.e.IdentityReadOnly},v.prototype.getReflectionTextureMatrix=function(){return K.e.IdentityReadOnly},v.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()||this.loadingError},v.prototype.scale=function(w){},Object.defineProperty(v.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),v.prototype._getFromCache=function(w,v,I,P,u,Q){var K=this._getEngine();if(!K)return null;for(var a=K._getUseSRGBBuffer(!!u,v),U=K.getLoadedTexturesCache(),p=0;p<U.length;p++){var r=U[p];if((void 0===u||a===r._useSRGBBuffer)&&(void 0===P||P===r.invertY)&&r.url===w&&r.generateMipMaps===!v&&(!I||I===r.samplingMode)&&(void 0===Q||Q===r.isCube))return r.incrementReferences(),r}return null},v.prototype._rebuild=function(){},v.prototype.clone=function(){return null},Object.defineProperty(v.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5},enumerable:!1,configurable:!0}),v.prototype._markAllSubMeshesAsTexturesDirty=function(){var w=this.getScene();w&&w.markAllMaterialsAsDirty(1)},v.prototype.readPixels=function(w,v,I,P,u,Q,K,a,U){if(void 0===w&&(w=0),void 0===v&&(v=0),void 0===I&&(I=null),void 0===P&&(P=!0),void 0===u&&(u=!1),void 0===Q&&(Q=0),void 0===K&&(K=0),void 0===a&&(a=Number.MAX_VALUE),void 0===U&&(U=Number.MAX_VALUE),!this._texture)return null;var p=this._getEngine();if(!p)return null;var r=this.getSize(),Y=r.width,g=r.height;0!==v&&(Y/=Math.pow(2,v),g/=Math.pow(2,v),Y=Math.round(Y),g=Math.round(g)),a=Math.min(Y,a),U=Math.min(g,U);try{return this._texture.isCube?p._readTexturePixels(this._texture,a,U,w,v,I,P,u,Q,K):p._readTexturePixels(this._texture,a,U,-1,v,I,P,u,Q,K)}catch(w){return null}},v.prototype._readPixelsSync=function(w,v,I,P,u){if(void 0===w&&(w=0),void 0===v&&(v=0),void 0===I&&(I=null),void 0===P&&(P=!0),void 0===u&&(u=!1),!this._texture)return null;var Q=this.getSize(),K=Q.width,a=Q.height,U=this._getEngine();if(!U)return null;0!=v&&(K/=Math.pow(2,v),a/=Math.pow(2,v),K=Math.round(K),a=Math.round(a));try{return this._texture.isCube?U._readTexturePixelsSync(this._texture,K,a,w,v,I,P,u):U._readTexturePixelsSync(this._texture,K,a,-1,v,I,P,u)}catch(w){return null}},Object.defineProperty(v.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),v.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var v=this._scene.textures.indexOf(this);if(v>=0&&this._scene.textures.splice(v,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){var I=this._parentContainer.textures.indexOf(this);I>-1&&this._parentContainer.textures.splice(I,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,w.prototype.dispose.call(this)},v.prototype.serialize=function(){if(!this.name)return null;var w=u.e.Serialize(this);return u.e.AppendSerializedAnimations(this,w),w},v.WhenAllReady=function(w,v){var I=w.length;if(0!==I)for(var P=0;P<w.length;P++){var u=w[P];if(u.isReady())0===--I&&v();else{var Q=u.onLoadObservable;Q?Q.addOnce((function(){0===--I&&v()})):0===--I&&v()}}else v()},v._IsScene=function(w){return"Scene"===w.getClassName()},v.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,P.i)([(0,u.J)()],v.prototype,"uniqueId",void 0),(0,P.i)([(0,u.J)()],v.prototype,"name",void 0),(0,P.i)([(0,u.J)()],v.prototype,"metadata",void 0),(0,P.i)([(0,u.J)("hasAlpha")],v.prototype,"_hasAlpha",void 0),(0,P.i)([(0,u.J)("getAlphaFromRGB")],v.prototype,"_getAlphaFromRGB",void 0),(0,P.i)([(0,u.J)()],v.prototype,"level",void 0),(0,P.i)([(0,u.J)("coordinatesIndex")],v.prototype,"_coordinatesIndex",void 0),(0,P.i)([(0,u.J)("coordinatesMode")],v.prototype,"_coordinatesMode",void 0),(0,P.i)([(0,u.J)()],v.prototype,"wrapU",null),(0,P.i)([(0,u.J)()],v.prototype,"wrapV",null),(0,P.i)([(0,u.J)()],v.prototype,"wrapR",void 0),(0,P.i)([(0,u.J)()],v.prototype,"anisotropicFilteringLevel",void 0),(0,P.i)([(0,u.J)()],v.prototype,"isCube",null),(0,P.i)([(0,u.J)()],v.prototype,"is3D",null),(0,P.i)([(0,u.J)()],v.prototype,"is2DArray",null),(0,P.i)([(0,u.J)()],v.prototype,"gammaSpace",null),(0,P.i)([(0,u.J)()],v.prototype,"invertZ",void 0),(0,P.i)([(0,u.J)()],v.prototype,"lodLevelInAlpha",void 0),(0,P.i)([(0,u.J)()],v.prototype,"lodGenerationOffset",null),(0,P.i)([(0,u.J)()],v.prototype,"lodGenerationScale",null),(0,P.i)([(0,u.J)()],v.prototype,"linearSpecularLOD",null),(0,P.i)([(0,u.B)()],v.prototype,"irradianceTexture",null),(0,P.i)([(0,u.J)()],v.prototype,"isRenderTarget",void 0),v}(function(){function w(w){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=p.c.Zero(),this._cachedBaseSize=p.c.Zero(),this._initialSamplingMode=2,this._texture=w,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(w.prototype,"wrapU",{get:function(){return this._wrapU},set:function(w){this._wrapU=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"wrapV",{get:function(){return this._wrapV},set:function(w){this._wrapV=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(w){this._texture&&(this._texture.isCube=w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(w){this._texture&&(this._texture.is3D=w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(w){this._texture&&(this._texture.is2DArray=w)},enumerable:!1,configurable:!0}),w.prototype.getClassName=function(){return"ThinTexture"},w.prototype.isReady=function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},w.prototype.delayLoad=function(){},w.prototype.getInternalTexture=function(){return this._texture},w.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},w.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},Object.defineProperty(w.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),w.prototype.updateSamplingMode=function(w){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(w,this._texture)},w.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},w.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},w}())},28689:function(w,v,I){"use strict";var P=I(80105),u=I(96658),Q=I(37094),K=I(61686),a=I(9488),U=function(w,v,I,P){this.name=w,this.worldAxisForNormal=v,this.worldAxisForFileX=I,this.worldAxisForFileY=P},p=function(){function w(){}return w.ConvertCubeMapTextureToSphericalPolynomial=function(w){var v,I=this;if(!w.isCube)return null;null===(v=w.getScene())||void 0===v||v.getEngine().flushFramebuffer();var P,u,Q=w.getSize().width,K=w.readPixels(0,void 0,void 0,!1),a=w.readPixels(1,void 0,void 0,!1);w.isRenderTarget?(P=w.readPixels(3,void 0,void 0,!1),u=w.readPixels(2,void 0,void 0,!1)):(P=w.readPixels(2,void 0,void 0,!1),u=w.readPixels(3,void 0,void 0,!1));var U=w.readPixels(4,void 0,void 0,!1),p=w.readPixels(5,void 0,void 0,!1),r=w.gammaSpace,Y=0;return 1!=w.textureType&&2!=w.textureType||(Y=1),new Promise((function(w){Promise.all([a,K,P,u,U,p]).then((function(v){var P=v[0],u=v[1],K=v[2],a=v[3],U=v[4],p=v[5],g={size:Q,right:u,left:P,up:K,down:a,front:U,back:p,format:5,type:Y,gammaSpace:r};w(I.ConvertCubeMapToSphericalPolynomial(g))}))}))},w._AreaElement=function(w,v){return Math.atan2(w*v,Math.sqrt(w*w+v*v+1))},w.ConvertCubeMapToSphericalPolynomial=function(w){for(var v=new Q.e,I=0,P=2/w.size,U=P,p=.5*P,r=p-1,Y=0;Y<6;Y++)for(var g=this._FileFaces[Y],J=w[g.name],l=r,R=5===w.format?4:3,x=0;x<w.size;x++){for(var j=r,s=0;s<w.size;s++){var B=g.worldAxisForFileX.scale(j).add(g.worldAxisForFileY.scale(l)).add(g.worldAxisForNormal);B.normalize();var t=this._AreaElement(j-p,l-p)-this._AreaElement(j-p,l+p)-this._AreaElement(j+p,l-p)+this._AreaElement(j+p,l+p),i=J[x*w.size*R+s*R+0],z=J[x*w.size*R+s*R+1],E=J[x*w.size*R+s*R+2];isNaN(i)&&(i=0),isNaN(z)&&(z=0),isNaN(E)&&(E=0),0===w.type&&(i/=255,z/=255,E/=255),w.gammaSpace&&(i=Math.pow(u.b.Clamp(i),K.l),z=Math.pow(u.b.Clamp(z),K.l),E=Math.pow(u.b.Clamp(E),K.l));var o=4096;i=u.b.Clamp(i,0,o),z=u.b.Clamp(z,0,o),E=u.b.Clamp(E,0,o);var h=new a.b(i,z,E);v.addLight(B,h,t),I+=t,j+=P}l+=U}var n=6*(4*Math.PI)/6/I;return v.scaleInPlace(n),v.convertIncidentRadianceToIrradiance(),v.convertIrradianceToLambertianRadiance(),Q.i.FromHarmonics(v)},w._FileFaces=[new U("right",new P.l(1,0,0),new P.l(0,0,-1),new P.l(0,-1,0)),new U("left",new P.l(-1,0,0),new P.l(0,0,1),new P.l(0,-1,0)),new U("up",new P.l(0,1,0),new P.l(1,0,0),new P.l(0,0,1)),new U("down",new P.l(0,-1,0),new P.l(1,0,0),new P.l(0,0,-1)),new U("front",new P.l(0,0,1),new P.l(1,0,0),new P.l(0,-1,0)),new U("back",new P.l(0,0,-1),new P.l(-1,0,0),new P.l(0,-1,0))],w}(),r=I(76384);r.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(r.c.prototype,"sphericalPolynomial",{get:function(){var w=this;if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=p.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((function(v){w._texture._sphericalPolynomial=v,w._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(w){this._texture&&(this._texture._sphericalPolynomial=w)},enumerable:!0,configurable:!0})},16708:function(w,v,I){"use strict";I.d(v,{c:function(){return x}});var P=I(78502),u=I(9892),Q=I(9217),K=I(80105),a=I(76384),U=I(70937),p=I(31709),r=I(72284),Y=I(60766),g=I(9127),J=I(82790),l=I(28372);r.d.prototype._createDepthStencilCubeTexture=function(w,v,I){var u=new Y.h(this,Y.e.DepthStencil);if(u.isCube=!0,1===this.webGLVersion)return g.e.Error("Depth cube texture is not supported by WebGL 1."),u;var Q=(0,P.d)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},v),K=this._gl;this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,u,!0),this._setupDepthStencilTexture(u,w,Q.generateStencil,Q.bilinearFiltering,Q.comparisonFunction),I._depthStencilTexture=u,I._depthStencilTextureWithStencil=Q.generateStencil;for(var a=0;a<6;a++)Q.generateStencil?K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,K.DEPTH24_STENCIL8,w,w,0,K.DEPTH_STENCIL,K.UNSIGNED_INT_24_8,null):K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,K.DEPTH_COMPONENT24,w,w,0,K.DEPTH_COMPONENT,K.UNSIGNED_INT,null);return this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(u),u},r.d.prototype._partialLoadFile=function(w,v,I,P,u){void 0===u&&(u=null);this._loadFile(w,(function(w){I[v]=w,I._internalCount++,6===I._internalCount&&P(I)}),void 0,void 0,!0,(function(w,v){u&&w&&u(w.status+" "+w.statusText,v)}))},r.d.prototype._cascadeLoadFiles=function(w,v,I,P){void 0===P&&(P=null);var u=[];u._internalCount=0;for(var Q=0;Q<6;Q++)this._partialLoadFile(I[Q],Q,u,v,P)},r.d.prototype._cascadeLoadImgs=function(w,v,I,P,u,Q){void 0===u&&(u=null);var K=[];K._internalCount=0;for(var a=0;a<6;a++)this._partialLoadImg(P[a],a,K,w,v,I,u,Q)},r.d.prototype._partialLoadImg=function(w,v,I,P,u,Q,K,a){void 0===K&&(K=null);var U=(0,l.e)();(0,J.m)(w,(function(w){I[v]=w,I._internalCount++,P&&P._removePendingData(U),6===I._internalCount&&Q&&Q(u,I)}),(function(w,v){P&&P._removePendingData(U),K&&K(w,v)}),P?P.offlineProvider:null,a),P&&P._addPendingData(U)},r.d.prototype._setCubeMapTextureParams=function(w,v,I){var P=this._gl;P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MAG_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MIN_FILTER,v?P.LINEAR_MIPMAP_LINEAR:P.LINEAR),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),w.samplingMode=v?3:2,v&&this.getCaps().textureMaxLevel&&void 0!==I&&I>0&&(P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MAX_LEVEL,I),w._maxLodLevel=I),this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null)},r.d.prototype.createCubeTextureBase=function(w,v,I,P,u,Q,K,a,U,p,J,l,R,x,j){var s=this;void 0===u&&(u=null),void 0===Q&&(Q=null),void 0===a&&(a=null),void 0===U&&(U=!1),void 0===p&&(p=0),void 0===J&&(J=0),void 0===l&&(l=null),void 0===R&&(R=null),void 0===x&&(x=null),void 0===j&&(j=!1);var B=l||new Y.h(this,Y.e.Cube);B.isCube=!0,B.url=w,B.generateMipMaps=!P,B._lodGenerationScale=p,B._lodGenerationOffset=J,B._useSRGBBuffer=!!j&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||!!P),this._doNotHandleContextLost||(B._extension=a,B._files=I);var t=w;this._transformTextureUrl&&!l&&(w=this._transformTextureUrl(w));for(var i=w.lastIndexOf("."),z=a||(i>-1?w.substring(i).toLowerCase():""),E=null,o=0,h=r.d._TextureLoaders;o<h.length;o++){var n=h[o];if(n.canLoad(z)){E=n;break}}if(E){var W=function(w){R&&R(B,w),E.loadCubeData(w,B,U,u,Q)};I&&6===I.length?E.supportCascades?this._cascadeLoadFiles(v,(function(w){return W(w.map((function(w){return new Uint8Array(w)})))}),I,Q):Q?Q("Textures type does not support cascades."):g.e.Warn("Texture loader does not support cascades."):this._loadFile(w,(function(w){return W(new Uint8Array(w))}),void 0,void 0,!0,(function(r,Y){w===t?Q&&r&&Q(r.status+" "+r.statusText,Y):(g.e.Warn("Failed to load ".concat(w,", falling back to the ").concat(t)),s.createCubeTextureBase(t,v,I,!!P,u,Q,K,a,U,p,J,B,R,x,j))}))}else{if(!I)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(v,B,(function(w,v){x&&x(w,v)}),I,Q)}return this._internalTexturesCache.push(B),B},r.d.prototype.createCubeTexture=function(w,v,I,P,u,Q,K,a,U,p,Y,J,l,R){var x=this;void 0===u&&(u=null),void 0===Q&&(Q=null),void 0===a&&(a=null),void 0===U&&(U=!1),void 0===p&&(p=0),void 0===Y&&(Y=0),void 0===J&&(J=null),void 0===R&&(R=!1);var j=this._gl;return this.createCubeTextureBase(w,v,I,!!P,u,Q,K,a,U,p,Y,J,(function(w){return x._bindTextureDirectly(j.TEXTURE_CUBE_MAP,w,!0)}),(function(w,v){var I=x.needPOTTextures?r.d.GetExponentOfTwo(v[0].width,x._caps.maxCubemapTextureSize):v[0].width,Q=I,a=[j.TEXTURE_CUBE_MAP_POSITIVE_X,j.TEXTURE_CUBE_MAP_POSITIVE_Y,j.TEXTURE_CUBE_MAP_POSITIVE_Z,j.TEXTURE_CUBE_MAP_NEGATIVE_X,j.TEXTURE_CUBE_MAP_NEGATIVE_Y,j.TEXTURE_CUBE_MAP_NEGATIVE_Z];x._bindTextureDirectly(j.TEXTURE_CUBE_MAP,w,!0),x._unpackFlipY(!1);var U=K?x._getInternalFormat(K,w._useSRGBBuffer):w._useSRGBBuffer?j.SRGB8_ALPHA8:j.RGBA,p=K?x._getInternalFormat(K):j.RGBA;w._useSRGBBuffer&&1===x.webGLVersion&&(p=U);for(var Y=0;Y<a.length;Y++)if(v[Y].width!==I||v[Y].height!==Q){if(x._prepareWorkingCanvas(),!x._workingCanvas||!x._workingContext)return void g.e.Warn("Cannot create canvas to resize texture.");x._workingCanvas.width=I,x._workingCanvas.height=Q,x._workingContext.drawImage(v[Y],0,0,v[Y].width,v[Y].height,0,0,I,Q),j.texImage2D(a[Y],0,U,p,j.UNSIGNED_BYTE,x._workingCanvas)}else j.texImage2D(a[Y],0,U,p,j.UNSIGNED_BYTE,v[Y]);P||j.generateMipmap(j.TEXTURE_CUBE_MAP),x._setCubeMapTextureParams(w,!P),w.width=I,w.height=Q,w.isReady=!0,K&&(w.format=K),w.onLoadedObservable.notifyObservers(w),w.onLoadedObservable.clear(),u&&u()}),!!R)};var R=I(9271),x=function(w){function v(v,I,P,u,Q,a,p,r,Y,g,J,l,x,j,s){void 0===P&&(P=null),void 0===u&&(u=!1),void 0===Q&&(Q=null),void 0===a&&(a=null),void 0===p&&(p=null),void 0===r&&(r=5),void 0===Y&&(Y=!1),void 0===g&&(g=null),void 0===J&&(J=!1),void 0===l&&(l=.8),void 0===x&&(x=0);var B,t=this;return(t=w.call(this,I)||this)._lodScale=.8,t._lodOffset=0,t.onLoadObservable=new R.c,t.boundingBoxPosition=K.l.Zero(),t._rotationY=0,t._files=null,t._forcedExtension=null,t._extensions=null,t.name=v,t.url=v,t._noMipmap=u,t.hasAlpha=!1,t._format=r,t.isCube=!0,t._textureMatrix=K.e.Identity(),t._createPolynomials=J,t.coordinatesMode=U.e.CUBIC_MODE,t._extensions=P,t._files=Q,t._forcedExtension=g,t._loaderOptions=j,t._useSRGBBuffer=s,t._lodScale=l,t._lodOffset=x,v||Q?(t.updateURL(v,g,a,Y,p,P,null===(B=t.getScene())||void 0===B?void 0:B.useDelayedTextureLoading,Q),t):t}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(w){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(w)){this._boundingBoxSize=w;var v=this.getScene();v&&v.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"rotationY",{get:function(){return this._rotationY},set:function(w){this._rotationY=w,this.setReflectionTextureMatrix(K.e.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"forcedExtension",{get:function(){return this._forcedExtension},enumerable:!1,configurable:!0}),v.CreateFromImages=function(w,I,P){var u="";return w.forEach((function(w){return u+=w})),new v(u,I,null,P,w)},v.CreateFromPrefilteredData=function(w,I,P,u){void 0===P&&(P=null),void 0===u&&(u=!0);var Q=I.useDelayedTextureLoading;I.useDelayedTextureLoading=!1;var K=new v(w,I,null,!1,null,null,null,void 0,!0,P,u);return I.useDelayedTextureLoading=Q,K},v.prototype.getClassName=function(){return"CubeTexture"},v.prototype.updateURL=function(w,v,I,P,u,Q,K,a){void 0===I&&(I=null),void 0===P&&(P=!1),void 0===u&&(u=null),void 0===Q&&(Q=null),void 0===K&&(K=!1),void 0===a&&(a=null),this.name&&!this.name.startsWith("data:")||(this.name=w),this.url=w,v&&(this._forcedExtension=v);var U=w.lastIndexOf("."),p=v||(U>-1?w.substring(U).toLowerCase():""),r=0===p.indexOf(".dds"),Y=0===p.indexOf(".env");if(Y?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=P,P&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(Y||r||Q||(Q=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Q){for(var g=0;g<Q.length;g++)this._files.push(w+Q[g]);this._extensions=Q}K?(this.delayLoadState=4,this._delayedOnLoad=I,this._delayedOnError=u):this._loadTexture(I,u)},v.prototype.delayLoad=function(w){4===this.delayLoadState&&(w&&(this._forcedExtension=w),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))},v.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},v.prototype.setReflectionTextureMatrix=function(w){var v,I=this;w.updateFlag!==this._textureMatrix.updateFlag&&(w.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(v=this.getScene())||void 0===v||v.markAllMaterialsAsDirty(1,(function(w){return-1!==w.getActiveTextures().indexOf(I)}))),this._textureMatrix=w)},v.prototype._loadTexture=function(w,v){var I,P=this;void 0===w&&(w=null),void 0===v&&(v=null);var u=this.getScene(),K=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);var a=function(){var v;P.onLoadObservable.notifyObservers(P),K&&(K.dispose(),null===(v=P.getScene())||void 0===v||v.markAllMaterialsAsDirty(1)),w&&w()},p=function(w,I){P._loadingError=!0,P._errorObject={message:w,exception:I},v&&v(w,I),U.e.OnTextureLoadErrorObservable.notifyObservers(P)};this._texture?this._texture.isReady?Q.i.SetImmediate((function(){return a()})):this._texture.onLoadedObservable.add((function(){return a()})):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,u,this._lodScale,this._lodOffset,w,p,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,u,this._files,this._noMipmap,w,p,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer),null===(I=this._texture)||void 0===I||I.onLoadedObservable.add((function(){return P.onLoadObservable.notifyObservers(P)})))},v.Parse=function(w,I,P){var Q=u.e.Parse((function(){var u=!1;return w.prefiltered&&(u=w.prefiltered),new v(P+w.name,I,w.extensions,!1,w.files||null,null,null,void 0,u,w.forcedExtension)}),w,I);if(w.boundingBoxPosition&&(Q.boundingBoxPosition=K.l.FromArray(w.boundingBoxPosition)),w.boundingBoxSize&&(Q.boundingBoxSize=K.l.FromArray(w.boundingBoxSize)),w.animations)for(var a=0;a<w.animations.length;a++){var U=w.animations[a],r=(0,p.c)("BABYLON.Animation");r&&Q.animations.push(r.Parse(U))}return Q},v.prototype.clone=function(){var w=this,I=0,P=u.e.Clone((function(){var P=new v(w.url,w.getScene()||w._getEngine(),w._extensions,w._noMipmap,w._files);return I=P.uniqueId,P}),this);return P.uniqueId=I,P},(0,P.i)([(0,u.J)()],v.prototype,"url",void 0),(0,P.i)([(0,u.J)("rotationY")],v.prototype,"rotationY",null),(0,P.i)([(0,u.J)("files")],v.prototype,"_files",void 0),(0,P.i)([(0,u.J)("forcedExtension")],v.prototype,"_forcedExtension",void 0),(0,P.i)([(0,u.J)("extensions")],v.prototype,"_extensions",void 0),(0,P.i)([(0,u.v)("textureMatrix")],v.prototype,"_textureMatrix",void 0),v}(a.c);U.e._CubeTextureParser=x.Parse,(0,p.g)("BABYLON.CubeTexture",x)},90673:function(w,v,I){"use strict";I.d(v,{d:function(){return U}});var P=I(78502),u=I(9127),Q=I(70937),K=I(72284),a=I(60766);K.d.prototype.createDynamicTexture=function(w,v,I,P){var u=new a.h(this,a.e.Dynamic);return u.baseWidth=w,u.baseHeight=v,I&&(w=this.needPOTTextures?K.d.GetExponentOfTwo(w,this._caps.maxTextureSize):w,v=this.needPOTTextures?K.d.GetExponentOfTwo(v,this._caps.maxTextureSize):v),u.width=w,u.height=v,u.isReady=!1,u.generateMipMaps=I,u.samplingMode=P,this.updateTextureSamplingMode(P,u),this._internalTexturesCache.push(u),u},K.d.prototype.updateDynamicTexture=function(w,v,I,P,u,Q,K){if(void 0===P&&(P=!1),void 0===Q&&(Q=!1),void 0===K&&(K=!1),w){var a=this._gl,U=a.TEXTURE_2D,p=this._bindTextureDirectly(U,w,!0,Q);this._unpackFlipY(void 0===I?w.invertY:I),P&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var r=this._getWebGLTextureType(w.type),Y=this._getInternalFormat(u||w.format),g=this._getRGBABufferInternalSizedFormat(w.type,Y);a.texImage2D(U,0,g,Y,r,v),w.generateMipMaps&&a.generateMipmap(U),p||this._bindTextureDirectly(U,null),P&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),w.isReady=!0}};var U=function(w){function v(v,I,P,u,K,a,U){void 0===P&&(P=null),void 0===u&&(u=!1),void 0===K&&(K=3),void 0===a&&(a=5);var p=w.call(this,null,P,!u,U,K,void 0,void 0,void 0,void 0,a)||this;p.name=v,p.wrapU=Q.e.CLAMP_ADDRESSMODE,p.wrapV=Q.e.CLAMP_ADDRESSMODE,p._generateMipMaps=u;var r=p._getEngine();if(!r)return p;I.getContext?(p._canvas=I,p._texture=r.createDynamicTexture(I.width,I.height,u,K)):(p._canvas=r.createCanvas(1,1),I.width||0===I.width?p._texture=r.createDynamicTexture(I.width,I.height,u,K):p._texture=r.createDynamicTexture(I,I,u,K));var Y=p.getSize();return p._canvas.width!==Y.width&&(p._canvas.width=Y.width),p._canvas.height!==Y.height&&(p._canvas.height=Y.height),p._context=p._canvas.getContext("2d"),p}return(0,P.m)(v,w),v.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(v.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),v.prototype._recreate=function(w){this._canvas.width=w.width,this._canvas.height=w.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(w.width,w.height,this._generateMipMaps,this.samplingMode)},v.prototype.scale=function(w){var v=this.getSize();v.width*=w,v.height*=w,this._recreate(v)},v.prototype.scaleTo=function(w,v){var I=this.getSize();I.width=w,I.height=v,this._recreate(I)},v.prototype.getContext=function(){return this._context},v.prototype.clear=function(){var w=this.getSize();this._context.fillRect(0,0,w.width,w.height)},v.prototype.update=function(w,v,I){void 0===v&&(v=!1),void 0===I&&(I=!1),this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===w||w,v,this._format||void 0,void 0,I)},v.prototype.drawText=function(w,v,I,P,u,Q,K,a){void 0===a&&(a=!0);var U=this.getSize();if(Q&&(this._context.fillStyle=Q,this._context.fillRect(0,0,U.width,U.height)),this._context.font=P,null===v||void 0===v){var p=this._context.measureText(w);v=(U.width-p.width)/2}if(null===I||void 0===I){var r=parseInt(P.replace(/\D/g,""));I=U.height/2+r/3.65}this._context.fillStyle=u||"",this._context.fillText(w,v,I),a&&this.update(K)},v.prototype.clone=function(){var w=this.getScene();if(!w)return this;var I=this.getSize(),P=new v(this.name,I,w,this._generateMipMaps);return P.hasAlpha=this.hasAlpha,P.level=this.level,P.wrapU=this.wrapU,P.wrapV=this.wrapV,P},v.prototype.serialize=function(){var I=this.getScene();I&&!I.isReady()&&u.e.Warn("The scene must be ready before serializing the dynamic texture");var P=w.prototype.serialize.call(this);return v._IsCanvasElement(this._canvas)&&(P.base64String=this._canvas.toDataURL()),P.invertY=this._invertY,P.samplingMode=this.samplingMode,P},v._IsCanvasElement=function(w){return void 0!==w.toDataURL},v.prototype._rebuild=function(){this.update()},v}(Q.e)},60766:function(w,v,I){"use strict";I.d(v,{e:function(){return P},h:function(){return a}});var P,u=I(78502),Q=I(9271),K=I(80150);!function(w){w[w.Unknown=0]="Unknown",w[w.Url=1]="Url",w[w.Temp=2]="Temp",w[w.Raw=3]="Raw",w[w.Dynamic=4]="Dynamic",w[w.RenderTarget=5]="RenderTarget",w[w.MultiRenderTarget=6]="MultiRenderTarget",w[w.Cube=7]="Cube",w[w.CubeRaw=8]="CubeRaw",w[w.CubePrefiltered=9]="CubePrefiltered",w[w.Raw3D=10]="Raw3D",w[w.Raw2DArray=11]="Raw2DArray",w[w.DepthStencil=12]="DepthStencil",w[w.CubeRawRGBD=13]="CubeRawRGBD",w[w.Depth=14]="Depth"}(P||(P={}));var a=function(w){function v(I,u,K){void 0===K&&(K=!1);var a=w.call(this)||this;return a.isReady=!1,a.isCube=!1,a.is3D=!1,a.is2DArray=!1,a.isMultiview=!1,a.url="",a.generateMipMaps=!1,a.samples=0,a.type=-1,a.format=-1,a.onLoadedObservable=new Q.c,a.onErrorObservable=new Q.c,a.onRebuildCallback=null,a.width=0,a.height=0,a.depth=0,a.baseWidth=0,a.baseHeight=0,a.baseDepth=0,a.invertY=!1,a._invertVScale=!1,a._associatedChannel=-1,a._source=P.Unknown,a._buffer=null,a._bufferView=null,a._bufferViewArray=null,a._bufferViewArrayArray=null,a._size=0,a._extension="",a._files=null,a._workingCanvas=null,a._workingContext=null,a._cachedCoordinatesMode=null,a._isDisabled=!1,a._compression=null,a._sphericalPolynomial=null,a._sphericalPolynomialPromise=null,a._sphericalPolynomialComputed=!1,a._lodGenerationScale=0,a._lodGenerationOffset=0,a._useSRGBBuffer=!1,a._lodTextureHigh=null,a._lodTextureMid=null,a._lodTextureLow=null,a._isRGBD=!1,a._linearSpecularLOD=!1,a._irradianceTexture=null,a._hardwareTexture=null,a._maxLodLevel=null,a._references=1,a._gammaSpace=null,a._engine=I,a._source=u,a._uniqueId=v._Counter++,K||(a._hardwareTexture=I._createHardwareTexture()),a}return(0,u.m)(v,w),Object.defineProperty(v.prototype,"useMipMaps",{get:function(){return this.generateMipMaps},set:function(w){this.generateMipMaps=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),v.prototype.getEngine=function(){return this._engine},Object.defineProperty(v.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),v.prototype.incrementReferences=function(){this._references++},v.prototype.updateSize=function(w,v,I){void 0===I&&(I=1),this._engine.updateTextureDimensions(this,w,v,I),this.width=w,this.height=v,this.depth=I,this.baseWidth=w,this.baseHeight=v,this.baseDepth=I,this._size=w*v*I},v.prototype._rebuild=function(){var w,v=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var I=this.onRebuildCallback(this),u=function(w){w._swapAndDie(v,!1),v.isReady=I.isReady};I.isAsync?I.proxy.then(u):u(I.proxy)}else{var Q;switch(this.source){case P.Temp:break;case P.Url:return void(Q=this._engine.createTexture(null!==(w=this._originalUrl)&&void 0!==w?w:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){Q._swapAndDie(v,!1),v.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case P.Raw:(Q=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case P.Raw3D:(Q=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case P.Raw2DArray:(Q=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case P.Dynamic:(Q=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case P.Cube:return void(Q=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){Q._swapAndDie(v,!1),v.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case P.CubeRaw:(Q=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case P.CubeRawRGBD:return;case P.CubePrefiltered:return void((Q=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(w){w&&w._swapAndDie(v,!1),v.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}}},v.prototype._swapAndDie=function(w,v){var I;void 0===v&&(v=!0),null===(I=this._hardwareTexture)||void 0===I||I.setUsage(w._source,this.generateMipMaps,this.isCube,this.width,this.height),w._hardwareTexture=this._hardwareTexture,v&&(w._isRGBD=this._isRGBD),this._lodTextureHigh&&(w._lodTextureHigh&&w._lodTextureHigh.dispose(),w._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(w._lodTextureMid&&w._lodTextureMid.dispose(),w._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(w._lodTextureLow&&w._lodTextureLow.dispose(),w._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(w._irradianceTexture&&w._irradianceTexture.dispose(),w._irradianceTexture=this._irradianceTexture);var P=this._engine.getLoadedTexturesCache(),u=P.indexOf(this);-1!==u&&P.splice(u,1),-1===(u=P.indexOf(w))&&P.push(w)},v.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},v._Counter=0,v}(K.c)},15099:function(w,v,I){"use strict";I.d(v,{b:function(){return Q}});var P=I(78502),u=I(70937),Q=(I(36125),function(w){function v(v,I,P,Q,K,a,U,p,r,Y,g){void 0===a&&(a=!0),void 0===U&&(U=!1),void 0===p&&(p=3),void 0===r&&(r=0);var J=w.call(this,null,K,!a,U,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Y)||this;return J.format=Q,J._engine?(J._engine._caps.textureFloatLinearFiltering||1!==r||(p=1),J._engine._caps.textureHalfFloatLinearFiltering||2!==r||(p=1),J._texture=J._engine.createRawTexture(v,I,P,Q,a,U,p,null,r,null!==Y&&void 0!==Y?Y:0,null!==g&&void 0!==g&&g),J.wrapU=u.e.CLAMP_ADDRESSMODE,J.wrapV=u.e.CLAMP_ADDRESSMODE,J):J}return(0,P.m)(v,w),v.prototype.update=function(w){this._getEngine().updateRawTexture(this._texture,w,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)},v.CreateLuminanceTexture=function(w,I,P,u,Q,K,a){return void 0===Q&&(Q=!0),void 0===K&&(K=!1),void 0===a&&(a=3),new v(w,I,P,1,u,Q,K,a)},v.CreateLuminanceAlphaTexture=function(w,I,P,u,Q,K,a){return void 0===Q&&(Q=!0),void 0===K&&(K=!1),void 0===a&&(a=3),new v(w,I,P,2,u,Q,K,a)},v.CreateAlphaTexture=function(w,I,P,u,Q,K,a){return void 0===Q&&(Q=!0),void 0===K&&(K=!1),void 0===a&&(a=3),new v(w,I,P,0,u,Q,K,a)},v.CreateRGBTexture=function(w,I,P,u,Q,K,a,U,p,r){return void 0===Q&&(Q=!0),void 0===K&&(K=!1),void 0===a&&(a=3),void 0===U&&(U=0),void 0===p&&(p=0),void 0===r&&(r=!1),new v(w,I,P,4,u,Q,K,a,U,p,r)},v.CreateRGBATexture=function(w,I,P,u,Q,K,a,U,p,r){return void 0===Q&&(Q=!0),void 0===K&&(K=!1),void 0===a&&(a=3),void 0===U&&(U=0),void 0===p&&(p=0),void 0===r&&(r=!1),new v(w,I,P,5,u,Q,K,a,U,p,r)},v.CreateRGBAStorageTexture=function(w,I,P,u,Q,K,a,U,p){return void 0===Q&&(Q=!0),void 0===K&&(K=!1),void 0===a&&(a=3),void 0===U&&(U=0),void 0===p&&(p=!1),new v(w,I,P,5,u,Q,K,a,U,1,p)},v.CreateRTexture=function(w,I,P,Q,K,a,U,p){return void 0===K&&(K=!0),void 0===a&&(a=!1),void 0===U&&(U=u.e.TRILINEAR_SAMPLINGMODE),void 0===p&&(p=1),new v(w,I,P,6,Q,K,a,U,p)},v.CreateRStorageTexture=function(w,I,P,Q,K,a,U,p){return void 0===K&&(K=!0),void 0===a&&(a=!1),void 0===U&&(U=u.e.TRILINEAR_SAMPLINGMODE),void 0===p&&(p=1),new v(w,I,P,6,Q,K,a,U,p,1)},v}(u.e))},57194:function(w,v,I){"use strict";I.d(v,{e:function(){return Q}});var P=I(78502),u=I(70937),Q=(I(36125),function(w){function v(v,I,P,Q,K,a,U,p,r,Y){void 0===U&&(U=!0),void 0===p&&(p=!1),void 0===r&&(r=u.e.TRILINEAR_SAMPLINGMODE),void 0===Y&&(Y=0);var g=w.call(this,null,a,!U,p)||this;return g.format=K,g._texture=a.getEngine().createRawTexture2DArray(v,I,P,Q,K,U,p,r,null,Y),g._depth=Q,g.is2DArray=!0,g}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"depth",{get:function(){return this._depth},enumerable:!1,configurable:!0}),v.prototype.update=function(w){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,w,this._texture.format,this._texture.invertY,null,this._texture.type)},v.CreateRGBATexture=function(w,I,P,u,Q,K,a,U,p){return void 0===K&&(K=!0),void 0===a&&(a=!1),void 0===U&&(U=3),void 0===p&&(p=0),new v(w,I,P,u,5,Q,K,a,U,p)},v}(u.e))},52128:function(w,v,I){"use strict";I.d(v,{b:function(){return Y}});var P=I(78502),u=I(9271),Q=I(9217),K=I(80105),a=I(70937),U=I(64833),p=I(16369),r=(I(84468),I(42373),I(90690)),Y=function(w){function v(v,I,P,Q,U,r,Y,g,J,l,R,x,j,s,B,t,i){void 0===U&&(U=!0),void 0===r&&(r=0),void 0===Y&&(Y=!1),void 0===g&&(g=a.e.TRILINEAR_SAMPLINGMODE),void 0===J&&(J=!0),void 0===l&&(l=!1),void 0===R&&(R=!1),void 0===x&&(x=5),void 0===j&&(j=!1),void 0===t&&(t=!1),void 0===i&&(i=!1);var z,E=this;if((E=w.call(this,null,P,!Q,void 0,g,void 0,void 0,void 0,void 0,x)||this).renderParticles=!0,E.renderSprites=!1,E.ignoreCameraViewport=!1,E.onBeforeBindObservable=new u.c,E.onAfterUnbindObservable=new u.c,E.onBeforeRenderObservable=new u.c,E.onAfterRenderObservable=new u.c,E.onClearObservable=new u.c,E.onResizeObservable=new u.c,E._cleared=!1,E.skipInitialClear=!1,E._currentRefreshId=-1,E._refreshRate=1,E._samples=1,E._canRescale=!0,E._renderTarget=null,E.boundingBoxPosition=K.l.Zero(),!(P=E.getScene()))return E;var o=E.getScene().getEngine();return E._coordinatesMode=a.e.PROJECTION_MODE,E.renderList=new Array,E.name=v,E.isRenderTarget=!0,E._initialSizeParameter=I,E._renderPassIds=[],E._isCubeData=Y,E._processSizeParameter(I),E.renderPassId=E._renderPassIds[0],E._resizeObserver=o.onResizeObservable.add((function(){})),E._generateMipMaps=!!Q,E._doNotChangeAspectRatio=U,E._renderingManager=new p.c(P),E._renderingManager._useSceneAutoClearSetup=!0,R||(E._renderTargetOptions={generateMipMaps:Q,type:r,format:null!==(z=E._format)&&void 0!==z?z:void 0,samplingMode:E.samplingMode,generateDepthBuffer:J,generateStencilBuffer:l,samples:s,creationFlags:B,noColorTarget:t,useSRGBBuffer:i},E.samplingMode===a.e.NEAREST_SAMPLINGMODE&&(E.wrapU=a.e.CLAMP_ADDRESSMODE,E.wrapV=a.e.CLAMP_ADDRESSMODE),j||(Y?(E._renderTarget=P.getEngine().createRenderTargetCubeTexture(E.getRenderSize(),E._renderTargetOptions),E.coordinatesMode=a.e.INVCUBIC_MODE,E._textureMatrix=K.e.Identity()):E._renderTarget=P.getEngine().createRenderTargetTexture(E._size,E._renderTargetOptions),E._texture=E._renderTarget.texture,void 0!==s&&(E.samples=s))),E}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"renderList",{get:function(){return this._renderList},set:function(w){this._renderList=w,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),v.prototype._hookArray=function(w){var v=this,I=w.push;w.push=function(){for(var P,u=[],Q=0;Q<arguments.length;Q++)u[Q]=arguments[Q];var K=0===w.length,a=I.apply(w,u);return K&&(null===(P=v.getScene())||void 0===P||P.meshes.forEach((function(w){w._markSubMeshesAsLightDirty()}))),a};var P=w.splice;w.splice=function(I,u){var Q,K=P.apply(w,[I,u]);return 0===w.length&&(null===(Q=v.getScene())||void 0===Q||Q.meshes.forEach((function(w){w._markSubMeshesAsLightDirty()}))),K}},Object.defineProperty(v.prototype,"postProcesses",{get:function(){return this._postProcesses},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"_prePassEnabled",{get:function(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onAfterUnbind",{set:function(w){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onBeforeRender",{set:function(w){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onAfterRender",{set:function(w){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onClear",{set:function(w){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"renderPassIds",{get:function(){return this._renderPassIds},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"currentRefreshId",{get:function(){return this._currentRefreshId},enumerable:!1,configurable:!0}),v.prototype.setMaterialForRendering=function(w,v){var I;I=Array.isArray(w)?w:[w];for(var P=0;P<I.length;++P)for(var u=0;u<this._renderPassIds.length;++u)I[P].setMaterialForRenderPass(this._renderPassIds[u],void 0!==v?Array.isArray(v)?v[u]:v:void 0)},Object.defineProperty(v.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),v.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(v.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(w){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(w)){this._boundingBoxSize=w;var v=this.getScene();v&&v.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"depthStencilTexture",{get:function(){var w,v;return null!==(v=null===(w=this._renderTarget)||void 0===w?void 0:w._depthStencilTexture)&&void 0!==v?v:null},enumerable:!1,configurable:!0}),v.prototype.createDepthStencilTexture=function(w,v,I,P,u){var Q;void 0===w&&(w=0),void 0===v&&(v=!0),void 0===I&&(I=!1),void 0===P&&(P=1),void 0===u&&(u=14),null===(Q=this._renderTarget)||void 0===Q||Q.createDepthStencilTexture(w,v,I,P,u)},v.prototype._releaseRenderPassId=function(){if(this._scene)for(var w=this._scene.getEngine(),v=0;v<this._renderPassIds.length;++v)w.releaseRenderPassId(this._renderPassIds[v]);this._renderPassIds=[]},v.prototype._createRenderPassId=function(){this._releaseRenderPassId();for(var w=this._scene.getEngine(),v=this._isCubeData?6:this.getRenderLayers()||1,I=0;I<v;++I)this._renderPassIds[I]=w.createRenderPassId("RenderTargetTexture - ".concat(this.name,"#").concat(I))},v.prototype._processSizeParameter=function(w){if(w.ratio){this._sizeRatio=w.ratio;var v=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(v.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(v.getRenderHeight(),this._sizeRatio)}}else this._size=w;this._createRenderPassId()},Object.defineProperty(v.prototype,"samples",{get:function(){var w,v;return null!==(v=null===(w=this._renderTarget)||void 0===w?void 0:w.samples)&&void 0!==v?v:this._samples},set:function(w){this._renderTarget&&(this._samples=this._renderTarget.setSamples(w))},enumerable:!1,configurable:!0}),v.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(v.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(w){this._refreshRate=w,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),v.prototype.addPostProcess=function(w){if(!this._postProcessManager){var v=this.getScene();if(!v)return;this._postProcessManager=new U.c(v),this._postProcesses=new Array}this._postProcesses.push(w),this._postProcesses[0].autoClear=!1},v.prototype.clearPostProcesses=function(w){if(void 0===w&&(w=!1),this._postProcesses){if(w)for(var v=0,I=this._postProcesses;v<I.length;v++){I[v].dispose()}this._postProcesses=[]}},v.prototype.removePostProcess=function(w){if(this._postProcesses){var v=this._postProcesses.indexOf(w);-1!==v&&(this._postProcesses.splice(v,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},v.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},v.prototype.getRenderSize=function(){return this.getRenderWidth()},v.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},v.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},v.prototype.getRenderLayers=function(){var w=this._size.layers;return w||0},v.prototype.disableRescaling=function(){this._canRescale=!1},Object.defineProperty(v.prototype,"canRescale",{get:function(){return this._canRescale},enumerable:!1,configurable:!0}),v.prototype.scale=function(w){var v=Math.max(1,this.getRenderSize()*w);this.resize(v)},v.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:w.prototype.getReflectionTextureMatrix.call(this)},v.prototype.resize=function(w){var v,I=this.isCube;null===(v=this._renderTarget)||void 0===v||v.dispose(),this._renderTarget=null;var P=this.getScene();P&&(this._processSizeParameter(w),this._renderTarget=I?P.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):P.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},v.prototype.render=function(w,v){void 0===w&&(w=!1),void 0===v&&(v=!1),this._render(w,v)},v.prototype.isReadyForRendering=function(){return this._render(!1,!1,!0)},v.prototype._render=function(w,v,I){var P;void 0===w&&(w=!1),void 0===v&&(v=!1),void 0===I&&(I=!1);var u=this.getScene();if(!u)return I;var Q=u.getEngine();if(void 0!==this.useCameraPostProcesses&&(w=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var K=0;K<this._waitingRenderList.length;K++){var a=this._waitingRenderList[K];(r=u.getMeshById(a))&&this.renderList.push(r)}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];var U=this.getScene();if(!U)return I;var p=U.meshes;for(K=0;K<p.length;K++){var r=p[K];this.renderListPredicate(r)&&this.renderList.push(r)}}var Y=Q.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);var g=null!==(P=this.activeCamera)&&void 0!==P?P:u.activeCamera;g&&(g!==u.activeCamera&&u.setTransformMatrix(g.getViewMatrix(),g.getProjectionMatrix(!0)),Q.setViewport(g.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;var J=I;if(I){u.getViewMatrix()||u.updateTransformMatrix();var l=this.is2DArray?this.getRenderLayers():this.isCube?6:1;for(B=0;B<l&&J;B++){var R=null,x=this.renderList?this.renderList:u.getActiveMeshes().data,j=this.renderList?this.renderList.length:u.getActiveMeshes().length;Q.currentRenderPassId=this._renderPassIds[B],this.onBeforeRenderObservable.notifyObservers(B),this.getCustomRenderList&&(R=this.getCustomRenderList(B,x,j)),R||(R=x),this._doNotChangeAspectRatio||u.updateTransformMatrix(!0);for(var s=0;s<R.length&&J;++s){if((r=R[s]).isEnabled()&&!r.isBlocked&&r.isVisible&&r.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(r,this.refreshRate)){J=!1;break}}else if(!r.isReady(!0)){J=!1;break}}this.onAfterRenderObservable.notifyObservers(B)}}else if(this.is2DArray)for(var B=0;B<this.getRenderLayers();B++)this._renderToTarget(0,w,v,B,g),u.incrementRenderId(),u.resetCachedMaterial();else if(this.isCube)for(var t=0;t<6;t++)this._renderToTarget(t,w,v,void 0,g),u.incrementRenderId(),u.resetCachedMaterial();else this._renderToTarget(0,w,v,void 0,g);return this.onAfterUnbindObservable.notifyObservers(this),Q.currentRenderPassId=Y,u.activeCamera&&((u.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==u.activeCamera)&&u.setTransformMatrix(u.activeCamera.getViewMatrix(),u.activeCamera.getProjectionMatrix(!0)),Q.setViewport(u.activeCamera.viewport)),u.resetCachedMaterial(),J},v.prototype._bestReflectionRenderTargetDimension=function(w,v){var I=w*v,P=r.d.NearestPOT(I+16384/(128+I));return Math.min(r.d.FloorPOT(w),P)},v.prototype._prepareRenderingManager=function(w,v,I,P){var u=this.getScene();if(u){this._renderingManager.reset();for(var Q=u.getRenderId(),K=0;K<v;K++){var a=w[K];if(a&&!a.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(a,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!a.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!a._internalAbstractMeshDataInfo._currentLODIsUpToDate&&u.activeCamera&&(a._internalAbstractMeshDataInfo._currentLOD=u.customLODSelector?u.customLODSelector(a,this.activeCamera||u.activeCamera):a.getLOD(this.activeCamera||u.activeCamera),a._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!a._internalAbstractMeshDataInfo._currentLOD)continue;var U=a._internalAbstractMeshDataInfo._currentLOD;U._preActivateForIntermediateRendering(Q);var p=void 0;if(p=!(!P||!I)&&0===(a.layerMask&I.layerMask),a.isEnabled()&&a.isVisible&&a.subMeshes&&!p&&(U!==a&&U._activate(Q,!0),a._activate(Q,!0)&&a.subMeshes.length)){a.isAnInstance?a._internalAbstractMeshDataInfo._actAsRegularMesh&&(U=a):U._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,U._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var r=0;r<U.subMeshes.length;r++){var Y=U.subMeshes[r];this._renderingManager.dispatch(Y,U)}}}}for(var g=0;g<u.particleSystems.length;g++){var J=u.particleSystems[g],l=J.emitter;J.isStarted()&&l&&l.position&&l.isEnabled()&&(w.indexOf(l)>=0&&this._renderingManager.dispatchParticles(J))}}},v.prototype._bindFrameBuffer=function(w,v){void 0===w&&(w=0),void 0===v&&(v=0);var I=this.getScene();if(I){var P=I.getEngine();this._renderTarget&&P.bindFramebuffer(this._renderTarget,this.isCube?w:void 0,void 0,void 0,this.ignoreCameraViewport,0,v)}},v.prototype._unbindFrameBuffer=function(w,v){var I=this;this._renderTarget&&w.unBindFramebuffer(this._renderTarget,this.isCube,(function(){I.onAfterRenderObservable.notifyObservers(v)}))},v.prototype._prepareFrame=function(w,v,I,P){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):P&&w.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(v,I)},v.prototype._renderToTarget=function(w,v,I,P,u){var K,a,U,p,r,Y;void 0===P&&(P=0),void 0===u&&(u=null);var g=this.getScene();if(g){var J=g.getEngine();if(null===(K=J._debugPushGroup)||void 0===K||K.call(J,"render to face #".concat(w," layer #").concat(P),1),this._prepareFrame(g,w,P,v),this.is2DArray?(J.currentRenderPassId=this._renderPassIds[P],this.onBeforeRenderObservable.notifyObservers(P)):(J.currentRenderPassId=this._renderPassIds[w],this.onBeforeRenderObservable.notifyObservers(w)),J.snapshotRendering&&1===J.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(J):this.skipInitialClear||J.clear(this.clearColor||g.clearColor,!0,!0,!0);else{var l=null,R=this.renderList?this.renderList:g.getActiveMeshes().data,x=this.renderList?this.renderList.length:g.getActiveMeshes().length;this.getCustomRenderList&&(l=this.getCustomRenderList(this.is2DArray?P:w,R,x)),l?this._prepareRenderingManager(l,l.length,u,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(R,x,u,!this.renderList),this._defaultRenderListPrepared=!0),l=R);for(var j=0,s=g._beforeRenderTargetClearStage;j<s.length;j++){s[j].action(this,w,P)}this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(J):this.skipInitialClear||J.clear(this.clearColor||g.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||g.updateTransformMatrix(!0);for(var B=0,t=g._beforeRenderTargetDrawStage;B<t.length;B++){t[B].action(this,w,P)}this._renderingManager.render(this.customRenderFunction,l,this.renderParticles,this.renderSprites);for(var i=0,z=g._afterRenderTargetDrawStage;i<z.length;i++){z[i].action(this,w,P)}var E=null!==(U=null===(a=this._texture)||void 0===a?void 0:a.generateMipMaps)&&void 0!==U&&U;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,null!==(p=this._renderTarget)&&void 0!==p?p:void 0,w,this._postProcesses,this.ignoreCameraViewport):v&&g.postProcessManager._finalizeFrame(!1,null!==(r=this._renderTarget)&&void 0!==r?r:void 0,w),this._texture&&(this._texture.generateMipMaps=E),this._doNotChangeAspectRatio||g.updateTransformMatrix(!0),I&&Q.i.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),J)}this._unbindFrameBuffer(J,w),this._texture&&this.isCube&&5===w&&J.generateMipMapsForCubemap(this._texture),null===(Y=J._debugPopGroup)||void 0===Y||Y.call(J,1)}},v.prototype.setRenderingOrder=function(w,v,I,P){void 0===v&&(v=null),void 0===I&&(I=null),void 0===P&&(P=null),this._renderingManager.setRenderingOrder(w,v,I,P)},v.prototype.setRenderingAutoClearDepthStencil=function(w,v){this._renderingManager.setRenderingAutoClearDepthStencil(w,v),this._renderingManager._useSceneAutoClearSetup=!1},v.prototype.clone=function(){var w=this.getSize(),I=new v(this.name,w,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return I.hasAlpha=this.hasAlpha,I.level=this.level,I.coordinatesMode=this.coordinatesMode,this.renderList&&(I.renderList=this.renderList.slice(0)),I},v.prototype.serialize=function(){if(!this.name)return null;var v=w.prototype.serialize.call(this);if(v.renderTargetSize=this.getRenderSize(),v.renderList=[],this.renderList)for(var I=0;I<this.renderList.length;I++)v.renderList.push(this.renderList[I].id);return v},v.prototype.disposeFramebufferObjects=function(){var w;null===(w=this._renderTarget)||void 0===w||w.dispose(!0)},v.prototype.releaseInternalTexture=function(){var w;null===(w=this._renderTarget)||void 0===w||w.releaseTextures(),this._texture=null},v.prototype.dispose=function(){var v;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var I=this.getScene();if(I){var P=I.customRenderTargets.indexOf(this);P>=0&&I.customRenderTargets.splice(P,1);for(var u=0,Q=I.cameras;u<Q.length;u++){var K=Q[u];(P=K.customRenderTargets.indexOf(this))>=0&&K.customRenderTargets.splice(P,1)}null===(v=this._renderTarget)||void 0===v||v.dispose(),this._renderTarget=null,this._texture=null,w.prototype.dispose.call(this)}},v.prototype._rebuild=function(){this.refreshRate===v.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=v.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},v.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},v.prototype.getViewCount=function(){return 1},v.REFRESHRATE_RENDER_ONCE=0,v.REFRESHRATE_RENDER_ONEVERYFRAME=1,v.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,v}(a.e);a.e._CreateRenderTargetTexture=function(w,v,I,P,u){return new Y(w,v,I,P)}},70937:function(w,v,I){"use strict";I.d(v,{e:function(){return s}});var P=I(78502),u=I(9892),Q=I(9271),K=I(80105),a=I(76384),U=I(31709),p=I(50504),r=I(1116),Y=I(90526),g=I(85567),J=I(50459);function l(w,v,I){void 0===I&&(I=!1);var P=v.width,u=v.height;if(w instanceof Float32Array){for(var Q=w.byteLength/w.BYTES_PER_ELEMENT,K=new Uint8Array(Q);--Q>=0;){var a=w[Q];a<0?a=0:a>1&&(a=1),K[Q]=255*a}w=K}var U=document.createElement("canvas");U.width=P,U.height=u;var p=U.getContext("2d");if(!p)return null;var r=p.createImageData(P,u);if(r.data.set(w),p.putImageData(r,0,0),I){var Y=document.createElement("canvas");Y.width=P,Y.height=u;var g=Y.getContext("2d");return g?(g.translate(0,u),g.scale(1,-1),g.drawImage(U,0,0),Y.toDataURL("image/png")):null}return U.toDataURL("image/png")}function R(w,v,I){void 0===v&&(v=0),void 0===I&&(I=0);var P=w.getInternalTexture();if(!P)return null;var u=w._readPixelsSync(v,I);return u?l(u,w.getSize(),P.invertY):null}function x(w,v,I){return void 0===v&&(v=0),void 0===I&&(I=0),(0,P.h)(this,void 0,void 0,(function(){var u,Q;return(0,P.p)(this,(function(P){switch(P.label){case 0:return(u=w.getInternalTexture())?[4,w.readPixels(v,I)]:[2,null];case 1:return(Q=P.sent())?[2,l(Q,w.getSize(),u.invertY)]:[2,null]}}))}))}var j=I(20334),s=function(w){function v(I,P,u,K,a,U,p,Y,g,J,l,R,x,s){void 0===a&&(a=v.TRILINEAR_SAMPLINGMODE),void 0===U&&(U=null),void 0===p&&(p=null),void 0===Y&&(Y=null),void 0===g&&(g=!1);var B,t,i,z,E,o,h,n,W,V,F=this;(F=w.call(this,P)||this).url=null,F.uOffset=0,F.vOffset=0,F.uScale=1,F.vScale=1,F.uAng=0,F.vAng=0,F.wAng=0,F.uRotationCenter=.5,F.vRotationCenter=.5,F.wRotationCenter=.5,F.homogeneousRotationInUVTransform=!1,F.inspectableCustomProperties=null,F._noMipmap=!1,F._invertY=!1,F._rowGenerationMatrix=null,F._cachedTextureMatrix=null,F._projectionModeMatrix=null,F._t0=null,F._t1=null,F._t2=null,F._cachedUOffset=-1,F._cachedVOffset=-1,F._cachedUScale=0,F._cachedVScale=0,F._cachedUAng=-1,F._cachedVAng=-1,F._cachedWAng=-1,F._cachedProjectionMatrixId=-1,F._cachedURotationCenter=-1,F._cachedVRotationCenter=-1,F._cachedWRotationCenter=-1,F._cachedHomogeneousRotationInUVTransform=!1,F._cachedCoordinatesMode=-1,F._buffer=null,F._deleteBuffer=!1,F._format=null,F._delayedOnLoad=null,F._delayedOnError=null,F.onLoadObservable=new Q.c,F._isBlocking=!0,F.name=I||"",F.url=I;var O=!1,N=null;"object"===typeof u&&null!==u?(V=null!==(B=u.noMipmap)&&void 0!==B&&B,K=null!==(t=u.invertY)&&void 0!==t?t:!j.e.UseOpenGLOrientationForUV,a=null!==(i=u.samplingMode)&&void 0!==i?i:v.TRILINEAR_SAMPLINGMODE,U=null!==(z=u.onLoad)&&void 0!==z?z:null,p=null!==(E=u.onError)&&void 0!==E?E:null,Y=null!==(o=u.buffer)&&void 0!==o?o:null,g=null!==(h=u.deleteBuffer)&&void 0!==h&&h,J=u.format,l=u.mimeType,R=u.loaderOptions,x=u.creationFlags,O=null!==(n=u.useSRGBBuffer)&&void 0!==n&&n,N=null!==(W=u.internalTexture)&&void 0!==W?W:null):V=!!u,F._noMipmap=V,F._invertY=void 0===K?!j.e.UseOpenGLOrientationForUV:K,F._initialSamplingMode=a,F._buffer=Y,F._deleteBuffer=g,F._mimeType=l,F._loaderOptions=R,F._creationFlags=x,F._useSRGBBuffer=O,F._forcedExtension=s,J&&(F._format=J);var q=F.getScene(),m=F._getEngine();if(!m)return F;m.onBeforeTextureInitObservable.notifyObservers(F);var c=function(){F._texture&&(F._texture._invertVScale&&(F.vScale*=-1,F.vOffset+=1),null!==F._texture._cachedWrapU&&(F.wrapU=F._texture._cachedWrapU,F._texture._cachedWrapU=null),null!==F._texture._cachedWrapV&&(F.wrapV=F._texture._cachedWrapV,F._texture._cachedWrapV=null),null!==F._texture._cachedWrapR&&(F.wrapR=F._texture._cachedWrapR,F._texture._cachedWrapR=null)),F.onLoadObservable.hasObservers()&&F.onLoadObservable.notifyObservers(F),U&&U(),!F.isBlocking&&q&&q.resetCachedMaterial()},M=function(w,I){F._loadingError=!0,F._errorObject={message:w,exception:I},p&&p(w,I),v.OnTextureLoadErrorObservable.notifyObservers(F)};if(!F.url)return F._delayedOnLoad=c,F._delayedOnError=M,F;if(F._texture=null!==N&&void 0!==N?N:F._getFromCache(F.url,V,a,F._invertY,O),F._texture)if(F._texture.isReady)r.e.SetImmediate((function(){return c()}));else{var S=F._texture.onLoadedObservable.add(c);F._texture.onErrorObservable.add((function(w){var v;M(w.message,w.exception),null===(v=F._texture)||void 0===v||v.onLoadedObservable.remove(S)}))}else if(q&&q.useDelayedTextureLoading)F.delayLoadState=4,F._delayedOnLoad=c,F._delayedOnError=M;else{try{F._texture=m.createTexture(F.url,V,F._invertY,q,a,c,M,F._buffer,void 0,F._format,F._forcedExtension,l,R,x,O)}catch(w){throw M("error loading",w),w}g&&(F._buffer=null)}return F}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(w){this._isBlocking=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),v.prototype.updateURL=function(w,v,I,P){void 0===v&&(v=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!this.name.startsWith("data:")||(this.name=w),this.url=w,this._buffer=v,this._forcedExtension=P,this.delayLoadState=4,I&&(this._delayedOnLoad=I),this.delayLoad()},v.prototype.delayLoad=function(){if(4===this.delayLoadState){var w=this.getScene();w&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?r.e.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=w.getEngine().createTexture(this.url,this._noMipmap,this._invertY,w,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},v.prototype._prepareRowForTextureGeneration=function(w,v,I,P){w*=this._cachedUScale,v*=this._cachedVScale,w-=this.uRotationCenter*this._cachedUScale,v-=this.vRotationCenter*this._cachedVScale,I-=this.wRotationCenter,K.l.TransformCoordinatesFromFloatsToRef(w,v,I,this._rowGenerationMatrix,P),P.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,P.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,P.z+=this.wRotationCenter},v.prototype.checkTransformsAreIdentical=function(w){return null!==w&&this.uOffset===w.uOffset&&this.vOffset===w.vOffset&&this.uScale===w.uScale&&this.vScale===w.vScale&&this.uAng===w.uAng&&this.vAng===w.vAng&&this.wAng===w.wAng},v.prototype.getTextureMatrix=function(w){var v=this;if(void 0===w&&(w=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*w===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*w,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=K.e.Zero(),this._rowGenerationMatrix=new K.e,this._t0=K.l.Zero(),this._t1=K.l.Zero(),this._t2=K.l.Zero()),K.e.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(K.e.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,K.i.Matrix[0]),K.e.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,K.i.Matrix[1]),K.e.ScalingToRef(this._cachedUScale,this._cachedVScale,0,K.i.Matrix[2]),K.e.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,K.i.Matrix[3]),K.i.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(K.i.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(K.i.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(K.i.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),K.e.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var I=this.getScene();return I?(I.markAllMaterialsAsDirty(1,(function(w){return w.hasTexture(v)})),this._cachedTextureMatrix):this._cachedTextureMatrix},v.prototype.getReflectionTextureMatrix=function(){var w=this,I=this.getScene();if(!I)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==v.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===I.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}this._cachedTextureMatrix||(this._cachedTextureMatrix=K.e.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=K.e.Zero());var P=this._cachedCoordinatesMode!==this.coordinatesMode;switch(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case v.PLANAR_MODE:K.e.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case v.PROJECTION_MODE:K.e.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var u=I.getProjectionMatrix();this._cachedProjectionMatrixId=u.updateFlag,u.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:K.e.IdentityToRef(this._cachedTextureMatrix)}return P&&I.markAllMaterialsAsDirty(1,(function(v){return-1!==v.getActiveTextures().indexOf(w)})),this._cachedTextureMatrix},v.prototype.clone=function(){var w=this,I={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return u.e.Clone((function(){return new v(w._texture?w._texture.url:null,w.getScene(),I)}),this)},v.prototype.serialize=function(){var I=this.name;v.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");var P=w.prototype.serialize.call(this);return P?((v.SerializeBuffers||v.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(P.base64String=this._buffer,P.name=P.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?P.base64String="data:image/png;base64,"+(0,J.h)(this._buffer):(v.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(P.base64String=!this._engine||this._engine._features.supportSyncTextureRead?R(this):x(this))),P.invertY=this._invertY,P.samplingMode=this.samplingMode,P._creationFlags=this._creationFlags,P._useSRGBBuffer=this._useSRGBBuffer,this.name=I,P):null},v.prototype.getClassName=function(){return"Texture"},v.prototype.dispose=function(){w.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},v.Parse=function(w,I,P){if(w.customType){var Q=Y.e.Instantiate(w.customType).Parse(w,I,P);return w.samplingMode&&Q.updateSamplingMode&&Q._samplingMode&&Q._samplingMode!==w.samplingMode&&Q.updateSamplingMode(w.samplingMode),Q}if(w.isCube&&!w.isRenderTarget)return v._CubeTextureParser(w,I,P);if(!w.name&&!w.isRenderTarget)return null;var K=function(){if(a&&a._texture&&(a._texture._cachedWrapU=null,a._texture._cachedWrapV=null,a._texture._cachedWrapR=null),w.samplingMode){var v=w.samplingMode;a&&a.samplingMode!==v&&a.updateSamplingMode(v)}if(a&&w.animations)for(var I=0;I<w.animations.length;I++){var P=w.animations[I],u=(0,U.c)("BABYLON.Animation");u&&a.animations.push(u.Parse(P))}},a=u.e.Parse((function(){var u,Q,a,U,p=!0;if(w.noMipmap&&(p=!1),w.mirrorPlane){var r=v._CreateMirror(w.name,w.renderTargetSize,I,p);return r._waitingRenderList=w.renderList,r.mirrorPlane=g.e.FromArray(w.mirrorPlane),K(),r}if(w.isRenderTarget){var Y=null;if(w.isCube){if(I.reflectionProbes)for(var J=0;J<I.reflectionProbes.length;J++){var l=I.reflectionProbes[J];if(l.name===w.name)return l.cubeTexture}}else(Y=v._CreateRenderTargetTexture(w.name,w.renderTargetSize,I,p,null!==(u=w._creationFlags)&&void 0!==u?u:0))._waitingRenderList=w.renderList;return K(),Y}if(w.base64String)U=v.CreateFromBase64String(w.base64String,w.name,I,!p,w.invertY,w.samplingMode,K,null!==(Q=w._creationFlags)&&void 0!==Q?Q:0,null!==(a=w._useSRGBBuffer)&&void 0!==a&&a);else{var R=void 0;R=w.name&&w.name.indexOf("://")>0?w.name:P+w.name,w.url&&(w.url.startsWith("data:")||v.UseSerializedUrlIfAny)&&(R=w.url),U=new v(R,I,!p,w.invertY,w.samplingMode,K)}return U}),w,I);return a},v.CreateFromBase64String=function(w,I,P,u,Q,K,a,U,p,r){return void 0===K&&(K=v.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===U&&(U=null),void 0===p&&(p=5),new v("data:"+I,P,u,Q,K,a,U,w,!1,p,void 0,void 0,r)},v.LoadFromDataString=function(w,I,P,u,Q,K,a,U,p,r,Y){return void 0===u&&(u=!1),void 0===K&&(K=!0),void 0===a&&(a=v.TRILINEAR_SAMPLINGMODE),void 0===U&&(U=null),void 0===p&&(p=null),void 0===r&&(r=5),"data:"!==w.substr(0,5)&&(w="data:"+w),new v(w,P,Q,K,a,U,p,I,u,r,void 0,void 0,Y)},v.SerializeBuffers=!0,v.ForceSerializeBuffers=!1,v.OnTextureLoadErrorObservable=new Q.c,v._CubeTextureParser=function(w,v,I){throw(0,p.e)("CubeTexture")},v._CreateMirror=function(w,v,I,P){throw(0,p.e)("MirrorTexture")},v._CreateRenderTargetTexture=function(w,v,I,P,u){throw(0,p.e)("RenderTargetTexture")},v.NEAREST_SAMPLINGMODE=1,v.NEAREST_NEAREST_MIPLINEAR=8,v.BILINEAR_SAMPLINGMODE=2,v.LINEAR_LINEAR_MIPNEAREST=11,v.TRILINEAR_SAMPLINGMODE=3,v.LINEAR_LINEAR_MIPLINEAR=3,v.NEAREST_NEAREST_MIPNEAREST=4,v.NEAREST_LINEAR_MIPNEAREST=5,v.NEAREST_LINEAR_MIPLINEAR=6,v.NEAREST_LINEAR=7,v.NEAREST_NEAREST=1,v.LINEAR_NEAREST_MIPNEAREST=9,v.LINEAR_NEAREST_MIPLINEAR=10,v.LINEAR_LINEAR=2,v.LINEAR_NEAREST=12,v.EXPLICIT_MODE=0,v.SPHERICAL_MODE=1,v.PLANAR_MODE=2,v.CUBIC_MODE=3,v.PROJECTION_MODE=4,v.SKYBOX_MODE=5,v.INVCUBIC_MODE=6,v.EQUIRECTANGULAR_MODE=7,v.FIXED_EQUIRECTANGULAR_MODE=8,v.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,v.CLAMP_ADDRESSMODE=0,v.WRAP_ADDRESSMODE=1,v.MIRROR_ADDRESSMODE=2,v.UseSerializedUrlIfAny=!1,(0,P.i)([(0,u.J)()],v.prototype,"url",void 0),(0,P.i)([(0,u.J)()],v.prototype,"uOffset",void 0),(0,P.i)([(0,u.J)()],v.prototype,"vOffset",void 0),(0,P.i)([(0,u.J)()],v.prototype,"uScale",void 0),(0,P.i)([(0,u.J)()],v.prototype,"vScale",void 0),(0,P.i)([(0,u.J)()],v.prototype,"uAng",void 0),(0,P.i)([(0,u.J)()],v.prototype,"vAng",void 0),(0,P.i)([(0,u.J)()],v.prototype,"wAng",void 0),(0,P.i)([(0,u.J)()],v.prototype,"uRotationCenter",void 0),(0,P.i)([(0,u.J)()],v.prototype,"vRotationCenter",void 0),(0,P.i)([(0,u.J)()],v.prototype,"wRotationCenter",void 0),(0,P.i)([(0,u.J)()],v.prototype,"homogeneousRotationInUVTransform",void 0),(0,P.i)([(0,u.J)()],v.prototype,"isBlocking",null),v}(a.c);(0,U.g)("BABYLON.Texture",s),u.e._TextureParser=s.Parse},80150:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return Object.defineProperty(w.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(w){this._cachedWrapU=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(w){this._cachedWrapV=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(w){this._cachedWrapR=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(w){this._cachedAnisotropicFilteringLevel=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(w){this._comparisonFunction=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(w){this._useMipMaps=w},enumerable:!1,configurable:!0}),w.prototype.setParameters=function(w,v,I,P,u,Q){return void 0===w&&(w=1),void 0===v&&(v=1),void 0===I&&(I=1),void 0===P&&(P=1),void 0===u&&(u=2),void 0===Q&&(Q=0),this._cachedWrapU=w,this._cachedWrapV=v,this._cachedWrapR=I,this._cachedAnisotropicFilteringLevel=P,this.samplingMode=u,this._comparisonFunction=Q,this},w.prototype.compareSampler=function(w){return this._cachedWrapU===w._cachedWrapU&&this._cachedWrapV===w._cachedWrapV&&this._cachedWrapR===w._cachedWrapR&&this._cachedAnisotropicFilteringLevel===w._cachedAnisotropicFilteringLevel&&this.samplingMode===w.samplingMode&&this._comparisonFunction===w._comparisonFunction&&this._useMipMaps===w._useMipMaps},w}()},61803:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(w,v){void 0===v&&(v=!0),this.effect=null,this.defines=null,this.drawContext=w.createDrawContext(),v&&(this.materialContext=w.createMaterialContext())}return w.IsWrapper=function(w){return void 0===w.getPipelineContext},w.GetEffect=function(w){return void 0===w.getPipelineContext?w.effect:w},w.prototype.setEffect=function(w,v,I){var P;void 0===I&&(I=!0),this.effect=w,void 0!==v&&(this.defines=v),I&&(null===(P=this.drawContext)||void 0===P||P.reset())},w.prototype.dispose=function(){var w;null===(w=this.drawContext)||void 0===w||w.dispose()},w}()},90559:function(w,v,I){"use strict";I.d(v,{b:function(){return p}});var P=I(9271),u=I(60985),Q=I(9127),K=I(42647),a=I(16179),U=I(56591),p=function(){function w(v,I,Q,p,r,Y,g,J,l,R,x,j){void 0===p&&(p=null),void 0===Y&&(Y=null),void 0===g&&(g=null),void 0===J&&(J=null),void 0===l&&(l=null),void 0===x&&(x=""),void 0===j&&(j=U.d.GLSL);var s,B,t,i=this;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new P.c,this.onErrorObservable=new P.c,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._wasPreviouslyUsingInstances=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=v,this._key=x;var z,E,o=void 0,h=null;if(I.attributes){var n=I;if(this._engine=Q,this._attributesNames=n.attributes,this._uniformsNames=n.uniformsNames.concat(n.samplers),this._samplerList=n.samplers.slice(),this.defines=n.defines,this.onError=n.onError,this.onCompiled=n.onCompiled,this._fallbacks=n.fallbacks,this._indexParameters=n.indexParameters,this._transformFeedbackVaryings=n.transformFeedbackVaryings||null,this._multiTarget=!!n.multiTarget,this._shaderLanguage=null!==(s=n.shaderLanguage)&&void 0!==s?s:U.d.GLSL,n.uniformBuffersNames){this._uniformBuffersNamesList=n.uniformBuffersNames.slice();for(var W=0;W<n.uniformBuffersNames.length;W++)this._uniformBuffersNames[n.uniformBuffersNames[W]]=W}h=null!==(B=n.processFinalCode)&&void 0!==B?B:null,o=null!==(t=n.processCodeAfterIncludes)&&void 0!==t?t:void 0}else this._engine=r,this.defines=null==Y?"":Y,this._uniformsNames=Q.concat(p),this._samplerList=p?p.slice():[],this._attributesNames=I,this._uniformBuffersNamesList=[],this._shaderLanguage=j,this.onError=l,this.onCompiled=J,this._indexParameters=R,this._fallbacks=g;this._attributeLocationByName={},this.uniqueId=w._UniqueIdSeed++;var V=(0,u.r)()?this._engine.getHostDocument():null;v.vertexSource?z="source:"+v.vertexSource:v.vertexElement?(z=V?V.getElementById(v.vertexElement):null)||(z=v.vertexElement):z=v.vertex||v,v.fragmentSource?E="source:"+v.fragmentSource:v.fragmentElement?(E=V?V.getElementById(v.fragmentElement):null)||(E=v.fragmentElement):E=v.fragment||v,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var F={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:a.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:a.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:o},O=[void 0,void 0],N=function(){if(O[0]&&O[1]){F.isFragment=!0;var w=O[0],I=O[1];K.c.Process(I,F,(function(I){h&&(I=h("fragment",I));var P=K.c.Finalize(w,I,F);i._useFinalCode(P.vertexCode,P.fragmentCode,v)}),i._engine)}};this._loadShader(z,"Vertex","",(function(w){K.c.Initialize(F),K.c.Process(w,F,(function(v){i._rawVertexSourceCode=w,h&&(v=h("vertex",v)),O[0]=v,N()}),i._engine)})),this._loadShader(E,"Fragment","Pixel",(function(w){i._rawFragmentSourceCode=w,O[1]=w,N()}))}return Object.defineProperty(w,"ShadersRepository",{get:function(){return a.c.ShadersRepository},set:function(w){a.c.ShadersRepository=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new P.c),this._onBindObservable},enumerable:!1,configurable:!0}),w.prototype._useFinalCode=function(w,v,I){if(I){var P=I.vertexElement||I.vertex||I.spectorName||I,u=I.fragmentElement||I.fragment||I.spectorName||I;this._vertexSourceCode=(this._shaderLanguage===U.d.WGSL?"//":"")+"#define SHADER_NAME vertex:"+P+"\n"+w,this._fragmentSourceCode=(this._shaderLanguage===U.d.WGSL?"//":"")+"#define SHADER_NAME fragment:"+u+"\n"+v}else this._vertexSourceCode=w,this._fragmentSourceCode=v;this._prepareEffect()},Object.defineProperty(w.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),w.prototype.isReady=function(){try{return this._isReadyInternal()}catch(w){return!1}},w.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},w.prototype.getEngine=function(){return this._engine},w.prototype.getPipelineContext=function(){return this._pipelineContext},w.prototype.getAttributesNames=function(){return this._attributesNames},w.prototype.getAttributeLocation=function(w){return this._attributes[w]},w.prototype.getAttributeLocationByName=function(w){return this._attributeLocationByName[w]},w.prototype.getAttributesCount=function(){return this._attributes.length},w.prototype.getUniformIndex=function(w){return this._uniformsNames.indexOf(w)},w.prototype.getUniform=function(w){return this._uniforms[w]},w.prototype.getSamplers=function(){return this._samplerList},w.prototype.getUniformNames=function(){return this._uniformsNames},w.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},w.prototype.getIndexParameters=function(){return this._indexParameters},w.prototype.getCompilationError=function(){return this._compilationError},w.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},w.prototype.executeWhenCompiled=function(w){var v=this;this.isReady()?w(this):(this.onCompileObservable.add((function(v){w(v)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){v._checkIsReady(null)}),16))},w.prototype._checkIsReady=function(w){var v=this;try{if(this._isReadyInternal())return}catch(v){return void this._processCompilationErrors(v,w)}this._isDisposed||setTimeout((function(){v._checkIsReady(w)}),16)},w.prototype._loadShader=function(w,v,I,P){if("undefined"!==typeof HTMLElement&&w instanceof HTMLElement)return void P((0,u.i)(w));if("source:"!==w.substr(0,7))if("base64:"!==w.substr(0,7)){var Q,K=a.c.GetShadersStore(this._shaderLanguage);if(K[w+v+"Shader"])P(K[w+v+"Shader"]);else if(I&&K[w+I+"Shader"])P(K[w+I+"Shader"]);else Q="."===w[0]||"/"===w[0]||w.indexOf("http")>-1?w:a.c.GetShadersRepository(this._shaderLanguage)+w,this._engine._loadFile(Q+"."+v.toLowerCase()+".fx",P)}else{P(window.atob(w.substr(7)))}else P(w.substr(7))},Object.defineProperty(w.prototype,"vertexSourceCode",{get:function(){var w,v;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(v=null===(w=this._pipelineContext)||void 0===w?void 0:w._getVertexShaderCode())&&void 0!==v?v:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"fragmentSourceCode",{get:function(){var w,v;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(v=null===(w=this._pipelineContext)||void 0===w?void 0:w._getFragmentShaderCode())&&void 0!==v?v:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),w.prototype._rebuildProgram=function(w,v,I,P){var u=this;this._isReady=!1,this._vertexSourceCodeOverride=w,this._fragmentSourceCodeOverride=v,this.onError=function(w,v){P&&P(v)},this.onCompiled=function(){var w=u.getEngine().scenes;if(w)for(var v=0;v<w.length;v++)w[v].markAllMaterialsAsDirty(63);u._pipelineContext._handlesSpectorRebuildCallback(I)},this._fallbacks=null,this._prepareEffect()},w.prototype._prepareEffect=function(){var w=this,v=this._attributesNames,I=this.defines,P=this._pipelineContext;this._isReady=!1;try{var u=this._engine;this._pipelineContext=u.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var Q=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?u._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,Q,null,this._transformFeedbackVaryings,this._key):u._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,Q,I,this._transformFeedbackVaryings,this._key),u._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(w._attributes=[],w._pipelineContext._fillEffectInformation(w,w._uniformBuffersNames,w._uniformsNames,w._uniforms,w._samplerList,w._samplers,v,w._attributes),v)for(var I=0;I<v.length;I++){var Q=v[I];w._attributeLocationByName[Q]=w._attributes[I]}u.bindSamplers(w),w._compilationError="",w._isReady=!0,w.onCompiled&&w.onCompiled(w),w.onCompileObservable.notifyObservers(w),w.onCompileObservable.clear(),w._fallbacks&&w._fallbacks.unBindMesh(),P&&w.getEngine()._deletePipelineContext(P)})),this._pipelineContext.isAsync&&this._checkIsReady(P)}catch(w){this._processCompilationErrors(w,P)}},w.prototype._getShaderCodeAndErrorLine=function(w,v,I){var P=I?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,u=null;if(v&&w){var Q=v.match(P);if(Q&&2===Q.length){var K=parseInt(Q[1]),a=w.split("\n",-1);a.length>=K&&(u="Offending line [".concat(K,"] in ").concat(I?"fragment":"vertex"," code: ").concat(a[K-1]))}}return[w,u]},w.prototype._processCompilationErrors=function(v,I){var P,u,K,a,U;void 0===I&&(I=null),this._compilationError=v.message;var p=this._attributesNames,r=this._fallbacks;if(Q.e.Error("Unable to compile effect:"),Q.e.Error("Uniforms: "+this._uniformsNames.map((function(w){return" "+w}))),Q.e.Error("Attributes: "+p.map((function(w){return" "+w}))),Q.e.Error("Defines:\r\n"+this.defines),w.LogShaderCodeOnCompilationError){var Y=null,g=null,J=null;(null===(K=this._pipelineContext)||void 0===K?void 0:K._getVertexShaderCode())&&(J=(P=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],Y=P[1],J&&(Q.e.Error("Vertex code:"),Q.e.Error(J))),(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode())&&(J=(u=this._getShaderCodeAndErrorLine(null===(U=this._pipelineContext)||void 0===U?void 0:U._getFragmentShaderCode(),this._compilationError,!0))[0],g=u[1],J&&(Q.e.Error("Fragment code:"),Q.e.Error(J))),Y&&Q.e.Error(Y),g&&Q.e.Error(g)}Q.e.Error("Error: "+this._compilationError),I&&(this._pipelineContext=I,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),r?(this._pipelineContext=null,r.hasMoreFallbacks?(this._allFallbacksProcessed=!1,Q.e.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(w.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),w.prototype._bindTexture=function(w,v){this._engine._bindTexture(this._samplers[w],v,w)},w.prototype.setTexture=function(w,v){this._engine.setTexture(this._samplers[w],this._uniforms[w],v,w)},w.prototype.setDepthStencilTexture=function(w,v){this._engine.setDepthStencilTexture(this._samplers[w],this._uniforms[w],v,w)},w.prototype.setTextureArray=function(w,v){var I=w+"Ex";if(-1===this._samplerList.indexOf(I+"0")){for(var P=this._samplerList.indexOf(w),u=1;u<v.length;u++){var Q=I+(u-1).toString();this._samplerList.splice(P+u,0,Q)}for(var K=0,a=0,U=this._samplerList;a<U.length;a++){var p=U[a];this._samplers[p]=K,K+=1}}this._engine.setTextureArray(this._samplers[w],this._uniforms[w],v,w)},w.prototype.setTextureFromPostProcess=function(w,v){this._engine.setTextureFromPostProcess(this._samplers[w],v,w)},w.prototype.setTextureFromPostProcessOutput=function(w,v){this._engine.setTextureFromPostProcessOutput(this._samplers[w],v,w)},w.prototype.bindUniformBuffer=function(v,I){var P=this._uniformBuffersNames[I];void 0===P||w._BaseCache[P]===v&&this._engine._features.useUBOBindingCache||(w._BaseCache[P]=v,this._engine.bindUniformBufferBase(v,P,I))},w.prototype.bindUniformBlock=function(w,v){this._engine.bindUniformBlock(this._pipelineContext,w,v)},w.prototype.setInt=function(w,v){return this._pipelineContext.setInt(w,v),this},w.prototype.setInt2=function(w,v,I){return this._pipelineContext.setInt2(w,v,I),this},w.prototype.setInt3=function(w,v,I,P){return this._pipelineContext.setInt3(w,v,I,P),this},w.prototype.setInt4=function(w,v,I,P,u){return this._pipelineContext.setInt4(w,v,I,P,u),this},w.prototype.setIntArray=function(w,v){return this._pipelineContext.setIntArray(w,v),this},w.prototype.setIntArray2=function(w,v){return this._pipelineContext.setIntArray2(w,v),this},w.prototype.setIntArray3=function(w,v){return this._pipelineContext.setIntArray3(w,v),this},w.prototype.setIntArray4=function(w,v){return this._pipelineContext.setIntArray4(w,v),this},w.prototype.setFloatArray=function(w,v){return this._pipelineContext.setArray(w,v),this},w.prototype.setFloatArray2=function(w,v){return this._pipelineContext.setArray2(w,v),this},w.prototype.setFloatArray3=function(w,v){return this._pipelineContext.setArray3(w,v),this},w.prototype.setFloatArray4=function(w,v){return this._pipelineContext.setArray4(w,v),this},w.prototype.setArray=function(w,v){return this._pipelineContext.setArray(w,v),this},w.prototype.setArray2=function(w,v){return this._pipelineContext.setArray2(w,v),this},w.prototype.setArray3=function(w,v){return this._pipelineContext.setArray3(w,v),this},w.prototype.setArray4=function(w,v){return this._pipelineContext.setArray4(w,v),this},w.prototype.setMatrices=function(w,v){return this._pipelineContext.setMatrices(w,v),this},w.prototype.setMatrix=function(w,v){return this._pipelineContext.setMatrix(w,v),this},w.prototype.setMatrix3x3=function(w,v){return this._pipelineContext.setMatrix3x3(w,v),this},w.prototype.setMatrix2x2=function(w,v){return this._pipelineContext.setMatrix2x2(w,v),this},w.prototype.setFloat=function(w,v){return this._pipelineContext.setFloat(w,v),this},w.prototype.setBool=function(w,v){return this._pipelineContext.setInt(w,v?1:0),this},w.prototype.setVector2=function(w,v){return this._pipelineContext.setVector2(w,v),this},w.prototype.setFloat2=function(w,v,I){return this._pipelineContext.setFloat2(w,v,I),this},w.prototype.setVector3=function(w,v){return this._pipelineContext.setVector3(w,v),this},w.prototype.setFloat3=function(w,v,I,P){return this._pipelineContext.setFloat3(w,v,I,P),this},w.prototype.setVector4=function(w,v){return this._pipelineContext.setVector4(w,v),this},w.prototype.setQuaternion=function(w,v){return this._pipelineContext.setQuaternion(w,v),this},w.prototype.setFloat4=function(w,v,I,P,u){return this._pipelineContext.setFloat4(w,v,I,P,u),this},w.prototype.setColor3=function(w,v){return this._pipelineContext.setColor3(w,v),this},w.prototype.setColor4=function(w,v,I){return this._pipelineContext.setColor4(w,v,I),this},w.prototype.setDirectColor4=function(w,v){return this._pipelineContext.setDirectColor4(w,v),this},w.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0},w.RegisterShader=function(w,v,I,P){void 0===P&&(P=U.d.GLSL),v&&(a.c.GetShadersStore(P)["".concat(w,"PixelShader")]=v),I&&(a.c.GetShadersStore(P)["".concat(w,"VertexShader")]=I)},w.ResetCache=function(){w._BaseCache={}},w.LogShaderCodeOnCompilationError=!0,w._UniqueIdSeed=0,w._BaseCache={},w.ShadersStore=a.c.ShadersStore,w.IncludesShadersStore=a.c.IncludesShadersStore,w}()},54497:function(w,v,I){"use strict";I.d(v,{b:function(){return P}});var P=function(){function w(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return w.prototype.unBindMesh=function(){this._mesh=null},w.prototype.addFallback=function(w,v){this._defines[w]||(w<this._currentRank&&(this._currentRank=w),w>this._maxRank&&(this._maxRank=w),this._defines[w]=new Array),this._defines[w].push(v)},w.prototype.addCPUSkinningFallback=function(w,v){this._mesh=v,w<this._currentRank&&(this._currentRank=w),w>this._maxRank&&(this._maxRank=w)},Object.defineProperty(w.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!1,configurable:!0}),w.prototype.reduce=function(w,v){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,w=w.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),v._bonesComputationForcedToCPU=!0;for(var I=this._mesh.getScene(),P=0;P<I.meshes.length;P++){var u=I.meshes[P];if(u.material){if(u.computeBonesUsingShaders&&0!==u.numBoneInfluencers)if(u.material.getEffect()===v)u.computeBonesUsingShaders=!1;else if(u.subMeshes)for(var Q=0,K=u.subMeshes;Q<K.length;Q++){if(K[Q].effect===v){u.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&u.computeBonesUsingShaders&&u.numBoneInfluencers>0&&(u.computeBonesUsingShaders=!1)}}else{var a=this._defines[this._currentRank];if(a)for(P=0;P<a.length;P++)w=w.replace("#define "+a[P],"");this._currentRank++}return w},w}()},23016:function(w,v,I){"use strict";I.d(v,{e:function(){return Y},d:function(){return r}});var P=I(78502),u=I(9892),Q=I(9271),K=I(9217),a=I(9488),U=I(4241),p=function(){function w(){this._dirty=!0,this._tempColor=new a.f(0,0,0,0),this._globalCurve=new a.f(0,0,0,0),this._highlightsCurve=new a.f(0,0,0,0),this._midtonesCurve=new a.f(0,0,0,0),this._shadowsCurve=new a.f(0,0,0,0),this._positiveCurve=new a.f(0,0,0,0),this._negativeCurve=new a.f(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(w.prototype,"globalHue",{get:function(){return this._globalHue},set:function(w){this._globalHue=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(w){this._globalDensity=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(w){this._globalSaturation=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(w){this._globalExposure=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(w){this._highlightsHue=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(w){this._highlightsDensity=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(w){this._highlightsSaturation=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(w){this._highlightsExposure=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(w){this._midtonesHue=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(w){this._midtonesDensity=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(w){this._midtonesSaturation=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(w){this._midtonesExposure=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(w){this._shadowsHue=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(w){this._shadowsDensity=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(w){this._shadowsSaturation=w,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(w){this._shadowsExposure=w,this._dirty=!0},enumerable:!1,configurable:!0}),w.prototype.getClassName=function(){return"ColorCurves"},w.Bind=function(w,v,I,P,u){void 0===I&&(I="vCameraColorCurvePositive"),void 0===P&&(P="vCameraColorCurveNeutral"),void 0===u&&(u="vCameraColorCurveNegative"),w._dirty&&(w._dirty=!1,w._getColorGradingDataToRef(w._globalHue,w._globalDensity,w._globalSaturation,w._globalExposure,w._globalCurve),w._getColorGradingDataToRef(w._highlightsHue,w._highlightsDensity,w._highlightsSaturation,w._highlightsExposure,w._tempColor),w._tempColor.multiplyToRef(w._globalCurve,w._highlightsCurve),w._getColorGradingDataToRef(w._midtonesHue,w._midtonesDensity,w._midtonesSaturation,w._midtonesExposure,w._tempColor),w._tempColor.multiplyToRef(w._globalCurve,w._midtonesCurve),w._getColorGradingDataToRef(w._shadowsHue,w._shadowsDensity,w._shadowsSaturation,w._shadowsExposure,w._tempColor),w._tempColor.multiplyToRef(w._globalCurve,w._shadowsCurve),w._highlightsCurve.subtractToRef(w._midtonesCurve,w._positiveCurve),w._midtonesCurve.subtractToRef(w._shadowsCurve,w._negativeCurve)),v&&(v.setFloat4(I,w._positiveCurve.r,w._positiveCurve.g,w._positiveCurve.b,w._positiveCurve.a),v.setFloat4(P,w._midtonesCurve.r,w._midtonesCurve.g,w._midtonesCurve.b,w._midtonesCurve.a),v.setFloat4(u,w._negativeCurve.r,w._negativeCurve.g,w._negativeCurve.b,w._negativeCurve.a))},w.PrepareUniforms=function(w){w.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},w.prototype._getColorGradingDataToRef=function(v,I,P,u,Q){null!=v&&(v=w._Clamp(v,0,360),I=w._Clamp(I,-100,100),P=w._Clamp(P,-100,100),u=w._Clamp(u,-100,100),I=w._ApplyColorGradingSliderNonlinear(I),I*=.5,u=w._ApplyColorGradingSliderNonlinear(u),I<0&&(I*=-1,v=(v+180)%360),w._FromHSBToRef(v,I,50+.25*u,Q),Q.scaleToRef(2,Q),Q.a=1+.01*P)},w._ApplyColorGradingSliderNonlinear=function(w){w/=100;var v=Math.abs(w);return v=Math.pow(v,2),w<0&&(v*=-1),v*=100},w._FromHSBToRef=function(v,I,P,u){var Q=w._Clamp(v,0,360),K=w._Clamp(I/100,0,1),a=w._Clamp(P/100,0,1);if(0===K)u.r=a,u.g=a,u.b=a;else{Q/=60;var U=Math.floor(Q),p=Q-U,r=a*(1-K),Y=a*(1-K*p),g=a*(1-K*(1-p));switch(U){case 0:u.r=a,u.g=g,u.b=r;break;case 1:u.r=Y,u.g=a,u.b=r;break;case 2:u.r=r,u.g=a,u.b=g;break;case 3:u.r=r,u.g=Y,u.b=a;break;case 4:u.r=g,u.g=r,u.b=a;break;default:u.r=a,u.g=r,u.b=Y}}u.a=1},w._Clamp=function(w,v,I){return Math.min(Math.max(w,v),I)},w.prototype.clone=function(){return u.e.Clone((function(){return new w}),this)},w.prototype.serialize=function(){return u.e.Serialize(this)},w.Parse=function(v){return u.e.Parse((function(){return new w}),v,null,null)},(0,P.i)([(0,u.J)()],w.prototype,"_globalHue",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_globalDensity",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_globalSaturation",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_globalExposure",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_highlightsHue",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_highlightsDensity",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_highlightsSaturation",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_highlightsExposure",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_midtonesHue",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_midtonesDensity",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_midtonesSaturation",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_midtonesExposure",void 0),w}();u.e._ColorCurvesParser=p.Parse;var r=function(w){function v(){var v=w.call(this)||this;return v.IMAGEPROCESSING=!1,v.VIGNETTE=!1,v.VIGNETTEBLENDMODEMULTIPLY=!1,v.VIGNETTEBLENDMODEOPAQUE=!1,v.TONEMAPPING=!1,v.TONEMAPPING_ACES=!1,v.CONTRAST=!1,v.COLORCURVES=!1,v.COLORGRADING=!1,v.COLORGRADING3D=!1,v.SAMPLER3DGREENDEPTH=!1,v.SAMPLER3DBGRMAP=!1,v.IMAGEPROCESSINGPOSTPROCESS=!1,v.EXPOSURE=!1,v.SKIPFINALCOLORCLAMP=!1,v.rebuild(),v}return(0,P.m)(v,w),v}(U.b),Y=function(){function w(){this.colorCurves=new p,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=w.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new a.f(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=w.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new Q.c}return Object.defineProperty(w.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(w){this._colorCurvesEnabled!==w&&(this._colorCurvesEnabled=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(w){this._colorGradingTexture!==w&&(this._colorGradingTexture=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(w){this._colorGradingEnabled!==w&&(this._colorGradingEnabled=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(w){this._colorGradingWithGreenDepth!==w&&(this._colorGradingWithGreenDepth=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(w){this._colorGradingBGR!==w&&(this._colorGradingBGR=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"exposure",{get:function(){return this._exposure},set:function(w){this._exposure!==w&&(this._exposure=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(w){this._toneMappingEnabled!==w&&(this._toneMappingEnabled=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(w){this._toneMappingType!==w&&(this._toneMappingType=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"contrast",{get:function(){return this._contrast},set:function(w){this._contrast!==w&&(this._contrast=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(w){this._vignetteBlendMode!==w&&(this._vignetteBlendMode=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(w){this._vignetteEnabled!==w&&(this._vignetteEnabled=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"skipFinalColorClamp",{get:function(){return this._skipFinalColorClamp},set:function(w){this._skipFinalColorClamp!==w&&(this._skipFinalColorClamp=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(w){this._applyByPostProcess!==w&&(this._applyByPostProcess=w,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(w){this._isEnabled!==w&&(this._isEnabled=w,this._updateParameters())},enumerable:!1,configurable:!0}),w.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},w.prototype.getClassName=function(){return"ImageProcessingConfiguration"},w.PrepareUniforms=function(w,v){v.EXPOSURE&&w.push("exposureLinear"),v.CONTRAST&&w.push("contrast"),v.COLORGRADING&&w.push("colorTransformSettings"),v.VIGNETTE&&(w.push("vInverseScreenSize"),w.push("vignetteSettings1"),w.push("vignetteSettings2")),v.COLORCURVES&&p.PrepareUniforms(w)},w.PrepareSamplers=function(w,v){v.COLORGRADING&&w.push("txColorTransform")},w.prototype.prepareDefines=function(v,I){if(void 0===I&&(I=!1),I!==this.applyByPostProcess||!this._isEnabled)return v.VIGNETTE=!1,v.TONEMAPPING=!1,v.TONEMAPPING_ACES=!1,v.CONTRAST=!1,v.EXPOSURE=!1,v.COLORCURVES=!1,v.COLORGRADING=!1,v.COLORGRADING3D=!1,v.IMAGEPROCESSING=!1,v.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(v.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(v.VIGNETTE=this.vignetteEnabled,v.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===w._VIGNETTEMODE_MULTIPLY,v.VIGNETTEBLENDMODEOPAQUE=!v.VIGNETTEBLENDMODEMULTIPLY,v.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType===w.TONEMAPPING_ACES)v.TONEMAPPING_ACES=!0;else v.TONEMAPPING_ACES=!1;v.CONTRAST=1!==this.contrast,v.EXPOSURE=1!==this.exposure,v.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,v.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,v.COLORGRADING?v.COLORGRADING3D=this.colorGradingTexture.is3D:v.COLORGRADING3D=!1,v.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,v.SAMPLER3DBGRMAP=this.colorGradingBGR,v.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,v.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,v.IMAGEPROCESSING=v.VIGNETTE||v.TONEMAPPING||v.CONTRAST||v.EXPOSURE||v.COLORCURVES||v.COLORGRADING},w.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},w.prototype.bind=function(w,v){if(this._colorCurvesEnabled&&this.colorCurves&&p.Bind(this.colorCurves,w),this._vignetteEnabled){var I=1/w.getEngine().getRenderWidth(),P=1/w.getEngine().getRenderHeight();w.setFloat2("vInverseScreenSize",I,P);var u=null!=v?v:P/I,Q=Math.tan(.5*this.vignetteCameraFov),a=Q*u,U=Math.sqrt(a*Q);a=K.i.Mix(a,U,this.vignetteStretch),Q=K.i.Mix(Q,U,this.vignetteStretch),w.setFloat4("vignetteSettings1",a,Q,-a*this.vignetteCentreX,-Q*this.vignetteCentreY);var r=-2*this.vignetteWeight;w.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,r)}if(w.setFloat("exposureLinear",this.exposure),w.setFloat("contrast",this.contrast),this.colorGradingTexture){w.setTexture("txColorTransform",this.colorGradingTexture);var Y=this.colorGradingTexture.getSize().height;w.setFloat4("colorTransformSettings",(Y-1)/Y,.5/Y,Y,this.colorGradingTexture.level)}},w.prototype.clone=function(){return u.e.Clone((function(){return new w}),this)},w.prototype.serialize=function(){return u.e.Serialize(this)},w.Parse=function(v){return u.e.Parse((function(){return new w}),v,null,null)},Object.defineProperty(w,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(w,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),w.TONEMAPPING_STANDARD=0,w.TONEMAPPING_ACES=1,w._VIGNETTEMODE_MULTIPLY=0,w._VIGNETTEMODE_OPAQUE=1,(0,P.i)([(0,u.m)()],w.prototype,"colorCurves",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_colorCurvesEnabled",void 0),(0,P.i)([(0,u.B)("colorGradingTexture")],w.prototype,"_colorGradingTexture",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_colorGradingEnabled",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_colorGradingWithGreenDepth",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_colorGradingBGR",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_exposure",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_toneMappingEnabled",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_toneMappingType",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_contrast",void 0),(0,P.i)([(0,u.J)()],w.prototype,"vignetteStretch",void 0),(0,P.i)([(0,u.J)()],w.prototype,"vignetteCentreX",void 0),(0,P.i)([(0,u.J)()],w.prototype,"vignetteCentreY",void 0),(0,P.i)([(0,u.J)()],w.prototype,"vignetteWeight",void 0),(0,P.i)([(0,u.q)()],w.prototype,"vignetteColor",void 0),(0,P.i)([(0,u.J)()],w.prototype,"vignetteCameraFov",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_vignetteBlendMode",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_vignetteEnabled",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_skipFinalColorClamp",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_applyByPostProcess",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_isEnabled",void 0),w}();u.e._ImageProcessingConfigurationParser=Y.Parse},56513:function(w,v,I){"use strict";I.d(v,{b:function(){return Y}});var P=I(78502),u=I(46907),Q=I(9892),K=I(37001),a=I(33048),U=I(4241),p=I(96558),r=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.DETAIL=!1,v.DETAILDIRECTUV=0,v.DETAIL_NORMALBLENDMETHOD=0,v}return(0,P.m)(v,w),v}(U.b),Y=function(w){function v(v,I){void 0===I&&(I=!0);var P=w.call(this,v,"DetailMap",140,new r,I)||this;return P._texture=null,P.diffuseBlendLevel=1,P.roughnessBlendLevel=1,P.bumpLevel=1,P._normalBlendMethod=u.b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,P._isEnabled=!1,P.isEnabled=!1,P._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1],P}return(0,P.m)(v,w),v.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},v.prototype.isReadyForSubMesh=function(w,v,I){return!this._isEnabled||!(w._areTexturesDirty&&v.texturesEnabled&&I.getCaps().standardDerivatives&&this._texture&&K.d.DetailTextureEnabled&&!this._texture.isReady())},v.prototype.prepareDefines=function(w,v){if(this._isEnabled){w.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var I=v.getEngine();w._areTexturesDirty&&(I.getCaps().standardDerivatives&&this._texture&&K.d.DetailTextureEnabled&&this._isEnabled?(a.e.PrepareDefinesForMergedUV(this._texture,w,"DETAIL"),w.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):w.DETAIL=!1)}else w.DETAIL=!1},v.prototype.bindForSubMesh=function(w,v){if(this._isEnabled){var I=this._material.isFrozen;w.useUbo&&I&&w.isSync||this._texture&&K.d.DetailTextureEnabled&&(w.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),a.e.BindTextureMatrix(this._texture,w,"detail")),v.texturesEnabled&&this._texture&&K.d.DetailTextureEnabled&&w.setTexture("detailSampler",this._texture)}},v.prototype.hasTexture=function(w){return this._texture===w},v.prototype.getActiveTextures=function(w){this._texture&&w.push(this._texture)},v.prototype.getAnimatables=function(w){this._texture&&this._texture.animations&&this._texture.animations.length>0&&w.push(this._texture)},v.prototype.dispose=function(w){var v;w&&(null===(v=this._texture)||void 0===v||v.dispose())},v.prototype.getClassName=function(){return"DetailMapConfiguration"},v.prototype.getSamplers=function(w){w.push("detailSampler")},v.prototype.getUniforms=function(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}},(0,P.i)([(0,Q.B)("detailTexture"),(0,Q.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,P.i)([(0,Q.J)()],v.prototype,"diffuseBlendLevel",void 0),(0,P.i)([(0,Q.J)()],v.prototype,"roughnessBlendLevel",void 0),(0,P.i)([(0,Q.J)()],v.prototype,"bumpLevel",void 0),(0,P.i)([(0,Q.J)(),(0,Q.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"normalBlendMethod",void 0),(0,P.i)([(0,Q.J)(),(0,Q.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),v}(p.d)},46907:function(w,v,I){"use strict";I.d(v,{b:function(){return x}});var P=I(78502),u=I(9892),Q=I(9217),K=I(9271),a=I(78588),U=I(50384),p=I(90534),r=I(9127),Y=I(85567),g=I(33048),J=I(61803),l=function(){function w(){this.reset()}return w.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681},Object.defineProperty(w.prototype,"func",{get:function(){return this._func},set:function(w){this._func=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"funcRef",{get:function(){return this._funcRef},set:function(w){this._funcRef=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"funcMask",{get:function(){return this._funcMask},set:function(w){this._funcMask=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(w){this._opStencilFail=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(w){this._opDepthFail=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(w){this._opStencilDepthPass=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"mask",{get:function(){return this._mask},set:function(w){this._mask=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"enabled",{get:function(){return this._enabled},set:function(w){this._enabled=w},enumerable:!1,configurable:!0}),w.prototype.getClassName=function(){return"MaterialStencilState"},w.prototype.copyTo=function(w){u.e.Clone((function(){return w}),this)},w.prototype.serialize=function(){return u.e.Serialize(this)},w.prototype.parse=function(w,v,I){var P=this;u.e.Parse((function(){return P}),w,v,I)},(0,P.i)([(0,u.J)()],w.prototype,"func",null),(0,P.i)([(0,u.J)()],w.prototype,"funcRef",null),(0,P.i)([(0,u.J)()],w.prototype,"funcMask",null),(0,P.i)([(0,u.J)()],w.prototype,"opStencilFail",null),(0,P.i)([(0,u.J)()],w.prototype,"opDepthFail",null),(0,P.i)([(0,u.J)()],w.prototype,"opStencilDepthPass",null),(0,P.i)([(0,u.J)()],w.prototype,"mask",null),(0,P.i)([(0,u.J)()],w.prototype,"enabled",null),w}(),R=I(38956),x=function(){function w(v,I,P){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new K.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new l,this._useUBO=!1,this._fillMode=w.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=function(){},this._callbackPluginEventIsReadyForSubMesh=function(){},this._callbackPluginEventPrepareDefines=function(){},this._callbackPluginEventPrepareDefinesBeforeAttributes=function(){},this._callbackPluginEventHardBindForSubMesh=function(){},this._callbackPluginEventBindForSubMesh=function(){},this._callbackPluginEventHasRenderTargetTextures=function(){},this._callbackPluginEventFillRenderTargetTextures=function(){},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=v;var u=I||a.e.LastCreatedScene;u&&(this._scene=u,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=v||Q.i.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new J.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=w.ClockWiseSideOrientation:this.sideOrientation=w.CounterClockWiseSideOrientation,this._uniformBuffer=new p.b(this._scene.getEngine(),void 0,void 0,v),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,P||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),w.OnEventObservable.notifyObservers(this,R.d.Created))}return Object.defineProperty(w.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"alpha",{get:function(){return this._alpha},set:function(v){if(this._alpha!==v){var I=this._alpha;this._alpha=v,1!==I&&1!==v||this.markAsDirty(w.MiscDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(v){this._backFaceCulling!==v&&(this._backFaceCulling=v,this.markAsDirty(w.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"cullBackFaces",{get:function(){return this._cullBackFaces},set:function(v){this._cullBackFaces!==v&&(this._cullBackFaces=v,this.markAsDirty(w.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasRenderTargetTextures",{get:function(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onDispose",{set:function(w){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new K.c),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBind",{set:function(w){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new K.c),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new K.c),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(v){this._alphaMode!==v&&(this._alphaMode=v,this.markAsDirty(w.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(w){this._needDepthPrePass!==w&&(this._needDepthPrePass=w,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isPrePassCapable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(v){this._fogEnabled!==v&&(this._fogEnabled=v,this.markAsDirty(w.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"wireframe",{get:function(){switch(this._fillMode){case w.WireFrameFillMode:case w.LineListDrawMode:case w.LineLoopDrawMode:case w.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(v){this.fillMode=v?w.WireFrameFillMode:w.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case w.PointFillMode:case w.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(v){this.fillMode=v?w.PointFillMode:w.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"fillMode",{get:function(){return this._fillMode},set:function(v){this._fillMode!==v&&(this._fillMode=v,this.markAsDirty(w.MiscDirtyFlag))},enumerable:!1,configurable:!0}),w.prototype._getDrawWrapper=function(){return this._drawWrapper},w.prototype._setDrawWrapper=function(w){this._drawWrapper=w},w.prototype.toString=function(w){return"Name: "+this.name},w.prototype.getClassName=function(){return"Material"},Object.defineProperty(w.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),w.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},w.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},w.prototype.isReady=function(w,v){return!0},w.prototype.isReadyForSubMesh=function(w,v,I){var P=v.materialDefines;return!!P&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=P,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)},w.prototype.getEffect=function(){return this._drawWrapper.effect},w.prototype.getScene=function(){return this._scene},Object.defineProperty(w.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(v){this._transparencyMode!==v&&(this._transparencyMode=v,this._forceAlphaTest=v===w.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===w.MATERIAL_OPAQUE||this._transparencyMode===w.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),w.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&this.alpha<1},w.prototype.needAlphaBlendingForMesh=function(w){return!(this._disableAlphaBlending&&w.visibility>=1)&&(this.needAlphaBlending()||w.visibility<1||w.hasVertexAlpha)},w.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},w.prototype._shouldTurnAlphaTestOn=function(w){return!this.needAlphaBlendingForMesh(w)&&this.needAlphaTesting()},w.prototype.getAlphaTestTexture=function(){return null},w.prototype.markDirty=function(){for(var w=0,v=this.getScene().meshes;w<v.length;w++){var I=v[w];if(I.subMeshes)for(var P=0,u=I.subMeshes;P<u.length;P++){var Q=u[P];Q.getMaterial()===this&&(Q.effect&&(Q.effect._wasPreviouslyReady=!1,Q.effect._wasPreviouslyUsingInstances=null))}}},w.prototype._preBind=function(v,I){void 0===I&&(I=null);var P=this._scene.getEngine(),u=(null==I?this.sideOrientation:I)===w.ClockWiseSideOrientation;return P.enableEffect(v||this._getDrawWrapper()),P.setState(this.backFaceCulling,this.zOffset,!1,u,this.cullBackFaces,this.stencil,this.zOffsetUnits),u},w.prototype.bind=function(w,v){},w.prototype.buildUniformLayout=function(){var w=this._uniformBuffer;this._eventInfo.ubo=w,this._callbackPluginEventGeneric(R.d.PrepareUniformBuffer,this._eventInfo),w.create(),this._uniformBufferLayoutBuilt=!0},w.prototype.bindForSubMesh=function(w,v,I){I.effect&&(this._eventInfo.subMesh=I,this._callbackPluginEventBindForSubMesh(this._eventInfo))},w.prototype.bindOnlyWorldMatrix=function(w){},w.prototype.bindView=function(w){this._useUBO?this._needToBindSceneUbo=!0:w.setMatrix("view",this.getScene().getViewMatrix())},w.prototype.bindViewProjection=function(w){this._useUBO?this._needToBindSceneUbo=!0:(w.setMatrix("viewProjection",this.getScene().getTransformMatrix()),w.setMatrix("projection",this.getScene().getProjectionMatrix()))},w.prototype.bindEyePosition=function(w,v){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(w,v)},w.prototype._afterBind=function(w,v){if(void 0===v&&(v=null),this._scene._cachedMaterial=this,this._needToBindSceneUbo&&v&&(this._needToBindSceneUbo=!1,g.e.BindSceneUniformBuffer(v,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=w?w.visibility:1,this._onBindObservable&&w&&this._onBindObservable.notifyObservers(w),this.disableDepthWrite){var I=this._scene.getEngine();this._cachedDepthWriteState=I.getDepthWrite(),I.setDepthWrite(!1)}if(this.disableColorWrite){I=this._scene.getEngine();this._cachedColorWriteState=I.getColorWrite(),I.setColorWrite(!1)}if(0!==this.depthFunction){I=this._scene.getEngine();this._cachedDepthFunctionState=I.getDepthFunction()||0,I.setDepthFunction(this.depthFunction)}},w.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction)&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState);this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState);this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)},w.prototype.getAnimatables=function(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(R.d.GetAnimatables,this._eventInfo),this._eventInfo.animatables},w.prototype.getActiveTextures=function(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(R.d.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures},w.prototype.hasTexture=function(w){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=w,this._callbackPluginEventGeneric(R.d.HasTexture,this._eventInfo),this._eventInfo.hasTexture},w.prototype.clone=function(w){return null},w.prototype.getBindedMeshes=function(){var w=this;if(this.meshMap){var v=new Array;for(var I in this.meshMap){var P=this.meshMap[I];P&&v.push(P)}return v}return this._scene.meshes.filter((function(v){return v.material===w}))},w.prototype.forceCompilation=function(w,v,I,u){var Q=this,K=(0,P.d)({clipPlane:!1,useInstances:!1},I),a=this.getScene(),p=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;!function I(){if(Q._scene&&Q._scene.getEngine()){var P=a.clipPlane;if(K.clipPlane&&(a.clipPlane=new Y.e(0,0,0,1)),Q._storeEffectOnSubMeshes){var r=!0,g=null;if(w.subMeshes){var J=new U.c(0,0,0,0,0,w,void 0,!1,!1);J.materialDefines&&(J.materialDefines._renderId=-1),Q.isReadyForSubMesh(w,J,K.useInstances)||(J.effect&&J.effect.getCompilationError()&&J.effect.allFallbacksProcessed()?g=J.effect.getCompilationError():(r=!1,setTimeout(I,16)))}r&&(Q.allowShaderHotSwapping=p,g&&u&&u(g),v&&v(Q))}else Q.isReady()?(Q.allowShaderHotSwapping=p,v&&v(Q)):setTimeout(I,16);K.clipPlane&&(a.clipPlane=P)}}()},w.prototype.forceCompilationAsync=function(w,v){var I=this;return new Promise((function(P,u){I.forceCompilation(w,(function(){P()}),v,(function(w){u(w)}))}))},w.prototype.markAsDirty=function(v){this.getScene().blockMaterialDirtyMechanism||(w._DirtyCallbackArray.length=0,v&w.TextureDirtyFlag&&w._DirtyCallbackArray.push(w._TextureDirtyCallBack),v&w.LightDirtyFlag&&w._DirtyCallbackArray.push(w._LightsDirtyCallBack),v&w.FresnelDirtyFlag&&w._DirtyCallbackArray.push(w._FresnelDirtyCallBack),v&w.AttributesDirtyFlag&&w._DirtyCallbackArray.push(w._AttributeDirtyCallBack),v&w.MiscDirtyFlag&&w._DirtyCallbackArray.push(w._MiscDirtyCallBack),v&w.PrePassDirtyFlag&&w._DirtyCallbackArray.push(w._PrePassDirtyCallBack),w._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(w._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},w.prototype.resetDrawCache=function(){for(var w=0,v=this.getScene().meshes;w<v.length;w++){var I=v[w];if(I.subMeshes)for(var P=0,u=I.subMeshes;P<u.length;P++){var Q=u[P];Q.getMaterial()===this&&Q.resetDrawCache()}}},w.prototype._markAllSubMeshesAsDirty=function(w){if(!this.getScene().blockMaterialDirtyMechanism)for(var v=0,I=this.getScene().meshes;v<I.length;v++){var P=I[v];if(P.subMeshes)for(var u=0,Q=P.subMeshes;u<Q.length;u++){var K=Q[u];if(K.getMaterial(!1)===this)for(var a=0,U=K._drawWrappers;a<U.length;a++){var p=U[a];p&&p.defines&&p.defines.markAllAsDirty&&(this._materialContext===p.materialContext&&w(p.defines))}}}},w.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var w=this.getScene().enablePrePassRenderer();w&&w.markAsDirty()}},w.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(w._AllDirtyCallBack)},w.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(w._ImageProcessingDirtyCallBack)},w.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(w._TextureDirtyCallBack)},w.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(w._FresnelDirtyCallBack)},w.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(w._FresnelAndMiscDirtyCallBack)},w.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(w._LightsDirtyCallBack)},w.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(w._AttributeDirtyCallBack)},w.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(w._MiscDirtyCallBack)},w.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(w._MiscDirtyCallBack)},w.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(w._TextureAndMiscDirtyCallBack)},w.prototype.setPrePassRenderer=function(w){return!1},w.prototype.dispose=function(w,v,I){var P=this.getScene();if(P.stopAnimation(this),P.freeProcessedMaterials(),P.removeMaterial(this),this._eventInfo.forceDisposeTextures=v,this._callbackPluginEventGeneric(R.d.Disposed,this._eventInfo),this._parentContainer){var u=this._parentContainer.materials.indexOf(this);u>-1&&this._parentContainer.materials.splice(u,1),this._parentContainer=null}if(!0!==I)if(this.meshMap)for(var Q in this.meshMap){(U=this.meshMap[Q])&&(U.material=null,this.releaseVertexArrayObject(U,w))}else for(var K=0,a=P.meshes;K<a.length;K++){var U;(U=a[K]).material!==this||U.sourceMesh||(U.material=null,this.releaseVertexArrayObject(U,w))}this._uniformBuffer.dispose(),w&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},w.prototype.releaseVertexArrayObject=function(w,v){if(w.geometry){var I=w.geometry;if(this._storeEffectOnSubMeshes)for(var P=0,u=w.subMeshes;P<u.length;P++){var Q=u[P];I._releaseVertexArrayObject(Q.effect),v&&Q.effect&&Q.effect.dispose()}else I._releaseVertexArrayObject(this._drawWrapper.effect)}},w.prototype.serialize=function(){var w=u.e.Serialize(this);return w.stencil=this.stencil.serialize(),w.uniqueId=this.uniqueId,w},w.Parse=function(w,v,I){if(w.customType){if("BABYLON.PBRMaterial"===w.customType&&w.overloadedAlbedo&&(w.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return r.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else w.customType="BABYLON.StandardMaterial";var P=Q.i.Instantiate(w.customType).Parse(w,v,I);return P._loadedUniqueId=w.uniqueId,P},w.TriangleFillMode=0,w.WireFrameFillMode=1,w.PointFillMode=2,w.PointListDrawMode=3,w.LineListDrawMode=4,w.LineLoopDrawMode=5,w.LineStripDrawMode=6,w.TriangleStripDrawMode=7,w.TriangleFanDrawMode=8,w.ClockWiseSideOrientation=0,w.CounterClockWiseSideOrientation=1,w.TextureDirtyFlag=1,w.LightDirtyFlag=2,w.FresnelDirtyFlag=4,w.AttributesDirtyFlag=8,w.MiscDirtyFlag=16,w.PrePassDirtyFlag=32,w.AllDirtyFlag=63,w.MATERIAL_OPAQUE=0,w.MATERIAL_ALPHATEST=1,w.MATERIAL_ALPHABLEND=2,w.MATERIAL_ALPHATESTANDBLEND=3,w.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,w.MATERIAL_NORMALBLENDMETHOD_RNM=1,w.OnEventObservable=new K.c,w._AllDirtyCallBack=function(w){return w.markAllAsDirty()},w._ImageProcessingDirtyCallBack=function(w){return w.markAsImageProcessingDirty()},w._TextureDirtyCallBack=function(w){return w.markAsTexturesDirty()},w._FresnelDirtyCallBack=function(w){return w.markAsFresnelDirty()},w._MiscDirtyCallBack=function(w){return w.markAsMiscDirty()},w._PrePassDirtyCallBack=function(w){return w.markAsPrePassDirty()},w._LightsDirtyCallBack=function(w){return w.markAsLightDirty()},w._AttributeDirtyCallBack=function(w){return w.markAsAttributesDirty()},w._FresnelAndMiscDirtyCallBack=function(v){w._FresnelDirtyCallBack(v),w._MiscDirtyCallBack(v)},w._TextureAndMiscDirtyCallBack=function(v){w._TextureDirtyCallBack(v),w._MiscDirtyCallBack(v)},w._DirtyCallbackArray=[],w._RunDirtyCallBacks=function(v){for(var I=0,P=w._DirtyCallbackArray;I<P.length;I++){(0,P[I])(v)}},(0,P.i)([(0,u.J)()],w.prototype,"id",void 0),(0,P.i)([(0,u.J)()],w.prototype,"uniqueId",void 0),(0,P.i)([(0,u.J)()],w.prototype,"name",void 0),(0,P.i)([(0,u.J)()],w.prototype,"metadata",void 0),(0,P.i)([(0,u.J)()],w.prototype,"checkReadyOnEveryCall",void 0),(0,P.i)([(0,u.J)()],w.prototype,"checkReadyOnlyOnce",void 0),(0,P.i)([(0,u.J)()],w.prototype,"state",void 0),(0,P.i)([(0,u.J)("alpha")],w.prototype,"_alpha",void 0),(0,P.i)([(0,u.J)("backFaceCulling")],w.prototype,"_backFaceCulling",void 0),(0,P.i)([(0,u.J)("cullBackFaces")],w.prototype,"_cullBackFaces",void 0),(0,P.i)([(0,u.J)()],w.prototype,"sideOrientation",void 0),(0,P.i)([(0,u.J)("alphaMode")],w.prototype,"_alphaMode",void 0),(0,P.i)([(0,u.J)()],w.prototype,"_needDepthPrePass",void 0),(0,P.i)([(0,u.J)()],w.prototype,"disableDepthWrite",void 0),(0,P.i)([(0,u.J)()],w.prototype,"disableColorWrite",void 0),(0,P.i)([(0,u.J)()],w.prototype,"forceDepthWrite",void 0),(0,P.i)([(0,u.J)()],w.prototype,"depthFunction",void 0),(0,P.i)([(0,u.J)()],w.prototype,"separateCullingPass",void 0),(0,P.i)([(0,u.J)("fogEnabled")],w.prototype,"_fogEnabled",void 0),(0,P.i)([(0,u.J)()],w.prototype,"pointSize",void 0),(0,P.i)([(0,u.J)()],w.prototype,"zOffset",void 0),(0,P.i)([(0,u.J)()],w.prototype,"zOffsetUnits",void 0),(0,P.i)([(0,u.J)()],w.prototype,"pointsCloud",null),(0,P.i)([(0,u.J)()],w.prototype,"fillMode",null),(0,P.i)([(0,u.J)()],w.prototype,"transparencyMode",null),w}()},4241:function(w,v,I){"use strict";I.d(v,{b:function(){return P}});var P=function(){function w(w){if(this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=w,w)for(var v in w)Object.prototype.hasOwnProperty.call(w,v)&&this._setDefaultValue(v)}return Object.defineProperty(w.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),w.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},w.prototype.markAsUnprocessed=function(){this._isDirty=!0},w.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},w.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},w.prototype.markAsLightDirty=function(w){void 0===w&&(w=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||w,this._isDirty=!0},w.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},w.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},w.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},w.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},w.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},w.prototype.rebuild=function(){this._keys=[];for(var w=0,v=Object.keys(this);w<v.length;w++){var I=v[w];"_"!==I[0]&&this._keys.push(I)}if(this._externalProperties)for(var P in this._externalProperties)-1===this._keys.indexOf(P)&&this._keys.push(P)},w.prototype.isEqual=function(w){if(this._keys.length!==w._keys.length)return!1;for(var v=0;v<this._keys.length;v++){var I=this._keys[v];if(this[I]!==w[I])return!1}return!0},w.prototype.cloneTo=function(w){this._keys.length!==w._keys.length&&(w._keys=this._keys.slice(0));for(var v=0;v<this._keys.length;v++){var I=this._keys[v];w[I]=this[I]}},w.prototype.reset=function(){var w=this;this._keys.forEach((function(v){return w._setDefaultValue(v)}))},w.prototype._setDefaultValue=function(w){var v,I,P,u,Q,K=null!==(P=null===(I=null===(v=this._externalProperties)||void 0===v?void 0:v[w])||void 0===I?void 0:I.type)&&void 0!==P?P:typeof this[w],a=null===(Q=null===(u=this._externalProperties)||void 0===u?void 0:u[w])||void 0===Q?void 0:Q.default;switch(K){case"number":this[w]=null!==a&&void 0!==a?a:0;break;case"string":this[w]=null!==a&&void 0!==a?a:"";break;default:this[w]=null!==a&&void 0!==a&&a}},w.prototype.toString=function(){for(var w="",v=0;v<this._keys.length;v++){var I=this._keys[v],P=this[I];switch(typeof P){case"number":case"string":w+="#define "+I+" "+P+"\n";break;default:P&&(w+="#define "+I+"\n")}}return w},w}()},37001:function(w,v,I){"use strict";I.d(v,{d:function(){return u}});var P=I(90690),u=function(){function w(){}return Object.defineProperty(w,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(w){this._DiffuseTextureEnabled!==w&&(this._DiffuseTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"DetailTextureEnabled",{get:function(){return this._DetailTextureEnabled},set:function(w){this._DetailTextureEnabled!==w&&(this._DetailTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(w){this._AmbientTextureEnabled!==w&&(this._AmbientTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(w){this._OpacityTextureEnabled!==w&&(this._OpacityTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(w){this._ReflectionTextureEnabled!==w&&(this._ReflectionTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(w){this._EmissiveTextureEnabled!==w&&(this._EmissiveTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(w){this._SpecularTextureEnabled!==w&&(this._SpecularTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(w){this._BumpTextureEnabled!==w&&(this._BumpTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(w){this._LightmapTextureEnabled!==w&&(this._LightmapTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(w){this._RefractionTextureEnabled!==w&&(this._RefractionTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(w){this._ColorGradingTextureEnabled!==w&&(this._ColorGradingTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(w){this._FresnelEnabled!==w&&(this._FresnelEnabled=w,P.d.MarkAllMaterialsAsDirty(4))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(w){this._ClearCoatTextureEnabled!==w&&(this._ClearCoatTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(w){this._ClearCoatBumpTextureEnabled!==w&&(this._ClearCoatBumpTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(w){this._ClearCoatTintTextureEnabled!==w&&(this._ClearCoatTintTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(w){this._SheenTextureEnabled!==w&&(this._SheenTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(w){this._AnisotropicTextureEnabled!==w&&(this._AnisotropicTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(w){this._ThicknessTextureEnabled!==w&&(this._ThicknessTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"RefractionIntensityTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(w){this._RefractionIntensityTextureEnabled!==w&&(this._RefractionIntensityTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"TranslucencyIntensityTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(w){this._TranslucencyIntensityTextureEnabled!==w&&(this._TranslucencyIntensityTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(w,"IridescenceTextureEnabled",{get:function(){return this._IridescenceTextureEnabled},set:function(w){this._IridescenceTextureEnabled!==w&&(this._IridescenceTextureEnabled=w,P.d.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),w._DiffuseTextureEnabled=!0,w._DetailTextureEnabled=!0,w._AmbientTextureEnabled=!0,w._OpacityTextureEnabled=!0,w._ReflectionTextureEnabled=!0,w._EmissiveTextureEnabled=!0,w._SpecularTextureEnabled=!0,w._BumpTextureEnabled=!0,w._LightmapTextureEnabled=!0,w._RefractionTextureEnabled=!0,w._ColorGradingTextureEnabled=!0,w._FresnelEnabled=!0,w._ClearCoatTextureEnabled=!0,w._ClearCoatBumpTextureEnabled=!0,w._ClearCoatTintTextureEnabled=!0,w._SheenTextureEnabled=!0,w._AnisotropicTextureEnabled=!0,w._ThicknessTextureEnabled=!0,w._RefractionIntensityTextureEnabled=!0,w._TranslucencyIntensityTextureEnabled=!0,w._IridescenceTextureEnabled=!0,w}()},33048:function(w,v,I){"use strict";I.d(v,{e:function(){return Y}});var P=I(9127),u=I(37643),Q=I(37105),K=I(78588),a=I(43251),U=I(315),p=I(9488),r=I(86018),Y=function(){function w(){}return w.BindSceneUniformBuffer=function(w,v){v.bindToEffect(w,"Scene")},w.PrepareDefinesForMergedUV=function(w,v,I){v._needUVs=!0,v[I]=!0,w.getTextureMatrix().isIdentityAs3x2()?(v[I+"DIRECTUV"]=w.coordinatesIndex+1,v["MAINUV"+(w.coordinatesIndex+1)]=!0):v[I+"DIRECTUV"]=0},w.BindTextureMatrix=function(w,v,I){var P=w.getTextureMatrix();v.updateMatrix(I+"Matrix",P)},w.GetFogState=function(w,v){return v.fogEnabled&&w.applyFog&&v.fogMode!==Q.d.FOGMODE_NONE},w.PrepareDefinesForMisc=function(w,v,I,P,u,Q,K){K._areMiscDirty&&(K.LOGARITHMICDEPTH=I,K.POINTSIZE=P,K.FOG=u&&this.GetFogState(w,v),K.NONUNIFORMSCALING=w.nonUniformScaling,K.ALPHATEST=Q)},w.PrepareDefinesForFrameBoundValues=function(w,v,I,P,u,Q){void 0===u&&(u=null),void 0===Q&&(Q=!1);var K,a,U,p,r,Y,g=!1;K=null==u?void 0!==w.clipPlane&&null!==w.clipPlane:u,a=null==u?void 0!==w.clipPlane2&&null!==w.clipPlane2:u,U=null==u?void 0!==w.clipPlane3&&null!==w.clipPlane3:u,p=null==u?void 0!==w.clipPlane4&&null!==w.clipPlane4:u,r=null==u?void 0!==w.clipPlane5&&null!==w.clipPlane5:u,Y=null==u?void 0!==w.clipPlane6&&null!==w.clipPlane6:u,I.CLIPPLANE!==K&&(I.CLIPPLANE=K,g=!0),I.CLIPPLANE2!==a&&(I.CLIPPLANE2=a,g=!0),I.CLIPPLANE3!==U&&(I.CLIPPLANE3=U,g=!0),I.CLIPPLANE4!==p&&(I.CLIPPLANE4=p,g=!0),I.CLIPPLANE5!==r&&(I.CLIPPLANE5=r,g=!0),I.CLIPPLANE6!==Y&&(I.CLIPPLANE6=Y,g=!0),I.DEPTHPREPASS!==!v.getColorWrite()&&(I.DEPTHPREPASS=!I.DEPTHPREPASS,g=!0),I.INSTANCES!==P&&(I.INSTANCES=P,g=!0),I.INSTANCESCOLOR&&!I.INSTANCES&&(I.INSTANCESCOLOR=!1,g=!0),I.THIN_INSTANCES!==Q&&(I.THIN_INSTANCES=Q,g=!0),g&&I.markAsUnprocessed()},w.PrepareDefinesForBones=function(w,v){if(w.useBones&&w.computeBonesUsingShaders&&w.skeleton){v.NUM_BONE_INFLUENCERS=w.numBoneInfluencers;var I=void 0!==v.BONETEXTURE;if(w.skeleton.isUsingTextureForMatrices&&I)v.BONETEXTURE=!0;else{v.BonesPerMesh=w.skeleton.bones.length+1,v.BONETEXTURE=!I&&void 0;var P=w.getScene().prePassRenderer;if(P&&P.enabled){var u=-1===P.excludedSkinnedMesh.indexOf(w);v.BONES_VELOCITY_ENABLED=u}}}else v.NUM_BONE_INFLUENCERS=0,v.BonesPerMesh=0},w.PrepareDefinesForMorphTargets=function(w,v){var I=w.morphTargetManager;I?(v.MORPHTARGETS_UV=I.supportsUVs&&v.UV1,v.MORPHTARGETS_TANGENT=I.supportsTangents&&v.TANGENT,v.MORPHTARGETS_NORMAL=I.supportsNormals&&v.NORMAL,v.MORPHTARGETS=I.numInfluencers>0,v.NUM_MORPH_INFLUENCERS=I.numInfluencers,v.MORPHTARGETS_TEXTURE=I.isUsingTextureForTargets):(v.MORPHTARGETS_UV=!1,v.MORPHTARGETS_TANGENT=!1,v.MORPHTARGETS_NORMAL=!1,v.MORPHTARGETS=!1,v.NUM_MORPH_INFLUENCERS=0)},w.PrepareDefinesForBakedVertexAnimation=function(w,v){var I=w.bakedVertexAnimationManager;v.BAKED_VERTEX_ANIMATION_TEXTURE=!(!I||!I.isEnabled)},w.PrepareDefinesForAttributes=function(w,v,I,P,u,Q,K){if(void 0===u&&(u=!1),void 0===Q&&(Q=!0),void 0===K&&(K=!0),!v._areAttributesDirty&&v._needNormals===v._normals&&v._needUVs===v._uvs)return!1;v._normals=v._needNormals,v._uvs=v._needUVs,v.NORMAL=v._needNormals&&w.isVerticesDataPresent(a.f.NormalKind),v._needNormals&&w.isVerticesDataPresent(a.f.TangentKind)&&(v.TANGENT=!0);for(var U=1;U<=6;++U)v["UV"+U]=!!v._needUVs&&w.isVerticesDataPresent("uv".concat(1===U?"":U));if(I){var p=w.useVertexColors&&w.isVerticesDataPresent(a.f.ColorKind);v.VERTEXCOLOR=p,v.VERTEXALPHA=w.hasVertexAlpha&&p&&Q}return w.isVerticesDataPresent(a.f.ColorInstanceKind)&&(w.hasInstances||w.hasThinInstances)&&(v.INSTANCESCOLOR=!0),P&&this.PrepareDefinesForBones(w,v),u&&this.PrepareDefinesForMorphTargets(w,v),K&&this.PrepareDefinesForBakedVertexAnimation(w,v),!0},w.PrepareDefinesForMultiview=function(w,v){if(w.activeCamera){var I=v.MULTIVIEW;v.MULTIVIEW=null!==w.activeCamera.outputRenderTarget&&w.activeCamera.outputRenderTarget.getViewCount()>1,v.MULTIVIEW!=I&&v.markAsUnprocessed()}},w.PrepareDefinesForOIT=function(w,v,I){var P=v.ORDER_INDEPENDENT_TRANSPARENCY,u=v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;v.ORDER_INDEPENDENT_TRANSPARENCY=w.useOrderIndependentTransparency&&I,v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!w.getEngine().getCaps().textureFloatLinearFiltering,P===v.ORDER_INDEPENDENT_TRANSPARENCY&&u===v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||v.markAsUnprocessed()},w.PrepareDefinesForPrePass=function(w,v,I){var P=v.PREPASS;if(v._arePrePassDirty){var u=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(w.prePassRenderer&&w.prePassRenderer.enabled&&I){v.PREPASS=!0,v.SCENE_MRT_COUNT=w.prePassRenderer.mrtCount;for(var Q=0;Q<u.length;Q++){var K=w.prePassRenderer.getIndex(u[Q].type);-1!==K?(v[u[Q].define]=!0,v[u[Q].index]=K):v[u[Q].define]=!1}}else{v.PREPASS=!1;for(Q=0;Q<u.length;Q++)v[u[Q].define]=!1}v.PREPASS!=P&&(v.markAsUnprocessed(),v.markAsImageProcessingDirty())}},w.PrepareDefinesForLight=function(w,v,I,P,u,Q,K){switch(K.needNormals=!0,void 0===u["LIGHT"+P]&&(K.needRebuild=!0),u["LIGHT"+P]=!0,u["SPOTLIGHT"+P]=!1,u["HEMILIGHT"+P]=!1,u["POINTLIGHT"+P]=!1,u["DIRLIGHT"+P]=!1,I.prepareLightSpecificDefines(u,P),u["LIGHT_FALLOFF_PHYSICAL"+P]=!1,u["LIGHT_FALLOFF_GLTF"+P]=!1,u["LIGHT_FALLOFF_STANDARD"+P]=!1,I.falloffType){case U.d.FALLOFF_GLTF:u["LIGHT_FALLOFF_GLTF"+P]=!0;break;case U.d.FALLOFF_PHYSICAL:u["LIGHT_FALLOFF_PHYSICAL"+P]=!0;break;case U.d.FALLOFF_STANDARD:u["LIGHT_FALLOFF_STANDARD"+P]=!0}if(Q&&!I.specular.equalsFloats(0,0,0)&&(K.specularEnabled=!0),u["SHADOW"+P]=!1,u["SHADOWCSM"+P]=!1,u["SHADOWCSMDEBUG"+P]=!1,u["SHADOWCSMNUM_CASCADES"+P]=!1,u["SHADOWCSMUSESHADOWMAXZ"+P]=!1,u["SHADOWCSMNOBLEND"+P]=!1,u["SHADOWCSM_RIGHTHANDED"+P]=!1,u["SHADOWPCF"+P]=!1,u["SHADOWPCSS"+P]=!1,u["SHADOWPOISSON"+P]=!1,u["SHADOWESM"+P]=!1,u["SHADOWCLOSEESM"+P]=!1,u["SHADOWCUBE"+P]=!1,u["SHADOWLOWQUALITY"+P]=!1,u["SHADOWMEDIUMQUALITY"+P]=!1,v&&v.receiveShadows&&w.shadowsEnabled&&I.shadowEnabled){var a=I.getShadowGenerator();if(a){var p=a.getShadowMap();p&&p.renderList&&p.renderList.length>0&&(K.shadowEnabled=!0,a.prepareDefines(u,P))}}I.lightmapMode!=U.d.LIGHTMAP_DEFAULT?(K.lightmapMode=!0,u["LIGHTMAPEXCLUDED"+P]=!0,u["LIGHTMAPNOSPECULAR"+P]=I.lightmapMode==U.d.LIGHTMAP_SHADOWSONLY):(u["LIGHTMAPEXCLUDED"+P]=!1,u["LIGHTMAPNOSPECULAR"+P]=!1)},w.PrepareDefinesForLights=function(w,v,I,P,u,Q){if(void 0===u&&(u=4),void 0===Q&&(Q=!1),!I._areLightsDirty)return I._needNormals;var K=0,a={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(w.lightsEnabled&&!Q)for(var U=0,p=v.lightSources;U<p.length;U++){var r=p[U];if(this.PrepareDefinesForLight(w,v,r,K,I,P,a),++K===u)break}I.SPECULARTERM=a.specularEnabled,I.SHADOWS=a.shadowEnabled;for(var Y=K;Y<u;Y++)void 0!==I["LIGHT"+Y]&&(I["LIGHT"+Y]=!1,I["HEMILIGHT"+Y]=!1,I["POINTLIGHT"+Y]=!1,I["DIRLIGHT"+Y]=!1,I["SPOTLIGHT"+Y]=!1,I["SHADOW"+Y]=!1,I["SHADOWCSM"+Y]=!1,I["SHADOWCSMDEBUG"+Y]=!1,I["SHADOWCSMNUM_CASCADES"+Y]=!1,I["SHADOWCSMUSESHADOWMAXZ"+Y]=!1,I["SHADOWCSMNOBLEND"+Y]=!1,I["SHADOWCSM_RIGHTHANDED"+Y]=!1,I["SHADOWPCF"+Y]=!1,I["SHADOWPCSS"+Y]=!1,I["SHADOWPOISSON"+Y]=!1,I["SHADOWESM"+Y]=!1,I["SHADOWCLOSEESM"+Y]=!1,I["SHADOWCUBE"+Y]=!1,I["SHADOWLOWQUALITY"+Y]=!1,I["SHADOWMEDIUMQUALITY"+Y]=!1);var g=w.getEngine().getCaps();return void 0===I.SHADOWFLOAT&&(a.needRebuild=!0),I.SHADOWFLOAT=a.shadowEnabled&&(g.textureFloatRender&&g.textureFloatLinearFiltering||g.textureHalfFloatRender&&g.textureHalfFloatLinearFiltering),I.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&I.rebuild(),a.needNormals},w.PrepareUniformsAndSamplersForLight=function(w,v,I,P,u,Q){void 0===u&&(u=null),void 0===Q&&(Q=!1),u&&u.push("Light"+w),Q||(v.push("vLightData"+w,"vLightDiffuse"+w,"vLightSpecular"+w,"vLightDirection"+w,"vLightFalloff"+w,"vLightGround"+w,"lightMatrix"+w,"shadowsInfo"+w,"depthValues"+w),I.push("shadowSampler"+w),I.push("depthSampler"+w),v.push("viewFrustumZ"+w,"cascadeBlendFactor"+w,"lightSizeUVCorrection"+w,"depthCorrection"+w,"penumbraDarkness"+w,"frustumLengths"+w),P&&(I.push("projectionLightSampler"+w),v.push("textureProjectionMatrix"+w)))},w.PrepareUniformsAndSamplersList=function(w,v,I,P){var u;void 0===P&&(P=4);var Q=null;if(w.uniformsNames){var K=w;u=K.uniformsNames,Q=K.uniformBuffersNames,v=K.samplers,I=K.defines,P=K.maxSimultaneousLights||0}else u=w,v||(v=[]);for(var a=0;a<P&&I["LIGHT"+a];a++)this.PrepareUniformsAndSamplersForLight(a,u,v,I["PROJECTEDLIGHTTEXTURE"+a],Q);I.NUM_MORPH_INFLUENCERS&&u.push("morphTargetInfluences"),I.BAKED_VERTEX_ANIMATION_TEXTURE&&(u.push("bakedVertexAnimationSettings"),u.push("bakedVertexAnimationTextureSizeInverted"),u.push("bakedVertexAnimationTime"),v.push("bakedVertexAnimationTexture"))},w.HandleFallbacksForShadows=function(w,v,I,P){void 0===I&&(I=4),void 0===P&&(P=0);for(var u=0,Q=0;Q<I&&w["LIGHT"+Q];Q++)Q>0&&(u=P+Q,v.addFallback(u,"LIGHT"+Q)),w.SHADOWS||(w["SHADOW"+Q]&&v.addFallback(P,"SHADOW"+Q),w["SHADOWPCF"+Q]&&v.addFallback(P,"SHADOWPCF"+Q),w["SHADOWPCSS"+Q]&&v.addFallback(P,"SHADOWPCSS"+Q),w["SHADOWPOISSON"+Q]&&v.addFallback(P,"SHADOWPOISSON"+Q),w["SHADOWESM"+Q]&&v.addFallback(P,"SHADOWESM"+Q),w["SHADOWCLOSEESM"+Q]&&v.addFallback(P,"SHADOWCLOSEESM"+Q));return u++},w.PrepareAttributesForMorphTargetsInfluencers=function(w,v,I){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=I,this.PrepareAttributesForMorphTargets(w,v,this._TmpMorphInfluencers)},w.PrepareAttributesForMorphTargets=function(w,v,I){var u=I.NUM_MORPH_INFLUENCERS;if(u>0&&K.e.LastCreatedEngine){var Q=K.e.LastCreatedEngine.getCaps().maxVertexAttribs,U=v.morphTargetManager;if(null===U||void 0===U?void 0:U.isUsingTextureForTargets)return;for(var p=U&&U.supportsNormals&&I.NORMAL,r=U&&U.supportsTangents&&I.TANGENT,Y=U&&U.supportsUVs&&I.UV1,g=0;g<u;g++)w.push(a.f.PositionKind+g),p&&w.push(a.f.NormalKind+g),r&&w.push(a.f.TangentKind+g),Y&&w.push(a.f.UVKind+"_"+g),w.length>Q&&P.e.Error("Cannot add more vertex attributes for mesh "+v.name)}},w.PrepareAttributesForBakedVertexAnimation=function(w,v,I){I.BAKED_VERTEX_ANIMATION_TEXTURE&&I.INSTANCES&&w.push("bakedVertexAnimationSettingsInstanced")},w.PrepareAttributesForBones=function(w,v,I,P){I.NUM_BONE_INFLUENCERS>0&&(P.addCPUSkinningFallback(0,v),w.push(a.f.MatricesIndicesKind),w.push(a.f.MatricesWeightsKind),I.NUM_BONE_INFLUENCERS>4&&(w.push(a.f.MatricesIndicesExtraKind),w.push(a.f.MatricesWeightsExtraKind)))},w.PrepareAttributesForInstances=function(w,v){(v.INSTANCES||v.THIN_INSTANCES)&&this.PushAttributesForInstances(w,!!v.PREPASS_VELOCITY),v.INSTANCESCOLOR&&w.push(a.f.ColorInstanceKind)},w.PushAttributesForInstances=function(w,v){void 0===v&&(v=!1),w.push("world0"),w.push("world1"),w.push("world2"),w.push("world3"),v&&(w.push("previousWorld0"),w.push("previousWorld1"),w.push("previousWorld2"),w.push("previousWorld3"))},w.BindLightProperties=function(w,v,I){w.transferToEffect(v,I+"")},w.BindLight=function(w,v,I,P,u,Q){void 0===Q&&(Q=!0),w._bindLight(v,I,P,u,Q)},w.BindLights=function(w,v,I,P,u){void 0===u&&(u=4);for(var Q=Math.min(v.lightSources.length,u),K=0;K<Q;K++){var a=v.lightSources[K];this.BindLight(a,K,w,I,"boolean"===typeof P?P:P.SPECULARTERM,v.receiveShadows)}},w.BindFogParameters=function(w,v,I,P){void 0===P&&(P=!1),w.fogEnabled&&v.applyFog&&w.fogMode!==Q.d.FOGMODE_NONE&&(I.setFloat4("vFogInfos",w.fogMode,w.fogStart,w.fogEnd,w.fogDensity),P?(w.fogColor.toLinearSpaceToRef(this._TempFogColor),I.setColor3("vFogColor",this._TempFogColor)):I.setColor3("vFogColor",w.fogColor))},w.BindBonesParameters=function(v,I,P){if(I&&v&&(v.computeBonesUsingShaders&&I._bonesComputationForcedToCPU&&(v.computeBonesUsingShaders=!1),v.useBones&&v.computeBonesUsingShaders&&v.skeleton)){var u=v.skeleton;if(u.isUsingTextureForMatrices&&I.getUniformIndex("boneTextureWidth")>-1){var Q=u.getTransformMatrixTexture(v);I.setTexture("boneSampler",Q),I.setFloat("boneTextureWidth",4*(u.bones.length+1))}else{var K=u.getTransformMatrices(v);K&&(I.setMatrices("mBones",K),P&&v.getScene().prePassRenderer&&v.getScene().prePassRenderer.getIndex(2)&&(P.previousBones[v.uniqueId]||(P.previousBones[v.uniqueId]=K.slice()),I.setMatrices("mPreviousBones",P.previousBones[v.uniqueId]),w._CopyBonesTransformationMatrices(K,P.previousBones[v.uniqueId])))}}},w._CopyBonesTransformationMatrices=function(w,v){return v.set(w),v},w.BindMorphTargetParameters=function(w,v){var I=w.morphTargetManager;w&&I&&v.setFloatArray("morphTargetInfluences",I.influences)},w.BindLogDepth=function(w,v,I){if(!w||w.LOGARITHMICDEPTH){var Q=I.activeCamera;Q.mode===u.e.ORTHOGRAPHIC_CAMERA&&P.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),v.setFloat("logarithmicDepthConstant",2/(Math.log(Q.maxZ+1)/Math.LN2))}},w.BindClipPlane=function(w,v){r.e.BindClipPlane(w,v)},w._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},w._TempFogColor=p.b.Black(),w}()},96558:function(w,v,I){"use strict";I.d(v,{d:function(){return a}});var P=I(78502),u=I(9892),Q=(I(46907),I(38956)),K=function(){function w(w){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=w,this._scene=w.getScene(),this._engine=this._scene.getEngine()}return w.prototype._addPlugin=function(v){for(var I=0;I<this._plugins.length;++I)if(this._plugins[I].name===v.name)throw'Plugin "'.concat(v.name,'" already added to the material "').concat(this._material.name,'"!');if(this._material._uniformBufferLayoutBuilt)throw'The plugin "'.concat(v.name,'" can\'t be added to the material "').concat(this._material.name,'" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.');var P=v.getClassName();w._MaterialPluginClassToMainDefine[P]||(w._MaterialPluginClassToMainDefine[P]="MATERIALPLUGIN_"+ ++w._MaterialPluginCounter),this._material._callbackPluginEventGeneric=this._handlePluginEvent.bind(this),this._plugins.push(v),this._plugins.sort((function(w,v){return w.priority-v.priority})),this._codeInjectionPoints={};var u={};u[w._MaterialPluginClassToMainDefine[P]]={type:"boolean",default:!0};for(var Q=0,K=this._plugins;Q<K.length;Q++){var a=K[Q];a.collectDefines(u),this._collectPointNames("vertex",a.getCustomCode("vertex")),this._collectPointNames("fragment",a.getCustomCode("fragment"))}this._defineNamesFromPlugins=u},w.prototype._activatePlugin=function(w){-1===this._activePlugins.indexOf(w)&&(this._activePlugins.push(w),this._activePlugins.sort((function(w,v){return w.priority-v.priority})),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),w.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(w),this._activePluginsForExtraEvents.sort((function(w,v){return w.priority-v.priority})),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))},w.prototype.getPlugin=function(w){for(var v=0;v<this._plugins.length;++v)if(this._plugins[v].name===w)return this._plugins[v];return null},w.prototype._handlePluginEventIsReadyForSubMesh=function(w){for(var v=!0,I=0,P=this._activePlugins;I<P.length;I++){var u=P[I];v=v&&u.isReadyForSubMesh(w.defines,this._scene,this._engine,w.subMesh)}w.isReadyForSubMesh=v},w.prototype._handlePluginEventPrepareDefinesBeforeAttributes=function(w){for(var v=0,I=this._activePlugins;v<I.length;v++){I[v].prepareDefinesBeforeAttributes(w.defines,this._scene,w.mesh)}},w.prototype._handlePluginEventPrepareDefines=function(w){for(var v=0,I=this._activePlugins;v<I.length;v++){I[v].prepareDefines(w.defines,this._scene,w.mesh)}},w.prototype._handlePluginEventHardBindForSubMesh=function(w){for(var v=0,I=this._activePluginsForExtraEvents;v<I.length;v++){I[v].hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,w.subMesh)}},w.prototype._handlePluginEventBindForSubMesh=function(w){for(var v=0,I=this._activePlugins;v<I.length;v++){I[v].bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,w.subMesh)}},w.prototype._handlePluginEventHasRenderTargetTextures=function(w){for(var v=!1,I=0,P=this._activePluginsForExtraEvents;I<P.length;I++){if(v=P[I].hasRenderTargetTextures())break}w.hasRenderTargetTextures=v},w.prototype._handlePluginEventFillRenderTargetTextures=function(w){for(var v=0,I=this._activePluginsForExtraEvents;v<I.length;v++){I[v].fillRenderTargetTextures(w.renderTargets)}},w.prototype._handlePluginEvent=function(w,v){var I,P,u;switch(w){case Q.d.GetActiveTextures:for(var K=v,a=0,U=this._activePlugins;a<U.length;a++){(s=U[a]).getActiveTextures(K.activeTextures)}break;case Q.d.GetAnimatables:K=v;for(var p=0,r=this._activePlugins;p<r.length;p++){(s=r[p]).getAnimatables(K.animatables)}break;case Q.d.HasTexture:K=v;for(var Y=!1,g=0,J=this._activePlugins;g<J.length;g++){if(Y=(s=J[g]).hasTexture(K.texture))break}K.hasTexture=Y;break;case Q.d.Disposed:K=v;for(var l=0,R=this._plugins;l<R.length;l++){(s=R[l]).dispose(K.forceDisposeTextures)}break;case Q.d.GetDefineNames:(K=v).defineNames=this._defineNamesFromPlugins;break;case Q.d.PrepareEffect:K=v;for(var x=0,j=this._activePlugins;x<j.length;x++){var s=j[x];K.fallbackRank=s.addFallbacks(K.defines,K.fallbacks,K.fallbackRank),s.getAttributes(K.attributes,this._scene,K.mesh)}this._uniformList.length>0&&(I=K.uniforms).push.apply(I,this._uniformList),this._samplerList.length>0&&(P=K.samplers).push.apply(P,this._samplerList),this._uboList.length>0&&(u=K.uniformBuffersNames).push.apply(u,this._uboList),K.customCode=this._injectCustomCode(K.customCode);break;case Q.d.PrepareUniformBuffer:K=v;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];for(var B=0,t=this._plugins;B<t.length;B++){var i=(s=t[B]).getUniforms();if(i){if(i.ubo)for(var z=0,E=i.ubo;z<E.length;z++){var o=E[z];K.ubo.addUniform(o.name,o.size),this._uboDeclaration+="".concat(o.type," ").concat(o.name,";\r\n"),this._uniformList.push(o.name)}i.vertex&&(this._vertexDeclaration+=i.vertex+"\r\n"),i.fragment&&(this._fragmentDeclaration+=i.fragment+"\r\n")}s.getSamplers(this._samplerList),s.getUniformBuffersNames(this._uboList)}}},w.prototype._collectPointNames=function(w,v){if(v)for(var I in v)this._codeInjectionPoints[w]||(this._codeInjectionPoints[w]={}),this._codeInjectionPoints[w][I]=!0},w.prototype._injectCustomCode=function(w){var v=this;return function(I,P){var u;w&&(P=w(I,P)),v._uboDeclaration&&(P=P.replace("#define ADDITIONAL_UBO_DECLARATION",v._uboDeclaration)),v._vertexDeclaration&&(P=P.replace("#define ADDITIONAL_VERTEX_DECLARATION",v._vertexDeclaration)),v._fragmentDeclaration&&(P=P.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",v._fragmentDeclaration));var Q=null===(u=v._codeInjectionPoints)||void 0===u?void 0:u[I];if(!Q)return P;for(var K in Q){for(var a="",U=0,p=v._activePlugins;U<p.length;U++){var r=p[U].getCustomCode(I);(null===r||void 0===r?void 0:r[K])&&(a+=r[K]+"\r\n")}if(a.length>0)if("!"===K.charAt(0))for(var Y=new RegExp(K.substring(1),"g"),g=Y.exec(P);null!==g;){for(var J=a,l=0;l<g.length;++l)J=J.replace("$"+l,g[l]);P=P.replace(g[0],J),g=Y.exec(P)}else{var R="#define "+K;P=P.replace(R,"\r\n"+a+"\r\n"+R)}}return P}},w._MaterialPluginClassToMainDefine={},w._MaterialPluginCounter=0,w}();var a=function(){function w(w,v,I,P,u,Q){void 0===u&&(u=!0),void 0===Q&&(Q=!1),this.priority=500,this.registerForExtraEvents=!1,this._material=w,this.name=v,this.priority=I,w.pluginManager||(w.pluginManager=new K(w)),this._pluginDefineNames=P,this._pluginManager=w.pluginManager,u&&this._pluginManager._addPlugin(this),Q&&this._enable(!0),this.markAllDefinesAsDirty=w._dirtyCallbacks[63]}return w.prototype._enable=function(w){w&&this._pluginManager._activatePlugin(this)},w.prototype.getClassName=function(){return"MaterialPluginBase"},w.prototype.isReadyForSubMesh=function(w,v,I,P){return!0},w.prototype.hardBindForSubMesh=function(w,v,I,P){},w.prototype.bindForSubMesh=function(w,v,I,P){},w.prototype.dispose=function(w){},w.prototype.getCustomCode=function(w){return null},w.prototype.collectDefines=function(w){if(this._pluginDefineNames)for(var v=0,I=Object.keys(this._pluginDefineNames);v<I.length;v++){var P=I[v];if("_"!==P[0]){var u=typeof this._pluginDefineNames[P];w[P]={type:"number"===u?"number":"string"===u?"string":"boolean"===u?"boolean":"object",default:this._pluginDefineNames[P]}}}},w.prototype.prepareDefinesBeforeAttributes=function(w,v,I){},w.prototype.prepareDefines=function(w,v,I){},w.prototype.hasTexture=function(w){return!1},w.prototype.hasRenderTargetTextures=function(){return!1},w.prototype.fillRenderTargetTextures=function(w){},w.prototype.getActiveTextures=function(w){},w.prototype.getAnimatables=function(w){},w.prototype.addFallbacks=function(w,v,I){return I},w.prototype.getSamplers=function(w){},w.prototype.getAttributes=function(w,v,I){},w.prototype.getUniformBuffersNames=function(w){},w.prototype.getUniforms=function(){return{}},w.prototype.copyTo=function(w){u.e.Clone((function(){return w}),this)},w.prototype.serialize=function(){return u.e.Serialize(this)},w.prototype.parse=function(w,v,I){var P=this;u.e.Parse((function(){return P}),w,v,I)},(0,P.i)([(0,u.J)()],w.prototype,"name",void 0),(0,P.i)([(0,u.J)()],w.prototype,"priority",void 0),(0,P.i)([(0,u.J)()],w.prototype,"registerForExtraEvents",void 0),w}()},38956:function(w,v,I){"use strict";var P;I.d(v,{d:function(){return P}}),function(w){w[w.Created=1]="Created",w[w.Disposed=2]="Disposed",w[w.GetDefineNames=4]="GetDefineNames",w[w.PrepareUniformBuffer=8]="PrepareUniformBuffer",w[w.IsReadyForSubMesh=16]="IsReadyForSubMesh",w[w.PrepareDefines=32]="PrepareDefines",w[w.BindForSubMesh=64]="BindForSubMesh",w[w.PrepareEffect=128]="PrepareEffect",w[w.GetAnimatables=256]="GetAnimatables",w[w.GetActiveTextures=512]="GetActiveTextures",w[w.HasTexture=1024]="HasTexture",w[w.FillRenderTargetTextures=2048]="FillRenderTargetTextures",w[w.HasRenderTargetTextures=4096]="HasRenderTargetTextures",w[w.HardBindForSubMesh=8192]="HardBindForSubMesh"}(P||(P={}))},49443:function(w,v,I){"use strict";I.d(v,{b:function(){return a}});var P=I(78502),u=I(46907),Q=I(45883),K=I(31709),a=function(w){function v(v,I){var P=w.call(this,v,I,!0)||this;return P._waitingSubMaterialsUniqueIds=[],P.getScene().multiMaterials.push(P),P.subMaterials=new Array,P._storeEffectOnSubMeshes=!0,P}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(w){this._subMaterials=w,this._hookArray(w)},enumerable:!1,configurable:!0}),v.prototype.getChildren=function(){return this.subMaterials},v.prototype._hookArray=function(w){var v=this,I=w.push;w.push=function(){for(var P=[],u=0;u<arguments.length;u++)P[u]=arguments[u];var Q=I.apply(w,P);return v._markAllSubMeshesAsTexturesDirty(),Q};var P=w.splice;w.splice=function(I,u){var Q=P.apply(w,[I,u]);return v._markAllSubMeshesAsTexturesDirty(),Q}},v.prototype.getSubMaterial=function(w){return w<0||w>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[w]},v.prototype.getActiveTextures=function(){var v;return(v=w.prototype.getActiveTextures.call(this)).concat.apply(v,this.subMaterials.map((function(w){return w?w.getActiveTextures():[]})))},v.prototype.hasTexture=function(v){var I;if(w.prototype.hasTexture.call(this,v))return!0;for(var P=0;P<this.subMaterials.length;P++)if(null===(I=this.subMaterials[P])||void 0===I?void 0:I.hasTexture(v))return!0;return!1},v.prototype.getClassName=function(){return"MultiMaterial"},v.prototype.isReadyForSubMesh=function(w,v,I){for(var P=0;P<this.subMaterials.length;P++){var u=this.subMaterials[P];if(u){if(u._storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(w,v,I))return!1;continue}if(!u.isReady(w))return!1}}return!0},v.prototype.clone=function(w,I){for(var P=new v(w,this.getScene()),u=0;u<this.subMaterials.length;u++){var Q=null,K=this.subMaterials[u];Q=I&&K?K.clone(w+"-"+K.name):this.subMaterials[u],P.subMaterials.push(Q)}return P},v.prototype.serialize=function(){var w={};w.name=this.name,w.id=this.id,w.uniqueId=this.uniqueId,Q.c&&(w.tags=Q.c.GetTags(this)),w.materialsUniqueIds=[],w.materials=[];for(var v=0;v<this.subMaterials.length;v++){var I=this.subMaterials[v];I?(w.materialsUniqueIds.push(I.uniqueId),w.materials.push(I.id)):(w.materialsUniqueIds.push(null),w.materials.push(null))}return w},v.prototype.dispose=function(v,I,P){var u=this.getScene();if(u){if(P)for(var Q=0;Q<this.subMaterials.length;Q++){var K=this.subMaterials[Q];K&&K.dispose(v,I)}var a=u.multiMaterials.indexOf(this);a>=0&&u.multiMaterials.splice(a,1),w.prototype.dispose.call(this,v,I)}},v.ParseMultiMaterial=function(w,I){var P=new v(w.name,I);return P.id=w.id,P._loadedUniqueId=w.uniqueId,Q.c&&Q.c.AddTagsTo(P,w.tags),w.materialsUniqueIds?P._waitingSubMaterialsUniqueIds=w.materialsUniqueIds:w.materials.forEach((function(w){return P.subMaterials.push(I.getLastMaterialById(w))})),P},v}(u.b);(0,K.g)("BABYLON.MultiMaterial",a)},90888:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(){this.previousWorldMatrices={},this.previousBones={}}return w.AddUniforms=function(w){w.push("previousWorld","previousViewProjection","mPreviousBones")},w.AddSamplers=function(w){},w.prototype.bindForSubMesh=function(w,v,I,P,u){if(v.prePassRenderer&&v.prePassRenderer.enabled&&v.prePassRenderer.currentRTisSceneRT&&-1!==v.prePassRenderer.getIndex(2)){this.previousWorldMatrices[I.uniqueId]||(this.previousWorldMatrices[I.uniqueId]=P.clone()),this.previousViewProjection||(this.previousViewProjection=v.getTransformMatrix().clone(),this.currentViewProjection=v.getTransformMatrix().clone());var Q=v.getEngine();this.currentViewProjection.updateFlag!==v.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=Q.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(v.getTransformMatrix())):this._lastUpdateFrameId!==Q.frameId&&(this._lastUpdateFrameId=Q.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),w.setMatrix("previousWorld",this.previousWorldMatrices[I.uniqueId]),w.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[I.uniqueId]=P.clone()}},w}()},29553:function(w,v,I){"use strict";I.d(v,{d:function(){return Q}});var P=I(78502),u=I(80105),Q=function(w){function v(v,I,P){void 0===P&&(P=!0);var Q=w.call(this,v,I)||this;return Q._normalMatrix=new u.e,Q._storeEffectOnSubMeshes=P,Q}return(0,P.m)(v,w),v.prototype.getEffect=function(){return this._storeEffectOnSubMeshes?this._activeEffect:w.prototype.getEffect.call(this)},v.prototype.isReady=function(w,v){return!!w&&(!this._storeEffectOnSubMeshes||(!w.subMeshes||0===w.subMeshes.length||this.isReadyForSubMesh(w,w.subMeshes[0],v)))},v.prototype._isReadyForSubMesh=function(w){var v=w.materialDefines;return!(this.checkReadyOnEveryCall||!w.effect||!v||v._renderId!==this.getScene().getRenderId())},v.prototype.bindOnlyWorldMatrix=function(w){this._activeEffect.setMatrix("world",w)},v.prototype.bindOnlyNormalMatrix=function(w){this._activeEffect.setMatrix("normalMatrix",w)},v.prototype.bind=function(w,v){v&&this.bindForSubMesh(w,v,v.subMeshes[0])},v.prototype._afterBind=function(v,I){void 0===I&&(I=null),w.prototype._afterBind.call(this,v,I),this.getScene()._cachedEffect=I},v.prototype._mustRebind=function(w,v,I){return void 0===I&&(I=1),w.isCachedMaterialInvalid(this,v,I)},v}(I(46907).b)},56591:function(w,v,I){"use strict";var P;I.d(v,{d:function(){return P}}),function(w){w[w.GLSL=0]="GLSL",w[w.WGSL=1]="WGSL"}(P||(P={}))},87683:function(w,v,I){"use strict";I.d(v,{b:function(){return m}});var P=I(78502),u=I(9892),Q=I(21901),K=I(37105),a=I(80105),U=I(9488),p=I(43251),r=I(90888),Y=I(23016),g=I(46907),J=I(38956),l=I(4241),R=I(29553),x=I(33048),j=I(70937),s=I(31709),B=I(37001),t=I(16179),i="uniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform vec3 vAmbientColor;\nuniform float visibility;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n";t.c.IncludesShadersStore.defaultFragmentDeclaration=i;I(88987),I(61496);var z="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nfloat alphaCutOff;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec3 vRefractionPosition;\nvec3 vRefractionSize;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nvec3 vAmbientColor;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";t.c.IncludesShadersStore.defaultUboDeclaration=z;I(74422),I(44184),I(87321),I(83874),I(65084),I(45928);var E="struct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w==0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}";t.c.IncludesShadersStore.lightsFragmentFunctions=E;I(35765),I(54587);var o="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif\n";t.c.IncludesShadersStore.fresnelFunction=o;I(31814),I(23598),I(68923),I(72994),I(49904),I(76578),I(96919),I(35850),I(69991),I(84098),I(78767),I(75060),I(57932),I(84981),I(80345);var h="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#define RECIPROCAL_PI2 0.15915494\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<oitFragment>\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef DETAIL\nbaseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec4 refractionColor=vec4(0.,0.,0.,1.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,vRefractionSize,vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector);\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor.rgb=fromRGBD(refractionColor);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor.rgb=toGammaSpace(refractionColor.rgb);\n#endif\nrefractionColor.rgb*=vRefractionInfos.x;\n#endif\nvec4 reflectionColor=vec4(0.,0.,0.,1.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor.rgb=toGammaSpace(reflectionColor.rgb);\n#endif\nreflectionColor.rgb*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<alphaCutOff)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor.rgb;\n#else\ncolor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;\ngl_FragData[0]=color; \n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4((view*vec4(normalW,0.0)).rgb,writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularMapColor)*writeGeometryInfo; \n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularColor,1.0)*writeGeometryInfo;\n#endif\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=color;\n#endif\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=color.rgb*color.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-color.a);\n} else {\nbackColor+=color;\n}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";t.c.ShadersStore.defaultPixelShader=h;var n="uniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";t.c.IncludesShadersStore.defaultVertexDeclaration=n;I(94040),I(31377),I(54001),I(16554),I(63201),I(138),I(20142),I(49329),I(23654),I(65359),I(58003),I(36062),I(83700),I(63886),I(48767),I(50511),I(97202),I(48623),I(32875),I(3970),I(58878),I(70179),I(61906),I(32560),I(70323),I(35738);var W="#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n";t.c.IncludesShadersStore.pointCloudVertex=W;I(30242);var V="#include<__decl__defaultVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";t.c.ShadersStore.defaultVertexShader=V;var F=I(54497),O=I(56513),N={effect:null,subMesh:null},q=function(w){function v(v){var I=w.call(this,v)||this;return I.MAINUV1=!1,I.MAINUV2=!1,I.MAINUV3=!1,I.MAINUV4=!1,I.MAINUV5=!1,I.MAINUV6=!1,I.DIFFUSE=!1,I.DIFFUSEDIRECTUV=0,I.BAKED_VERTEX_ANIMATION_TEXTURE=!1,I.AMBIENT=!1,I.AMBIENTDIRECTUV=0,I.OPACITY=!1,I.OPACITYDIRECTUV=0,I.OPACITYRGB=!1,I.REFLECTION=!1,I.EMISSIVE=!1,I.EMISSIVEDIRECTUV=0,I.SPECULAR=!1,I.SPECULARDIRECTUV=0,I.BUMP=!1,I.BUMPDIRECTUV=0,I.PARALLAX=!1,I.PARALLAXOCCLUSION=!1,I.SPECULAROVERALPHA=!1,I.CLIPPLANE=!1,I.CLIPPLANE2=!1,I.CLIPPLANE3=!1,I.CLIPPLANE4=!1,I.CLIPPLANE5=!1,I.CLIPPLANE6=!1,I.ALPHATEST=!1,I.DEPTHPREPASS=!1,I.ALPHAFROMDIFFUSE=!1,I.POINTSIZE=!1,I.FOG=!1,I.SPECULARTERM=!1,I.DIFFUSEFRESNEL=!1,I.OPACITYFRESNEL=!1,I.REFLECTIONFRESNEL=!1,I.REFRACTIONFRESNEL=!1,I.EMISSIVEFRESNEL=!1,I.FRESNEL=!1,I.NORMAL=!1,I.TANGENT=!1,I.UV1=!1,I.UV2=!1,I.UV3=!1,I.UV4=!1,I.UV5=!1,I.UV6=!1,I.VERTEXCOLOR=!1,I.VERTEXALPHA=!1,I.NUM_BONE_INFLUENCERS=0,I.BonesPerMesh=0,I.BONETEXTURE=!1,I.BONES_VELOCITY_ENABLED=!1,I.INSTANCES=!1,I.THIN_INSTANCES=!1,I.INSTANCESCOLOR=!1,I.GLOSSINESS=!1,I.ROUGHNESS=!1,I.EMISSIVEASILLUMINATION=!1,I.LINKEMISSIVEWITHDIFFUSE=!1,I.REFLECTIONFRESNELFROMSPECULAR=!1,I.LIGHTMAP=!1,I.LIGHTMAPDIRECTUV=0,I.OBJECTSPACE_NORMALMAP=!1,I.USELIGHTMAPASSHADOWMAP=!1,I.REFLECTIONMAP_3D=!1,I.REFLECTIONMAP_SPHERICAL=!1,I.REFLECTIONMAP_PLANAR=!1,I.REFLECTIONMAP_CUBIC=!1,I.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,I.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,I.REFLECTIONMAP_PROJECTION=!1,I.REFLECTIONMAP_SKYBOX=!1,I.REFLECTIONMAP_EXPLICIT=!1,I.REFLECTIONMAP_EQUIRECTANGULAR=!1,I.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,I.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,I.REFLECTIONMAP_OPPOSITEZ=!1,I.INVERTCUBICMAP=!1,I.LOGARITHMICDEPTH=!1,I.REFRACTION=!1,I.REFRACTIONMAP_3D=!1,I.REFLECTIONOVERALPHA=!1,I.TWOSIDEDLIGHTING=!1,I.SHADOWFLOAT=!1,I.MORPHTARGETS=!1,I.MORPHTARGETS_NORMAL=!1,I.MORPHTARGETS_TANGENT=!1,I.MORPHTARGETS_UV=!1,I.NUM_MORPH_INFLUENCERS=0,I.MORPHTARGETS_TEXTURE=!1,I.NONUNIFORMSCALING=!1,I.PREMULTIPLYALPHA=!1,I.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,I.ALPHABLEND=!0,I.PREPASS=!1,I.PREPASS_IRRADIANCE=!1,I.PREPASS_IRRADIANCE_INDEX=-1,I.PREPASS_ALBEDO_SQRT=!1,I.PREPASS_ALBEDO_SQRT_INDEX=-1,I.PREPASS_DEPTH=!1,I.PREPASS_DEPTH_INDEX=-1,I.PREPASS_NORMAL=!1,I.PREPASS_NORMAL_INDEX=-1,I.PREPASS_POSITION=!1,I.PREPASS_POSITION_INDEX=-1,I.PREPASS_VELOCITY=!1,I.PREPASS_VELOCITY_INDEX=-1,I.PREPASS_REFLECTIVITY=!1,I.PREPASS_REFLECTIVITY_INDEX=-1,I.SCENE_MRT_COUNT=0,I.RGBDLIGHTMAP=!1,I.RGBDREFLECTION=!1,I.RGBDREFRACTION=!1,I.IMAGEPROCESSING=!1,I.VIGNETTE=!1,I.VIGNETTEBLENDMODEMULTIPLY=!1,I.VIGNETTEBLENDMODEOPAQUE=!1,I.TONEMAPPING=!1,I.TONEMAPPING_ACES=!1,I.CONTRAST=!1,I.COLORCURVES=!1,I.COLORGRADING=!1,I.COLORGRADING3D=!1,I.SAMPLER3DGREENDEPTH=!1,I.SAMPLER3DBGRMAP=!1,I.IMAGEPROCESSINGPOSTPROCESS=!1,I.SKIPFINALCOLORCLAMP=!1,I.MULTIVIEW=!1,I.ORDER_INDEPENDENT_TRANSPARENCY=!1,I.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,I.IS_REFLECTION_LINEAR=!1,I.IS_REFRACTION_LINEAR=!1,I.EXPOSURE=!1,I.rebuild(),I}return(0,P.m)(v,w),v.prototype.setReflectionMode=function(w){for(var v=0,I=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];v<I.length;v++){var P=I[v];this[P]=P===w}},v}(l.b),m=function(w){function v(I,P){var u=w.call(this,I,P)||this;return u._diffuseTexture=null,u._ambientTexture=null,u._opacityTexture=null,u._reflectionTexture=null,u._emissiveTexture=null,u._specularTexture=null,u._bumpTexture=null,u._lightmapTexture=null,u._refractionTexture=null,u.ambientColor=new U.b(0,0,0),u.diffuseColor=new U.b(1,1,1),u.specularColor=new U.b(1,1,1),u.emissiveColor=new U.b(0,0,0),u.specularPower=64,u._useAlphaFromDiffuseTexture=!1,u._useEmissiveAsIllumination=!1,u._linkEmissiveWithDiffuse=!1,u._useSpecularOverAlpha=!1,u._useReflectionOverAlpha=!1,u._disableLighting=!1,u._useObjectSpaceNormalMap=!1,u._useParallax=!1,u._useParallaxOcclusion=!1,u.parallaxScaleBias=.05,u._roughness=0,u.indexOfRefraction=.98,u.invertRefractionY=!0,u.alphaCutOff=.4,u._useLightmapAsShadowmap=!1,u._useReflectionFresnelFromSpecular=!1,u._useGlossinessFromSpecularMapAlpha=!1,u._maxSimultaneousLights=4,u._invertNormalMapX=!1,u._invertNormalMapY=!1,u._twoSidedLighting=!1,u._renderTargets=new Q.g(16),u._worldViewProjectionMatrix=a.e.Zero(),u._globalAmbientColor=new U.b(0,0,0),u._cacheHasRenderTargetTextures=!1,u.detailMap=new O.b(u),u._attachImageProcessingConfiguration(null),u.prePassConfiguration=new r.c,u.getRenderTargetTextures=function(){return u._renderTargets.reset(),v.ReflectionTextureEnabled&&u._reflectionTexture&&u._reflectionTexture.isRenderTarget&&u._renderTargets.push(u._reflectionTexture),v.RefractionTextureEnabled&&u._refractionTexture&&u._refractionTexture.isRenderTarget&&u._renderTargets.push(u._refractionTexture),u._eventInfo.renderTargets=u._renderTargets,u._callbackPluginEventFillRenderTargetTextures(u._eventInfo),u._renderTargets},u}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(w){this._attachImageProcessingConfiguration(w),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),v.prototype._attachImageProcessingConfiguration=function(w){var v=this;w!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=w||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){v._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(v.prototype,"isPrePassCapable",{get:function(){return!this.disableDepthWrite},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(w){this.imageProcessingConfiguration.colorCurvesEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(w){this.imageProcessingConfiguration.colorGradingEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(w){this._imageProcessingConfiguration.toneMappingEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(w){this._imageProcessingConfiguration.exposure=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(w){this._imageProcessingConfiguration.contrast=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(w){this._imageProcessingConfiguration.colorGradingTexture=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(w){this._imageProcessingConfiguration.colorCurves=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"hasRenderTargetTextures",{get:function(){return!!(v.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(v.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(v.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(w){this._useLogarithmicDepth=w&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),v.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)},v.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===g.b.MATERIAL_ALPHATEST)},v.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==g.b.MATERIAL_OPAQUE},v.prototype._hasAlphaChannel=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture},v.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},v.prototype.isReadyForSubMesh=function(w,I,P){if(void 0===P&&(P=!1),this._uniformBufferLayoutBuilt||this.buildUniformLayout(),I.effect&&this.isFrozen&&I.effect._wasPreviouslyReady&&I.effect._wasPreviouslyUsingInstances===P)return!0;I.materialDefines||(this._callbackPluginEventGeneric(J.d.GetDefineNames,this._eventInfo),I.materialDefines=new q(this._eventInfo.defineNames));var u=this.getScene(),Q=I.materialDefines;if(this._isReadyForSubMesh(I))return!0;var K=u.getEngine();Q._needNormals=x.e.PrepareDefinesForLights(u,w,Q,!0,this._maxSimultaneousLights,this._disableLighting),x.e.PrepareDefinesForMultiview(u,Q);var a=this.needAlphaBlendingForMesh(w)&&this.getScene().useOrderIndependentTransparency;if(x.e.PrepareDefinesForPrePass(u,Q,this.canRenderToMRT&&!a),x.e.PrepareDefinesForOIT(u,Q,a),Q._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,Q._needUVs=!1;for(var U=1;U<=6;++U)Q["MAINUV"+U]=!1;if(u.texturesEnabled){if(this._diffuseTexture&&v.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;x.e.PrepareDefinesForMergedUV(this._diffuseTexture,Q,"DIFFUSE")}else Q.DIFFUSE=!1;if(this._ambientTexture&&v.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;x.e.PrepareDefinesForMergedUV(this._ambientTexture,Q,"AMBIENT")}else Q.AMBIENT=!1;if(this._opacityTexture&&v.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;x.e.PrepareDefinesForMergedUV(this._opacityTexture,Q,"OPACITY"),Q.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else Q.OPACITY=!1;if(this._reflectionTexture&&v.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(Q._needNormals=!0,Q.REFLECTION=!0,Q.ROUGHNESS=this._roughness>0,Q.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,Q.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===j.e.INVCUBIC_MODE,Q.REFLECTIONMAP_3D=this._reflectionTexture.isCube,Q.REFLECTIONMAP_OPPOSITEZ=Q.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,Q.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case j.e.EXPLICIT_MODE:Q.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case j.e.PLANAR_MODE:Q.setReflectionMode("REFLECTIONMAP_PLANAR");break;case j.e.PROJECTION_MODE:Q.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case j.e.SKYBOX_MODE:Q.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case j.e.SPHERICAL_MODE:Q.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case j.e.EQUIRECTANGULAR_MODE:Q.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case j.e.FIXED_EQUIRECTANGULAR_MODE:Q.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case j.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:Q.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case j.e.CUBIC_MODE:case j.e.INVCUBIC_MODE:default:Q.setReflectionMode("REFLECTIONMAP_CUBIC")}Q.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else Q.REFLECTION=!1,Q.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&v.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;x.e.PrepareDefinesForMergedUV(this._emissiveTexture,Q,"EMISSIVE")}else Q.EMISSIVE=!1;if(this._lightmapTexture&&v.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;x.e.PrepareDefinesForMergedUV(this._lightmapTexture,Q,"LIGHTMAP"),Q.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,Q.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else Q.LIGHTMAP=!1;if(this._specularTexture&&v.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;x.e.PrepareDefinesForMergedUV(this._specularTexture,Q,"SPECULAR"),Q.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else Q.SPECULAR=!1;if(u.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&v.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;x.e.PrepareDefinesForMergedUV(this._bumpTexture,Q,"BUMP"),Q.PARALLAX=this._useParallax,Q.PARALLAXOCCLUSION=this._useParallaxOcclusion,Q.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else Q.BUMP=!1,Q.PARALLAX=!1,Q.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&v.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;Q._needUVs=!0,Q.REFRACTION=!0,Q.REFRACTIONMAP_3D=this._refractionTexture.isCube,Q.RGBDREFRACTION=this._refractionTexture.isRGBD,Q.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else Q.REFRACTION=!1;Q.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else Q.DIFFUSE=!1,Q.AMBIENT=!1,Q.OPACITY=!1,Q.REFLECTION=!1,Q.EMISSIVE=!1,Q.LIGHTMAP=!1,Q.BUMP=!1,Q.REFRACTION=!1;Q.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),Q.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,Q.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,Q.SPECULAROVERALPHA=this._useSpecularOverAlpha,Q.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,Q.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,Q.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(w)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Q,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(Q._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(Q),Q.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,Q.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(Q._areFresnelDirty&&(v.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(Q.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,Q.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,Q.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,Q.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,Q.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,Q.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,Q._needNormals=!0,Q.FRESNEL=!0):Q.FRESNEL=!1),x.e.PrepareDefinesForMisc(w,u,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(w)||this._forceAlphaTest,Q),x.e.PrepareDefinesForFrameBoundValues(u,K,Q,P,null,I.getRenderingMesh().hasThinInstances),this._eventInfo.defines=Q,this._eventInfo.mesh=w,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),x.e.PrepareDefinesForAttributes(w,Q,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo),Q.isDirty){var g=Q._areLightsDisposed;Q.markAsProcessed();var l=new F.b;Q.REFLECTION&&l.addFallback(0,"REFLECTION"),Q.SPECULAR&&l.addFallback(0,"SPECULAR"),Q.BUMP&&l.addFallback(0,"BUMP"),Q.PARALLAX&&l.addFallback(1,"PARALLAX"),Q.PARALLAXOCCLUSION&&l.addFallback(0,"PARALLAXOCCLUSION"),Q.SPECULAROVERALPHA&&l.addFallback(0,"SPECULAROVERALPHA"),Q.FOG&&l.addFallback(1,"FOG"),Q.POINTSIZE&&l.addFallback(0,"POINTSIZE"),Q.LOGARITHMICDEPTH&&l.addFallback(0,"LOGARITHMICDEPTH"),x.e.HandleFallbacksForShadows(Q,l,this._maxSimultaneousLights),Q.SPECULARTERM&&l.addFallback(0,"SPECULARTERM"),Q.DIFFUSEFRESNEL&&l.addFallback(1,"DIFFUSEFRESNEL"),Q.OPACITYFRESNEL&&l.addFallback(2,"OPACITYFRESNEL"),Q.REFLECTIONFRESNEL&&l.addFallback(3,"REFLECTIONFRESNEL"),Q.EMISSIVEFRESNEL&&l.addFallback(4,"EMISSIVEFRESNEL"),Q.FRESNEL&&l.addFallback(4,"FRESNEL"),Q.MULTIVIEW&&l.addFallback(0,"MULTIVIEW");var R=[p.f.PositionKind];Q.NORMAL&&R.push(p.f.NormalKind),Q.TANGENT&&R.push(p.f.TangentKind);for(U=1;U<=6;++U)Q["UV"+U]&&R.push("uv".concat(1===U?"":U));Q.VERTEXCOLOR&&R.push(p.f.ColorKind),x.e.PrepareAttributesForBones(R,w,Q,l),x.e.PrepareAttributesForInstances(R,Q),x.e.PrepareAttributesForMorphTargets(R,w,Q),x.e.PrepareAttributesForBakedVertexAnimation(R,w,Q);var s="default",B=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],t=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],i=["Material","Scene","Mesh"];this._eventInfo.fallbacks=l,this._eventInfo.fallbackRank=0,this._eventInfo.defines=Q,this._eventInfo.uniforms=B,this._eventInfo.attributes=R,this._eventInfo.samplers=t,this._eventInfo.uniformBuffersNames=i,this._eventInfo.customCode=void 0,this._eventInfo.mesh=w,this._callbackPluginEventGeneric(J.d.PrepareEffect,this._eventInfo),r.c.AddUniforms(B),r.c.AddSamplers(t),Y.e&&(Y.e.PrepareUniforms(B,Q),Y.e.PrepareSamplers(t,Q)),x.e.PrepareUniformsAndSamplersList({uniformsNames:B,uniformBuffersNames:i,samplers:t,defines:Q,maxSimultaneousLights:this._maxSimultaneousLights});var z={};this.customShaderNameResolve&&(s=this.customShaderNameResolve(s,B,i,t,Q,R,z));var E=Q.toString(),o=I.effect,h=u.getEngine().createEffect(s,{attributes:R,uniformsNames:B,uniformBuffersNames:i,samplers:t,defines:E,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:Q.NUM_MORPH_INFLUENCERS},processFinalCode:z.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:Q.PREPASS},K);if(h)if(this._onEffectCreatedObservable&&(N.effect=h,N.subMesh=I,this._onEffectCreatedObservable.notifyObservers(N)),this.allowShaderHotSwapping&&o&&!h.isReady()){if(h=o,Q.markAsUnprocessed(),g)return Q._areLightsDisposed=!0,!1}else u.resetCachedMaterial(),I.setEffect(h,Q,this._materialContext)}return!(!I.effect||!I.effect.isReady())&&(Q._renderId=u.getRenderId(),I.effect._wasPreviouslyReady=!0,I.effect._wasPreviouslyUsingInstances=P,!0)},v.prototype.buildUniformLayout=function(){var v=this._uniformBuffer;v.addUniform("diffuseLeftColor",4),v.addUniform("diffuseRightColor",4),v.addUniform("opacityParts",4),v.addUniform("reflectionLeftColor",4),v.addUniform("reflectionRightColor",4),v.addUniform("refractionLeftColor",4),v.addUniform("refractionRightColor",4),v.addUniform("emissiveLeftColor",4),v.addUniform("emissiveRightColor",4),v.addUniform("vDiffuseInfos",2),v.addUniform("vAmbientInfos",2),v.addUniform("vOpacityInfos",2),v.addUniform("vReflectionInfos",2),v.addUniform("vReflectionPosition",3),v.addUniform("vReflectionSize",3),v.addUniform("vEmissiveInfos",2),v.addUniform("vLightmapInfos",2),v.addUniform("vSpecularInfos",2),v.addUniform("vBumpInfos",3),v.addUniform("diffuseMatrix",16),v.addUniform("ambientMatrix",16),v.addUniform("opacityMatrix",16),v.addUniform("reflectionMatrix",16),v.addUniform("emissiveMatrix",16),v.addUniform("lightmapMatrix",16),v.addUniform("specularMatrix",16),v.addUniform("bumpMatrix",16),v.addUniform("vTangentSpaceParams",2),v.addUniform("pointSize",1),v.addUniform("alphaCutOff",1),v.addUniform("refractionMatrix",16),v.addUniform("vRefractionInfos",4),v.addUniform("vRefractionPosition",3),v.addUniform("vRefractionSize",3),v.addUniform("vSpecularColor",4),v.addUniform("vEmissiveColor",3),v.addUniform("vDiffuseColor",4),v.addUniform("vAmbientColor",3),w.prototype.buildUniformLayout.call(this)},v.prototype.bindForSubMesh=function(w,I,P){var u,Q=this.getScene(),a=P.materialDefines;if(a){var p=P.effect;if(p){this._activeEffect=p,I.getMeshUniformBuffer().bindToEffect(p,"Mesh"),I.transferToEffect(w),this._uniformBuffer.bindToEffect(p,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,Q,I,w,this.isFrozen),this._eventInfo.subMesh=P,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),a.OBJECTSPACE_NORMALMAP&&(w.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var r=this._mustRebind(Q,p,I.visibility);x.e.BindBonesParameters(I,p);var Y=this._uniformBuffer;if(r){if(this.bindViewProjection(p),!Y.useUbo||!this.isFrozen||!Y.isSync){if(v.FresnelEnabled&&a.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(Y.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),Y.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&Y.updateColor4("opacityParts",new U.b(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(Y.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),Y.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(Y.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),Y.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(Y.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),Y.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),Q.texturesEnabled){if(this._diffuseTexture&&v.DiffuseTextureEnabled&&(Y.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),x.e.BindTextureMatrix(this._diffuseTexture,Y,"diffuse")),this._ambientTexture&&v.AmbientTextureEnabled&&(Y.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),x.e.BindTextureMatrix(this._ambientTexture,Y,"ambient")),this._opacityTexture&&v.OpacityTextureEnabled&&(Y.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),x.e.BindTextureMatrix(this._opacityTexture,Y,"opacity")),this._hasAlphaChannel()&&Y.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&v.ReflectionTextureEnabled&&(Y.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),Y.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var g=this._reflectionTexture;Y.updateVector3("vReflectionPosition",g.boundingBoxPosition),Y.updateVector3("vReflectionSize",g.boundingBoxSize)}if(this._emissiveTexture&&v.EmissiveTextureEnabled&&(Y.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),x.e.BindTextureMatrix(this._emissiveTexture,Y,"emissive")),this._lightmapTexture&&v.LightmapTextureEnabled&&(Y.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),x.e.BindTextureMatrix(this._lightmapTexture,Y,"lightmap")),this._specularTexture&&v.SpecularTextureEnabled&&(Y.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),x.e.BindTextureMatrix(this._specularTexture,Y,"specular")),this._bumpTexture&&Q.getEngine().getCaps().standardDerivatives&&v.BumpTextureEnabled&&(Y.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),x.e.BindTextureMatrix(this._bumpTexture,Y,"bump"),Q._mirroredCameraPosition?Y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):Y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&v.RefractionTextureEnabled){var J=1;if(this._refractionTexture.isCube||(Y.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(J=this._refractionTexture.depth)),Y.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,J,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){g=this._refractionTexture;Y.updateVector3("vRefractionPosition",g.boundingBoxPosition),Y.updateVector3("vRefractionSize",g.boundingBoxSize)}}}this.pointsCloud&&Y.updateFloat("pointSize",this.pointSize),a.SPECULARTERM&&Y.updateColor4("vSpecularColor",this.specularColor,this.specularPower),Y.updateColor3("vEmissiveColor",v.EmissiveTextureEnabled?this.emissiveColor:U.b.BlackReadOnly),Y.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),Q.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),Y.updateColor3("vAmbientColor",this._globalAmbientColor)}Q.texturesEnabled&&(this._diffuseTexture&&v.DiffuseTextureEnabled&&p.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&v.AmbientTextureEnabled&&p.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&v.OpacityTextureEnabled&&p.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&v.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?p.setTexture("reflectionCubeSampler",this._reflectionTexture):p.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&v.EmissiveTextureEnabled&&p.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&v.LightmapTextureEnabled&&p.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&v.SpecularTextureEnabled&&p.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&Q.getEngine().getCaps().standardDerivatives&&v.BumpTextureEnabled&&p.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&v.RefractionTextureEnabled&&(this._refractionTexture.isCube?p.setTexture("refractionCubeSampler",this._refractionTexture):p.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(I)&&this.getScene().depthPeelingRenderer.bind(p),this._eventInfo.subMesh=P,this._callbackPluginEventBindForSubMesh(this._eventInfo),x.e.BindClipPlane(p,Q),this.bindEyePosition(p)}else Q.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!r&&this.isFrozen||(Q.lightsEnabled&&!this._disableLighting&&x.e.BindLights(Q,I,p,a,this._maxSimultaneousLights),(Q.fogEnabled&&I.applyFog&&Q.fogMode!==K.d.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||I.receiveShadows||a.PREPASS)&&this.bindView(p),x.e.BindFogParameters(Q,I,p),a.NUM_MORPH_INFLUENCERS&&x.e.BindMorphTargetParameters(I,p),a.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(u=I.bakedVertexAnimationManager)||void 0===u||u.bind(p,a.INSTANCES)),this.useLogarithmicDepth&&x.e.BindLogDepth(a,p,Q),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(I,this._activeEffect),Y.update()}}},v.prototype.getAnimatables=function(){var v=w.prototype.getAnimatables.call(this);return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&v.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&v.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&v.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&v.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&v.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&v.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&v.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&v.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&v.push(this._refractionTexture),v},v.prototype.getActiveTextures=function(){var v=w.prototype.getActiveTextures.call(this);return this._diffuseTexture&&v.push(this._diffuseTexture),this._ambientTexture&&v.push(this._ambientTexture),this._opacityTexture&&v.push(this._opacityTexture),this._reflectionTexture&&v.push(this._reflectionTexture),this._emissiveTexture&&v.push(this._emissiveTexture),this._specularTexture&&v.push(this._specularTexture),this._bumpTexture&&v.push(this._bumpTexture),this._lightmapTexture&&v.push(this._lightmapTexture),this._refractionTexture&&v.push(this._refractionTexture),v},v.prototype.hasTexture=function(v){return!!w.prototype.hasTexture.call(this,v)||(this._diffuseTexture===v||(this._ambientTexture===v||(this._opacityTexture===v||(this._reflectionTexture===v||(this._emissiveTexture===v||(this._specularTexture===v||(this._bumpTexture===v||(this._lightmapTexture===v||this._refractionTexture===v))))))))},v.prototype.dispose=function(v,I){var P,u,Q,K,a,U,p,r,Y;I&&(null===(P=this._diffuseTexture)||void 0===P||P.dispose(),null===(u=this._ambientTexture)||void 0===u||u.dispose(),null===(Q=this._opacityTexture)||void 0===Q||Q.dispose(),null===(K=this._reflectionTexture)||void 0===K||K.dispose(),null===(a=this._emissiveTexture)||void 0===a||a.dispose(),null===(U=this._specularTexture)||void 0===U||U.dispose(),null===(p=this._bumpTexture)||void 0===p||p.dispose(),null===(r=this._lightmapTexture)||void 0===r||r.dispose(),null===(Y=this._refractionTexture)||void 0===Y||Y.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),w.prototype.dispose.call(this,v,I)},v.prototype.clone=function(w){var I=this,P=u.e.Clone((function(){return new v(w,I.getScene())}),this);return P.name=w,P.id=w,this.stencil.copyTo(P.stencil),P},v.Parse=function(w,I,P){var Q=u.e.Parse((function(){return new v(w.name,I)}),w,I,P);return w.stencil&&Q.stencil.parse(w.stencil,I,P),Q},Object.defineProperty(v,"DiffuseTextureEnabled",{get:function(){return B.d.DiffuseTextureEnabled},set:function(w){B.d.DiffuseTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"DetailTextureEnabled",{get:function(){return B.d.DetailTextureEnabled},set:function(w){B.d.DetailTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"AmbientTextureEnabled",{get:function(){return B.d.AmbientTextureEnabled},set:function(w){B.d.AmbientTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"OpacityTextureEnabled",{get:function(){return B.d.OpacityTextureEnabled},set:function(w){B.d.OpacityTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"ReflectionTextureEnabled",{get:function(){return B.d.ReflectionTextureEnabled},set:function(w){B.d.ReflectionTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"EmissiveTextureEnabled",{get:function(){return B.d.EmissiveTextureEnabled},set:function(w){B.d.EmissiveTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"SpecularTextureEnabled",{get:function(){return B.d.SpecularTextureEnabled},set:function(w){B.d.SpecularTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"BumpTextureEnabled",{get:function(){return B.d.BumpTextureEnabled},set:function(w){B.d.BumpTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"LightmapTextureEnabled",{get:function(){return B.d.LightmapTextureEnabled},set:function(w){B.d.LightmapTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"RefractionTextureEnabled",{get:function(){return B.d.RefractionTextureEnabled},set:function(w){B.d.RefractionTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"ColorGradingTextureEnabled",{get:function(){return B.d.ColorGradingTextureEnabled},set:function(w){B.d.ColorGradingTextureEnabled=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"FresnelEnabled",{get:function(){return B.d.FresnelEnabled},set:function(w){B.d.FresnelEnabled=w},enumerable:!1,configurable:!0}),(0,P.i)([(0,u.B)("diffuseTexture")],v.prototype,"_diffuseTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"diffuseTexture",void 0),(0,P.i)([(0,u.B)("ambientTexture")],v.prototype,"_ambientTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTexture",void 0),(0,P.i)([(0,u.B)("opacityTexture")],v.prototype,"_opacityTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"opacityTexture",void 0),(0,P.i)([(0,u.B)("reflectionTexture")],v.prototype,"_reflectionTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectionTexture",void 0),(0,P.i)([(0,u.B)("emissiveTexture")],v.prototype,"_emissiveTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveTexture",void 0),(0,P.i)([(0,u.B)("specularTexture")],v.prototype,"_specularTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"specularTexture",void 0),(0,P.i)([(0,u.B)("bumpTexture")],v.prototype,"_bumpTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"bumpTexture",void 0),(0,P.i)([(0,u.B)("lightmapTexture")],v.prototype,"_lightmapTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"lightmapTexture",void 0),(0,P.i)([(0,u.B)("refractionTexture")],v.prototype,"_refractionTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"refractionTexture",void 0),(0,P.i)([(0,u.n)("ambient")],v.prototype,"ambientColor",void 0),(0,P.i)([(0,u.n)("diffuse")],v.prototype,"diffuseColor",void 0),(0,P.i)([(0,u.n)("specular")],v.prototype,"specularColor",void 0),(0,P.i)([(0,u.n)("emissive")],v.prototype,"emissiveColor",void 0),(0,P.i)([(0,u.J)()],v.prototype,"specularPower",void 0),(0,P.i)([(0,u.J)("useAlphaFromDiffuseTexture")],v.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"useAlphaFromDiffuseTexture",void 0),(0,P.i)([(0,u.J)("useEmissiveAsIllumination")],v.prototype,"_useEmissiveAsIllumination",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useEmissiveAsIllumination",void 0),(0,P.i)([(0,u.J)("linkEmissiveWithDiffuse")],v.prototype,"_linkEmissiveWithDiffuse",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"linkEmissiveWithDiffuse",void 0),(0,P.i)([(0,u.J)("useSpecularOverAlpha")],v.prototype,"_useSpecularOverAlpha",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useSpecularOverAlpha",void 0),(0,P.i)([(0,u.J)("useReflectionOverAlpha")],v.prototype,"_useReflectionOverAlpha",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useReflectionOverAlpha",void 0),(0,P.i)([(0,u.J)("disableLighting")],v.prototype,"_disableLighting",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsLightsDirty")],v.prototype,"disableLighting",void 0),(0,P.i)([(0,u.J)("useObjectSpaceNormalMap")],v.prototype,"_useObjectSpaceNormalMap",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useObjectSpaceNormalMap",void 0),(0,P.i)([(0,u.J)("useParallax")],v.prototype,"_useParallax",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallax",void 0),(0,P.i)([(0,u.J)("useParallaxOcclusion")],v.prototype,"_useParallaxOcclusion",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallaxOcclusion",void 0),(0,P.i)([(0,u.J)()],v.prototype,"parallaxScaleBias",void 0),(0,P.i)([(0,u.J)("roughness")],v.prototype,"_roughness",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,P.i)([(0,u.J)()],v.prototype,"indexOfRefraction",void 0),(0,P.i)([(0,u.J)()],v.prototype,"invertRefractionY",void 0),(0,P.i)([(0,u.J)()],v.prototype,"alphaCutOff",void 0),(0,P.i)([(0,u.J)("useLightmapAsShadowmap")],v.prototype,"_useLightmapAsShadowmap",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useLightmapAsShadowmap",void 0),(0,P.i)([(0,u.t)("diffuseFresnelParameters")],v.prototype,"_diffuseFresnelParameters",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"diffuseFresnelParameters",void 0),(0,P.i)([(0,u.t)("opacityFresnelParameters")],v.prototype,"_opacityFresnelParameters",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsFresnelAndMiscDirty")],v.prototype,"opacityFresnelParameters",void 0),(0,P.i)([(0,u.t)("reflectionFresnelParameters")],v.prototype,"_reflectionFresnelParameters",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"reflectionFresnelParameters",void 0),(0,P.i)([(0,u.t)("refractionFresnelParameters")],v.prototype,"_refractionFresnelParameters",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"refractionFresnelParameters",void 0),(0,P.i)([(0,u.t)("emissiveFresnelParameters")],v.prototype,"_emissiveFresnelParameters",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"emissiveFresnelParameters",void 0),(0,P.i)([(0,u.J)("useReflectionFresnelFromSpecular")],v.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"useReflectionFresnelFromSpecular",void 0),(0,P.i)([(0,u.J)("useGlossinessFromSpecularMapAlpha")],v.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,P.i)([(0,u.J)("maxSimultaneousLights")],v.prototype,"_maxSimultaneousLights",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsLightsDirty")],v.prototype,"maxSimultaneousLights",void 0),(0,P.i)([(0,u.J)("invertNormalMapX")],v.prototype,"_invertNormalMapX",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapX",void 0),(0,P.i)([(0,u.J)("invertNormalMapY")],v.prototype,"_invertNormalMapY",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapY",void 0),(0,P.i)([(0,u.J)("twoSidedLighting")],v.prototype,"_twoSidedLighting",void 0),(0,P.i)([(0,u.h)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"twoSidedLighting",void 0),(0,P.i)([(0,u.J)()],v.prototype,"useLogarithmicDepth",null),v}(R.d);(0,s.g)("BABYLON.StandardMaterial",m),K.d.DefaultMaterialFactory=function(w){return new m("default material",w)}},86018:function(w,v,I){"use strict";I.d(v,{e:function(){return P}});var P=function(){function w(){}return w.BindClipPlane=function(w,v){if(v.clipPlane){var I=v.clipPlane;w.setFloat4("vClipPlane",I.normal.x,I.normal.y,I.normal.z,I.d)}if(v.clipPlane2){I=v.clipPlane2;w.setFloat4("vClipPlane2",I.normal.x,I.normal.y,I.normal.z,I.d)}if(v.clipPlane3){I=v.clipPlane3;w.setFloat4("vClipPlane3",I.normal.x,I.normal.y,I.normal.z,I.d)}if(v.clipPlane4){I=v.clipPlane4;w.setFloat4("vClipPlane4",I.normal.x,I.normal.y,I.normal.z,I.d)}if(v.clipPlane5){I=v.clipPlane5;w.setFloat4("vClipPlane5",I.normal.x,I.normal.y,I.normal.z,I.d)}if(v.clipPlane6){I=v.clipPlane6;w.setFloat4("vClipPlane6",I.normal.x,I.normal.y,I.normal.z,I.d)}},w}()},90534:function(w,v,I){"use strict";I.d(v,{b:function(){return a}});var P=I(9127),u=I(9217),Q=I(72284),K=I(12753);Q.d.prototype.createUniformBuffer=function(w){var v=this._gl.createBuffer();if(!v)throw new Error("Unable to create uniform buffer");var I=new K.e(v);return this.bindUniformBuffer(I),w instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,w,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(w),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),I.references=1,I},Q.d.prototype.createDynamicUniformBuffer=function(w){var v=this._gl.createBuffer();if(!v)throw new Error("Unable to create dynamic uniform buffer");var I=new K.e(v);return this.bindUniformBuffer(I),w instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,w,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(w),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),I.references=1,I},Q.d.prototype.updateUniformBuffer=function(w,v,I,P){this.bindUniformBuffer(w),void 0===I&&(I=0),void 0===P?v instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,I,v):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,I,new Float32Array(v)):v instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,v.subarray(I,I+P)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(v).subarray(I,I+P)),this.bindUniformBuffer(null)},Q.d.prototype.bindUniformBuffer=function(w){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,w?w.underlyingResource:null)},Q.d.prototype.bindUniformBufferBase=function(w,v,I){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,v,w?w.underlyingResource:null)},Q.d.prototype.bindUniformBlock=function(w,v,I){var P=w.program,u=this._gl.getUniformBlockIndex(P,v);4294967295!==u&&this._gl.uniformBlockBinding(P,u,I)};var a=function(){function w(w,v,I,P,u){void 0===u&&(u=!1),this._valueCache={},this._engine=w,this._noUBO=!w.supportsUniformBuffers||u,this._dynamic=I,this._name=null!==P&&void 0!==P?P:"no-name",this._data=v||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return Object.defineProperty(w.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),w.prototype.isDynamic=function(){return void 0!==this._dynamic},w.prototype.getData=function(){return this._bufferData},w.prototype.getBuffer=function(){return this._buffer},w.prototype._fillAlignment=function(w){var v;if(v=w<=2?w:4,this._uniformLocationPointer%v!==0){var I=this._uniformLocationPointer;this._uniformLocationPointer+=v-this._uniformLocationPointer%v;for(var P=this._uniformLocationPointer-I,u=0;u<P;u++)this._data.push(0)}},w.prototype.addUniform=function(w,v,I){if(void 0===I&&(I=0),!this._noUBO&&void 0===this._uniformLocations[w]){var P;if(I>0){if(v instanceof Array)throw"addUniform should not be use with Array in UBO: "+w;if(this._fillAlignment(4),this._uniformArraySizes[w]={strideSize:v,arraySize:I},16==v)v*=I;else v=v*I+(4-v)*I;P=[];for(var u=0;u<v;u++)P.push(0)}else{if(v instanceof Array)v=(P=v).length;else{v=v,P=[];for(u=0;u<v;u++)P.push(0)}this._fillAlignment(v)}this._uniformSizes[w]=v,this._uniformLocations[w]=this._uniformLocationPointer,this._uniformLocationPointer+=v;for(u=0;u<v;u++)this._data.push(P[u]);this._needSync=!0}},w.prototype.addMatrix=function(w,v){this.addUniform(w,Array.prototype.slice.call(v.toArray()))},w.prototype.addFloat2=function(w,v,I){var P=[v,I];this.addUniform(w,P)},w.prototype.addFloat3=function(w,v,I,P){var u=[v,I,P];this.addUniform(w,u)},w.prototype.addColor3=function(w,v){var I=[v.r,v.g,v.b];this.addUniform(w,I)},w.prototype.addColor4=function(w,v,I){var P=[v.r,v.g,v.b,I];this.addUniform(w,P)},w.prototype.addVector3=function(w,v){var I=[v.x,v.y,v.z];this.addUniform(w,I)},w.prototype.addMatrix3x3=function(w){this.addUniform(w,12)},w.prototype.addMatrix2x2=function(w){this.addUniform(w,8)},w.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},w.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(w.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),w.prototype._buffersEqual=function(w,v){for(var I=0;I<w.length;++I)if(w[I]!==v[I])return!1;return!0},w.prototype._copyBuffer=function(w,v){for(var I=0;I<w.length;++I)v[I]=w[I]},w.prototype.update=function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(w._UpdatedUbosInFrame[this._name]||(w._UpdatedUbosInFrame[this._name]=0),w._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()},w.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()},w.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)},w.prototype.updateUniform=function(w,v,I){this._checkNewFrame();var Q=this._uniformLocations[w];if(void 0===Q){if(this._buffer)return void P.e.Error("Cannot add an uniform after UBO has been created.");this.addUniform(w,I),Q=this._uniformLocations[w]}if(this._buffer||this.create(),this._dynamic)for(a=0;a<I;a++)this._bufferData[Q+a]=v[a];else{for(var K=!1,a=0;a<I;a++)(16===I&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[Q+a]!==u.i.FloatRound(v[a]))&&(K=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[Q+a]=v[a]);this._needSync=this._needSync||K}},w.prototype.updateUniformArray=function(w,v,I){this._checkNewFrame();var Q=this._uniformLocations[w];if(void 0!==Q){this._buffer||this.create();var K=this._uniformArraySizes[w];if(this._dynamic)for(r=0;r<I;r++)this._bufferData[Q+r]=v[r];else{for(var a=!1,U=0,p=0,r=0;r<I;r++)if(this._bufferData[Q+4*p+U]!==u.i.FloatRound(v[r])&&(a=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[Q+4*p+U]=v[r]),++U===K.strideSize){for(;U<4;U++)this._bufferData[Q+4*p+U]=0;U=0,p++}this._needSync=this._needSync||a}}else P.e.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.")},w.prototype._cacheMatrix=function(w,v){this._checkNewFrame();var I=this._valueCache[w],P=v.updateFlag;return(void 0===I||I!==P)&&(this._valueCache[w]=P,!0)},w.prototype._updateMatrix3x3ForUniform=function(v,I){for(var P=0;P<3;P++)w._TempBuffer[4*P]=I[3*P],w._TempBuffer[4*P+1]=I[3*P+1],w._TempBuffer[4*P+2]=I[3*P+2],w._TempBuffer[4*P+3]=0;this.updateUniform(v,w._TempBuffer,12)},w.prototype._updateMatrix3x3ForEffect=function(w,v){this._currentEffect.setMatrix3x3(w,v)},w.prototype._updateMatrix2x2ForEffect=function(w,v){this._currentEffect.setMatrix2x2(w,v)},w.prototype._updateMatrix2x2ForUniform=function(v,I){for(var P=0;P<2;P++)w._TempBuffer[4*P]=I[2*P],w._TempBuffer[4*P+1]=I[2*P+1],w._TempBuffer[4*P+2]=0,w._TempBuffer[4*P+3]=0;this.updateUniform(v,w._TempBuffer,8)},w.prototype._updateFloatForEffect=function(w,v){this._currentEffect.setFloat(w,v)},w.prototype._updateFloatForUniform=function(v,I){w._TempBuffer[0]=I,this.updateUniform(v,w._TempBuffer,1)},w.prototype._updateFloat2ForEffect=function(w,v,I,P){void 0===P&&(P=""),this._currentEffect.setFloat2(w+P,v,I)},w.prototype._updateFloat2ForUniform=function(v,I,P){w._TempBuffer[0]=I,w._TempBuffer[1]=P,this.updateUniform(v,w._TempBuffer,2)},w.prototype._updateFloat3ForEffect=function(w,v,I,P,u){void 0===u&&(u=""),this._currentEffect.setFloat3(w+u,v,I,P)},w.prototype._updateFloat3ForUniform=function(v,I,P,u){w._TempBuffer[0]=I,w._TempBuffer[1]=P,w._TempBuffer[2]=u,this.updateUniform(v,w._TempBuffer,3)},w.prototype._updateFloat4ForEffect=function(w,v,I,P,u,Q){void 0===Q&&(Q=""),this._currentEffect.setFloat4(w+Q,v,I,P,u)},w.prototype._updateFloat4ForUniform=function(v,I,P,u,Q){w._TempBuffer[0]=I,w._TempBuffer[1]=P,w._TempBuffer[2]=u,w._TempBuffer[3]=Q,this.updateUniform(v,w._TempBuffer,4)},w.prototype._updateFloatArrayForEffect=function(w,v){this._currentEffect.setFloatArray(w,v)},w.prototype._updateFloatArrayForUniform=function(w,v){this.updateUniformArray(w,v,v.length)},w.prototype._updateArrayForEffect=function(w,v){this._currentEffect.setArray(w,v)},w.prototype._updateArrayForUniform=function(w,v){this.updateUniformArray(w,v,v.length)},w.prototype._updateIntArrayForEffect=function(w,v){this._currentEffect.setIntArray(w,v)},w.prototype._updateIntArrayForUniform=function(v,I){w._TempBufferInt32View.set(I),this.updateUniformArray(v,w._TempBuffer,I.length)},w.prototype._updateMatrixForEffect=function(w,v){this._currentEffect.setMatrix(w,v)},w.prototype._updateMatrixForUniform=function(w,v){this._cacheMatrix(w,v)&&this.updateUniform(w,v.toArray(),16)},w.prototype._updateMatricesForEffect=function(w,v){this._currentEffect.setMatrices(w,v)},w.prototype._updateMatricesForUniform=function(w,v){this.updateUniform(w,v,v.length)},w.prototype._updateVector3ForEffect=function(w,v){this._currentEffect.setVector3(w,v)},w.prototype._updateVector3ForUniform=function(v,I){w._TempBuffer[0]=I.x,w._TempBuffer[1]=I.y,w._TempBuffer[2]=I.z,this.updateUniform(v,w._TempBuffer,3)},w.prototype._updateVector4ForEffect=function(w,v){this._currentEffect.setVector4(w,v)},w.prototype._updateVector4ForUniform=function(v,I){w._TempBuffer[0]=I.x,w._TempBuffer[1]=I.y,w._TempBuffer[2]=I.z,w._TempBuffer[3]=I.w,this.updateUniform(v,w._TempBuffer,4)},w.prototype._updateColor3ForEffect=function(w,v,I){void 0===I&&(I=""),this._currentEffect.setColor3(w+I,v)},w.prototype._updateColor3ForUniform=function(v,I){w._TempBuffer[0]=I.r,w._TempBuffer[1]=I.g,w._TempBuffer[2]=I.b,this.updateUniform(v,w._TempBuffer,3)},w.prototype._updateColor4ForEffect=function(w,v,I,P){void 0===P&&(P=""),this._currentEffect.setColor4(w+P,v,I)},w.prototype._updateDirectColor4ForEffect=function(w,v,I){void 0===I&&(I=""),this._currentEffect.setDirectColor4(w+I,v)},w.prototype._updateColor4ForUniform=function(v,I,P){w._TempBuffer[0]=I.r,w._TempBuffer[1]=I.g,w._TempBuffer[2]=I.b,w._TempBuffer[3]=P,this.updateUniform(v,w._TempBuffer,4)},w.prototype._updateDirectColor4ForUniform=function(v,I){w._TempBuffer[0]=I.r,w._TempBuffer[1]=I.g,w._TempBuffer[2]=I.b,w._TempBuffer[3]=I.a,this.updateUniform(v,w._TempBuffer,4)},w.prototype._updateIntForEffect=function(w,v,I){void 0===I&&(I=""),this._currentEffect.setInt(w+I,v)},w.prototype._updateIntForUniform=function(v,I){w._TempBufferInt32View[0]=I,this.updateUniform(v,w._TempBuffer,1)},w.prototype._updateInt2ForEffect=function(w,v,I,P){void 0===P&&(P=""),this._currentEffect.setInt2(w+P,v,I)},w.prototype._updateInt2ForUniform=function(v,I,P){w._TempBufferInt32View[0]=I,w._TempBufferInt32View[1]=P,this.updateUniform(v,w._TempBuffer,2)},w.prototype._updateInt3ForEffect=function(w,v,I,P,u){void 0===u&&(u=""),this._currentEffect.setInt3(w+u,v,I,P)},w.prototype._updateInt3ForUniform=function(v,I,P,u){w._TempBufferInt32View[0]=I,w._TempBufferInt32View[1]=P,w._TempBufferInt32View[2]=u,this.updateUniform(v,w._TempBuffer,3)},w.prototype._updateInt4ForEffect=function(w,v,I,P,u,Q){void 0===Q&&(Q=""),this._currentEffect.setInt4(w+Q,v,I,P,u)},w.prototype._updateInt4ForUniform=function(v,I,P,u,Q){w._TempBufferInt32View[0]=I,w._TempBufferInt32View[1]=P,w._TempBufferInt32View[2]=u,w._TempBufferInt32View[3]=Q,this.updateUniform(v,w._TempBuffer,4)},w.prototype.setTexture=function(w,v){this._currentEffect.setTexture(w,v)},w.prototype.updateUniformDirectly=function(w,v){this.updateUniform(w,v,v.length),this.update()},w.prototype.bindToEffect=function(w,v){this._currentEffect=w,this._currentEffectName=v},w.prototype.bindUniformBuffer=function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},w.prototype.unbindEffect=function(){this._currentEffect=void 0,this._currentEffectName=void 0},w.prototype.setDataBuffer=function(w){if(!this._buffers)return this._buffer===w;for(var v=0;v<this._buffers.length;++v){if(this._buffers[v][0]===w)return this._bufferIndex=v,this._buffer=w,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1},w.prototype.dispose=function(){if(!this._noUBO){var w=this._engine._uniformBuffers,v=w.indexOf(this);if(-1!==v&&(w[v]=w[w.length-1],w.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var I=0;I<this._buffers.length;++I){var P=this._buffers[I][0];this._engine._releaseBuffer(P)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},w._UpdatedUbosInFrame={},w._MAX_UNIFORM_SIZE=256,w._TempBuffer=new Float32Array(w._MAX_UNIFORM_SIZE),w._TempBufferInt32View=new Uint32Array(w._TempBuffer.buffer),w}()},54044:function(w,v,I){"use strict";I.d(v,{c:function(){return K},g:function(){return Q},j:function(){return P}});var P,u=I(80105);!function(w){w[w.LOCAL=0]="LOCAL",w[w.WORLD=1]="WORLD",w[w.BONE=2]="BONE"}(P||(P={}));var Q,K=function(){function w(){}return w.X=new u.l(1,0,0),w.Y=new u.l(0,1,0),w.Z=new u.l(0,0,1),w}();!function(w){w[w.X=0]="X",w[w.Y=1]="Y",w[w.Z=2]="Z"}(Q||(Q={}))},9488:function(w,v,I){"use strict";I.d(v,{b:function(){return a},f:function(){return U},g:function(){return p}});var P=I(96658),u=I(61686),Q=I(89214),K=I(31709),a=function(){function w(w,v,I){void 0===w&&(w=0),void 0===v&&(v=0),void 0===I&&(I=0),this.r=w,this.g=v,this.b=I}return w.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},w.prototype.getClassName=function(){return"Color3"},w.prototype.getHashCode=function(){var w=255*this.r|0;return w=397*(w=397*w^(255*this.g|0))^(255*this.b|0)},w.prototype.toArray=function(w,v){return void 0===v&&(v=0),w[v]=this.r,w[v+1]=this.g,w[v+2]=this.b,this},w.prototype.fromArray=function(v,I){return void 0===I&&(I=0),w.FromArrayToRef(v,I,this),this},w.prototype.toColor4=function(w){return void 0===w&&(w=1),new U(this.r,this.g,this.b,w)},w.prototype.asArray=function(){return[this.r,this.g,this.b]},w.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},w.prototype.multiply=function(v){return new w(this.r*v.r,this.g*v.g,this.b*v.b)},w.prototype.multiplyToRef=function(w,v){return v.r=this.r*w.r,v.g=this.g*w.g,v.b=this.b*w.b,this},w.prototype.equals=function(w){return w&&this.r===w.r&&this.g===w.g&&this.b===w.b},w.prototype.equalsFloats=function(w,v,I){return this.r===w&&this.g===v&&this.b===I},w.prototype.scale=function(v){return new w(this.r*v,this.g*v,this.b*v)},w.prototype.scaleToRef=function(w,v){return v.r=this.r*w,v.g=this.g*w,v.b=this.b*w,this},w.prototype.scaleAndAddToRef=function(w,v){return v.r+=this.r*w,v.g+=this.g*w,v.b+=this.b*w,this},w.prototype.clampToRef=function(w,v,I){return void 0===w&&(w=0),void 0===v&&(v=1),I.r=P.b.Clamp(this.r,w,v),I.g=P.b.Clamp(this.g,w,v),I.b=P.b.Clamp(this.b,w,v),this},w.prototype.add=function(v){return new w(this.r+v.r,this.g+v.g,this.b+v.b)},w.prototype.addToRef=function(w,v){return v.r=this.r+w.r,v.g=this.g+w.g,v.b=this.b+w.b,this},w.prototype.subtract=function(v){return new w(this.r-v.r,this.g-v.g,this.b-v.b)},w.prototype.subtractToRef=function(w,v){return v.r=this.r-w.r,v.g=this.g-w.g,v.b=this.b-w.b,this},w.prototype.clone=function(){return new w(this.r,this.g,this.b)},w.prototype.copyFrom=function(w){return this.r=w.r,this.g=w.g,this.b=w.b,this},w.prototype.copyFromFloats=function(w,v,I){return this.r=w,this.g=v,this.b=I,this},w.prototype.set=function(w,v,I){return this.copyFromFloats(w,v,I)},w.prototype.toHexString=function(){var w=Math.round(255*this.r),v=Math.round(255*this.g),I=Math.round(255*this.b);return"#"+P.b.ToHex(w)+P.b.ToHex(v)+P.b.ToHex(I)},w.prototype.toLinearSpace=function(){var v=new w;return this.toLinearSpaceToRef(v),v},w.prototype.toHSV=function(){var v=new w;return this.toHSVToRef(v),v},w.prototype.toHSVToRef=function(w){var v=this.r,I=this.g,P=this.b,u=Math.max(v,I,P),Q=Math.min(v,I,P),K=0,a=0,U=u,p=u-Q;0!==u&&(a=p/u),u!=Q&&(u==v?(K=(I-P)/p,I<P&&(K+=6)):u==I?K=(P-v)/p+2:u==P&&(K=(v-I)/p+4),K*=60),w.r=K,w.g=a,w.b=U},w.prototype.toLinearSpaceToRef=function(w){return w.r=Math.pow(this.r,u.l),w.g=Math.pow(this.g,u.l),w.b=Math.pow(this.b,u.l),this},w.prototype.toGammaSpace=function(){var v=new w;return this.toGammaSpaceToRef(v),v},w.prototype.toGammaSpaceToRef=function(w){return w.r=Math.pow(this.r,u.k),w.g=Math.pow(this.g,u.k),w.b=Math.pow(this.b,u.k),this},w.HSVtoRGBToRef=function(w,v,I,P){var u=I*v,Q=w/60,K=u*(1-Math.abs(Q%2-1)),a=0,U=0,p=0;Q>=0&&Q<=1?(a=u,U=K):Q>=1&&Q<=2?(a=K,U=u):Q>=2&&Q<=3?(U=u,p=K):Q>=3&&Q<=4?(U=K,p=u):Q>=4&&Q<=5?(a=K,p=u):Q>=5&&Q<=6&&(a=u,p=K);var r=I-u;P.set(a+r,U+r,p+r)},w.FromHexString=function(v){if("#"!==v.substring(0,1)||7!==v.length)return new w(0,0,0);var I=parseInt(v.substring(1,3),16),P=parseInt(v.substring(3,5),16),u=parseInt(v.substring(5,7),16);return w.FromInts(I,P,u)},w.FromArray=function(v,I){return void 0===I&&(I=0),new w(v[I],v[I+1],v[I+2])},w.FromArrayToRef=function(w,v,I){void 0===v&&(v=0),I.r=w[v],I.g=w[v+1],I.b=w[v+2]},w.FromInts=function(v,I,P){return new w(v/255,I/255,P/255)},w.Lerp=function(v,I,P){var u=new w(0,0,0);return w.LerpToRef(v,I,P,u),u},w.LerpToRef=function(w,v,I,P){P.r=w.r+(v.r-w.r)*I,P.g=w.g+(v.g-w.g)*I,P.b=w.b+(v.b-w.b)*I},w.Hermite=function(v,I,P,u,Q){var K=Q*Q,a=Q*K,U=2*a-3*K+1,p=-2*a+3*K,r=a-2*K+Q,Y=a-K;return new w(v.r*U+P.r*p+I.r*r+u.r*Y,v.g*U+P.g*p+I.g*r+u.g*Y,v.b*U+P.b*p+I.b*r+u.b*Y)},w.Hermite1stDerivative=function(v,I,P,u,Q){var K=w.Black();return this.Hermite1stDerivativeToRef(v,I,P,u,Q,K),K},w.Hermite1stDerivativeToRef=function(w,v,I,P,u,Q){var K=u*u;Q.r=6*(K-u)*w.r+(3*K-4*u+1)*v.r+6*(-K+u)*I.r+(3*K-2*u)*P.r,Q.g=6*(K-u)*w.g+(3*K-4*u+1)*v.g+6*(-K+u)*I.g+(3*K-2*u)*P.g,Q.b=6*(K-u)*w.b+(3*K-4*u+1)*v.b+6*(-K+u)*I.b+(3*K-2*u)*P.b},w.Red=function(){return new w(1,0,0)},w.Green=function(){return new w(0,1,0)},w.Blue=function(){return new w(0,0,1)},w.Black=function(){return new w(0,0,0)},Object.defineProperty(w,"BlackReadOnly",{get:function(){return w._BlackReadOnly},enumerable:!1,configurable:!0}),w.White=function(){return new w(1,1,1)},w.Purple=function(){return new w(.5,0,.5)},w.Magenta=function(){return new w(1,0,1)},w.Yellow=function(){return new w(1,1,0)},w.Gray=function(){return new w(.5,.5,.5)},w.Teal=function(){return new w(0,1,1)},w.Random=function(){return new w(Math.random(),Math.random(),Math.random())},w._BlackReadOnly=w.Black(),w}(),U=function(){function w(w,v,I,P){void 0===w&&(w=0),void 0===v&&(v=0),void 0===I&&(I=0),void 0===P&&(P=1),this.r=w,this.g=v,this.b=I,this.a=P}return w.prototype.addInPlace=function(w){return this.r+=w.r,this.g+=w.g,this.b+=w.b,this.a+=w.a,this},w.prototype.asArray=function(){return[this.r,this.g,this.b,this.a]},w.prototype.toArray=function(w,v){return void 0===v&&(v=0),w[v]=this.r,w[v+1]=this.g,w[v+2]=this.b,w[v+3]=this.a,this},w.prototype.fromArray=function(v,I){return void 0===I&&(I=0),w.FromArrayToRef(v,I,this),this},w.prototype.equals=function(w){return w&&this.r===w.r&&this.g===w.g&&this.b===w.b&&this.a===w.a},w.prototype.add=function(v){return new w(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)},w.prototype.subtract=function(v){return new w(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)},w.prototype.subtractToRef=function(w,v){return v.r=this.r-w.r,v.g=this.g-w.g,v.b=this.b-w.b,v.a=this.a-w.a,this},w.prototype.scale=function(v){return new w(this.r*v,this.g*v,this.b*v,this.a*v)},w.prototype.scaleToRef=function(w,v){return v.r=this.r*w,v.g=this.g*w,v.b=this.b*w,v.a=this.a*w,this},w.prototype.scaleAndAddToRef=function(w,v){return v.r+=this.r*w,v.g+=this.g*w,v.b+=this.b*w,v.a+=this.a*w,this},w.prototype.clampToRef=function(w,v,I){return void 0===w&&(w=0),void 0===v&&(v=1),I.r=P.b.Clamp(this.r,w,v),I.g=P.b.Clamp(this.g,w,v),I.b=P.b.Clamp(this.b,w,v),I.a=P.b.Clamp(this.a,w,v),this},w.prototype.multiply=function(v){return new w(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)},w.prototype.multiplyToRef=function(w,v){return v.r=this.r*w.r,v.g=this.g*w.g,v.b=this.b*w.b,v.a=this.a*w.a,v},w.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},w.prototype.getClassName=function(){return"Color4"},w.prototype.getHashCode=function(){var w=255*this.r|0;return w=397*(w=397*(w=397*w^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},w.prototype.clone=function(){return new w(this.r,this.g,this.b,this.a)},w.prototype.copyFrom=function(w){return this.r=w.r,this.g=w.g,this.b=w.b,this.a=w.a,this},w.prototype.copyFromFloats=function(w,v,I,P){return this.r=w,this.g=v,this.b=I,this.a=P,this},w.prototype.set=function(w,v,I,P){return this.copyFromFloats(w,v,I,P)},w.prototype.toHexString=function(w){void 0===w&&(w=!1);var v=Math.round(255*this.r),I=Math.round(255*this.g),u=Math.round(255*this.b);if(w)return"#"+P.b.ToHex(v)+P.b.ToHex(I)+P.b.ToHex(u);var Q=Math.round(255*this.a);return"#"+P.b.ToHex(v)+P.b.ToHex(I)+P.b.ToHex(u)+P.b.ToHex(Q)},w.prototype.toLinearSpace=function(){var v=new w;return this.toLinearSpaceToRef(v),v},w.prototype.toLinearSpaceToRef=function(w){return w.r=Math.pow(this.r,u.l),w.g=Math.pow(this.g,u.l),w.b=Math.pow(this.b,u.l),w.a=this.a,this},w.prototype.toGammaSpace=function(){var v=new w;return this.toGammaSpaceToRef(v),v},w.prototype.toGammaSpaceToRef=function(w){return w.r=Math.pow(this.r,u.k),w.g=Math.pow(this.g,u.k),w.b=Math.pow(this.b,u.k),w.a=this.a,this},w.FromHexString=function(v){if("#"!==v.substring(0,1)||9!==v.length&&7!==v.length)return new w(0,0,0,0);var I=parseInt(v.substring(1,3),16),P=parseInt(v.substring(3,5),16),u=parseInt(v.substring(5,7),16),Q=9===v.length?parseInt(v.substring(7,9),16):255;return w.FromInts(I,P,u,Q)},w.Lerp=function(v,I,P){var u=new w(0,0,0,0);return w.LerpToRef(v,I,P,u),u},w.LerpToRef=function(w,v,I,P){P.r=w.r+(v.r-w.r)*I,P.g=w.g+(v.g-w.g)*I,P.b=w.b+(v.b-w.b)*I,P.a=w.a+(v.a-w.a)*I},w.Hermite=function(v,I,P,u,Q){var K=Q*Q,a=Q*K,U=2*a-3*K+1,p=-2*a+3*K,r=a-2*K+Q,Y=a-K;return new w(v.r*U+P.r*p+I.r*r+u.r*Y,v.g*U+P.g*p+I.g*r+u.g*Y,v.b*U+P.b*p+I.b*r+u.b*Y,v.a*U+P.a*p+I.a*r+u.a*Y)},w.Hermite1stDerivative=function(v,I,P,u,Q){var K=new w;return this.Hermite1stDerivativeToRef(v,I,P,u,Q,K),K},w.Hermite1stDerivativeToRef=function(w,v,I,P,u,Q){var K=u*u;Q.r=6*(K-u)*w.r+(3*K-4*u+1)*v.r+6*(-K+u)*I.r+(3*K-2*u)*P.r,Q.g=6*(K-u)*w.g+(3*K-4*u+1)*v.g+6*(-K+u)*I.g+(3*K-2*u)*P.g,Q.b=6*(K-u)*w.b+(3*K-4*u+1)*v.b+6*(-K+u)*I.b+(3*K-2*u)*P.b,Q.a=6*(K-u)*w.a+(3*K-4*u+1)*v.a+6*(-K+u)*I.a+(3*K-2*u)*P.a},w.FromColor3=function(v,I){return void 0===I&&(I=1),new w(v.r,v.g,v.b,I)},w.FromArray=function(v,I){return void 0===I&&(I=0),new w(v[I],v[I+1],v[I+2],v[I+3])},w.FromArrayToRef=function(w,v,I){void 0===v&&(v=0),I.r=w[v],I.g=w[v+1],I.b=w[v+2],I.a=w[v+3]},w.FromInts=function(v,I,P,u){return new w(v/255,I/255,P/255,u/255)},w.CheckColors4=function(w,v){if(w.length===3*v){for(var I=[],P=0;P<w.length;P+=3){var u=P/3*4;I[u]=w[P],I[u+1]=w[P+1],I[u+2]=w[P+2],I[u+3]=1}return I}return w},w}(),p=function(){function w(){}return w.Color3=Q.c.BuildArray(3,a.Black),w.Color4=Q.c.BuildArray(3,(function(){return new U(0,0,0,0)})),w}();(0,K.g)("BABYLON.Color3",a),(0,K.g)("BABYLON.Color4",U)},61686:function(w,v,I){"use strict";I.d(v,{e:function(){return K},g:function(){return Q},k:function(){return P},l:function(){return u}});var P=1/2.2,u=2.2,Q=(1+Math.sqrt(5))/2,K=.001},46647:function(w,v,I){"use strict";I.d(v,{b:function(){return u}});var P=I(85567),u=function(){function w(){}return w.GetPlanes=function(v){for(var I=[],u=0;u<6;u++)I.push(new P.e(0,0,0,0));return w.GetPlanesToRef(v,I),I},w.GetNearPlaneToRef=function(w,v){var I=w.m;v.normal.x=I[3]+I[2],v.normal.y=I[7]+I[6],v.normal.z=I[11]+I[10],v.d=I[15]+I[14],v.normalize()},w.GetFarPlaneToRef=function(w,v){var I=w.m;v.normal.x=I[3]-I[2],v.normal.y=I[7]-I[6],v.normal.z=I[11]-I[10],v.d=I[15]-I[14],v.normalize()},w.GetLeftPlaneToRef=function(w,v){var I=w.m;v.normal.x=I[3]+I[0],v.normal.y=I[7]+I[4],v.normal.z=I[11]+I[8],v.d=I[15]+I[12],v.normalize()},w.GetRightPlaneToRef=function(w,v){var I=w.m;v.normal.x=I[3]-I[0],v.normal.y=I[7]-I[4],v.normal.z=I[11]-I[8],v.d=I[15]-I[12],v.normalize()},w.GetTopPlaneToRef=function(w,v){var I=w.m;v.normal.x=I[3]-I[1],v.normal.y=I[7]-I[5],v.normal.z=I[11]-I[9],v.d=I[15]-I[13],v.normalize()},w.GetBottomPlaneToRef=function(w,v){var I=w.m;v.normal.x=I[3]+I[1],v.normal.y=I[7]+I[5],v.normal.z=I[11]+I[9],v.d=I[15]+I[13],v.normalize()},w.GetPlanesToRef=function(v,I){w.GetNearPlaneToRef(v,I[0]),w.GetFarPlaneToRef(v,I[1]),w.GetLeftPlaneToRef(v,I[2]),w.GetRightPlaneToRef(v,I[3]),w.GetTopPlaneToRef(v,I[4]),w.GetBottomPlaneToRef(v,I[5])},w}()},18445:function(w,v,I){"use strict";I.d(v,{d:function(){return a},f:function(){return U}});var P=I(78502),u=I(80105),Q=I(9892),K=function(){function w(){}return w.extractMinAndMaxIndexed=function(w,v,I,P,u,Q){for(var K=I;K<I+P;K++){var a=3*v[K],U=w[a],p=w[a+1],r=w[a+2];u.minimizeInPlaceFromFloats(U,p,r),Q.maximizeInPlaceFromFloats(U,p,r)}},w.extractMinAndMax=function(w,v,I,P,u,Q){for(var K=v,a=v*P;K<v+I;K++,a+=P){var U=w[a],p=w[a+1],r=w[a+2];u.minimizeInPlaceFromFloats(U,p,r),Q.maximizeInPlaceFromFloats(U,p,r)}},(0,P.i)([Q.j.filter((function(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];var I=w[0],P=w[1];return!Array.isArray(I)&&!Array.isArray(P)}))],w,"extractMinAndMaxIndexed",null),(0,P.i)([Q.j.filter((function(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];var I=w[0];return!Array.isArray(I)}))],w,"extractMinAndMax",null),w}();function a(w,v,I,P,Q){void 0===Q&&(Q=null);var a=new u.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new u.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return K.extractMinAndMaxIndexed(w,v,I,P,a,U),Q&&(a.x-=a.x*Q.x+Q.y,a.y-=a.y*Q.x+Q.y,a.z-=a.z*Q.x+Q.y,U.x+=U.x*Q.x+Q.y,U.y+=U.y*Q.x+Q.y,U.z+=U.z*Q.x+Q.y),{minimum:a,maximum:U}}function U(w,v,I,P,Q){void 0===P&&(P=null);var a=new u.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new u.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Q||(Q=3),K.extractMinAndMax(w,v,I,Q,a,U),P&&(a.x-=a.x*P.x+P.y,a.y-=a.y*P.x+P.y,a.z-=a.z*P.x+P.y,U.x+=U.x*P.x+P.y,U.y+=U.y*P.x+P.y,U.z+=U.z*P.x+P.y),{minimum:a,maximum:U}}},39578:function(w,v,I){"use strict";I.d(v,{c:function(){return P.b},f:function(){return P.f},i:function(){return u.f},k:function(){return u.i},n:function(){return u.k},p:function(){return u.l}});I(54044);var P=I(9488),u=(I(61686),I(46647),I(12476),I(85567),I(2111),I(80105));I(52270),I(57278)},12476:function(w,v,I){"use strict";I.d(v,{c:function(){return a},e:function(){return r},i:function(){return Y}});var P,u=I(96658),Q=I(80105),K=I(61686);!function(w){w[w.CW=0]="CW",w[w.CCW=1]="CCW"}(P||(P={}));var a=function(){function w(){}return w.Interpolate=function(w,v,I,P,u){for(var Q=1-3*P+3*v,K=3*P-6*v,a=3*v,U=w,p=0;p<5;p++){var r=U*U;U-=(Q*(r*U)+K*r+a*U-w)*(1/(3*Q*r+2*K*U+a)),U=Math.min(1,Math.max(0,U))}return 3*Math.pow(1-U,2)*U*I+3*(1-U)*Math.pow(U,2)*u+Math.pow(U,3)},w}(),U=function(){function w(w){this._radians=w,this._radians<0&&(this._radians+=2*Math.PI)}return w.prototype.degrees=function(){return 180*this._radians/Math.PI},w.prototype.radians=function(){return this._radians},w.BetweenTwoPoints=function(v,I){var P=I.subtract(v);return new w(Math.atan2(P.y,P.x))},w.FromRadians=function(v){return new w(v)},w.FromDegrees=function(v){return new w(v*Math.PI/180)},w}(),p=function(w,v,I){this.startPoint=w,this.midPoint=v,this.endPoint=I;var u=Math.pow(v.x,2)+Math.pow(v.y,2),K=(Math.pow(w.x,2)+Math.pow(w.y,2)-u)/2,a=(u-Math.pow(I.x,2)-Math.pow(I.y,2))/2,p=(w.x-v.x)*(v.y-I.y)-(v.x-I.x)*(w.y-v.y);this.centerPoint=new Q.k((K*(v.y-I.y)-a*(w.y-v.y))/p,((w.x-v.x)*a-(v.x-I.x)*K)/p),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=U.BetweenTwoPoints(this.centerPoint,this.startPoint);var r=this.startAngle.degrees(),Y=U.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),g=U.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();Y-r>180&&(Y-=360),Y-r<-180&&(Y+=360),g-Y>180&&(g-=360),g-Y<-180&&(g+=360),this.orientation=Y-r<0?P.CW:P.CCW,this.angle=U.FromDegrees(this.orientation===P.CW?r-g:g-r)},r=function(){function w(w,v){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new Q.k(w,v))}return w.prototype.addLineTo=function(w,v){if(this.closed)return this;var I=new Q.k(w,v),P=this._points[this._points.length-1];return this._points.push(I),this._length+=I.subtract(P).length(),this},w.prototype.addArcTo=function(w,v,I,u,K){if(void 0===K&&(K=36),this.closed)return this;var a=this._points[this._points.length-1],U=new Q.k(w,v),r=new Q.k(I,u),Y=new p(a,U,r),g=Y.angle.radians()/K;Y.orientation===P.CW&&(g*=-1);for(var J=Y.startAngle.radians()+g,l=0;l<K;l++){var R=Math.cos(J)*Y.radius+Y.centerPoint.x,x=Math.sin(J)*Y.radius+Y.centerPoint.y;this.addLineTo(R,x),J+=g}return this},w.prototype.close=function(){return this.closed=!0,this},w.prototype.length=function(){var w=this._length;if(this.closed){var v=this._points[this._points.length-1];w+=this._points[0].subtract(v).length()}return w},w.prototype.getPoints=function(){return this._points},w.prototype.getPointAtLengthPosition=function(w){if(w<0||w>1)return Q.k.Zero();for(var v=w*this.length(),I=0,P=0;P<this._points.length;P++){var u=(P+1)%this._points.length,K=this._points[P],a=this._points[u].subtract(K),U=a.length()+I;if(v>=I&&v<=U){var p=a.normalize(),r=v-I;return new Q.k(K.x+p.x*r,K.y+p.y*r)}I=U}return Q.k.Zero()},w.StartingAt=function(v,I){return new w(v,I)},w}(),Y=function(){function w(w,v,I,P){void 0===v&&(v=null),void 0===P&&(P=!1),this.path=w,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:Q.l.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:Q.e.Identity()};for(var u=0;u<w.length;u++)this._curve[u]=w[u].clone();this._raw=I||!1,this._alignTangentsWithPath=P,this._compute(v,P)}return w.prototype.getCurve=function(){return this._curve},w.prototype.getPoints=function(){return this._curve},w.prototype.length=function(){return this._distances[this._distances.length-1]},w.prototype.getTangents=function(){return this._tangents},w.prototype.getNormals=function(){return this._normals},w.prototype.getBinormals=function(){return this._binormals},w.prototype.getDistances=function(){return this._distances},w.prototype.getPointAt=function(w){return this._updatePointAtData(w).point},w.prototype.getTangentAt=function(w,v){return void 0===v&&(v=!1),this._updatePointAtData(w,v),v?Q.l.TransformCoordinates(Q.l.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},w.prototype.getNormalAt=function(w,v){return void 0===v&&(v=!1),this._updatePointAtData(w,v),v?Q.l.TransformCoordinates(Q.l.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},w.prototype.getBinormalAt=function(w,v){return void 0===v&&(v=!1),this._updatePointAtData(w,v),v?Q.l.TransformCoordinates(Q.l.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},w.prototype.getDistanceAt=function(w){return this.length()*w},w.prototype.getPreviousPointIndexAt=function(w){return this._updatePointAtData(w),this._pointAtData.previousPointArrayIndex},w.prototype.getSubPositionAt=function(w){return this._updatePointAtData(w),this._pointAtData.subPosition},w.prototype.getClosestPositionTo=function(w){for(var v=Number.MAX_VALUE,I=0,P=0;P<this._curve.length-1;P++){var u=this._curve[P+0],K=this._curve[P+1].subtract(u).normalize(),a=this._distances[P+1]-this._distances[P+0],U=Math.min(Math.max(Q.l.Dot(K,w.subtract(u).normalize()),0)*Q.l.Distance(u,w)/a,1),p=Q.l.Distance(u.add(K.scale(U*a)),w);p<v&&(v=p,I=(this._distances[P+0]+a*U)/this.length())}return I},w.prototype.slice=function(v,I){if(void 0===v&&(v=0),void 0===I&&(I=1),v<0&&(v=1- -1*v%1),I<0&&(I=1- -1*I%1),v>I){var P=v;v=I,I=P}var u=this.getCurve(),Q=this.getPointAt(v),K=this.getPreviousPointIndexAt(v),a=this.getPointAt(I),U=this.getPreviousPointIndexAt(I)+1,p=[];return 0!==v&&(K++,p.push(Q)),p.push.apply(p,u.slice(K,U)),1===I&&1!==v||p.push(a),new w(p,this.getNormalAt(v),this._raw,this._alignTangentsWithPath)},w.prototype.update=function(w,v,I){void 0===v&&(v=null),void 0===I&&(I=!1);for(var P=0;P<w.length;P++)this._curve[P].x=w[P].x,this._curve[P].y=w[P].y,this._curve[P].z=w[P].z;return this._compute(v,I),this},w.prototype._compute=function(w,v){void 0===v&&(v=!1);var I=this._curve.length;if(!(I<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[I-1]=this._curve[I-1].subtract(this._curve[I-2]),this._raw||this._tangents[I-1].normalize();var P,u,K,a,U,p=this._tangents[0],r=this._normalVector(p,w);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=Q.l.Cross(p,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var Y=1;Y<I;Y++)P=this._getLastNonNullVector(Y),Y<I-1&&(u=this._getFirstNonNullVector(Y),this._tangents[Y]=v?u:P.add(u),this._tangents[Y].normalize()),this._distances[Y]=this._distances[Y-1]+this._curve[Y].subtract(this._curve[Y-1]).length(),K=this._tangents[Y],U=this._binormals[Y-1],this._normals[Y]=Q.l.Cross(U,K),this._raw||(0===this._normals[Y].length()?(a=this._normals[Y-1],this._normals[Y]=a.clone()):this._normals[Y].normalize()),this._binormals[Y]=Q.l.Cross(K,this._normals[Y]),this._raw||this._binormals[Y].normalize();this._pointAtData.id=NaN}},w.prototype._getFirstNonNullVector=function(w){for(var v=1,I=this._curve[w+v].subtract(this._curve[w]);0===I.length()&&w+v+1<this._curve.length;)v++,I=this._curve[w+v].subtract(this._curve[w]);return I},w.prototype._getLastNonNullVector=function(w){for(var v=1,I=this._curve[w].subtract(this._curve[w-v]);0===I.length()&&w>v+1;)v++,I=this._curve[w].subtract(this._curve[w-v]);return I},w.prototype._normalVector=function(w,v){var I,P=w.length();if(0===P&&(P=1),void 0===v||null===v){var a=void 0;a=u.b.WithinEpsilon(Math.abs(w.y)/P,1,K.e)?u.b.WithinEpsilon(Math.abs(w.x)/P,1,K.e)?u.b.WithinEpsilon(Math.abs(w.z)/P,1,K.e)?Q.l.Zero():new Q.l(0,0,1):new Q.l(1,0,0):new Q.l(0,-1,0),I=Q.l.Cross(w,a)}else I=Q.l.Cross(w,v),Q.l.CrossToRef(I,w,I);return I.normalize(),I},w.prototype._updatePointAtData=function(w,v){if(void 0===v&&(v=!1),this._pointAtData.id===w)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=w;var I=this.getPoints();if(w<=0)return this._setPointAtData(0,0,I[0],0,v);if(w>=1)return this._setPointAtData(1,1,I[I.length-1],I.length-1,v);for(var P,u=I[0],K=0,a=w*this.length(),U=1;U<I.length;U++){P=I[U];var p=Q.l.Distance(u,P);if((K+=p)===a)return this._setPointAtData(w,1,P,U,v);if(K>a){var r=(K-a)/p,Y=u.subtract(P),g=P.add(Y.scaleInPlace(r));return this._setPointAtData(w,1-r,g,U-1,v)}u=P}return this._pointAtData},w.prototype._setPointAtData=function(w,v,I,P,u){return this._pointAtData.point=I,this._pointAtData.position=w,this._pointAtData.subPosition=v,this._pointAtData.previousPointArrayIndex=P,this._pointAtData.interpolateReady=u,u&&this._updateInterpolationMatrix(),this._pointAtData},w.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=Q.e.Identity();var w=this._pointAtData.previousPointArrayIndex;if(w!==this._tangents.length-1){var v=w+1,I=this._tangents[w].clone(),P=this._normals[w].clone(),u=this._binormals[w].clone(),K=this._tangents[v].clone(),a=this._normals[v].clone(),U=this._binormals[v].clone(),p=Q.f.RotationQuaternionFromAxis(P,u,I),r=Q.f.RotationQuaternionFromAxis(a,U,K);Q.f.Slerp(p,r,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},w}();!function(){function w(w){this._length=0,this._points=w,this._length=this._computeLength(w)}w.CreateQuadraticBezier=function(v,I,P,u){u=u>2?u:3;for(var K=new Array,a=function(w,v,I,P){return(1-w)*(1-w)*v+2*w*(1-w)*I+w*w*P},U=0;U<=u;U++)K.push(new Q.l(a(U/u,v.x,I.x,P.x),a(U/u,v.y,I.y,P.y),a(U/u,v.z,I.z,P.z)));return new w(K)},w.CreateCubicBezier=function(v,I,P,u,K){K=K>3?K:4;for(var a=new Array,U=function(w,v,I,P,u){return(1-w)*(1-w)*(1-w)*v+3*w*(1-w)*(1-w)*I+3*w*w*(1-w)*P+w*w*w*u},p=0;p<=K;p++)a.push(new Q.l(U(p/K,v.x,I.x,P.x,u.x),U(p/K,v.y,I.y,P.y,u.y),U(p/K,v.z,I.z,P.z,u.z)));return new w(a)},w.CreateHermiteSpline=function(v,I,P,u,K){for(var a=new Array,U=1/K,p=0;p<=K;p++)a.push(Q.l.Hermite(v,I,P,u,p*U));return new w(a)},w.CreateCatmullRomSpline=function(v,I,P){var u=new Array,K=1/I,a=0;if(P){for(var U=v.length,p=0;p<U;p++){a=0;for(var r=0;r<I;r++)u.push(Q.l.CatmullRom(v[p%U],v[(p+1)%U],v[(p+2)%U],v[(p+3)%U],a)),a+=K}u.push(u[0])}else{var Y=new Array;Y.push(v[0].clone()),Array.prototype.push.apply(Y,v),Y.push(v[v.length-1].clone());for(p=0;p<Y.length-3;p++){a=0;for(r=0;r<I;r++)u.push(Q.l.CatmullRom(Y[p],Y[p+1],Y[p+2],Y[p+3],a)),a+=K}p--,u.push(Q.l.CatmullRom(Y[p],Y[p+1],Y[p+2],Y[p+3],a))}return new w(u)},w.ArcThru3Points=function(v,I,P,u,K,a){void 0===u&&(u=32),void 0===K&&(K=!1),void 0===a&&(a=!1);var U=new Array,p=I.subtract(v),r=P.subtract(I),Y=v.subtract(P),g=Q.l.Cross(p,r),J=g.length();if(J<Math.pow(10,-8))return new w(U);var l=p.lengthSquared(),R=r.lengthSquared(),x=Y.lengthSquared(),j=g.lengthSquared(),s=.5*p.length()*r.length()*Y.length()/J,B=-.5*R*Q.l.Dot(p,Y)/j,t=-.5*x*Q.l.Dot(p,r)/j,i=-.5*l*Q.l.Dot(r,Y)/j,z=v.scale(B).add(I.scale(t)).add(P.scale(i)),E=v.subtract(z).normalize(),o=Q.l.Cross(g,E).normalize();if(a){for(var h=2*Math.PI/u,n=0;n<=2*Math.PI;n+=h)U.push(z.add(E.scale(s*Math.cos(n)).add(o.scale(s*Math.sin(n)))));U.push(v)}else{h=1/u,n=0;var W=Q.l.Zero();do{W=z.add(E.scale(s*Math.cos(n)).add(o.scale(s*Math.sin(n)))),U.push(W),n+=h}while(!W.equalsWithEpsilon(P,s*h*1.1));U.push(P),K&&U.push(v)}return new w(U)},w.prototype.getPoints=function(){return this._points},w.prototype.length=function(){return this._length},w.prototype.continue=function(v){for(var I=this._points[this._points.length-1],P=this._points.slice(),u=v.getPoints(),Q=1;Q<u.length;Q++)P.push(u[Q].subtract(u[0]).add(I));return new w(P)},w.prototype._computeLength=function(w){for(var v=0,I=1;I<w.length;I++)v+=w[I].subtract(w[I-1]).length();return v}}()},85567:function(w,v,I){"use strict";I.d(v,{e:function(){return u}});var P=I(80105),u=function(){function w(w,v,I,u){this.normal=new P.l(w,v,I),this.d=u}return w.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},w.prototype.clone=function(){return new w(this.normal.x,this.normal.y,this.normal.z,this.d)},w.prototype.getClassName=function(){return"Plane"},w.prototype.getHashCode=function(){var w=this.normal.getHashCode();return w=397*w^(0|this.d)},w.prototype.normalize=function(){var w=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),v=0;return 0!==w&&(v=1/w),this.normal.x*=v,this.normal.y*=v,this.normal.z*=v,this.d*=v,this},w.prototype.transform=function(v){var I=w._TmpMatrix;v.invertToRef(I);var P=I.m,u=this.normal.x,Q=this.normal.y,K=this.normal.z,a=this.d;return new w(u*P[0]+Q*P[1]+K*P[2]+a*P[3],u*P[4]+Q*P[5]+K*P[6]+a*P[7],u*P[8]+Q*P[9]+K*P[10]+a*P[11],u*P[12]+Q*P[13]+K*P[14]+a*P[15])},w.prototype.dotCoordinate=function(w){return this.normal.x*w.x+this.normal.y*w.y+this.normal.z*w.z+this.d},w.prototype.copyFromPoints=function(w,v,I){var P,u=v.x-w.x,Q=v.y-w.y,K=v.z-w.z,a=I.x-w.x,U=I.y-w.y,p=I.z-w.z,r=Q*p-K*U,Y=K*a-u*p,g=u*U-Q*a,J=Math.sqrt(r*r+Y*Y+g*g);return P=0!==J?1/J:0,this.normal.x=r*P,this.normal.y=Y*P,this.normal.z=g*P,this.d=-(this.normal.x*w.x+this.normal.y*w.y+this.normal.z*w.z),this},w.prototype.isFrontFacingTo=function(w,v){return P.l.Dot(this.normal,w)<=v},w.prototype.signedDistanceTo=function(w){return P.l.Dot(w,this.normal)+this.d},w.FromArray=function(v){return new w(v[0],v[1],v[2],v[3])},w.FromPoints=function(v,I,P){var u=new w(0,0,0,0);return u.copyFromPoints(v,I,P),u},w.FromPositionAndNormal=function(v,I){var P=new w(0,0,0,0);return I.normalize(),P.normal=I,P.d=-(I.x*v.x+I.y*v.y+I.z*v.z),P},w.SignedDistanceToPlaneFromPositionAndNormal=function(w,v,I){var u=-(v.x*w.x+v.y*w.y+v.z*w.z);return P.l.Dot(I,v)+u},w._TmpMatrix=P.e.Identity(),w}()},96658:function(w,v,I){"use strict";I.d(v,{b:function(){return P}});var P=function(){function w(){}return w.WithinEpsilon=function(w,v,I){return void 0===I&&(I=1401298e-51),Math.abs(w-v)<=I},w.ToHex=function(w){var v=w.toString(16);return w<=15?("0"+v).toUpperCase():v.toUpperCase()},w.Sign=function(w){return 0===(w=+w)||isNaN(w)?w:w>0?1:-1},w.Clamp=function(w,v,I){return void 0===v&&(v=0),void 0===I&&(I=1),Math.min(I,Math.max(v,w))},w.Log2=function(w){return Math.log(w)*Math.LOG2E},w.ILog2=function(w){if(Math.log2)return Math.floor(Math.log2(w));if(w<0)return NaN;if(0===w)return-1/0;var v=0;if(w<1){for(;w<1;)v++,w*=2;v=-v}else if(w>1)for(;w>1;)v++,w=Math.floor(w/2);return v},w.Repeat=function(w,v){return w-Math.floor(w/v)*v},w.Normalize=function(w,v,I){return(w-v)/(I-v)},w.Denormalize=function(w,v,I){return w*(I-v)+v},w.DeltaAngle=function(v,I){var P=w.Repeat(I-v,360);return P>180&&(P-=360),P},w.PingPong=function(v,I){var P=w.Repeat(v,2*I);return I-Math.abs(P-I)},w.SmoothStep=function(v,I,P){var u=w.Clamp(P);return I*(u=-2*u*u*u+3*u*u)+v*(1-u)},w.MoveTowards=function(v,I,P){return Math.abs(I-v)<=P?I:v+w.Sign(I-v)*P},w.MoveTowardsAngle=function(v,I,P){var u=w.DeltaAngle(v,I),Q=0;return-P<u&&u<P?Q=I:(I=v+u,Q=w.MoveTowards(v,I,P)),Q},w.Lerp=function(w,v,I){return w+(v-w)*I},w.LerpAngle=function(v,I,P){var u=w.Repeat(I-v,360);return u>180&&(u-=360),v+u*w.Clamp(P)},w.InverseLerp=function(v,I,P){return v!=I?w.Clamp((P-v)/(I-v)):0},w.Hermite=function(w,v,I,P,u){var Q=u*u,K=u*Q;return w*(2*K-3*Q+1)+I*(-2*K+3*Q)+v*(K-2*Q+u)+P*(K-Q)},w.Hermite1stDerivative=function(w,v,I,P,u){var Q=u*u;return 6*(Q-u)*w+(3*Q-4*u+1)*v+6*(-Q+u)*I+(3*Q-2*u)*P},w.RandomRange=function(w,v){return w===v?w:Math.random()*(v-w)+w},w.RangeToPercent=function(w,v,I){return(w-v)/(I-v)},w.PercentToRange=function(w,v,I){return(I-v)*w+v},w.NormalizeRadians=function(v){return v-=w.TwoPi*Math.floor((v+Math.PI)/w.TwoPi)},w.HCF=function(v,I){var P=v%I;return 0===P?I:w.HCF(I,P)},w.TwoPi=2*Math.PI,w}()},2111:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(w,v){this.width=w,this.height=v}return w.prototype.toString=function(){return"{W: ".concat(this.width,", H: ").concat(this.height,"}")},w.prototype.getClassName=function(){return"Size"},w.prototype.getHashCode=function(){var w=0|this.width;return w=397*w^(0|this.height)},w.prototype.copyFrom=function(w){this.width=w.width,this.height=w.height},w.prototype.copyFromFloats=function(w,v){return this.width=w,this.height=v,this},w.prototype.set=function(w,v){return this.copyFromFloats(w,v)},w.prototype.multiplyByFloats=function(v,I){return new w(this.width*v,this.height*I)},w.prototype.clone=function(){return new w(this.width,this.height)},w.prototype.equals=function(w){return!!w&&(this.width===w.width&&this.height===w.height)},Object.defineProperty(w.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),w.Zero=function(){return new w(0,0)},w.prototype.add=function(v){return new w(this.width+v.width,this.height+v.height)},w.prototype.subtract=function(v){return new w(this.width-v.width,this.height-v.height)},w.Lerp=function(v,I,P){return new w(v.width+(I.width-v.width)*P,v.height+(I.height-v.height)*P)},w}()},80105:function(w,v,I){"use strict";I.d(v,{e:function(){return l},f:function(){return J},i:function(){return x},k:function(){return r},l:function(){return Y},p:function(){return g}});var P=I(96658),u=I(61686),Q=I(89214),K=I(31709),a=I(30899),U=I(78588),p=function(w){return parseInt(w.toString().replace(/\W/g,""))},r=function(){function w(w,v){void 0===w&&(w=0),void 0===v&&(v=0),this.x=w,this.y=v}return w.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y,"}")},w.prototype.getClassName=function(){return"Vector2"},w.prototype.getHashCode=function(){var w=p(this.x);return w=397*w^p(this.y)},w.prototype.toArray=function(w,v){return void 0===v&&(v=0),w[v]=this.x,w[v+1]=this.y,this},w.prototype.fromArray=function(v,I){return void 0===I&&(I=0),w.FromArrayToRef(v,I,this),this},w.prototype.asArray=function(){var w=new Array;return this.toArray(w,0),w},w.prototype.copyFrom=function(w){return this.x=w.x,this.y=w.y,this},w.prototype.copyFromFloats=function(w,v){return this.x=w,this.y=v,this},w.prototype.set=function(w,v){return this.copyFromFloats(w,v)},w.prototype.add=function(v){return new w(this.x+v.x,this.y+v.y)},w.prototype.addToRef=function(w,v){return v.x=this.x+w.x,v.y=this.y+w.y,this},w.prototype.addInPlace=function(w){return this.x+=w.x,this.y+=w.y,this},w.prototype.addVector3=function(v){return new w(this.x+v.x,this.y+v.y)},w.prototype.subtract=function(v){return new w(this.x-v.x,this.y-v.y)},w.prototype.subtractToRef=function(w,v){return v.x=this.x-w.x,v.y=this.y-w.y,this},w.prototype.subtractInPlace=function(w){return this.x-=w.x,this.y-=w.y,this},w.prototype.multiplyInPlace=function(w){return this.x*=w.x,this.y*=w.y,this},w.prototype.multiply=function(v){return new w(this.x*v.x,this.y*v.y)},w.prototype.multiplyToRef=function(w,v){return v.x=this.x*w.x,v.y=this.y*w.y,this},w.prototype.multiplyByFloats=function(v,I){return new w(this.x*v,this.y*I)},w.prototype.divide=function(v){return new w(this.x/v.x,this.y/v.y)},w.prototype.divideToRef=function(w,v){return v.x=this.x/w.x,v.y=this.y/w.y,this},w.prototype.divideInPlace=function(w){return this.divideToRef(w,this)},w.prototype.negate=function(){return new w(-this.x,-this.y)},w.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},w.prototype.negateToRef=function(w){return w.copyFromFloats(-1*this.x,-1*this.y)},w.prototype.scaleInPlace=function(w){return this.x*=w,this.y*=w,this},w.prototype.scale=function(v){var I=new w(0,0);return this.scaleToRef(v,I),I},w.prototype.scaleToRef=function(w,v){return v.x=this.x*w,v.y=this.y*w,this},w.prototype.scaleAndAddToRef=function(w,v){return v.x+=this.x*w,v.y+=this.y*w,this},w.prototype.equals=function(w){return w&&this.x===w.x&&this.y===w.y},w.prototype.equalsWithEpsilon=function(w,v){return void 0===v&&(v=u.e),w&&P.b.WithinEpsilon(this.x,w.x,v)&&P.b.WithinEpsilon(this.y,w.y,v)},w.prototype.floor=function(){return new w(Math.floor(this.x),Math.floor(this.y))},w.prototype.fract=function(){return new w(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},w.prototype.rotateToRef=function(w,v){var I=Math.cos(w),P=Math.sin(w);return v.x=I*this.x-P*this.y,v.y=P*this.x+I*this.y,this},w.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},w.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},w.prototype.normalize=function(){return w.NormalizeToRef(this,this),this},w.prototype.clone=function(){return new w(this.x,this.y)},w.Zero=function(){return new w(0,0)},w.One=function(){return new w(1,1)},w.FromArray=function(v,I){return void 0===I&&(I=0),new w(v[I],v[I+1])},w.FromArrayToRef=function(w,v,I){I.x=w[v],I.y=w[v+1]},w.CatmullRom=function(v,I,P,u,Q){var K=Q*Q,a=Q*K;return new w(.5*(2*I.x+(-v.x+P.x)*Q+(2*v.x-5*I.x+4*P.x-u.x)*K+(-v.x+3*I.x-3*P.x+u.x)*a),.5*(2*I.y+(-v.y+P.y)*Q+(2*v.y-5*I.y+4*P.y-u.y)*K+(-v.y+3*I.y-3*P.y+u.y)*a))},w.Clamp=function(v,I,P){var u=v.x;u=(u=u>P.x?P.x:u)<I.x?I.x:u;var Q=v.y;return new w(u,Q=(Q=Q>P.y?P.y:Q)<I.y?I.y:Q)},w.Hermite=function(v,I,P,u,Q){var K=Q*Q,a=Q*K,U=2*a-3*K+1,p=-2*a+3*K,r=a-2*K+Q,Y=a-K;return new w(v.x*U+P.x*p+I.x*r+u.x*Y,v.y*U+P.y*p+I.y*r+u.y*Y)},w.Hermite1stDerivative=function(v,I,P,u,Q){var K=w.Zero();return this.Hermite1stDerivativeToRef(v,I,P,u,Q,K),K},w.Hermite1stDerivativeToRef=function(w,v,I,P,u,Q){var K=u*u;Q.x=6*(K-u)*w.x+(3*K-4*u+1)*v.x+6*(-K+u)*I.x+(3*K-2*u)*P.x,Q.y=6*(K-u)*w.y+(3*K-4*u+1)*v.y+6*(-K+u)*I.y+(3*K-2*u)*P.y},w.Lerp=function(v,I,P){return new w(v.x+(I.x-v.x)*P,v.y+(I.y-v.y)*P)},w.Dot=function(w,v){return w.x*v.x+w.y*v.y},w.Normalize=function(v){var I=w.Zero();return this.NormalizeToRef(v,I),I},w.NormalizeToRef=function(w,v){var I=w.length();0!==I&&(v.x=w.x/I,v.y=w.y/I)},w.Minimize=function(v,I){return new w(v.x<I.x?v.x:I.x,v.y<I.y?v.y:I.y)},w.Maximize=function(v,I){return new w(v.x>I.x?v.x:I.x,v.y>I.y?v.y:I.y)},w.Transform=function(v,I){var P=w.Zero();return w.TransformToRef(v,I,P),P},w.TransformToRef=function(w,v,I){var P=v.m,u=w.x*P[0]+w.y*P[4]+P[12],Q=w.x*P[1]+w.y*P[5]+P[13];I.x=u,I.y=Q},w.PointInTriangle=function(w,v,I,P){var u=.5*(-I.y*P.x+v.y*(-I.x+P.x)+v.x*(I.y-P.y)+I.x*P.y),Q=u<0?-1:1,K=(v.y*P.x-v.x*P.y+(P.y-v.y)*w.x+(v.x-P.x)*w.y)*Q,a=(v.x*I.y-v.y*I.x+(v.y-I.y)*w.x+(I.x-v.x)*w.y)*Q;return K>0&&a>0&&K+a<2*u*Q},w.Distance=function(v,I){return Math.sqrt(w.DistanceSquared(v,I))},w.DistanceSquared=function(w,v){var I=w.x-v.x,P=w.y-v.y;return I*I+P*P},w.Center=function(v,I){return w.CenterToRef(v,I,w.Zero())},w.CenterToRef=function(w,v,I){return I.copyFromFloats((w.x+v.x)/2,(w.y+v.y)/2)},w.DistanceOfPointFromSegment=function(v,I,P){var u=w.DistanceSquared(I,P);if(0===u)return w.Distance(v,I);var Q=P.subtract(I),K=Math.max(0,Math.min(1,w.Dot(v.subtract(I),Q)/u)),a=I.add(Q.multiplyByFloats(K,K));return w.Distance(v,a)},w}(),Y=function(){function w(w,v,I){void 0===w&&(w=0),void 0===v&&(v=0),void 0===I&&(I=0),this._isDirty=!0,this._x=w,this._y=v,this._z=I}return Object.defineProperty(w.prototype,"x",{get:function(){return this._x},set:function(w){this._x=w,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"y",{get:function(){return this._y},set:function(w){this._y=w,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"z",{get:function(){return this._z},set:function(w){this._z=w,this._isDirty=!0},enumerable:!1,configurable:!0}),w.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z,"}")},w.prototype.getClassName=function(){return"Vector3"},w.prototype.getHashCode=function(){var w=p(this._x);return w=397*(w=397*w^p(this._y))^p(this._z)},w.prototype.asArray=function(){var w=[];return this.toArray(w,0),w},w.prototype.toArray=function(w,v){return void 0===v&&(v=0),w[v]=this._x,w[v+1]=this._y,w[v+2]=this._z,this},w.prototype.fromArray=function(v,I){return void 0===I&&(I=0),w.FromArrayToRef(v,I,this),this},w.prototype.toQuaternion=function(){return J.RotationYawPitchRoll(this._y,this._x,this._z)},w.prototype.addInPlace=function(w){return this.addInPlaceFromFloats(w._x,w._y,w._z)},w.prototype.addInPlaceFromFloats=function(w,v,I){return this.x+=w,this.y+=v,this.z+=I,this},w.prototype.add=function(v){return new w(this._x+v._x,this._y+v._y,this._z+v._z)},w.prototype.addToRef=function(w,v){return v.copyFromFloats(this._x+w._x,this._y+w._y,this._z+w._z)},w.prototype.subtractInPlace=function(w){return this.x-=w._x,this.y-=w._y,this.z-=w._z,this},w.prototype.subtract=function(v){return new w(this._x-v._x,this._y-v._y,this._z-v._z)},w.prototype.subtractToRef=function(w,v){return this.subtractFromFloatsToRef(w._x,w._y,w._z,v)},w.prototype.subtractFromFloats=function(v,I,P){return new w(this._x-v,this._y-I,this._z-P)},w.prototype.subtractFromFloatsToRef=function(w,v,I,P){return P.copyFromFloats(this._x-w,this._y-v,this._z-I)},w.prototype.negate=function(){return new w(-this._x,-this._y,-this._z)},w.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},w.prototype.negateToRef=function(w){return w.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)},w.prototype.scaleInPlace=function(w){return this.x*=w,this.y*=w,this.z*=w,this},w.prototype.scale=function(v){return new w(this._x*v,this._y*v,this._z*v)},w.prototype.scaleToRef=function(w,v){return v.copyFromFloats(this._x*w,this._y*w,this._z*w)},w.prototype.applyRotationQuaternionToRef=function(w,v){var I=w.w*this.x+w.y*this.z-w.z*this.y,P=w.w*this.y+w.z*this.x-w.x*this.z,u=w.w*this.z+w.x*this.y-w.y*this.x,Q=-w.x*this.x-w.y*this.y-w.z*this.z;return v.x=I*w.w+Q*-w.x+P*-w.z-u*-w.y,v.y=P*w.w+Q*-w.y+u*-w.x-I*-w.z,v.z=u*w.w+Q*-w.z+I*-w.y-P*-w.x,v},w.prototype.applyRotationQuaternionInPlace=function(w){return this.applyRotationQuaternionToRef(w,this)},w.prototype.applyRotationQuaternion=function(v){return this.applyRotationQuaternionToRef(v,w.Zero())},w.prototype.scaleAndAddToRef=function(w,v){return v.addInPlaceFromFloats(this._x*w,this._y*w,this._z*w)},w.prototype.projectOnPlane=function(v,I){var P=w.Zero();return this.projectOnPlaneToRef(v,I,P),P},w.prototype.projectOnPlaneToRef=function(v,I,P){var Q=R.Vector3[0];v.normal.scaleToRef(-v.d,Q);var K=R.Vector3[1];v.normal.negateToRef(K);var a=this,U=a.x,p=a.y,r=a.z,Y=w.Dot(K,this);if(Y<=u.e*u.e)P.copyFrom(I);else{var g=R.Vector3[2];Q.subtractToRef(I,g);var J=w.Dot(g,K)/Y;P.set(I.x+U*J,I.y+p*J,I.z+r*J)}},w.prototype.equals=function(w){return w&&this._x===w._x&&this._y===w._y&&this._z===w._z},w.prototype.equalsWithEpsilon=function(w,v){return void 0===v&&(v=u.e),w&&P.b.WithinEpsilon(this._x,w._x,v)&&P.b.WithinEpsilon(this._y,w._y,v)&&P.b.WithinEpsilon(this._z,w._z,v)},w.prototype.equalsToFloats=function(w,v,I){return this._x===w&&this._y===v&&this._z===I},w.prototype.multiplyInPlace=function(w){return this.x*=w._x,this.y*=w._y,this.z*=w._z,this},w.prototype.multiply=function(w){return this.multiplyByFloats(w._x,w._y,w._z)},w.prototype.multiplyToRef=function(w,v){return v.copyFromFloats(this._x*w._x,this._y*w._y,this._z*w._z)},w.prototype.multiplyByFloats=function(v,I,P){return new w(this._x*v,this._y*I,this._z*P)},w.prototype.divide=function(v){return new w(this._x/v._x,this._y/v._y,this._z/v._z)},w.prototype.divideToRef=function(w,v){return v.copyFromFloats(this._x/w._x,this._y/w._y,this._z/w._z)},w.prototype.divideInPlace=function(w){return this.divideToRef(w,this)},w.prototype.minimizeInPlace=function(w){return this.minimizeInPlaceFromFloats(w._x,w._y,w._z)},w.prototype.maximizeInPlace=function(w){return this.maximizeInPlaceFromFloats(w._x,w._y,w._z)},w.prototype.minimizeInPlaceFromFloats=function(w,v,I){return w<this._x&&(this.x=w),v<this._y&&(this.y=v),I<this._z&&(this.z=I),this},w.prototype.maximizeInPlaceFromFloats=function(w,v,I){return w>this._x&&(this.x=w),v>this._y&&(this.y=v),I>this._z&&(this.z=I),this},w.prototype.isNonUniformWithinEpsilon=function(w){var v=Math.abs(this._x),I=Math.abs(this._y);if(!P.b.WithinEpsilon(v,I,w))return!0;var u=Math.abs(this._z);return!P.b.WithinEpsilon(v,u,w)||!P.b.WithinEpsilon(I,u,w)},Object.defineProperty(w.prototype,"isNonUniform",{get:function(){var w=Math.abs(this._x);return w!==Math.abs(this._y)||w!==Math.abs(this._z)},enumerable:!1,configurable:!0}),w.prototype.floor=function(){return new w(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},w.prototype.fract=function(){return new w(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},w.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},w.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},Object.defineProperty(w.prototype,"hasAZeroComponent",{get:function(){return this._x*this._y*this._z===0},enumerable:!1,configurable:!0}),w.prototype.normalize=function(){return this.normalizeFromLength(this.length())},w.prototype.reorderInPlace=function(w){var v=this;return"xyz"===(w=w.toLowerCase())||(R.Vector3[0].copyFrom(this),["x","y","z"].forEach((function(I,P){v[I]=R.Vector3[0][w[P]]}))),this},w.prototype.rotateByQuaternionToRef=function(v,I){return v.toRotationMatrix(R.Matrix[0]),w.TransformCoordinatesToRef(this,R.Matrix[0],I),I},w.prototype.rotateByQuaternionAroundPointToRef=function(w,v,I){return this.subtractToRef(v,R.Vector3[0]),R.Vector3[0].rotateByQuaternionToRef(w,R.Vector3[0]),v.addToRef(R.Vector3[0],I),I},w.prototype.cross=function(v){return w.Cross(this,v)},w.prototype.normalizeFromLength=function(w){return 0===w||1===w?this:this.scaleInPlace(1/w)},w.prototype.normalizeToNew=function(){var v=new w(0,0,0);return this.normalizeToRef(v),v},w.prototype.normalizeToRef=function(w){var v=this.length();return 0===v||1===v?w.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/v,w)},w.prototype.clone=function(){return new w(this._x,this._y,this._z)},w.prototype.copyFrom=function(w){return this.copyFromFloats(w._x,w._y,w._z)},w.prototype.copyFromFloats=function(w,v,I){return this.x=w,this.y=v,this.z=I,this},w.prototype.set=function(w,v,I){return this.copyFromFloats(w,v,I)},w.prototype.setAll=function(w){return this.x=this.y=this.z=w,this},w.GetClipFactor=function(v,I,P,u){var Q=w.Dot(v,P)-u;return Q/(Q-(w.Dot(I,P)-u))},w.GetAngleBetweenVectors=function(v,I,u){var Q=v.normalizeToRef(R.Vector3[1]),K=I.normalizeToRef(R.Vector3[2]),a=w.Dot(Q,K);a=P.b.Clamp(a,-1,1);var U=Math.acos(a),p=R.Vector3[3];return w.CrossToRef(Q,K,p),w.Dot(p,u)>0?isNaN(U)?0:U:isNaN(U)?-Math.PI:-Math.acos(a)},w.GetAngleBetweenVectorsOnPlane=function(v,I,u){R.Vector3[0].copyFrom(v);var Q=R.Vector3[0];R.Vector3[1].copyFrom(I);var K=R.Vector3[1];R.Vector3[2].copyFrom(u);var a=R.Vector3[2],U=R.Vector3[3],p=R.Vector3[4];Q.normalize(),K.normalize(),a.normalize(),w.CrossToRef(a,Q,U),w.CrossToRef(U,a,p);var r=Math.atan2(w.Dot(K,U),w.Dot(K,p));return P.b.NormalizeRadians(r)},w.SlerpToRef=function(v,I,Q,K){Q=P.b.Clamp(Q,0,1);var a=R.Vector3[0],U=R.Vector3[1];a.copyFrom(v);var p=a.length();a.normalizeFromLength(p),U.copyFrom(I);var r=U.length();U.normalizeFromLength(r);var Y,g,J=w.Dot(a,U);if(J<1-u.e){var l=Math.acos(J),x=1/Math.sin(l);Y=Math.sin((1-Q)*l)*x,g=Math.sin(Q*l)*x}else Y=1-Q,g=Q;a.scaleInPlace(Y),U.scaleInPlace(g),K.copyFrom(a).addInPlace(U),K.scaleInPlace(P.b.Lerp(p,r,Q))},w.SmoothToRef=function(v,I,P,u,Q){w.SlerpToRef(v,I,0===u?1:P/u,Q)},w.FromArray=function(v,I){return void 0===I&&(I=0),new w(v[I],v[I+1],v[I+2])},w.FromFloatArray=function(v,I){return w.FromArray(v,I)},w.FromArrayToRef=function(w,v,I){I.x=w[v],I.y=w[v+1],I.z=w[v+2]},w.FromFloatArrayToRef=function(v,I,P){return w.FromArrayToRef(v,I,P)},w.FromFloatsToRef=function(w,v,I,P){P.copyFromFloats(w,v,I)},w.Zero=function(){return new w(0,0,0)},w.One=function(){return new w(1,1,1)},w.Up=function(){return new w(0,1,0)},Object.defineProperty(w,"UpReadOnly",{get:function(){return w._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(w,"RightReadOnly",{get:function(){return w._RightReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(w,"LeftReadOnly",{get:function(){return w._LeftReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(w,"LeftHandedForwardReadOnly",{get:function(){return w._LeftHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(w,"RightHandedForwardReadOnly",{get:function(){return w._RightHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(w,"ZeroReadOnly",{get:function(){return w._ZeroReadOnly},enumerable:!1,configurable:!0}),w.Down=function(){return new w(0,-1,0)},w.Forward=function(v){return void 0===v&&(v=!1),new w(0,0,v?-1:1)},w.Backward=function(v){return void 0===v&&(v=!1),new w(0,0,v?1:-1)},w.Right=function(){return new w(1,0,0)},w.Left=function(){return new w(-1,0,0)},w.TransformCoordinates=function(v,I){var P=w.Zero();return w.TransformCoordinatesToRef(v,I,P),P},w.TransformCoordinatesToRef=function(v,I,P){w.TransformCoordinatesFromFloatsToRef(v._x,v._y,v._z,I,P)},w.TransformCoordinatesFromFloatsToRef=function(w,v,I,P,u){var Q=P.m,K=w*Q[0]+v*Q[4]+I*Q[8]+Q[12],a=w*Q[1]+v*Q[5]+I*Q[9]+Q[13],U=w*Q[2]+v*Q[6]+I*Q[10]+Q[14],p=1/(w*Q[3]+v*Q[7]+I*Q[11]+Q[15]);u.x=K*p,u.y=a*p,u.z=U*p},w.TransformNormal=function(v,I){var P=w.Zero();return w.TransformNormalToRef(v,I,P),P},w.TransformNormalToRef=function(w,v,I){this.TransformNormalFromFloatsToRef(w._x,w._y,w._z,v,I)},w.TransformNormalFromFloatsToRef=function(w,v,I,P,u){var Q=P.m;u.x=w*Q[0]+v*Q[4]+I*Q[8],u.y=w*Q[1]+v*Q[5]+I*Q[9],u.z=w*Q[2]+v*Q[6]+I*Q[10]},w.CatmullRom=function(v,I,P,u,Q){var K=Q*Q,a=Q*K;return new w(.5*(2*I._x+(-v._x+P._x)*Q+(2*v._x-5*I._x+4*P._x-u._x)*K+(-v._x+3*I._x-3*P._x+u._x)*a),.5*(2*I._y+(-v._y+P._y)*Q+(2*v._y-5*I._y+4*P._y-u._y)*K+(-v._y+3*I._y-3*P._y+u._y)*a),.5*(2*I._z+(-v._z+P._z)*Q+(2*v._z-5*I._z+4*P._z-u._z)*K+(-v._z+3*I._z-3*P._z+u._z)*a))},w.Clamp=function(v,I,P){var u=new w;return w.ClampToRef(v,I,P,u),u},w.ClampToRef=function(w,v,I,P){var u=w._x;u=(u=u>I._x?I._x:u)<v._x?v._x:u;var Q=w._y;Q=(Q=Q>I._y?I._y:Q)<v._y?v._y:Q;var K=w._z;K=(K=K>I._z?I._z:K)<v._z?v._z:K,P.copyFromFloats(u,Q,K)},w.CheckExtends=function(w,v,I){v.minimizeInPlace(w),I.maximizeInPlace(w)},w.Hermite=function(v,I,P,u,Q){var K=Q*Q,a=Q*K,U=2*a-3*K+1,p=-2*a+3*K,r=a-2*K+Q,Y=a-K;return new w(v._x*U+P._x*p+I._x*r+u._x*Y,v._y*U+P._y*p+I._y*r+u._y*Y,v._z*U+P._z*p+I._z*r+u._z*Y)},w.Hermite1stDerivative=function(v,I,P,u,Q){var K=w.Zero();return this.Hermite1stDerivativeToRef(v,I,P,u,Q,K),K},w.Hermite1stDerivativeToRef=function(w,v,I,P,u,Q){var K=u*u;Q.x=6*(K-u)*w.x+(3*K-4*u+1)*v.x+6*(-K+u)*I.x+(3*K-2*u)*P.x,Q.y=6*(K-u)*w.y+(3*K-4*u+1)*v.y+6*(-K+u)*I.y+(3*K-2*u)*P.y,Q.z=6*(K-u)*w.z+(3*K-4*u+1)*v.z+6*(-K+u)*I.z+(3*K-2*u)*P.z},w.Lerp=function(v,I,P){var u=new w(0,0,0);return w.LerpToRef(v,I,P,u),u},w.LerpToRef=function(w,v,I,P){P.x=w._x+(v._x-w._x)*I,P.y=w._y+(v._y-w._y)*I,P.z=w._z+(v._z-w._z)*I},w.Dot=function(w,v){return w._x*v._x+w._y*v._y+w._z*v._z},w.Cross=function(v,I){var P=w.Zero();return w.CrossToRef(v,I,P),P},w.CrossToRef=function(w,v,I){var P=w._y*v._z-w._z*v._y,u=w._z*v._x-w._x*v._z,Q=w._x*v._y-w._y*v._x;I.copyFromFloats(P,u,Q)},w.Normalize=function(v){var I=w.Zero();return w.NormalizeToRef(v,I),I},w.NormalizeToRef=function(w,v){w.normalizeToRef(v)},w.Project=function(v,I,P,u){var Q=new w;return w.ProjectToRef(v,I,P,u,Q),Q},w.ProjectToRef=function(v,I,P,u,Q){var K=u.width,a=u.height,U=u.x,p=u.y,r=R.Matrix[1];l.FromValuesToRef(K/2,0,0,0,0,-a/2,0,0,0,0,.5,0,U+K/2,a/2+p,.5,1,r);var Y=R.Matrix[0];return I.multiplyToRef(P,Y),Y.multiplyToRef(r,Y),w.TransformCoordinatesToRef(v,Y,Q),Q},w._UnprojectFromInvertedMatrixToRef=function(v,I,u){w.TransformCoordinatesToRef(v,I,u);var Q=I.m,K=v._x*Q[3]+v._y*Q[7]+v._z*Q[11]+Q[15];P.b.WithinEpsilon(K,1)&&u.scaleInPlace(1/K)},w.UnprojectFromTransform=function(w,v,I,P,u){return this.Unproject(w,v,I,P,u,l.IdentityReadOnly)},w.Unproject=function(v,I,P,u,Q,K){var a=w.Zero();return w.UnprojectToRef(v,I,P,u,Q,K,a),a},w.UnprojectToRef=function(v,I,P,u,Q,K,a){w.UnprojectFloatsToRef(v._x,v._y,v._z,I,P,u,Q,K,a)},w.UnprojectFloatsToRef=function(v,I,P,u,Q,K,a,p,r){var Y,g=R.Matrix[0];K.multiplyToRef(a,g),g.multiplyToRef(p,g),g.invert();var J=R.Vector3[0];J.x=v/u*2-1,J.y=-(I/Q*2-1),(null===(Y=U.e.LastCreatedEngine)||void 0===Y?void 0:Y.isNDCHalfZRange)?J.z=P:J.z=2*P-1,w._UnprojectFromInvertedMatrixToRef(J,g,r)},w.Minimize=function(w,v){var I=w.clone();return I.minimizeInPlace(v),I},w.Maximize=function(w,v){var I=w.clone();return I.maximizeInPlace(v),I},w.Distance=function(v,I){return Math.sqrt(w.DistanceSquared(v,I))},w.DistanceSquared=function(w,v){var I=w._x-v._x,P=w._y-v._y,u=w._z-v._z;return I*I+P*P+u*u},w.ProjectOnTriangleToRef=function(v,I,Q,K,a){var U=R.Vector3[0],p=R.Vector3[1],r=R.Vector3[2],Y=R.Vector3[3],g=R.Vector3[4];Q.subtractToRef(I,U),K.subtractToRef(I,p),K.subtractToRef(Q,r);var J=U.length(),l=p.length(),x=r.length();if(J<u.e||l<u.e||x<u.e)return a.copyFrom(I),w.Distance(v,I);v.subtractToRef(I,g),w.CrossToRef(U,p,Y);var j=Y.length();if(j<u.e)return a.copyFrom(I),w.Distance(v,I);Y.normalizeFromLength(j);var s=g.length();if(s<u.e)return a.copyFrom(I),0;g.normalizeFromLength(s);var B=w.Dot(Y,g),t=R.Vector3[5],i=R.Vector3[6];t.copyFrom(Y).scaleInPlace(-s*B),i.copyFrom(v).addInPlace(t);var z=R.Vector3[4],E=R.Vector3[5],o=R.Vector3[7],h=R.Vector3[8];z.copyFrom(U).scaleInPlace(1/J),h.copyFrom(p).scaleInPlace(1/l),z.addInPlace(h).scaleInPlace(-1),E.copyFrom(U).scaleInPlace(-1/J),h.copyFrom(r).scaleInPlace(1/x),E.addInPlace(h).scaleInPlace(-1),o.copyFrom(r).scaleInPlace(-1/x),h.copyFrom(p).scaleInPlace(-1/l),o.addInPlace(h).scaleInPlace(-1);var n=R.Vector3[9];n.copyFrom(i).subtractInPlace(I),w.CrossToRef(z,n,h);var W=w.Dot(h,Y);n.copyFrom(i).subtractInPlace(Q),w.CrossToRef(E,n,h);var V=w.Dot(h,Y);n.copyFrom(i).subtractInPlace(K),w.CrossToRef(o,n,h);var F,O,N=w.Dot(h,Y),q=R.Vector3[10];W>0&&V<0?(q.copyFrom(U),F=I,O=Q):V>0&&N<0?(q.copyFrom(r),F=Q,O=K):(q.copyFrom(p).scaleInPlace(-1),F=K,O=I);var m=R.Vector3[9],c=R.Vector3[4];if(F.subtractToRef(i,h),O.subtractToRef(i,m),w.CrossToRef(h,m,c),!(w.Dot(c,Y)<0))return a.copyFrom(i),Math.abs(s*B);var M=R.Vector3[5];w.CrossToRef(q,c,M),M.normalize();var S=R.Vector3[9];S.copyFrom(F).subtractInPlace(i);var e=S.length();if(e<u.e)return a.copyFrom(F),w.Distance(v,F);S.normalizeFromLength(e);var H=w.Dot(M,S),G=R.Vector3[7];G.copyFrom(i).addInPlace(M.scaleInPlace(e*H)),h.copyFrom(G).subtractInPlace(F),s=q.length(),q.normalizeFromLength(s);var L=w.Dot(h,q)/Math.max(s,u.e);return L=P.b.Clamp(L,0,1),G.copyFrom(F).addInPlace(q.scaleInPlace(L*s)),a.copyFrom(G),w.Distance(v,G)},w.Center=function(v,I){return w.CenterToRef(v,I,w.Zero())},w.CenterToRef=function(w,v,I){return I.copyFromFloats((w._x+v._x)/2,(w._y+v._y)/2,(w._z+v._z)/2)},w.RotationFromAxis=function(v,I,P){var u=w.Zero();return w.RotationFromAxisToRef(v,I,P,u),u},w.RotationFromAxisToRef=function(w,v,I,P){var u=R.Quaternion[0];J.RotationQuaternionFromAxisToRef(w,v,I,u),u.toEulerAnglesToRef(P)},w._UpReadOnly=w.Up(),w._LeftHandedForwardReadOnly=w.Forward(!1),w._RightHandedForwardReadOnly=w.Forward(!0),w._RightReadOnly=w.Right(),w._LeftReadOnly=w.Left(),w._ZeroReadOnly=w.Zero(),w}(),g=function(){function w(w,v,I,P){this.x=w,this.y=v,this.z=I,this.w=P}return w.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y," Z: ").concat(this.z," W: ").concat(this.w,"}")},w.prototype.getClassName=function(){return"Vector4"},w.prototype.getHashCode=function(){var w=p(this.x);return w=397*(w=397*(w=397*w^p(this.y))^p(this.z))^p(this.w)},w.prototype.asArray=function(){var w=new Array;return this.toArray(w,0),w},w.prototype.toArray=function(w,v){return void 0===v&&(v=0),w[v]=this.x,w[v+1]=this.y,w[v+2]=this.z,w[v+3]=this.w,this},w.prototype.fromArray=function(v,I){return void 0===I&&(I=0),w.FromArrayToRef(v,I,this),this},w.prototype.addInPlace=function(w){return this.x+=w.x,this.y+=w.y,this.z+=w.z,this.w+=w.w,this},w.prototype.add=function(v){return new w(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)},w.prototype.addToRef=function(w,v){return v.x=this.x+w.x,v.y=this.y+w.y,v.z=this.z+w.z,v.w=this.w+w.w,this},w.prototype.subtractInPlace=function(w){return this.x-=w.x,this.y-=w.y,this.z-=w.z,this.w-=w.w,this},w.prototype.subtract=function(v){return new w(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)},w.prototype.subtractToRef=function(w,v){return v.x=this.x-w.x,v.y=this.y-w.y,v.z=this.z-w.z,v.w=this.w-w.w,this},w.prototype.subtractFromFloats=function(v,I,P,u){return new w(this.x-v,this.y-I,this.z-P,this.w-u)},w.prototype.subtractFromFloatsToRef=function(w,v,I,P,u){return u.x=this.x-w,u.y=this.y-v,u.z=this.z-I,u.w=this.w-P,this},w.prototype.negate=function(){return new w(-this.x,-this.y,-this.z,-this.w)},w.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},w.prototype.negateToRef=function(w){return w.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},w.prototype.scaleInPlace=function(w){return this.x*=w,this.y*=w,this.z*=w,this.w*=w,this},w.prototype.scale=function(v){return new w(this.x*v,this.y*v,this.z*v,this.w*v)},w.prototype.scaleToRef=function(w,v){return v.x=this.x*w,v.y=this.y*w,v.z=this.z*w,v.w=this.w*w,this},w.prototype.scaleAndAddToRef=function(w,v){return v.x+=this.x*w,v.y+=this.y*w,v.z+=this.z*w,v.w+=this.w*w,this},w.prototype.equals=function(w){return w&&this.x===w.x&&this.y===w.y&&this.z===w.z&&this.w===w.w},w.prototype.equalsWithEpsilon=function(w,v){return void 0===v&&(v=u.e),w&&P.b.WithinEpsilon(this.x,w.x,v)&&P.b.WithinEpsilon(this.y,w.y,v)&&P.b.WithinEpsilon(this.z,w.z,v)&&P.b.WithinEpsilon(this.w,w.w,v)},w.prototype.equalsToFloats=function(w,v,I,P){return this.x===w&&this.y===v&&this.z===I&&this.w===P},w.prototype.multiplyInPlace=function(w){return this.x*=w.x,this.y*=w.y,this.z*=w.z,this.w*=w.w,this},w.prototype.multiply=function(v){return new w(this.x*v.x,this.y*v.y,this.z*v.z,this.w*v.w)},w.prototype.multiplyToRef=function(w,v){return v.x=this.x*w.x,v.y=this.y*w.y,v.z=this.z*w.z,v.w=this.w*w.w,this},w.prototype.multiplyByFloats=function(v,I,P,u){return new w(this.x*v,this.y*I,this.z*P,this.w*u)},w.prototype.divide=function(v){return new w(this.x/v.x,this.y/v.y,this.z/v.z,this.w/v.w)},w.prototype.divideToRef=function(w,v){return v.x=this.x/w.x,v.y=this.y/w.y,v.z=this.z/w.z,v.w=this.w/w.w,this},w.prototype.divideInPlace=function(w){return this.divideToRef(w,this)},w.prototype.minimizeInPlace=function(w){return w.x<this.x&&(this.x=w.x),w.y<this.y&&(this.y=w.y),w.z<this.z&&(this.z=w.z),w.w<this.w&&(this.w=w.w),this},w.prototype.maximizeInPlace=function(w){return w.x>this.x&&(this.x=w.x),w.y>this.y&&(this.y=w.y),w.z>this.z&&(this.z=w.z),w.w>this.w&&(this.w=w.w),this},w.prototype.floor=function(){return new w(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},w.prototype.fract=function(){return new w(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},w.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},w.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},w.prototype.normalize=function(){var w=this.length();return 0===w?this:this.scaleInPlace(1/w)},w.prototype.toVector3=function(){return new Y(this.x,this.y,this.z)},w.prototype.clone=function(){return new w(this.x,this.y,this.z,this.w)},w.prototype.copyFrom=function(w){return this.x=w.x,this.y=w.y,this.z=w.z,this.w=w.w,this},w.prototype.copyFromFloats=function(w,v,I,P){return this.x=w,this.y=v,this.z=I,this.w=P,this},w.prototype.set=function(w,v,I,P){return this.copyFromFloats(w,v,I,P)},w.prototype.setAll=function(w){return this.x=this.y=this.z=this.w=w,this},w.FromArray=function(v,I){return I||(I=0),new w(v[I],v[I+1],v[I+2],v[I+3])},w.FromArrayToRef=function(w,v,I){I.x=w[v],I.y=w[v+1],I.z=w[v+2],I.w=w[v+3]},w.FromFloatArrayToRef=function(v,I,P){w.FromArrayToRef(v,I,P)},w.FromFloatsToRef=function(w,v,I,P,u){u.x=w,u.y=v,u.z=I,u.w=P},w.Zero=function(){return new w(0,0,0,0)},w.One=function(){return new w(1,1,1,1)},w.Normalize=function(v){var I=w.Zero();return w.NormalizeToRef(v,I),I},w.NormalizeToRef=function(w,v){v.copyFrom(w),v.normalize()},w.Minimize=function(w,v){var I=w.clone();return I.minimizeInPlace(v),I},w.Maximize=function(w,v){var I=w.clone();return I.maximizeInPlace(v),I},w.Distance=function(v,I){return Math.sqrt(w.DistanceSquared(v,I))},w.DistanceSquared=function(w,v){var I=w.x-v.x,P=w.y-v.y,u=w.z-v.z,Q=w.w-v.w;return I*I+P*P+u*u+Q*Q},w.Center=function(v,I){return w.CenterToRef(v,I,w.Zero())},w.CenterToRef=function(w,v,I){return I.copyFromFloats((w.x+v.x)/2,(w.y+v.y)/2,(w.z+v.z)/2,(w.w+v.w)/2)},w.TransformCoordinates=function(v,I){var P=w.Zero();return w.TransformCoordinatesToRef(v,I,P),P},w.TransformCoordinatesToRef=function(v,I,P){w.TransformCoordinatesFromFloatsToRef(v._x,v._y,v._z,I,P)},w.TransformCoordinatesFromFloatsToRef=function(w,v,I,P,u){var Q=P.m,K=w*Q[0]+v*Q[4]+I*Q[8]+Q[12],a=w*Q[1]+v*Q[5]+I*Q[9]+Q[13],U=w*Q[2]+v*Q[6]+I*Q[10]+Q[14],p=w*Q[3]+v*Q[7]+I*Q[11]+Q[15];u.x=K,u.y=a,u.z=U,u.w=p},w.TransformNormal=function(v,I){var P=w.Zero();return w.TransformNormalToRef(v,I,P),P},w.TransformNormalToRef=function(w,v,I){var P=v.m,u=w.x*P[0]+w.y*P[4]+w.z*P[8],Q=w.x*P[1]+w.y*P[5]+w.z*P[9],K=w.x*P[2]+w.y*P[6]+w.z*P[10];I.x=u,I.y=Q,I.z=K,I.w=w.w},w.TransformNormalFromFloatsToRef=function(w,v,I,P,u,Q){var K=u.m;Q.x=w*K[0]+v*K[4]+I*K[8],Q.y=w*K[1]+v*K[5]+I*K[9],Q.z=w*K[2]+v*K[6]+I*K[10],Q.w=P},w.FromVector3=function(v,I){return void 0===I&&(I=0),new w(v._x,v._y,v._z,I)},w}(),J=function(){function w(w,v,I,P){void 0===w&&(w=0),void 0===v&&(v=0),void 0===I&&(I=0),void 0===P&&(P=1),this._isDirty=!0,this._x=w,this._y=v,this._z=I,this._w=P}return Object.defineProperty(w.prototype,"x",{get:function(){return this._x},set:function(w){this._x=w,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"y",{get:function(){return this._y},set:function(w){this._y=w,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"z",{get:function(){return this._z},set:function(w){this._z=w,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"w",{get:function(){return this._w},set:function(w){this._w=w,this._isDirty=!0},enumerable:!1,configurable:!0}),w.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z," W: ").concat(this._w,"}")},w.prototype.getClassName=function(){return"Quaternion"},w.prototype.getHashCode=function(){var w=p(this._x);return w=397*(w=397*(w=397*w^p(this._y))^p(this._z))^p(this._w)},w.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},w.prototype.toArray=function(w,v){return void 0===v&&(v=0),w[v]=this.x,w[v+1]=this.y,w[v+2]=this.z,w[v+3]=this.w,this},w.prototype.equals=function(w){return w&&this._x===w._x&&this._y===w._y&&this._z===w._z&&this._w===w._w},w.prototype.equalsWithEpsilon=function(w,v){return void 0===v&&(v=u.e),w&&P.b.WithinEpsilon(this._x,w._x,v)&&P.b.WithinEpsilon(this._y,w._y,v)&&P.b.WithinEpsilon(this._z,w._z,v)&&P.b.WithinEpsilon(this._w,w._w,v)},w.prototype.clone=function(){return new w(this._x,this._y,this._z,this._w)},w.prototype.copyFrom=function(w){return this.x=w._x,this.y=w._y,this.z=w._z,this.w=w._w,this},w.prototype.copyFromFloats=function(w,v,I,P){return this.x=w,this.y=v,this.z=I,this.w=P,this},w.prototype.set=function(w,v,I,P){return this.copyFromFloats(w,v,I,P)},w.prototype.add=function(v){return new w(this._x+v._x,this._y+v._y,this._z+v._z,this._w+v._w)},w.prototype.addInPlace=function(w){return this._x+=w._x,this._y+=w._y,this._z+=w._z,this._w+=w._w,this},w.prototype.subtract=function(v){return new w(this._x-v._x,this._y-v._y,this._z-v._z,this._w-v._w)},w.prototype.subtractInPlace=function(w){return this._x-=w._x,this._y-=w._y,this._z-=w._z,this._w-=w._w,this},w.prototype.scale=function(v){return new w(this._x*v,this._y*v,this._z*v,this._w*v)},w.prototype.scaleToRef=function(w,v){return v.x=this._x*w,v.y=this._y*w,v.z=this._z*w,v.w=this._w*w,this},w.prototype.scaleInPlace=function(w){return this.x*=w,this.y*=w,this.z*=w,this.w*=w,this},w.prototype.scaleAndAddToRef=function(w,v){return v.x+=this._x*w,v.y+=this._y*w,v.z+=this._z*w,v.w+=this._w*w,this},w.prototype.multiply=function(v){var I=new w(0,0,0,1);return this.multiplyToRef(v,I),I},w.prototype.multiplyToRef=function(w,v){var I=this._x*w._w+this._y*w._z-this._z*w._y+this._w*w._x,P=-this._x*w._z+this._y*w._w+this._z*w._x+this._w*w._y,u=this._x*w._y-this._y*w._x+this._z*w._w+this._w*w._z,Q=-this._x*w._x-this._y*w._y-this._z*w._z+this._w*w._w;return v.copyFromFloats(I,P,u,Q),this},w.prototype.multiplyInPlace=function(w){return this.multiplyToRef(w,this),this},w.prototype.conjugateToRef=function(w){return w.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},w.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},w.prototype.conjugate=function(){return new w(-this._x,-this._y,-this._z,this._w)},w.prototype.invert=function(){var w=this.conjugate(),v=this.lengthSquared();return 0==v||1==v||w.scaleInPlace(1/v),w},w.prototype.invertInPlace=function(){this.conjugateInPlace();var w=this.lengthSquared();return 0==w||1==w||this.scaleInPlace(1/w),this},w.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},w.prototype.length=function(){return Math.sqrt(this.lengthSquared())},w.prototype.normalize=function(){var w=this.length();if(0===w)return this;var v=1/w;return this.scaleInPlace(v),this},w.prototype.normalizeToNew=function(){var w=this.length();if(0===w)return this.clone();var v=1/w;return this.scale(v)},w.prototype.toEulerAngles=function(){var w=Y.Zero();return this.toEulerAnglesToRef(w),w},w.prototype.toEulerAnglesToRef=function(w){var v=this._z,I=this._x,P=this._y,u=this._w,Q=P*v-I*u,K=.4999999;if(Q<-K)w.y=2*Math.atan2(P,u),w.x=Math.PI/2,w.z=0;else if(Q>K)w.y=2*Math.atan2(P,u),w.x=-Math.PI/2,w.z=0;else{var a=u*u,U=v*v,p=I*I,r=P*P;w.z=Math.atan2(2*(I*P+v*u),-U-p+r+a),w.x=Math.asin(-2*Q),w.y=Math.atan2(2*(v*I+P*u),U-p-r+a)}return this},w.prototype.toRotationMatrix=function(w){return l.FromQuaternionToRef(this,w),this},w.prototype.fromRotationMatrix=function(v){return w.FromRotationMatrixToRef(v,this),this},w.FromRotationMatrix=function(v){var I=new w;return w.FromRotationMatrixToRef(v,I),I},w.FromRotationMatrixToRef=function(w,v){var I,P=w.m,u=P[0],Q=P[4],K=P[8],a=P[1],U=P[5],p=P[9],r=P[2],Y=P[6],g=P[10],J=u+U+g;J>0?(I=.5/Math.sqrt(J+1),v.w=.25/I,v.x=(Y-p)*I,v.y=(K-r)*I,v.z=(a-Q)*I):u>U&&u>g?(I=2*Math.sqrt(1+u-U-g),v.w=(Y-p)/I,v.x=.25*I,v.y=(Q+a)/I,v.z=(K+r)/I):U>g?(I=2*Math.sqrt(1+U-u-g),v.w=(K-r)/I,v.x=(Q+a)/I,v.y=.25*I,v.z=(p+Y)/I):(I=2*Math.sqrt(1+g-u-U),v.w=(a-Q)/I,v.x=(K+r)/I,v.y=(p+Y)/I,v.z=.25*I)},w.Dot=function(w,v){return w._x*v._x+w._y*v._y+w._z*v._z+w._w*v._w},w.AreClose=function(v,I){return w.Dot(v,I)>=0},w.SmoothToRef=function(v,I,u,Q,K){var a=0===Q?1:u/Q;a=P.b.Clamp(a,0,1),w.SlerpToRef(v,I,a,K)},w.Zero=function(){return new w(0,0,0,0)},w.Inverse=function(v){return new w(-v._x,-v._y,-v._z,v._w)},w.InverseToRef=function(w,v){return v.set(-w._x,-w._y,-w._z,w._w),v},w.Identity=function(){return new w(0,0,0,1)},w.IsIdentity=function(w){return w&&0===w._x&&0===w._y&&0===w._z&&1===w._w},w.RotationAxis=function(v,I){return w.RotationAxisToRef(v,I,new w)},w.RotationAxisToRef=function(w,v,I){var P=Math.sin(v/2);return w.normalize(),I.w=Math.cos(v/2),I.x=w._x*P,I.y=w._y*P,I.z=w._z*P,I},w.FromArray=function(v,I){return I||(I=0),new w(v[I],v[I+1],v[I+2],v[I+3])},w.FromArrayToRef=function(w,v,I){I.x=w[v],I.y=w[v+1],I.z=w[v+2],I.w=w[v+3]},w.FromEulerAngles=function(v,I,P){var u=new w;return w.RotationYawPitchRollToRef(I,v,P,u),u},w.FromEulerAnglesToRef=function(v,I,P,u){return w.RotationYawPitchRollToRef(I,v,P,u),u},w.FromEulerVector=function(v){var I=new w;return w.RotationYawPitchRollToRef(v._y,v._x,v._z,I),I},w.FromEulerVectorToRef=function(v,I){return w.RotationYawPitchRollToRef(v._y,v._x,v._z,I),I},w.FromUnitVectorsToRef=function(w,v,I){var P=Y.Dot(w,v)+1;return P<u.e?Math.abs(w.x)>Math.abs(w.z)?I.set(-w.y,w.x,0,0):I.set(0,-w.z,w.y,0):(Y.CrossToRef(w,v,x.Vector3[0]),I.set(x.Vector3[0].x,x.Vector3[0].y,x.Vector3[0].z,P)),I.normalize()},w.RotationYawPitchRoll=function(v,I,P){var u=new w;return w.RotationYawPitchRollToRef(v,I,P,u),u},w.RotationYawPitchRollToRef=function(w,v,I,P){var u=.5*I,Q=.5*v,K=.5*w,a=Math.sin(u),U=Math.cos(u),p=Math.sin(Q),r=Math.cos(Q),Y=Math.sin(K),g=Math.cos(K);P.x=g*p*U+Y*r*a,P.y=Y*r*U-g*p*a,P.z=g*r*a-Y*p*U,P.w=g*r*U+Y*p*a},w.RotationAlphaBetaGamma=function(v,I,P){var u=new w;return w.RotationAlphaBetaGammaToRef(v,I,P,u),u},w.RotationAlphaBetaGammaToRef=function(w,v,I,P){var u=.5*(I+w),Q=.5*(I-w),K=.5*v;P.x=Math.cos(Q)*Math.sin(K),P.y=Math.sin(Q)*Math.sin(K),P.z=Math.sin(u)*Math.cos(K),P.w=Math.cos(u)*Math.cos(K)},w.RotationQuaternionFromAxis=function(v,I,P){var u=new w(0,0,0,0);return w.RotationQuaternionFromAxisToRef(v,I,P,u),u},w.RotationQuaternionFromAxisToRef=function(v,I,P,u){var Q=R.Matrix[0];l.FromXYZAxesToRef(v.normalize(),I.normalize(),P.normalize(),Q),w.FromRotationMatrixToRef(Q,u)},w.FromLookDirectionLH=function(v,I){var P=new w;return w.FromLookDirectionLHToRef(v,I,P),P},w.FromLookDirectionLHToRef=function(v,I,P){var u=R.Matrix[0];l.LookDirectionLHToRef(v,I,u),w.FromRotationMatrixToRef(u,P)},w.FromLookDirectionRH=function(v,I){var P=new w;return w.FromLookDirectionRHToRef(v,I,P),P},w.FromLookDirectionRHToRef=function(v,I,P){var u=R.Matrix[0];return l.LookDirectionRHToRef(v,I,u),w.FromRotationMatrixToRef(u,P)},w.Slerp=function(v,I,P){var u=w.Identity();return w.SlerpToRef(v,I,P,u),u},w.SlerpToRef=function(w,v,I,P){var u,Q,K=w._x*v._x+w._y*v._y+w._z*v._z+w._w*v._w,a=!1;if(K<0&&(a=!0,K=-K),K>.999999)Q=1-I,u=a?-I:I;else{var U=Math.acos(K),p=1/Math.sin(U);Q=Math.sin((1-I)*U)*p,u=a?-Math.sin(I*U)*p:Math.sin(I*U)*p}P.x=Q*w._x+u*v._x,P.y=Q*w._y+u*v._y,P.z=Q*w._z+u*v._z,P.w=Q*w._w+u*v._w},w.Hermite=function(v,I,P,u,Q){var K=Q*Q,a=Q*K,U=2*a-3*K+1,p=-2*a+3*K,r=a-2*K+Q,Y=a-K;return new w(v._x*U+P._x*p+I._x*r+u._x*Y,v._y*U+P._y*p+I._y*r+u._y*Y,v._z*U+P._z*p+I._z*r+u._z*Y,v._w*U+P._w*p+I._w*r+u._w*Y)},w.Hermite1stDerivative=function(v,I,P,u,Q){var K=w.Zero();return this.Hermite1stDerivativeToRef(v,I,P,u,Q,K),K},w.Hermite1stDerivativeToRef=function(w,v,I,P,u,Q){var K=u*u;Q.x=6*(K-u)*w.x+(3*K-4*u+1)*v.x+6*(-K+u)*I.x+(3*K-2*u)*P.x,Q.y=6*(K-u)*w.y+(3*K-4*u+1)*v.y+6*(-K+u)*I.y+(3*K-2*u)*P.y,Q.z=6*(K-u)*w.z+(3*K-4*u+1)*v.z+6*(-K+u)*I.z+(3*K-2*u)*P.z,Q.w=6*(K-u)*w.w+(3*K-4*u+1)*v.w+6*(-K+u)*I.w+(3*K-2*u)*P.w},w}(),l=function(){function w(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,a.c.MatrixTrackPrecisionChange&&a.c.MatrixTrackedMatrices.push(this),this._m=new a.c.MatrixCurrentType(16),this.markAsUpdated()}return Object.defineProperty(w,"Use64Bits",{get:function(){return a.c.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),w.prototype.markAsUpdated=function(){this.updateFlag=w._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},w.prototype._updateIdentityStatus=function(w,v,I,P){void 0===v&&(v=!1),void 0===I&&(I=!1),void 0===P&&(P=!0),this._isIdentity=w,this._isIdentity3x2=w||I,this._isIdentityDirty=!this._isIdentity&&v,this._isIdentity3x2Dirty=!this._isIdentity3x2&&P},w.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var w=this._m;this._isIdentity=1===w[0]&&0===w[1]&&0===w[2]&&0===w[3]&&0===w[4]&&1===w[5]&&0===w[6]&&0===w[7]&&0===w[8]&&0===w[9]&&1===w[10]&&0===w[11]&&0===w[12]&&0===w[13]&&0===w[14]&&1===w[15]}return this._isIdentity},w.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},w.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var w=this._m,v=w[0],I=w[1],P=w[2],u=w[3],Q=w[4],K=w[5],a=w[6],U=w[7],p=w[8],r=w[9],Y=w[10],g=w[11],J=w[12],l=w[13],R=w[14],x=w[15],j=Y*x-R*g,s=r*x-l*g,B=r*R-l*Y,t=p*x-J*g,i=p*R-Y*J,z=p*l-J*r;return v*+(K*j-a*s+U*B)+I*-(Q*j-a*t+U*i)+P*+(Q*s-K*t+U*z)+u*-(Q*B-K*i+a*z)},w.prototype.toArray=function(){return this._m},w.prototype.asArray=function(){return this._m},w.prototype.invert=function(){return this.invertToRef(this),this},w.prototype.reset=function(){return w.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},w.prototype.add=function(v){var I=new w;return this.addToRef(v,I),I},w.prototype.addToRef=function(w,v){for(var I=this._m,P=v._m,u=w.m,Q=0;Q<16;Q++)P[Q]=I[Q]+u[Q];return v.markAsUpdated(),this},w.prototype.addToSelf=function(w){for(var v=this._m,I=w.m,P=0;P<16;P++)v[P]+=I[P];return this.markAsUpdated(),this},w.prototype.invertToRef=function(v){if(!0===this._isIdentity)return w.IdentityToRef(v),this;var I=this._m,P=I[0],u=I[1],Q=I[2],K=I[3],a=I[4],U=I[5],p=I[6],r=I[7],Y=I[8],g=I[9],J=I[10],l=I[11],R=I[12],x=I[13],j=I[14],s=I[15],B=J*s-j*l,t=g*s-x*l,i=g*j-x*J,z=Y*s-R*l,E=Y*j-J*R,o=Y*x-R*g,h=+(U*B-p*t+r*i),n=-(a*B-p*z+r*E),W=+(a*t-U*z+r*o),V=-(a*i-U*E+p*o),F=P*h+u*n+Q*W+K*V;if(0===F)return v.copyFrom(this),this;var O=1/F,N=p*s-j*r,q=U*s-x*r,m=U*j-x*p,c=a*s-R*r,M=a*j-R*p,S=a*x-R*U,e=p*l-J*r,H=U*l-g*r,G=U*J-g*p,L=a*l-Y*r,d=a*J-Y*p,D=a*g-Y*U,f=-(u*B-Q*t+K*i),b=+(P*B-Q*z+K*E),k=-(P*t-u*z+K*o),C=+(P*i-u*E+Q*o),y=+(u*N-Q*q+K*m),T=-(P*N-Q*c+K*M),Z=+(P*q-u*c+K*S),A=-(P*m-u*M+Q*S),X=-(u*e-Q*H+K*G),ww=+(P*e-Q*L+K*d),vw=-(P*H-u*L+K*D),Iw=+(P*G-u*d+Q*D);return w.FromValuesToRef(h*O,f*O,y*O,X*O,n*O,b*O,T*O,ww*O,W*O,k*O,Z*O,vw*O,V*O,C*O,A*O,Iw*O,v),this},w.prototype.addAtIndex=function(w,v){return this._m[w]+=v,this.markAsUpdated(),this},w.prototype.multiplyAtIndex=function(w,v){return this._m[w]*=v,this.markAsUpdated(),this},w.prototype.setTranslationFromFloats=function(w,v,I){return this._m[12]=w,this._m[13]=v,this._m[14]=I,this.markAsUpdated(),this},w.prototype.addTranslationFromFloats=function(w,v,I){return this._m[12]+=w,this._m[13]+=v,this._m[14]+=I,this.markAsUpdated(),this},w.prototype.setTranslation=function(w){return this.setTranslationFromFloats(w._x,w._y,w._z)},w.prototype.getTranslation=function(){return new Y(this._m[12],this._m[13],this._m[14])},w.prototype.getTranslationToRef=function(w){return w.x=this._m[12],w.y=this._m[13],w.z=this._m[14],this},w.prototype.removeRotationAndScaling=function(){var v=this.m;return w.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v[12],v[13],v[14],v[15],this),this._updateIdentityStatus(0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]),this},w.prototype.multiply=function(v){var I=new w;return this.multiplyToRef(v,I),I},w.prototype.copyFrom=function(w){w.copyToArray(this._m);var v=w;return this.updateFlag=v.updateFlag,this._updateIdentityStatus(v._isIdentity,v._isIdentityDirty,v._isIdentity3x2,v._isIdentity3x2Dirty),this},w.prototype.copyToArray=function(w,v){void 0===v&&(v=0);var I=this._m;return w[v]=I[0],w[v+1]=I[1],w[v+2]=I[2],w[v+3]=I[3],w[v+4]=I[4],w[v+5]=I[5],w[v+6]=I[6],w[v+7]=I[7],w[v+8]=I[8],w[v+9]=I[9],w[v+10]=I[10],w[v+11]=I[11],w[v+12]=I[12],w[v+13]=I[13],w[v+14]=I[14],w[v+15]=I[15],this},w.prototype.multiplyToRef=function(w,v){return this._isIdentity?(v.copyFrom(w),this):w._isIdentity?(v.copyFrom(this),this):(this.multiplyToArray(w,v._m,0),v.markAsUpdated(),this)},w.prototype.multiplyToArray=function(w,v,I){var P=this._m,u=w.m,Q=P[0],K=P[1],a=P[2],U=P[3],p=P[4],r=P[5],Y=P[6],g=P[7],J=P[8],l=P[9],R=P[10],x=P[11],j=P[12],s=P[13],B=P[14],t=P[15],i=u[0],z=u[1],E=u[2],o=u[3],h=u[4],n=u[5],W=u[6],V=u[7],F=u[8],O=u[9],N=u[10],q=u[11],m=u[12],c=u[13],M=u[14],S=u[15];return v[I]=Q*i+K*h+a*F+U*m,v[I+1]=Q*z+K*n+a*O+U*c,v[I+2]=Q*E+K*W+a*N+U*M,v[I+3]=Q*o+K*V+a*q+U*S,v[I+4]=p*i+r*h+Y*F+g*m,v[I+5]=p*z+r*n+Y*O+g*c,v[I+6]=p*E+r*W+Y*N+g*M,v[I+7]=p*o+r*V+Y*q+g*S,v[I+8]=J*i+l*h+R*F+x*m,v[I+9]=J*z+l*n+R*O+x*c,v[I+10]=J*E+l*W+R*N+x*M,v[I+11]=J*o+l*V+R*q+x*S,v[I+12]=j*i+s*h+B*F+t*m,v[I+13]=j*z+s*n+B*O+t*c,v[I+14]=j*E+s*W+B*N+t*M,v[I+15]=j*o+s*V+B*q+t*S,this},w.prototype.equals=function(w){var v=w;if(!v)return!1;if((this._isIdentity||v._isIdentity)&&!this._isIdentityDirty&&!v._isIdentityDirty)return this._isIdentity&&v._isIdentity;var I=this.m,P=v.m;return I[0]===P[0]&&I[1]===P[1]&&I[2]===P[2]&&I[3]===P[3]&&I[4]===P[4]&&I[5]===P[5]&&I[6]===P[6]&&I[7]===P[7]&&I[8]===P[8]&&I[9]===P[9]&&I[10]===P[10]&&I[11]===P[11]&&I[12]===P[12]&&I[13]===P[13]&&I[14]===P[14]&&I[15]===P[15]},w.prototype.clone=function(){var v=new w;return v.copyFrom(this),v},w.prototype.getClassName=function(){return"Matrix"},w.prototype.getHashCode=function(){for(var w=p(this._m[0]),v=1;v<16;v++)w=397*w^p(this._m[v]);return w},w.prototype.decomposeToTransformNode=function(w){return w.rotationQuaternion=w.rotationQuaternion||new J,this.decompose(w.scaling,w.rotationQuaternion,w.position)},w.prototype.decompose=function(v,I,P,u){if(this._isIdentity)return P&&P.setAll(0),v&&v.setAll(1),I&&I.copyFromFloats(0,0,0,1),!0;var Q=this._m;if(P&&P.copyFromFloats(Q[12],Q[13],Q[14]),(v=v||R.Vector3[0]).x=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]),v.y=Math.sqrt(Q[4]*Q[4]+Q[5]*Q[5]+Q[6]*Q[6]),v.z=Math.sqrt(Q[8]*Q[8]+Q[9]*Q[9]+Q[10]*Q[10]),u){var K=u.scaling.x<0?-1:1,a=u.scaling.y<0?-1:1,U=u.scaling.z<0?-1:1;v.x*=K,v.y*=a,v.z*=U}else this.determinant()<=0&&(v.y*=-1);if(0===v._x||0===v._y||0===v._z)return I&&I.copyFromFloats(0,0,0,1),!1;if(I){var p=1/v._x,r=1/v._y,Y=1/v._z;w.FromValuesToRef(Q[0]*p,Q[1]*p,Q[2]*p,0,Q[4]*r,Q[5]*r,Q[6]*r,0,Q[8]*Y,Q[9]*Y,Q[10]*Y,0,0,0,0,1,R.Matrix[0]),J.FromRotationMatrixToRef(R.Matrix[0],I)}return!0},w.prototype.getRow=function(w){if(w<0||w>3)return null;var v=4*w;return new g(this._m[v+0],this._m[v+1],this._m[v+2],this._m[v+3])},w.prototype.setRow=function(w,v){return this.setRowFromFloats(w,v.x,v.y,v.z,v.w)},w.prototype.transpose=function(){return w.Transpose(this)},w.prototype.transposeToRef=function(v){return w.TransposeToRef(this,v),this},w.prototype.setRowFromFloats=function(w,v,I,P,u){if(w<0||w>3)return this;var Q=4*w;return this._m[Q+0]=v,this._m[Q+1]=I,this._m[Q+2]=P,this._m[Q+3]=u,this.markAsUpdated(),this},w.prototype.scale=function(v){var I=new w;return this.scaleToRef(v,I),I},w.prototype.scaleToRef=function(w,v){for(var I=0;I<16;I++)v._m[I]=this._m[I]*w;return v.markAsUpdated(),this},w.prototype.scaleAndAddToRef=function(w,v){for(var I=0;I<16;I++)v._m[I]+=this._m[I]*w;return v.markAsUpdated(),this},w.prototype.toNormalMatrix=function(v){var I=R.Matrix[0];this.invertToRef(I),I.transposeToRef(v);var P=v._m;w.FromValuesToRef(P[0],P[1],P[2],0,P[4],P[5],P[6],0,P[8],P[9],P[10],0,0,0,0,1,v)},w.prototype.getRotationMatrix=function(){var v=new w;return this.getRotationMatrixToRef(v),v},w.prototype.getRotationMatrixToRef=function(v){var I=R.Vector3[0];if(!this.decompose(I))return w.IdentityToRef(v),this;var P=this._m,u=1/I._x,Q=1/I._y,K=1/I._z;return w.FromValuesToRef(P[0]*u,P[1]*u,P[2]*u,0,P[4]*Q,P[5]*Q,P[6]*Q,0,P[8]*K,P[9]*K,P[10]*K,0,0,0,0,1,v),this},w.prototype.toggleModelMatrixHandInPlace=function(){var w=this._m;w[2]*=-1,w[6]*=-1,w[8]*=-1,w[9]*=-1,w[14]*=-1,this.markAsUpdated()},w.prototype.toggleProjectionMatrixHandInPlace=function(){var w=this._m;w[8]*=-1,w[9]*=-1,w[10]*=-1,w[11]*=-1,this.markAsUpdated()},w.FromArray=function(v,I){void 0===I&&(I=0);var P=new w;return w.FromArrayToRef(v,I,P),P},w.FromArrayToRef=function(w,v,I){for(var P=0;P<16;P++)I._m[P]=w[P+v];I.markAsUpdated()},w.FromFloat32ArrayToRefScaled=function(w,v,I,P){for(var u=0;u<16;u++)P._m[u]=w[u+v]*I;P.markAsUpdated()},Object.defineProperty(w,"IdentityReadOnly",{get:function(){return w._IdentityReadOnly},enumerable:!1,configurable:!0}),w.FromValuesToRef=function(w,v,I,P,u,Q,K,a,U,p,r,Y,g,J,l,R,x){var j=x._m;j[0]=w,j[1]=v,j[2]=I,j[3]=P,j[4]=u,j[5]=Q,j[6]=K,j[7]=a,j[8]=U,j[9]=p,j[10]=r,j[11]=Y,j[12]=g,j[13]=J,j[14]=l,j[15]=R,x.markAsUpdated()},w.FromValues=function(v,I,P,u,Q,K,a,U,p,r,Y,g,J,l,R,x){var j=new w,s=j._m;return s[0]=v,s[1]=I,s[2]=P,s[3]=u,s[4]=Q,s[5]=K,s[6]=a,s[7]=U,s[8]=p,s[9]=r,s[10]=Y,s[11]=g,s[12]=J,s[13]=l,s[14]=R,s[15]=x,j.markAsUpdated(),j},w.Compose=function(v,I,P){var u=new w;return w.ComposeToRef(v,I,P,u),u},w.ComposeToRef=function(w,v,I,P){var u=P._m,Q=v._x,K=v._y,a=v._z,U=v._w,p=Q+Q,r=K+K,Y=a+a,g=Q*p,J=Q*r,l=Q*Y,R=K*r,x=K*Y,j=a*Y,s=U*p,B=U*r,t=U*Y,i=w._x,z=w._y,E=w._z;u[0]=(1-(R+j))*i,u[1]=(J+t)*i,u[2]=(l-B)*i,u[3]=0,u[4]=(J-t)*z,u[5]=(1-(g+j))*z,u[6]=(x+s)*z,u[7]=0,u[8]=(l+B)*E,u[9]=(x-s)*E,u[10]=(1-(g+R))*E,u[11]=0,u[12]=I._x,u[13]=I._y,u[14]=I._z,u[15]=1,P.markAsUpdated()},w.Identity=function(){var v=w.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return v._updateIdentityStatus(!0),v},w.IdentityToRef=function(v){w.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(!0)},w.Zero=function(){var v=w.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return v._updateIdentityStatus(!1),v},w.RotationX=function(v){var I=new w;return w.RotationXToRef(v,I),I},w.Invert=function(v){var I=new w;return v.invertToRef(I),I},w.RotationXToRef=function(v,I){var P=Math.sin(v),u=Math.cos(v);w.FromValuesToRef(1,0,0,0,0,u,P,0,0,-P,u,0,0,0,0,1,I),I._updateIdentityStatus(1===u&&0===P)},w.RotationY=function(v){var I=new w;return w.RotationYToRef(v,I),I},w.RotationYToRef=function(v,I){var P=Math.sin(v),u=Math.cos(v);w.FromValuesToRef(u,0,-P,0,0,1,0,0,P,0,u,0,0,0,0,1,I),I._updateIdentityStatus(1===u&&0===P)},w.RotationZ=function(v){var I=new w;return w.RotationZToRef(v,I),I},w.RotationZToRef=function(v,I){var P=Math.sin(v),u=Math.cos(v);w.FromValuesToRef(u,P,0,0,-P,u,0,0,0,0,1,0,0,0,0,1,I),I._updateIdentityStatus(1===u&&0===P)},w.RotationAxis=function(v,I){var P=new w;return w.RotationAxisToRef(v,I,P),P},w.RotationAxisToRef=function(w,v,I){var P=Math.sin(-v),u=Math.cos(-v),Q=1-u;w.normalize();var K=I._m;K[0]=w._x*w._x*Q+u,K[1]=w._x*w._y*Q-w._z*P,K[2]=w._x*w._z*Q+w._y*P,K[3]=0,K[4]=w._y*w._x*Q+w._z*P,K[5]=w._y*w._y*Q+u,K[6]=w._y*w._z*Q-w._x*P,K[7]=0,K[8]=w._z*w._x*Q-w._y*P,K[9]=w._z*w._y*Q+w._x*P,K[10]=w._z*w._z*Q+u,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,I.markAsUpdated()},w.RotationAlignToRef=function(w,v,I){var P=Y.Dot(v,w),Q=I._m;if(P<-1+u.e)Q[0]=-1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=-1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0;else{var K=Y.Cross(v,w),a=1/(1+P);Q[0]=K._x*K._x*a+P,Q[1]=K._y*K._x*a-K._z,Q[2]=K._z*K._x*a+K._y,Q[3]=0,Q[4]=K._x*K._y*a+K._z,Q[5]=K._y*K._y*a+P,Q[6]=K._z*K._y*a-K._x,Q[7]=0,Q[8]=K._x*K._z*a-K._y,Q[9]=K._y*K._z*a+K._x,Q[10]=K._z*K._z*a+P,Q[11]=0}Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,I.markAsUpdated()},w.RotationYawPitchRoll=function(v,I,P){var u=new w;return w.RotationYawPitchRollToRef(v,I,P,u),u},w.RotationYawPitchRollToRef=function(w,v,I,P){J.RotationYawPitchRollToRef(w,v,I,R.Quaternion[0]),R.Quaternion[0].toRotationMatrix(P)},w.Scaling=function(v,I,P){var u=new w;return w.ScalingToRef(v,I,P,u),u},w.ScalingToRef=function(v,I,P,u){w.FromValuesToRef(v,0,0,0,0,I,0,0,0,0,P,0,0,0,0,1,u),u._updateIdentityStatus(1===v&&1===I&&1===P)},w.Translation=function(v,I,P){var u=new w;return w.TranslationToRef(v,I,P,u),u},w.TranslationToRef=function(v,I,P,u){w.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v,I,P,1,u),u._updateIdentityStatus(0===v&&0===I&&0===P)},w.Lerp=function(v,I,P){var u=new w;return w.LerpToRef(v,I,P,u),u},w.LerpToRef=function(w,v,I,P){for(var u=P._m,Q=w.m,K=v.m,a=0;a<16;a++)u[a]=Q[a]*(1-I)+K[a]*I;P.markAsUpdated()},w.DecomposeLerp=function(v,I,P){var u=new w;return w.DecomposeLerpToRef(v,I,P,u),u},w.DecomposeLerpToRef=function(v,I,P,u){var Q=R.Vector3[0],K=R.Quaternion[0],a=R.Vector3[1];v.decompose(Q,K,a);var U=R.Vector3[2],p=R.Quaternion[1],r=R.Vector3[3];I.decompose(U,p,r);var g=R.Vector3[4];Y.LerpToRef(Q,U,P,g);var l=R.Quaternion[2];J.SlerpToRef(K,p,P,l);var x=R.Vector3[5];Y.LerpToRef(a,r,P,x),w.ComposeToRef(g,l,x,u)},w.LookAtLH=function(v,I,P){var u=new w;return w.LookAtLHToRef(v,I,P,u),u},w.LookAtLHToRef=function(v,I,P,u){var Q=R.Vector3[0],K=R.Vector3[1],a=R.Vector3[2];I.subtractToRef(v,a),a.normalize(),Y.CrossToRef(P,a,Q);var U=Q.lengthSquared();0===U?Q.x=1:Q.normalizeFromLength(Math.sqrt(U)),Y.CrossToRef(a,Q,K),K.normalize();var p=-Y.Dot(Q,v),r=-Y.Dot(K,v),g=-Y.Dot(a,v);w.FromValuesToRef(Q._x,K._x,a._x,0,Q._y,K._y,a._y,0,Q._z,K._z,a._z,0,p,r,g,1,u)},w.LookAtRH=function(v,I,P){var u=new w;return w.LookAtRHToRef(v,I,P,u),u},w.LookAtRHToRef=function(v,I,P,u){var Q=R.Vector3[0],K=R.Vector3[1],a=R.Vector3[2];v.subtractToRef(I,a),a.normalize(),Y.CrossToRef(P,a,Q);var U=Q.lengthSquared();0===U?Q.x=1:Q.normalizeFromLength(Math.sqrt(U)),Y.CrossToRef(a,Q,K),K.normalize();var p=-Y.Dot(Q,v),r=-Y.Dot(K,v),g=-Y.Dot(a,v);w.FromValuesToRef(Q._x,K._x,a._x,0,Q._y,K._y,a._y,0,Q._z,K._z,a._z,0,p,r,g,1,u)},w.LookDirectionLH=function(v,I){var P=new w;return w.LookDirectionLHToRef(v,I,P),P},w.LookDirectionLHToRef=function(v,I,P){var u=R.Vector3[0];u.copyFrom(v),u.scaleInPlace(-1);var Q=R.Vector3[1];Y.CrossToRef(I,u,Q),w.FromValuesToRef(Q._x,Q._y,Q._z,0,I._x,I._y,I._z,0,u._x,u._y,u._z,0,0,0,0,1,P)},w.LookDirectionRH=function(v,I){var P=new w;return w.LookDirectionRHToRef(v,I,P),P},w.LookDirectionRHToRef=function(v,I,P){var u=R.Vector3[2];Y.CrossToRef(I,v,u),w.FromValuesToRef(u._x,u._y,u._z,0,I._x,I._y,I._z,0,v._x,v._y,v._z,0,0,0,0,1,P)},w.OrthoLH=function(v,I,P,u,Q){var K=new w;return w.OrthoLHToRef(v,I,P,u,K,Q),K},w.OrthoLHToRef=function(v,I,P,u,Q,K){var a=2/v,U=2/I,p=2/(u-P),r=-(u+P)/(u-P);w.FromValuesToRef(a,0,0,0,0,U,0,0,0,0,p,0,0,0,r,1,Q),K&&Q.multiplyToRef(j,Q),Q._updateIdentityStatus(1===a&&1===U&&1===p&&0===r)},w.OrthoOffCenterLH=function(v,I,P,u,Q,K,a){var U=new w;return w.OrthoOffCenterLHToRef(v,I,P,u,Q,K,U,a),U},w.OrthoOffCenterLHToRef=function(v,I,P,u,Q,K,a,U){var p=2/(I-v),r=2/(u-P),Y=2/(K-Q),g=-(K+Q)/(K-Q),J=(v+I)/(v-I),l=(u+P)/(P-u);w.FromValuesToRef(p,0,0,0,0,r,0,0,0,0,Y,0,J,l,g,1,a),U&&a.multiplyToRef(j,a),a.markAsUpdated()},w.OrthoOffCenterRH=function(v,I,P,u,Q,K,a){var U=new w;return w.OrthoOffCenterRHToRef(v,I,P,u,Q,K,U,a),U},w.OrthoOffCenterRHToRef=function(v,I,P,u,Q,K,a,U){w.OrthoOffCenterLHToRef(v,I,P,u,Q,K,a,U),a._m[10]*=-1},w.PerspectiveLH=function(v,I,P,u,Q,K){void 0===K&&(K=0);var a=new w,U=2*P/v,p=2*P/I,r=(u+P)/(u-P),Y=-2*u*P/(u-P),g=Math.tan(K);return w.FromValuesToRef(U,0,0,0,0,p,0,g,0,0,r,1,0,0,Y,0,a),Q&&a.multiplyToRef(j,a),a._updateIdentityStatus(!1),a},w.PerspectiveFovLH=function(v,I,P,u,Q,K,a){void 0===K&&(K=0),void 0===a&&(a=!1);var U=new w;return w.PerspectiveFovLHToRef(v,I,P,u,U,!0,Q,K,a),U},w.PerspectiveFovLHToRef=function(v,I,P,u,Q,K,a,U,p){void 0===K&&(K=!0),void 0===U&&(U=0),void 0===p&&(p=!1);var r=P,Y=u,g=1/Math.tan(.5*v),J=K?g/I:g,l=K?g:g*I,R=p&&0===r?-1:0!==Y?(Y+r)/(Y-r):1,x=p&&0===r?2*Y:0!==Y?-2*Y*r/(Y-r):-2*r,s=Math.tan(U);w.FromValuesToRef(J,0,0,0,0,l,0,s,0,0,R,1,0,0,x,0,Q),a&&Q.multiplyToRef(j,Q),Q._updateIdentityStatus(!1)},w.PerspectiveFovReverseLHToRef=function(v,I,P,u,Q,K,a,U){void 0===K&&(K=!0),void 0===U&&(U=0);var p=1/Math.tan(.5*v),r=K?p/I:p,Y=K?p:p*I,g=Math.tan(U);w.FromValuesToRef(r,0,0,0,0,Y,0,g,0,0,-P,1,0,0,1,0,Q),a&&Q.multiplyToRef(j,Q),Q._updateIdentityStatus(!1)},w.PerspectiveFovRH=function(v,I,P,u,Q,K,a){void 0===K&&(K=0),void 0===a&&(a=!1);var U=new w;return w.PerspectiveFovRHToRef(v,I,P,u,U,!0,Q,K,a),U},w.PerspectiveFovRHToRef=function(v,I,P,u,Q,K,a,U,p){void 0===K&&(K=!0),void 0===U&&(U=0),void 0===p&&(p=!1);var r=P,Y=u,g=1/Math.tan(.5*v),J=K?g/I:g,l=K?g:g*I,R=p&&0===r?1:0!==Y?-(Y+r)/(Y-r):-1,x=p&&0===r?2*Y:0!==Y?-2*Y*r/(Y-r):-2*r,s=Math.tan(U);w.FromValuesToRef(J,0,0,0,0,l,0,s,0,0,R,-1,0,0,x,0,Q),a&&Q.multiplyToRef(j,Q),Q._updateIdentityStatus(!1)},w.PerspectiveFovReverseRHToRef=function(v,I,P,u,Q,K,a,U){void 0===K&&(K=!0),void 0===U&&(U=0);var p=1/Math.tan(.5*v),r=K?p/I:p,Y=K?p:p*I,g=Math.tan(U);w.FromValuesToRef(r,0,0,0,0,Y,0,g,0,0,-P,-1,0,0,-1,0,Q),a&&Q.multiplyToRef(j,Q),Q._updateIdentityStatus(!1)},w.PerspectiveFovWebVRToRef=function(w,v,I,P,u,Q,K){void 0===u&&(u=!1),void 0===K&&(K=0);var a=u?-1:1,U=Math.tan(w.upDegrees*Math.PI/180),p=Math.tan(w.downDegrees*Math.PI/180),r=Math.tan(w.leftDegrees*Math.PI/180),Y=Math.tan(w.rightDegrees*Math.PI/180),g=2/(r+Y),J=2/(U+p),l=Math.tan(K),R=P._m;R[0]=g,R[1]=R[2]=R[3]=R[4]=0,R[5]=J,R[6]=0,R[7]=l,R[8]=(r-Y)*g*.5,R[9]=-(U-p)*J*.5,R[10]=-I/(v-I),R[11]=1*a,R[12]=R[13]=R[15]=0,R[14]=-2*I*v/(I-v),Q&&P.multiplyToRef(j,P),P.markAsUpdated()},w.GetFinalMatrix=function(v,I,P,u,Q,K){var a=v.width,U=v.height,p=v.x,r=v.y,Y=w.FromValues(a/2,0,0,0,0,-U/2,0,0,0,0,K-Q,0,p+a/2,U/2+r,Q,1),g=R.Matrix[0];return I.multiplyToRef(P,g),g.multiplyToRef(u,g),g.multiply(Y)},w.GetAsMatrix2x2=function(w){var v=w.m,I=[v[0],v[1],v[4],v[5]];return a.c.MatrixUse64Bits?I:new Float32Array(I)},w.GetAsMatrix3x3=function(w){var v=w.m,I=[v[0],v[1],v[2],v[4],v[5],v[6],v[8],v[9],v[10]];return a.c.MatrixUse64Bits?I:new Float32Array(I)},w.Transpose=function(v){var I=new w;return w.TransposeToRef(v,I),I},w.TransposeToRef=function(w,v){var I=v._m,P=w.m;I[0]=P[0],I[1]=P[4],I[2]=P[8],I[3]=P[12],I[4]=P[1],I[5]=P[5],I[6]=P[9],I[7]=P[13],I[8]=P[2],I[9]=P[6],I[10]=P[10],I[11]=P[14],I[12]=P[3],I[13]=P[7],I[14]=P[11],I[15]=P[15],v.markAsUpdated(),v._updateIdentityStatus(w._isIdentity,w._isIdentityDirty)},w.Reflection=function(v){var I=new w;return w.ReflectionToRef(v,I),I},w.ReflectionToRef=function(v,I){v.normalize();var P=v.normal.x,u=v.normal.y,Q=v.normal.z,K=-2*P,a=-2*u,U=-2*Q;w.FromValuesToRef(K*P+1,a*P,U*P,0,K*u,a*u+1,U*u,0,K*Q,a*Q,U*Q+1,0,K*v.d,a*v.d,U*v.d,1,I)},w.FromXYZAxesToRef=function(v,I,P,u){w.FromValuesToRef(v._x,v._y,v._z,0,I._x,I._y,I._z,0,P._x,P._y,P._z,0,0,0,0,1,u)},w.FromQuaternionToRef=function(w,v){var I=w._x*w._x,P=w._y*w._y,u=w._z*w._z,Q=w._x*w._y,K=w._z*w._w,a=w._z*w._x,U=w._y*w._w,p=w._y*w._z,r=w._x*w._w;v._m[0]=1-2*(P+u),v._m[1]=2*(Q+K),v._m[2]=2*(a-U),v._m[3]=0,v._m[4]=2*(Q-K),v._m[5]=1-2*(u+I),v._m[6]=2*(p+r),v._m[7]=0,v._m[8]=2*(a+U),v._m[9]=2*(p-r),v._m[10]=1-2*(P+I),v._m[11]=0,v._m[12]=0,v._m[13]=0,v._m[14]=0,v._m[15]=1,v.markAsUpdated()},w._UpdateFlagSeed=0,w._IdentityReadOnly=w.Identity(),w}(),R=function(){function w(){}return w.Vector3=Q.c.BuildTuple(11,Y.Zero),w.Matrix=Q.c.BuildTuple(2,l.Identity),w.Quaternion=Q.c.BuildTuple(3,J.Zero),w}(),x=function(){function w(){}return w.Vector2=Q.c.BuildTuple(3,r.Zero),w.Vector3=Q.c.BuildTuple(13,Y.Zero),w.Vector4=Q.c.BuildTuple(3,g.Zero),w.Quaternion=Q.c.BuildTuple(2,J.Zero),w.Matrix=Q.c.BuildTuple(8,l.Identity),w}();(0,K.g)("BABYLON.Vector2",r),(0,K.g)("BABYLON.Vector3",Y),(0,K.g)("BABYLON.Vector4",g),(0,K.g)("BABYLON.Matrix",l);var j=l.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},52270:function(w,v,I){"use strict";I.d(v,{c:function(){return u}});var P=I(80105),u=(function(){function w(w,v){void 0===w&&(w=P.l.Zero()),void 0===v&&(v=P.l.Up()),this.position=w,this.normal=v}w.prototype.clone=function(){return new w(this.position.clone(),this.normal.clone())}}(),function(){function w(w,v,I){void 0===w&&(w=P.l.Zero()),void 0===v&&(v=P.l.Up()),void 0===I&&(I=P.k.Zero()),this.position=w,this.normal=v,this.uv=I}return w.prototype.clone=function(){return new w(this.position.clone(),this.normal.clone(),this.uv.clone())},w}())},57278:function(w,v,I){"use strict";I.d(v,{d:function(){return P}});var P=function(){function w(w,v,I,P){this.x=w,this.y=v,this.width=I,this.height=P}return w.prototype.toGlobal=function(v,I){return new w(this.x*v,this.y*I,this.width*v,this.height*I)},w.prototype.toGlobalToRef=function(w,v,I){return I.x=this.x*w,I.y=this.y*v,I.width=this.width*w,I.height=this.height*v,this},w.prototype.clone=function(){return new w(this.x,this.y,this.width,this.height)},w}()},37094:function(w,v,I){"use strict";I.d(v,{e:function(){return p},i:function(){return r}});var P=I(80105),u=I(39578),Q=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],K=[function(){return 1},function(w){return w.y},function(w){return w.z},function(w){return w.x},function(w){return w.x*w.y},function(w){return w.y*w.z},function(w){return 3*w.z*w.z-1},function(w){return w.x*w.z},function(w){return w.x*w.x-w.y*w.y}],a=function(w,v){return Q[w]*K[w](v)},U=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],p=function(){function w(){this.preScaled=!1,this.l00=P.l.Zero(),this.l1_1=P.l.Zero(),this.l10=P.l.Zero(),this.l11=P.l.Zero(),this.l2_2=P.l.Zero(),this.l2_1=P.l.Zero(),this.l20=P.l.Zero(),this.l21=P.l.Zero(),this.l22=P.l.Zero()}return w.prototype.addLight=function(w,v,I){u.k.Vector3[0].set(v.r,v.g,v.b);var P=u.k.Vector3[0],Q=u.k.Vector3[1];P.scaleToRef(I,Q),Q.scaleToRef(a(0,w),u.k.Vector3[2]),this.l00.addInPlace(u.k.Vector3[2]),Q.scaleToRef(a(1,w),u.k.Vector3[2]),this.l1_1.addInPlace(u.k.Vector3[2]),Q.scaleToRef(a(2,w),u.k.Vector3[2]),this.l10.addInPlace(u.k.Vector3[2]),Q.scaleToRef(a(3,w),u.k.Vector3[2]),this.l11.addInPlace(u.k.Vector3[2]),Q.scaleToRef(a(4,w),u.k.Vector3[2]),this.l2_2.addInPlace(u.k.Vector3[2]),Q.scaleToRef(a(5,w),u.k.Vector3[2]),this.l2_1.addInPlace(u.k.Vector3[2]),Q.scaleToRef(a(6,w),u.k.Vector3[2]),this.l20.addInPlace(u.k.Vector3[2]),Q.scaleToRef(a(7,w),u.k.Vector3[2]),this.l21.addInPlace(u.k.Vector3[2]),Q.scaleToRef(a(8,w),u.k.Vector3[2]),this.l22.addInPlace(u.k.Vector3[2])},w.prototype.scaleInPlace=function(w){this.l00.scaleInPlace(w),this.l1_1.scaleInPlace(w),this.l10.scaleInPlace(w),this.l11.scaleInPlace(w),this.l2_2.scaleInPlace(w),this.l2_1.scaleInPlace(w),this.l20.scaleInPlace(w),this.l21.scaleInPlace(w),this.l22.scaleInPlace(w)},w.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(U[0]),this.l1_1.scaleInPlace(U[1]),this.l10.scaleInPlace(U[2]),this.l11.scaleInPlace(U[3]),this.l2_2.scaleInPlace(U[4]),this.l2_1.scaleInPlace(U[5]),this.l20.scaleInPlace(U[6]),this.l21.scaleInPlace(U[7]),this.l22.scaleInPlace(U[8])},w.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},w.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(Q[0]),this.l1_1.scaleInPlace(Q[1]),this.l10.scaleInPlace(Q[2]),this.l11.scaleInPlace(Q[3]),this.l2_2.scaleInPlace(Q[4]),this.l2_1.scaleInPlace(Q[5]),this.l20.scaleInPlace(Q[6]),this.l21.scaleInPlace(Q[7]),this.l22.scaleInPlace(Q[8])},w.prototype.updateFromArray=function(w){return P.l.FromArrayToRef(w[0],0,this.l00),P.l.FromArrayToRef(w[1],0,this.l1_1),P.l.FromArrayToRef(w[2],0,this.l10),P.l.FromArrayToRef(w[3],0,this.l11),P.l.FromArrayToRef(w[4],0,this.l2_2),P.l.FromArrayToRef(w[5],0,this.l2_1),P.l.FromArrayToRef(w[6],0,this.l20),P.l.FromArrayToRef(w[7],0,this.l21),P.l.FromArrayToRef(w[8],0,this.l22),this},w.prototype.updateFromFloatsArray=function(w){return P.l.FromFloatsToRef(w[0],w[1],w[2],this.l00),P.l.FromFloatsToRef(w[3],w[4],w[5],this.l1_1),P.l.FromFloatsToRef(w[6],w[7],w[8],this.l10),P.l.FromFloatsToRef(w[9],w[10],w[11],this.l11),P.l.FromFloatsToRef(w[12],w[13],w[14],this.l2_2),P.l.FromFloatsToRef(w[15],w[16],w[17],this.l2_1),P.l.FromFloatsToRef(w[18],w[19],w[20],this.l20),P.l.FromFloatsToRef(w[21],w[22],w[23],this.l21),P.l.FromFloatsToRef(w[24],w[25],w[26],this.l22),this},w.FromArray=function(v){return(new w).updateFromArray(v)},w.FromPolynomial=function(v){var I=new w;return I.l00=v.xx.scale(.376127).add(v.yy.scale(.376127)).add(v.zz.scale(.376126)),I.l1_1=v.y.scale(.977204),I.l10=v.z.scale(.977204),I.l11=v.x.scale(.977204),I.l2_2=v.xy.scale(1.16538),I.l2_1=v.yz.scale(1.16538),I.l20=v.zz.scale(1.34567).subtract(v.xx.scale(.672834)).subtract(v.yy.scale(.672834)),I.l21=v.zx.scale(1.16538),I.l22=v.xx.scale(1.16538).subtract(v.yy.scale(1.16538)),I.l1_1.scaleInPlace(-1),I.l11.scaleInPlace(-1),I.l2_1.scaleInPlace(-1),I.l21.scaleInPlace(-1),I.scaleInPlace(Math.PI),I},w}(),r=function(){function w(){this.x=P.l.Zero(),this.y=P.l.Zero(),this.z=P.l.Zero(),this.xx=P.l.Zero(),this.yy=P.l.Zero(),this.zz=P.l.Zero(),this.xy=P.l.Zero(),this.yz=P.l.Zero(),this.zx=P.l.Zero()}return Object.defineProperty(w.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=p.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),w.prototype.addAmbient=function(w){u.k.Vector3[0].copyFromFloats(w.r,w.g,w.b);var v=u.k.Vector3[0];this.xx.addInPlace(v),this.yy.addInPlace(v),this.zz.addInPlace(v)},w.prototype.scaleInPlace=function(w){this.x.scaleInPlace(w),this.y.scaleInPlace(w),this.z.scaleInPlace(w),this.xx.scaleInPlace(w),this.yy.scaleInPlace(w),this.zz.scaleInPlace(w),this.yz.scaleInPlace(w),this.zx.scaleInPlace(w),this.xy.scaleInPlace(w)},w.prototype.updateFromHarmonics=function(w){return this._harmonics=w,this.x.copyFrom(w.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(w.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(w.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(w.l00),u.k.Vector3[0].copyFrom(w.l20).scaleInPlace(.247708),u.k.Vector3[1].copyFrom(w.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(u.k.Vector3[0]).addInPlace(u.k.Vector3[1]),this.yy.copyFrom(w.l00),this.yy.scaleInPlace(.886277).subtractInPlace(u.k.Vector3[0]).subtractInPlace(u.k.Vector3[1]),this.zz.copyFrom(w.l00),u.k.Vector3[0].copyFrom(w.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(u.k.Vector3[0]),this.yz.copyFrom(w.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(w.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(w.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this},w.FromHarmonics=function(v){return(new w).updateFromHarmonics(v)},w.FromArray=function(v){var I=new w;return P.l.FromArrayToRef(v[0],0,I.x),P.l.FromArrayToRef(v[1],0,I.y),P.l.FromArrayToRef(v[2],0,I.z),P.l.FromArrayToRef(v[3],0,I.xx),P.l.FromArrayToRef(v[4],0,I.yy),P.l.FromArrayToRef(v[5],0,I.zz),P.l.FromArrayToRef(v[6],0,I.yz),P.l.FromArrayToRef(v[7],0,I.zx),P.l.FromArrayToRef(v[8],0,I.xy),I},w}()},64400:function(w,v,I){"use strict";I.r(v),I.d(v,{BoxBuilder:function(){return r},CreateBox:function(){return p},CreateBoxVertexData:function(){return U}});var P=I(80105),u=I(9488),Q=I(65847),K=I(85779),a=I(20334);function U(w){var v,I=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],Q=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],U=[],p=w.width||w.size||1,r=w.height||w.size||1,Y=w.depth||w.size||1,g=w.wrap||!1,J=void 0===w.topBaseAt?1:w.topBaseAt,l=void 0===w.bottomBaseAt?0:w.bottomBaseAt,R=[2,0,3,1][J=(J+4)%4],x=[2,0,1,3][l=(l+4)%4],j=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(g){I=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],j=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var s=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],B=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],t=[17,18,19,16],i=[22,23,20,21];R>0;)s.unshift(s.pop()),t.unshift(t.pop()),R--;for(;x>0;)B.unshift(B.pop()),i.unshift(i.pop()),x--;s=s.flat(),B=B.flat(),j=j.concat(s).concat(B),I.push(t[0],t[2],t[3],t[0],t[1],t[2]),I.push(i[0],i[2],i[3],i[0],i[1],i[2])}var z=[p/2,r/2,Y/2];v=j.reduce((function(w,v,I){return w.concat(v*z[I%3])}),[]);for(var E=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE,o=w.faceUV||new Array(6),h=w.faceColors,n=[],W=0;W<6;W++)void 0===o[W]&&(o[W]=new P.p(0,0,1,1)),h&&void 0===h[W]&&(h[W]=new u.f(1,1,1,1));for(var V=0;V<6;V++)if(U.push(o[V].z,a.e.UseOpenGLOrientationForUV?1-o[V].w:o[V].w),U.push(o[V].x,a.e.UseOpenGLOrientationForUV?1-o[V].w:o[V].w),U.push(o[V].x,a.e.UseOpenGLOrientationForUV?1-o[V].y:o[V].y),U.push(o[V].z,a.e.UseOpenGLOrientationForUV?1-o[V].y:o[V].y),h)for(var F=0;F<4;F++)n.push(h[V].r,h[V].g,h[V].b,h[V].a);K.b._ComputeSides(E,v,I,Q,U,w.frontUVs,w.backUVs);var O=new K.b;if(O.indices=I,O.positions=v,O.normals=Q,O.uvs=U,h){var N=E===K.b.DOUBLESIDE?n.concat(n):n;O.colors=N}return O}function p(w,v,I){void 0===v&&(v={}),void 0===I&&(I=null);var P=new Q.b(w,I);return v.sideOrientation=Q.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,U(v).applyToMesh(P,v.updatable),P}var r={CreateBox:p};K.b.CreateBox=U,Q.b.CreateBox=function(w,v,I,P,u){return void 0===I&&(I=null),p(w,{size:v,sideOrientation:u,updatable:P},I)}},60612:function(w,v,I){"use strict";I.d(v,{e:function(){return a}});var P=I(65847),u=I(85779),Q=I(20334);function K(w){var v=new Array,I=new Array,P=new Array,K=new Array,a=w.radius||.5,U=w.tessellation||64,p=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,r=0===w.sideOrientation?0:w.sideOrientation||u.b.DEFAULTSIDE;v.push(0,0,0),K.push(.5,.5);for(var Y=2*Math.PI*p,g=1===p?Y/U:Y/(U-1),J=0,l=0;l<U;l++){var R=Math.cos(J),x=Math.sin(J),j=(R+1)/2,s=(1-x)/2;v.push(a*R,a*x,0),K.push(j,Q.e.UseOpenGLOrientationForUV?1-s:s),J+=g}1===p&&(v.push(v[3],v[4],v[5]),K.push(K[2],Q.e.UseOpenGLOrientationForUV?1-K[3]:K[3]));for(var B=v.length/3,t=1;t<B-1;t++)I.push(t+1,0,t);u.b.ComputeNormals(v,I,P),u.b._ComputeSides(r,v,I,P,K,w.frontUVs,w.backUVs);var i=new u.b;return i.indices=I,i.positions=v,i.normals=P,i.uvs=K,i}function a(w,v,I){void 0===v&&(v={}),void 0===I&&(I=null);var u=new P.b(w,I);return v.sideOrientation=P.b._GetDefaultSideOrientation(v.sideOrientation),u._originalBuilderSideOrientation=v.sideOrientation,K(v).applyToMesh(u,v.updatable),u}u.b.CreateDisc=K,P.b.CreateDisc=function(w,v,I,P,u,Q){return void 0===P&&(P=null),a(w,{radius:v,tessellation:I,sideOrientation:Q,updatable:u},P)}},55706:function(w,v,I){"use strict";I.d(v,{e:function(){return N},f:function(){return F},j:function(){return O}});var P=I(80105),u=I(65847),Q=I(85779),K=I(78502),a=I(9488),U=I(43251),p=I(35941),r=I(46907),Y=I(9892),g=I(70937),J=I(33048),l=I(31709),R=I(54497),x=I(67935),j=I(29553),s=I(78588),B={effect:null,subMesh:null},t=function(w){function v(v,I,u,Q,a){void 0===Q&&(Q={}),void 0===a&&(a=!0);var U=w.call(this,v,I,a)||this;return U._textures={},U._textureArrays={},U._externalTextures={},U._floats={},U._ints={},U._floatsArrays={},U._colors3={},U._colors3Arrays={},U._colors4={},U._colors4Arrays={},U._vectors2={},U._vectors3={},U._vectors4={},U._quaternions={},U._quaternionsArrays={},U._matrices={},U._matrixArrays={},U._matrices3x3={},U._matrices2x2={},U._vectors2Arrays={},U._vectors3Arrays={},U._vectors4Arrays={},U._uniformBuffers={},U._textureSamplers={},U._storageBuffers={},U._cachedWorldViewMatrix=new P.e,U._cachedWorldViewProjectionMatrix=new P.e,U._multiview=!1,U._shaderPath=u,U._options=(0,K.d)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1},Q),U}return(0,K.m)(v,w),Object.defineProperty(v.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(w){this._shaderPath=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"ShaderMaterial"},v.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},v.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},v.prototype._checkUniform=function(w){-1===this._options.uniforms.indexOf(w)&&this._options.uniforms.push(w)},v.prototype.setTexture=function(w,v){return-1===this._options.samplers.indexOf(w)&&this._options.samplers.push(w),this._textures[w]=v,this},v.prototype.setTextureArray=function(w,v){return-1===this._options.samplers.indexOf(w)&&this._options.samplers.push(w),this._checkUniform(w),this._textureArrays[w]=v,this},v.prototype.setExternalTexture=function(w,v){return-1===this._options.externalTextures.indexOf(w)&&this._options.externalTextures.push(w),this._externalTextures[w]=v,this},v.prototype.setFloat=function(w,v){return this._checkUniform(w),this._floats[w]=v,this},v.prototype.setInt=function(w,v){return this._checkUniform(w),this._ints[w]=v,this},v.prototype.setFloats=function(w,v){return this._checkUniform(w),this._floatsArrays[w]=v,this},v.prototype.setColor3=function(w,v){return this._checkUniform(w),this._colors3[w]=v,this},v.prototype.setColor3Array=function(w,v){return this._checkUniform(w),this._colors3Arrays[w]=v.reduce((function(w,v){return v.toArray(w,w.length),w}),[]),this},v.prototype.setColor4=function(w,v){return this._checkUniform(w),this._colors4[w]=v,this},v.prototype.setColor4Array=function(w,v){return this._checkUniform(w),this._colors4Arrays[w]=v.reduce((function(w,v){return v.toArray(w,w.length),w}),[]),this},v.prototype.setVector2=function(w,v){return this._checkUniform(w),this._vectors2[w]=v,this},v.prototype.setVector3=function(w,v){return this._checkUniform(w),this._vectors3[w]=v,this},v.prototype.setVector4=function(w,v){return this._checkUniform(w),this._vectors4[w]=v,this},v.prototype.setQuaternion=function(w,v){return this._checkUniform(w),this._quaternions[w]=v,this},v.prototype.setQuaternionArray=function(w,v){return this._checkUniform(w),this._quaternionsArrays[w]=v.reduce((function(w,v){return v.toArray(w,w.length),w}),[]),this},v.prototype.setMatrix=function(w,v){return this._checkUniform(w),this._matrices[w]=v,this},v.prototype.setMatrices=function(w,v){this._checkUniform(w);for(var I=new Float32Array(16*v.length),P=0;P<v.length;P++){v[P].copyToArray(I,16*P)}return this._matrixArrays[w]=I,this},v.prototype.setMatrix3x3=function(w,v){return this._checkUniform(w),this._matrices3x3[w]=v,this},v.prototype.setMatrix2x2=function(w,v){return this._checkUniform(w),this._matrices2x2[w]=v,this},v.prototype.setArray2=function(w,v){return this._checkUniform(w),this._vectors2Arrays[w]=v,this},v.prototype.setArray3=function(w,v){return this._checkUniform(w),this._vectors3Arrays[w]=v,this},v.prototype.setArray4=function(w,v){return this._checkUniform(w),this._vectors4Arrays[w]=v,this},v.prototype.setUniformBuffer=function(w,v){return-1===this._options.uniformBuffers.indexOf(w)&&this._options.uniformBuffers.push(w),this._uniformBuffers[w]=v,this},v.prototype.setTextureSampler=function(w,v){return-1===this._options.samplerObjects.indexOf(w)&&this._options.samplerObjects.push(w),this._textureSamplers[w]=v,this},v.prototype.setStorageBuffer=function(w,v){return-1===this._options.storageBuffers.indexOf(w)&&this._options.storageBuffers.push(w),this._storageBuffers[w]=v,this},v.prototype.isReadyForSubMesh=function(w,v,I){return this.isReady(w,I,v)},v.prototype.isReady=function(w,v,I){var P,u,Q,K,a=I&&this._storeEffectOnSubMeshes;if(this.isFrozen)if(a){if(I.effect&&I.effect._wasPreviouslyReady)return!0}else{var p=this._drawWrapper.effect;if(p&&p._wasPreviouslyReady&&p._wasPreviouslyUsingInstances===v)return!0}var r=this.getScene(),Y=r.getEngine(),g=[],l=[],x=new R.b,j=this._shaderPath,s=this._options.uniforms,t=this._options.uniformBuffers,i=this._options.samplers;Y.getCaps().multiview&&r.activeCamera&&r.activeCamera.outputRenderTarget&&r.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,g.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.indexOf("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var z=0;z<this._options.defines.length;z++){var E=0===this._options.defines[z].indexOf("#define")?this._options.defines[z]:"#define ".concat(this._options.defines[z]);g.push(E)}for(z=0;z<this._options.attributes.length;z++)l.push(this._options.attributes[z]);if(w&&w.isVerticesDataPresent(U.f.ColorKind)&&(l.push(U.f.ColorKind),g.push("#define VERTEXCOLOR")),v&&(g.push("#define INSTANCES"),J.e.PushAttributesForInstances(l),(null===w||void 0===w?void 0:w.hasThinInstances)&&(g.push("#define THIN_INSTANCES"),w&&w.isVerticesDataPresent(U.f.ColorInstanceKind)&&(l.push(U.f.ColorInstanceKind),g.push("#define INSTANCESCOLOR")))),w&&w.useBones&&w.computeBonesUsingShaders&&w.skeleton){l.push(U.f.MatricesIndicesKind),l.push(U.f.MatricesWeightsKind),w.numBoneInfluencers>4&&(l.push(U.f.MatricesIndicesExtraKind),l.push(U.f.MatricesWeightsExtraKind));var o=w.skeleton;g.push("#define NUM_BONE_INFLUENCERS "+w.numBoneInfluencers),x.addCPUSkinningFallback(0,w),o.isUsingTextureForMatrices?(g.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(g.push("#define BonesPerMesh "+(o.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else g.push("#define NUM_BONE_INFLUENCERS 0");var h=0,n=w?w.morphTargetManager:null;if(n){var W=n.supportsUVs&&-1!==g.indexOf("#define UV1"),V=n.supportsTangents&&-1!==g.indexOf("#define TANGENT"),F=n.supportsNormals&&-1!==g.indexOf("#define NORMAL");h=n.numInfluencers,W&&g.push("#define MORPHTARGETS_UV"),V&&g.push("#define MORPHTARGETS_TANGENT"),F&&g.push("#define MORPHTARGETS_NORMAL"),h>0&&g.push("#define MORPHTARGETS"),n.isUsingTextureForTargets&&(g.push("#define MORPHTARGETS_TEXTURE"),-1===this._options.uniforms.indexOf("morphTargetTextureIndices")&&this._options.uniforms.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),g.push("#define NUM_MORPH_INFLUENCERS "+h);for(z=0;z<h;z++)l.push(U.f.PositionKind+z),F&&l.push(U.f.NormalKind+z),V&&l.push(U.f.TangentKind+z),W&&l.push(U.f.UVKind+"_"+z);h>0&&((s=s.slice()).push("morphTargetInfluences"),s.push("morphTargetTextureInfo"),s.push("morphTargetTextureIndices"))}else g.push("#define NUM_MORPH_INFLUENCERS 0");if(w){var O=w.bakedVertexAnimationManager;O&&O.isEnabled&&(g.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===this._options.uniforms.indexOf("bakedVertexAnimationSettings")&&this._options.uniforms.push("bakedVertexAnimationSettings"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTextureSizeInverted")&&this._options.uniforms.push("bakedVertexAnimationTextureSizeInverted"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTime")&&this._options.uniforms.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),J.e.PrepareAttributesForBakedVertexAnimation(l,w,g)}for(var N in this._textures)if(!this._textures[N].isReady())return!1;w&&this._shouldTurnAlphaTestOn(w)&&g.push("#define ALPHATEST"),(null===this._options.useClipPlane&&r.clipPlane||this._options.useClipPlane)&&(g.push("#define CLIPPLANE"),-1===s.indexOf("vClipPlane")&&s.push("vClipPlane")),(null===this._options.useClipPlane&&r.clipPlane2||this._options.useClipPlane)&&(g.push("#define CLIPPLANE2"),-1===s.indexOf("vClipPlane2")&&s.push("vClipPlane2")),(null===this._options.useClipPlane&&r.clipPlane3||this._options.useClipPlane)&&(g.push("#define CLIPPLANE3"),-1===s.indexOf("vClipPlane3")&&s.push("vClipPlane3")),(null===this._options.useClipPlane&&r.clipPlane4||this._options.useClipPlane)&&(g.push("#define CLIPPLANE4"),-1===s.indexOf("vClipPlane4")&&s.push("vClipPlane4")),(null===this._options.useClipPlane&&r.clipPlane5||this._options.useClipPlane)&&(g.push("#define CLIPPLANE5"),-1===s.indexOf("vClipPlane5")&&s.push("vClipPlane5")),(null===this._options.useClipPlane&&r.clipPlane6||this._options.useClipPlane)&&(g.push("#define CLIPPLANE6"),-1===s.indexOf("vClipPlane6")&&s.push("vClipPlane6")),this.customShaderNameResolve&&(s=s.slice(),t=t.slice(),i=i.slice(),j=this.customShaderNameResolve(j,s,t,i,g,l));var q=a?I._getDrawWrapper():this._drawWrapper,m=null!==(P=null===q||void 0===q?void 0:q.effect)&&void 0!==P?P:null,c=null!==(u=null===q||void 0===q?void 0:q.defines)&&void 0!==u?u:null,M=g.join("\n"),S=m;return c!==M&&(S=Y.createEffect(j,{attributes:l,uniformsNames:s,uniformBuffersNames:t,samplers:i,defines:M,fallbacks:x,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:h},shaderLanguage:this._options.shaderLanguage},Y),a?I.setEffect(S,M,this._materialContext):q&&q.setEffect(S,M),this._onEffectCreatedObservable&&(B.effect=S,B.subMesh=null!==(Q=null!==I&&void 0!==I?I:null===w||void 0===w?void 0:w.subMeshes[0])&&void 0!==Q?Q:null,this._onEffectCreatedObservable.notifyObservers(B))),S._wasPreviouslyUsingInstances=!!v,null!==(K=!(null===S||void 0===S?void 0:S.isReady()))&&void 0!==K&&!K&&(m!==S&&r.resetCachedMaterial(),S._wasPreviouslyReady=!0,!0)},v.prototype.bindOnlyWorldMatrix=function(w,v){var I=this.getScene(),P=null!==v&&void 0!==v?v:this.getEffect();P&&(-1!==this._options.uniforms.indexOf("world")&&P.setMatrix("world",w),-1!==this._options.uniforms.indexOf("worldView")&&(w.multiplyToRef(I.getViewMatrix(),this._cachedWorldViewMatrix),P.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(w.multiplyToRef(I.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),P.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},v.prototype.bindForSubMesh=function(w,v,I){var P;this.bind(w,v,null===(P=I._drawWrapperOverride)||void 0===P?void 0:P.effect,I)},v.prototype.bind=function(w,v,I,P){var u,Q=P&&this._storeEffectOnSubMeshes,K=null!==I&&void 0!==I?I:Q?P.effect:this.getEffect();if(K){this._activeEffect=K,this.bindOnlyWorldMatrix(w,I);var a=this._options.uniformBuffers,U=!1;if(K&&a&&a.length>0&&this.getScene().getEngine().supportsUniformBuffers)for(var p=0;p<a.length;++p){switch(a[p]){case"Mesh":v&&(v.getMeshUniformBuffer().bindToEffect(K,"Mesh"),v.transferToEffect(w));break;case"Scene":J.e.BindSceneUniformBuffer(K,this.getScene().getSceneUniformBuffer()),this.getScene().finalizeSceneUbo(),U=!0}}var r=v&&Q?this._mustRebind(this.getScene(),K,v.visibility):this.getScene().getCachedMaterial()!==this;if(K&&r){var Y;for(Y in U||-1===this._options.uniforms.indexOf("view")||K.setMatrix("view",this.getScene().getViewMatrix()),U||-1===this._options.uniforms.indexOf("projection")||K.setMatrix("projection",this.getScene().getProjectionMatrix()),U||-1===this._options.uniforms.indexOf("viewProjection")||(K.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&K.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&K.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),J.e.BindBonesParameters(v,K),J.e.BindClipPlane(K,this.getScene()),this._textures)K.setTexture(Y,this._textures[Y]);for(Y in this._textureArrays)K.setTextureArray(Y,this._textureArrays[Y]);for(Y in this._externalTextures)K.setExternalTexture(Y,this._externalTextures[Y]);for(Y in this._ints)K.setInt(Y,this._ints[Y]);for(Y in this._floats)K.setFloat(Y,this._floats[Y]);for(Y in this._floatsArrays)K.setArray(Y,this._floatsArrays[Y]);for(Y in this._colors3)K.setColor3(Y,this._colors3[Y]);for(Y in this._colors3Arrays)K.setArray3(Y,this._colors3Arrays[Y]);for(Y in this._colors4){var g=this._colors4[Y];K.setFloat4(Y,g.r,g.g,g.b,g.a)}for(Y in this._colors4Arrays)K.setArray4(Y,this._colors4Arrays[Y]);for(Y in this._vectors2)K.setVector2(Y,this._vectors2[Y]);for(Y in this._vectors3)K.setVector3(Y,this._vectors3[Y]);for(Y in this._vectors4)K.setVector4(Y,this._vectors4[Y]);for(Y in this._quaternions)K.setQuaternion(Y,this._quaternions[Y]);for(Y in this._matrices)K.setMatrix(Y,this._matrices[Y]);for(Y in this._matrixArrays)K.setMatrices(Y,this._matrixArrays[Y]);for(Y in this._matrices3x3)K.setMatrix3x3(Y,this._matrices3x3[Y]);for(Y in this._matrices2x2)K.setMatrix2x2(Y,this._matrices2x2[Y]);for(Y in this._vectors2Arrays)K.setArray2(Y,this._vectors2Arrays[Y]);for(Y in this._vectors3Arrays)K.setArray3(Y,this._vectors3Arrays[Y]);for(Y in this._vectors4Arrays)K.setArray4(Y,this._vectors4Arrays[Y]);for(Y in this._quaternionsArrays)K.setArray4(Y,this._quaternionsArrays[Y]);for(Y in this._uniformBuffers){var l=this._uniformBuffers[Y].getBuffer();l&&K.bindUniformBuffer(l,Y)}for(Y in this._textureSamplers)K.setTextureSampler(Y,this._textureSamplers[Y]);for(Y in this._storageBuffers)K.setStorageBuffer(Y,this._storageBuffers[Y])}if(K&&v&&(r||!this.isFrozen)){var R=v.morphTargetManager;R&&R.numInfluencers>0&&J.e.BindMorphTargetParameters(v,K);var x=v.bakedVertexAnimationManager;x&&x.isEnabled&&(null===(u=v.bakedVertexAnimationManager)||void 0===u||u.bind(K,!!K._wasPreviouslyUsingInstances))}this._afterBind(v,K)}},v.prototype.getActiveTextures=function(){var v=w.prototype.getActiveTextures.call(this);for(var I in this._textures)v.push(this._textures[I]);for(var P in this._textureArrays)for(var u=this._textureArrays[P],Q=0;Q<u.length;Q++)v.push(u[Q]);return v},v.prototype.hasTexture=function(v){if(w.prototype.hasTexture.call(this,v))return!0;for(var I in this._textures)if(this._textures[I]===v)return!0;for(var P in this._textureArrays)for(var u=this._textureArrays[P],Q=0;Q<u.length;Q++)if(u[Q]===v)return!0;return!1},v.prototype.clone=function(w){var I=this,P=Y.e.Clone((function(){return new v(w,I.getScene(),I._shaderPath,I._options,I._storeEffectOnSubMeshes)}),this);for(var u in P.name=w,P.id=w,"object"===typeof P._shaderPath&&(P._shaderPath=(0,K.d)({},P._shaderPath)),this._options=(0,K.d)({},this._options),Object.keys(this._options).forEach((function(w){var v=I._options[w];Array.isArray(v)&&(I._options[w]=v.slice(0))})),this.stencil.copyTo(P.stencil),this._textures)P.setTexture(u,this._textures[u]);for(var u in this._textureArrays)P.setTextureArray(u,this._textureArrays[u]);for(var u in this._externalTextures)P.setExternalTexture(u,this._externalTextures[u]);for(var u in this._ints)P.setInt(u,this._ints[u]);for(var u in this._floats)P.setFloat(u,this._floats[u]);for(var u in this._floatsArrays)P.setFloats(u,this._floatsArrays[u]);for(var u in this._colors3)P.setColor3(u,this._colors3[u]);for(var u in this._colors3Arrays)P._colors3Arrays[u]=this._colors3Arrays[u];for(var u in this._colors4)P.setColor4(u,this._colors4[u]);for(var u in this._colors4Arrays)P._colors4Arrays[u]=this._colors4Arrays[u];for(var u in this._vectors2)P.setVector2(u,this._vectors2[u]);for(var u in this._vectors3)P.setVector3(u,this._vectors3[u]);for(var u in this._vectors4)P.setVector4(u,this._vectors4[u]);for(var u in this._quaternions)P.setQuaternion(u,this._quaternions[u]);for(var u in this._quaternionsArrays)P._quaternionsArrays[u]=this._quaternionsArrays[u];for(var u in this._matrices)P.setMatrix(u,this._matrices[u]);for(var u in this._matrixArrays)P._matrixArrays[u]=this._matrixArrays[u].slice();for(var u in this._matrices3x3)P.setMatrix3x3(u,this._matrices3x3[u]);for(var u in this._matrices2x2)P.setMatrix2x2(u,this._matrices2x2[u]);for(var u in this._vectors2Arrays)P.setArray2(u,this._vectors2Arrays[u]);for(var u in this._vectors3Arrays)P.setArray3(u,this._vectors3Arrays[u]);for(var u in this._vectors4Arrays)P.setArray4(u,this._vectors4Arrays[u]);for(var u in this._uniformBuffers)P.setUniformBuffer(u,this._uniformBuffers[u]);for(var u in this._textureSamplers)P.setTextureSampler(u,this._textureSamplers[u]);for(var u in this._storageBuffers)P.setStorageBuffer(u,this._storageBuffers[u]);return P},v.prototype.dispose=function(v,I,P){if(I){var u;for(u in this._textures)this._textures[u].dispose();for(u in this._textureArrays)for(var Q=this._textureArrays[u],K=0;K<Q.length;K++)Q[K].dispose()}this._textures={},w.prototype.dispose.call(this,v,I,P)},v.prototype.serialize=function(){var w,v=Y.e.Serialize(this);for(w in v.customType="BABYLON.ShaderMaterial",v.uniqueId=this.uniqueId,v.options=this._options,v.shaderPath=this._shaderPath,v.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,v.stencil=this.stencil.serialize(),v.textures={},this._textures)v.textures[w]=this._textures[w].serialize();for(w in v.textureArrays={},this._textureArrays){v.textureArrays[w]=[];for(var I=this._textureArrays[w],P=0;P<I.length;P++)v.textureArrays[w].push(I[P].serialize())}for(w in v.ints={},this._ints)v.ints[w]=this._ints[w];for(w in v.floats={},this._floats)v.floats[w]=this._floats[w];for(w in v.FloatArrays={},this._floatsArrays)v.FloatArrays[w]=this._floatsArrays[w];for(w in v.colors3={},this._colors3)v.colors3[w]=this._colors3[w].asArray();for(w in v.colors3Arrays={},this._colors3Arrays)v.colors3Arrays[w]=this._colors3Arrays[w];for(w in v.colors4={},this._colors4)v.colors4[w]=this._colors4[w].asArray();for(w in v.colors4Arrays={},this._colors4Arrays)v.colors4Arrays[w]=this._colors4Arrays[w];for(w in v.vectors2={},this._vectors2)v.vectors2[w]=this._vectors2[w].asArray();for(w in v.vectors3={},this._vectors3)v.vectors3[w]=this._vectors3[w].asArray();for(w in v.vectors4={},this._vectors4)v.vectors4[w]=this._vectors4[w].asArray();for(w in v.quaternions={},this._quaternions)v.quaternions[w]=this._quaternions[w].asArray();for(w in v.matrices={},this._matrices)v.matrices[w]=this._matrices[w].asArray();for(w in v.matrixArray={},this._matrixArrays)v.matrixArray[w]=this._matrixArrays[w];for(w in v.matrices3x3={},this._matrices3x3)v.matrices3x3[w]=this._matrices3x3[w];for(w in v.matrices2x2={},this._matrices2x2)v.matrices2x2[w]=this._matrices2x2[w];for(w in v.vectors2Arrays={},this._vectors2Arrays)v.vectors2Arrays[w]=this._vectors2Arrays[w];for(w in v.vectors3Arrays={},this._vectors3Arrays)v.vectors3Arrays[w]=this._vectors3Arrays[w];for(w in v.vectors4Arrays={},this._vectors4Arrays)v.vectors4Arrays[w]=this._vectors4Arrays[w];for(w in v.quaternionsArrays={},this._quaternionsArrays)v.quaternionsArrays[w]=this._quaternionsArrays[w];return v},v.Parse=function(w,I,u){var Q,K=Y.e.Parse((function(){return new v(w.name,I,w.shaderPath,w.options,w.storeEffectOnSubMeshes)}),w,I,u);for(Q in w.stencil&&K.stencil.parse(w.stencil,I,u),w.textures)K.setTexture(Q,g.e.Parse(w.textures[Q],I,u));for(Q in w.textureArrays){for(var U=w.textureArrays[Q],p=new Array,r=0;r<U.length;r++)p.push(g.e.Parse(U[r],I,u));K.setTextureArray(Q,p)}for(Q in w.ints)K.setInt(Q,w.ints[Q]);for(Q in w.floats)K.setFloat(Q,w.floats[Q]);for(Q in w.floatsArrays)K.setFloats(Q,w.floatsArrays[Q]);for(Q in w.colors3)K.setColor3(Q,a.b.FromArray(w.colors3[Q]));for(Q in w.colors3Arrays){var J=w.colors3Arrays[Q].reduce((function(w,v,I){return I%3===0?w.push([v]):w[w.length-1].push(v),w}),[]).map((function(w){return a.b.FromArray(w)}));K.setColor3Array(Q,J)}for(Q in w.colors4)K.setColor4(Q,a.f.FromArray(w.colors4[Q]));for(Q in w.colors4Arrays){J=w.colors4Arrays[Q].reduce((function(w,v,I){return I%4===0?w.push([v]):w[w.length-1].push(v),w}),[]).map((function(w){return a.f.FromArray(w)}));K.setColor4Array(Q,J)}for(Q in w.vectors2)K.setVector2(Q,P.k.FromArray(w.vectors2[Q]));for(Q in w.vectors3)K.setVector3(Q,P.l.FromArray(w.vectors3[Q]));for(Q in w.vectors4)K.setVector4(Q,P.p.FromArray(w.vectors4[Q]));for(Q in w.quaternions)K.setQuaternion(Q,P.f.FromArray(w.quaternions[Q]));for(Q in w.matrices)K.setMatrix(Q,P.e.FromArray(w.matrices[Q]));for(Q in w.matrixArray)K._matrixArrays[Q]=new Float32Array(w.matrixArray[Q]);for(Q in w.matrices3x3)K.setMatrix3x3(Q,w.matrices3x3[Q]);for(Q in w.matrices2x2)K.setMatrix2x2(Q,w.matrices2x2[Q]);for(Q in w.vectors2Arrays)K.setArray2(Q,w.vectors2Arrays[Q]);for(Q in w.vectors3Arrays)K.setArray3(Q,w.vectors3Arrays[Q]);for(Q in w.vectors4Arrays)K.setArray4(Q,w.vectors4Arrays[Q]);for(Q in w.quaternionsArrays)K.setArray4(Q,w.quaternionsArrays[Q]);return K},v.ParseFromFileAsync=function(w,v,I,P){var u=this;return void 0===P&&(P=""),new Promise((function(Q,K){var a=new x.b;a.addEventListener("readystatechange",(function(){if(4==a.readyState)if(200==a.status){var v=JSON.parse(a.responseText),U=u.Parse(v,I||s.e.LastCreatedScene,P);w&&(U.name=w),Q(U)}else K("Unable to load the ShaderMaterial")})),a.open("GET",v),a.send()}))},v.CreateFromSnippetAsync=function(w,v,I){var P=this;return void 0===I&&(I=""),new Promise((function(u,Q){var K=new x.b;K.addEventListener("readystatechange",(function(){if(4==K.readyState)if(200==K.status){var a=JSON.parse(JSON.parse(K.responseText).jsonPayload),U=JSON.parse(a.shaderMaterial),p=P.Parse(U,v||s.e.LastCreatedScene,I);p.snippetId=w,u(p)}else Q("Unable to load the snippet "+w)})),K.open("GET",P.SnippetUrl+"/"+w.replace(/#/g,"/")),K.send()}))},v.SnippetUrl="https://snippet.babylonjs.com",v}(j.d);(0,l.g)("BABYLON.ShaderMaterial",t);var i=I(16179),z=(I(76578),I(84098),"#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}");i.c.ShadersStore.colorPixelShader=z;I(31377),I(54001),I(49329),I(16554),I(50511),I(97202),I(48623),I(61906),I(35738);var E="attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#include<vertexColorMixing>\n#define CUSTOM_VERTEX_MAIN_END\n}";i.c.ShadersStore.colorVertexShader=E;u.b._LinesMeshParser=function(w,v){return o.Parse(w,v)};var o=function(w){function v(v,I,P,u,Q,K,p,r){void 0===I&&(I=null),void 0===P&&(P=null),void 0===u&&(u=null);var Y=w.call(this,v,I,P,u,Q)||this;Y.useVertexColor=K,Y.useVertexAlpha=p,Y.color=new a.b(1,1,1),Y.alpha=1,u&&(Y.color=u.color.clone(),Y.alpha=u.alpha,Y.useVertexColor=u.useVertexColor,Y.useVertexAlpha=u.useVertexAlpha),Y.intersectionThreshold=.1;var g={attributes:[U.f.PositionKind],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null};return!1===p?g.needAlphaBlending=!1:g.defines.push("#define VERTEXALPHA"),K?(g.defines.push("#define VERTEXCOLOR"),g.attributes.push(U.f.ColorKind)):(g.uniforms.push("color"),Y._color4=new a.f),Y.material=r||new t("colorShader",Y.getScene(),"color",g,!1),Y}return(0,K.m)(v,w),v.prototype._isShaderMaterial=function(w){return"ShaderMaterial"===w.getClassName()},v.prototype.isReady=function(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage)&&w.prototype.isReady.call(this)},v.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(v.prototype,"material",{get:function(){return this._lineMaterial},set:function(w){this._lineMaterial=w,this._lineMaterial.fillMode=r.b.LineListDrawMode},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"checkCollisions",{get:function(){return!1},set:function(w){},enumerable:!1,configurable:!0}),v.prototype._bind=function(){if(!this._geometry)return this;var w=this._lineMaterial.getEffect(),v=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._userInstancedBuffersStorage?this._geometry._bind(w,v,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(w,v),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){var I=this.color,P=I.r,u=I.g,Q=I.b;this._color4.set(P,u,Q,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this},v.prototype._draw=function(w,v,I){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var P=this.getScene().getEngine();return this._unIndexed?P.drawArraysType(r.b.LineListDrawMode,w.verticesStart,w.verticesCount,I):P.drawElementsType(r.b.LineListDrawMode,w.indexStart,w.indexCount,I),this},v.prototype.dispose=function(v){this._lineMaterial.dispose(!1,!1,!0),w.prototype.dispose.call(this,v)},v.prototype.clone=function(w,I,P){return void 0===I&&(I=null),new v(w,this.getScene(),I,this,P)},v.prototype.createInstance=function(w){var v=new h(w,this);if(this.instancedBuffers)for(var I in v.instancedBuffers={},this.instancedBuffers)v.instancedBuffers[I]=this.instancedBuffers[I];return v},v.prototype.serialize=function(v){w.prototype.serialize.call(this,v),v.color=this.color.asArray(),v.alpha=this.alpha},v.Parse=function(w,I){var P=new v(w.name,I);return P.color=a.b.FromArray(w.color),P.alpha=w.alpha,P},v}(u.b),h=function(w){function v(v,I){var P=w.call(this,v,I)||this;return P.intersectionThreshold=I.intersectionThreshold,P}return(0,K.m)(v,w),v.prototype.getClassName=function(){return"InstancedLinesMesh"},v}(p.d),n=I(9127);function W(w){for(var v=[],I=[],P=w.lines,u=w.colors,K=[],a=0,U=0;U<P.length;U++)for(var p=P[U],r=0;r<p.length;r++){if(I.push(p[r].x,p[r].y,p[r].z),u){var Y=u[U];K.push(Y[r].r,Y[r].g,Y[r].b,Y[r].a)}r>0&&(v.push(a-1),v.push(a)),a++}var g=new Q.b;return g.indices=v,g.positions=I,u&&(g.colors=K),g}function V(w){var v,I,u=w.dashSize||3,K=w.gapSize||1,a=w.dashNb||200,U=w.points,p=new Array,r=new Array,Y=P.l.Zero(),g=0,J=0,l=0,R=0,x=0;for(x=0;x<U.length-1;x++)U[x+1].subtractToRef(U[x],Y),g+=Y.length();for(I=u*(v=g/a)/(u+K),x=0;x<U.length-1;x++){U[x+1].subtractToRef(U[x],Y),J=Math.floor(Y.length()/v),Y.normalize();for(var j=0;j<J;j++)l=v*j,p.push(U[x].x+l*Y.x,U[x].y+l*Y.y,U[x].z+l*Y.z),p.push(U[x].x+(l+I)*Y.x,U[x].y+(l+I)*Y.y,U[x].z+(l+I)*Y.z),r.push(R,R+1),R+=2}var s=new Q.b;return s.positions=p,s.indices=r,s}function F(w,v,I){var P=v.instance,u=v.lines,Q=v.colors;if(P){var K=P.getVerticesData(U.f.PositionKind),a=void 0,p=void 0;Q&&(a=P.getVerticesData(U.f.ColorKind));for(var r=0,Y=0,g=0;g<u.length;g++)for(var J=u[g],l=0;l<J.length;l++)K[r]=J[l].x,K[r+1]=J[l].y,K[r+2]=J[l].z,Q&&a&&(p=Q[g],a[Y]=p[l].r,a[Y+1]=p[l].g,a[Y+2]=p[l].b,a[Y+3]=p[l].a,Y+=4),r+=3;return P.updateVerticesData(U.f.PositionKind,K,!1,!1),Q&&a&&P.updateVerticesData(U.f.ColorKind,a,!1,!1),P}var R=new o(w,I,null,void 0,void 0,!!Q,v.useVertexAlpha,v.material);return W(v).applyToMesh(R,v.updatable),R}function O(w,v,I){void 0===I&&(I=null);var P=v.colors?[v.colors]:null;return F(w,{lines:[v.points],updatable:v.updatable,instance:v.instance,colors:P,useVertexAlpha:v.useVertexAlpha,material:v.material},I)}function N(w,v,I){void 0===I&&(I=null);var Q=v.points,K=v.instance,a=v.gapSize||1,U=v.dashSize||3;if(K){return(v.dashNb||v.dashSize||v.gapSize||v.useVertexAlpha||v.material)&&n.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),K.updateMeshPositions((function(w){var v,I,u=P.l.Zero(),a=w.length/6,U=0,p=0,r=0,Y=0,g=0,J=0;for(g=0;g<Q.length-1;g++)Q[g+1].subtractToRef(Q[g],u),U+=u.length();v=U/a;var l=K._creationDataStorage.dashSize;for(I=l*v/(l+K._creationDataStorage.gapSize),g=0;g<Q.length-1;g++)for(Q[g+1].subtractToRef(Q[g],u),p=Math.floor(u.length()/v),u.normalize(),J=0;J<p&&Y<w.length;)r=v*J,w[Y]=Q[g].x+r*u.x,w[Y+1]=Q[g].y+r*u.y,w[Y+2]=Q[g].z+r*u.z,w[Y+3]=Q[g].x+(r+I)*u.x,w[Y+4]=Q[g].y+(r+I)*u.y,w[Y+5]=Q[g].z+(r+I)*u.z,Y+=6,J++;for(;Y<w.length;)w[Y]=Q[g].x,w[Y+1]=Q[g].y,w[Y+2]=Q[g].z,Y+=3}),!1),K}var p=new o(w,I,null,void 0,void 0,void 0,v.useVertexAlpha,v.material);return V(v).applyToMesh(p,v.updatable),p._creationDataStorage=new u.e,p._creationDataStorage.dashSize=U,p._creationDataStorage.gapSize=a,p}Q.b.CreateLineSystem=W,Q.b.CreateDashedLines=V,u.b.CreateLines=function(w,v,I,P,u){return void 0===I&&(I=null),void 0===P&&(P=!1),void 0===u&&(u=null),O(w,{points:v,updatable:P,instance:u},I)},u.b.CreateDashedLines=function(w,v,I,P,u,Q,K,a){return void 0===Q&&(Q=null),N(w,{points:v,dashSize:I,gapSize:P,dashNb:u,updatable:K,instance:a},Q)}},49620:function(w,v,I){"use strict";I.d(v,{e:function(){return a},g:function(){return U}});var P=I(65847),u=I(85779),Q=I(20334);function K(w){var v=[],I=[],P=[],K=[],a=w.width||w.size||1,U=w.height||w.size||1,p=0===w.sideOrientation?0:w.sideOrientation||u.b.DEFAULTSIDE,r=a/2,Y=U/2;I.push(-r,-Y,0),P.push(0,0,-1),K.push(0,Q.e.UseOpenGLOrientationForUV?1:0),I.push(r,-Y,0),P.push(0,0,-1),K.push(1,Q.e.UseOpenGLOrientationForUV?1:0),I.push(r,Y,0),P.push(0,0,-1),K.push(1,Q.e.UseOpenGLOrientationForUV?0:1),I.push(-r,Y,0),P.push(0,0,-1),K.push(0,Q.e.UseOpenGLOrientationForUV?0:1),v.push(0),v.push(1),v.push(2),v.push(0),v.push(2),v.push(3),u.b._ComputeSides(p,I,v,P,K,w.frontUVs,w.backUVs);var g=new u.b;return g.indices=v,g.positions=I,g.normals=P,g.uvs=K,g}function a(w,v,I){void 0===v&&(v={}),void 0===I&&(I=null);var u=new P.b(w,I);return v.sideOrientation=P.b._GetDefaultSideOrientation(v.sideOrientation),u._originalBuilderSideOrientation=v.sideOrientation,K(v).applyToMesh(u,v.updatable),v.sourcePlane&&(u.translate(v.sourcePlane.normal,-v.sourcePlane.d),u.setDirection(v.sourcePlane.normal.scale(-1))),u}var U={CreatePlane:a};u.b.CreatePlane=K,P.b.CreatePlane=function(w,v,I,P,u){return a(w,{size:v,width:v,height:v,sideOrientation:u,updatable:P},I)}},71898:function(w,v,I){"use strict";I.d(v,{c:function(){return U}});var P=I(80105),u=I(65847),Q=I(85779),K=I(20334);function a(w){for(var v=w.segments||32,I=w.diameterX||w.diameter||1,u=w.diameterY||w.diameter||1,a=w.diameterZ||w.diameter||1,U=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,p=w.slice&&w.slice<=0?1:w.slice||1,r=0===w.sideOrientation?0:w.sideOrientation||Q.b.DEFAULTSIDE,Y=!!w.dedupTopBottomIndices,g=new P.l(I/2,u/2,a/2),J=2+v,l=2*J,R=[],x=[],j=[],s=[],B=0;B<=J;B++){for(var t=B/J,i=t*Math.PI*p,z=0;z<=l;z++){var E=z/l,o=E*Math.PI*2*U,h=P.e.RotationZ(-i),n=P.e.RotationY(o),W=P.l.TransformCoordinates(P.l.Up(),h),V=P.l.TransformCoordinates(W,n),F=V.multiply(g),O=V.divide(g).normalize();x.push(F.x,F.y,F.z),j.push(O.x,O.y,O.z),s.push(E,K.e.UseOpenGLOrientationForUV?1-t:t)}if(B>0)for(var N=x.length/3,q=N-2*(l+1);q+l+2<N;q++)Y?(B>1&&(R.push(q),R.push(q+1),R.push(q+l+1)),(B<J||p<1)&&(R.push(q+l+1),R.push(q+1),R.push(q+l+2))):(R.push(q),R.push(q+1),R.push(q+l+1),R.push(q+l+1),R.push(q+1),R.push(q+l+2))}Q.b._ComputeSides(r,x,R,j,s,w.frontUVs,w.backUVs);var m=new Q.b;return m.indices=R,m.positions=x,m.normals=j,m.uvs=s,m}function U(w,v,I){void 0===v&&(v={}),void 0===I&&(I=null);var P=new u.b(w,I);return v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,a(v).applyToMesh(P,v.updatable),P}Q.b.CreateSphere=a,u.b.CreateSphere=function(w,v,I,P,u,Q){return U(w,{segments:v,diameterX:I,diameterY:I,diameterZ:I,sideOrientation:Q,updatable:u},P)}},40689:function(w,v,I){"use strict";I.d(v,{e:function(){return r}});var P=I(9217),u=I(78502),Q=function(){function w(w){this._pendingActions=new Array,this._workerInfos=w.map((function(w){return{workerPromise:Promise.resolve(w),idle:!0}}))}return w.prototype.dispose=function(){for(var w=0,v=this._workerInfos;w<v.length;w++){v[w].workerPromise.then((function(w){w.terminate()}))}this._workerInfos.length=0,this._pendingActions.length=0},w.prototype.push=function(w){this._executeOnIdleWorker(w)||this._pendingActions.push(w)},w.prototype._executeOnIdleWorker=function(w){for(var v=0,I=this._workerInfos;v<I.length;v++){var P=I[v];if(P.idle)return this._execute(P,w),!0}return!1},w.prototype._execute=function(w,v){var I=this;w.idle=!1,w.workerPromise.then((function(P){v(P,(function(){var v=I._pendingActions.shift();v?I._execute(w,v):w.idle=!0}))}))},w}(),K=function(w){function v(I,P,u){void 0===u&&(u=v.DefaultOptions);var Q=w.call(this,[])||this;return Q._maxWorkers=I,Q._createWorkerAsync=P,Q._options=u,Q}return(0,u.m)(v,w),v.prototype.push=function(w){if(!this._executeOnIdleWorker(w))if(this._workerInfos.length<this._maxWorkers){var v={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(v),this._execute(v,w)}else this._pendingActions.push(w)},v.prototype._execute=function(v,I){var P=this;v.timeoutId&&(clearTimeout(v.timeoutId),delete v.timeoutId),w.prototype._execute.call(this,v,(function(w,u){I(w,(function(){u(),v.idle&&(v.timeoutId=setTimeout((function(){v.workerPromise.then((function(w){w.terminate()}));var w=P._workerInfos.indexOf(v);-1!==w&&P._workerInfos.splice(w,1)}),P._options.idleTimeElapsedBeforeRelease))}))}))},v.DefaultOptions={idleTimeElapsedBeforeRelease:1e3},v}(Q),a=I(85779);function U(w,v,I,P,u,Q){var K=new w.DecoderBuffer;K.Init(v,v.byteLength);var a,U,p=new w.Decoder;try{var r=p.GetEncodedGeometryType(K);switch(r){case w.TRIANGULAR_MESH:a=new w.Mesh,U=p.DecodeBufferToMesh(K,a);break;case w.POINT_CLOUD:a=new w.PointCloud,U=p.DecodeBufferToPointCloud(K,a);break;default:throw new Error("Invalid geometry type ".concat(r))}if(!U.ok()||!a.ptr)throw new Error(U.error_msg());if(r===w.TRIANGULAR_MESH){var Y=3*a.num_faces(),g=4*Y,J=w._malloc(g);try{p.GetTrianglesUInt32Array(a,g,J);var l=new Uint32Array(Y);l.set(new Uint32Array(w.HEAPF32.buffer,J,Y)),P(l)}finally{w._free(J)}}var R=function(v,I,P){void 0===P&&(P=1);var Q=I.num_components(),K=a.num_points(),U=K*Q,r=U*Float32Array.BYTES_PER_ELEMENT,Y=w._malloc(r);try{p.GetAttributeDataArrayForAllPoints(a,I,w.DT_FLOAT32,r,Y);var g=new Float32Array(w.HEAPF32.buffer,Y,U);if("color"===v&&3===Q){for(var J=new Float32Array(4*K),l=0,R=0;l<J.length;l+=4,R+=Q)J[l+0]=g[R+0],J[l+1]=g[R+1],J[l+2]=g[R+2],J[l+3]=1;u(v,J)}else{if((J=new Float32Array(U)).set(new Float32Array(w.HEAPF32.buffer,Y,U)),1!==P)for(l=0;l<J.length;l++)J[l]=J[l]/P;u(v,J)}}finally{w._free(Y)}};if(I)for(var x in I){var j=I[x];R(x,p.GetAttributeByUniqueId(a,j),Q&&Q[x]||1)}else{var s={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var x in s){if(-1!==(j=p.GetAttributeId(a,w[s[x]])))R(x,p.GetAttribute(a,j))}}}finally{a&&w.destroy(a),w.destroy(p),w.destroy(K)}}function p(){var w;onmessage=function(v){var I=v.data;switch(I.id){case"init":var P=I.decoder;P.url&&(importScripts(P.url),w=DracoDecoderModule({wasmBinary:P.wasmBinary})),postMessage("done");break;case"decodeMesh":if(!w)throw new Error("Draco decoder module is not available");w.then((function(w){U(w,I.dataView,I.attributes,(function(w){postMessage({id:"indices",value:w},[w.buffer])}),(function(w,v){postMessage({id:w,value:v},[v.buffer])})),postMessage("done")}))}}}var r=function(){function w(v){void 0===v&&(v=w.DefaultNumWorkers);var I=w.Configuration.decoder,u=I.wasmUrl&&I.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:P.i.GetAbsoluteUrl(I.wasmUrl),wasmBinaryPromise:P.i.LoadFileAsync(P.i.GetAbsoluteUrl(I.wasmBinaryUrl))}:{url:P.i.GetAbsoluteUrl(I.fallbackUrl),wasmBinaryPromise:Promise.resolve(void 0)};v&&"function"===typeof Worker?this._workerPoolPromise=u.wasmBinaryPromise.then((function(w){var I="".concat(U,"(").concat(p,")()"),P=URL.createObjectURL(new Blob([I],{type:"application/javascript"}));return new K(v,(function(){return new Promise((function(v,I){var Q=new Worker(P),K=function w(v){Q.removeEventListener("error",w),Q.removeEventListener("message",a),I(v)},a=function w(I){"done"===I.data&&(Q.removeEventListener("error",K),Q.removeEventListener("message",w),v(Q))};Q.addEventListener("error",K),Q.addEventListener("message",a),Q.postMessage({id:"init",decoder:{url:u.url,wasmBinary:w}})}))}))})):this._decoderModulePromise=u.wasmBinaryPromise.then((function(w){if(!u.url)throw new Error("Draco decoder module is not available");return P.i.LoadScriptAsync(u.url).then((function(){return v=w,new Promise((function(w){DracoDecoderModule({wasmBinary:v}).then((function(v){w({module:v})}))}));var v}))}))}return Object.defineProperty(w,"DecoderAvailable",{get:function(){var v=w.Configuration.decoder;return!!(v.wasmUrl&&v.wasmBinaryUrl&&"object"===typeof WebAssembly||v.fallbackUrl)},enumerable:!1,configurable:!0}),w.GetDefaultNumWorkers=function(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(w,"Default",{get:function(){return w._Default||(w._Default=new w),w._Default},enumerable:!1,configurable:!0}),w.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then((function(w){w.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise},w.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then((function(){})):this._decoderModulePromise?this._decoderModulePromise.then((function(){})):Promise.resolve()},w.prototype.decodeMeshAsync=function(w,v,I){var P=w instanceof ArrayBuffer?new Uint8Array(w):w;if(this._workerPoolPromise)return this._workerPoolPromise.then((function(w){return new Promise((function(u,Q){w.push((function(w,K){var U=new a.b,p=function v(I){w.removeEventListener("error",v),w.removeEventListener("message",r),Q(I),K()},r=function v(P){if("done"===P.data)w.removeEventListener("error",p),w.removeEventListener("message",v),u(U),K();else if("indices"===P.data.id)U.indices=P.data.value;else{var Q=I&&I[P.data.id]?I[P.data.id]:1;if(1!==Q)for(var a=0;a<P.data.value.length;a++)P.data.value[a]=P.data.value[a]/Q;U.set(P.data.value,P.data.id)}};w.addEventListener("error",p),w.addEventListener("message",r);var Y=new Uint8Array(P.byteLength);Y.set(new Uint8Array(P.buffer,P.byteOffset,P.byteLength)),w.postMessage({id:"decodeMesh",dataView:Y,attributes:v},[Y.buffer])}))}))}));if(this._decoderModulePromise)return this._decoderModulePromise.then((function(w){var u=new a.b;return U(w.module,P,v,(function(w){u.indices=w}),(function(w,v){u.set(v,w)}),I),u}));throw new Error("Draco decoder module is not available")},w.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},w.DefaultNumWorkers=w.GetDefaultNumWorkers(),w._Default=null,w}()},12753:function(w,v,I){"use strict";I.d(v,{e:function(){return u}});var P=I(78502),u=function(w){function v(v){var I=w.call(this)||this;return I._buffer=v,I}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),v}(I(82419).c)},52644:function(w,v,I){"use strict";I.d(v,{b:function(){return z}});var P=I(78502),u=I(9271),Q=I(80105),K=I(90690),a=I(43251),U=I(85779),p=I(77129),r=I(44904),Y=I(97918),g=I(90534),J=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new Q.l(0,0,0),this._diffPositionForCollisions=new Q.l(0,0,0),this._collisionResponse=!0},l=I(50504),R=I(18445),x=I(9488),j=I(61686),s=I(54044),B=I(31709),t=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=Q.l.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},i=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new t,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._meshCollisionData=new J,this._enableDistantPicking=!1},z=function(w){function v(I,P){void 0===P&&(P=null);var a=w.call(this,I,P,!1)||this;return a._internalAbstractMeshDataInfo=new i,a._waitingMaterialId=null,a.cullingStrategy=v.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,a.onCollideObservable=new u.c,a.onCollisionPositionChangeObservable=new u.c,a.onMaterialChangedObservable=new u.c,a.definedFacingForward=!0,a._occlusionQuery=null,a._renderingGroup=null,a.alphaIndex=Number.MAX_VALUE,a.isVisible=!0,a.isPickable=!0,a.isNearPickable=!1,a.isNearGrabbable=!1,a.showSubMeshesBoundingBox=!1,a.isBlocker=!1,a.enablePointerMoveEvents=!1,a.outlineColor=x.b.Red(),a.outlineWidth=.02,a.overlayColor=x.b.Red(),a.overlayAlpha=.5,a.useOctreeForRenderingSelection=!0,a.useOctreeForPicking=!0,a.useOctreeForCollisions=!0,a.alwaysSelectAsActiveMesh=!1,a.doNotSyncBoundingInfo=!1,a.actionManager=null,a.ellipsoid=new Q.l(.5,1,.5),a.ellipsoidOffset=new Q.l(0,0,0),a.edgesWidth=1,a.edgesColor=new x.f(1,0,0,1),a._edgesRenderer=null,a._masterMesh=null,a._boundingInfo=null,a._boundingInfoIsDirty=!0,a._renderId=0,a._intersectionsInProgress=new Array,a._unIndexed=!1,a._lightSources=new Array,a._waitingData={lods:null,actions:null,freezeWorldMatrix:null},a._bonesTransformMatrices=null,a._transformMatrixTexture=null,a.onRebuildObservable=new u.c,a._onCollisionPositionChange=function(w,v,I){void 0===I&&(I=null),v.subtractToRef(a._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>K.d.CollisionsEpsilon&&a.position.addInPlace(a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),I&&a.onCollideObservable.notifyObservers(I),a.onCollisionPositionChangeObservable.notifyObservers(a.position)},a.getScene().addMesh(a),a._resyncLightSources(),a._uniformBuffer=new g.b(a.getScene().getEngine(),void 0,void 0,I,!a.getScene().getEngine().isWebGPU),a._buildUniformLayout(),a}return(0,P.m)(v,w),Object.defineProperty(v,"BILLBOARDMODE_NONE",{get:function(){return p.d.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(v,"BILLBOARDMODE_X",{get:function(){return p.d.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(v,"BILLBOARDMODE_Y",{get:function(){return p.d.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(v,"BILLBOARDMODE_Z",{get:function(){return p.d.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(v,"BILLBOARDMODE_ALL",{get:function(){return p.d.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(v,"BILLBOARDMODE_USE_POSITION",{get:function(){return p.d.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(w){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(w){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(w){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(w){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"collisionRetryCount",{get:function(){return this._internalAbstractMeshDataInfo._collisionRetryCount},set:function(w){this._internalAbstractMeshDataInfo._collisionRetryCount=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"morphTargetManager",{get:function(){return this._internalAbstractMeshDataInfo._morphTargetManager},set:function(w){this._internalAbstractMeshDataInfo._morphTargetManager!==w&&(this._internalAbstractMeshDataInfo._morphTargetManager=w,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"bakedVertexAnimationManager",{get:function(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager},set:function(w){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==w&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=w,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),v.prototype._syncGeometryWithMorphTargetManager=function(){},v.prototype._updateNonUniformScalingState=function(v){return!!w.prototype._updateNonUniformScalingState.call(this,v)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(v.prototype,"onCollide",{set:function(w){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onCollisionPositionChange",{set:function(w){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(w){if(this._internalAbstractMeshDataInfo._visibility!==w){var v=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=w,(1===v&&1!==w||1!==v&&1===w)&&this._markSubMeshesAsMiscDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"renderingGroupId",{get:function(){return this._internalAbstractMeshDataInfo._renderingGroupId},set:function(w){this._internalAbstractMeshDataInfo._renderingGroupId=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"material",{get:function(){return this._internalAbstractMeshDataInfo._material},set:function(w){this._internalAbstractMeshDataInfo._material!==w&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=w,w&&w.meshMap&&(w.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))},enumerable:!1,configurable:!0}),v.prototype.getMaterialForRenderPass=function(w){var v;return null===(v=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===v?void 0:v[w]},v.prototype.setMaterialForRenderPass=function(w,v){this.resetDrawCache(w),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[w]=v},Object.defineProperty(v.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(w){this._internalAbstractMeshDataInfo._receiveShadows!==w&&(this._internalAbstractMeshDataInfo._receiveShadows=w,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(w){this._internalAbstractMeshDataInfo._hasVertexAlpha!==w&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=w,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(w){this._internalAbstractMeshDataInfo._useVertexColors!==w&&(this._internalAbstractMeshDataInfo._useVertexColors=w,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(w){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==w&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=w,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(w){this._internalAbstractMeshDataInfo._numBoneInfluencers!==w&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=w,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(w){this._internalAbstractMeshDataInfo._applyFog!==w&&(this._internalAbstractMeshDataInfo._applyFog=w,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"enableDistantPicking",{get:function(){return this._internalAbstractMeshDataInfo._enableDistantPicking},set:function(w){this._internalAbstractMeshDataInfo._enableDistantPicking=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(w){w!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=w,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"collisionMask",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask},set:function(w){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(w)?-1:w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"collisionResponse",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse},set:function(w){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"collisionGroup",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup},set:function(w){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(w)?-1:w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"surroundingMeshes",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes},set:function(w){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(w){var v=this._internalAbstractMeshDataInfo._skeleton;v&&v.needInitialSkinMatrix&&v._unregisterMeshWithPoseMatrix(this),w&&w.needInitialSkinMatrix&&w._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=w,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),v.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()},v.prototype.transferToEffect=function(w){var v=this._uniformBuffer;v.updateMatrix("world",w),v.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),v.update()},v.prototype.getMeshUniformBuffer=function(){return this._uniformBuffer},v.prototype.getClassName=function(){return"AbstractMesh"},v.prototype.toString=function(w){var v="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");v+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var I=this._internalAbstractMeshDataInfo._skeleton;return I&&(v+=", skeleton: "+I.name),w&&(v+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],v+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),v},v.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==p.d.BILLBOARDMODE_NONE?this._masterMesh:w.prototype._getEffectiveParent.call(this)},v.prototype._getActionManagerForTrigger=function(w,v){if(void 0===v&&(v=!0),this.actionManager&&(v||this.actionManager.isRecursive)){if(!w)return this.actionManager;if(this.actionManager.hasSpecificTrigger(w))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(w,!1):null},v.prototype._rebuild=function(w){if(void 0===w&&(w=!1),this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var v=0,I=this.subMeshes;v<I.length;v++){I[v]._rebuild()}},v.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var w=0,v=this.getScene().lights;w<v.length;w++){var I=v[w];I.isEnabled()&&(I.canAffectMesh(this)&&this._lightSources.push(I))}this._markSubMeshesAsLightDirty()},v.prototype._resyncLightSource=function(w){var v=w.isEnabled()&&w.canAffectMesh(this),I=this._lightSources.indexOf(w),P=!1;if(-1===I){if(!v)return;this._lightSources.push(w)}else{if(v)return;P=!0,this._lightSources.splice(I,1)}this._markSubMeshesAsLightDirty(P)},v.prototype._unBindEffect=function(){for(var w=0,v=this.subMeshes;w<v.length;w++){v[w].setEffect(null)}},v.prototype._removeLightSource=function(w,v){var I=this._lightSources.indexOf(w);-1!==I&&(this._lightSources.splice(I,1),this._markSubMeshesAsLightDirty(v))},v.prototype._markSubMeshesAsDirty=function(w){if(this.subMeshes)for(var v=0,I=this.subMeshes;v<I.length;v++)for(var P=I[v],u=0;u<P._drawWrappers.length;++u){var Q=P._drawWrappers[u];Q&&Q.defines&&Q.defines.markAllAsDirty&&w(Q.defines)}},v.prototype._markSubMeshesAsLightDirty=function(w){void 0===w&&(w=!1),this._markSubMeshesAsDirty((function(v){return v.markAsLightDirty(w)}))},v.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty((function(w){return w.markAsAttributesDirty()}))},v.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty((function(w){return w.markAsMiscDirty()}))},v.prototype.markAsDirty=function(w){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},v.prototype.resetDrawCache=function(w){if(this.subMeshes)for(var v=0,I=this.subMeshes;v<I.length;v++){I[v].resetDrawCache(w)}},Object.defineProperty(v.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),v.prototype.getLOD=function(w){return this},v.prototype.getTotalVertices=function(){return 0},v.prototype.getTotalIndices=function(){return 0},v.prototype.getIndices=function(){return null},v.prototype.getVerticesData=function(w){return null},v.prototype.setVerticesData=function(w,v,I,P){return this},v.prototype.updateVerticesData=function(w,v,I,P){return this},v.prototype.setIndices=function(w,v){return this},v.prototype.isVerticesDataPresent=function(w){return!1},v.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)},v.prototype.setBoundingInfo=function(w){return this._boundingInfo=w,this},Object.defineProperty(v.prototype,"hasBoundingInfo",{get:function(){return null!==this._boundingInfo},enumerable:!1,configurable:!0}),v.prototype.buildBoundingInfo=function(w,v,I){return this._boundingInfo=new Y.e(w,v,I),this._boundingInfo},v.prototype.normalizeToUnitCube=function(v,I,P){return void 0===v&&(v=!0),void 0===I&&(I=!1),w.prototype.normalizeToUnitCube.call(this,v,I,P)},Object.defineProperty(v.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(a.f.MatricesIndicesKind)&&this.isVerticesDataPresent(a.f.MatricesWeightsKind)},enumerable:!1,configurable:!0}),v.prototype._preActivate=function(){},v.prototype._preActivateForIntermediateRendering=function(w){},v.prototype._activate=function(w,v){return this._renderId=w,!0},v.prototype._postActivate=function(){},v.prototype._freeze=function(){},v.prototype._unFreeze=function(){},v.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===p.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():w.prototype.getWorldMatrix.call(this)},v.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():w.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(v.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),v.prototype.movePOV=function(w,v,I){return this.position.addInPlace(this.calcMovePOV(w,v,I)),this},v.prototype.calcMovePOV=function(w,v,I){var P=new Q.e;(this.rotationQuaternion?this.rotationQuaternion:Q.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(P);var u=Q.l.Zero(),K=this.definedFacingForward?-1:1;return Q.l.TransformCoordinatesFromFloatsToRef(w*K,v,I*K,P,u),u},v.prototype.rotatePOV=function(w,v,I){return this.rotation.addInPlace(this.calcRotatePOV(w,v,I)),this},v.prototype.calcRotatePOV=function(w,v,I){var P=this.definedFacingForward?1:-1;return new Q.l(w*P,v,I*P)},v.prototype.refreshBoundingInfo=function(w,v){return void 0===w&&(w=!1),void 0===v&&(v=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(w,v),null),this},v.prototype._refreshBoundingInfo=function(w,v){if(w){var I=(0,R.f)(w,0,this.getTotalVertices(),v);this._boundingInfo?this._boundingInfo.reConstruct(I.minimum,I.maximum):this._boundingInfo=new Y.e(I.minimum,I.maximum)}if(this.subMeshes)for(var P=0;P<this.subMeshes.length;P++)this.subMeshes[P].refreshBoundingInfo(w);this._updateBoundingInfo()},v.prototype._getData=function(w,v,I,P){if(void 0===w&&(w=!1),void 0===v&&(v=!1),void 0===P&&(P=a.f.PositionKind),(I=null!==I&&void 0!==I?I:this.getVerticesData(P).slice())&&v&&this.morphTargetManager)for(var u=0,K=0,U=0;U<I.length;U++){for(var p=0;p<this.morphTargetManager.numTargets;p++){var r=this.morphTargetManager.getTarget(p),Y=r.influence;if(Y>0){var g=r.getPositions();g&&(I[U]+=(g[U]-I[U])*Y)}}if(u++,P===a.f.PositionKind&&this._positions&&3===u){u=0;var J=3*K;this._positions[K++].copyFromFloats(I[J],I[J+1],I[J+2])}}if(I&&w&&this.skeleton){var l=this.getVerticesData(a.f.MatricesIndicesKind),R=this.getVerticesData(a.f.MatricesWeightsKind);if(R&&l){var x=this.numBoneInfluencers>4,j=x?this.getVerticesData(a.f.MatricesIndicesExtraKind):null,s=x?this.getVerticesData(a.f.MatricesWeightsExtraKind):null,B=this.skeleton.getTransformMatrices(this),t=Q.i.Vector3[0],i=Q.i.Matrix[0],z=Q.i.Matrix[1],E=0;for(J=0;J<I.length;J+=3,E+=4){i.reset();var o=void 0,h=void 0;for(o=0;o<4;o++)(h=R[E+o])>0&&(Q.e.FromFloat32ArrayToRefScaled(B,Math.floor(16*l[E+o]),h,z),i.addToSelf(z));if(x)for(o=0;o<4;o++)(h=s[E+o])>0&&(Q.e.FromFloat32ArrayToRefScaled(B,Math.floor(16*j[E+o]),h,z),i.addToSelf(z));P===a.f.NormalKind?Q.l.TransformNormalFromFloatsToRef(I[J],I[J+1],I[J+2],i,t):Q.l.TransformCoordinatesFromFloatsToRef(I[J],I[J+1],I[J+2],i,t),t.toArray(I,J),P===a.f.PositionKind&&this._positions&&this._positions[J/3].copyFrom(t)}}}return I},v.prototype.getNormalsData=function(w,v){return void 0===w&&(w=!1),void 0===v&&(v=!1),this._getData(w,v,null,a.f.NormalKind)},v.prototype.getPositionData=function(w,v,I){return void 0===w&&(w=!1),void 0===v&&(v=!1),this._getData(w,v,I,a.f.PositionKind)},v.prototype._getPositionData=function(w,v){var I,P=this.getVerticesData(a.f.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),P&&(w&&this.skeleton||v&&this.morphTargetManager)){if(P=P.slice(),this._generatePointsArray(),this._positions){var u=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(u.length);for(var K=0;K<u.length;K++)this._internalAbstractMeshDataInfo._positions[K]=(null===(I=u[K])||void 0===I?void 0:I.clone())||new Q.l}return this.getPositionData(w,v,P)}return P},v.prototype._updateBoundingInfo=function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new Y.e(Q.l.Zero(),Q.l.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},v.prototype._updateSubMeshesBoundingInfo=function(w){if(!this.subMeshes)return this;for(var v=this.subMeshes.length,I=0;I<v;I++){var P=this.subMeshes[I];(v>1||!P.IsGlobal)&&P.updateBoundingInfo(w)}return this},v.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)},v.prototype.isInFrustum=function(w){return this.getBoundingInfo().isInFrustum(w,this.cullingStrategy)},v.prototype.isCompletelyInFrustum=function(w){return this.getBoundingInfo().isCompletelyInFrustum(w)},v.prototype.intersectsMesh=function(w,v,I){void 0===v&&(v=!1);var P=this.getBoundingInfo(),u=w.getBoundingInfo();if(P.intersects(u,v))return!0;if(I)for(var Q=0,K=this.getChildMeshes();Q<K.length;Q++){if(K[Q].intersectsMesh(w,v,!0))return!0}return!1},v.prototype.intersectsPoint=function(w){return this.getBoundingInfo().intersectsPoint(w)},Object.defineProperty(v.prototype,"checkCollisions",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions},set:function(w){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"collider",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider},enumerable:!1,configurable:!0}),v.prototype.moveWithCollisions=function(w){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);var v=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=v.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,v.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,w,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this},v.prototype._collideForSubMesh=function(w,v,I){var P;if(this._generatePointsArray(),!this._positions)return this;if(!w._lastColliderWorldVertices||!w._lastColliderTransformMatrix.equals(v)){w._lastColliderTransformMatrix=v.clone(),w._lastColliderWorldVertices=[],w._trianglePlanes=[];for(var u=w.verticesStart,K=w.verticesStart+w.verticesCount,a=u;a<K;a++)w._lastColliderWorldVertices.push(Q.l.TransformCoordinates(this._positions[a],v))}return I._collide(w._trianglePlanes,w._lastColliderWorldVertices,this.getIndices(),w.indexStart,w.indexStart+w.indexCount,w.verticesStart,!!w.getMaterial(),this,this._shouldConvertRHS(),7===(null===(P=w.getMaterial())||void 0===P?void 0:P.fillMode)),this},v.prototype._processCollisionsForSubMeshes=function(w,v){for(var I=this._scene.getCollidingSubMeshCandidates(this,w),P=I.length,u=0;u<P;u++){var Q=I.data[u];P>1&&!Q._checkCollision(w)||this._collideForSubMesh(Q,v,w)}return this},v.prototype._shouldConvertRHS=function(){return!1},v.prototype._checkCollision=function(w){if(!this.getBoundingInfo()._checkCollision(w))return this;var v=Q.i.Matrix[0],I=Q.i.Matrix[1];return Q.e.ScalingToRef(1/w._radius.x,1/w._radius.y,1/w._radius.z,v),this.worldMatrixFromCache.multiplyToRef(v,I),this._processCollisionsForSubMeshes(w,I),this},v.prototype._generatePointsArray=function(){return!1},v.prototype.intersects=function(w,v,I,P,u,K){void 0===P&&(P=!1),void 0===K&&(K=!1);var a=new r.d,U="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,p=this.getBoundingInfo();if(!this.subMeshes)return a;if(!K&&(!w.intersectsSphere(p.boundingSphere,U)||!w.intersectsBox(p.boundingBox,U)))return a;if(P)return a.hit=!K,a.pickedMesh=K?null:this,a.distance=K?0:Q.l.Distance(w.origin,p.boundingSphere.center),a.subMeshId=0,a;if(!this._generatePointsArray())return a;for(var Y=null,g=this._scene.getIntersectingSubMeshCandidates(this,w),J=g.length,l=!1,R=0;R<J;R++){var x=(j=g.data[R]).getMaterial();if(x&&(7==x.fillMode||0==x.fillMode||1==x.fillMode||2==x.fillMode||4==x.fillMode)){l=!0;break}}if(!l)return a.hit=!0,a.pickedMesh=this,a.distance=Q.l.Distance(w.origin,p.boundingSphere.center),a.subMeshId=-1,a;for(R=0;R<J;R++){var j=g.data[R];if(!(J>1)||j.canIntersects(w)){var s=j.intersects(w,this._positions,this.getIndices(),v,I);if(s&&(v||!Y||s.distance<Y.distance)&&((Y=s).subMeshId=R,v))break}}if(Y){var B=null!==u&&void 0!==u?u:this.getWorldMatrix(),t=Q.i.Vector3[0],i=Q.i.Vector3[1];Q.l.TransformCoordinatesToRef(w.origin,B,t),w.direction.scaleToRef(Y.distance,i);var z=Q.l.TransformNormal(i,B).addInPlace(t);return a.hit=!0,a.distance=Q.l.Distance(t,z),a.pickedPoint=z,a.pickedMesh=this,a.bu=Y.bu||0,a.bv=Y.bv||0,a.subMeshFaceId=Y.faceId,a.faceId=Y.faceId+g.data[Y.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),a.subMeshId=Y.subMeshId,a}return a},v.prototype.clone=function(w,v,I){return null},v.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},v.prototype.dispose=function(v,I){var P,u=this;for(void 0===I&&(I=!1),this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),P=0;P<this._intersectionsInProgress.length;P++){var Q=this._intersectionsInProgress[P],K=Q._intersectionsInProgress.indexOf(this);Q._intersectionsInProgress.splice(K,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach((function(w){var v=w.includedOnlyMeshes.indexOf(u);-1!==v&&w.includedOnlyMeshes.splice(v,1),-1!==(v=w.excludedMeshes.indexOf(u))&&w.excludedMeshes.splice(v,1);var I=w.getShadowGenerator();if(I){var P=I.getShadowMap();P&&P.renderList&&-1!==(v=P.renderList.indexOf(u))&&P.renderList.splice(v,1)}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var a=this.getScene().getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,a.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),a.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){var U=this._parentContainer.meshes.indexOf(this);U>-1&&this._parentContainer.meshes.splice(U,1),this._parentContainer=null}if(I&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!v)for(P=0;P<this.getScene().particleSystems.length;P++)this.getScene().particleSystems[P].emitter===this&&(this.getScene().particleSystems[P].dispose(),P--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),w.prototype.dispose.call(this,v,I)},v.prototype.addChild=function(w,v){return void 0===v&&(v=!1),w.setParent(this,v),this},v.prototype.removeChild=function(w,v){return void 0===v&&(v=!1),w.setParent(null,v),this},v.prototype._initFacetData=function(){var w=this._internalAbstractMeshDataInfo._facetData;w.facetNormals||(w.facetNormals=new Array),w.facetPositions||(w.facetPositions=new Array),w.facetPartitioning||(w.facetPartitioning=new Array),w.facetNb=this.getIndices().length/3|0,w.partitioningSubdivisions=w.partitioningSubdivisions?w.partitioningSubdivisions:10,w.partitioningBBoxRatio=w.partitioningBBoxRatio?w.partitioningBBoxRatio:1.01;for(var v=0;v<w.facetNb;v++)w.facetNormals[v]=Q.l.Zero(),w.facetPositions[v]=Q.l.Zero();return w.facetDataEnabled=!0,this},v.prototype.updateFacetData=function(){var w=this._internalAbstractMeshDataInfo._facetData;w.facetDataEnabled||this._initFacetData();var v=this.getVerticesData(a.f.PositionKind),I=this.getIndices(),P=this.getVerticesData(a.f.NormalKind),u=this.getBoundingInfo();if(w.facetDepthSort&&!w.facetDepthSortEnabled){if(w.facetDepthSortEnabled=!0,I instanceof Uint16Array)w.depthSortedIndices=new Uint16Array(I);else if(I instanceof Uint32Array)w.depthSortedIndices=new Uint32Array(I);else{for(var K=!1,p=0;p<I.length;p++)if(I[p]>65535){K=!0;break}w.depthSortedIndices=K?new Uint32Array(I):new Uint16Array(I)}if(w.facetDepthSortFunction=function(w,v){return v.sqDistance-w.sqDistance},!w.facetDepthSortFrom){var r=this.getScene().activeCamera;w.facetDepthSortFrom=r?r.position:Q.l.Zero()}w.depthSortedFacets=[];for(var Y=0;Y<w.facetNb;Y++){var g={ind:3*Y,sqDistance:0};w.depthSortedFacets.push(g)}w.invertedMatrix=Q.e.Identity(),w.facetDepthSortOrigin=Q.l.Zero()}w.bbSize.x=u.maximum.x-u.minimum.x>j.e?u.maximum.x-u.minimum.x:j.e,w.bbSize.y=u.maximum.y-u.minimum.y>j.e?u.maximum.y-u.minimum.y:j.e,w.bbSize.z=u.maximum.z-u.minimum.z>j.e?u.maximum.z-u.minimum.z:j.e;var J=w.bbSize.x>w.bbSize.y?w.bbSize.x:w.bbSize.y;if(J=J>w.bbSize.z?J:w.bbSize.z,w.subDiv.max=w.partitioningSubdivisions,w.subDiv.X=Math.floor(w.subDiv.max*w.bbSize.x/J),w.subDiv.Y=Math.floor(w.subDiv.max*w.bbSize.y/J),w.subDiv.Z=Math.floor(w.subDiv.max*w.bbSize.z/J),w.subDiv.X=w.subDiv.X<1?1:w.subDiv.X,w.subDiv.Y=w.subDiv.Y<1?1:w.subDiv.Y,w.subDiv.Z=w.subDiv.Z<1?1:w.subDiv.Z,w.facetParameters.facetNormals=this.getFacetLocalNormals(),w.facetParameters.facetPositions=this.getFacetLocalPositions(),w.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),w.facetParameters.bInfo=u,w.facetParameters.bbSize=w.bbSize,w.facetParameters.subDiv=w.subDiv,w.facetParameters.ratio=this.partitioningBBoxRatio,w.facetParameters.depthSort=w.facetDepthSort,w.facetDepthSort&&w.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(w.invertedMatrix),Q.l.TransformCoordinatesToRef(w.facetDepthSortFrom,w.invertedMatrix,w.facetDepthSortOrigin),w.facetParameters.distanceTo=w.facetDepthSortOrigin),w.facetParameters.depthSortedFacets=w.depthSortedFacets,P&&U.b.ComputeNormals(v,I,P,w.facetParameters),w.facetDepthSort&&w.facetDepthSortEnabled){w.depthSortedFacets.sort(w.facetDepthSortFunction);var l=w.depthSortedIndices.length/3|0;for(Y=0;Y<l;Y++){var R=w.depthSortedFacets[Y].ind;w.depthSortedIndices[3*Y]=I[R],w.depthSortedIndices[3*Y+1]=I[R+1],w.depthSortedIndices[3*Y+2]=I[R+2]}this.updateIndices(w.depthSortedIndices,void 0,!0)}return this},v.prototype.getFacetLocalNormals=function(){var w=this._internalAbstractMeshDataInfo._facetData;return w.facetNormals||this.updateFacetData(),w.facetNormals},v.prototype.getFacetLocalPositions=function(){var w=this._internalAbstractMeshDataInfo._facetData;return w.facetPositions||this.updateFacetData(),w.facetPositions},v.prototype.getFacetLocalPartitioning=function(){var w=this._internalAbstractMeshDataInfo._facetData;return w.facetPartitioning||this.updateFacetData(),w.facetPartitioning},v.prototype.getFacetPosition=function(w){var v=Q.l.Zero();return this.getFacetPositionToRef(w,v),v},v.prototype.getFacetPositionToRef=function(w,v){var I=this.getFacetLocalPositions()[w],P=this.getWorldMatrix();return Q.l.TransformCoordinatesToRef(I,P,v),this},v.prototype.getFacetNormal=function(w){var v=Q.l.Zero();return this.getFacetNormalToRef(w,v),v},v.prototype.getFacetNormalToRef=function(w,v){var I=this.getFacetLocalNormals()[w];return Q.l.TransformNormalToRef(I,this.getWorldMatrix(),v),this},v.prototype.getFacetsAtLocalCoordinates=function(w,v,I){var P=this.getBoundingInfo(),u=this._internalAbstractMeshDataInfo._facetData,Q=Math.floor((w-P.minimum.x*u.partitioningBBoxRatio)*u.subDiv.X*u.partitioningBBoxRatio/u.bbSize.x),K=Math.floor((v-P.minimum.y*u.partitioningBBoxRatio)*u.subDiv.Y*u.partitioningBBoxRatio/u.bbSize.y),a=Math.floor((I-P.minimum.z*u.partitioningBBoxRatio)*u.subDiv.Z*u.partitioningBBoxRatio/u.bbSize.z);return Q<0||Q>u.subDiv.max||K<0||K>u.subDiv.max||a<0||a>u.subDiv.max?null:u.facetPartitioning[Q+u.subDiv.max*K+u.subDiv.max*u.subDiv.max*a]},v.prototype.getClosestFacetAtCoordinates=function(w,v,I,P,u,K){void 0===u&&(u=!1),void 0===K&&(K=!0);var a=this.getWorldMatrix(),U=Q.i.Matrix[5];a.invertToRef(U);var p=Q.i.Vector3[8];Q.l.TransformCoordinatesFromFloatsToRef(w,v,I,U,p);var r=this.getClosestFacetAtLocalCoordinates(p.x,p.y,p.z,P,u,K);return P&&Q.l.TransformCoordinatesFromFloatsToRef(P.x,P.y,P.z,a,P),r},v.prototype.getClosestFacetAtLocalCoordinates=function(w,v,I,P,u,Q){void 0===u&&(u=!1),void 0===Q&&(Q=!0);var K=null,a=0,U=0,p=0,r=0,Y=0,g=0,J=0,l=0,R=this.getFacetLocalPositions(),x=this.getFacetLocalNormals(),j=this.getFacetsAtLocalCoordinates(w,v,I);if(!j)return null;for(var s,B,t,i=Number.MAX_VALUE,z=i,E=0;E<j.length;E++)B=x[s=j[E]],r=(w-(t=R[s]).x)*B.x+(v-t.y)*B.y+(I-t.z)*B.z,(!u||u&&Q&&r>=0||u&&!Q&&r<=0)&&(r=B.x*t.x+B.y*t.y+B.z*t.z,Y=-(B.x*w+B.y*v+B.z*I-r)/(B.x*B.x+B.y*B.y+B.z*B.z),(z=(a=(g=w+B.x*Y)-w)*a+(U=(J=v+B.y*Y)-v)*U+(p=(l=I+B.z*Y)-I)*p)<i&&(i=z,K=s,P&&(P.x=g,P.y=J,P.z=l)));return K},v.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},v.prototype.disableFacetData=function(){var w=this._internalAbstractMeshDataInfo._facetData;return w.facetDataEnabled&&(w.facetDataEnabled=!1,w.facetPositions=new Array,w.facetNormals=new Array,w.facetPartitioning=new Array,w.facetParameters=null,w.depthSortedIndices=new Uint32Array(0)),this},v.prototype.updateIndices=function(w,v,I){return void 0===I&&(I=!1),this},v.prototype.createNormals=function(w){var v,I=this.getVerticesData(a.f.PositionKind),P=this.getIndices();return v=this.isVerticesDataPresent(a.f.NormalKind)?this.getVerticesData(a.f.NormalKind):[],U.b.ComputeNormals(I,P,v,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(a.f.NormalKind,v,w),this},v.prototype.alignWithNormal=function(w,v){v||(v=s.c.Y);var I=Q.i.Vector3[0],P=Q.i.Vector3[1];return Q.l.CrossToRef(v,w,P),Q.l.CrossToRef(w,P,I),this.rotationQuaternion?Q.f.RotationQuaternionFromAxisToRef(I,w,P,this.rotationQuaternion):Q.l.RotationFromAxisToRef(I,w,P,this.rotation),this},v.prototype._checkOcclusionQuery=function(){return!1},v.prototype.disableEdgesRendering=function(){throw(0,l.e)("EdgesRenderer")},v.prototype.enableEdgesRendering=function(w,v,I){throw(0,l.e)("EdgesRenderer")},v.prototype.getConnectedParticleSystems=function(){var w=this;return this._scene.particleSystems.filter((function(v){return v.emitter===w}))},v.OCCLUSION_TYPE_NONE=0,v.OCCLUSION_TYPE_OPTIMISTIC=1,v.OCCLUSION_TYPE_STRICT=2,v.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,v.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,v.CULLINGSTRATEGY_STANDARD=0,v.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,v.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,v.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,v}(p.d);(0,B.g)("BABYLON.AbstractMesh",z)},3579:function(w,v,I){"use strict";I.d(v,{b:function(){return R}});var P=I(80105),u=I(9488),Q=I(85779),K=I(43251),a=I(50384),U=I(97964),p=I(97918),r=I(9217),Y=I(45883),g=I(18445),J=I(78588),l=I(20334),R=function(){function w(w,v,I,P,u){void 0===P&&(P=!1),void 0===u&&(u=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=v||J.e.LastCreatedScene,this._scene&&(this.id=w,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=P,I?this.setAllVerticesData(I,P):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),u&&(this.applyToMesh(u),u.computeWorldMatrix(!0)))}return Object.defineProperty(w.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(w){this._boundingBias?this._boundingBias.copyFrom(w):this._boundingBias=w.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),w.CreateGeometryForMesh=function(v){var I=new w(w.RandomId(),v.getScene());return I.applyToMesh(v),I},Object.defineProperty(w.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),w.prototype.getScene=function(){return this._scene},w.prototype.getEngine=function(){return this._engine},w.prototype.isReady=function(){return 1===this.delayLoadState||0===this.delayLoadState},Object.defineProperty(w.prototype,"doNotSerialize",{get:function(){for(var w=0;w<this._meshes.length;w++)if(!this._meshes[w].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),w.prototype._rebuild=function(){for(var w in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),this._vertexBuffers){this._vertexBuffers[w]._rebuild()}},w.prototype.setAllVerticesData=function(w,v){w.applyToGeometry(this,v),this._notifyUpdate()},w.prototype.setVerticesData=function(w,v,I,P){void 0===I&&(I=!1),I&&Array.isArray(v)&&(v=new Float32Array(v));var u=new K.f(this._engine,v,w,I,0===this._meshes.length,P);this.setVerticesBuffer(u)},w.prototype.removeVerticesData=function(w){this._vertexBuffers[w]&&(this._vertexBuffers[w].dispose(),delete this._vertexBuffers[w]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()},w.prototype.setVerticesBuffer=function(w,v,I){void 0===v&&(v=null),void 0===I&&(I=!0);var P=w.getKind();this._vertexBuffers[P]&&I&&this._vertexBuffers[P].dispose(),w._buffer&&w._buffer._increaseReferences(),this._vertexBuffers[P]=w;var u=this._meshes,Q=u.length;if(P===K.f.PositionKind){var a=w.getData();null!=v?this._totalVertices=v:null!=a&&(this._totalVertices=a.length/(w.type===K.f.BYTE?w.byteStride:w.byteStride/4)),this._updateExtend(a),this._resetPointsArrayCache();for(var U=0;U<Q;U++){var p=u[U];p.buildBoundingInfo(this._extend.minimum,this._extend.maximum),p._createGlobalSubMesh(p.isUnIndexed),p.computeWorldMatrix(!0),p.synchronizeInstances()}}this._notifyUpdate(P)},w.prototype.updateVerticesDataDirectly=function(w,v,I,P){void 0===P&&(P=!1);var u=this.getVertexBuffer(w);u&&(u.updateDirectly(v,I,P),this._notifyUpdate(w))},w.prototype.updateVerticesData=function(w,v,I){void 0===I&&(I=!1);var P=this.getVertexBuffer(w);P&&(P.update(v),w===K.f.PositionKind&&this._updateBoundingInfo(I,v),this._notifyUpdate(w))},w.prototype._updateBoundingInfo=function(w,v){if(w&&this._updateExtend(v),this._resetPointsArrayCache(),w)for(var I=0,P=this._meshes;I<P.length;I++){var u=P[I];u.hasBoundingInfo?u.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):u.buildBoundingInfo(this._extend.minimum,this._extend.maximum);for(var Q=0,K=u.subMeshes;Q<K.length;Q++){K[Q].refreshBoundingInfo()}}},w.prototype._bind=function(w,v,I,P){if(w){void 0===v&&(v=this._indexBuffer);var u=this.getVertexBuffers();if(u)if(v==this._indexBuffer&&(this._vertexArrayObjects||P)){var Q=P||this._vertexArrayObjects;Q[w.key]||(Q[w.key]=this._engine.recordVertexArrayObject(u,v,w,I)),this._engine.bindVertexArrayObject(Q[w.key],v)}else this._engine.bindBuffers(u,v,w,I)}},w.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},w.prototype.getVerticesData=function(w,v,I){var P=this.getVertexBuffer(w);return P?P.getFloatData(this._totalVertices,I||v&&1!==this._meshes.length):null},w.prototype.isVertexBufferUpdatable=function(w){var v=this._vertexBuffers[w];return!!v&&v.isUpdatable()},w.prototype.getVertexBuffer=function(w){return this.isReady()?this._vertexBuffers[w]:null},w.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},w.prototype.isVerticesDataPresent=function(w){return this._vertexBuffers?void 0!==this._vertexBuffers[w]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(w)},w.prototype.getVerticesDataKinds=function(){var w,v=[];if(!this._vertexBuffers&&this._delayInfo)for(w in this._delayInfo)v.push(w);else for(w in this._vertexBuffers)v.push(w);return v},w.prototype.updateIndices=function(w,v,I){if(void 0===I&&(I=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var P=w.length!==this._indices.length;if(I||(this._indices=w.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,w,v),P)for(var u=0,Q=this._meshes;u<Q.length;u++){Q[u]._createGlobalSubMesh(!0)}}else this.setIndices(w,null,!0)},w.prototype.setIndices=function(w,v,I){void 0===v&&(v=null),void 0===I&&(I=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=w,this._indexBufferIsUpdatable=I,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,I)),void 0!=v&&(this._totalVertices=v);for(var P=0,u=this._meshes;P<u.length;P++){var Q=u[P];Q._createGlobalSubMesh(!0),Q.synchronizeInstances()}this._notifyUpdate()},w.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},w.prototype.getIndices=function(w,v){if(!this.isReady())return null;var I=this._indices;return v||w&&1!==this._meshes.length?I.slice():I},w.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},w.prototype._releaseVertexArrayObject=function(w){void 0===w&&(w=null),w&&this._vertexArrayObjects&&this._vertexArrayObjects[w.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[w.key]),delete this._vertexArrayObjects[w.key])},w.prototype.releaseForMesh=function(w,v){var I=this._meshes,P=I.indexOf(w);-1!==P&&(I.splice(P,1),this._vertexArrayObjects&&w._invalidateInstanceVertexArrayObject(),w._geometry=null,0===I.length&&v&&this.dispose())},w.prototype.applyToMesh=function(w){if(w._geometry!==this){var v=w._geometry;v&&v.releaseForMesh(w),this._vertexArrayObjects&&w._invalidateInstanceVertexArrayObject();var I=this._meshes;w._geometry=this,w._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),I.push(w),this.isReady()?this._applyToMesh(w):this._boundingInfo&&w.setBoundingInfo(this._boundingInfo)}},w.prototype._updateExtend=function(w){if(void 0===w&&(w=null),this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!w&&!(w=this.getVerticesData(K.f.PositionKind)))return;this._extend=(0,g.f)(w,0,this._totalVertices,this.boundingBias,3)}},w.prototype._applyToMesh=function(w){var v=this._meshes.length;for(var I in this._vertexBuffers)1===v&&this._vertexBuffers[I].create(),I===K.f.PositionKind&&(this._extend||this._updateExtend(),w.buildBoundingInfo(this._extend.minimum,this._extend.maximum),w._createGlobalSubMesh(w.isUnIndexed),w._updateBoundingInfo());1===v&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),w._syncGeometryWithMorphTargetManager(),w.synchronizeInstances()},w.prototype._notifyUpdate=function(w){this.onGeometryUpdated&&this.onGeometryUpdated(this,w),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(var v=0,I=this._meshes;v<I.length;v++){I[v]._markSubMeshesAsAttributesDirty()}},w.prototype.load=function(w,v){2!==this.delayLoadState&&(this.isReady()?v&&v():(this.delayLoadState=2,this._queueLoad(w,v)))},w.prototype._queueLoad=function(w,v){var I=this;this.delayLoadingFile&&(w._addPendingData(this),w._loadFile(this.delayLoadingFile,(function(P){if(I._delayLoadingFunction){I._delayLoadingFunction(JSON.parse(P),I),I.delayLoadState=1,I._delayInfo=[],w._removePendingData(I);for(var u=I._meshes,Q=u.length,K=0;K<Q;K++)I._applyToMesh(u[K]);v&&v()}}),void 0,!0))},w.prototype.toLeftHanded=function(){var w=this.getIndices(!1);if(null!=w&&w.length>0){for(var v=0;v<w.length;v+=3){var I=w[v+0];w[v+0]=w[v+2],w[v+2]=I}this.setIndices(w)}var P=this.getVerticesData(K.f.PositionKind,!1);if(null!=P&&P.length>0){for(v=0;v<P.length;v+=3)P[v+2]=-P[v+2];this.setVerticesData(K.f.PositionKind,P,!1)}var u=this.getVerticesData(K.f.NormalKind,!1);if(null!=u&&u.length>0){for(v=0;v<u.length;v+=3)u[v+2]=-u[v+2];this.setVerticesData(K.f.NormalKind,u,!1)}},w.prototype._resetPointsArrayCache=function(){this._positions=null},w.prototype._generatePointsArray=function(){if(this._positions)return!0;var w=this.getVerticesData(K.f.PositionKind);if(!w||0===w.length)return!1;for(var v=3*this._positionsCache.length,I=this._positionsCache.length;v<w.length;v+=3,++I)this._positionsCache[I]=P.l.FromArray(w,v);for(v=0,I=0;v<w.length;v+=3,++I)this._positionsCache[I].set(w[0+v],w[1+v],w[2+v]);return this._positionsCache.length=w.length/3,this._positions=this._positionsCache,!0},w.prototype.isDisposed=function(){return this._isDisposed},w.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var w in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[w]);this._vertexArrayObjects={};for(var v=this._meshes,I=v.length,P=0;P<I;P++)v[P]._invalidateInstanceVertexArrayObject()}},w.prototype.dispose=function(){var w,v=this._meshes,I=v.length;for(w=0;w<I;w++)this.releaseForMesh(v[w]);for(var P in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[P].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){var u=this._parentContainer.geometries.indexOf(this);u>-1&&this._parentContainer.geometries.splice(u,1),this._parentContainer=null}this._isDisposed=!0},w.prototype.copy=function(v){var I=new Q.b;I.indices=[];var P=this.getIndices();if(P)for(var u=0;u<P.length;u++)I.indices.push(P[u]);var K,a=!1,U=!1;for(K in this._vertexBuffers){var r=this.getVerticesData(K);if(r&&(r instanceof Float32Array?I.set(new Float32Array(r),K):I.set(r.slice(0),K),!U)){var Y=this.getVertexBuffer(K);Y&&(U=!(a=Y.isUpdatable()))}}var g=new w(v,this._scene,I,a);for(K in g.delayLoadState=this.delayLoadState,g.delayLoadingFile=this.delayLoadingFile,g._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)g._delayInfo=g._delayInfo||[],g._delayInfo.push(K);return g._boundingInfo=new p.e(this._extend.minimum,this._extend.maximum),g},w.prototype.serialize=function(){var w={};return w.id=this.id,w.uniqueId=this.uniqueId,w.updatable=this._updatable,Y.c&&Y.c.HasTags(this)&&(w.tags=Y.c.GetTags(this)),w},w.prototype._toNumberArray=function(w){return Array.isArray(w)?w:Array.prototype.slice.call(w)},w.prototype.clearCachedData=function(){for(var w in this._indices=[],this._resetPointsArrayCache(),this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,w)&&(this._vertexBuffers[w]._buffer._data=null)},w.prototype.serializeVerticeData=function(){var w=this.serialize();return this.isVerticesDataPresent(K.f.PositionKind)&&(w.positions=this._toNumberArray(this.getVerticesData(K.f.PositionKind)),this.isVertexBufferUpdatable(K.f.PositionKind)&&(w.positions._updatable=!0)),this.isVerticesDataPresent(K.f.NormalKind)&&(w.normals=this._toNumberArray(this.getVerticesData(K.f.NormalKind)),this.isVertexBufferUpdatable(K.f.NormalKind)&&(w.normals._updatable=!0)),this.isVerticesDataPresent(K.f.TangentKind)&&(w.tangents=this._toNumberArray(this.getVerticesData(K.f.TangentKind)),this.isVertexBufferUpdatable(K.f.TangentKind)&&(w.tangents._updatable=!0)),this.isVerticesDataPresent(K.f.UVKind)&&(w.uvs=this._toNumberArray(this.getVerticesData(K.f.UVKind)),this.isVertexBufferUpdatable(K.f.UVKind)&&(w.uvs._updatable=!0)),this.isVerticesDataPresent(K.f.UV2Kind)&&(w.uv2s=this._toNumberArray(this.getVerticesData(K.f.UV2Kind)),this.isVertexBufferUpdatable(K.f.UV2Kind)&&(w.uv2s._updatable=!0)),this.isVerticesDataPresent(K.f.UV3Kind)&&(w.uv3s=this._toNumberArray(this.getVerticesData(K.f.UV3Kind)),this.isVertexBufferUpdatable(K.f.UV3Kind)&&(w.uv3s._updatable=!0)),this.isVerticesDataPresent(K.f.UV4Kind)&&(w.uv4s=this._toNumberArray(this.getVerticesData(K.f.UV4Kind)),this.isVertexBufferUpdatable(K.f.UV4Kind)&&(w.uv4s._updatable=!0)),this.isVerticesDataPresent(K.f.UV5Kind)&&(w.uv5s=this._toNumberArray(this.getVerticesData(K.f.UV5Kind)),this.isVertexBufferUpdatable(K.f.UV5Kind)&&(w.uv5s._updatable=!0)),this.isVerticesDataPresent(K.f.UV6Kind)&&(w.uv6s=this._toNumberArray(this.getVerticesData(K.f.UV6Kind)),this.isVertexBufferUpdatable(K.f.UV6Kind)&&(w.uv6s._updatable=!0)),this.isVerticesDataPresent(K.f.ColorKind)&&(w.colors=this._toNumberArray(this.getVerticesData(K.f.ColorKind)),this.isVertexBufferUpdatable(K.f.ColorKind)&&(w.colors._updatable=!0)),this.isVerticesDataPresent(K.f.MatricesIndicesKind)&&(w.matricesIndices=this._toNumberArray(this.getVerticesData(K.f.MatricesIndicesKind)),w.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(K.f.MatricesIndicesKind)&&(w.matricesIndices._updatable=!0)),this.isVerticesDataPresent(K.f.MatricesWeightsKind)&&(w.matricesWeights=this._toNumberArray(this.getVerticesData(K.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(K.f.MatricesWeightsKind)&&(w.matricesWeights._updatable=!0)),w.indices=this._toNumberArray(this.getIndices()),w},w.ExtractFromMesh=function(w,v){var I=w._geometry;return I?I.copy(v):null},w.RandomId=function(){return r.i.RandomId()},w._GetGeometryByLoadedUniqueId=function(w,v){for(var I=0;I<v.geometries.length;I++)if(v.geometries[I]._loadedUniqueId===w)return v.geometries[I];return null},w._ImportGeometry=function(v,I){var P=I.getScene(),Q=v.geometryUniqueId,U=v.geometryId;if(Q||U){var p=Q?this._GetGeometryByLoadedUniqueId(Q,P):P.getGeometryById(U);p&&p.applyToMesh(I)}else if(v instanceof ArrayBuffer){var r=I._binaryInfo;if(r.positionsAttrDesc&&r.positionsAttrDesc.count>0){var Y=new Float32Array(v,r.positionsAttrDesc.offset,r.positionsAttrDesc.count);I.setVerticesData(K.f.PositionKind,Y,!1)}if(r.normalsAttrDesc&&r.normalsAttrDesc.count>0){var g=new Float32Array(v,r.normalsAttrDesc.offset,r.normalsAttrDesc.count);I.setVerticesData(K.f.NormalKind,g,!1)}if(r.tangetsAttrDesc&&r.tangetsAttrDesc.count>0){var J=new Float32Array(v,r.tangetsAttrDesc.offset,r.tangetsAttrDesc.count);I.setVerticesData(K.f.TangentKind,J,!1)}if(r.uvsAttrDesc&&r.uvsAttrDesc.count>0){var R=new Float32Array(v,r.uvsAttrDesc.offset,r.uvsAttrDesc.count);if(l.e.UseOpenGLOrientationForUV)for(var x=1;x<R.length;x+=2)R[x]=1-R[x];I.setVerticesData(K.f.UVKind,R,!1)}if(r.uvs2AttrDesc&&r.uvs2AttrDesc.count>0){var j=new Float32Array(v,r.uvs2AttrDesc.offset,r.uvs2AttrDesc.count);if(l.e.UseOpenGLOrientationForUV)for(x=1;x<j.length;x+=2)j[x]=1-j[x];I.setVerticesData(K.f.UV2Kind,j,!1)}if(r.uvs3AttrDesc&&r.uvs3AttrDesc.count>0){var s=new Float32Array(v,r.uvs3AttrDesc.offset,r.uvs3AttrDesc.count);if(l.e.UseOpenGLOrientationForUV)for(x=1;x<s.length;x+=2)s[x]=1-s[x];I.setVerticesData(K.f.UV3Kind,s,!1)}if(r.uvs4AttrDesc&&r.uvs4AttrDesc.count>0){var B=new Float32Array(v,r.uvs4AttrDesc.offset,r.uvs4AttrDesc.count);if(l.e.UseOpenGLOrientationForUV)for(x=1;x<B.length;x+=2)B[x]=1-B[x];I.setVerticesData(K.f.UV4Kind,B,!1)}if(r.uvs5AttrDesc&&r.uvs5AttrDesc.count>0){var t=new Float32Array(v,r.uvs5AttrDesc.offset,r.uvs5AttrDesc.count);if(l.e.UseOpenGLOrientationForUV)for(x=1;x<t.length;x+=2)t[x]=1-t[x];I.setVerticesData(K.f.UV5Kind,t,!1)}if(r.uvs6AttrDesc&&r.uvs6AttrDesc.count>0){var i=new Float32Array(v,r.uvs6AttrDesc.offset,r.uvs6AttrDesc.count);if(l.e.UseOpenGLOrientationForUV)for(x=1;x<i.length;x+=2)i[x]=1-i[x];I.setVerticesData(K.f.UV6Kind,i,!1)}if(r.colorsAttrDesc&&r.colorsAttrDesc.count>0){var z=new Float32Array(v,r.colorsAttrDesc.offset,r.colorsAttrDesc.count);I.setVerticesData(K.f.ColorKind,z,!1,r.colorsAttrDesc.stride)}if(r.matricesIndicesAttrDesc&&r.matricesIndicesAttrDesc.count>0){for(var E=new Int32Array(v,r.matricesIndicesAttrDesc.offset,r.matricesIndicesAttrDesc.count),o=[],h=0;h<E.length;h++){x=E[h];o.push(255&x),o.push((65280&x)>>8),o.push((16711680&x)>>16),o.push(x>>24&255)}I.setVerticesData(K.f.MatricesIndicesKind,o,!1)}if(r.matricesIndicesExtraAttrDesc&&r.matricesIndicesExtraAttrDesc.count>0){for(E=new Int32Array(v,r.matricesIndicesExtraAttrDesc.offset,r.matricesIndicesExtraAttrDesc.count),o=[],h=0;h<E.length;h++){x=E[h];o.push(255&x),o.push((65280&x)>>8),o.push((16711680&x)>>16),o.push(x>>24&255)}I.setVerticesData(K.f.MatricesIndicesExtraKind,o,!1)}if(r.matricesWeightsAttrDesc&&r.matricesWeightsAttrDesc.count>0){var n=new Float32Array(v,r.matricesWeightsAttrDesc.offset,r.matricesWeightsAttrDesc.count);I.setVerticesData(K.f.MatricesWeightsKind,n,!1)}if(r.indicesAttrDesc&&r.indicesAttrDesc.count>0){var W=new Int32Array(v,r.indicesAttrDesc.offset,r.indicesAttrDesc.count);I.setIndices(W,null)}if(r.subMeshesAttrDesc&&r.subMeshesAttrDesc.count>0){var V=new Int32Array(v,r.subMeshesAttrDesc.offset,5*r.subMeshesAttrDesc.count);I.subMeshes=[];for(h=0;h<r.subMeshesAttrDesc.count;h++){var F=V[5*h+0],O=V[5*h+1],N=V[5*h+2],q=V[5*h+3],m=V[5*h+4];a.c.AddToMesh(F,O,N,q,m,I)}}}else if(v.positions&&v.normals&&v.indices){if(I.setVerticesData(K.f.PositionKind,v.positions,v.positions._updatable),I.setVerticesData(K.f.NormalKind,v.normals,v.normals._updatable),v.tangents&&I.setVerticesData(K.f.TangentKind,v.tangents,v.tangents._updatable),v.uvs&&I.setVerticesData(K.f.UVKind,v.uvs,v.uvs._updatable),v.uvs2&&I.setVerticesData(K.f.UV2Kind,v.uvs2,v.uvs2._updatable),v.uvs3&&I.setVerticesData(K.f.UV3Kind,v.uvs3,v.uvs3._updatable),v.uvs4&&I.setVerticesData(K.f.UV4Kind,v.uvs4,v.uvs4._updatable),v.uvs5&&I.setVerticesData(K.f.UV5Kind,v.uvs5,v.uvs5._updatable),v.uvs6&&I.setVerticesData(K.f.UV6Kind,v.uvs6,v.uvs6._updatable),v.colors&&I.setVerticesData(K.f.ColorKind,u.f.CheckColors4(v.colors,v.positions.length/3),v.colors._updatable),v.matricesIndices)if(v.matricesIndices._isExpanded)delete v.matricesIndices._isExpanded,I.setVerticesData(K.f.MatricesIndicesKind,v.matricesIndices,v.matricesIndices._updatable);else{for(o=[],h=0;h<v.matricesIndices.length;h++){var c=v.matricesIndices[h];o.push(255&c),o.push((65280&c)>>8),o.push((16711680&c)>>16),o.push(c>>24&255)}I.setVerticesData(K.f.MatricesIndicesKind,o,v.matricesIndices._updatable)}if(v.matricesIndicesExtra)if(v.matricesIndicesExtra._isExpanded)delete v.matricesIndices._isExpanded,I.setVerticesData(K.f.MatricesIndicesExtraKind,v.matricesIndicesExtra,v.matricesIndicesExtra._updatable);else{for(o=[],h=0;h<v.matricesIndicesExtra.length;h++){c=v.matricesIndicesExtra[h];o.push(255&c),o.push((65280&c)>>8),o.push((16711680&c)>>16),o.push(c>>24&255)}I.setVerticesData(K.f.MatricesIndicesExtraKind,o,v.matricesIndicesExtra._updatable)}v.matricesWeights&&(w._CleanMatricesWeights(v,I),I.setVerticesData(K.f.MatricesWeightsKind,v.matricesWeights,v.matricesWeights._updatable)),v.matricesWeightsExtra&&I.setVerticesData(K.f.MatricesWeightsExtraKind,v.matricesWeightsExtra,v.matricesWeights._updatable),I.setIndices(v.indices,null)}if(v.subMeshes){I.subMeshes=[];for(var M=0;M<v.subMeshes.length;M++){var S=v.subMeshes[M];a.c.AddToMesh(S.materialIndex,S.verticesStart,S.verticesCount,S.indexStart,S.indexCount,I)}}I._shouldGenerateFlatShading&&(I.convertToFlatShadedMesh(),I._shouldGenerateFlatShading=!1),I.computeWorldMatrix(!0),P.onMeshImportedObservable.notifyObservers(I)},w._CleanMatricesWeights=function(w,v){var I=.001;if(U.c.CleanBoneMatrixWeights){var P=0;if(w.skeletonId>-1){var u=v.getScene().getLastSkeletonById(w.skeletonId);if(u){P=u.bones.length;for(var Q=v.getVerticesData(K.f.MatricesIndicesKind),a=v.getVerticesData(K.f.MatricesIndicesExtraKind),p=w.matricesWeights,r=w.matricesWeightsExtra,Y=w.numBoneInfluencer,g=p.length,J=0;J<g;J+=4){for(var l=0,R=-1,x=0;x<4;x++){l+=j=p[J+x],j<I&&R<0&&(R=x)}if(r)for(x=0;x<4;x++){var j;l+=j=r[J+x],j<I&&R<0&&(R=x+4)}if((R<0||R>Y-1)&&(R=Y-1),l>I){var s=1/l;for(x=0;x<4;x++)p[J+x]*=s;if(r)for(x=0;x<4;x++)r[J+x]*=s}else R>=4?(r[J+R-4]=1-l,a[J+R-4]=P):(p[J+R]=1-l,Q[J+R]=P)}v.setVerticesData(K.f.MatricesIndicesKind,Q),w.matricesWeightsExtra&&v.setVerticesData(K.f.MatricesIndicesExtraKind,a)}}}},w.Parse=function(v,I,u){var a=new w(v.id,I,void 0,v.updatable);return a._loadedUniqueId=v.uniqueId,Y.c&&Y.c.AddTagsTo(a,v.tags),v.delayLoadingFile?(a.delayLoadState=4,a.delayLoadingFile=u+v.delayLoadingFile,a._boundingInfo=new p.e(P.l.FromArray(v.boundingBoxMinimum),P.l.FromArray(v.boundingBoxMaximum)),a._delayInfo=[],v.hasUVs&&a._delayInfo.push(K.f.UVKind),v.hasUVs2&&a._delayInfo.push(K.f.UV2Kind),v.hasUVs3&&a._delayInfo.push(K.f.UV3Kind),v.hasUVs4&&a._delayInfo.push(K.f.UV4Kind),v.hasUVs5&&a._delayInfo.push(K.f.UV5Kind),v.hasUVs6&&a._delayInfo.push(K.f.UV6Kind),v.hasColors&&a._delayInfo.push(K.f.ColorKind),v.hasMatricesIndices&&a._delayInfo.push(K.f.MatricesIndicesKind),v.hasMatricesWeights&&a._delayInfo.push(K.f.MatricesWeightsKind),a._delayLoadingFunction=Q.b.ImportVertexData):Q.b.ImportVertexData(v,a),I.pushGeometry(a,!0),a},w}()},35941:function(w,v,I){"use strict";I.d(v,{d:function(){return Y}});var P=I(78502),u=I(80105),Q=I(9127),K=I(52644),a=I(65847),U=I(51004),p=I(77129),r=I(43251);a.b._instancedMeshFactory=function(w,v){var I=new Y(w,v);if(v.instancedBuffers)for(var P in I.instancedBuffers={},v.instancedBuffers)I.instancedBuffers[P]=v.instancedBuffers[P];return I};var Y=function(w){function v(v,I){var P=w.call(this,v,I.getScene())||this;P._indexInSourceMeshInstanceArray=-1,P._distanceToCamera=0,I.addInstance(P),P._sourceMesh=I,P._unIndexed=I._unIndexed,P.position.copyFrom(I.position),P.rotation.copyFrom(I.rotation),P.scaling.copyFrom(I.scaling),I.rotationQuaternion&&(P.rotationQuaternion=I.rotationQuaternion.clone()),P.animations=I.animations.slice();for(var u=0,Q=I.getAnimationRanges();u<Q.length;u++){var K=Q[u];null!=K&&P.createAnimationRange(K.name,K.from,K.to)}return P.infiniteDistance=I.infiniteDistance,P.setPivotMatrix(I.getPivotMatrix()),P.refreshBoundingInfo(!0,!0),P._syncSubMeshes(),P}return(0,P.m)(v,w),v.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(v.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),v.prototype._resyncLightSources=function(){},v.prototype._resyncLightSource=function(){},v.prototype._removeLightSource=function(){},Object.defineProperty(v.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(w){this._sourceMesh&&w!==this._sourceMesh.renderingGroupId&&Q.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),v.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},v.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(v.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),v.prototype.createInstance=function(w){return this._sourceMesh.createInstance(w)},v.prototype.isReady=function(w){return void 0===w&&(w=!1),this._sourceMesh.isReady(w,!0)},v.prototype.getVerticesData=function(w,v){return this._sourceMesh.getVerticesData(w,v)},v.prototype.setVerticesData=function(w,v,I,P){return this.sourceMesh&&this.sourceMesh.setVerticesData(w,v,I,P),this.sourceMesh},v.prototype.updateVerticesData=function(w,v,I,P){return this.sourceMesh&&this.sourceMesh.updateVerticesData(w,v,I,P),this.sourceMesh},v.prototype.setIndices=function(w,v){return void 0===v&&(v=null),this.sourceMesh&&this.sourceMesh.setIndices(w,v),this.sourceMesh},v.prototype.isVerticesDataPresent=function(w){return this._sourceMesh.isVerticesDataPresent(w)},v.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(v.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),v.prototype.refreshBoundingInfo=function(w,v){if(void 0===w&&(w=!1),void 0===v&&(v=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var I=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(w,v),I),this},v.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},v.prototype._activate=function(v,I){if(w.prototype._activate.call(this,v,I),this._sourceMesh.subMeshes||Q.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,v),I){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},v.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},v.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==p.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new u.e);var v=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,u.i.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(u.i.Vector3[7]),this._currentLOD._masterMesh=v,this._billboardWorldMatrix}return w.prototype.getWorldMatrix.call(this)},Object.defineProperty(v.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),v.prototype.getLOD=function(w){if(!w)return this;var v=this.sourceMesh.getLODLevels();if(v&&0!==v.length){var I=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(w,I.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD},v.prototype._preActivateForIntermediateRendering=function(w){return this.sourceMesh._preActivateForIntermediateRendering(w)},v.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var w=0;w<this._sourceMesh.subMeshes.length;w++)this._sourceMesh.subMeshes[w].clone(this,this._sourceMesh);return this},v.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},v.prototype._updateBoundingInfo=function(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},v.prototype.clone=function(w,v,I){void 0===v&&(v=null);var P=this._sourceMesh.createInstance(w);if(U.e.DeepCopy(this,P,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),v&&(P.parent=v),!I)for(var u=0;u<this.getScene().meshes.length;u++){var Q=this.getScene().meshes[u];Q.parent===this&&Q.clone(Q.name,P)}return P.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(P),P},v.prototype.dispose=function(v,I){void 0===I&&(I=!1),this._sourceMesh.removeInstance(this),w.prototype.dispose.call(this,v,I)},v.prototype._serializeAsParent=function(v){w.prototype._serializeAsParent.call(this,v),v.parentId=this._sourceMesh.uniqueId,v.parentInstanceIndex=this._indexInSourceMeshInstanceArray},v}(K.b);a.b.prototype.registerInstancedBuffer=function(w,v){var I,P;if(null===(P=null===(I=this._userInstancedBuffersStorage)||void 0===I?void 0:I.vertexBuffers[w])||void 0===P||P.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(var u=0,Q=this.instances;u<Q.length;u++){Q[u].instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0})}this.instancedBuffers[w]=null,this._userInstancedBuffersStorage.strides[w]=v,this._userInstancedBuffersStorage.sizes[w]=32*v,this._userInstancedBuffersStorage.data[w]=new Float32Array(this._userInstancedBuffersStorage.sizes[w]),this._userInstancedBuffersStorage.vertexBuffers[w]=new r.f(this.getEngine(),this._userInstancedBuffersStorage.data[w],w,!0,!1,v,!0);for(var K=0,a=this.instances;K<a.length;K++){a[K].instancedBuffers[w]=null}this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},a.b.prototype._processInstancedBuffers=function(w,v){var I=w.length;for(var P in this.instancedBuffers){for(var u=this._userInstancedBuffersStorage.sizes[P],Q=this._userInstancedBuffersStorage.strides[P],K=(I+1)*Q;u<K;)u*=2;this._userInstancedBuffersStorage.data[P].length!=u&&(this._userInstancedBuffersStorage.data[P]=new Float32Array(u),this._userInstancedBuffersStorage.sizes[P]=u,this._userInstancedBuffersStorage.vertexBuffers[P]&&(this._userInstancedBuffersStorage.vertexBuffers[P].dispose(),this._userInstancedBuffersStorage.vertexBuffers[P]=null));var a=this._userInstancedBuffersStorage.data[P],U=0;if(v)(Y=this.instancedBuffers[P]).toArray?Y.toArray(a,U):Y.copyToArray?Y.copyToArray(a,U):a[U]=Y,U+=Q;for(var p=0;p<I;p++){var Y;(Y=w[p].instancedBuffers[P]).toArray?Y.toArray(a,U):Y.copyToArray?Y.copyToArray(a,U):a[U]=Y,U+=Q}this._userInstancedBuffersStorage.vertexBuffers[P]?this._userInstancedBuffersStorage.vertexBuffers[P].updateDirectly(a,0):(this._userInstancedBuffersStorage.vertexBuffers[P]=new r.f(this.getEngine(),this._userInstancedBuffersStorage.data[P],P,!0,!1,Q,!0),this._invalidateInstanceVertexArrayObject())}},a.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(var w in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[w]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},a.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var w in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[w]&&this._userInstancedBuffersStorage.vertexBuffers[w].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}}},65847:function(w,v,I){"use strict";I.d(v,{b:function(){return N},e:function(){return n}});var P=I(78502),u=I(9271),Q=I(9217),K=I(51004),a=I(45883),U=I(61633),p=I(80105),r=I(9488),Y=I(74134),g=I(43251),J=I(85779),l=I(3579),R=I(52644),x=I(50384),j=I(46907),s=I(49443),B=I(97964),t=I(9892),i=I(9127),z=I(31709),E=I(50504),o=I(21693),h=function(w,v){this.distanceOrScreenCoverage=w,this.mesh=v},n=function(){},W=function(){this.visibleInstances={},this.batchCache=new V,this.batchCacheReplacementModeInFrozenMode=new V,this.instancesBufferSize=2048},V=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},F=function(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null},O=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0},N=function(w){function v(I,P,Q,U,p,r){void 0===P&&(P=null),void 0===Q&&(Q=null),void 0===U&&(U=null),void 0===r&&(r=!0);var Y=w.call(this,I,P)||this;if(Y._internalMeshDataInfo=new O,Y.delayLoadState=0,Y.instances=new Array,Y._creationDataStorage=null,Y._geometry=null,Y._instanceDataStorage=new W,Y._thinInstanceDataStorage=new F,Y._shouldGenerateFlatShading=!1,Y._originalBuilderSideOrientation=v.DEFAULTSIDE,Y.overrideMaterialSideOrientation=null,Y.ignoreCameraMaxZ=!1,P=Y.getScene(),Y._onBeforeDraw=function(w,v,I){w&&I&&(Y._uniformBuffer?Y.transferToEffect(v):I.bindOnlyWorldMatrix(v))},U){if(U._geometry&&U._geometry.applyToMesh(Y),K.e.DeepCopy(U,Y,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo"],["_poseMatrix"]),Y._internalMeshDataInfo._source=U,P.useClonedMeshMap&&(U._internalMeshDataInfo.meshMap||(U._internalMeshDataInfo.meshMap={}),U._internalMeshDataInfo.meshMap[Y.uniqueId]=Y),Y._originalBuilderSideOrientation=U._originalBuilderSideOrientation,Y._creationDataStorage=U._creationDataStorage,U._ranges){var g=U._ranges;for(var J in g)Object.prototype.hasOwnProperty.call(g,J)&&g[J]&&Y.createAnimationRange(J,g[J].from,g[J].to)}if(U.metadata&&U.metadata.clone?Y.metadata=U.metadata.clone():Y.metadata=U.metadata,a.c&&a.c.HasTags(U)&&a.c.AddTagsTo(Y,a.c.GetTags(U,!0)),Y.setEnabled(U.isEnabled()),Y.parent=U.parent,Y.setPivotMatrix(U.getPivotMatrix()),Y.id=I+"."+U.id,Y.material=U.material,!p)for(var l=U.getDescendants(!0),R=0;R<l.length;R++){var x=l[R];x.clone&&x.clone(I+"."+x.name,Y)}if(U.morphTargetManager&&(Y.morphTargetManager=U.morphTargetManager),P.getPhysicsEngine){var j=P.getPhysicsEngine();if(r&&j){var s=j.getImpostorForPhysicsObject(U);s&&(Y.physicsImpostor=s.clone(Y))}}for(R=0;R<P.particleSystems.length;R++){var B=P.particleSystems[R];B.emitter===U&&B.clone(B.name,Y)}Y.skeleton=U.skeleton,Y.refreshBoundingInfo(!0,!0),Y.computeWorldMatrix(!0)}return null!==Q&&(Y.parent=Q),Y._instanceDataStorage.hardwareInstancedRendering=Y.getEngine().getCaps().instancedArrays,Y._internalMeshDataInfo._onMeshReadyObserverAdded=function(w){w.unregisterOnNextCall=!0,Y.isReady(!0)?Y.onMeshReadyObservable.notifyObservers(Y):Y._internalMeshDataInfo._checkReadinessObserver||(Y._internalMeshDataInfo._checkReadinessObserver=Y._scene.onBeforeRenderObservable.add((function(){Y.isReady(!0)&&(Y._scene.onBeforeRenderObservable.remove(Y._internalMeshDataInfo._checkReadinessObserver),Y._internalMeshDataInfo._checkReadinessObserver=null,Y.onMeshReadyObservable.notifyObservers(Y))})))},Y.onMeshReadyObservable=new u.c(Y._internalMeshDataInfo._onMeshReadyObserverAdded),U&&U.onClonedObservable.notifyObservers(Y),Y}return(0,P.m)(v,w),v._GetDefaultSideOrientation=function(w){return w||v.FRONTSIDE},Object.defineProperty(v.prototype,"useLODScreenCoverage",{get:function(){return this._internalMeshDataInfo._useLODScreenCoverage},set:function(w){this._internalMeshDataInfo._useLODScreenCoverage=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(w){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==w&&(w&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(g.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(g.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=w,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new u.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new u.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new u.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onBetweenPassObservable",{get:function(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new u.c),this._internalMeshDataInfo._onBetweenPassObservable},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new u.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onBeforeDraw",{set:function(w){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"hasThinInstances",{get:function(){var w;return(null!==(w=this._thinInstanceDataStorage.instancesCount)&&void 0!==w?w:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"forcedInstanceCount",{get:function(){return this._internalMeshDataInfo._forcedInstanceCount},set:function(w){this._internalMeshDataInfo._forcedInstanceCount=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(w){this._unIndexed!==w&&(this._unIndexed=w,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"previousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesPreviousData},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(w){this._instanceDataStorage.manualUpdate=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"manualUpdateOfPreviousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.previousManualUpdate},set:function(w){this._instanceDataStorage.previousManualUpdate=w},enumerable:!1,configurable:!0}),v.prototype.instantiateHierarchy=function(w,v,I){void 0===w&&(w=null);var P=!(this.getTotalVertices()>0)||v&&v.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),w||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));P.parent=w||this.parent,P.position=this.position.clone(),P.scaling=this.scaling.clone(),this.rotationQuaternion?P.rotationQuaternion=this.rotationQuaternion.clone():P.rotation=this.rotation.clone(),I&&I(this,P);for(var u=0,Q=this.getChildTransformNodes(!0);u<Q.length;u++){Q[u].instantiateHierarchy(P,v,I)}return P},v.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(v.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),v.prototype.toString=function(v){var I=w.prototype.toString.call(this,v);if(I+=", n vertices: "+this.getTotalVertices(),I+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var P=0;P<this.animations.length;P++)I+=", animation[0]: "+this.animations[P].toString(v);if(v)if(this._geometry){var u=this.getIndices(),Q=this.getVerticesData(g.f.PositionKind);Q&&u&&(I+=", flat shading: "+(Q.length/3===u.length?"YES":"NO"))}else I+=", flat shading: UNKNOWN";return I},v.prototype._unBindEffect=function(){w.prototype._unBindEffect.call(this);for(var v=0,I=this.instances;v<I.length;v++){I[v]._unBindEffect()}},Object.defineProperty(v.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),v.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},v.prototype._sortLODLevels=function(){var w=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((function(v,I){return v.distanceOrScreenCoverage<I.distanceOrScreenCoverage?w:v.distanceOrScreenCoverage>I.distanceOrScreenCoverage?-w:0}))},v.prototype.addLODLevel=function(w,v){if(v&&v._masterMesh)return i.e.Warn("You cannot use a mesh as LOD level twice"),this;var I=new h(w,v);return this._internalMeshDataInfo._LODLevels.push(I),v&&(v._masterMesh=this),this._sortLODLevels(),this},v.prototype.getLODLevelAtDistance=function(w){for(var v=this._internalMeshDataInfo,I=0;I<v._LODLevels.length;I++){var P=v._LODLevels[I];if(P.distanceOrScreenCoverage===w)return P.mesh}return null},v.prototype.removeLODLevel=function(w){for(var v=this._internalMeshDataInfo,I=0;I<v._LODLevels.length;I++)v._LODLevels[I].mesh===w&&(v._LODLevels.splice(I,1),w&&(w._masterMesh=null));return this._sortLODLevels(),this},v.prototype.getLOD=function(w,v){var I,P=this._internalMeshDataInfo;if(!P._LODLevels||0===P._LODLevels.length)return this;v?I=v:I=this.getBoundingInfo().boundingSphere;var u=I.centerWorld.subtract(w.globalPosition).length(),Q=u,K=1;if(P._useLODScreenCoverage){var a=w.screenArea,U=I.radiusWorld*w.minZ/u;Q=(U=U*U*Math.PI)/a,K=-1}if(K*P._LODLevels[P._LODLevels.length-1].distanceOrScreenCoverage>K*Q)return this.onLODLevelSelection&&this.onLODLevelSelection(Q,this,this),this;for(var p=0;p<P._LODLevels.length;p++){var r=P._LODLevels[p];if(K*r.distanceOrScreenCoverage<K*Q){if(r.mesh){if(4===r.mesh.delayLoadState)return r.mesh._checkDelayState(),this;if(2===r.mesh.delayLoadState)return this;r.mesh._preActivate(),r.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(Q,this,r.mesh),r.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(Q,this,this),this},Object.defineProperty(v.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),v.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},v.prototype.getVerticesData=function(w,v,I){var P,u;if(!this._geometry)return null;var Q=null===(u=null===(P=this._userInstancedBuffersStorage)||void 0===P?void 0:P.vertexBuffers[w])||void 0===u?void 0:u.getFloatData(this._geometry.getTotalVertices(),I||v&&1!==this._geometry.meshes.length);return Q||(Q=this._geometry.getVerticesData(w,v,I)),Q},v.prototype.getVertexBuffer=function(w){var v,I;return this._geometry?null!==(I=null===(v=this._userInstancedBuffersStorage)||void 0===v?void 0:v.vertexBuffers[w])&&void 0!==I?I:this._geometry.getVertexBuffer(w):null},v.prototype.isVerticesDataPresent=function(w){var v;return this._geometry?void 0!==(null===(v=this._userInstancedBuffersStorage)||void 0===v?void 0:v.vertexBuffers[w])||this._geometry.isVerticesDataPresent(w):!!this._delayInfo&&-1!==this._delayInfo.indexOf(w)},v.prototype.isVertexBufferUpdatable=function(w){var v,I;return this._geometry?(null===(I=null===(v=this._userInstancedBuffersStorage)||void 0===v?void 0:v.vertexBuffers[w])||void 0===I?void 0:I.isUpdatable())||this._geometry.isVertexBufferUpdatable(w):!!this._delayInfo&&-1!==this._delayInfo.indexOf(w)},v.prototype.getVerticesDataKinds=function(){if(!this._geometry){var w=new Array;return this._delayInfo&&this._delayInfo.forEach((function(v){w.push(v)})),w}var v=this._geometry.getVerticesDataKinds();if(this._userInstancedBuffersStorage)for(var I in this._userInstancedBuffersStorage.vertexBuffers)v.push(I);return v},v.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},v.prototype.getIndices=function(w,v){return this._geometry?this._geometry.getIndices(w,v):[]},Object.defineProperty(v.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!1,configurable:!0}),v.prototype.isReady=function(v,I){var P,u,Q,K,a,U;if(void 0===v&&(v=!1),void 0===I&&(I=!1),2===this.delayLoadState)return!1;if(!w.prototype.isReady.call(this,v))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!v)return!0;var p=this.getEngine(),r=this.getScene(),Y=I||p.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var g=this.material||r.defaultMaterial;if(g)if(g._storeEffectOnSubMeshes)for(var J=0,l=this.subMeshes;J<l.length;J++){var R=(z=l[J]).getMaterial();if(R)if(R._storeEffectOnSubMeshes){if(!R.isReadyForSubMesh(this,z,Y))return!1}else if(!R.isReady(this,Y))return!1}else if(!g.isReady(this,Y))return!1;for(var x=p.currentRenderPassId,j=0,s=this.lightSources;j<s.length;j++){var B=s[j].getShadowGenerator();if(B&&(!(null===(P=B.getShadowMap())||void 0===P?void 0:P.renderList)||(null===(u=B.getShadowMap())||void 0===u?void 0:u.renderList)&&-1!==(null===(K=null===(Q=B.getShadowMap())||void 0===Q?void 0:Q.renderList)||void 0===K?void 0:K.indexOf(this)))){B.getShadowMap()&&(p.currentRenderPassId=B.getShadowMap().renderPassId);for(var t=0,i=this.subMeshes;t<i.length;t++){var z=i[t];if(!B.isReady(z,Y,null!==(U=null===(a=z.getMaterial())||void 0===a?void 0:a.needAlphaBlendingForMesh(this))&&void 0!==U&&U))return p.currentRenderPassId=x,!1}p.currentRenderPassId=x}}for(var E=0,o=this._internalMeshDataInfo._LODLevels;E<o.length;E++){var h=o[E];if(h.mesh&&!h.mesh.isReady(Y))return!1}return!0},Object.defineProperty(v.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),v.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},v.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(v.prototype,"overridenInstanceCount",{set:function(w){this._instanceDataStorage.overridenInstanceCount=w},enumerable:!1,configurable:!0}),v.prototype._preActivate=function(){var w=this._internalMeshDataInfo,v=this.getScene().getRenderId();return w._preActivateId===v||(w._preActivateId=v,this._instanceDataStorage.visibleInstances=null),this},v.prototype._preActivateForIntermediateRendering=function(w){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=w),this},v.prototype._registerInstanceForRenderId=function(w,v){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:v,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[v]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=v,this._instanceDataStorage.visibleInstances[v]=new Array),this._instanceDataStorage.visibleInstances[v].push(w),this},v.prototype._afterComputeWorldMatrix=function(){w.prototype._afterComputeWorldMatrix.call(this),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},v.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},v.prototype.refreshBoundingInfo=function(w,v){if(void 0===w&&(w=!1),void 0===v&&(v=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var I=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(w,v),I),this},v.prototype._createGlobalSubMesh=function(w){var v=this.getTotalVertices();if(!v||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var I=this.getIndices();if(!I)return null;var P=I.length,u=!1;if(w)u=!0;else for(var Q=0,K=this.subMeshes;Q<K.length;Q++){var a=K[Q];if(a.indexStart+a.indexCount>P){u=!0;break}if(a.verticesStart+a.verticesCount>v){u=!0;break}}if(!u)return this.subMeshes[0]}return this.releaseSubMeshes(),new x.c(0,0,v,0,this.getTotalIndices(),this)},v.prototype.subdivide=function(w){if(!(w<1)){for(var v=this.getTotalIndices(),I=v/w|0,P=0;I%3!==0;)I++;this.releaseSubMeshes();for(var u=0;u<w&&!(P>=v);u++)x.c.CreateFromIndices(0,P,u===w-1?v-P:I,this),P+=I;this.synchronizeInstances()}},v.prototype.setVerticesData=function(w,v,I,P){if(void 0===I&&(I=!1),this._geometry)this._geometry.setVerticesData(w,v,I,P);else{var u=new J.b;u.set(v,w);var Q=this.getScene();new l.b(l.b.RandomId(),Q,u,I,this)}return this},v.prototype.removeVerticesData=function(w){this._geometry&&this._geometry.removeVerticesData(w)},v.prototype.markVerticesDataAsUpdatable=function(w,v){void 0===v&&(v=!0);var I=this.getVertexBuffer(w);I&&I.isUpdatable()!==v&&this.setVerticesData(w,this.getVerticesData(w),v)},v.prototype.setVerticesBuffer=function(w,v){return void 0===v&&(v=!0),this._geometry||(this._geometry=l.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(w,null,v),this},v.prototype.updateVerticesData=function(w,v,I,P){return this._geometry?(P?(this.makeGeometryUnique(),this.updateVerticesData(w,v,I,!1)):this._geometry.updateVerticesData(w,v,I),this):this},v.prototype.updateMeshPositions=function(w,v){void 0===v&&(v=!0);var I=this.getVerticesData(g.f.PositionKind);if(!I)return this;if(w(I),this.updateVerticesData(g.f.PositionKind,I,!1,!1),v){var P=this.getIndices(),u=this.getVerticesData(g.f.NormalKind);if(!u)return this;J.b.ComputeNormals(I,P,u),this.updateVerticesData(g.f.NormalKind,u,!1,!1)}return this},v.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;var w=this._geometry,v=this._geometry.copy(l.b.RandomId());return w.releaseForMesh(this,!0),v.applyToMesh(this),this},v.prototype.setIndices=function(w,v,I){if(void 0===v&&(v=null),void 0===I&&(I=!1),this._geometry)this._geometry.setIndices(w,v,I);else{var P=new J.b;P.indices=w;var u=this.getScene();new l.b(l.b.RandomId(),u,P,I,this)}return this},v.prototype.updateIndices=function(w,v,I){return void 0===I&&(I=!1),this._geometry?(this._geometry.updateIndices(w,v,I),this):this},v.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},v.prototype._bind=function(w,v,I){if(!this._geometry)return this;var P,u=this.getScene().getEngine();if(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(v),this._unIndexed)P=null;else switch(I){case j.b.PointFillMode:P=null;break;case j.b.WireFrameFillMode:P=w._getLinesIndexBuffer(this.getIndices(),u);break;default:case j.b.TriangleFillMode:P=this._geometry.getIndexBuffer()}return!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(v,P):this._geometry._bind(v,P,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),this},v.prototype._draw=function(w,v,I){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var P=this.getScene().getEngine();return this._unIndexed||v==j.b.PointFillMode?P.drawArraysType(v,w.verticesStart,w.verticesCount,this.forcedInstanceCount||I):v==j.b.WireFrameFillMode?P.drawElementsType(v,0,w._linesIndexCount,this.forcedInstanceCount||I):P.drawElementsType(v,w.indexStart,w.indexCount,this.forcedInstanceCount||I),this},v.prototype.registerBeforeRender=function(w){return this.onBeforeRenderObservable.add(w),this},v.prototype.unregisterBeforeRender=function(w){return this.onBeforeRenderObservable.removeCallback(w),this},v.prototype.registerAfterRender=function(w){return this.onAfterRenderObservable.add(w),this},v.prototype.unregisterAfterRender=function(w){return this.onAfterRenderObservable.removeCallback(w),this},v.prototype._getInstancesRenderList=function(w,v){if(void 0===v&&(v=!1),this._instanceDataStorage.isFrozen){if(v)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[w]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[w]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}var I=this.getScene(),P=I._isInIntermediateRendering(),u=P?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,Q=this._instanceDataStorage.batchCache;if(Q.mustReturn=!1,Q.renderSelf[w]=v||!u&&this.isEnabled()&&this.isVisible,Q.visibleInstances[w]=null,this._instanceDataStorage.visibleInstances&&!v){var K=this._instanceDataStorage.visibleInstances,a=I.getRenderId(),U=P?K.intermediateDefaultRenderId:K.defaultRenderId;Q.visibleInstances[w]=K[a],!Q.visibleInstances[w]&&U&&(Q.visibleInstances[w]=K[U])}return Q.hardwareInstancedRendering[w]=!v&&this._instanceDataStorage.hardwareInstancedRendering&&null!==Q.visibleInstances[w]&&void 0!==Q.visibleInstances[w],this._instanceDataStorage.previousBatch=Q,Q},v.prototype._renderWithInstances=function(w,I,P,u,Q){var K,a=P.visibleInstances[w._id];if(!a)return this;for(var U=this._instanceDataStorage,r=U.instancesBufferSize,Y=U.instancesBuffer,J=U.instancesPreviousBuffer,l=16*(a.length+1)*4;U.instancesBufferSize<l;)U.instancesBufferSize*=2;U.instancesData&&r==U.instancesBufferSize||(U.instancesData=new Float32Array(U.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!U.instancesPreviousData||r!=U.instancesBufferSize)&&(U.instancesPreviousData=new Float32Array(U.instancesBufferSize/4));var R=0,x=0,j=P.renderSelf[w._id],s=!Y||r!==U.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!U.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||U.isFrozen&&!s)x=(j?1:0)+a.length;else{var B=this.getWorldMatrix();if(j&&(this._scene.needsPreviousWorldMatrices&&(U.masterMeshPreviousWorldMatrix?(U.masterMeshPreviousWorldMatrix.copyToArray(U.instancesPreviousData,R),U.masterMeshPreviousWorldMatrix.copyFrom(B)):(U.masterMeshPreviousWorldMatrix=B.clone(),U.masterMeshPreviousWorldMatrix.copyToArray(U.instancesPreviousData,R))),B.copyToArray(U.instancesData,R),R+=16,x++),a){if(v.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&(null===(K=w.getMaterial())||void 0===K?void 0:K.needAlphaBlendingForMesh(w.getRenderingMesh()))){for(var t=this._scene.activeCamera.globalPosition,i=0;i<a.length;i++){var z=a[i];z._distanceToCamera=p.l.Distance(z.getBoundingInfo().boundingSphere.centerWorld,t)}a.sort((function(w,v){return w._distanceToCamera>v._distanceToCamera?-1:w._distanceToCamera<v._distanceToCamera?1:0}))}for(i=0;i<a.length;i++){var E=a[i],o=E.getWorldMatrix();o.copyToArray(U.instancesData,R),this._scene.needsPreviousWorldMatrices&&(E._previousWorldMatrix?(E._previousWorldMatrix.copyToArray(U.instancesPreviousData,R),E._previousWorldMatrix.copyFrom(o)):(E._previousWorldMatrix=o.clone(),E._previousWorldMatrix.copyToArray(U.instancesPreviousData,R))),R+=16,x++}}}return s?(Y&&Y.dispose(),J&&J.dispose(),Y=new g.c(Q,U.instancesData,!0,16,!1,!0),U.instancesBuffer=Y,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=Y.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=Y.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=Y.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=Y.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(J=new g.c(Q,U.instancesPreviousData,!0,16,!1,!0),U.instancesPreviousBuffer=J,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=J.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=J.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=J.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=J.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen||(Y.updateDirectly(U.instancesData,0,x),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||J.updateDirectly(U.instancesPreviousData,0,x)),this._processInstancedBuffers(a,j),this.getScene()._activeIndices.addCount(w.indexCount*x,!1),Q._currentDrawContext&&(Q._currentDrawContext.useInstancing=!0),this._bind(w,u,I),this._draw(w,I,x),!this._scene.needsPreviousWorldMatrices||s||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen||this._instanceDataStorage.previousManualUpdate||J.updateDirectly(U.instancesData,0,x),Q.unbindInstanceAttributes(),this},v.prototype._renderWithThinInstances=function(w,v,I,P){var u,Q,K=null!==(Q=null===(u=this._thinInstanceDataStorage)||void 0===u?void 0:u.instancesCount)&&void 0!==Q?Q:0;this.getScene()._activeIndices.addCount(w.indexCount*K,!1),P._currentDrawContext&&(P._currentDrawContext.useInstancing=!0),this._bind(w,I,v),this._draw(w,v,K),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,K):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),P.unbindInstanceAttributes()},v.prototype._processInstancedBuffers=function(w,v){},v.prototype._processRendering=function(w,v,I,P,u,Q,K,a){var U=this.getScene(),p=U.getEngine();if(Q&&v.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(v,P,I,p),this;if(Q)this._renderWithInstances(v,P,u,I,p);else{p._currentDrawContext&&(p._currentDrawContext.useInstancing=!1);var r=0;u.renderSelf[v._id]&&(K&&K(!1,w.getWorldMatrix(),a),r++,this._draw(v,P,this._instanceDataStorage.overridenInstanceCount));var Y=u.visibleInstances[v._id];if(Y){var g=Y.length;r+=g;for(var J=0;J<g;J++){var l=Y[J].getWorldMatrix();K&&K(!0,l,a),this._draw(v,P)}}U._activeIndices.addCount(v.indexCount*r,!1)}return this},v.prototype._rebuild=function(v){if(void 0===v&&(v=!1),this._instanceDataStorage.instancesBuffer&&(v&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(var I in this._userInstancedBuffersStorage.vertexBuffers){var P=this._userInstancedBuffersStorage.vertexBuffers[I];P&&(v&&P.dispose(),this._userInstancedBuffersStorage.vertexBuffers[I]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,w.prototype._rebuild.call(this,v)},v.prototype._freeze=function(){if(this.subMeshes){for(var w=0;w<this.subMeshes.length;w++)this._getInstancesRenderList(w);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},v.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},v.prototype.render=function(w,v,I){var P,u,Q,K=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;var a=this._getInstancesRenderList(w._id,!!I);if(a.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var U=K.getEngine(),p=0,r=null;this.ignoreCameraMaxZ&&K.activeCamera&&!K._isInIntermediateRendering()&&(p=K.activeCamera.maxZ,r=K.activeCamera,K.activeCamera.maxZ=0,K.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var Y,g=a.hardwareInstancedRendering[w._id]||w.getRenderingMesh().hasThinInstances,J=this._instanceDataStorage,l=w.getMaterial();if(!l)return r&&(r.maxZ=p,K.updateTransformMatrix(!0)),this;if(J.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===l){if(l._storeEffectOnSubMeshes&&!(null===(P=w.effect)||void 0===P?void 0:P._wasPreviouslyReady)||!l._storeEffectOnSubMeshes&&!(null===(u=l.getEffect())||void 0===u?void 0:u._wasPreviouslyReady))return r&&(r.maxZ=p,K.updateTransformMatrix(!0)),this}else{if(l._storeEffectOnSubMeshes){if(!l.isReadyForSubMesh(this,w,g))return r&&(r.maxZ=p,K.updateTransformMatrix(!0)),this}else if(!l.isReady(this,g))return r&&(r.maxZ=p,K.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=l}v&&U.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode);for(var R=null!==(Q=null===(Y=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?w._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper())||void 0===Y?void 0:Y.effect)&&void 0!==Q?Q:null,x=0,s=K._beforeRenderingMeshStage;x<s.length;x++){s[x].action(this,w,a,R)}if(!Y||!R)return r&&(r.maxZ=p,K.updateTransformMatrix(!0)),this;var B,t=I||this;if(J.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this.overrideMaterialSideOrientation)B=J.sideOrientation;else{var i=t._getWorldMatrixDeterminant();null==(B=this.overrideMaterialSideOrientation)&&(B=this._internalMeshDataInfo._effectiveMaterial.sideOrientation),i<0&&(B=B===j.b.ClockWiseSideOrientation?j.b.CounterClockWiseSideOrientation:j.b.ClockWiseSideOrientation),J.sideOrientation=B}var z=this._internalMeshDataInfo._effectiveMaterial._preBind(Y,B);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&U.setDepthWrite(!0);var E=K.forcePointsCloud?j.b.PointFillMode:K.forceWireframe?j.b.WireFrameFillMode:this._internalMeshDataInfo._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),g||this._bind(w,R,E);var o=this._internalMeshDataInfo._effectiveMaterial,h=t.getWorldMatrix();o._storeEffectOnSubMeshes?o.bindForSubMesh(h,this,w):o.bind(h,this),!o.backFaceCulling&&o.separateCullingPass&&(U.setState(!0,o.zOffset,!1,!z,o.cullBackFaces,o.stencil,o.zOffsetUnits),this._processRendering(this,w,R,E,a,g,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),U.setState(!0,o.zOffset,!1,z,o.cullBackFaces,o.stencil,o.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(w)),this._processRendering(this,w,R,E,a,g,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(var n=0,W=K._afterRenderingMeshStage;n<W.length;n++){W[n].action(this,w,a,R)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),r&&(r.maxZ=p,K.updateTransformMatrix(!0)),this},v.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(g.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(g.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())},v.prototype._normalizeSkinFourWeights=function(){for(var w=this.getVerticesData(g.f.MatricesWeightsKind),v=w.length,I=0;I<v;I+=4){var P=w[I]+w[I+1]+w[I+2]+w[I+3];if(0===P)w[I]=1;else{var u=1/P;w[I]*=u,w[I+1]*=u,w[I+2]*=u,w[I+3]*=u}}this.setVerticesData(g.f.MatricesWeightsKind,w)},v.prototype._normalizeSkinWeightsAndExtra=function(){for(var w=this.getVerticesData(g.f.MatricesWeightsExtraKind),v=this.getVerticesData(g.f.MatricesWeightsKind),I=v.length,P=0;P<I;P+=4){var u=v[P]+v[P+1]+v[P+2]+v[P+3];if(0===(u+=w[P]+w[P+1]+w[P+2]+w[P+3]))v[P]=1;else{var Q=1/u;v[P]*=Q,v[P+1]*=Q,v[P+2]*=Q,v[P+3]*=Q,w[P]*=Q,w[P+1]*=Q,w[P+2]*=Q,w[P+3]*=Q}}this.setVerticesData(g.f.MatricesWeightsKind,v),this.setVerticesData(g.f.MatricesWeightsKind,w)},v.prototype.validateSkinning=function(){var w=this.getVerticesData(g.f.MatricesWeightsExtraKind),v=this.getVerticesData(g.f.MatricesWeightsKind);if(null===v||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var I=v.length,P=0,u=0,Q=0,K=0,a=null===w?4:8,U=new Array,p=0;p<=a;p++)U[p]=0;for(p=0;p<I;p+=4){for(var r=v[p],Y=r,J=0===Y?0:1,l=1;l<a;l++){var R=l<4?v[p+l]:w[p+l-4];R>r&&P++,0!==R&&J++,Y+=R,r=R}if(U[J]++,J>Q&&(Q=J),0===Y)u++;else{var x=1/Y,j=0;for(l=0;l<a;l++)j+=l<4?Math.abs(v[p+l]-v[p+l]*x):Math.abs(w[p+l-4]-w[p+l-4]*x);j>.001&&K++}}var s=this.skeleton.bones.length,B=this.getVerticesData(g.f.MatricesIndicesKind),t=this.getVerticesData(g.f.MatricesIndicesExtraKind),i=0;for(p=0;p<I;p+=4)for(l=0;l<a;l++){var z=l<4?B[p+l]:t[p+l-4];(z>=s||z<0)&&i++}return{skinned:!0,valid:0===u&&0===K&&0===i,report:"Number of Weights = "+I/4+"\nMaximum influences = "+Q+"\nMissing Weights = "+u+"\nNot Sorted = "+P+"\nNot Normalized = "+K+"\nWeightCounts = ["+U+"]\nNumber of bones = "+s+"\nBad Bone Indices = "+i}},v.prototype._checkDelayState=function(){var w=this.getScene();return this._geometry?this._geometry.load(w):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(w)),this},v.prototype._queueLoad=function(w){var v=this;w._addPendingData(this);var I=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return Q.i.LoadFile(this.delayLoadingFile,(function(I){I instanceof ArrayBuffer?v._delayLoadingFunction(I,v):v._delayLoadingFunction(JSON.parse(I),v),v.instances.forEach((function(w){w.refreshBoundingInfo(),w._syncSubMeshes()})),v.delayLoadState=1,w._removePendingData(v)}),(function(){}),w.offlineProvider,I),this},v.prototype.isInFrustum=function(v){return 2!==this.delayLoadState&&(!!w.prototype.isInFrustum.call(this,v)&&(this._checkDelayState(),!0))},v.prototype.setMaterialById=function(w){var v,I=this.getScene().materials;for(v=I.length-1;v>-1;v--)if(I[v].id===w)return this.material=I[v],this;var P=this.getScene().multiMaterials;for(v=P.length-1;v>-1;v--)if(P[v].id===w)return this.material=P[v],this;return this},v.prototype.getAnimatables=function(){var w=new Array;return this.material&&w.push(this.material),this.skeleton&&w.push(this.skeleton),w},v.prototype.bakeTransformIntoVertices=function(w){if(!this.isVerticesDataPresent(g.f.PositionKind))return this;var v=this.subMeshes.splice(0);this._resetPointsArrayCache();var I,P=this.getVerticesData(g.f.PositionKind),u=new Array;for(I=0;I<P.length;I+=3)p.l.TransformCoordinates(p.l.FromArray(P,I),w).toArray(u,I);if(this.setVerticesData(g.f.PositionKind,u,this.getVertexBuffer(g.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(g.f.NormalKind)){for(P=this.getVerticesData(g.f.NormalKind),u=[],I=0;I<P.length;I+=3)p.l.TransformNormal(p.l.FromArray(P,I),w).normalize().toArray(u,I);this.setVerticesData(g.f.NormalKind,u,this.getVertexBuffer(g.f.NormalKind).isUpdatable())}return w.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=v,this},v.prototype.bakeCurrentTransformIntoVertices=function(w){return void 0===w&&(w=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(w),this},Object.defineProperty(v.prototype,"_positions",{get:function(){return this._internalAbstractMeshDataInfo._positions?this._internalAbstractMeshDataInfo._positions:this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),v.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},v.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},v.prototype.clone=function(w,I,P,u){return void 0===w&&(w=""),void 0===I&&(I=null),void 0===u&&(u=!0),new v(w,this.getScene(),I,this,P,u)},v.prototype.dispose=function(v,I){void 0===I&&(I=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var P=this._internalMeshDataInfo;if(P._onBeforeDrawObservable&&P._onBeforeDrawObservable.clear(),P._onBeforeBindObservable&&P._onBeforeBindObservable.clear(),P._onBeforeRenderObservable&&P._onBeforeRenderObservable.clear(),P._onAfterRenderObservable&&P._onAfterRenderObservable.clear(),P._onBetweenPassObservable&&P._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(P.meshMap)for(var u in P.meshMap){(a=P.meshMap[u])&&(a._internalMeshDataInfo._source=null,P.meshMap[u]=void 0)}P._source&&P._source._internalMeshDataInfo.meshMap&&(P._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var Q=0,K=this.getScene().meshes;Q<K.length;Q++){var a;(a=K[Q])._internalMeshDataInfo&&a._internalMeshDataInfo._source&&a._internalMeshDataInfo._source===this&&(a._internalMeshDataInfo._source=null)}P._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),w.prototype.dispose.call(this,v,I)},v.prototype._disposeInstanceSpecificData=function(){},v.prototype._disposeThinInstanceSpecificData=function(){},v.prototype._invalidateInstanceVertexArrayObject=function(){},v.prototype.applyDisplacementMap=function(w,v,I,P,u,K,a){var U=this;void 0===a&&(a=!1);var p=this.getScene();return Q.i.LoadImage(w,(function(w){var Q=w.width,p=w.height,r=U.getEngine().createCanvas(Q,p).getContext("2d");r.drawImage(w,0,0);var Y=r.getImageData(0,0,Q,p).data;U.applyDisplacementMapFromBuffer(Y,Q,p,v,I,u,K,a),P&&P(U)}),(function(){}),p.offlineProvider),this},v.prototype.applyDisplacementMapFromBuffer=function(w,v,I,P,u,Q,K,a){if(void 0===a&&(a=!1),!this.isVerticesDataPresent(g.f.PositionKind)||!this.isVerticesDataPresent(g.f.NormalKind)||!this.isVerticesDataPresent(g.f.UVKind))return i.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var U=this.getVerticesData(g.f.PositionKind,!0,!0),r=this.getVerticesData(g.f.NormalKind),Y=this.getVerticesData(g.f.UVKind),l=p.l.Zero(),R=p.l.Zero(),x=p.k.Zero();Q=Q||p.k.Zero(),K=K||new p.k(1,1);for(var j=0;j<U.length;j+=3){p.l.FromArrayToRef(U,j,l),p.l.FromArrayToRef(r,j,R),p.k.FromArrayToRef(Y,j/3*2,x);var s=4*((Math.abs(x.x*K.x+Q.x%1)*(v-1)%v|0)+(Math.abs(x.y*K.y+Q.y%1)*(I-1)%I|0)*v),B=.3*(w[s]/255)+.59*(w[s+1]/255)+.11*(w[s+2]/255);R.normalize(),R.scaleInPlace(P+(u-P)*B),(l=l.add(R)).toArray(U,j)}return J.b.ComputeNormals(U,this.getIndices(),r),a?(this.setVerticesData(g.f.PositionKind,U),this.setVerticesData(g.f.NormalKind,r),this.setVerticesData(g.f.UVKind,Y)):(this.updateVerticesData(g.f.PositionKind,U),this.updateVerticesData(g.f.NormalKind,r)),this},v.prototype.convertToFlatShadedMesh=function(){var w,v,I=this.getVerticesDataKinds(),P={},u={},Q={},K=!1;for(w=0;w<I.length;w++){v=I[w];var a=this.getVertexBuffer(v),U=a.getData();(U instanceof Array||U instanceof Float32Array)&&0===U.length||(v!==g.f.NormalKind?(P[v]=a,u[v]=this.getVerticesData(v),Q[v]=[]):(K=a.isUpdatable(),I.splice(w,1),w--))}var r,Y=this.subMeshes.slice(0),J=this.getIndices(),l=this.getTotalIndices();for(r=0;r<l;r++){var R=J[r];for(w=0;w<I.length;w++)if(P[v=I[w]])for(var j=P[v].getStrideSize(),s=0;s<j;s++)Q[v].push(u[v][R*j+s])}var B,t=[],i=Q[g.f.PositionKind];for(B=this.getScene().useRightHandedSystem?1===this.overrideMaterialSideOrientation:0===this.overrideMaterialSideOrientation,r=0;r<l;r+=3){J[r]=r,J[r+1]=r+1,J[r+2]=r+2;var z=p.l.FromArray(i,3*r),E=p.l.FromArray(i,3*(r+1)),o=p.l.FromArray(i,3*(r+2)),h=z.subtract(E),n=o.subtract(E),W=p.l.Normalize(p.l.Cross(h,n));B&&W.scaleInPlace(-1);for(var V=0;V<3;V++)t.push(W.x),t.push(W.y),t.push(W.z)}for(this.setIndices(J),this.setVerticesData(g.f.NormalKind,t,K),w=0;w<I.length;w++)Q[v=I[w]]&&this.setVerticesData(v,Q[v],P[v].isUpdatable());this.releaseSubMeshes();for(var F=0;F<Y.length;F++){var O=Y[F];x.c.AddToMesh(O.materialIndex,O.indexStart,O.indexCount,O.indexStart,O.indexCount,this)}return this.synchronizeInstances(),this},v.prototype.convertToUnIndexedMesh=function(){var w,v,I=this.getVerticesDataKinds(),P={},u={},Q={};for(w=0;w<I.length;w++){v=I[w];var K=this.getVertexBuffer(v);P[v]=K,u[v]=P[v].getData(),Q[v]=[]}var a,U=this.subMeshes.slice(0),p=this.getIndices(),r=this.getTotalIndices();for(a=0;a<r;a++){var Y=p[a];for(w=0;w<I.length;w++)for(var g=P[v=I[w]].getStrideSize(),J=0;J<g;J++)Q[v].push(u[v][Y*g+J])}for(a=0;a<r;a+=3)p[a]=a,p[a+1]=a+1,p[a+2]=a+2;for(this.setIndices(p),w=0;w<I.length;w++)v=I[w],this.setVerticesData(v,Q[v],P[v].isUpdatable(),P[v].getStrideSize());this.releaseSubMeshes();for(var l=0;l<U.length;l++){var R=U[l];x.c.AddToMesh(R.materialIndex,R.indexStart,R.indexCount,R.indexStart,R.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},v.prototype.flipFaces=function(w){void 0===w&&(w=!1);var v,I=J.b.ExtractFromMesh(this);if(w&&this.isVerticesDataPresent(g.f.NormalKind)&&I.normals)for(v=0;v<I.normals.length;v++)I.normals[v]*=-1;if(I.indices){var P=void 0;for(v=0;v<I.indices.length;v+=3)P=I.indices[v+1],I.indices[v+1]=I.indices[v+2],I.indices[v+2]=P}return I.applyToMesh(this,this.isVertexBufferUpdatable(g.f.PositionKind)),this},v.prototype.increaseVertices=function(w){void 0===w&&(w=1);var v=J.b.ExtractFromMesh(this),I=v.indices&&!Array.isArray(v.indices)&&Array.from?Array.from(v.indices):v.indices,P=v.positions&&!Array.isArray(v.positions)&&Array.from?Array.from(v.positions):v.positions,u=v.uvs&&!Array.isArray(v.uvs)&&Array.from?Array.from(v.uvs):v.uvs,Q=v.normals&&!Array.isArray(v.normals)&&Array.from?Array.from(v.normals):v.normals;if(I&&P){v.indices=I,v.positions=P,u&&(v.uvs=u),Q&&(v.normals=Q);for(var K=w+1,a=new Array,U=0;U<K+1;U++)a[U]=new Array;var r=void 0,Y=void 0,l=new p.l(0,0,0),R=new p.l(0,0,0),x=new p.k(0,0),j=new Array,s=new Array,B=new Array,t=void 0,z=P.length,E=void 0;u&&(E=u.length);var o=void 0;Q&&(o=Q.length);for(U=0;U<I.length;U+=3){s[0]=I[U],s[1]=I[U+1],s[2]=I[U+2];for(var h=0;h<3;h++)if(r=s[h],Y=s[(h+1)%3],void 0===B[r]&&void 0===B[Y]?(B[r]=new Array,B[Y]=new Array):(void 0===B[r]&&(B[r]=new Array),void 0===B[Y]&&(B[Y]=new Array)),void 0===B[r][Y]&&void 0===B[Y][r]){B[r][Y]=[],l.x=(P[3*Y]-P[3*r])/K,l.y=(P[3*Y+1]-P[3*r+1])/K,l.z=(P[3*Y+2]-P[3*r+2])/K,Q&&(R.x=(Q[3*Y]-Q[3*r])/K,R.y=(Q[3*Y+1]-Q[3*r+1])/K,R.z=(Q[3*Y+2]-Q[3*r+2])/K),u&&(x.x=(u[2*Y]-u[2*r])/K,x.y=(u[2*Y+1]-u[2*r+1])/K),B[r][Y].push(r);for(var n=1;n<K;n++)B[r][Y].push(P.length/3),P[z++]=P[3*r]+n*l.x,P[z++]=P[3*r+1]+n*l.y,P[z++]=P[3*r+2]+n*l.z,Q&&(Q[o++]=Q[3*r]+n*R.x,Q[o++]=Q[3*r+1]+n*R.y,Q[o++]=Q[3*r+2]+n*R.z),u&&(u[E++]=u[2*r]+n*x.x,u[E++]=u[2*r+1]+n*x.y);B[r][Y].push(Y),B[Y][r]=new Array,t=B[r][Y].length;for(var W=0;W<t;W++)B[Y][r][W]=B[r][Y][t-1-W]}a[0][0]=I[U],a[1][0]=B[I[U]][I[U+1]][1],a[1][1]=B[I[U]][I[U+2]][1];for(n=2;n<K;n++){a[n][0]=B[I[U]][I[U+1]][n],a[n][n]=B[I[U]][I[U+2]][n],l.x=(P[3*a[n][n]]-P[3*a[n][0]])/n,l.y=(P[3*a[n][n]+1]-P[3*a[n][0]+1])/n,l.z=(P[3*a[n][n]+2]-P[3*a[n][0]+2])/n,Q&&(R.x=(Q[3*a[n][n]]-Q[3*a[n][0]])/n,R.y=(Q[3*a[n][n]+1]-Q[3*a[n][0]+1])/n,R.z=(Q[3*a[n][n]+2]-Q[3*a[n][0]+2])/n),u&&(x.x=(u[2*a[n][n]]-u[2*a[n][0]])/n,x.y=(u[2*a[n][n]+1]-u[2*a[n][0]+1])/n);for(h=1;h<n;h++)a[n][h]=P.length/3,P[z++]=P[3*a[n][0]]+h*l.x,P[z++]=P[3*a[n][0]+1]+h*l.y,P[z++]=P[3*a[n][0]+2]+h*l.z,Q&&(Q[o++]=Q[3*a[n][0]]+h*R.x,Q[o++]=Q[3*a[n][0]+1]+h*R.y,Q[o++]=Q[3*a[n][0]+2]+h*R.z),u&&(u[E++]=u[2*a[n][0]]+h*x.x,u[E++]=u[2*a[n][0]+1]+h*x.y)}a[K]=B[I[U+1]][I[U+2]],j.push(a[0][0],a[1][0],a[1][1]);for(n=1;n<K;n++){h=void 0;for(h=0;h<n;h++)j.push(a[n][h],a[n+1][h],a[n+1][h+1]),j.push(a[n][h],a[n+1][h+1],a[n][h+1]);j.push(a[n][h],a[n+1][h],a[n+1][h+1])}}v.indices=j,v.applyToMesh(this,this.isVertexBufferUpdatable(g.f.PositionKind))}else i.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")},v.prototype.forceSharedVertices=function(){var w=J.b.ExtractFromMesh(this),v=w.uvs,I=w.indices,P=w.positions,u=w.colors;if(void 0===I||void 0===P||null===I||null===P)i.e.Warn("VertexData contains empty entries");else{for(var Q=new Array,K=new Array,a=new Array,U=new Array,p=new Array,r=0,Y={},l=void 0,R=void 0,x=0;x<I.length;x+=3){R=[I[x],I[x+1],I[x+2]],p=new Array;for(var j=0;j<3;j++){p[j]="";for(var s=0;s<3;s++)Math.abs(P[3*R[j]+s])<1e-8&&(P[3*R[j]+s]=0),p[j]+=P[3*R[j]+s]+"|"}if(p[0]!=p[1]&&p[0]!=p[2]&&p[1]!=p[2])for(j=0;j<3;j++){if(void 0===(l=Y[p[j]])){Y[p[j]]=r,l=r++;for(s=0;s<3;s++)Q.push(P[3*R[j]+s]);if(null!==u&&void 0!==u)for(s=0;s<4;s++)U.push(u[4*R[j]+s]);if(null!==v&&void 0!==v)for(s=0;s<2;s++)a.push(v[2*R[j]+s])}K.push(l)}}var B=new Array;J.b.ComputeNormals(Q,K,B),w.positions=Q,w.indices=K,w.normals=B,null!==v&&void 0!==v&&(w.uvs=a),null!==u&&void 0!==u&&(w.colors=U),w.applyToMesh(this,this.isVertexBufferUpdatable(g.f.PositionKind))}},v._instancedMeshFactory=function(w,v){throw(0,E.e)("InstancedMesh")},v._PhysicsImpostorParser=function(w,v,I){throw(0,E.e)("PhysicsImpostor")},v.prototype.createInstance=function(w){return v._instancedMeshFactory(w,this)},v.prototype.synchronizeInstances=function(){for(var w=0;w<this.instances.length;w++){this.instances[w]._syncSubMeshes()}return this},v.prototype.optimizeIndices=function(w){var v=this,I=this.getIndices(),P=this.getVerticesData(g.f.PositionKind);if(!P||!I)return this;for(var u=new Array,K=0;K<P.length;K+=3)u.push(p.l.FromArray(P,K));var a=new Array;return Q.e.SyncAsyncForLoop(u.length,40,(function(w){for(var v=u.length-1-w,I=u[v],P=0;P<v;++P){var Q=u[P];if(I.equals(Q)){a[v]=P;break}}}),(function(){for(var P=0;P<I.length;++P)I[P]=a[I[P]]||I[P];var u=v.subMeshes.slice(0);v.setIndices(I),v.subMeshes=u,w&&w(v)})),this},v.prototype.serialize=function(w){w.name=this.name,w.id=this.id,w.uniqueId=this.uniqueId,w.type=this.getClassName(),a.c&&a.c.HasTags(this)&&(w.tags=a.c.GetTags(this)),w.position=this.position.asArray(),this.rotationQuaternion?w.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(w.rotation=this.rotation.asArray()),w.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?w.pivotMatrix=this.getPivotMatrix().asArray():w.localMatrix=this.getPivotMatrix().asArray(),w.isEnabled=this.isEnabled(!1),w.isVisible=this.isVisible,w.infiniteDistance=this.infiniteDistance,w.pickable=this.isPickable,w.receiveShadows=this.receiveShadows,w.billboardMode=this.billboardMode,w.visibility=this.visibility,w.checkCollisions=this.checkCollisions,w.isBlocker=this.isBlocker,w.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&this.parent._serializeAsParent(w),w.isUnIndexed=this.isUnIndexed;var v=this._geometry;if(v&&this.subMeshes){w.geometryUniqueId=v.uniqueId,w.geometryId=v.id,w.subMeshes=[];for(var I=0;I<this.subMeshes.length;I++){var P=this.subMeshes[I];w.subMeshes.push({materialIndex:P.materialIndex,verticesStart:P.verticesStart,verticesCount:P.verticesCount,indexStart:P.indexStart,indexCount:P.indexCount})}}(this.material?this.material.doNotSerialize||(w.materialUniqueId=this.material.uniqueId,w.materialId=this.material.id):(this.material=null,w.materialUniqueId=this._scene.defaultMaterial.uniqueId,w.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(w.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(w.skeletonId=this.skeleton.id,w.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(o.c.NAME_PHYSICSENGINE))&&((K=this.getPhysicsImpostor())&&(w.physicsMass=K.getParam("mass"),w.physicsFriction=K.getParam("friction"),w.physicsRestitution=K.getParam("mass"),w.physicsImpostor=K.type));this.metadata&&(w.metadata=this.metadata),w.instances=[];for(var u=0;u<this.instances.length;u++){var Q=this.instances[u];if(!Q.doNotSerialize){var K,U={name:Q.name,id:Q.id,isEnabled:Q.isEnabled(!1),isVisible:Q.isVisible,isPickable:Q.isPickable,checkCollisions:Q.checkCollisions,position:Q.position.asArray(),scaling:Q.scaling.asArray()};if(Q.parent&&Q.parent._serializeAsParent(U),Q.rotationQuaternion?U.rotationQuaternion=Q.rotationQuaternion.asArray():Q.rotation&&(U.rotation=Q.rotation.asArray()),this.getScene()._getComponent(o.c.NAME_PHYSICSENGINE))(K=Q.getPhysicsImpostor())&&(U.physicsMass=K.getParam("mass"),U.physicsFriction=K.getParam("friction"),U.physicsRestitution=K.getParam("mass"),U.physicsImpostor=K.type);Q.metadata&&(U.metadata=Q.metadata),w.instances.push(U),t.e.AppendSerializedAnimations(Q,U),U.ranges=Q.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(w.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){var p={data:{},sizes:{},strides:{}};for(var r in this._userThinInstanceBuffersStorage.data)p.data[r]=Array.from(this._userThinInstanceBuffersStorage.data[r]),p.sizes[r]=this._userThinInstanceBuffersStorage.sizes[r],p.strides[r]=this._userThinInstanceBuffersStorage.strides[r];w.thinInstances.userThinInstance=p}t.e.AppendSerializedAnimations(this,w),w.ranges=this.serializeAnimationRanges(),w.layerMask=this.layerMask,w.alphaIndex=this.alphaIndex,w.hasVertexAlpha=this.hasVertexAlpha,w.overlayAlpha=this.overlayAlpha,w.overlayColor=this.overlayColor.asArray(),w.renderOverlay=this.renderOverlay,w.applyFog=this.applyFog,this.actionManager&&(w.actions=this.actionManager.serialize(this.name))},v.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var w=this._internalAbstractMeshDataInfo._morphTargetManager;if(w&&w.vertexCount){if(w.vertexCount!==this.getTotalVertices())return i.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(w.isUsingTextureForTargets)return;for(var v=0;v<w.numInfluencers;v++){var I=w.getActiveTarget(v),P=I.getPositions();if(!P)return void i.e.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(g.f.PositionKind+v,P,!1,3);var u=I.getNormals();u&&this.geometry.setVerticesData(g.f.NormalKind+v,u,!1,3);var Q=I.getTangents();Q&&this.geometry.setVerticesData(g.f.TangentKind+v,Q,!1,3);var K=I.getUVs();K&&this.geometry.setVerticesData(g.f.UVKind+"_"+v,K,!1,2)}}else for(v=0;this.geometry.isVerticesDataPresent(g.f.PositionKind+v);)this.geometry.removeVerticesData(g.f.PositionKind+v),this.geometry.isVerticesDataPresent(g.f.NormalKind+v)&&this.geometry.removeVerticesData(g.f.NormalKind+v),this.geometry.isVerticesDataPresent(g.f.TangentKind+v)&&this.geometry.removeVerticesData(g.f.TangentKind+v),this.geometry.isVerticesDataPresent(g.f.UVKind+v)&&this.geometry.removeVerticesData(g.f.UVKind+"_"+v),v++}},v.Parse=function(w,I,P){var u;if((u=w.type&&"LinesMesh"===w.type?v._LinesMeshParser(w,I):w.type&&"GroundMesh"===w.type?v._GroundMeshParser(w,I):w.type&&"GoldbergMesh"===w.type?v._GoldbergMeshParser(w,I):new v(w.name,I)).id=w.id,a.c&&a.c.AddTagsTo(u,w.tags),u.position=p.l.FromArray(w.position),void 0!==w.metadata&&(u.metadata=w.metadata),w.rotationQuaternion?u.rotationQuaternion=p.f.FromArray(w.rotationQuaternion):w.rotation&&(u.rotation=p.l.FromArray(w.rotation)),u.scaling=p.l.FromArray(w.scaling),w.localMatrix?u.setPreTransformMatrix(p.e.FromArray(w.localMatrix)):w.pivotMatrix&&u.setPivotMatrix(p.e.FromArray(w.pivotMatrix)),u.setEnabled(w.isEnabled),u.isVisible=w.isVisible,u.infiniteDistance=w.infiniteDistance,u.showBoundingBox=w.showBoundingBox,u.showSubMeshesBoundingBox=w.showSubMeshesBoundingBox,void 0!==w.applyFog&&(u.applyFog=w.applyFog),void 0!==w.pickable&&(u.isPickable=w.pickable),void 0!==w.alphaIndex&&(u.alphaIndex=w.alphaIndex),u.receiveShadows=w.receiveShadows,u.billboardMode=w.billboardMode,void 0!==w.visibility&&(u.visibility=w.visibility),u.checkCollisions=w.checkCollisions,u.overrideMaterialSideOrientation=w.overrideMaterialSideOrientation,void 0!==w.isBlocker&&(u.isBlocker=w.isBlocker),u._shouldGenerateFlatShading=w.useFlatShading,w.freezeWorldMatrix&&(u._waitingData.freezeWorldMatrix=w.freezeWorldMatrix),void 0!==w.parentId&&(u._waitingParentId=w.parentId),void 0!==w.parentInstanceIndex&&(u._waitingParentInstanceIndex=w.parentInstanceIndex),void 0!==w.actions&&(u._waitingData.actions=w.actions),void 0!==w.overlayAlpha&&(u.overlayAlpha=w.overlayAlpha),void 0!==w.overlayColor&&(u.overlayColor=r.b.FromArray(w.overlayColor)),void 0!==w.renderOverlay&&(u.renderOverlay=w.renderOverlay),u.isUnIndexed=!!w.isUnIndexed,u.hasVertexAlpha=w.hasVertexAlpha,w.delayLoadingFile?(u.delayLoadState=4,u.delayLoadingFile=P+w.delayLoadingFile,u.buildBoundingInfo(p.l.FromArray(w.boundingBoxMinimum),p.l.FromArray(w.boundingBoxMaximum)),w._binaryInfo&&(u._binaryInfo=w._binaryInfo),u._delayInfo=[],w.hasUVs&&u._delayInfo.push(g.f.UVKind),w.hasUVs2&&u._delayInfo.push(g.f.UV2Kind),w.hasUVs3&&u._delayInfo.push(g.f.UV3Kind),w.hasUVs4&&u._delayInfo.push(g.f.UV4Kind),w.hasUVs5&&u._delayInfo.push(g.f.UV5Kind),w.hasUVs6&&u._delayInfo.push(g.f.UV6Kind),w.hasColors&&u._delayInfo.push(g.f.ColorKind),w.hasMatricesIndices&&u._delayInfo.push(g.f.MatricesIndicesKind),w.hasMatricesWeights&&u._delayInfo.push(g.f.MatricesWeightsKind),u._delayLoadingFunction=l.b._ImportGeometry,B.c.ForceFullSceneLoadingForIncremental&&u._checkDelayState()):l.b._ImportGeometry(w,u),w.materialUniqueId?u._waitingMaterialId=w.materialUniqueId:w.materialId&&(u._waitingMaterialId=w.materialId),w.morphTargetManagerId>-1&&(u.morphTargetManager=I.getMorphTargetManagerById(w.morphTargetManagerId)),void 0!==w.skeletonId&&null!==w.skeletonId&&(u.skeleton=I.getLastSkeletonById(w.skeletonId),w.numBoneInfluencers&&(u.numBoneInfluencers=w.numBoneInfluencers)),w.animations){for(var Q=0;Q<w.animations.length;Q++){var K=w.animations[Q];(x=(0,z.c)("BABYLON.Animation"))&&u.animations.push(x.Parse(K))}Y.b.ParseAnimationRanges(u,w,I)}if(w.autoAnimate&&I.beginAnimation(u,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),w.layerMask&&!isNaN(w.layerMask)?u.layerMask=Math.abs(parseInt(w.layerMask)):u.layerMask=268435455,w.physicsImpostor&&v._PhysicsImpostorParser(I,u,w),w.lodMeshIds&&(u._waitingData.lods={ids:w.lodMeshIds,distances:w.lodDistances?w.lodDistances:null,coverages:w.lodCoverages?w.lodCoverages:null}),w.instances)for(var U=0;U<w.instances.length;U++){var J=w.instances[U],R=u.createInstance(J.name);if(J.id&&(R.id=J.id),a.c&&(J.tags?a.c.AddTagsTo(R,J.tags):a.c.AddTagsTo(R,w.tags)),R.position=p.l.FromArray(J.position),void 0!==J.metadata&&(R.metadata=J.metadata),void 0!==J.parentId&&(R._waitingParentId=J.parentId),void 0!==J.parentInstanceIndex&&(R._waitingParentInstanceIndex=J.parentInstanceIndex),void 0!==J.isEnabled&&null!==J.isEnabled&&R.setEnabled(J.isEnabled),void 0!==J.isVisible&&null!==J.isVisible&&(R.isVisible=J.isVisible),void 0!==J.isPickable&&null!==J.isPickable&&(R.isPickable=J.isPickable),J.rotationQuaternion?R.rotationQuaternion=p.f.FromArray(J.rotationQuaternion):J.rotation&&(R.rotation=p.l.FromArray(J.rotation)),R.scaling=p.l.FromArray(J.scaling),void 0!=J.checkCollisions&&null!=J.checkCollisions&&(R.checkCollisions=J.checkCollisions),void 0!=J.pickable&&null!=J.pickable&&(R.isPickable=J.pickable),void 0!=J.showBoundingBox&&null!=J.showBoundingBox&&(R.showBoundingBox=J.showBoundingBox),void 0!=J.showSubMeshesBoundingBox&&null!=J.showSubMeshesBoundingBox&&(R.showSubMeshesBoundingBox=J.showSubMeshesBoundingBox),void 0!=J.alphaIndex&&null!=J.showSubMeshesBoundingBox&&(R.alphaIndex=J.alphaIndex),J.physicsImpostor&&v._PhysicsImpostorParser(I,R,J),J.animations){for(Q=0;Q<J.animations.length;Q++){var x;K=J.animations[Q];(x=(0,z.c)("BABYLON.Animation"))&&R.animations.push(x.Parse(K))}Y.b.ParseAnimationRanges(R,J,I),J.autoAnimate&&I.beginAnimation(R,J.autoAnimateFrom,J.autoAnimateTo,J.autoAnimateLoop,J.autoAnimateSpeed||1)}}if(w.thinInstances){var j=w.thinInstances;if(u.thinInstanceEnablePicking=!!j.enablePicking,j.matrixData?(u.thinInstanceSetBuffer("matrix",new Float32Array(j.matrixData),16,!1),u._thinInstanceDataStorage.matrixBufferSize=j.matrixBufferSize,u._thinInstanceDataStorage.instancesCount=j.instancesCount):u._thinInstanceDataStorage.matrixBufferSize=j.matrixBufferSize,w.thinInstances.userThinInstance){var s=w.thinInstances.userThinInstance;for(var t in s.data)u.thinInstanceSetBuffer(t,new Float32Array(s.data[t]),s.strides[t],!1),u._userThinInstanceBuffersStorage.sizes[t]=s.sizes[t]}}return u},v.prototype.setPositionsForCPUSkinning=function(){var w=this._internalMeshDataInfo;if(!w._sourcePositions){var v=this.getVerticesData(g.f.PositionKind);if(!v)return w._sourcePositions;w._sourcePositions=new Float32Array(v),this.isVertexBufferUpdatable(g.f.PositionKind)||this.setVerticesData(g.f.PositionKind,v,!0)}return w._sourcePositions},v.prototype.setNormalsForCPUSkinning=function(){var w=this._internalMeshDataInfo;if(!w._sourceNormals){var v=this.getVerticesData(g.f.NormalKind);if(!v)return w._sourceNormals;w._sourceNormals=new Float32Array(v),this.isVertexBufferUpdatable(g.f.NormalKind)||this.setVerticesData(g.f.NormalKind,v,!0)}return w._sourceNormals},v.prototype.applySkeleton=function(w){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(g.f.PositionKind))return this;if(!this.isVerticesDataPresent(g.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(g.f.MatricesWeightsKind))return this;var v=this.isVerticesDataPresent(g.f.NormalKind),I=this._internalMeshDataInfo;if(!I._sourcePositions){var P=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=P}v&&!I._sourceNormals&&this.setNormalsForCPUSkinning();var u=this.getVerticesData(g.f.PositionKind);if(!u)return this;u instanceof Float32Array||(u=new Float32Array(u));var Q=this.getVerticesData(g.f.NormalKind);if(v){if(!Q)return this;Q instanceof Float32Array||(Q=new Float32Array(Q))}var K=this.getVerticesData(g.f.MatricesIndicesKind),a=this.getVerticesData(g.f.MatricesWeightsKind);if(!a||!K)return this;for(var U,r=this.numBoneInfluencers>4,Y=r?this.getVerticesData(g.f.MatricesIndicesExtraKind):null,J=r?this.getVerticesData(g.f.MatricesWeightsExtraKind):null,l=w.getTransformMatrices(this),R=p.l.Zero(),x=new p.e,j=new p.e,s=0,B=0;B<u.length;B+=3,s+=4){var t=void 0;for(U=0;U<4;U++)(t=a[s+U])>0&&(p.e.FromFloat32ArrayToRefScaled(l,Math.floor(16*K[s+U]),t,j),x.addToSelf(j));if(r)for(U=0;U<4;U++)(t=J[s+U])>0&&(p.e.FromFloat32ArrayToRefScaled(l,Math.floor(16*Y[s+U]),t,j),x.addToSelf(j));p.l.TransformCoordinatesFromFloatsToRef(I._sourcePositions[B],I._sourcePositions[B+1],I._sourcePositions[B+2],x,R),R.toArray(u,B),v&&(p.l.TransformNormalFromFloatsToRef(I._sourceNormals[B],I._sourceNormals[B+1],I._sourceNormals[B+2],x,R),R.toArray(Q,B)),x.reset()}return this.updateVerticesData(g.f.PositionKind,u),v&&this.updateVerticesData(g.f.NormalKind,Q),this},v.MinMax=function(w){var v=null,I=null;return w.forEach((function(w){var P=w.getBoundingInfo().boundingBox;v&&I?(v.minimizeInPlace(P.minimumWorld),I.maximizeInPlace(P.maximumWorld)):(v=P.minimumWorld,I=P.maximumWorld)})),v&&I?{min:v,max:I}:{min:p.l.Zero(),max:p.l.Zero()}},v.Center=function(w){var I=w instanceof Array?v.MinMax(w):w;return p.l.Center(I.min,I.max)},v.MergeMeshes=function(w,I,P,u,Q,K){return void 0===I&&(I=!0),(0,U.l)(v._MergeMeshesCoroutine(w,I,P,u,Q,K,!1))},v.MergeMeshesAsync=function(w,I,P,u,Q,K){return void 0===I&&(I=!0),(0,U.h)(v._MergeMeshesCoroutine(w,I,P,u,Q,K,!0),(0,U.b)())},v._MergeMeshesCoroutine=function(w,I,u,Q,K,a,U){var p,r,Y,g,l,R,j,B,t,z,E,o,h,n,W,V,F,O,N,q,m,c,M,S,e,H;return void 0===I&&(I=!0),(0,P.p)(this,(function(P){switch(P.label){case 0:if(0===(w=w.filter(Boolean)).length)return[2,null];if(!u)for(r=0,p=0;p<w.length;p++)if((r+=w[p].getTotalVertices())>=65536)return i.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),[2,null];for(a&&(K=!1),Y=new Array,g=new Array,l=new Array,R=w[0].overrideMaterialSideOrientation,p=0;p<w.length;p++){if((j=w[p]).isAnInstance)return i.e.Warn("Cannot merge instance meshes."),[2,null];if(R!==j.overrideMaterialSideOrientation)return i.e.Warn("Cannot merge meshes with different overrideMaterialSideOrientation values."),[2,null];if(K&&l.push(j.getTotalIndices()),a)if(j.material)if((B=j.material)instanceof s.b){for(t=0;t<B.subMaterials.length;t++)Y.indexOf(B.subMaterials[t])<0&&Y.push(B.subMaterials[t]);for(H=0;H<j.subMeshes.length;H++)g.push(Y.indexOf(B.subMaterials[j.subMeshes[H].materialIndex])),l.push(j.subMeshes[H].indexCount)}else for(Y.indexOf(B)<0&&Y.push(B),H=0;H<j.subMeshes.length;H++)g.push(Y.indexOf(B)),l.push(j.subMeshes[H].indexCount);else for(H=0;H<j.subMeshes.length;H++)g.push(0),l.push(j.subMeshes[H].indexCount)}return z=w[0],E=function(w){var v=w.computeWorldMatrix(!0);return[J.b.ExtractFromMesh(w,!1,!1),v]},o=E(z),h=o[0],n=o[1],U?[4]:[3,2];case 1:P.sent(),P.label=2;case 2:W=new Array(w.length-1),V=1,P.label=3;case 3:return V<w.length?(W[V-1]=E(w[V]),U?[4]:[3,5]):[3,6];case 4:P.sent(),P.label=5;case 5:return V++,[3,3];case 6:F=h._mergeCoroutine(n,W,u,U,!I),O=F.next(),P.label=7;case 7:return O.done?[3,10]:U?[4]:[3,9];case 8:P.sent(),P.label=9;case 9:return O=F.next(),[3,7];case 10:N=O.value,Q||(Q=new v(z.name+"_merged",z.getScene())),q=N._applyToCoroutine(Q,void 0,U),m=q.next(),P.label=11;case 11:return m.done?[3,14]:U?[4]:[3,13];case 12:P.sent(),P.label=13;case 13:return m=q.next(),[3,11];case 14:if(Q.checkCollisions=z.checkCollisions,Q.overrideMaterialSideOrientation=z.overrideMaterialSideOrientation,I)for(p=0;p<w.length;p++)w[p].dispose();if(K||a){for(Q.releaseSubMeshes(),p=0,c=0;p<l.length;)x.c.CreateFromIndices(0,c,l[p],Q,void 0,!1),c+=l[p],p++;for(M=0,S=Q.subMeshes;M<S.length;M++)S[M].refreshBoundingInfo();Q.computeWorldMatrix(!0)}if(a){for((e=new s.b(z.name+"_merged",z.getScene())).subMaterials=Y,H=0;H<Q.subMeshes.length;H++)Q.subMeshes[H].materialIndex=g[H];Q.material=e}else Q.material=z.material;return[2,Q]}}))},v.prototype.addInstance=function(w){w._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(w)},v.prototype.removeInstance=function(w){var v=w._indexInSourceMeshInstanceArray;if(-1!=v){if(v!==this.instances.length-1){var I=this.instances[this.instances.length-1];this.instances[v]=I,I._indexInSourceMeshInstanceArray=v}w._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},v.prototype._shouldConvertRHS=function(){return this.overrideMaterialSideOrientation===j.b.CounterClockWiseSideOrientation},v.FRONTSIDE=J.b.FRONTSIDE,v.BACKSIDE=J.b.BACKSIDE,v.DOUBLESIDE=J.b.DOUBLESIDE,v.DEFAULTSIDE=J.b.DEFAULTSIDE,v.NO_CAP=0,v.CAP_START=1,v.CAP_END=2,v.CAP_ALL=3,v.NO_FLIP=0,v.FLIP_TILE=1,v.ROTATE_TILE=2,v.FLIP_ROW=3,v.ROTATE_ROW=4,v.FLIP_N_ROTATE_TILE=5,v.FLIP_N_ROTATE_ROW=6,v.CENTER=0,v.LEFT=1,v.RIGHT=2,v.TOP=3,v.BOTTOM=4,v.INSTANCEDMESH_SORT_TRANSPARENT=!1,v._GroundMeshParser=function(w,v){throw(0,E.e)("GroundMesh")},v._GoldbergMeshParser=function(w,v){throw(0,E.e)("GoldbergMesh")},v._LinesMeshParser=function(w,v){throw(0,E.e)("LinesMesh")},v}(R.b);(0,z.g)("BABYLON.Mesh",N),N.prototype.setMaterialByID=function(w){return this.setMaterialById(w)},N.CreateDisc=N.CreateDisc||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateBox=N.CreateBox||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateSphere=N.CreateSphere||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateCylinder=N.CreateCylinder||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateTorusKnot=N.CreateTorusKnot||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateTorus=N.CreateTorus||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreatePlane=N.CreatePlane||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateGround=N.CreateGround||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateTiledGround=N.CreateTiledGround||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateGroundFromHeightMap=N.CreateGroundFromHeightMap||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateTube=N.CreateTube||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreatePolyhedron=N.CreatePolyhedron||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateIcoSphere=N.CreateIcoSphere||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateDecal=N.CreateDecal||function(){throw new Error("Import MeshBuilder to populate this function")},N.CreateCapsule=N.CreateCapsule||function(){throw new Error("Import MeshBuilder to populate this function")},N.ExtendToGoldberg=N.ExtendToGoldberg||function(){throw new Error("Import MeshBuilder to populate this function")}},85779:function(w,v,I){"use strict";I.d(v,{b:function(){return g}});var P=I(78502),u=I(80105),Q=I(43251),K=I(50504),a=I(9488),U=I(9127),p=I(9892),r=I(61633),Y=I(39524),g=function(){function w(){this._applyTo=(0,r.e)(this._applyToCoroutine.bind(this))}return w.prototype.set=function(w,v){switch(w.length||U.e.Warn("Setting vertex data kind '".concat(v,"' with an empty array")),v){case Q.f.PositionKind:this.positions=w;break;case Q.f.NormalKind:this.normals=w;break;case Q.f.TangentKind:this.tangents=w;break;case Q.f.UVKind:this.uvs=w;break;case Q.f.UV2Kind:this.uvs2=w;break;case Q.f.UV3Kind:this.uvs3=w;break;case Q.f.UV4Kind:this.uvs4=w;break;case Q.f.UV5Kind:this.uvs5=w;break;case Q.f.UV6Kind:this.uvs6=w;break;case Q.f.ColorKind:this.colors=w;break;case Q.f.MatricesIndicesKind:this.matricesIndices=w;break;case Q.f.MatricesWeightsKind:this.matricesWeights=w;break;case Q.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=w;break;case Q.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=w}},w.prototype.applyToMesh=function(w,v){return this._applyTo(w,v,!1),this},w.prototype.applyToGeometry=function(w,v){return this._applyTo(w,v,!1),this},w.prototype.updateMesh=function(w){return this._update(w),this},w.prototype.updateGeometry=function(w){return this._update(w),this},w.prototype._applyToCoroutine=function(w,v,I){return void 0===v&&(v=!1),(0,P.p)(this,(function(P){switch(P.label){case 0:return this.positions?(w.setVerticesData(Q.f.PositionKind,this.positions,v),I?[4]:[3,2]):[3,2];case 1:P.sent(),P.label=2;case 2:return this.normals?(w.setVerticesData(Q.f.NormalKind,this.normals,v),I?[4]:[3,4]):[3,4];case 3:P.sent(),P.label=4;case 4:return this.tangents?(w.setVerticesData(Q.f.TangentKind,this.tangents,v),I?[4]:[3,6]):[3,6];case 5:P.sent(),P.label=6;case 6:return this.uvs?(w.setVerticesData(Q.f.UVKind,this.uvs,v),I?[4]:[3,8]):[3,8];case 7:P.sent(),P.label=8;case 8:return this.uvs2?(w.setVerticesData(Q.f.UV2Kind,this.uvs2,v),I?[4]:[3,10]):[3,10];case 9:P.sent(),P.label=10;case 10:return this.uvs3?(w.setVerticesData(Q.f.UV3Kind,this.uvs3,v),I?[4]:[3,12]):[3,12];case 11:P.sent(),P.label=12;case 12:return this.uvs4?(w.setVerticesData(Q.f.UV4Kind,this.uvs4,v),I?[4]:[3,14]):[3,14];case 13:P.sent(),P.label=14;case 14:return this.uvs5?(w.setVerticesData(Q.f.UV5Kind,this.uvs5,v),I?[4]:[3,16]):[3,16];case 15:P.sent(),P.label=16;case 16:return this.uvs6?(w.setVerticesData(Q.f.UV6Kind,this.uvs6,v),I?[4]:[3,18]):[3,18];case 17:P.sent(),P.label=18;case 18:return this.colors?(w.setVerticesData(Q.f.ColorKind,this.colors,v),I?[4]:[3,20]):[3,20];case 19:P.sent(),P.label=20;case 20:return this.matricesIndices?(w.setVerticesData(Q.f.MatricesIndicesKind,this.matricesIndices,v),I?[4]:[3,22]):[3,22];case 21:P.sent(),P.label=22;case 22:return this.matricesWeights?(w.setVerticesData(Q.f.MatricesWeightsKind,this.matricesWeights,v),I?[4]:[3,24]):[3,24];case 23:P.sent(),P.label=24;case 24:return this.matricesIndicesExtra?(w.setVerticesData(Q.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,v),I?[4]:[3,26]):[3,26];case 25:P.sent(),P.label=26;case 26:return this.matricesWeightsExtra?(w.setVerticesData(Q.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,v),I?[4]:[3,28]):[3,28];case 27:P.sent(),P.label=28;case 28:return this.indices?(w.setIndices(this.indices,null,v),I?[4]:[3,30]):[3,31];case 29:P.sent(),P.label=30;case 30:return[3,32];case 31:w.setIndices([],null),P.label=32;case 32:return[2,this]}}))},w.prototype._update=function(w,v,I){return this.positions&&w.updateVerticesData(Q.f.PositionKind,this.positions,v,I),this.normals&&w.updateVerticesData(Q.f.NormalKind,this.normals,v,I),this.tangents&&w.updateVerticesData(Q.f.TangentKind,this.tangents,v,I),this.uvs&&w.updateVerticesData(Q.f.UVKind,this.uvs,v,I),this.uvs2&&w.updateVerticesData(Q.f.UV2Kind,this.uvs2,v,I),this.uvs3&&w.updateVerticesData(Q.f.UV3Kind,this.uvs3,v,I),this.uvs4&&w.updateVerticesData(Q.f.UV4Kind,this.uvs4,v,I),this.uvs5&&w.updateVerticesData(Q.f.UV5Kind,this.uvs5,v,I),this.uvs6&&w.updateVerticesData(Q.f.UV6Kind,this.uvs6,v,I),this.colors&&w.updateVerticesData(Q.f.ColorKind,this.colors,v,I),this.matricesIndices&&w.updateVerticesData(Q.f.MatricesIndicesKind,this.matricesIndices,v,I),this.matricesWeights&&w.updateVerticesData(Q.f.MatricesWeightsKind,this.matricesWeights,v,I),this.matricesIndicesExtra&&w.updateVerticesData(Q.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,v,I),this.matricesWeightsExtra&&w.updateVerticesData(Q.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,v,I),this.indices&&w.setIndices(this.indices,null),this},w._TransformVector3Coordinates=function(w,v,I,P){void 0===I&&(I=0),void 0===P&&(P=w.length);for(var Q=u.i.Vector3[0],K=u.i.Vector3[1],a=I;a<I+P;a+=3)u.l.FromArrayToRef(w,a,Q),u.l.TransformCoordinatesToRef(Q,v,K),w[a]=K.x,w[a+1]=K.y,w[a+2]=K.z},w._TransformVector3Normals=function(w,v,I,P){void 0===I&&(I=0),void 0===P&&(P=w.length);for(var Q=u.i.Vector3[0],K=u.i.Vector3[1],a=I;a<I+P;a+=3)u.l.FromArrayToRef(w,a,Q),u.l.TransformNormalToRef(Q,v,K),w[a]=K.x,w[a+1]=K.y,w[a+2]=K.z},w._TransformVector4Normals=function(w,v,I,P){void 0===I&&(I=0),void 0===P&&(P=w.length);for(var Q=u.i.Vector4[0],K=u.i.Vector4[1],a=I;a<I+P;a+=4)u.p.FromArrayToRef(w,a,Q),u.p.TransformNormalToRef(Q,v,K),w[a]=K.x,w[a+1]=K.y,w[a+2]=K.z,w[a+3]=K.w},w._FlipFaces=function(w,v,I){void 0===v&&(v=0),void 0===I&&(I=w.length);for(var P=v;P<v+I;P+=3){var u=w[P+1];w[P+1]=w[P+2],w[P+2]=u}},w.prototype.transform=function(v){var I=v.determinant()<0;return this.positions&&w._TransformVector3Coordinates(this.positions,v),this.normals&&w._TransformVector3Normals(this.normals,v),this.tangents&&w._TransformVector4Normals(this.tangents,v),I&&this.indices&&w._FlipFaces(this.indices),this},w.prototype.merge=function(w,v,I){void 0===v&&(v=!1),void 0===I&&(I=!1);var P=Array.isArray(w)?w.map((function(w){return[w,void 0]})):[[w,void 0]];return(0,r.l)(this._mergeCoroutine(void 0,P,v,!1,I))},w.prototype._mergeCoroutine=function(v,I,u,K,a){var U,p,r,Y,g,J,l,R,x,j,s,B,t,i,z,E,o,h,n,W=this;return void 0===u&&(u=!1),(0,P.p)(this,(function(P){switch(P.label){case 0:for(this._validate(),U=I.map((function(w){return w[0]})),p=0,r=U;p<r.length;p++)if((t=r[p])._validate(),!this.normals!==!t.normals||!this.tangents!==!t.tangents||!this.uvs!==!t.uvs||!this.uvs2!==!t.uvs2||!this.uvs3!==!t.uvs3||!this.uvs4!==!t.uvs4||!this.uvs5!==!t.uvs5||!this.uvs6!==!t.uvs6||!this.colors!==!t.colors||!this.matricesIndices!==!t.matricesIndices||!this.matricesWeights!==!t.matricesWeights||!this.matricesIndicesExtra!==!t.matricesIndicesExtra||!this.matricesWeightsExtra!==!t.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(Y=U.reduce((function(w,v){var I,P;return w+(null!==(P=null===(I=v.indices)||void 0===I?void 0:I.length)&&void 0!==P?P:0)}),null!==(o=null===(E=this.indices)||void 0===E?void 0:E.length)&&void 0!==o?o:0),g=a||U.some((function(w){return w.indices===W.indices})),J=g?null===(h=this.indices)||void 0===h?void 0:h.slice():this.indices,!(Y>0))return[3,4];l=null!==(n=null===J||void 0===J?void 0:J.length)&&void 0!==n?n:0,J||(J=new Array(Y)),J.length!==Y&&(Array.isArray(J)?J.length=Y:((R=u||J instanceof Uint32Array?new Uint32Array(Y):new Uint16Array(Y)).set(J),J=R),v&&v.determinant()<0&&w._FlipFaces(J,0,l)),x=this.positions?this.positions.length/3:0,j=0,s=I,P.label=1;case 1:if(!(j<s.length))return[3,4];if(B=s[j],t=B[0],i=B[1],!t.indices)return[3,3];for(z=0;z<t.indices.length;z++)J[l+z]=t.indices[z]+x;return i&&i.determinant()<0&&w._FlipFaces(J,l,t.indices.length),x+=t.positions.length/3,l+=t.indices.length,K?[4]:[3,3];case 2:P.sent(),P.label=3;case 3:return j++,[3,1];case 4:return this.indices=J,this.positions=w._MergeElement(Q.f.PositionKind,this.positions,v,I.map((function(w){return[w[0].positions,w[1]]}))),K?[4]:[3,6];case 5:P.sent(),P.label=6;case 6:return this.normals=w._MergeElement(Q.f.NormalKind,this.normals,v,I.map((function(w){return[w[0].normals,w[1]]}))),K?[4]:[3,8];case 7:P.sent(),P.label=8;case 8:return this.tangents=w._MergeElement(Q.f.TangentKind,this.tangents,v,I.map((function(w){return[w[0].tangents,w[1]]}))),K?[4]:[3,10];case 9:P.sent(),P.label=10;case 10:return this.uvs=w._MergeElement(Q.f.UVKind,this.uvs,v,I.map((function(w){return[w[0].uvs,w[1]]}))),K?[4]:[3,12];case 11:P.sent(),P.label=12;case 12:return this.uvs2=w._MergeElement(Q.f.UV2Kind,this.uvs2,v,I.map((function(w){return[w[0].uvs2,w[1]]}))),K?[4]:[3,14];case 13:P.sent(),P.label=14;case 14:return this.uvs3=w._MergeElement(Q.f.UV3Kind,this.uvs3,v,I.map((function(w){return[w[0].uvs3,w[1]]}))),K?[4]:[3,16];case 15:P.sent(),P.label=16;case 16:return this.uvs4=w._MergeElement(Q.f.UV4Kind,this.uvs4,v,I.map((function(w){return[w[0].uvs4,w[1]]}))),K?[4]:[3,18];case 17:P.sent(),P.label=18;case 18:return this.uvs5=w._MergeElement(Q.f.UV5Kind,this.uvs5,v,I.map((function(w){return[w[0].uvs5,w[1]]}))),K?[4]:[3,20];case 19:P.sent(),P.label=20;case 20:return this.uvs6=w._MergeElement(Q.f.UV6Kind,this.uvs6,v,I.map((function(w){return[w[0].uvs6,w[1]]}))),K?[4]:[3,22];case 21:P.sent(),P.label=22;case 22:return this.colors=w._MergeElement(Q.f.ColorKind,this.colors,v,I.map((function(w){return[w[0].colors,w[1]]}))),K?[4]:[3,24];case 23:P.sent(),P.label=24;case 24:return this.matricesIndices=w._MergeElement(Q.f.MatricesIndicesKind,this.matricesIndices,v,I.map((function(w){return[w[0].matricesIndices,w[1]]}))),K?[4]:[3,26];case 25:P.sent(),P.label=26;case 26:return this.matricesWeights=w._MergeElement(Q.f.MatricesWeightsKind,this.matricesWeights,v,I.map((function(w){return[w[0].matricesWeights,w[1]]}))),K?[4]:[3,28];case 27:P.sent(),P.label=28;case 28:return this.matricesIndicesExtra=w._MergeElement(Q.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,v,I.map((function(w){return[w[0].matricesIndicesExtra,w[1]]}))),K?[4]:[3,30];case 29:P.sent(),P.label=30;case 30:return this.matricesWeightsExtra=w._MergeElement(Q.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,v,I.map((function(w){return[w[0].matricesWeightsExtra,w[1]]}))),[2,this]}}))},w._MergeElement=function(v,I,P,u){var K=u.filter((function(w){return null!==w[0]&&void 0!==w[0]}));if(!I&&0==K.length)return I;if(!I)return this._MergeElement(v,K[0][0],K[0][1],K.slice(1));var a=K.reduce((function(w,v){return w+v[0].length}),I.length),U=v===Q.f.PositionKind?w._TransformVector3Coordinates:v===Q.f.NormalKind?w._TransformVector3Normals:v===Q.f.TangentKind?w._TransformVector4Normals:function(){};if(I instanceof Float32Array){var p=new Float32Array(a);p.set(I),P&&U(p,P,0,I.length);for(var r=I.length,Y=0,g=K;Y<g.length;Y++){var J=g[Y],l=J[0],R=J[1];p.set(l,r),R&&U(p,R,r,l.length),r+=l.length}return p}for(var x=new Array(a),j=0;j<I.length;j++)x[j]=I[j];P&&U(x,P,0,I.length);r=I.length;for(var s=0,B=K;s<B.length;s++){var t=B[s],i=(l=t[0],t[1]);for(j=0;j<l.length;j++)x[r+j]=l[j];i&&U(x,i,r,l.length),r+=l.length}return x},w.prototype._validate=function(){if(!this.positions)throw new Y.f("Positions are required",Y.e.MeshInvalidPositionsError);var w=function(w,v){var I=Q.f.DeduceStride(w);if(v.length%I!==0)throw new Error("The "+w+"s array count must be a multiple of "+I);return v.length/I},v=w(Q.f.PositionKind,this.positions),I=function(I,P){var u=w(I,P);if(u!==v)throw new Error("The "+I+"s element count ("+u+") does not match the positions count ("+v+")")};this.normals&&I(Q.f.NormalKind,this.normals),this.tangents&&I(Q.f.TangentKind,this.tangents),this.uvs&&I(Q.f.UVKind,this.uvs),this.uvs2&&I(Q.f.UV2Kind,this.uvs2),this.uvs3&&I(Q.f.UV3Kind,this.uvs3),this.uvs4&&I(Q.f.UV4Kind,this.uvs4),this.uvs5&&I(Q.f.UV5Kind,this.uvs5),this.uvs6&&I(Q.f.UV6Kind,this.uvs6),this.colors&&I(Q.f.ColorKind,this.colors),this.matricesIndices&&I(Q.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&I(Q.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&I(Q.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&I(Q.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)},w.prototype.serialize=function(){var w={};return this.positions&&(w.positions=this.positions),this.normals&&(w.normals=this.normals),this.tangents&&(w.tangents=this.tangents),this.uvs&&(w.uvs=this.uvs),this.uvs2&&(w.uvs2=this.uvs2),this.uvs3&&(w.uvs3=this.uvs3),this.uvs4&&(w.uvs4=this.uvs4),this.uvs5&&(w.uvs5=this.uvs5),this.uvs6&&(w.uvs6=this.uvs6),this.colors&&(w.colors=this.colors),this.matricesIndices&&(w.matricesIndices=this.matricesIndices,w.matricesIndices._isExpanded=!0),this.matricesWeights&&(w.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(w.matricesIndicesExtra=this.matricesIndicesExtra,w.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(w.matricesWeightsExtra=this.matricesWeightsExtra),w.indices=this.indices,w},w.ExtractFromMesh=function(v,I,P){return w._ExtractFrom(v,I,P)},w.ExtractFromGeometry=function(v,I,P){return w._ExtractFrom(v,I,P)},w._ExtractFrom=function(v,I,P){var u=new w;return v.isVerticesDataPresent(Q.f.PositionKind)&&(u.positions=v.getVerticesData(Q.f.PositionKind,I,P)),v.isVerticesDataPresent(Q.f.NormalKind)&&(u.normals=v.getVerticesData(Q.f.NormalKind,I,P)),v.isVerticesDataPresent(Q.f.TangentKind)&&(u.tangents=v.getVerticesData(Q.f.TangentKind,I,P)),v.isVerticesDataPresent(Q.f.UVKind)&&(u.uvs=v.getVerticesData(Q.f.UVKind,I,P)),v.isVerticesDataPresent(Q.f.UV2Kind)&&(u.uvs2=v.getVerticesData(Q.f.UV2Kind,I,P)),v.isVerticesDataPresent(Q.f.UV3Kind)&&(u.uvs3=v.getVerticesData(Q.f.UV3Kind,I,P)),v.isVerticesDataPresent(Q.f.UV4Kind)&&(u.uvs4=v.getVerticesData(Q.f.UV4Kind,I,P)),v.isVerticesDataPresent(Q.f.UV5Kind)&&(u.uvs5=v.getVerticesData(Q.f.UV5Kind,I,P)),v.isVerticesDataPresent(Q.f.UV6Kind)&&(u.uvs6=v.getVerticesData(Q.f.UV6Kind,I,P)),v.isVerticesDataPresent(Q.f.ColorKind)&&(u.colors=v.getVerticesData(Q.f.ColorKind,I,P)),v.isVerticesDataPresent(Q.f.MatricesIndicesKind)&&(u.matricesIndices=v.getVerticesData(Q.f.MatricesIndicesKind,I,P)),v.isVerticesDataPresent(Q.f.MatricesWeightsKind)&&(u.matricesWeights=v.getVerticesData(Q.f.MatricesWeightsKind,I,P)),v.isVerticesDataPresent(Q.f.MatricesIndicesExtraKind)&&(u.matricesIndicesExtra=v.getVerticesData(Q.f.MatricesIndicesExtraKind,I,P)),v.isVerticesDataPresent(Q.f.MatricesWeightsExtraKind)&&(u.matricesWeightsExtra=v.getVerticesData(Q.f.MatricesWeightsExtraKind,I,P)),u.indices=v.getIndices(I,P),u},w.CreateRibbon=function(w){throw(0,K.e)("ribbonBuilder")},w.CreateBox=function(w){throw(0,K.e)("boxBuilder")},w.CreateTiledBox=function(w){throw(0,K.e)("tiledBoxBuilder")},w.CreateTiledPlane=function(w){throw(0,K.e)("tiledPlaneBuilder")},w.CreateSphere=function(w){throw(0,K.e)("sphereBuilder")},w.CreateCylinder=function(w){throw(0,K.e)("cylinderBuilder")},w.CreateTorus=function(w){throw(0,K.e)("torusBuilder")},w.CreateLineSystem=function(w){throw(0,K.e)("linesBuilder")},w.CreateDashedLines=function(w){throw(0,K.e)("linesBuilder")},w.CreateGround=function(w){throw(0,K.e)("groundBuilder")},w.CreateTiledGround=function(w){throw(0,K.e)("groundBuilder")},w.CreateGroundFromHeightMap=function(w){throw(0,K.e)("groundBuilder")},w.CreatePlane=function(w){throw(0,K.e)("planeBuilder")},w.CreateDisc=function(w){throw(0,K.e)("discBuilder")},w.CreatePolygon=function(w,v,I,P,u,Q,a){throw(0,K.e)("polygonBuilder")},w.CreateIcoSphere=function(w){throw(0,K.e)("icoSphereBuilder")},w.CreatePolyhedron=function(w){throw(0,K.e)("polyhedronBuilder")},w.CreateCapsule=function(w){throw void 0===w&&(w={orientation:u.l.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),(0,K.e)("capsuleBuilder")},w.CreateTorusKnot=function(w){throw(0,K.e)("torusKnotBuilder")},w.ComputeNormals=function(w,v,I,P){var Q=0,K=0,a=0,U=0,p=0,r=0,Y=0,g=0,J=0,l=0,R=0,x=0,j=0,s=0,B=0,t=0,i=0,z=0,E=0,o=0,h=!1,n=!1,W=!1,V=!1,F=1,O=0,N=null;P&&(h=!!P.facetNormals,n=!!P.facetPositions,W=!!P.facetPartitioning,F=!0===P.useRightHandedSystem?-1:1,O=P.ratio||0,V=!!P.depthSort,N=P.distanceTo,V&&void 0===N&&(N=u.l.Zero()));var q=0,m=0,c=0,M=0;for(W&&P&&P.bbSize&&(q=P.subDiv.X*O/P.bbSize.x,m=P.subDiv.Y*O/P.bbSize.y,c=P.subDiv.Z*O/P.bbSize.z,M=P.subDiv.max*P.subDiv.max,P.facetPartitioning.length=0),Q=0;Q<w.length;Q++)I[Q]=0;var S=v.length/3|0;for(Q=0;Q<S;Q++){if(j=(x=3*v[3*Q])+1,s=x+2,t=(B=3*v[3*Q+1])+1,i=B+2,E=(z=3*v[3*Q+2])+1,o=z+2,K=w[x]-w[B],a=w[j]-w[t],U=w[s]-w[i],p=w[z]-w[B],r=w[E]-w[t],g=F*(a*(Y=w[o]-w[i])-U*r),J=F*(U*p-K*Y),l=F*(K*r-a*p),g/=R=0===(R=Math.sqrt(g*g+J*J+l*l))?1:R,J/=R,l/=R,h&&P&&(P.facetNormals[Q].x=g,P.facetNormals[Q].y=J,P.facetNormals[Q].z=l),n&&P&&(P.facetPositions[Q].x=(w[x]+w[B]+w[z])/3,P.facetPositions[Q].y=(w[j]+w[t]+w[E])/3,P.facetPositions[Q].z=(w[s]+w[i]+w[o])/3),W&&P){var e=Math.floor((P.facetPositions[Q].x-P.bInfo.minimum.x*O)*q),H=Math.floor((P.facetPositions[Q].y-P.bInfo.minimum.y*O)*m),G=Math.floor((P.facetPositions[Q].z-P.bInfo.minimum.z*O)*c),L=Math.floor((w[x]-P.bInfo.minimum.x*O)*q),d=Math.floor((w[j]-P.bInfo.minimum.y*O)*m),D=Math.floor((w[s]-P.bInfo.minimum.z*O)*c),f=Math.floor((w[B]-P.bInfo.minimum.x*O)*q),b=Math.floor((w[t]-P.bInfo.minimum.y*O)*m),k=Math.floor((w[i]-P.bInfo.minimum.z*O)*c),C=Math.floor((w[z]-P.bInfo.minimum.x*O)*q),y=Math.floor((w[E]-P.bInfo.minimum.y*O)*m),T=Math.floor((w[o]-P.bInfo.minimum.z*O)*c),Z=L+P.subDiv.max*d+M*D,A=f+P.subDiv.max*b+M*k,X=C+P.subDiv.max*y+M*T,ww=e+P.subDiv.max*H+M*G;P.facetPartitioning[ww]=P.facetPartitioning[ww]?P.facetPartitioning[ww]:new Array,P.facetPartitioning[Z]=P.facetPartitioning[Z]?P.facetPartitioning[Z]:new Array,P.facetPartitioning[A]=P.facetPartitioning[A]?P.facetPartitioning[A]:new Array,P.facetPartitioning[X]=P.facetPartitioning[X]?P.facetPartitioning[X]:new Array,P.facetPartitioning[Z].push(Q),A!=Z&&P.facetPartitioning[A].push(Q),X!=A&&X!=Z&&P.facetPartitioning[X].push(Q),ww!=Z&&ww!=A&&ww!=X&&P.facetPartitioning[ww].push(Q)}if(V&&P&&P.facetPositions){var vw=P.depthSortedFacets[Q];vw.ind=3*Q,vw.sqDistance=u.l.DistanceSquared(P.facetPositions[Q],N)}I[x]+=g,I[j]+=J,I[s]+=l,I[B]+=g,I[t]+=J,I[i]+=l,I[z]+=g,I[E]+=J,I[o]+=l}for(Q=0;Q<I.length/3;Q++)g=I[3*Q],J=I[3*Q+1],l=I[3*Q+2],g/=R=0===(R=Math.sqrt(g*g+J*J+l*l))?1:R,J/=R,l/=R,I[3*Q]=g,I[3*Q+1]=J,I[3*Q+2]=l},w._ComputeSides=function(v,I,P,Q,K,a,U){var p,r,Y=P.length,g=Q.length;switch(v=v||w.DEFAULTSIDE){case w.FRONTSIDE:break;case w.BACKSIDE:for(p=0;p<Y;p+=3){var J=P[p];P[p]=P[p+2],P[p+2]=J}for(r=0;r<g;r++)Q[r]=-Q[r];break;case w.DOUBLESIDE:for(var l=I.length,R=l/3,x=0;x<l;x++)I[l+x]=I[x];for(p=0;p<Y;p+=3)P[p+Y]=P[p+2]+R,P[p+1+Y]=P[p+1]+R,P[p+2+Y]=P[p]+R;for(r=0;r<g;r++)Q[g+r]=-Q[r];var j=K.length,s=0;for(s=0;s<j;s++)K[s+j]=K[s];for(a=a||new u.p(0,0,1,1),U=U||new u.p(0,0,1,1),s=0,p=0;p<j/2;p++)K[s]=a.x+(a.z-a.x)*K[s],K[s+1]=a.y+(a.w-a.y)*K[s+1],K[s+j]=U.x+(U.z-U.x)*K[s+j],K[s+j+1]=U.y+(U.w-U.y)*K[s+j+1],s+=2}},w.ImportVertexData=function(v,I){var P=new w,u=v.positions;u&&P.set(u,Q.f.PositionKind);var K=v.normals;K&&P.set(K,Q.f.NormalKind);var U=v.tangents;U&&P.set(U,Q.f.TangentKind);var p=v.uvs;p&&P.set(p,Q.f.UVKind);var r=v.uv2s;r&&P.set(r,Q.f.UV2Kind);var Y=v.uv3s;Y&&P.set(Y,Q.f.UV3Kind);var g=v.uv4s;g&&P.set(g,Q.f.UV4Kind);var J=v.uv5s;J&&P.set(J,Q.f.UV5Kind);var l=v.uv6s;l&&P.set(l,Q.f.UV6Kind);var R=v.colors;R&&P.set(a.f.CheckColors4(R,u.length/3),Q.f.ColorKind);var x=v.matricesIndices;x&&P.set(x,Q.f.MatricesIndicesKind);var j=v.matricesWeights;j&&P.set(j,Q.f.MatricesWeightsKind);var s=v.indices;s&&(P.indices=s),I.setAllVerticesData(P,v.updatable)},w.FRONTSIDE=0,w.BACKSIDE=1,w.DOUBLESIDE=2,w.DEFAULTSIDE=0,(0,P.i)([p.j.filter((function(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];var I=w[0];return!Array.isArray(I)}))],w,"_TransformVector3Coordinates",null),(0,P.i)([p.j.filter((function(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];var I=w[0];return!Array.isArray(I)}))],w,"_TransformVector3Normals",null),(0,P.i)([p.j.filter((function(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];var I=w[0];return!Array.isArray(I)}))],w,"_TransformVector4Normals",null),(0,P.i)([p.j.filter((function(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];var I=w[0];return!Array.isArray(I)}))],w,"_FlipFaces",null),w}()},54588:function(w,v,I){"use strict";I.d(v,{c:function(){return Rw}});var P=I(80105),u=I(65847),Q=I(43251),K=I(85779),a=I(20334);function U(w){var v=w.pathArray,I=w.closeArray||!1,P=w.closePath||!1,u=w.invertUV||!1,U=Math.floor(v[0].length/2),p=w.offset||U;p=p>U?U:Math.floor(p);var r,Y,g,J,l=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE,R=w.uvs,x=w.colors,j=[],s=[],B=[],t=[],i=[],z=[],E=[],o=[],h=[],n=[];if(v.length<2){var W=[],V=[];for(g=0;g<v[0].length-p;g++)W.push(v[0][g]),V.push(v[0][g+p]);v=[W,V]}var F,O,N,q,m,c=0,M=P?1:0;for(r=v[0].length,Y=0;Y<v.length;Y++){for(E[Y]=0,i[Y]=[0],r=r<(O=(F=v[Y]).length)?r:O,J=0;J<O;)j.push(F[J].x,F[J].y,F[J].z),J>0&&(N=F[J].subtract(F[J-1]).length()+E[Y],i[Y].push(N),E[Y]=N),J++;P&&(J--,j.push(F[0].x,F[0].y,F[0].z),N=F[J].subtract(F[0]).length()+E[Y],i[Y].push(N),E[Y]=N),h[Y]=O+M,n[Y]=c,c+=O+M}var S,e,H=null,G=null;for(g=0;g<r+M;g++){for(o[g]=0,z[g]=[0],Y=0;Y<v.length-1;Y++)q=v[Y],m=v[Y+1],g===r?(H=q[0],G=m[0]):(H=q[g],G=m[g]),N=G.subtract(H).length()+o[g],z[g].push(N),o[g]=N;I&&G&&H&&(q=v[Y],m=v[0],g===r&&(G=m[0]),N=G.subtract(H).length()+o[g],o[g]=N)}if(R)for(Y=0;Y<R.length;Y++)t.push(R[Y].x,a.e.UseOpenGLOrientationForUV?1-R[Y].y:R[Y].y);else for(Y=0;Y<v.length;Y++)for(g=0;g<r+M;g++)S=0!=E[Y]?i[Y][g]/E[Y]:0,e=0!=o[g]?z[g][Y]/o[g]:0,u?t.push(e,S):t.push(S,a.e.UseOpenGLOrientationForUV?1-e:e);for(var L=0,d=h[Y=0]-1,D=h[Y+1]-1,f=d<D?d:D,b=n[1]-n[0],k=I?h.length:h.length-1;L<=f&&Y<k;)s.push(L,L+b,L+1),s.push(L+b+1,L+1,L+b),(L+=1)===f&&(++Y===h.length-1?(b=n[0]-n[Y],d=h[Y]-1,D=h[0]-1):(b=n[Y+1]-n[Y],d=h[Y]-1,D=h[Y+1]-1),L=n[Y],f=d<D?d+L:D+L);if(K.b.ComputeNormals(j,s,B),P){var C=0,y=0;for(Y=0;Y<v.length;Y++)C=3*n[Y],y=Y+1<v.length?3*(n[Y+1]-1):B.length-3,B[C]=.5*(B[C]+B[y]),B[C+1]=.5*(B[C+1]+B[y+1]),B[C+2]=.5*(B[C+2]+B[y+2]),B[y]=B[C],B[y+1]=B[C+1],B[y+2]=B[C+2]}K.b._ComputeSides(l,j,s,B,t,w.frontUVs,w.backUVs);var T=null;if(x){T=new Float32Array(4*x.length);for(var Z=0;Z<x.length;Z++)T[4*Z]=x[Z].r,T[4*Z+1]=x[Z].g,T[4*Z+2]=x[Z].b,T[4*Z+3]=x[Z].a}var A=new K.b,X=new Float32Array(j),ww=new Float32Array(B),vw=new Float32Array(t);return A.indices=s,A.positions=X,A.normals=ww,A.uvs=vw,T&&A.set(T,Q.f.ColorKind),P&&(A._idx=n),A}function p(w,v,I){void 0===I&&(I=null);var p=v.pathArray,r=v.closeArray,Y=v.closePath,g=u.b._GetDefaultSideOrientation(v.sideOrientation),J=v.instance,l=v.updatable;if(J){var R=P.i.Vector3[0].setAll(Number.MAX_VALUE),x=P.i.Vector3[1].setAll(-Number.MAX_VALUE),j=J.getVerticesData(Q.f.PositionKind);if(function(w){for(var v=p[0].length,I=J,P=0,Q=I._originalBuilderSideOrientation===u.b.DOUBLESIDE?2:1,K=1;K<=Q;++K)for(var a=0;a<p.length;++a){var U=p[a],r=U.length;v=v<r?v:r;for(var Y=0;Y<v;++Y){var g=U[Y];w[P]=g.x,w[P+1]=g.y,w[P+2]=g.z,R.minimizeInPlaceFromFloats(g.x,g.y,g.z),x.maximizeInPlaceFromFloats(g.x,g.y,g.z),P+=3}if(I._creationDataStorage&&I._creationDataStorage.closePath){g=U[0];w[P]=g.x,w[P+1]=g.y,w[P+2]=g.z,P+=3}}}(j),J.hasBoundingInfo?J.getBoundingInfo().reConstruct(R,x,J._worldMatrix):J.buildBoundingInfo(R,x,J._worldMatrix),J.updateVerticesData(Q.f.PositionKind,j,!1,!1),v.colors){for(var s=J.getVerticesData(Q.f.ColorKind),B=0,t=0;B<v.colors.length;B++,t+=4){var i=v.colors[B];s[t]=i.r,s[t+1]=i.g,s[t+2]=i.b,s[t+3]=i.a}J.updateVerticesData(Q.f.ColorKind,s,!1,!1)}if(v.uvs){for(var z=J.getVerticesData(Q.f.UVKind),E=0;E<v.uvs.length;E++)z[2*E]=v.uvs[E].x,z[2*E+1]=a.e.UseOpenGLOrientationForUV?1-v.uvs[E].y:v.uvs[E].y;J.updateVerticesData(Q.f.UVKind,z,!1,!1)}if(!J.areNormalsFrozen||J.isFacetDataEnabled){var o=J.getIndices(),h=J.getVerticesData(Q.f.NormalKind),n=J.isFacetDataEnabled?J.getFacetDataParameters():null;if(K.b.ComputeNormals(j,o,h,n),J._creationDataStorage&&J._creationDataStorage.closePath)for(var W=0,V=0,F=0;F<p.length;F++)W=3*J._creationDataStorage.idx[F],V=F+1<p.length?3*(J._creationDataStorage.idx[F+1]-1):h.length-3,h[W]=.5*(h[W]+h[V]),h[W+1]=.5*(h[W+1]+h[V+1]),h[W+2]=.5*(h[W+2]+h[V+2]),h[V]=h[W],h[V+1]=h[W+1],h[V+2]=h[W+2];J.areNormalsFrozen||J.updateVerticesData(Q.f.NormalKind,h,!1,!1)}return J}var O=new u.b(w,I);O._originalBuilderSideOrientation=g,O._creationDataStorage=new u.e;var N=U(v);return Y&&(O._creationDataStorage.idx=N._idx),O._creationDataStorage.closePath=Y,O._creationDataStorage.closeArray=r,N.applyToMesh(O,l),O}K.b.CreateRibbon=U,u.b.CreateRibbon=function(w,v,I,P,u,Q,K,a,U){return void 0===I&&(I=!1),void 0===K&&(K=!1),p(w,{pathArray:v,closeArray:I,closePath:P,offset:u,updatable:K,sideOrientation:a,instance:U},Q)};var r=I(60612),Y=I(64400),g=I(9488);function J(w){var v=w.pattern||u.b.NO_FLIP,I=w.tileWidth||w.tileSize||1,P=w.tileHeight||w.tileSize||1,Q=w.alignHorizontal||0,a=w.alignVertical||0,U=w.width||w.size||1,p=Math.floor(U/I),r=U-p*I,Y=w.height||w.size||1,g=Math.floor(Y/P),J=Y-g*P,l=I*p/2,R=P*g/2,x=0,j=0,s=0,B=0,t=0,i=0;if(r>0||J>0){switch(s=-l,B=-R,t=l,i=R,Q){case u.b.CENTER:s-=r/=2,t+=r;break;case u.b.LEFT:t+=r,x=-r/2;break;case u.b.RIGHT:s-=r,x=r/2}switch(a){case u.b.CENTER:B-=J/=2,i+=J;break;case u.b.BOTTOM:i+=J,j=-J/2;break;case u.b.TOP:B-=J,j=J/2}}var z=[],E=[],o=[];o[0]=[0,0,1,0,1,1,0,1],o[1]=[0,0,1,0,1,1,0,1],v!==u.b.ROTATE_TILE&&v!==u.b.ROTATE_ROW||(o[1]=[1,1,0,1,0,0,1,0]),v!==u.b.FLIP_TILE&&v!==u.b.FLIP_ROW||(o[1]=[1,0,0,0,0,1,1,1]),v!==u.b.FLIP_N_ROTATE_TILE&&v!==u.b.FLIP_N_ROTATE_ROW||(o[1]=[0,1,1,1,1,0,0,0]);for(var h=[],n=[],W=[],V=0,F=0;F<g;F++)for(var O=0;O<p;O++)z.push(O*I-l+x,F*P-R+j,0),z.push((O+1)*I-l+x,F*P-R+j,0),z.push((O+1)*I-l+x,(F+1)*P-R+j,0),z.push(O*I-l+x,(F+1)*P-R+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),h=v===u.b.FLIP_TILE||v===u.b.ROTATE_TILE||v===u.b.FLIP_N_ROTATE_TILE?h.concat(o[(O%2+F%2)%2]):v===u.b.FLIP_ROW||v===u.b.ROTATE_ROW||v===u.b.FLIP_N_ROTATE_ROW?h.concat(o[F%2]):h.concat(o[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),V+=4;if(r>0||J>0){var N=J>0&&(a===u.b.CENTER||a===u.b.TOP),q=J>0&&(a===u.b.CENTER||a===u.b.BOTTOM),m=r>0&&(Q===u.b.CENTER||Q===u.b.RIGHT),c=r>0&&(Q===u.b.CENTER||Q===u.b.LEFT),M=[],S=void 0,e=void 0,H=void 0,G=void 0;if(N&&m&&(z.push(s+x,B+j,0),z.push(-l+x,B+j,0),z.push(-l+x,B+J+j,0),z.push(s+x,B+J+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,M=[S=1-r/I,e=1-J/P,H=1,e,H,G=1,S,G],v===u.b.ROTATE_ROW&&(M=[1-S,1-e,1-H,1-e,1-H,1-G,1-S,1-G]),v===u.b.FLIP_ROW&&(M=[1-S,e,1-H,e,1-H,G,1-S,G]),v===u.b.FLIP_N_ROTATE_ROW&&(M=[S,1-e,H,1-e,H,1-G,S,1-G]),h=h.concat(M),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&c&&(z.push(l+x,B+j,0),z.push(t+x,B+j,0),z.push(t+x,B+J+j,0),z.push(l+x,B+J+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,M=[S=0,e=1-J/P,H=r/I,e,H,G=1,S,G],(v===u.b.ROTATE_ROW||v===u.b.ROTATE_TILE&&p%2===0)&&(M=[1-S,1-e,1-H,1-e,1-H,1-G,1-S,1-G]),(v===u.b.FLIP_ROW||v===u.b.FLIP_TILE&&p%2===0)&&(M=[1-S,e,1-H,e,1-H,G,1-S,G]),(v===u.b.FLIP_N_ROTATE_ROW||v===u.b.FLIP_N_ROTATE_TILE&&p%2===0)&&(M=[S,1-e,H,1-e,H,1-G,S,1-G]),h=h.concat(M),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&m&&(z.push(s+x,R+j,0),z.push(-l+x,R+j,0),z.push(-l+x,i+j,0),z.push(s+x,i+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,M=[S=1-r/I,e=0,H=1,e,H,G=J/P,S,G],(v===u.b.ROTATE_ROW&&g%2===1||v===u.b.ROTATE_TILE&&g%1===0)&&(M=[1-S,1-e,1-H,1-e,1-H,1-G,1-S,1-G]),(v===u.b.FLIP_ROW&&g%2===1||v===u.b.FLIP_TILE&&g%2===0)&&(M=[1-S,e,1-H,e,1-H,G,1-S,G]),(v===u.b.FLIP_N_ROTATE_ROW&&g%2===1||v===u.b.FLIP_N_ROTATE_TILE&&g%2===0)&&(M=[S,1-e,H,1-e,H,1-G,S,1-G]),h=h.concat(M),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&c&&(z.push(l+x,R+j,0),z.push(t+x,R+j,0),z.push(t+x,i+j,0),z.push(l+x,i+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,M=[S=0,e=0,H=r/I,e,H,G=J/P,S,G],(v===u.b.ROTATE_ROW&&g%2===1||v===u.b.ROTATE_TILE&&(g+p)%2===1)&&(M=[1-S,1-e,1-H,1-e,1-H,1-G,1-S,1-G]),(v===u.b.FLIP_ROW&&g%2===1||v===u.b.FLIP_TILE&&(g+p)%2===1)&&(M=[1-S,e,1-H,e,1-H,G,1-S,G]),(v===u.b.FLIP_N_ROTATE_ROW&&g%2===1||v===u.b.FLIP_N_ROTATE_TILE&&(g+p)%2===1)&&(M=[S,1-e,H,1-e,H,1-G,S,1-G]),h=h.concat(M),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N){var L=[];S=0,e=1-J/P,H=1,G=1,L[0]=[S,e,H,e,H,G,S,G],L[1]=[S,e,H,e,H,G,S,G],v!==u.b.ROTATE_TILE&&v!==u.b.ROTATE_ROW||(L[1]=[1-S,1-e,1-H,1-e,1-H,1-G,1-S,1-G]),v!==u.b.FLIP_TILE&&v!==u.b.FLIP_ROW||(L[1]=[1-S,e,1-H,e,1-H,G,1-S,G]),v!==u.b.FLIP_N_ROTATE_TILE&&v!==u.b.FLIP_N_ROTATE_ROW||(L[1]=[S,1-e,H,1-e,H,1-G,S,1-G]);for(O=0;O<p;O++)z.push(O*I-l+x,B+j,0),z.push((O+1)*I-l+x,B+j,0),z.push((O+1)*I-l+x,B+J+j,0),z.push(O*I-l+x,B+J+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,h=v===u.b.FLIP_TILE||v===u.b.ROTATE_TILE||v===u.b.FLIP_N_ROTATE_TILE?h.concat(L[(O+1)%2]):v===u.b.FLIP_ROW||v===u.b.ROTATE_ROW||v===u.b.FLIP_N_ROTATE_ROW?h.concat(L[1]):h.concat(L[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){var d=[];S=0,e=0,H=1,G=J/P,d[0]=[S,e,H,e,H,G,S,G],d[1]=[S,e,H,e,H,G,S,G],v!==u.b.ROTATE_TILE&&v!==u.b.ROTATE_ROW||(d[1]=[1-S,1-e,1-H,1-e,1-H,1-G,1-S,1-G]),v!==u.b.FLIP_TILE&&v!==u.b.FLIP_ROW||(d[1]=[1-S,e,1-H,e,1-H,G,1-S,G]),v!==u.b.FLIP_N_ROTATE_TILE&&v!==u.b.FLIP_N_ROTATE_ROW||(d[1]=[S,1-e,H,1-e,H,1-G,S,1-G]);for(O=0;O<p;O++)z.push(O*I-l+x,i-J+j,0),z.push((O+1)*I-l+x,i-J+j,0),z.push((O+1)*I-l+x,i+j,0),z.push(O*I-l+x,i+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,h=v===u.b.FLIP_TILE||v===u.b.ROTATE_TILE||v===u.b.FLIP_N_ROTATE_TILE?h.concat(d[(O+g)%2]):v===u.b.FLIP_ROW||v===u.b.ROTATE_ROW||v===u.b.FLIP_N_ROTATE_ROW?h.concat(d[g%2]):h.concat(d[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(m){var D=[];S=1-r/I,e=0,H=1,G=1,D[0]=[S,e,H,e,H,G,S,G],D[1]=[S,e,H,e,H,G,S,G],v!==u.b.ROTATE_TILE&&v!==u.b.ROTATE_ROW||(D[1]=[1-S,1-e,1-H,1-e,1-H,1-G,1-S,1-G]),v!==u.b.FLIP_TILE&&v!==u.b.FLIP_ROW||(D[1]=[1-S,e,1-H,e,1-H,G,1-S,G]),v!==u.b.FLIP_N_ROTATE_TILE&&v!==u.b.FLIP_N_ROTATE_ROW||(D[1]=[S,1-e,H,1-e,H,1-G,S,1-G]);for(F=0;F<g;F++)z.push(s+x,F*P-R+j,0),z.push(s+r+x,F*P-R+j,0),z.push(s+r+x,(F+1)*P-R+j,0),z.push(s+x,(F+1)*P-R+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,h=v===u.b.FLIP_TILE||v===u.b.ROTATE_TILE||v===u.b.FLIP_N_ROTATE_TILE?h.concat(D[(F+1)%2]):v===u.b.FLIP_ROW||v===u.b.ROTATE_ROW||v===u.b.FLIP_N_ROTATE_ROW?h.concat(D[F%2]):h.concat(D[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){var f=[];S=0,e=0,H=r/P,G=1,f[0]=[S,e,H,e,H,G,S,G],f[1]=[S,e,H,e,H,G,S,G],v!==u.b.ROTATE_TILE&&v!==u.b.ROTATE_ROW||(f[1]=[1-S,1-e,1-H,1-e,1-H,1-G,1-S,1-G]),v!==u.b.FLIP_TILE&&v!==u.b.FLIP_ROW||(f[1]=[1-S,e,1-H,e,1-H,G,1-S,G]),v!==u.b.FLIP_N_ROTATE_TILE&&v!==u.b.FLIP_N_ROTATE_ROW||(f[1]=[S,1-e,H,1-e,H,1-G,S,1-G]);for(F=0;F<g;F++)z.push(t-r+x,F*P-R+j,0),z.push(t+x,F*P-R+j,0),z.push(t+x,(F+1)*P-R+j,0),z.push(t-r+x,(F+1)*P-R+j,0),W.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,h=v===u.b.FLIP_TILE||v===u.b.ROTATE_TILE||v===u.b.FLIP_N_ROTATE_TILE?h.concat(f[(F+p)%2]):v===u.b.FLIP_ROW||v===u.b.ROTATE_ROW||v===u.b.FLIP_N_ROTATE_ROW?h.concat(f[F%2]):h.concat(f[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var b=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE;K.b._ComputeSides(b,z,W,E,h,w.frontUVs,w.backUVs);var k=new K.b;k.indices=W,k.positions=z,k.normals=E,k.uvs=h;var C=b===K.b.DOUBLESIDE?n.concat(n):n;return k.colors=C,k}function l(w,v,I){void 0===I&&(I=null);var P=new u.b(w,I);return v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,J(v).applyToMesh(P,v.updatable),P}function R(w){for(var v=w.faceUV||new Array(6),I=w.faceColors,Q=w.pattern||u.b.NO_FLIP,U=w.width||w.size||1,p=w.height||w.size||1,r=w.depth||w.size||1,Y=w.tileWidth||w.tileSize||1,l=w.tileHeight||w.tileSize||1,R=w.alignHorizontal||0,x=w.alignVertical||0,j=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE,s=0;s<6;s++)void 0===v[s]&&(v[s]=new P.p(0,0,1,1)),I&&void 0===I[s]&&(I[s]=new g.f(1,1,1,1));var B=U/2,t=p/2,i=r/2,z=[];for(s=0;s<2;s++)z[s]=J({pattern:Q,tileWidth:Y,tileHeight:l,width:U,height:p,alignVertical:x,alignHorizontal:R,sideOrientation:j});for(s=2;s<4;s++)z[s]=J({pattern:Q,tileWidth:Y,tileHeight:l,width:r,height:p,alignVertical:x,alignHorizontal:R,sideOrientation:j});var E=x;x===u.b.BOTTOM?E=u.b.TOP:x===u.b.TOP&&(E=u.b.BOTTOM);for(s=4;s<6;s++)z[s]=J({pattern:Q,tileWidth:Y,tileHeight:l,width:U,height:r,alignVertical:E,alignHorizontal:R,sideOrientation:j});var o=[],h=[],n=[],W=[],V=[],F=[],O=[],N=[],q=0,m=0;for(s=0;s<6;s++){var c=z[s].positions.length;F[s]=[],O[s]=[];for(var M=0;M<c/3;M++)F[s].push(new P.l(z[s].positions[3*M],z[s].positions[3*M+1],z[s].positions[3*M+2])),O[s].push(new P.l(z[s].normals[3*M],z[s].normals[3*M+1],z[s].normals[3*M+2]));q=z[s].uvs.length,N[s]=[];for(var S=0;S<q;S+=2)N[s][S]=v[s].x+(v[s].z-v[s].x)*z[s].uvs[S],N[s][S+1]=v[s].y+(v[s].w-v[s].y)*z[s].uvs[S+1],a.e.UseOpenGLOrientationForUV&&(N[s][S+1]=1-N[s][S+1]);if(n=n.concat(N[s]),W=W.concat(z[s].indices.map((function(w){return w+m}))),m+=F[s].length,I)for(var e=0;e<4;e++)V.push(I[s].r,I[s].g,I[s].b,I[s].a)}var H=new P.l(0,0,i),G=P.e.RotationY(Math.PI);o=F[0].map((function(w){return P.l.TransformNormal(w,G).add(H)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[]),h=O[0].map((function(w){return P.l.TransformNormal(w,G)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[]),o=o.concat(F[1].map((function(w){return w.subtract(H)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[])),h=h.concat(O[1].map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[]));var L=new P.l(B,0,0),d=P.e.RotationY(-Math.PI/2);o=o.concat(F[2].map((function(w){return P.l.TransformNormal(w,d).add(L)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[])),h=h.concat(O[2].map((function(w){return P.l.TransformNormal(w,d)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[]));var D=P.e.RotationY(Math.PI/2);o=o.concat(F[3].map((function(w){return P.l.TransformNormal(w,D).subtract(L)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[])),h=h.concat(O[3].map((function(w){return P.l.TransformNormal(w,D)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[]));var f=new P.l(0,t,0),b=P.e.RotationX(Math.PI/2);o=o.concat(F[4].map((function(w){return P.l.TransformNormal(w,b).add(f)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[])),h=h.concat(O[4].map((function(w){return P.l.TransformNormal(w,b)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[]));var k=P.e.RotationX(-Math.PI/2);o=o.concat(F[5].map((function(w){return P.l.TransformNormal(w,k).subtract(f)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[])),h=h.concat(O[5].map((function(w){return P.l.TransformNormal(w,k)})).map((function(w){return[w.x,w.y,w.z]})).reduce((function(w,v){return w.concat(v)}),[])),K.b._ComputeSides(j,o,W,h,n);var C=new K.b;if(C.indices=W,C.positions=o,C.normals=h,C.uvs=n,I){var y=j===K.b.DOUBLESIDE?V.concat(V):V;C.colors=y}return C}function x(w,v,I){void 0===I&&(I=null);var P=new u.b(w,I);return v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,R(v).applyToMesh(P,v.updatable),P}K.b.CreateTiledPlane=J;K.b.CreateTiledBox=R;var j=I(71898),s=I(37105),B=I(54044);function t(w){var v=w.height||2,I=0===w.diameterTop?0:w.diameterTop||w.diameter||1,Q=0===w.diameterBottom?0:w.diameterBottom||w.diameter||1;I=I||1e-5,Q=Q||1e-5;var U,p=w.tessellation||24,r=w.subdivisions||1,Y=!!w.hasRings,J=!!w.enclose,l=0===w.cap?0:w.cap||u.b.CAP_ALL,R=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,x=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE,j=w.faceUV||new Array(3),s=w.faceColors,t=2+(1+(1!==R&&J?2:0))*(Y?r:1);for(U=0;U<t;U++)s&&void 0===s[U]&&(s[U]=new g.f(1,1,1,1));for(U=0;U<t;U++)j&&void 0===j[U]&&(j[U]=new P.p(0,0,1,1));var i,z,E,o,h,n,W=new Array,V=new Array,F=new Array,O=new Array,N=new Array,q=2*Math.PI*R/p,m=(Q-I)/2/v,c=P.l.Zero(),M=P.l.Zero(),S=P.l.Zero(),e=P.l.Zero(),H=P.l.Zero(),G=B.c.Y,L=1,d=1,D=0,f=0;for(o=0;o<=r;o++)for(E=((z=o/r)*(I-Q)+Q)/2,L=Y&&0!==o&&o!==r?2:1,n=0;n<L;n++){for(Y&&(d+=n),J&&(d+=2*n),h=0;h<=p;h++)i=h*q,c.x=Math.cos(-i)*E,c.y=-v/2+z*v,c.z=Math.sin(-i)*E,0===I&&o===r?(M.x=F[F.length-3*(p+1)],M.y=F[F.length-3*(p+1)+1],M.z=F[F.length-3*(p+1)+2]):(M.x=c.x,M.z=c.z,M.y=Math.sqrt(M.x*M.x+M.z*M.z)*m,M.normalize()),0===h&&(S.copyFrom(c),e.copyFrom(M)),V.push(c.x,c.y,c.z),F.push(M.x,M.y,M.z),f=Y?D!==d?j[d].y:j[d].w:j[d].y+(j[d].w-j[d].y)*z,O.push(j[d].x+(j[d].z-j[d].x)*h/p,a.e.UseOpenGLOrientationForUV?1-f:f),s&&N.push(s[d].r,s[d].g,s[d].b,s[d].a);1!==R&&J&&(V.push(c.x,c.y,c.z),V.push(0,c.y,0),V.push(0,c.y,0),V.push(S.x,S.y,S.z),P.l.CrossToRef(G,M,H),H.normalize(),F.push(H.x,H.y,H.z,H.x,H.y,H.z),P.l.CrossToRef(e,G,H),H.normalize(),F.push(H.x,H.y,H.z,H.x,H.y,H.z),f=Y?D!==d?j[d+1].y:j[d+1].w:j[d+1].y+(j[d+1].w-j[d+1].y)*z,O.push(j[d+1].x,a.e.UseOpenGLOrientationForUV?1-f:f),O.push(j[d+1].z,a.e.UseOpenGLOrientationForUV?1-f:f),f=Y?D!==d?j[d+2].y:j[d+2].w:j[d+2].y+(j[d+2].w-j[d+2].y)*z,O.push(j[d+2].x,a.e.UseOpenGLOrientationForUV?1-f:f),O.push(j[d+2].z,a.e.UseOpenGLOrientationForUV?1-f:f),s&&(N.push(s[d+1].r,s[d+1].g,s[d+1].b,s[d+1].a),N.push(s[d+1].r,s[d+1].g,s[d+1].b,s[d+1].a),N.push(s[d+2].r,s[d+2].g,s[d+2].b,s[d+2].a),N.push(s[d+2].r,s[d+2].g,s[d+2].b,s[d+2].a))),D!==d&&(D=d)}var b=1!==R&&J?p+4:p;for(o=0,d=0;d<r;d++){var k=0,C=0,y=0,T=0;for(h=0;h<p;h++)k=o*(b+1)+h,C=(o+1)*(b+1)+h,y=o*(b+1)+(h+1),T=(o+1)*(b+1)+(h+1),W.push(k,C,y),W.push(T,y,C);1!==R&&J&&(W.push(k+2,C+2,y+2),W.push(T+2,y+2,C+2),W.push(k+4,C+4,y+4),W.push(T+4,y+4,C+4)),o=Y?o+2:o+1}var Z=function(w){var u=w?I/2:Q/2;if(0!==u){var K,U,r,Y=w?j[t-1]:j[0],g=null;s&&(g=w?s[t-1]:s[0]);var J=V.length/3,l=w?v/2:-v/2,x=new P.l(0,l,0);V.push(x.x,x.y,x.z),F.push(0,w?1:-1,0);var B=Y.y+.5*(Y.w-Y.y);O.push(Y.x+.5*(Y.z-Y.x),a.e.UseOpenGLOrientationForUV?1-B:B),g&&N.push(g.r,g.g,g.b,g.a);var i=new P.k(.5,.5);for(r=0;r<=p;r++){K=2*Math.PI*r*R/p;var z=Math.cos(-K),E=Math.sin(-K);U=new P.l(z*u,l,E*u);var o=new P.k(z*i.x+.5,E*i.y+.5);V.push(U.x,U.y,U.z),F.push(0,w?1:-1,0);var h=Y.y+(Y.w-Y.y)*o.y;O.push(Y.x+(Y.z-Y.x)*o.x,a.e.UseOpenGLOrientationForUV?1-h:h),g&&N.push(g.r,g.g,g.b,g.a)}for(r=0;r<p;r++)w?(W.push(J),W.push(J+(r+2)),W.push(J+(r+1))):(W.push(J),W.push(J+(r+1)),W.push(J+(r+2)))}};l!==u.b.CAP_START&&l!==u.b.CAP_ALL||Z(!1),l!==u.b.CAP_END&&l!==u.b.CAP_ALL||Z(!0),K.b._ComputeSides(x,V,W,F,O,w.frontUVs,w.backUVs);var A=new K.b;return A.indices=W,A.positions=V,A.normals=F,A.uvs=O,s&&(A.colors=N),A}function i(w,v,I){void 0===v&&(v={});var P=new u.b(w,I);return v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,t(v).applyToMesh(P,v.updatable),P}function z(w){for(var v=[],I=[],u=[],Q=[],U=w.diameter||1,p=w.thickness||.5,r=w.tessellation||16,Y=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE,g=r+1,J=0;J<=r;J++)for(var l=J/r,R=J*Math.PI*2/r-Math.PI/2,x=P.e.Translation(U/2,0,0).multiply(P.e.RotationY(R)),j=0;j<=r;j++){var s=1-j/r,B=j*Math.PI*2/r+Math.PI,t=Math.cos(B),i=Math.sin(B),z=new P.l(t,i,0),E=z.scale(p/2),o=new P.k(l,s);E=P.l.TransformCoordinates(E,x),z=P.l.TransformNormal(z,x),I.push(E.x,E.y,E.z),u.push(z.x,z.y,z.z),Q.push(o.x,a.e.UseOpenGLOrientationForUV?1-o.y:o.y);var h=(J+1)%g,n=(j+1)%g;v.push(J*g+j),v.push(J*g+n),v.push(h*g+j),v.push(J*g+n),v.push(h*g+n),v.push(h*g+j)}K.b._ComputeSides(Y,I,v,u,Q,w.frontUVs,w.backUVs);var W=new K.b;return W.indices=v,W.positions=I,W.normals=u,W.uvs=Q,W}function E(w,v,I){void 0===v&&(v={});var P=new u.b(w,I);return v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,z(v).applyToMesh(P,v.updatable),P}K.b.CreateCylinder=t,u.b.CreateCylinder=function(w,v,I,P,Q,K,a,U,p){return void 0!==a&&a instanceof s.d||(void 0!==a&&(p=U||u.b.DEFAULTSIDE,U=a),a=K,K=1),i(w,{height:v,diameterTop:I,diameterBottom:P,tessellation:Q,subdivisions:K,sideOrientation:p,updatable:U},a)};function o(w){var v,I,u=new Array,Q=new Array,U=new Array,p=new Array,r=w.radius||2,Y=w.tube||.5,g=w.radialSegments||32,J=w.tubularSegments||32,l=w.p||2,R=w.q||3,x=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE,j=function(w){var v=Math.cos(w),I=Math.sin(w),u=R/l*w,Q=Math.cos(u),K=r*(2+Q)*.5*v,a=r*(2+Q)*I*.5,U=r*Math.sin(u)*.5;return new P.l(K,a,U)};for(v=0;v<=g;v++){var s=v%g/g*2*l*Math.PI,B=j(s),t=j(s+.01),i=t.subtract(B),z=t.add(B),E=P.l.Cross(i,z);for(z=P.l.Cross(E,i),E.normalize(),z.normalize(),I=0;I<J;I++){var o=I%J/J*2*Math.PI,h=-Y*Math.cos(o),n=Y*Math.sin(o);Q.push(B.x+h*z.x+n*E.x),Q.push(B.y+h*z.y+n*E.y),Q.push(B.z+h*z.z+n*E.z),p.push(v/g),p.push(a.e.UseOpenGLOrientationForUV?1-I/J:I/J)}}for(v=0;v<g;v++)for(I=0;I<J;I++){var W=(I+1)%J,V=v*J+I,F=(v+1)*J+I,O=(v+1)*J+W,N=v*J+W;u.push(N),u.push(F),u.push(V),u.push(N),u.push(O),u.push(F)}K.b.ComputeNormals(Q,u,U),K.b._ComputeSides(x,Q,u,U,p,w.frontUVs,w.backUVs);var q=new K.b;return q.indices=u,q.positions=Q,q.normals=U,q.uvs=p,q}function h(w,v,I){void 0===v&&(v={});var P=new u.b(w,I);return v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,o(v).applyToMesh(P,v.updatable),P}K.b.CreateTorus=z,u.b.CreateTorus=function(w,v,I,P,u,Q,K){return E(w,{diameter:v,thickness:I,tessellation:P,sideOrientation:K,updatable:Q},u)};K.b.CreateTorusKnot=o,u.b.CreateTorusKnot=function(w,v,I,P,u,Q,K,a,U,p){return h(w,{radius:v,tube:I,radialSegments:P,tubularSegments:u,p:Q,q:K,sideOrientation:p,updatable:U},a)};var n=I(55706),W=I(78502),V=I(9127),F=I(12476),O=I(61686),N=I(78588),q=function(w){function v(v,I){var P=w.call(this,v.x,v.y)||this;return P.index=I,P}return(0,W.m)(v,w),v}(P.k),m=function(){function w(){this.elements=new Array}return w.prototype.add=function(w){var v=this,I=new Array;return w.forEach((function(w){var P=new q(w,v.elements.length);I.push(P),v.elements.push(P)})),I},w.prototype.computeBounds=function(){var w=new P.k(this.elements[0].x,this.elements[0].y),v=new P.k(this.elements[0].x,this.elements[0].y);return this.elements.forEach((function(I){I.x<w.x?w.x=I.x:I.x>v.x&&(v.x=I.x),I.y<w.y?w.y=I.y:I.y>v.y&&(v.y=I.y)})),{min:w,max:v,width:v.x-w.x,height:v.y-w.y}},w}(),c=(function(){function w(){}w.Rectangle=function(w,v,I,u){return[new P.k(w,v),new P.k(I,v),new P.k(I,u),new P.k(w,u)]},w.Circle=function(w,v,I,u){void 0===v&&(v=0),void 0===I&&(I=0),void 0===u&&(u=32);for(var Q=new Array,K=0,a=2*Math.PI/u,U=0;U<u;U++)Q.push(new P.k(v+Math.cos(K)*w,I+Math.sin(K)*w)),K-=a;return Q},w.Parse=function(w){var v,I=w.split(/[^-+eE.\d]+/).map(parseFloat).filter((function(w){return!isNaN(w)})),u=[];for(v=0;v<(2147483646&I.length);v+=2)u.push(new P.k(I[v],I[v+1]));return u},w.StartingAt=function(w,v){return F.e.StartingAt(w,v)}}(),function(){function w(w,v,I,P){var u;void 0===P&&(P=earcut),this._points=new m,this._outlinepoints=new m,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=P,this._name=w,this._scene=I||N.e.LastCreatedScene,u=v instanceof F.e?v.getPoints():v,this._addToepoint(u),this._points.add(u),this._outlinepoints.add(u),"undefined"===typeof this.bjsEarcut&&V.e.Warn("Earcut was not found, the polygon will not be built.")}return w.prototype._addToepoint=function(w){for(var v=0,I=w;v<I.length;v++){var P=I[v];this._epoints.push(P.x,P.y)}},w.prototype.addHole=function(w){this._points.add(w);var v=new m;return v.add(w),this._holes.push(v),this._eholes.push(this._epoints.length/2),this._addToepoint(w),this},w.prototype.build=function(w,v,I){void 0===w&&(w=!1),void 0===v&&(v=0),void 0===I&&(I=2);var P=new u.b(this._name,this._scene),K=this.buildVertexData(v,I);return P.setVerticesData(Q.f.PositionKind,K.positions,w),P.setVerticesData(Q.f.NormalKind,K.normals,w),P.setVerticesData(Q.f.UVKind,K.uvs,w),P.setIndices(K.indices),P},w.prototype.buildVertexData=function(w,v){var I=this;void 0===w&&(w=0),void 0===v&&(v=2);var P=new K.b,u=new Array,Q=new Array,a=new Array,U=this._points.computeBounds();this._points.elements.forEach((function(w){u.push(0,1,0),Q.push(w.x,0,w.y),a.push((w.x-U.min.x)/U.width,(w.y-U.min.y)/U.height)}));for(var p=new Array,r=this.bjsEarcut(this._epoints,this._eholes,2),Y=0;Y<r.length;Y++)p.push(r[Y]);if(w>0){var g=Q.length/3;this._points.elements.forEach((function(v){u.push(0,-1,0),Q.push(v.x,-w,v.y),a.push(1-(v.x-U.min.x)/U.width,1-(v.y-U.min.y)/U.height)}));var J=p.length;for(Y=0;Y<J;Y+=3){var l=p[Y+0],R=p[Y+1],x=p[Y+2];p.push(x+g),p.push(R+g),p.push(l+g)}this._addSide(Q,u,a,p,U,this._outlinepoints,w,!1,v),this._holes.forEach((function(P){I._addSide(Q,u,a,p,U,P,w,!0,v)}))}return P.indices=p,P.positions=Q,P.normals=u,P.uvs=a,P},w.prototype._addSide=function(w,v,I,u,Q,K,a,U,p){for(var r=w.length/3,Y=0,g=0;g<K.elements.length;g++){var J=K.elements[g],l=K.elements[(g+1)%K.elements.length];w.push(J.x,0,J.y),w.push(J.x,-a,J.y),w.push(l.x,0,l.y),w.push(l.x,-a,l.y);var R=K.elements[(g+K.elements.length-1)%K.elements.length],x=K.elements[(g+2)%K.elements.length],j=new P.l(-(l.y-J.y),0,l.x-J.x),s=new P.l(-(J.y-R.y),0,J.x-R.x),B=new P.l(-(x.y-l.y),0,x.x-l.x);U||(j=j.scale(-1),s=s.scale(-1),B=B.scale(-1));var t=j.normalizeToNew(),i=s.normalizeToNew(),z=B.normalizeToNew(),E=P.l.Dot(i,t);i=E>p?E<O.e-1?new P.l(J.x,0,J.y).subtract(new P.l(l.x,0,l.y)).normalize():s.add(j).normalize():t;var o=P.l.Dot(B,j);z=o>p?o<O.e-1?new P.l(l.x,0,l.y).subtract(new P.l(J.x,0,J.y)).normalize():B.add(j).normalize():t,I.push(Y/Q.width,0),I.push(Y/Q.width,1),Y+=j.length(),I.push(Y/Q.width,0),I.push(Y/Q.width,1),v.push(i.x,i.y,i.z),v.push(i.x,i.y,i.z),v.push(z.x,z.y,z.z),v.push(z.x,z.y,z.z),U?(u.push(r),u.push(r+2),u.push(r+1),u.push(r+1),u.push(r+2),u.push(r+3)):(u.push(r),u.push(r+1),u.push(r+2),u.push(r+1),u.push(r+3),u.push(r+2)),r+=4}},w}());function M(w,v,I,u,U,p,r){for(var Y=I||new Array(3),J=u,l=[],R=r||!1,x=0;x<3;x++)void 0===Y[x]&&(Y[x]=new P.p(0,0,1,1)),J&&void 0===J[x]&&(J[x]=new g.f(1,1,1,1));var j=w.getVerticesData(Q.f.PositionKind),s=w.getVerticesData(Q.f.NormalKind),B=w.getVerticesData(Q.f.UVKind),t=w.getIndices(),i=j.length/9,z=0,E=0,o=0,h=0,n=[0];if(R)for(var W=i;W<j.length/3;W+=4)E=j[3*(W+2)]-j[3*W],o=j[3*(W+2)+2]-j[3*W+2],h+=Math.sqrt(E*E+o*o),n.push(h);for(var V=0,F=0,O=0;O<s.length;O+=3)Math.abs(s[O+1])<.001&&(F=1),Math.abs(s[O+1]-1)<.001&&(F=0),Math.abs(s[O+1]+1)<.001&&(F=2),V=O/3,1===F?(z=V-i,B[2*V]=z%4<1.5?R?Y[F].x+(Y[F].z-Y[F].x)*n[Math.floor(z/4)]/h:Y[F].x:R?Y[F].x+(Y[F].z-Y[F].x)*n[Math.floor(z/4)+1]/h:Y[F].z,B[2*V+1]=z%2===0?a.e.UseOpenGLOrientationForUV?1-Y[F].w:Y[F].w:a.e.UseOpenGLOrientationForUV?1-Y[F].y:Y[F].y):(B[2*V]=(1-B[2*V])*Y[F].x+B[2*V]*Y[F].z,B[2*V+1]=(1-B[2*V+1])*Y[F].y+B[2*V+1]*Y[F].w,a.e.UseOpenGLOrientationForUV&&(B[2*V+1]=1-B[2*V+1])),J&&l.push(J[F].r,J[F].g,J[F].b,J[F].a);K.b._ComputeSides(v,j,t,s,B,U,p);var N=new K.b;if(N.indices=t,N.positions=j,N.normals=s,N.uvs=B,J){var q=v===K.b.DOUBLESIDE?l.concat(l):l;N.colors=q}return N}function S(w,v,I,Q){void 0===I&&(I=null),void 0===Q&&(Q=earcut),v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation);for(var K=v.shape,a=v.holes||[],U=v.depth||0,p=v.smoothingThreshold||2,r=[],Y=[],g=0;g<K.length;g++)r[g]=new P.k(K[g].x,K[g].z);r[0].equalsWithEpsilon(r[r.length-1],1e-8)&&r.pop();for(var J=new c(w,r,I||N.e.LastCreatedScene,Q),l=0;l<a.length;l++){Y=[];for(var R=0;R<a[l].length;R++)Y.push(new P.k(a[l][R].x,a[l][R].z));J.addHole(Y)}var x=J.build(!1,U,p);return x._originalBuilderSideOrientation=v.sideOrientation,M(x,v.sideOrientation,v.faceUV,v.faceColors,v.frontUVs,v.backUVs,v.wrap).applyToMesh(x,v.updatable),x}function e(w,v,I,P){return void 0===I&&(I=null),void 0===P&&(P=earcut),S(w,v,I,P)}function H(w,v,I){void 0===I&&(I=null);var P=v.path,Q=v.shape,K=v.scale||1,a=v.rotation||0,U=0===v.cap?0:v.cap||u.b.NO_CAP,p=v.updatable,r=u.b._GetDefaultSideOrientation(v.sideOrientation),Y=v.instance||null,g=v.invertUV||!1,J=v.closeShape||!1;return L(w,Q,P,K,a,null,null,v.closePath||!1,J,U,!1,I,!!p,r,Y,g,v.frontUVs||null,v.backUVs||null,v.firstNormal||null,!!v.adjustFrame)}function G(w,v,I){void 0===I&&(I=null);var P=v.path,Q=v.shape,K=v.scaleFunction||function(){return 1},a=v.rotationFunction||function(){return 0},U=v.closePath||v.ribbonCloseArray||!1,p=v.closeShape||v.ribbonClosePath||!1,r=0===v.cap?0:v.cap||u.b.NO_CAP,Y=v.updatable,g=v.firstNormal||null,J=v.adjustFrame||!1;return L(w,Q,P,null,null,K,a,U,p,r,!0,I,!!Y,u.b._GetDefaultSideOrientation(v.sideOrientation),v.instance||null,v.invertUV||!1,v.frontUVs||null,v.backUVs||null,g,J)}function L(w,v,I,Q,K,a,U,r,Y,g,J,l,R,x,j,s,B,t,i,z){var E,o,h=function(w,v,I,Q,K,a,U,p,r,Y,g){var J=I.getTangents(),l=I.getNormals(),R=I.getBinormals(),x=I.getDistances();if(g)for(var j=0;j<J.length;j++)if(0==J[j].x&&0==J[j].y&&0==J[j].z&&J[j].copyFrom(J[j-1]),0==l[j].x&&0==l[j].y&&0==l[j].z&&l[j].copyFrom(l[j-1]),0==R[j].x&&0==R[j].y&&0==R[j].z&&R[j].copyFrom(R[j-1]),j>0){var s=J[j-1];P.l.Dot(s,J[j])<0&&J[j].scaleInPlace(-1),s=l[j-1],P.l.Dot(s,l[j])<0&&l[j].scaleInPlace(-1),s=R[j-1],P.l.Dot(s,R[j])<0&&R[j].scaleInPlace(-1)}var B=0,t=Y&&p?p:function(){return null!==a?a:0},i=Y&&U?U:function(){return null!==K?K:1},z=r===u.b.NO_CAP||r===u.b.CAP_END?0:2,E=P.i.Matrix[0];for(j=0;j<v.length;j++){var o=new Array,h=t(j,x[j]),n=i(j,x[j]);P.e.RotationAxisToRef(J[j],B,E);for(var W=0;W<w.length;W++){var V=J[j].scale(w[W].z).add(l[j].scale(w[W].x)).add(R[j].scale(w[W].y)),F=P.l.Zero();P.l.TransformCoordinatesToRef(V,E,F),F.scaleInPlace(n).addInPlace(v[j]),o[W]=F}Q[z]=o,B+=h,z++}var O=function(w){var v,I=Array(),u=P.l.Zero();for(v=0;v<w.length;v++)u.addInPlace(w[v]);for(u.scaleInPlace(1/w.length),v=0;v<w.length;v++)I.push(u);return I};switch(r){case u.b.NO_CAP:break;case u.b.CAP_START:Q[0]=O(Q[2]),Q[1]=Q[2];break;case u.b.CAP_END:Q[z]=Q[z-1],Q[z+1]=O(Q[z-1]);break;case u.b.CAP_ALL:Q[0]=O(Q[2]),Q[1]=Q[2],Q[z]=Q[z-1],Q[z+1]=O(Q[z-1])}return Q};if(j){var n=j._creationDataStorage;return E=i?n.path3D.update(I,i):n.path3D.update(I),j=p("",{pathArray:o=h(v,I,n.path3D,n.pathArray,Q,K,a,U,n.cap,J,z),closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:j},l||void 0)}g=g<0||g>3?0:g;var W=p(w,{pathArray:o=h(v,I,E=i?new F.i(I,i):new F.i(I),new Array,Q,K,a,U,g,J,z),closeArray:r,closePath:Y,updatable:R,sideOrientation:x,invertUV:s,frontUVs:B||void 0,backUVs:t||void 0},l);return W._creationDataStorage.pathArray=o,W._creationDataStorage.path3D=E,W._creationDataStorage.cap=g,W}K.b.CreatePolygon=M,u.b.CreatePolygon=function(w,v,I,P,u,Q,K){return void 0===K&&(K=earcut),S(w,{shape:v,holes:P,updatable:u,sideOrientation:Q},I,K)},u.b.ExtrudePolygon=function(w,v,I,P,u,Q,K,a){return void 0===a&&(a=earcut),e(w,{shape:v,holes:u,depth:I,updatable:Q,sideOrientation:K},P,a)};function d(w,v,I){void 0===I&&(I=null);var Q,K,a=v.arc?v.arc<=0||v.arc>1?1:v.arc:1,U=void 0===v.closed||v.closed,r=v.shape,Y=v.radius||1,g=v.tessellation||64,J=v.clip||0,l=v.updatable,R=u.b._GetDefaultSideOrientation(v.sideOrientation),x=v.cap||u.b.NO_CAP,j=2*Math.PI,s=new Array,B=v.invertUV||!1,t=0,i=0,z=j/g*a;for(t=0;t<=g-J;t++){for(K=[],x!=u.b.CAP_START&&x!=u.b.CAP_ALL||(K.push(new P.l(0,r[0].y,0)),K.push(new P.l(Math.cos(t*z)*r[0].x*Y,r[0].y,Math.sin(t*z)*r[0].x*Y))),i=0;i<r.length;i++)Q=new P.l(Math.cos(t*z)*r[i].x*Y,r[i].y,Math.sin(t*z)*r[i].x*Y),K.push(Q);x!=u.b.CAP_END&&x!=u.b.CAP_ALL||(K.push(new P.l(Math.cos(t*z)*r[r.length-1].x*Y,r[r.length-1].y,Math.sin(t*z)*r[r.length-1].x*Y)),K.push(new P.l(0,r[r.length-1].y,0))),s.push(K)}return p(w,{pathArray:s,closeArray:U,sideOrientation:R,updatable:l,invertUV:B,frontUVs:v.frontUVs,backUVs:v.backUVs},I)}u.b.ExtrudeShape=function(w,v,I,P,Q,K,a,U,p,r){return void 0===a&&(a=null),H(w,{shape:v,path:I,scale:P,rotation:Q,cap:0===K?0:K||u.b.NO_CAP,sideOrientation:p,instance:r,updatable:U},a)},u.b.ExtrudeShapeCustom=function(w,v,I,P,Q,K,a,U,p,r,Y,g){return G(w,{shape:v,path:I,scaleFunction:P,rotationFunction:Q,ribbonCloseArray:K,ribbonClosePath:a,cap:0===U?0:U||u.b.NO_CAP,sideOrientation:Y,instance:g,updatable:r},p)};u.b.CreateLathe=function(w,v,I,P,u,Q,K){return d(w,{shape:v,radius:I,tessellation:P,sideOrientation:K,updatable:Q},u)};var D=I(49620);u.b._GroundMeshParser=function(w,v){return f.Parse(w,v)};var f=function(w){function v(v,I){var P=w.call(this,v,I)||this;return P.generateOctree=!1,P}return(0,W.m)(v,w),v.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(v.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),v.prototype.optimize=function(w,v){void 0===v&&(v=32),this._subdivisionsX=w,this._subdivisionsY=w,this.subdivide(w);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(v)},v.prototype.getHeightAtCoordinates=function(w,v){var I=this.getWorldMatrix(),u=P.i.Matrix[5];I.invertToRef(u);var Q=P.i.Vector3[8];if(P.l.TransformCoordinatesFromFloatsToRef(w,0,v,u,Q),w=Q.x,v=Q.z,w<this._minX||w>this._maxX||v<this._minZ||v>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var K=this._getFacetAt(w,v),a=-(K.x*w+K.z*v+K.w)/K.y;return P.l.TransformCoordinatesFromFloatsToRef(0,a,0,I,Q),Q.y},v.prototype.getNormalAtCoordinates=function(w,v){var I=new P.l(0,1,0);return this.getNormalAtCoordinatesToRef(w,v,I),I},v.prototype.getNormalAtCoordinatesToRef=function(w,v,I){var u=this.getWorldMatrix(),Q=P.i.Matrix[5];u.invertToRef(Q);var K=P.i.Vector3[8];if(P.l.TransformCoordinatesFromFloatsToRef(w,0,v,Q,K),w=K.x,v=K.z,w<this._minX||w>this._maxX||v<this._minZ||v>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(w,v);return P.l.TransformNormalFromFloatsToRef(a.x,a.y,a.z,u,I),this},v.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},v.prototype._getFacetAt=function(w,v){var I=Math.floor((w+this._maxX)*this._subdivisionsX/this._width),P=Math.floor(-(v+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),u=this._heightQuads[P*this._subdivisionsX+I];return v<u.slope.x*w+u.slope.y?u.facet1:u.facet2},v.prototype._initHeightQuads=function(){var w=this._subdivisionsX,v=this._subdivisionsY;this._heightQuads=new Array;for(var I=0;I<v;I++)for(var u=0;u<w;u++){var Q={slope:P.k.Zero(),facet1:new P.p(0,0,0,0),facet2:new P.p(0,0,0,0)};this._heightQuads[I*w+u]=Q}return this},v.prototype._computeHeightQuads=function(){var w=this.getVerticesData(Q.f.PositionKind);if(!w)return this;for(var v=P.i.Vector3[3],I=P.i.Vector3[2],u=P.i.Vector3[1],K=P.i.Vector3[0],a=P.i.Vector3[4],U=P.i.Vector3[5],p=P.i.Vector3[6],r=P.i.Vector3[7],Y=P.i.Vector3[8],g=0,J=0,l=0,R=0,x=0,j=0,s=0,B=this._subdivisionsX,t=this._subdivisionsY,i=0;i<t;i++)for(var z=0;z<B;z++){g=3*z,J=i*(B+1)*3,l=(i+1)*(B+1)*3,v.x=w[J+g],v.y=w[J+g+1],v.z=w[J+g+2],I.x=w[J+g+3],I.y=w[J+g+4],I.z=w[J+g+5],u.x=w[l+g],u.y=w[l+g+1],u.z=w[l+g+2],K.x=w[l+g+3],K.y=w[l+g+4],K.z=w[l+g+5],R=(K.z-v.z)/(K.x-v.x),x=v.z-R*v.x,I.subtractToRef(v,a),u.subtractToRef(v,U),K.subtractToRef(v,p),P.l.CrossToRef(p,U,r),P.l.CrossToRef(a,p,Y),r.normalize(),Y.normalize(),j=-(r.x*v.x+r.y*v.y+r.z*v.z),s=-(Y.x*I.x+Y.y*I.y+Y.z*I.z);var E=this._heightQuads[i*B+z];E.slope.copyFromFloats(R,x),E.facet1.copyFromFloats(r.x,r.y,r.z,j),E.facet2.copyFromFloats(Y.x,Y.y,Y.z,s)}return this},v.prototype.serialize=function(v){w.prototype.serialize.call(this,v),v.subdivisionsX=this._subdivisionsX,v.subdivisionsY=this._subdivisionsY,v.minX=this._minX,v.maxX=this._maxX,v.minZ=this._minZ,v.maxZ=this._maxZ,v.width=this._width,v.height=this._height},v.Parse=function(w,I){var P=new v(w.name,I);return P._subdivisionsX=w.subdivisionsX||1,P._subdivisionsY=w.subdivisionsY||1,P._minX=w.minX,P._maxX=w.maxX,P._minZ=w.minZ,P._maxZ=w.maxZ,P._width=w.width,P._height=w.height,P},v}(u.b),b=I(9217);function k(w){var v,I,u=[],Q=[],U=[],p=[],r=w.width||1,Y=w.height||1,g=w.subdivisionsX||w.subdivisions||1,J=w.subdivisionsY||w.subdivisions||1;for(v=0;v<=J;v++)for(I=0;I<=g;I++){var l=new P.l(I*r/g-r/2,0,(J-v)*Y/J-Y/2),R=new P.l(0,1,0);Q.push(l.x,l.y,l.z),U.push(R.x,R.y,R.z),p.push(I/g,a.e.UseOpenGLOrientationForUV?v/J:1-v/J)}for(v=0;v<J;v++)for(I=0;I<g;I++)u.push(I+1+(v+1)*(g+1)),u.push(I+1+v*(g+1)),u.push(I+v*(g+1)),u.push(I+(v+1)*(g+1)),u.push(I+1+(v+1)*(g+1)),u.push(I+v*(g+1));var x=new K.b;return x.indices=u,x.positions=Q,x.normals=U,x.uvs=p,x}function C(w){var v,I,u,Q,a=void 0!==w.xmin&&null!==w.xmin?w.xmin:-1,U=void 0!==w.zmin&&null!==w.zmin?w.zmin:-1,p=void 0!==w.xmax&&null!==w.xmax?w.xmax:1,r=void 0!==w.zmax&&null!==w.zmax?w.zmax:1,Y=w.subdivisions||{w:1,h:1},g=w.precision||{w:1,h:1},J=new Array,l=new Array,R=new Array,x=new Array;Y.h=Y.h<1?1:Y.h,Y.w=Y.w<1?1:Y.w,g.w=g.w<1?1:g.w,g.h=g.h<1?1:g.h;var j=(p-a)/Y.w,s=(r-U)/Y.h;function B(w,u,Q,K){var a=l.length/3,U=g.w+1;for(v=0;v<g.h;v++)for(I=0;I<g.w;I++){var p=[a+I+v*U,a+(I+1)+v*U,a+(I+1)+(v+1)*U,a+I+(v+1)*U];J.push(p[1]),J.push(p[2]),J.push(p[3]),J.push(p[0]),J.push(p[1]),J.push(p[3])}var r=P.l.Zero(),Y=new P.l(0,1,0);for(v=0;v<=g.h;v++)for(r.z=v*(K-u)/g.h+u,I=0;I<=g.w;I++)r.x=I*(Q-w)/g.w+w,r.y=0,l.push(r.x,r.y,r.z),R.push(Y.x,Y.y,Y.z),x.push(I/g.w,v/g.h)}for(u=0;u<Y.h;u++)for(Q=0;Q<Y.w;Q++)B(a+Q*j,U+u*s,a+(Q+1)*j,U+(u+1)*s);var t=new K.b;return t.indices=J,t.positions=l,t.normals=R,t.uvs=x,t}function y(w){var v,I,u=[],Q=[],a=[],U=[],p=w.colorFilter||new g.b(.3,.59,.11),r=w.alphaFilter||0,Y=!1;if(w.minHeight>w.maxHeight){Y=!0;var J=w.maxHeight;w.maxHeight=w.minHeight,w.minHeight=J}for(v=0;v<=w.subdivisions;v++)for(I=0;I<=w.subdivisions;I++){var l=new P.l(I*w.width/w.subdivisions-w.width/2,0,(w.subdivisions-v)*w.height/w.subdivisions-w.height/2),R=4*(((l.x+w.width/2)/w.width*(w.bufferWidth-1)|0)+((1-(l.z+w.height/2)/w.height)*(w.bufferHeight-1)|0)*w.bufferWidth),x=w.buffer[R]/255,j=w.buffer[R+1]/255,s=w.buffer[R+2]/255,B=w.buffer[R+3]/255;Y&&(x=1-x,j=1-j,s=1-s);var t=x*p.r+j*p.g+s*p.b;l.y=B>=r?w.minHeight+(w.maxHeight-w.minHeight)*t:w.minHeight-O.e,Q.push(l.x,l.y,l.z),a.push(0,0,0),U.push(I/w.subdivisions,1-v/w.subdivisions)}for(v=0;v<w.subdivisions;v++)for(I=0;I<w.subdivisions;I++){var i=I+1+(v+1)*(w.subdivisions+1),z=I+1+v*(w.subdivisions+1),E=I+v*(w.subdivisions+1),o=I+(v+1)*(w.subdivisions+1),h=Q[3*i+1]>=w.minHeight,n=Q[3*z+1]>=w.minHeight,W=Q[3*E+1]>=w.minHeight;h&&n&&W&&(u.push(i),u.push(z),u.push(E)),Q[3*o+1]>=w.minHeight&&h&&W&&(u.push(o),u.push(i),u.push(E))}K.b.ComputeNormals(Q,u,a);var V=new K.b;return V.indices=u,V.positions=Q,V.normals=a,V.uvs=U,V}function T(w,v,I){void 0===v&&(v={});var P=new f(w,I);return P._setReady(!1),P._subdivisionsX=v.subdivisionsX||v.subdivisions||1,P._subdivisionsY=v.subdivisionsY||v.subdivisions||1,P._width=v.width||1,P._height=v.height||1,P._maxX=P._width/2,P._maxZ=P._height/2,P._minX=-P._maxX,P._minZ=-P._maxZ,k(v).applyToMesh(P,v.updatable),P._setReady(!0),P}function Z(w,v,I){void 0===I&&(I=null);var P=new u.b(w,I);return C(v).applyToMesh(P,v.updatable),P}function A(w,v,I,P){void 0===I&&(I={}),void 0===P&&(P=null);var u=I.width||10,Q=I.height||10,K=I.subdivisions||1,a=I.minHeight||0,U=I.maxHeight||1,p=I.colorFilter||new g.b(.3,.59,.11),r=I.alphaFilter||0,Y=I.updatable,J=I.onReady;P=P||N.e.LastCreatedScene;var l=new f(w,P);l._subdivisionsX=K,l._subdivisionsY=K,l._width=u,l._height=Q,l._maxX=l._width/2,l._maxZ=l._height/2,l._minX=-l._maxX,l._minZ=-l._maxZ,l._setReady(!1);return b.i.LoadImage(v,(function(w){var v=w.width,I=w.height;if(!P.isDisposed){var g=null===P||void 0===P?void 0:P.getEngine().resizeImageBitmap(w,v,I);y({width:u,height:Q,subdivisions:K,minHeight:a,maxHeight:U,colorFilter:p,buffer:g,bufferWidth:v,bufferHeight:I,alphaFilter:r}).applyToMesh(l,Y),J&&J(l),l._setReady(!0)}}),(function(){}),P.offlineProvider),l}function X(w,v,I){void 0===I&&(I=null);var Q=v.path,K=v.instance,a=1;void 0!==v.radius?a=v.radius:K&&(a=K._creationDataStorage.radius);var U=v.tessellation||64,r=v.radiusFunction||null,Y=v.cap||u.b.NO_CAP,g=v.invertUV||!1,J=v.updatable,l=u.b._GetDefaultSideOrientation(v.sideOrientation);v.arc=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1;var R,x,j=function(w,v,I,Q,K,a,U,p){for(var r,Y,g,J,l=v.getTangents(),R=v.getNormals(),x=v.getDistances(),j=2*Math.PI/K*p,s=a||function(){return Q},B=P.i.Matrix[0],t=U===u.b.NO_CAP||U===u.b.CAP_END?0:2,i=0;i<w.length;i++){Y=s(i,x[i]),r=Array(),g=R[i];for(var z=0;z<K;z++)P.e.RotationAxisToRef(l[i],j*z,B),J=r[z]?r[z]:P.l.Zero(),P.l.TransformCoordinatesToRef(g,B,J),J.scaleInPlace(Y).addInPlace(w[i]),r[z]=J;I[t]=r,t++}var E=function(v,I){for(var P=Array(),u=0;u<v;u++)P.push(w[I]);return P};switch(U){case u.b.NO_CAP:break;case u.b.CAP_START:I[0]=E(K,0),I[1]=I[2].slice(0);break;case u.b.CAP_END:I[t]=I[t-1].slice(0),I[t+1]=E(K,w.length-1);break;case u.b.CAP_ALL:I[0]=E(K,0),I[1]=I[2].slice(0),I[t]=I[t-1].slice(0),I[t+1]=E(K,w.length-1)}return I};if(K){var s=K._creationDataStorage,B=v.arc||s.arc;return K=p("",{pathArray:x=j(Q,R=s.path3D.update(Q),s.pathArray,a,s.tessellation,r,s.cap,B),instance:K}),s.path3D=R,s.pathArray=x,s.arc=B,s.radius=a,K}Y=Y<0||Y>3?0:Y;var t=p(w,{pathArray:x=j(Q,R=new F.i(Q),new Array,a,U,r,Y,v.arc),closePath:!0,closeArray:!1,updatable:J,sideOrientation:l,invertUV:g,frontUVs:v.frontUVs,backUVs:v.backUVs},I);return t._creationDataStorage.pathArray=x,t._creationDataStorage.path3D=R,t._creationDataStorage.tessellation=U,t._creationDataStorage.cap=Y,t._creationDataStorage.arc=v.arc,t._creationDataStorage.radius=a,t}K.b.CreateGround=k,K.b.CreateTiledGround=C,K.b.CreateGroundFromHeightMap=y,u.b.CreateGround=function(w,v,I,P,u,Q){return T(w,{width:v,height:I,subdivisions:P,updatable:Q},u)},u.b.CreateTiledGround=function(w,v,I,P,u,Q,K,a,U){return Z(w,{xmin:v,zmin:I,xmax:P,zmax:u,subdivisions:Q,precision:K,updatable:U},a)},u.b.CreateGroundFromHeightMap=function(w,v,I,P,u,Q,K,a,U,p,r){return A(w,v,{width:I,height:P,subdivisions:u,minHeight:Q,maxHeight:K,updatable:U,onReady:p,alphaFilter:r},a)};function ww(w){var v=[];v[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},v[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},v[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},v[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},v[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},v[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},v[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},v[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},v[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},v[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},v[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},v[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},v[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},v[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},v[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var I,u,Q,U,p,r,Y=w.type&&(w.type<0||w.type>=v.length)?0:w.type||0,J=w.size,l=w.sizeX||J||1,R=w.sizeY||J||1,x=w.sizeZ||J||1,j=w.custom||v[Y],s=j.face.length,B=w.faceUV||new Array(s),t=w.faceColors,i=void 0===w.flat||w.flat,z=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE,E=new Array,o=new Array,h=new Array,n=new Array,W=new Array,V=0,F=0,O=new Array,N=0,q=0;if(i)for(q=0;q<s;q++)t&&void 0===t[q]&&(t[q]=new g.f(1,1,1,1)),B&&void 0===B[q]&&(B[q]=new P.p(0,0,1,1));if(i)for(q=0;q<s;q++){var m=j.face[q].length;for(Q=2*Math.PI/m,U=.5*Math.tan(Q/2),p=.5,N=0;N<m;N++)E.push(j.vertex[j.face[q][N]][0]*l,j.vertex[j.face[q][N]][1]*R,j.vertex[j.face[q][N]][2]*x),O.push(V),V++,I=B[q].x+(B[q].z-B[q].x)*(.5+U),u=B[q].y+(B[q].w-B[q].y)*(p-.5),n.push(I,a.e.UseOpenGLOrientationForUV?1-u:u),r=U*Math.cos(Q)-p*Math.sin(Q),p=U*Math.sin(Q)+p*Math.cos(Q),U=r,t&&W.push(t[q].r,t[q].g,t[q].b,t[q].a);for(N=0;N<m-2;N++)o.push(O[0+F],O[N+2+F],O[N+1+F]);F+=m}else{for(N=0;N<j.vertex.length;N++)E.push(j.vertex[N][0]*l,j.vertex[N][1]*R,j.vertex[N][2]*x),n.push(0,a.e.UseOpenGLOrientationForUV?1:0);for(q=0;q<s;q++)for(N=0;N<j.face[q].length-2;N++)o.push(j.face[q][0],j.face[q][N+2],j.face[q][N+1])}K.b.ComputeNormals(E,o,h),K.b._ComputeSides(z,E,o,h,n,w.frontUVs,w.backUVs);var c=new K.b;return c.positions=E,c.indices=o,c.normals=h,c.uvs=n,t&&i&&(c.colors=W),c}function vw(w,v,I){void 0===v&&(v={}),void 0===I&&(I=null);var P=new u.b(w,I);return v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,ww(v).applyToMesh(P,v.updatable),P}u.b.CreateTube=function(w,v,I,P,u,Q,K,a,U,p){return X(w,{path:v,radius:I,tessellation:P,radiusFunction:u,arc:1,cap:Q,updatable:a,sideOrientation:U,instance:p},K)};function Iw(w){var v,I=w.sideOrientation||K.b.DEFAULTSIDE,u=w.radius||1,Q=void 0===w.flat||w.flat,U=w.subdivisions||4,p=w.radiusX||u,r=w.radiusY||u,Y=w.radiusZ||u,g=(1+Math.sqrt(5))/2,J=[-1,g,-0,1,g,0,-1,-g,0,1,-g,0,0,-1,-g,0,1,-g,0,-1,g,0,1,g,g,0,1,g,0,-1,-g,0,1,-g,0,-1],l=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],R=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],x=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],j=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],s=new Array,B=new Array,t=new Array,i=new Array,z=0,E=new Array(3),o=new Array(3);for(v=0;v<3;v++)E[v]=P.l.Zero(),o[v]=P.k.Zero();for(var h=0;h<20;h++){for(v=0;v<3;v++){var n=l[3*h+v];E[v].copyFromFloats(J[3*R[n]],J[3*R[n]+1],J[3*R[n]+2]),E[v].normalize().scaleInPlace(u),o[v].copyFromFloats(.134765625*x[2*n]+.05859375+-.0390625*j[h],.2333984375*x[2*n+1]+.025390625+.01953125*j[h])}for(var W=function(w,v,I,u){var K,g=P.l.Lerp(E[0],E[2],v/U),J=P.l.Lerp(E[1],E[2],v/U),l=U===v?E[2]:P.l.Lerp(g,J,w/(U-v));if(l.normalize(),Q){var R=P.l.Lerp(E[0],E[2],u/U),x=P.l.Lerp(E[1],E[2],u/U);K=P.l.Lerp(R,x,I/(U-u))}else K=new P.l(l.x,l.y,l.z);K.x/=p,K.y/=r,K.z/=Y,K.normalize();var j=P.k.Lerp(o[0],o[2],v/U),h=P.k.Lerp(o[1],o[2],v/U),n=U===v?o[2]:P.k.Lerp(j,h,w/(U-v));B.push(l.x*p,l.y*r,l.z*Y),t.push(K.x,K.y,K.z),i.push(n.x,a.e.UseOpenGLOrientationForUV?1-n.y:n.y),s.push(z),z++},V=0;V<U;V++)for(var F=0;F+V<U;F++)W(F,V,F+1/3,V+1/3),W(F+1,V,F+1/3,V+1/3),W(F,V+1,F+1/3,V+1/3),F+V+1<U&&(W(F+1,V,F+2/3,V+2/3),W(F+1,V+1,F+2/3,V+2/3),W(F,V+1,F+2/3,V+2/3))}K.b._ComputeSides(I,B,s,t,i,w.frontUVs,w.backUVs);var O=new K.b;return O.indices=s,O.positions=B,O.normals=t,O.uvs=i,O}function Pw(w,v,I){void 0===v&&(v={}),void 0===I&&(I=null);var P=new u.b(w,I);return v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation,Iw(v).applyToMesh(P,v.updatable),P}K.b.CreatePolyhedron=ww,u.b.CreatePolyhedron=function(w,v,I){return vw(w,v,I)};K.b.CreateIcoSphere=Iw,u.b.CreateIcoSphere=function(w,v,I){return Pw(w,v,I)};var uw=I(52270);function Qw(w,v,I){var U=v.getIndices(),p=v.getVerticesData(Q.f.PositionKind),r=v.getVerticesData(Q.f.NormalKind),Y=v.getVerticesData(Q.f.UVKind),g=I.position||P.l.Zero(),J=I.normal||P.l.Up(),l=I.size||P.l.One(),R=I.angle||0;if(!J){var x=new P.l(0,0,1),j=v.getScene().activeCamera,s=P.l.TransformCoordinates(x,j.getWorldMatrix());J=j.globalPosition.subtract(s)}var B=-Math.atan2(J.z,J.x)-Math.PI/2,t=Math.sqrt(J.x*J.x+J.z*J.z),i=Math.atan2(J.y,t),z=P.e.RotationYawPitchRoll(B,i,R).multiply(P.e.Translation(g.x,g.y,g.z)),E=P.e.Invert(z),o=v.getWorldMatrix().multiply(E),h=new K.b;h.indices=[],h.positions=[],h.normals=[],h.uvs=[];for(var n=0,W=function(w){var v=new uw.c;if(!U||!p||!r)return v;var u=U[w];if(v.position=new P.l(p[3*u],p[3*u+1],p[3*u+2]),v.position=P.l.TransformCoordinates(v.position,o),v.normal=new P.l(r[3*u],r[3*u+1],r[3*u+2]),v.normal=P.l.TransformNormal(v.normal,o),I.captureUVS&&Y){var Q=Y[2*u+1];v.uv=new P.k(Y[2*u],a.e.UseOpenGLOrientationForUV?1-Q:Q)}return v},V=function(w,v){if(0===w.length)return w;for(var I=.5*Math.abs(P.l.Dot(l,v)),u=function(w,u){var Q=P.l.GetClipFactor(w.position,u.position,v,I);return new uw.c(P.l.Lerp(w.position,u.position,Q),P.l.Lerp(w.normal,u.normal,Q))},Q=new Array,K=0;K<w.length;K+=3){var a=null,U=null,p=null,r=null,Y=P.l.Dot(w[K].position,v)-I>0,g=P.l.Dot(w[K+1].position,v)-I>0,J=P.l.Dot(w[K+2].position,v)-I>0;switch((Y?1:0)+(g?1:0)+(J?1:0)){case 0:Q.push(w[K]),Q.push(w[K+1]),Q.push(w[K+2]);break;case 1:if(Y&&(a=w[K+1],U=w[K+2],p=u(w[K],a),r=u(w[K],U)),g){a=w[K],U=w[K+2],p=u(w[K+1],a),r=u(w[K+1],U),Q.push(p),Q.push(U.clone()),Q.push(a.clone()),Q.push(U.clone()),Q.push(p.clone()),Q.push(r);break}J&&(a=w[K],U=w[K+1],p=u(w[K+2],a),r=u(w[K+2],U)),a&&U&&p&&r&&(Q.push(a.clone()),Q.push(U.clone()),Q.push(p),Q.push(r),Q.push(p.clone()),Q.push(U.clone()));break;case 2:Y||(U=u(a=w[K].clone(),w[K+1]),p=u(a,w[K+2]),Q.push(a),Q.push(U),Q.push(p)),g||(U=u(a=w[K+1].clone(),w[K+2]),p=u(a,w[K]),Q.push(a),Q.push(U),Q.push(p)),J||(U=u(a=w[K+2].clone(),w[K]),p=u(a,w[K+1]),Q.push(a),Q.push(U),Q.push(p))}}return Q},F=0;F<U.length;F+=3){var O=new Array;if(O.push(W(F)),O.push(W(F+1)),O.push(W(F+2)),O=V(O,new P.l(1,0,0)),O=V(O,new P.l(-1,0,0)),O=V(O,new P.l(0,1,0)),O=V(O,new P.l(0,-1,0)),O=V(O,new P.l(0,0,1)),0!==(O=V(O,new P.l(0,0,-1))).length)for(var N=0;N<O.length;N++){var q=O[N];if(h.indices.push(n),q.position.toArray(h.positions,3*n),q.normal.toArray(h.normals,3*n),I.captureUVS)q.uv.toArray(h.uvs,2*n);else{h.uvs.push(.5+q.position.x/l.x);var m=.5+q.position.y/l.y;h.uvs.push(a.e.UseOpenGLOrientationForUV?1-m:m)}n++}}var c=new u.b(w,v.getScene());return h.applyToMesh(c),c.position=g.clone(),c.rotation=new P.l(i,B,R),c}function Kw(w){void 0===w&&(w={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var v,I,u=Math.max(w.subdivisions?w.subdivisions:2,1),Q=Math.max(w.tessellation?w.tessellation:16,3),U=Math.max(w.height?w.height:1,0),p=Math.max(w.radius?w.radius:.25,0),r=Math.max(w.capSubdivisions?w.capSubdivisions:6,1),Y=Q,g=u,J=Math.max(w.radiusTop?w.radiusTop:p,0),l=Math.max(w.radiusBottom?w.radiusBottom:p,0),R=U-(J+l),x=2*Math.PI,j=Math.max(w.topCapSubdivisions?w.topCapSubdivisions:r,1),s=Math.max(w.bottomCapSubdivisions?w.bottomCapSubdivisions:r,1),B=Math.acos((l-J)/U),t=[],i=[],z=[],E=[],o=0,h=[],n=.5*R,W=.5*Math.PI,V=P.l.Zero(),F=P.l.Zero(),O=Math.cos(B),N=Math.sin(B),q=new P.k(J*N,n+J*O).subtract(new P.k(l*N,l*O-n)).length(),m=J*B+q+l*(W-B),c=0;for(I=0;I<=j;I++){var M=[],S=W-B*(I/j);c+=J*B/j;var e=Math.cos(S),H=Math.sin(S),G=e*J;for(v=0;v<=Y;v++){var L=(k=v/Y)*x+0,d=Math.sin(L),D=Math.cos(L);F.x=G*d,F.y=n+H*J,F.z=G*D,i.push(F.x,F.y,F.z),V.set(e*d,H,e*D),z.push(V.x,V.y,V.z),E.push(k,a.e.UseOpenGLOrientationForUV?c/m:1-c/m),M.push(o),o++}h.push(M)}var f=U-J-l+O*J-O*l,b=N*(l-J)/f;for(I=1;I<=g;I++){M=[];c+=q/g;G=N*(I*(l-J)/g+J);for(v=0;v<=Y;v++){L=(k=v/Y)*x+0,d=Math.sin(L),D=Math.cos(L);F.x=G*d,F.y=n+O*J-I*f/g,F.z=G*D,i.push(F.x,F.y,F.z),V.set(d,b,D).normalize(),z.push(V.x,V.y,V.z),E.push(k,a.e.UseOpenGLOrientationForUV?c/m:1-c/m),M.push(o),o++}h.push(M)}for(I=1;I<=s;I++){M=[],S=W-B-(Math.PI-B)*(I/s);c+=l*B/s;e=Math.cos(S),H=Math.sin(S),G=e*l;for(v=0;v<=Y;v++){var k;L=(k=v/Y)*x+0,d=Math.sin(L),D=Math.cos(L);F.x=G*d,F.y=H*l-n,F.z=G*D,i.push(F.x,F.y,F.z),V.set(e*d,H,e*D),z.push(V.x,V.y,V.z),E.push(k,a.e.UseOpenGLOrientationForUV?c/m:1-c/m),M.push(o),o++}h.push(M)}for(v=0;v<Y;v++)for(I=0;I<j+g+s;I++){var C=h[I][v],y=h[I+1][v],T=h[I+1][v+1],Z=h[I][v+1];t.push(C),t.push(y),t.push(Z),t.push(y),t.push(T),t.push(Z)}if(t=t.reverse(),w.orientation&&!w.orientation.equals(P.l.Up())){var A=new P.e;w.orientation.clone().scale(.5*Math.PI).cross(P.l.Up()).toQuaternion().toRotationMatrix(A);for(var X=P.l.Zero(),ww=0;ww<i.length;ww+=3)X.set(i[ww],i[ww+1],i[ww+2]),P.l.TransformCoordinatesToRef(X.clone(),A,X),i[ww]=X.x,i[ww+1]=X.y,i[ww+2]=X.z}var vw=new K.b;return vw.positions=i,vw.normals=z,vw.uvs=E,vw.indices=t,vw}function aw(w,v,I){void 0===v&&(v={orientation:P.l.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1}),void 0===I&&(I=null);var Q=new u.b(w,I);return Kw(v).applyToMesh(Q,v.updatable),Q}u.b.CreateDecal=function(w,v,I,P,u,Q){return Qw(w,v,{position:I,normal:P,size:u,angle:Q})};u.b.CreateCapsule=function(w,v,I){return aw(w,v,I)},K.b.CreateCapsule=Kw;var Uw=I(96658),pw=function(){function w(w,v){void 0===w&&(w=0),void 0===v&&(v=0),this.x=w,this.y=v,w!==Math.floor(w)&&(Math.floor(w),V.e.Warn("x is not an integer, floor(x) used")),v!==Math.floor(v)&&(Math.floor(v),V.e.Warn("y is not an integer, floor(y) used"))}return w.prototype.clone=function(){return new w(this.x,this.y)},w.prototype.rotate60About=function(w){var v=this.x;return this.x=w.x+w.y-this.y,this.y=v+this.y-w.x,this},w.prototype.rotateNeg60About=function(w){var v=this.x;return this.x=v+this.y-w.y,this.y=w.x+w.y-v,this},w.prototype.rotate120=function(w,v){w!==Math.floor(w)&&(Math.floor(w),V.e.Warn("m not an integer only floor(m) used")),v!==Math.floor(v)&&(Math.floor(v),V.e.Warn("n not an integer only floor(n) used"));var I=this.x;return this.x=w-I-this.y,this.y=v+I,this},w.prototype.rotateNeg120=function(w,v){w!==Math.floor(w)&&(Math.floor(w),V.e.Warn("m is not an integer, floor(m) used")),v!==Math.floor(v)&&(Math.floor(v),V.e.Warn("n is not an integer,   floor(n) used"));var I=this.x;return this.x=this.y-v,this.y=w+v-I-this.y,this},w.prototype.toCartesianOrigin=function(w,v){var I=P.l.Zero();return I.x=w.x+2*this.x*v+this.y*v,I.y=w.y+Math.sqrt(3)*this.y*v,I},w.Zero=function(){return new w(0,0)},w}(),rw=function(){function w(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Yw("icosahedron","Regular",[[0,O.g,-1],[-O.g,1,0],[-1,0,-O.g],[1,0,-O.g],[O.g,1,0],[0,O.g,1],[-1,0,O.g],[-O.g,-1,0],[0,-O.g,-1],[O.g,-1,0],[1,0,O.g],[0,-O.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}return w.prototype.setIndices=function(){var w,v,I,P,u,Q,K,a=12,U={},p=this.m,r=this.n,Y=p;0!==r&&(Y=Uw.b.HCF(p,r)),w=p/Y,v=r/Y;var g,J,l,R=pw.Zero(),x=new pw(p,r),j=new pw(-r,p+r),s=pw.Zero(),B=pw.Zero(),t=pw.Zero(),i=[],z=[],E=this.vertByDist,o=function(w,v,I,P){J=v+"|"+P,(g=w+"|"+I)in U||J in U?g in U&&!(J in U)?U[J]=U[g]:J in U&&!(g in U)&&(U[g]=U[J]):(U[g]=a,U[J]=a,a++),E[I][0]>2?z[U[g]]=[-E[I][0],E[I][1],U[g]]:z[U[g]]=[i[E[I][0]],E[I][1],U[g]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(var h=0;h<20;h++){if(u=(i=this.IDATA.face[h])[2],Q=i[1],K=i[0],l=R.x+"|"+R.y,(g=h+"|"+l)in U||(U[g]=u,z[u]=[i[E[l][0]],E[l][1]]),l=x.x+"|"+x.y,(g=h+"|"+l)in U||(U[g]=Q,z[Q]=[i[E[l][0]],E[l][1]]),l=j.x+"|"+j.y,(g=h+"|"+l)in U||(U[g]=K,z[K]=[i[E[l][0]],E[l][1]]),I=this.IDATA.edgematch[h][0],"B"===(P=this.IDATA.edgematch[h][1]))for(var n=1;n<Y;n++)B.x=p-n*(w+v),B.y=r+n*w,t.x=-n*v,t.y=n*(w+v),o(h,I,l=B.x+"|"+B.y,t.x+"|"+t.y);if("O"===P)for(n=1;n<Y;n++)t.x=-n*v,t.y=n*(w+v),s.x=n*w,s.y=n*v,o(h,I,l=t.x+"|"+t.y,s.x+"|"+s.y);if(I=this.IDATA.edgematch[h][2],(P=this.IDATA.edgematch[h][3])&&"A"===P)for(n=1;n<Y;n++)s.x=n*w,s.y=n*v,B.x=p-(Y-n)*(w+v),B.y=r+(Y-n)*w,o(h,I,l=s.x+"|"+s.y,B.x+"|"+B.y);for(n=0;n<this.vertices.length;n++)l=this.vertices[n].x+"|"+this.vertices[n].y,(g=h+"|"+l)in U||(U[g]=a++,E[l][0]>2?z[U[g]]=[-E[l][0],E[l][1],U[g]]:z[U[g]]=[i[E[l][0]],E[l][1],U[g]])}this.closestTo=z,this.vecToidx=U},w.prototype.calcCoeffs=function(){var w=this.m,v=this.n,I=Math.sqrt(3)/3,P=w*w+v*v+w*v;this.coau=(w+v)/P,this.cobu=-v/P,this.coav=-I*(w-v)/P,this.cobv=I*(2*w+v)/P},w.prototype.createInnerFacets=function(){for(var w=this.m,v=this.n,I=0;I<v+w+1;I++)for(var P=this.min[I];P<this.max[I]+1;P++)P<this.max[I]&&P<this.max[I+1]+1&&this.innerFacets.push(["|"+P+"|"+I,"|"+P+"|"+(I+1),"|"+(P+1)+"|"+I]),I>0&&P<this.max[I-1]&&P+1<this.max[I]+1&&this.innerFacets.push(["|"+P+"|"+I,"|"+(P+1)+"|"+I,"|"+(P+1)+"|"+(I-1)])},w.prototype.edgeVecsABOB=function(){for(var w=this.m,v=this.n,I=new pw(-v,w+v),P=1;P<w+v;P++){var u=new pw(this.min[P],P),Q=new pw(this.min[P-1],P-1),K=new pw(this.min[P+1],P+1),a=u.clone(),U=Q.clone(),p=K.clone();a.rotate60About(I),U.rotate60About(I),p.rotate60About(I);var r=new pw(this.max[a.y],a.y),Y=new pw(this.max[a.y-1],a.y-1),g=new pw(this.max[a.y-1]-1,a.y-1);a.x===r.x&&a.y===r.y||(a.x!==Y.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,Y,g]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,g,r])):a.y===p.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([u,Q,Y]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([u,Y,K])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([u,Q,Y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,Y,r])))}},w.prototype.mapABOBtoOBOA=function(){for(var w=new pw(0,0),v=0;v<this.isoVecsABOB.length;v++){for(var I=[],P=0;P<3;P++)w.x=this.isoVecsABOB[v][P].x,w.y=this.isoVecsABOB[v][P].y,0===this.vertexTypes[v][P]&&w.rotateNeg120(this.m,this.n),I.push(w.clone());this.isoVecsOBOA.push(I)}},w.prototype.mapABOBtoBAOA=function(){for(var w=new pw(0,0),v=0;v<this.isoVecsABOB.length;v++){for(var I=[],P=0;P<3;P++)w.x=this.isoVecsABOB[v][P].x,w.y=this.isoVecsABOB[v][P].y,1===this.vertexTypes[v][P]&&w.rotate120(this.m,this.n),I.push(w.clone());this.isoVecsBAOA.push(I)}},w.prototype.MapToFace=function(w,v){for(var I,u=this.IDATA.face[w],Q=u[2],K=u[1],a=u[0],U=P.l.FromArray(this.IDATA.vertex[Q]),p=P.l.FromArray(this.IDATA.vertex[K]),r=P.l.FromArray(this.IDATA.vertex[a]),Y=p.subtract(U),g=r.subtract(U),J=Y.scale(this.coau).add(g.scale(this.cobu)),l=Y.scale(this.coav).add(g.scale(this.cobv)),R=[],x=P.i.Vector3[0],j=0;j<this.cartesian.length;j++)x=J.scale(this.cartesian[j].x).add(l.scale(this.cartesian[j].y)).add(U),R[j]=[x.x,x.y,x.z],I=w+"|"+this.vertices[j].x+"|"+this.vertices[j].y,v.vertex[this.vecToidx[I]]=[x.x,x.y,x.z]},w.prototype.build=function(w,v){var I=new Array,P=pw.Zero(),u=new pw(w,v),Q=new pw(-v,w+v);I.push(P,u,Q);for(var K=v;K<w+1;K++)for(var a=0;a<w+1-K;a++)I.push(new pw(a,K));if(v>0){for(var U=Uw.b.HCF(w,v),p=w/U,r=v/U,Y=1;Y<U;Y++)I.push(new pw(Y*p,Y*r)),I.push(new pw(-Y*r,Y*(p+r))),I.push(new pw(w-Y*(p+r),v+Y*p));for(var g=w/v,J=1;J<v;J++)for(var l=0;l<J*g;l++)I.push(new pw(l,J)),I.push(new pw(l,J).rotate120(w,v)),I.push(new pw(l,J).rotateNeg120(w,v))}I.sort((function(w,v){return w.x-v.x})),I.sort((function(w,v){return w.y-v.y}));var R=new Array(w+v+1),x=new Array(w+v+1);for(Y=0;Y<R.length;Y++)R[Y]=1/0,x[Y]=-1/0;var j=0,s=0,B=I.length;for(Y=0;Y<B;Y++)s=I[Y].x,R[j=I[Y].y]=Math.min(s,R[j]),x[j]=Math.max(s,x[j]);var t=function(I,P){var u=I.clone();return"A"===P&&u.rotateNeg120(w,v),"B"===P&&u.rotate120(w,v),u.x<0?u.y:u.x+u.y},i=[],z=[],E=[],o=[],h={},n=[],W=-1,V=-1;for(Y=0;Y<B;Y++)i[Y]=I[Y].toCartesianOrigin(new pw(0,0),.5),z[Y]=t(I[Y],"O"),E[Y]=t(I[Y],"A"),o[Y]=t(I[Y],"B"),z[Y]===E[Y]&&E[Y]===o[Y]?(W=3,V=z[Y]):z[Y]===E[Y]?(W=4,V=z[Y]):E[Y]===o[Y]?(W=5,V=E[Y]):o[Y]===z[Y]&&(W=6,V=z[Y]),z[Y]<E[Y]&&z[Y]<o[Y]&&(W=2,V=z[Y]),E[Y]<z[Y]&&E[Y]<o[Y]&&(W=1,V=E[Y]),o[Y]<E[Y]&&o[Y]<z[Y]&&(W=0,V=o[Y]),n.push([W,V,I[Y].x,I[Y].y]);n.sort((function(w,v){return w[2]-v[2]})),n.sort((function(w,v){return w[3]-v[3]})),n.sort((function(w,v){return w[1]-v[1]})),n.sort((function(w,v){return w[0]-v[0]}));for(var F=0;F<n.length;F++)h[n[F][2]+"|"+n[F][3]]=[n[F][0],n[F][1],F];return this.m=w,this.n=v,this.vertices=I,this.vertByDist=h,this.cartesian=i,this.min=R,this.max=x,this},w}(),Yw=function(w,v,I,P){this.name=w,this.category=v,this.vertex=I,this.face=P},gw=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return(0,W.m)(v,w),v.prototype.innerToData=function(w,v){for(var I=0;I<v.innerFacets.length;I++)this.face.push(v.innerFacets[I].map((function(I){return v.vecToidx[w+I]})))},v.prototype.mapABOBtoDATA=function(w,v){for(var I=v.IDATA.edgematch[w][0],P=0;P<v.isoVecsABOB.length;P++){for(var u=[],Q=0;Q<3;Q++)0===v.vertexTypes[P][Q]?u.push(w+"|"+v.isoVecsABOB[P][Q].x+"|"+v.isoVecsABOB[P][Q].y):u.push(I+"|"+v.isoVecsABOB[P][Q].x+"|"+v.isoVecsABOB[P][Q].y);this.face.push([v.vecToidx[u[0]],v.vecToidx[u[1]],v.vecToidx[u[2]]])}},v.prototype.mapOBOAtoDATA=function(w,v){for(var I=v.IDATA.edgematch[w][0],P=0;P<v.isoVecsOBOA.length;P++){for(var u=[],Q=0;Q<3;Q++)1===v.vertexTypes[P][Q]?u.push(w+"|"+v.isoVecsOBOA[P][Q].x+"|"+v.isoVecsOBOA[P][Q].y):u.push(I+"|"+v.isoVecsOBOA[P][Q].x+"|"+v.isoVecsOBOA[P][Q].y);this.face.push([v.vecToidx[u[0]],v.vecToidx[u[1]],v.vecToidx[u[2]]])}},v.prototype.mapBAOAtoDATA=function(w,v){for(var I=v.IDATA.edgematch[w][2],P=0;P<v.isoVecsBAOA.length;P++){for(var u=[],Q=0;Q<3;Q++)1===v.vertexTypes[P][Q]?u.push(w+"|"+v.isoVecsBAOA[P][Q].x+"|"+v.isoVecsBAOA[P][Q].y):u.push(I+"|"+v.isoVecsBAOA[P][Q].x+"|"+v.isoVecsBAOA[P][Q].y);this.face.push([v.vecToidx[u[0]],v.vecToidx[u[1]],v.vecToidx[u[2]]])}},v.prototype.orderData=function(w){for(var v=[],I=0;I<13;I++)v[I]=[];var P=w.closestTo;for(I=0;I<P.length;I++)P[I][0]>-1?P[I][1]>0&&v[P[I][0]].push([I,P[I][1]]):v[12].push([I,P[I][0]]);var u=[];for(I=0;I<12;I++)u[I]=I;var Q=12;for(I=0;I<12;I++){v[I].sort((function(w,v){return w[1]-v[1]}));for(var K=0;K<v[I].length;K++)u[v[I][K][0]]=Q++}for(K=0;K<v[12].length;K++)u[v[12][K][0]]=Q++;for(I=0;I<this.vertex.length;I++)this.vertex[I].push(u[I]);this.vertex.sort((function(w,v){return w[3]-v[3]}));for(I=0;I<this.vertex.length;I++)this.vertex[I].pop();for(I=0;I<this.face.length;I++)for(K=0;K<this.face[I].length;K++)this.face[I][K]=u[this.face[I][K]];this.sharedNodes=v[12].length,this.poleNodes=this.vertex.length-this.sharedNodes},v.prototype.setOrder=function(w,v){var I=[],P=[],u=v.pop();P.push(u);var Q=this.face[u].indexOf(w);Q=(Q+2)%3;var K=this.face[u][Q];I.push(K);for(var a=0;v.length>0;)u=v[a],this.face[u].indexOf(K)>-1?(Q=(this.face[u].indexOf(K)+1)%3,K=this.face[u][Q],I.push(K),P.push(u),v.splice(a,1),a=0):a++;return this.adjacentFaces.push(I),P},v.prototype.toGoldbergPolyhedronData=function(){var w=this,v=new Yw("GeoDual","Goldberg",[],[]);v.name="GD dual";for(var I=this.vertex.length,P=new Array(I),u=0;u<I;u++)P[u]=[];for(var Q=0;Q<this.face.length;Q++)for(var K=0;K<3;K++)P[this.face[Q][K]].push(Q);var a=0,U=0,p=0,r=[],Y=[];this.adjacentFaces=[];for(var g=0;g<P.length;g++)v.face[g]=this.setOrder(g,P[g].concat([])),P[g].forEach((function(I){a=0,U=0,p=0,r=w.face[I];for(var P=0;P<3;P++)Y=w.vertex[r[P]],a+=Y[0],U+=Y[1],p+=Y[2];v.vertex[I]=[a/3,U/3,p/3]}));return v},v.BuildGeodesicData=function(w){var I=new v("Geodesic-m-n","Geodesic",[[0,O.g,-1],[-O.g,1,0],[-1,0,-O.g],[1,0,-O.g],[O.g,1,0],[0,O.g,1],[-1,0,O.g],[-O.g,-1,0],[0,-O.g,-1],[O.g,-1,0],[1,0,O.g],[0,-O.g,1]],[]);w.setIndices(),w.calcCoeffs(),w.createInnerFacets(),w.edgeVecsABOB(),w.mapABOBtoOBOA(),w.mapABOBtoBAOA();for(var P=0;P<w.IDATA.face.length;P++)w.MapToFace(P,I),I.innerToData(P,w),"B"===w.IDATA.edgematch[P][1]&&I.mapABOBtoDATA(P,w),"O"===w.IDATA.edgematch[P][1]&&I.mapOBOAtoDATA(P,w),"A"===w.IDATA.edgematch[P][3]&&I.mapBAOAtoDATA(P,w);I.orderData(w);return I.vertex=I.vertex.map((function(w){var v=w[0],I=w[1],P=w[2],u=Math.sqrt(v*v+I*I+P*P);return w[0]*=1/u,w[1]*=1/u,w[2]*=1/u,w})),I},v}(Yw);u.b._GoldbergMeshParser=function(w,v){return Jw.Parse(w,v)};var Jw=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]},v}return(0,W.m)(v,w),v.prototype.relatedGoldbergFace=function(w,v){return void 0===v?(w>this.goldbergData.nbUnsharedFaces-1&&(V.e.Warn("Maximum number of unshared faces used"),w=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+w):(w>11&&(V.e.Warn("Last pole used"),w=11),v>this.goldbergData.nbFacesAtPole-1&&(V.e.Warn("Maximum number of faces at a pole used"),v=this.goldbergData.nbFacesAtPole-1),12+w*this.goldbergData.nbFacesAtPole+v)},v.prototype._changeGoldbergFaceColors=function(w){for(var v=0;v<w.length;v++)for(var I=w[v][0],P=w[v][1],u=w[v][2],Q=I;Q<P+1;Q++)this.goldbergData.faceColors[Q]=u;var K=[];for(Q=0;Q<12;Q++)for(v=0;v<5;v++)K.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);for(Q=12;Q<this.goldbergData.faceColors.length;Q++)for(v=0;v<6;v++)K.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);return K},v.prototype.setGoldbergFaceColors=function(w){var v=this._changeGoldbergFaceColors(w);this.setVerticesData(Q.f.ColorKind,v)},v.prototype.updateGoldbergFaceColors=function(w){var v=this._changeGoldbergFaceColors(w);this.updateVerticesData(Q.f.ColorKind,v)},v.prototype._changeGoldbergFaceUVs=function(w){for(var v=this.getVerticesData(Q.f.UVKind),I=0;I<w.length;I++){for(var P=w[I][0],u=w[I][1],K=w[I][2],a=w[I][3],U=w[I][4],p=[],r=[],Y=void 0,g=void 0,J=0;J<5;J++)Y=K.x+a*Math.cos(U+J*Math.PI/2.5),g=K.y+a*Math.sin(U+J*Math.PI/2.5),Y<0&&(Y=0),Y>1&&(Y=1),p.push(Y,g);for(J=0;J<6;J++)Y=K.x+a*Math.cos(U+J*Math.PI/3),g=K.y+a*Math.sin(U+J*Math.PI/3),Y<0&&(Y=0),Y>1&&(Y=1),r.push(Y,g);for(var l=P;l<Math.min(12,u+1);l++)for(J=0;J<5;J++)v[10*l+2*J]=p[2*J],v[10*l+2*J+1]=p[2*J+1];for(l=Math.max(12,P);l<u+1;l++)for(J=0;J<6;J++)v[12*l-24+2*J]=r[2*J],v[12*l-23+2*J]=r[2*J+1]}return v},v.prototype.setGoldbergFaceUVs=function(w){var v=this._changeGoldbergFaceUVs(w);this.setVerticesData(Q.f.UVKind,v)},v.prototype.updateGoldbergFaceUVs=function(w){var v=this._changeGoldbergFaceUVs(w);this.updateVerticesData(Q.f.UVKind,v)},v.prototype.placeOnGoldbergFaceAt=function(w,v,I){var u=P.l.RotationFromAxis(this.goldbergData.faceXaxis[v],this.goldbergData.faceYaxis[v],this.goldbergData.faceZaxis[v]);w.rotation=u,w.position=this.goldbergData.faceCenters[v].add(this.goldbergData.faceXaxis[v].scale(I.x)).add(this.goldbergData.faceYaxis[v].scale(I.y)).add(this.goldbergData.faceZaxis[v].scale(I.z))},v.prototype.serialize=function(v){w.prototype.serialize.call(this,v),v.type="GoldbergMesh";var I={};if(I.adjacentFaces=this.goldbergData.adjacentFaces,I.nbSharedFaces=this.goldbergData.nbSharedFaces,I.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,I.nbFaces=this.goldbergData.nbFaces,I.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){I.faceColors=[];for(var P=0,u=this.goldbergData.faceColors;P<u.length;P++){var Q=u[P];I.faceColors.push(Q.asArray())}}if(this.goldbergData.faceCenters){I.faceCenters=[];for(var K=0,a=this.goldbergData.faceCenters;K<a.length;K++){var U=a[K];I.faceCenters.push(U.asArray())}}if(this.goldbergData.faceZaxis){I.faceZaxis=[];for(var p=0,r=this.goldbergData.faceZaxis;p<r.length;p++){U=r[p];I.faceZaxis.push(U.asArray())}}if(this.goldbergData.faceYaxis){I.faceYaxis=[];for(var Y=0,g=this.goldbergData.faceYaxis;Y<g.length;Y++){U=g[Y];I.faceYaxis.push(U.asArray())}}if(this.goldbergData.faceXaxis){I.faceXaxis=[];for(var J=0,l=this.goldbergData.faceXaxis;J<l.length;J++){U=l[J];I.faceXaxis.push(U.asArray())}}v.goldbergData=I},v.Parse=function(w,I){var u=w.goldbergData;u.faceColors=u.faceColors.map((function(w){return g.f.FromArray(w)})),u.faceCenters=u.faceCenters.map((function(w){return P.l.FromArray(w)})),u.faceZaxis=u.faceZaxis.map((function(w){return P.l.FromArray(w)})),u.faceXaxis=u.faceXaxis.map((function(w){return P.l.FromArray(w)})),u.faceYaxis=u.faceYaxis.map((function(w){return P.l.FromArray(w)}));var Q=new v(w.name,I);return Q.goldbergData=u,Q},v}(u.b);function lw(w,v,I){void 0===I&&(I=null);var Q=v.size,U=v.sizeX||Q||1,p=v.sizeY||Q||1,r=v.sizeZ||Q||1,Y=v.m||1;Y!==Math.floor(Y)&&(Math.floor(Y),V.e.Warn("m not an integer only floor(m) used"));var J=v.n||0;if(J!==Math.floor(J)&&(Math.floor(J),V.e.Warn("n not an integer only floor(n) used")),J>Y){var l=J;J=Y,Y=l,V.e.Warn("n > m therefore m and n swapped")}var R=new rw;R.build(Y,J);var x=gw.BuildGeodesicData(R),j=x.toGoldbergPolyhedronData(),s=new Jw(w,I);v.sideOrientation=u.b._GetDefaultSideOrientation(v.sideOrientation),s._originalBuilderSideOrientation=v.sideOrientation;var B=function(w,v){for(var I=w.size,u=w.sizeX||I||1,Q=w.sizeY||I||1,U=w.sizeZ||I||1,p=0===w.sideOrientation?0:w.sideOrientation||K.b.DEFAULTSIDE,r=new Array,Y=new Array,g=new Array,J=new Array,l=1/0,R=-1/0,x=1/0,j=-1/0,s=0;s<v.vertex.length;s++)l=Math.min(l,v.vertex[s][0]*u),R=Math.max(R,v.vertex[s][0]*u),x=Math.min(x,v.vertex[s][1]*Q),j=Math.max(j,v.vertex[s][1]*Q);for(var B=0,t=0;t<v.face.length;t++){var i=v.face[t],z=P.l.FromArray(v.vertex[i[0]]),E=P.l.FromArray(v.vertex[i[2]]),o=P.l.FromArray(v.vertex[i[1]]),h=E.subtract(z),n=o.subtract(z),W=P.l.Cross(n,h).normalize();for(s=0;s<i.length;s++){g.push(W.x,W.y,W.z);var V=v.vertex[i[s]];r.push(V[0]*u,V[1]*Q,V[2]*U);var F=(V[1]*Q-x)/(j-x);J.push((V[0]*u-l)/(R-l),a.e.UseOpenGLOrientationForUV?1-F:F)}for(s=0;s<i.length-2;s++)Y.push(B,B+s+2,B+s+1);B+=i.length}K.b._ComputeSides(p,r,Y,g,J);var O=new K.b;return O.positions=r,O.indices=Y,O.normals=g,O.uvs=J,O}(v,j);B.applyToMesh(s,v.updatable),s.goldbergData.nbSharedFaces=x.sharedNodes,s.goldbergData.nbUnsharedFaces=x.poleNodes,s.goldbergData.adjacentFaces=x.adjacentFaces,s.goldbergData.nbFaces=s.goldbergData.nbSharedFaces+s.goldbergData.nbUnsharedFaces,s.goldbergData.nbFacesAtPole=(s.goldbergData.nbUnsharedFaces-12)/12;for(var t=0;t<x.vertex.length;t++)s.goldbergData.faceCenters.push(P.l.FromArray(x.vertex[t])),s.goldbergData.faceCenters[t].x*=U,s.goldbergData.faceCenters[t].y*=p,s.goldbergData.faceCenters[t].z*=r,s.goldbergData.faceColors.push(new g.f(1,1,1,1));for(t=0;t<j.face.length;t++){var i=j.face[t],z=P.l.FromArray(j.vertex[i[0]]),E=P.l.FromArray(j.vertex[i[2]]),o=P.l.FromArray(j.vertex[i[1]]),h=E.subtract(z),n=o.subtract(z),W=P.l.Cross(n,h).normalize(),F=P.l.Cross(n,W).normalize();s.goldbergData.faceXaxis.push(n.normalize()),s.goldbergData.faceYaxis.push(W),s.goldbergData.faceZaxis.push(F)}return s}u.b.CreateGoldberg=lw;var Rw={CreateBox:Y.CreateBox,CreateTiledBox:x,CreateSphere:j.c,CreateDisc:r.e,CreateIcoSphere:Pw,CreateRibbon:p,CreateCylinder:i,CreateTorus:E,CreateTorusKnot:h,CreateLineSystem:n.f,CreateLines:n.j,CreateDashedLines:n.e,ExtrudeShape:H,ExtrudeShapeCustom:G,CreateLathe:d,CreateTiledPlane:l,CreatePlane:D.e,CreateGround:T,CreateTiledGround:Z,CreateGroundFromHeightMap:A,CreatePolygon:S,ExtrudePolygon:e,CreateTube:X,CreatePolyhedron:vw,CreateGeodesic:function(w,v,I){void 0===I&&(I=null);var P=v.m||1;P!==Math.floor(P)&&(Math.floor(P),V.e.Warn("m not an integer only floor(m) used"));var u=v.n||0;if(u!==Math.floor(u)&&(Math.floor(u),V.e.Warn("n not an integer only floor(n) used")),u>P){var Q=u;u=P,P=Q,V.e.Warn("n > m therefore m and n swapped")}var K=new rw;return K.build(P,u),vw(w,{custom:gw.BuildGeodesicData(K),size:v.size,sizeX:v.sizeX,sizeY:v.sizeY,sizeZ:v.sizeZ,faceUV:v.faceUV,faceColors:v.faceColors,flat:v.flat,updatable:v.updatable,sideOrientation:v.sideOrientation,frontUVs:v.frontUVs,backUVs:v.backUVs},I)},CreateGoldberg:lw,CreateDecal:Qw,CreateCapsule:aw}},50384:function(w,v,I){"use strict";I.d(v,{c:function(){return U}});var P=I(43251),u=I(16035),Q=I(97918),K=I(18445),a=I(61803),U=function(){function w(w,v,I,P,u,Q,K,a,U){void 0===a&&(a=!0),void 0===U&&(U=!0),this.materialIndex=w,this.verticesStart=v,this.verticesCount=I,this.indexStart=P,this.indexCount=u,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=Q,this._renderingMesh=K||Q,U&&Q.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=Q.subMeshes.length-1,a&&(this.refreshBoundingInfo(),Q.computeWorldMatrix(!0))}return Object.defineProperty(w.prototype,"materialDefines",{get:function(){var w;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(w=this._getDrawWrapper())||void 0===w?void 0:w.defines},set:function(w){var v;(null!==(v=this._mainDrawWrapperOverride)&&void 0!==v?v:this._getDrawWrapper(void 0,!0)).defines=w},enumerable:!1,configurable:!0}),w.prototype._getDrawWrapper=function(w,v){void 0===v&&(v=!1),w=null!==w&&void 0!==w?w:this._engine.currentRenderPassId;var I=this._drawWrappers[w];return!I&&v&&(this._drawWrappers[w]=I=new a.c(this._mesh.getScene().getEngine())),I},w.prototype._removeDrawWrapper=function(w,v){var I;void 0===v&&(v=!0),v&&(null===(I=this._drawWrappers[w])||void 0===I||I.dispose()),this._drawWrappers[w]=void 0},Object.defineProperty(w.prototype,"effect",{get:function(){var w,v;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(v=null===(w=this._getDrawWrapper())||void 0===w?void 0:w.effect)&&void 0!==v?v:null},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"_drawWrapper",{get:function(){var w;return null!==(w=this._mainDrawWrapperOverride)&&void 0!==w?w:this._getDrawWrapper(void 0,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"_drawWrapperOverride",{get:function(){return this._mainDrawWrapperOverride},enumerable:!1,configurable:!0}),w.prototype._setMainDrawWrapperOverride=function(w){this._mainDrawWrapperOverride=w},w.prototype.setEffect=function(w,v,I,P){void 0===v&&(v=null),void 0===P&&(P=!0);var u=this._drawWrapper;u.setEffect(w,v,P),void 0!==I&&(u.materialContext=I),w||(u.defines=null,u.materialContext=void 0)},w.prototype.resetDrawCache=function(w){if(this._drawWrappers){if(void 0!==w)return void this._removeDrawWrapper(w);for(var v=0,I=this._drawWrappers;v<I.length;v++){var P=I[v];null===P||void 0===P||P.dispose()}}this._drawWrappers=[]},w.AddToMesh=function(v,I,P,u,Q,K,a,U){return void 0===U&&(U=!0),new w(v,I,P,u,Q,K,a,U)},Object.defineProperty(w.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()},enumerable:!1,configurable:!0}),w.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},w.prototype.setBoundingInfo=function(w){return this._boundingInfo=w,this},w.prototype.getMesh=function(){return this._mesh},w.prototype.getRenderingMesh=function(){return this._renderingMesh},w.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},w.prototype.getEffectiveMesh=function(){var w=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return w||this._renderingMesh},w.prototype.getMaterial=function(w){var v;void 0===w&&(w=!0);var I=null!==(v=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==v?v:this._renderingMesh.material;if(!I)return w?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(I)){var P=I.getSubMaterial(this.materialIndex);return this._currentMaterial!==P&&(this._currentMaterial=P,this.resetDrawCache()),P}return I},w.prototype._isMultiMaterial=function(w){return void 0!==w.getSubMaterial},w.prototype.refreshBoundingInfo=function(w){if(void 0===w&&(w=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(w||(w=this._renderingMesh.getVerticesData(P.f.PositionKind)),!w)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var v,I=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===I.length){var u=this._renderingMesh.getBoundingInfo();v={minimum:u.minimum.clone(),maximum:u.maximum.clone()}}else v=(0,K.d)(w,I,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(v.minimum,v.maximum):this._boundingInfo=new Q.e(v.minimum,v.maximum),this},w.prototype._checkCollision=function(w){return this.getBoundingInfo()._checkCollision(w)},w.prototype.updateBoundingInfo=function(w){var v=this.getBoundingInfo();return v||(this.refreshBoundingInfo(),v=this.getBoundingInfo()),v&&v.update(w),this},w.prototype.isInFrustum=function(w){var v=this.getBoundingInfo();return!!v&&v.isInFrustum(w,this._mesh.cullingStrategy)},w.prototype.isCompletelyInFrustum=function(w){var v=this.getBoundingInfo();return!!v&&v.isCompletelyInFrustum(w)},w.prototype.render=function(w){return this._renderingMesh.render(this,w,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},w.prototype._getLinesIndexBuffer=function(w,v){if(!this._linesIndexBuffer){for(var I=[],P=this.indexStart;P<this.indexStart+this.indexCount;P+=3)I.push(w[P],w[P+1],w[P+1],w[P+2],w[P+2],w[P]);this._linesIndexBuffer=v.createIndexBuffer(I),this._linesIndexCount=I.length}return this._linesIndexBuffer},w.prototype.canIntersects=function(w){var v=this.getBoundingInfo();return!!v&&w.intersectsBox(v.boundingBox)},w.prototype.intersects=function(w,v,I,P,u){var Q=this.getMaterial();if(!Q)return null;var K=3,a=!1;switch(Q.fillMode){case 3:case 5:case 6:case 8:return null;case 7:K=1,a=!0}return 4===Q.fillMode?I.length?this._intersectLines(w,v,I,this._mesh.intersectionThreshold,P):this._intersectUnIndexedLines(w,v,I,this._mesh.intersectionThreshold,P):!I.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(w,v,I,P,u):this._intersectTriangles(w,v,I,K,a,P,u)},w.prototype._intersectLines=function(w,v,I,P,Q){for(var K=null,a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){var U=v[I[a]],p=v[I[a+1]],r=w.intersectionSegment(U,p,P);if(!(r<0)&&((Q||!K||r<K.distance)&&((K=new u.c(null,null,r)).faceId=a/2,Q)))break}return K},w.prototype._intersectUnIndexedLines=function(w,v,I,P,Q){for(var K=null,a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=2){var U=v[a],p=v[a+1],r=w.intersectionSegment(U,p,P);if(!(r<0)&&((Q||!K||r<K.distance)&&((K=new u.c(null,null,r)).faceId=a/2,Q)))break}return K},w.prototype._intersectTriangles=function(w,v,I,P,u,Q,K){for(var a=null,U=-1,p=this.indexStart;p<this.indexStart+this.indexCount-(3-P);p+=P){U++;var r=I[p],Y=I[p+1],g=I[p+2];if(u&&4294967295===g)p+=2;else{var J=v[r],l=v[Y],R=v[g];if(J&&l&&R&&(!K||K(J,l,R,w))){var x=w.intersectsTriangle(J,l,R);if(x){if(x.distance<0)continue;if((Q||!a||x.distance<a.distance)&&((a=x).faceId=U,Q))break}}}}return a},w.prototype._intersectUnIndexedTriangles=function(w,v,I,P,u){for(var Q=null,K=this.verticesStart;K<this.verticesStart+this.verticesCount;K+=3){var a=v[K],U=v[K+1],p=v[K+2];if(!u||u(a,U,p,w)){var r=w.intersectsTriangle(a,U,p);if(r){if(r.distance<0)continue;if((P||!Q||r.distance<Q.distance)&&((Q=r).faceId=K/3,P))break}}}return Q},w.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},w.prototype.clone=function(v,I){var P=new w(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,v,I,!1);if(!this.IsGlobal){var u=this.getBoundingInfo();if(!u)return P;P._boundingInfo=new Q.e(u.minimum,u.maximum)}return P},w.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var w=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(w,1),this.resetDrawCache()},w.prototype.getClassName=function(){return"SubMesh"},w.CreateFromIndices=function(v,I,P,u,Q,K){void 0===K&&(K=!0);for(var a=Number.MAX_VALUE,U=-Number.MAX_VALUE,p=(Q||u).getIndices(),r=I;r<I+P;r++){var Y=p[r];Y<a&&(a=Y),Y>U&&(U=Y)}return new w(v,a,U-a+1,I,P,u,Q,K)},w}()},14313:function(w,v,I){"use strict";var P=I(65847),u=I(43251),Q=I(80105);P.b.prototype.thinInstanceAdd=function(w,v){void 0===v&&(v=!0),this._thinInstanceUpdateBufferSize("matrix",Array.isArray(w)?w.length:1);var I=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(w))for(var P=0;P<w.length;++P)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,w[P],P===w.length-1&&v);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,w,v);return I},P.b.prototype.thinInstanceAddSelf=function(w){return void 0===w&&(w=!0),this.thinInstanceAdd(Q.e.IdentityReadOnly,w)},P.b.prototype.thinInstanceRegisterAttribute=function(w,v){w===u.f.ColorKind&&(w=u.f.ColorInstanceKind),this.removeVerticesData(w),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[w]=v,this._userThinInstanceBuffersStorage.sizes[w]=v*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[w]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[w]),this._userThinInstanceBuffersStorage.vertexBuffers[w]=new u.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[w],w,!0,!1,v,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[w])},P.b.prototype.thinInstanceSetMatrixAt=function(w,v,I){if(void 0===I&&(I=!0),!this._thinInstanceDataStorage.matrixData||w>=this._thinInstanceDataStorage.instancesCount)return!1;var P=this._thinInstanceDataStorage.matrixData;return v.copyToArray(P,16*w),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[w]=v),I&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},P.b.prototype.thinInstanceSetAttributeAt=function(w,v,I,P){return void 0===P&&(P=!0),w===u.f.ColorKind&&(w=u.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[w]||v>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(w,0),this._userThinInstanceBuffersStorage.data[w].set(I,v*this._userThinInstanceBuffersStorage.strides[w]),P&&this.thinInstanceBufferUpdated(w),!0)},Object.defineProperty(P.b.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(w){var v,I,P=null!==(v=this._thinInstanceDataStorage.matrixData)&&void 0!==v?v:null===(I=this.source)||void 0===I?void 0:I._thinInstanceDataStorage.matrixData;w<=(P?P.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=w)},enumerable:!0,configurable:!0}),P.b.prototype._thinInstanceCreateMatrixBuffer=function(w,v,I){void 0===I&&(I=!1),w===u.f.ColorKind&&(w=u.f.ColorInstanceKind);for(var P=new u.c(this.getEngine(),v,!I,16,!1,!0),Q=0;Q<4;Q++)this.setVerticesBuffer(P.createVertexBuffer(w+Q,4*Q,4));return P},P.b.prototype.thinInstanceSetBuffer=function(w,v,I,P){var Q,K,a;void 0===I&&(I=0),void 0===P&&(P=!1),I=I||16,"matrix"===w?(null===(Q=this._thinInstanceDataStorage.matrixBuffer)||void 0===Q||Q.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=v?v.length:32*I,this._thinInstanceDataStorage.matrixData=v,this._thinInstanceDataStorage.worldMatrices=null,null!==v?(this._thinInstanceDataStorage.instancesCount=v.length/I,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",v,P),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):"previousMatrix"===w?(null===(K=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===K||K.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=v,null!==v&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",v,P))):(w===u.f.ColorKind&&(w=u.f.ColorInstanceKind),null===v?(null===(a=this._userThinInstanceBuffersStorage)||void 0===a?void 0:a.data[w])&&(this.removeVerticesData(w),delete this._userThinInstanceBuffersStorage.data[w],delete this._userThinInstanceBuffersStorage.strides[w],delete this._userThinInstanceBuffersStorage.sizes[w],delete this._userThinInstanceBuffersStorage.vertexBuffers[w]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[w]=v,this._userThinInstanceBuffersStorage.strides[w]=I,this._userThinInstanceBuffersStorage.sizes[w]=v.length,this._userThinInstanceBuffersStorage.vertexBuffers[w]=new u.f(this.getEngine(),v,w,!P,!1,I,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[w])))},P.b.prototype.thinInstanceBufferUpdated=function(w){var v,I,P;"matrix"===w?null===(v=this._thinInstanceDataStorage.matrixBuffer)||void 0===v||v.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount):"previousMatrix"===w?null===(I=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===I||I.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount):(w===u.f.ColorKind&&(w=u.f.ColorInstanceKind),(null===(P=this._userThinInstanceBuffersStorage)||void 0===P?void 0:P.vertexBuffers[w])&&this._userThinInstanceBuffersStorage.vertexBuffers[w].updateDirectly(this._userThinInstanceBuffersStorage.data[w],0))},P.b.prototype.thinInstancePartialBufferUpdate=function(w,v,I){var P;"matrix"===w?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(v,I):(w===u.f.ColorKind&&(w=u.f.ColorInstanceKind),(null===(P=this._userThinInstanceBuffersStorage)||void 0===P?void 0:P.vertexBuffers[w])&&this._userThinInstanceBuffersStorage.vertexBuffers[w].updateDirectly(v,I))},P.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];var w=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=new Array;for(var v=0;v<this._thinInstanceDataStorage.instancesCount;++v)this._thinInstanceDataStorage.worldMatrices[v]=Q.e.FromArray(w,16*v)}return this._thinInstanceDataStorage.worldMatrices},P.b.prototype.thinInstanceRefreshBoundingInfo=function(w,v,I){if(void 0===w&&(w=!1),void 0===v&&(v=!1),void 0===I&&(I=!1),this._thinInstanceDataStorage.matrixData&&this._thinInstanceDataStorage.matrixBuffer){var P=this._thinInstanceDataStorage.boundingVectors;w&&(P.length=0,this.refreshBoundingInfo(v,I));var u=this.getBoundingInfo(),K=this._thinInstanceDataStorage.matrixData;if(0===P.length)for(var a=0;a<u.boundingBox.vectors.length;++a)P.push(u.boundingBox.vectors[a].clone());Q.i.Vector3[0].setAll(Number.POSITIVE_INFINITY),Q.i.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var U=0;U<this._thinInstanceDataStorage.instancesCount;++U){Q.e.FromArrayToRef(K,16*U,Q.i.Matrix[0]);for(a=0;a<P.length;++a)Q.l.TransformCoordinatesToRef(P[a],Q.i.Matrix[0],Q.i.Vector3[2]),Q.i.Vector3[0].minimizeInPlace(Q.i.Vector3[2]),Q.i.Vector3[1].maximizeInPlace(Q.i.Vector3[2])}u.reConstruct(Q.i.Vector3[0],Q.i.Vector3[1]),this._updateBoundingInfo()}},P.b.prototype._thinInstanceUpdateBufferSize=function(w,v){var I,P,Q;void 0===v&&(v=1),w===u.f.ColorKind&&(w=u.f.ColorInstanceKind);var K="matrix"===w;if(K||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[w]){for(var a=K?16:this._userThinInstanceBuffersStorage.strides[w],U=K?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[w],p=K?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[w],r=(this._thinInstanceDataStorage.instancesCount+v)*a,Y=U;Y<r;)Y*=2;if(!p||U!=Y){if(p){var g=new Float32Array(Y);g.set(p,0),p=g}else p=new Float32Array(Y);K?(null===(I=this._thinInstanceDataStorage.matrixBuffer)||void 0===I||I.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",p,!1),this._thinInstanceDataStorage.matrixData=p,this._thinInstanceDataStorage.matrixBufferSize=Y,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(null===(P=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===P||P.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",p,!1))):(null===(Q=this._userThinInstanceBuffersStorage.vertexBuffers[w])||void 0===Q||Q.dispose(),this._userThinInstanceBuffersStorage.data[w]=p,this._userThinInstanceBuffersStorage.sizes[w]=Y,this._userThinInstanceBuffersStorage.vertexBuffers[w]=new u.f(this.getEngine(),p,w,!0,!1,a,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[w]))}}},P.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},P.b.prototype._disposeThinInstanceSpecificData=function(){var w;(null===(w=this._thinInstanceDataStorage)||void 0===w?void 0:w.matrixBuffer)&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},77129:function(w,v,I){"use strict";I.d(v,{d:function(){return p}});var P=I(78502),u=I(9892),Q=I(9271),K=I(80105),a=I(74134),U=I(54044),p=function(w){function v(I,P,u){void 0===P&&(P=null),void 0===u&&(u=!0);var a=w.call(this,I,P)||this;return a._forward=new K.l(0,0,1),a._up=new K.l(0,1,0),a._right=new K.l(1,0,0),a._position=K.l.Zero(),a._rotation=K.l.Zero(),a._rotationQuaternion=null,a._scaling=K.l.One(),a._transformToBoneReferal=null,a._isAbsoluteSynced=!1,a._billboardMode=v.BILLBOARDMODE_NONE,a._preserveParentRotationForBillboard=!1,a.scalingDeterminant=1,a._infiniteDistance=!1,a.ignoreNonUniformScaling=!1,a.reIntegrateRotationIntoRotationQuaternion=!1,a._poseMatrix=null,a._localMatrix=K.e.Zero(),a._usePivotMatrix=!1,a._absolutePosition=K.l.Zero(),a._absoluteScaling=K.l.Zero(),a._absoluteRotationQuaternion=K.f.Identity(),a._pivotMatrix=K.e.Identity(),a._postMultiplyPivotMatrix=!1,a._isWorldMatrixFrozen=!1,a._indexInSceneTransformNodesArray=-1,a.onAfterWorldMatrixUpdateObservable=new Q.c,a._nonUniformScaling=!1,u&&a.getScene().addTransformNode(a),a}return(0,P.m)(v,w),Object.defineProperty(v.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(w){this._billboardMode!==w&&(this._billboardMode=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(w){w!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(w){this._infiniteDistance!==w&&(this._infiniteDistance=w)},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(v.prototype,"position",{get:function(){return this._position},set:function(w){this._position=w,this._isDirty=!0},enumerable:!1,configurable:!0}),v.prototype.isUsingPivotMatrix=function(){return this._usePivotMatrix},Object.defineProperty(v.prototype,"rotation",{get:function(){return this._rotation},set:function(w){this._rotation=w,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"scaling",{get:function(){return this._scaling},set:function(w){this._scaling=w,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(w){this._rotationQuaternion=w,w&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"forward",{get:function(){return K.l.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"up",{get:function(){return K.l.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"right",{get:function(){return K.l.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()},enumerable:!1,configurable:!0}),v.prototype.updatePoseMatrix=function(w){return this._poseMatrix?(this._poseMatrix.copyFrom(w),this):(this._poseMatrix=w.clone(),this)},v.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=K.e.Identity()),this._poseMatrix},v.prototype._isSynchronized=function(){var w=this._cache;return this._billboardMode===w.billboardMode&&this._billboardMode===v.BILLBOARDMODE_NONE&&(!w.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))},v.prototype._initCache=function(){w.prototype._initCache.call(this);var v=this._cache;v.localMatrixUpdated=!1,v.billboardMode=-1,v.infiniteDistance=!1},Object.defineProperty(v.prototype,"absolutePosition",{get:function(){return this.getAbsolutePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),v.prototype.setPreTransformMatrix=function(w){return this.setPivotMatrix(w,!1)},v.prototype.setPivotMatrix=function(w,v){return void 0===v&&(v=!0),this._pivotMatrix.copyFrom(w),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=v,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=K.e.Invert(this._pivotMatrix)),this},v.prototype.getPivotMatrix=function(){return this._pivotMatrix},v.prototype.instantiateHierarchy=function(w,v,I){void 0===w&&(w=null);var P=this.clone("Clone of "+(this.name||this.id),w||this.parent,!0);P&&I&&I(this,P);for(var u=0,Q=this.getChildTransformNodes(!0);u<Q.length;u++){Q[u].instantiateHierarchy(P,v,I)}return P},v.prototype.freezeWorldMatrix=function(w,v){return void 0===w&&(w=null),void 0===v&&(v=!1),w?v?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||K.f.Identity(),w.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=w,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},v.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(v.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),v.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},v.prototype.setAbsolutePosition=function(w){if(!w)return this;var v,I,P;if(void 0===w.x){if(arguments.length<3)return this;v=arguments[0],I=arguments[1],P=arguments[2]}else v=w.x,I=w.y,P=w.z;if(this.parent){var u=K.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(u),K.l.TransformCoordinatesFromFloatsToRef(v,I,P,u,this.position)}else this.position.x=v,this.position.y=I,this.position.z=P;return this._absolutePosition.copyFrom(w),this},v.prototype.setPositionWithLocalVector=function(w){return this.computeWorldMatrix(),this.position=K.l.TransformNormal(w,this._localMatrix),this},v.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var w=K.i.Matrix[0];return this._localMatrix.invertToRef(w),K.l.TransformNormal(this.position,w)},v.prototype.locallyTranslate=function(w){return this.computeWorldMatrix(!0),this.position=K.l.TransformCoordinates(w,this._localMatrix),this},v.prototype.lookAt=function(w,I,P,u,Q){void 0===I&&(I=0),void 0===P&&(P=0),void 0===u&&(u=0),void 0===Q&&(Q=U.j.LOCAL);var a=v._LookAtVectorCache,p=Q===U.j.LOCAL?this.position:this.getAbsolutePosition();if(w.subtractToRef(p,a),this.setDirection(a,I,P,u),Q===U.j.WORLD&&this.parent)if(this.rotationQuaternion){var r=K.i.Matrix[0];this.rotationQuaternion.toRotationMatrix(r);var Y=K.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Y),Y.invert(),r.multiplyToRef(Y,r),this.rotationQuaternion.fromRotationMatrix(r)}else{var g=K.i.Quaternion[0];K.f.FromEulerVectorToRef(this.rotation,g);r=K.i.Matrix[0];g.toRotationMatrix(r);Y=K.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Y),Y.invert(),r.multiplyToRef(Y,r),g.fromRotationMatrix(r),g.toEulerAnglesToRef(this.rotation)}return this},v.prototype.getDirection=function(w){var v=K.l.Zero();return this.getDirectionToRef(w,v),v},v.prototype.getDirectionToRef=function(w,v){return K.l.TransformNormalToRef(w,this.getWorldMatrix(),v),this},v.prototype.setDirection=function(w,v,I,P){void 0===v&&(v=0),void 0===I&&(I=0),void 0===P&&(P=0);var u=-Math.atan2(w.z,w.x)+Math.PI/2,Q=Math.sqrt(w.x*w.x+w.z*w.z),a=-Math.atan2(w.y,Q);return this.rotationQuaternion?K.f.RotationYawPitchRollToRef(u+v,a+I,P,this.rotationQuaternion):(this.rotation.x=a+I,this.rotation.y=u+v,this.rotation.z=P),this},v.prototype.setPivotPoint=function(w,v){void 0===v&&(v=U.j.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var I=this.getWorldMatrix();if(v==U.j.WORLD){var P=K.i.Matrix[0];I.invertToRef(P),w=K.l.TransformCoordinates(w,P)}return this.setPivotMatrix(K.e.Translation(-w.x,-w.y,-w.z),!0)},v.prototype.getPivotPoint=function(){var w=K.l.Zero();return this.getPivotPointToRef(w),w},v.prototype.getPivotPointToRef=function(w){return w.x=-this._pivotMatrix.m[12],w.y=-this._pivotMatrix.m[13],w.z=-this._pivotMatrix.m[14],this},v.prototype.getAbsolutePivotPoint=function(){var w=K.l.Zero();return this.getAbsolutePivotPointToRef(w),w},v.prototype.getAbsolutePivotPointToRef=function(w){return this.getPivotPointToRef(w),K.l.TransformCoordinatesToRef(w,this.getWorldMatrix(),w),this},v.prototype.markAsDirty=function(v){if(this._children)for(var I=0,P=this._children;I<P.length;I++){P[I].markAsDirty(v)}return w.prototype.markAsDirty.call(this,v)},v.prototype.setParent=function(w,I){if(void 0===I&&(I=!1),!w&&!this.parent)return this;var P=K.i.Quaternion[0],u=K.i.Vector3[0],Q=K.i.Vector3[1],a=K.i.Matrix[1];K.e.IdentityToRef(a);var U=K.i.Matrix[0];this.computeWorldMatrix(!0);var p=this.rotationQuaternion;return p||(p=v._TmpRotation,K.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,p)),K.e.ComposeToRef(this.scaling,p,this.position,U),this.parent&&U.multiplyToRef(this.parent.computeWorldMatrix(!0),U),w&&(w.computeWorldMatrix(!0).invertToRef(a),U.multiplyToRef(a,U)),U.decompose(Q,P,u,I?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(P):P.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(Q),this.position.copyFrom(u),this.parent=w,this},Object.defineProperty(v.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),v.prototype._updateNonUniformScalingState=function(w){return this._nonUniformScaling!==w&&(this._nonUniformScaling=w,!0)},v.prototype.attachToBone=function(w,v){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=v,this.parent=w,w.getSkeleton().prepare(),w.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},v.prototype.detachFromBone=function(w){return void 0===w&&(w=!1),this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=w?this._currentParentWhenAttachingToBone:null,this):(w&&(this.parent=this._currentParentWhenAttachingToBone),this)},v.prototype.rotate=function(w,I,P){var u;if(w.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),P&&P!==U.j.LOCAL){if(this.parent){var Q=K.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(Q),w=K.l.TransformNormal(w,Q)}(u=K.f.RotationAxisToRef(w,I,v._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else u=K.f.RotationAxisToRef(w,I,v._RotationAxisCache),this.rotationQuaternion.multiplyToRef(u,this.rotationQuaternion);return this},v.prototype.rotateAround=function(w,v,I){v.normalize(),this.rotationQuaternion||(this.rotationQuaternion=K.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var P=K.i.Vector3[0],u=K.i.Vector3[1],Q=K.i.Vector3[2],a=K.i.Quaternion[0],U=K.i.Matrix[0],p=K.i.Matrix[1],r=K.i.Matrix[2],Y=K.i.Matrix[3];return w.subtractToRef(this.position,P),K.e.TranslationToRef(P.x,P.y,P.z,U),K.e.TranslationToRef(-P.x,-P.y,-P.z,p),K.e.RotationAxisToRef(v,I,r),p.multiplyToRef(r,Y),Y.multiplyToRef(U,Y),Y.decompose(u,a,Q),this.position.addInPlace(Q),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},v.prototype.translate=function(w,v,I){var P=w.scale(v);if(I&&I!==U.j.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(P));else{var u=this.getPositionExpressedInLocalSpace().add(P);this.setPositionWithLocalVector(u)}return this},v.prototype.addRotation=function(w,v,I){var P;this.rotationQuaternion?P=this.rotationQuaternion:(P=K.i.Quaternion[1],K.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,P));var u=K.i.Quaternion[0];return K.f.RotationYawPitchRollToRef(v,w,I,u),P.multiplyInPlace(u),this.rotationQuaternion||P.toEulerAnglesToRef(this.rotation),this},v.prototype._getEffectiveParent=function(){return this.parent},v.prototype.computeWorldMatrix=function(w){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var I=this.getScene().getRenderId();if(!this._isDirty&&!w&&(this._currentRenderId===I||this.isSynchronized()))return this._currentRenderId=I,this._worldMatrix;var P=this.getScene().activeCamera,u=0!==(this._billboardMode&v.BILLBOARDMODE_USE_POSITION),Q=this._billboardMode!==v.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;this._updateCache();var a=this._cache;a.pivotMatrixUpdated=!1,a.billboardMode=this.billboardMode,a.infiniteDistance=this.infiniteDistance,a.parent=this._parentNode,this._currentRenderId=I,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var U,p=this._getEffectiveParent(),r=v._TmpScaling,Y=this._position;if(this._infiniteDistance&&!this.parent&&P){var g=P.getWorldMatrix(),J=new K.l(g.m[12],g.m[13],g.m[14]);(Y=v._TmpTranslation).copyFromFloats(this._position.x+J.x,this._position.y+J.y,this._position.z+J.z)}(r.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion)?(this._rotationQuaternion._isDirty=!1,U=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&(E=this.rotation.lengthSquared())&&(this._rotationQuaternion.multiplyInPlace(K.f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(U=v._TmpRotation,K.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,U));if(this._usePivotMatrix){var l=K.i.Matrix[1];K.e.ScalingToRef(r.x,r.y,r.z,l);var R=K.i.Matrix[0];U.toRotationMatrix(R),this._pivotMatrix.multiplyToRef(l,K.i.Matrix[4]),K.i.Matrix[4].multiplyToRef(R,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(Y.x,Y.y,Y.z)}else K.e.ComposeToRef(r,U,Y,this._localMatrix);if(p&&p.getWorldMatrix){if(w&&p.computeWorldMatrix(w),Q){this._transformToBoneReferal?p.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),K.i.Matrix[7]):K.i.Matrix[7].copyFrom(p.getWorldMatrix());var x=K.i.Vector3[5],j=K.i.Vector3[6];K.i.Matrix[7].decompose(j,void 0,x),K.e.ScalingToRef(j.x,j.y,j.z,K.i.Matrix[7]),K.i.Matrix[7].setTranslation(x),this._localMatrix.multiplyToRef(K.i.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(p.getWorldMatrix(),K.i.Matrix[6]),K.i.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(p.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(Q&&P&&this.billboardMode&&!u){var s=K.i.Vector3[0];if(this._worldMatrix.getTranslationToRef(s),K.i.Matrix[1].copyFrom(P.getViewMatrix()),K.i.Matrix[1].setTranslationFromFloats(0,0,0),K.i.Matrix[1].invertToRef(K.i.Matrix[0]),(this.billboardMode&v.BILLBOARDMODE_ALL)!==v.BILLBOARDMODE_ALL){K.i.Matrix[0].decompose(void 0,K.i.Quaternion[0],void 0);var B=K.i.Vector3[1];K.i.Quaternion[0].toEulerAnglesToRef(B),(this.billboardMode&v.BILLBOARDMODE_X)!==v.BILLBOARDMODE_X&&(B.x=0),(this.billboardMode&v.BILLBOARDMODE_Y)!==v.BILLBOARDMODE_Y&&(B.y=0),(this.billboardMode&v.BILLBOARDMODE_Z)!==v.BILLBOARDMODE_Z&&(B.z=0),K.e.RotationYawPitchRollToRef(B.y,B.x,B.z,K.i.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(K.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(K.i.Vector3[0])}else if(Q&&P&&this.billboardMode&&u){s=K.i.Vector3[0];this._worldMatrix.getTranslationToRef(s);var t=P.globalPosition;this._worldMatrix.invertToRef(K.i.Matrix[1]);var i=K.i.Vector3[1];K.l.TransformCoordinatesToRef(t,K.i.Matrix[1],i),i.normalize();var z=-Math.atan2(i.z,i.x)+Math.PI/2,E=Math.sqrt(i.x*i.x+i.z*i.z),o=-Math.atan2(i.y,E);if(K.f.RotationYawPitchRollToRef(z,o,0,K.i.Quaternion[0]),(this.billboardMode&v.BILLBOARDMODE_ALL)!==v.BILLBOARDMODE_ALL){B=K.i.Vector3[1];K.i.Quaternion[0].toEulerAnglesToRef(B),(this.billboardMode&v.BILLBOARDMODE_X)!==v.BILLBOARDMODE_X&&(B.x=0),(this.billboardMode&v.BILLBOARDMODE_Y)!==v.BILLBOARDMODE_Y&&(B.y=0),(this.billboardMode&v.BILLBOARDMODE_Z)!==v.BILLBOARDMODE_Z&&(B.z=0),K.e.RotationYawPitchRollToRef(B.y,B.x,B.z,K.i.Matrix[0])}else K.e.FromQuaternionToRef(K.i.Quaternion[0],K.i.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(K.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(K.i.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):p&&p._nonUniformScaling?this._updateNonUniformScalingState(p._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=K.e.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},v.prototype.resetLocalMatrix=function(w){if(void 0===w&&(w=!0),this.computeWorldMatrix(),w)for(var v=this.getChildren(),I=0;I<v.length;++I){var P=v[I];if(P){P.computeWorldMatrix();var u=K.i.Matrix[0];P._localMatrix.multiplyToRef(this._localMatrix,u);var Q=K.i.Quaternion[0];u.decompose(P.scaling,Q,P.position),P.rotationQuaternion?P.rotationQuaternion.copyFrom(Q):Q.toEulerAnglesToRef(P.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=K.f.Identity()),this._worldMatrix=K.e.Identity()},v.prototype._afterComputeWorldMatrix=function(){},v.prototype.registerAfterWorldMatrixUpdate=function(w){return this.onAfterWorldMatrixUpdateObservable.add(w),this},v.prototype.unregisterAfterWorldMatrixUpdate=function(w){return this.onAfterWorldMatrixUpdateObservable.removeCallback(w),this},v.prototype.getPositionInCameraSpace=function(w){return void 0===w&&(w=null),w||(w=this.getScene().activeCamera),K.l.TransformCoordinates(this.getAbsolutePosition(),w.getViewMatrix())},v.prototype.getDistanceToCamera=function(w){return void 0===w&&(w=null),w||(w=this.getScene().activeCamera),this.getAbsolutePosition().subtract(w.globalPosition).length()},v.prototype.clone=function(w,I,P){var Q=this,K=u.e.Clone((function(){return new v(w,Q.getScene())}),this);if(K.name=w,K.id=w,I&&(K.parent=I),!P)for(var a=this.getDescendants(!0),U=0;U<a.length;U++){var p=a[U];p.clone&&p.clone(w+"."+p.name,K)}return K},v.prototype.serialize=function(w){var v=u.e.Serialize(this,w);return v.type=this.getClassName(),v.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(v),v.localMatrix=this.getPivotMatrix().asArray(),v.isEnabled=this.isEnabled(),v},v.Parse=function(w,I,P){var Q=u.e.Parse((function(){return new v(w.name,I)}),w,I,P);return w.localMatrix?Q.setPreTransformMatrix(K.e.FromArray(w.localMatrix)):w.pivotMatrix&&Q.setPivotMatrix(K.e.FromArray(w.pivotMatrix)),Q.setEnabled(w.isEnabled),void 0!==w.parentId&&(Q._waitingParentId=w.parentId),void 0!==w.parentInstanceIndex&&(Q._waitingParentInstanceIndex=w.parentInstanceIndex),Q},v.prototype.getChildTransformNodes=function(w,I){var P=[];return this._getDescendants(P,w,(function(w){return(!I||I(w))&&w instanceof v})),P},v.prototype.dispose=function(v,I){if(void 0===I&&(I=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){var P=this._parentContainer.transformNodes.indexOf(this);P>-1&&this._parentContainer.transformNodes.splice(P,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),v)for(var u=0,Q=this.getChildTransformNodes(!0);u<Q.length;u++){var K=Q[u];K.parent=null,K.computeWorldMatrix(!0)}w.prototype.dispose.call(this,v,I)},v.prototype.normalizeToUnitCube=function(w,v,I){void 0===w&&(w=!0),void 0===v&&(v=!1);var P=null,u=null;v&&(this.rotationQuaternion?(u=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(P=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var Q=this.getHierarchyBoundingVectors(w,I),K=Q.max.subtract(Q.min),a=Math.max(K.x,K.y,K.z);if(0===a)return this;var U=1/a;return this.scaling.scaleInPlace(U),v&&(this.rotationQuaternion&&u?this.rotationQuaternion.copyFrom(u):this.rotation&&P&&this.rotation.copyFrom(P)),this},v.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},v.BILLBOARDMODE_NONE=0,v.BILLBOARDMODE_X=1,v.BILLBOARDMODE_Y=2,v.BILLBOARDMODE_Z=4,v.BILLBOARDMODE_ALL=7,v.BILLBOARDMODE_USE_POSITION=128,v._TmpRotation=K.f.Zero(),v._TmpScaling=K.l.Zero(),v._TmpTranslation=K.l.Zero(),v._LookAtVectorCache=new K.l(0,0,0),v._RotationAxisCache=new K.f,(0,P.i)([(0,u.G)("position")],v.prototype,"_position",void 0),(0,P.i)([(0,u.G)("rotation")],v.prototype,"_rotation",void 0),(0,P.i)([(0,u.A)("rotationQuaternion")],v.prototype,"_rotationQuaternion",void 0),(0,P.i)([(0,u.G)("scaling")],v.prototype,"_scaling",void 0),(0,P.i)([(0,u.J)("billboardMode")],v.prototype,"_billboardMode",void 0),(0,P.i)([(0,u.J)()],v.prototype,"scalingDeterminant",void 0),(0,P.i)([(0,u.J)("infiniteDistance")],v.prototype,"_infiniteDistance",void 0),(0,P.i)([(0,u.J)()],v.prototype,"ignoreNonUniformScaling",void 0),(0,P.i)([(0,u.J)()],v.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),v}(a.b)},89214:function(w,v,I){"use strict";I.d(v,{c:function(){return P}});var P=function(){function w(){}return w.BuildArray=function(w,v){for(var I=[],P=0;P<w;++P)I.push(v());return I},w.BuildTuple=function(v,I){return w.BuildArray(v,I)},w}()},5344:function(w,v,I){"use strict";I.d(v,{b:function(){return a}});var P=I(70937),u=I(81965),Q=I(9217),K=0,a=function(w){if(!w.environmentBRDFTexture){var v=w.useDelayedTextureLoading;w.useDelayedTextureLoading=!1;var I=w._blockEntityCollection;w._blockEntityCollection=!1;var a=P.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+K++,w,!0,!1,P.e.BILINEAR_SAMPLINGMODE);w._blockEntityCollection=I;var U=w.getEngine().getLoadedTexturesCache(),p=U.indexOf(a.getInternalTexture());-1!==p&&U.splice(p,1),a.isRGBD=!0,a.wrapU=P.e.CLAMP_ADDRESSMODE,a.wrapV=P.e.CLAMP_ADDRESSMODE,w.environmentBRDFTexture=a,w.useDelayedTextureLoading=v,u.e.ExpandRGBDTexture(a);var r=w.getEngine().onContextRestoredObservable.add((function(){a.isRGBD=!0;!function w(){a.isReady()?u.e.ExpandRGBDTexture(a):Q.i.SetImmediate(w)}()}));w.onDisposeObservable.add((function(){w.getEngine().onContextRestoredObservable.remove(r)}))}return w.environmentBRDFTexture}},61633:function(w,v,I){"use strict";function P(w,v,I){try{var P=w.next();P.done?v(P):P.value?P.value.then((function(){P.value=void 0,v(P)}),I):v(P)}catch(w){I(w)}}function u(w){var v;return void 0===w&&(w=25),function(I,u,Q){var K=performance.now();void 0===v||K-v>w?(v=K,setTimeout((function(){P(I,u,Q)}),0)):P(I,u,Q)}}function Q(w,v,I,P,u){!function Q(){var K,a=function(w){w.done?I(w.value):void 0===K?K=!0:Q()};do{K=void 0,u&&u.aborted?P(new Error("Aborted")):v(w,a,P),void 0===K&&(K=!1)}while(K)}()}function K(w,v){var I;return Q(w,P,(function(w){return I=w}),(function(w){throw w}),v),I}function a(w,v,I){return new Promise((function(P,u){Q(w,v,P,u,I)}))}function U(w,v){return function(){for(var I=[],P=0;P<arguments.length;P++)I[P]=arguments[P];return K(w.apply(void 0,I),v)}}I.d(v,{b:function(){return u},e:function(){return U},h:function(){return a},l:function(){return K}})},9892:function(w,v,I){"use strict";I.d(v,{A:function(){return E},B:function(){return l},D:function(){return j},G:function(){return s},J:function(){return J},e:function(){return h},h:function(){return g},j:function(){return n},m:function(){return t},n:function(){return R},q:function(){return i},t:function(){return x},u:function(){return z},v:function(){return o},w:function(){return B}});var P=I(45883),u=I(80105),Q=I(50504),K=I(9488),a={},U={},p=function(w,v,I){var u=w();P.c&&P.c.AddTagsTo(u,v.tags);var Q=r(u);for(var K in Q){var a=Q[K],U=v[K],p=a.type;if(void 0!==U&&null!==U&&("uniqueId"!==K||h.AllowLoadingUniqueId))switch(p){case 0:case 6:case 11:u[K]=U;break;case 1:u[K]=I||U.isRenderTarget?U:U.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:u[K]=I?U:U.clone()}}return u};function r(w){var v=w.getClassName();if(U[v])return U[v];U[v]={};for(var I=U[v],P=w,u=v;u;){var Q=a[u];for(var K in Q)I[K]=Q[K];var p=void 0,r=!1;do{if(!(p=Object.getPrototypeOf(P)).getClassName){r=!0;break}if(p.getClassName()!==u)break;P=p}while(p);if(r)break;u=p.getClassName(),P=p}return I}function Y(w,v){return function(I,P){var u=function(w){var v=w.getClassName();return a[v]||(a[v]={}),a[v]}(I);u[P]||(u[P]={type:w,sourceName:v})}}function g(w,v){return void 0===v&&(v=null),function(w,v){return void 0===v&&(v=null),function(I,P){var u=v||"_"+P;Object.defineProperty(I,P,{get:function(){return this[u]},set:function(v){"function"===typeof this.equals&&this.equals(v)||this[u]!==v&&(this[u]=v,I[w].apply(this))},enumerable:!0,configurable:!0})}}(w,v)}function J(w){return Y(0,w)}function l(w){return Y(1,w)}function R(w){return Y(2,w)}function x(w){return Y(3,w)}function j(w){return Y(4,w)}function s(w){return Y(5,w)}function B(w){return Y(6,w)}function t(w){return Y(7,w)}function i(w){return Y(8,w)}function z(w){return Y(9,w)}function E(w){return Y(10,w)}function o(w){return Y(12,w)}var h=function(){function w(){}return w.AppendSerializedAnimations=function(w,v){if(w.animations){v.animations=[];for(var I=0;I<w.animations.length;I++){var P=w.animations[I];v.animations.push(P.serialize())}}},w.Serialize=function(v,I){I||(I={}),P.c&&(I.tags=P.c.GetTags(v));var u=r(v);for(var Q in u){var K=u[Q],a=K.sourceName||Q,U=K.type,p=v[Q];if(void 0!==p&&null!==p&&("uniqueId"!==Q||w.AllowLoadingUniqueId))switch(U){case 0:I[a]=p;break;case 1:case 3:case 7:case 9:I[a]=p.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:I[a]=p.asArray();break;case 6:case 11:I[a]=p.id}}return I},w.Parse=function(v,I,Q,a){void 0===a&&(a=null);var U=v();a||(a=""),P.c&&P.c.AddTagsTo(U,I.tags);var p=r(U);for(var Y in p){var g=p[Y],J=I[g.sourceName||Y],l=g.type;if(void 0!==J&&null!==J&&("uniqueId"!==Y||w.AllowLoadingUniqueId)){var R=U;switch(l){case 0:R[Y]=J;break;case 1:Q&&(R[Y]=w._TextureParser(J,Q,a));break;case 2:R[Y]=K.b.FromArray(J);break;case 3:R[Y]=w._FresnelParametersParser(J);break;case 4:R[Y]=u.k.FromArray(J);break;case 5:R[Y]=u.l.FromArray(J);break;case 6:Q&&(R[Y]=Q.getLastMeshById(J));break;case 7:R[Y]=w._ColorCurvesParser(J);break;case 8:R[Y]=K.f.FromArray(J);break;case 9:R[Y]=w._ImageProcessingConfigurationParser(J);break;case 10:R[Y]=u.f.FromArray(J);break;case 11:Q&&(R[Y]=Q.getCameraById(J));break;case 12:R[Y]=u.e.FromArray(J)}}}return U},w.Clone=function(w,v){return p(w,v,!1)},w.Instanciate=function(w,v){return p(w,v,!0)},w.AllowLoadingUniqueId=!1,w._ImageProcessingConfigurationParser=function(w){throw(0,Q.e)("ImageProcessingConfiguration")},w._FresnelParametersParser=function(w){throw(0,Q.e)("FresnelParameters")},w._ColorCurvesParser=function(w){throw(0,Q.e)("ColorCurves")},w._TextureParser=function(w,v,I){throw(0,Q.e)("Texture")},w}();function n(w,v,I,P){var u=I.value;I.value=function(){for(var I=[],Q=0;Q<arguments.length;Q++)I[Q]=arguments[Q];var K=u;if("undefined"!==typeof _native&&_native[v]){var a=_native[v];K=P?function(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];return P.apply(void 0,w)?a.apply(void 0,w):u.apply(void 0,w)}:a}return w[v]=K,K.apply(void 0,I)}}n.filter=function(w){return function(v,I,P){return n(v,I,P,w)}}},51004:function(w,v,I){"use strict";I.d(v,{e:function(){return Q}});var P=I(9127),u=function(w,v){return w?w.getClassName&&"Mesh"===w.getClassName()?null:w.getClassName&&"SubMesh"===w.getClassName()?w.clone(v):w.clone?w.clone():null:null};var Q=function(){function w(){}return w.DeepCopy=function(w,v,I,Q){for(var K=function(w){var v=[];do{Object.getOwnPropertyNames(w).forEach((function(w){-1===v.indexOf(w)&&v.push(w)}))}while(w=Object.getPrototypeOf(w));return v}(w),a=0,U=K;a<U.length;a++){var p=U[a];if(("_"!==p[0]||Q&&-1!==Q.indexOf(p))&&(!p.endsWith("Observable")&&(!I||-1===I.indexOf(p)))){var r=w[p],Y=typeof r;if("function"!==Y)try{if("object"===Y)if(r instanceof Array){if(v[p]=[],r.length>0)if("object"==typeof r[0])for(var g=0;g<r.length;g++){var J=u(r[g],v);-1===v[p].indexOf(J)&&v[p].push(J)}else v[p]=r.slice(0)}else v[p]=u(r,v);else v[p]=r}catch(w){P.e.Warn(w.message)}}}},w}()},50504:function(w,v,I){"use strict";function P(w){return"".concat(w," needs to be imported before as it contains a side-effect required by your code.")}I.d(v,{e:function(){return P}})},60985:function(w,v,I){"use strict";function P(){return"undefined"!==typeof window}function u(){return"undefined"!==typeof navigator}function Q(){return"undefined"!==typeof document}function K(w){for(var v="",I=w.firstChild;I;)3===I.nodeType&&(v+=I.textContent),I=I.nextSibling;return v}I.d(v,{e:function(){return a},i:function(){return K},l:function(){return Q},p:function(){return u},r:function(){return P}});var a={IsWindowObjectExist:P,IsNavigatorAvailable:u,IsDocumentAvailable:Q,GetDOMTextContent:K}},39524:function(w,v,I){"use strict";I.d(v,{d:function(){return u},e:function(){return Q},f:function(){return K}});var P=I(78502),u=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return(0,P.m)(v,w),v._setPrototypeOf=Object.setPrototypeOf||function(w,v){return w.__proto__=v,w},v}(Error),Q={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},K=function(w){function v(I,P,Q){var K=w.call(this,I)||this;return K.errorCode=P,K.innerError=Q,K.name="RuntimeError",u._setPrototypeOf(K,v.prototype),K}return(0,P.m)(v,w),v}(u)},82790:function(w,v,I){"use strict";I.d(v,{c:function(){return F},e:function(){return t},h:function(){return V},k:function(){return h},j:function(){return j},m:function(){return E},p:function(){return o},t:function(){return n},x:function(){return z}});var P=I(78502),u=I(67935),Q=I(60985),K=I(9271),a=function(){function w(){}return w.FilesToLoad={},w}(),U=function(){function w(){}return w.ExponentialBackoff=function(w,v){return void 0===w&&(w=3),void 0===v&&(v=500),function(I,P,u){return 0!==P.status||u>=w||-1!==I.indexOf("file:")?-1:Math.pow(2,u)*v}},w}(),p=I(39524),r=I(50459),Y=I(42647),g=I(72284),J=I(78588),l=I(9127),R=I(1116),x=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),j=function(w){function v(I,P){var Q=w.call(this,I,p.e.LoadFileError)||this;return Q.name="LoadFileError",p.d._setPrototypeOf(Q,v.prototype),P instanceof u.b?Q.request=P:Q.file=P,Q}return(0,P.m)(v,w),v}(p.f),s=function(w){function v(I,P){var u=w.call(this,I,p.e.RequestFileError)||this;return u.request=P,u.name="RequestFileError",p.d._setPrototypeOf(u,v.prototype),u}return(0,P.m)(v,w),v}(p.f),B=function(w){function v(I,P){var u=w.call(this,I,p.e.ReadFileError)||this;return u.file=P,u.name="ReadFileError",p.d._setPrototypeOf(u,v.prototype),u}return(0,P.m)(v,w),v}(p.f),t={DefaultRetryStrategy:U.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function(w){return w}},i=function(w){return w=w.replace(/#/gm,"%23")},z=function(w,v){if((!w||0!==w.indexOf("data:"))&&t.CorsBehavior)if("string"===typeof t.CorsBehavior||t.CorsBehavior instanceof String)v.crossOrigin=t.CorsBehavior;else{var I=t.CorsBehavior(w);I&&(v.crossOrigin=I)}},E=function(w,v,I,u,Q,K){var U,p;void 0===Q&&(Q="");var Y=!1;w instanceof ArrayBuffer||ArrayBuffer.isView(w)?"undefined"!==typeof Blob?(p=URL.createObjectURL(new Blob([w],{type:Q})),Y=!0):p="data:".concat(Q,";base64,")+(0,r.h)(w):w instanceof Blob?(p=URL.createObjectURL(w),Y=!0):(p=i(w),p=t.PreprocessUrl(w));var g=J.e.LastCreatedEngine,l=function(v){if(I){var P=p||w.toString();I("Error while trying to load image: ".concat(0===P.indexOf("http")||P.length<=128?P:P.slice(0,128)+"..."),v)}};if("undefined"===typeof Image||null!==(U=null===g||void 0===g?void 0:g._features.forceBitmapOverHTMLImageElement)&&void 0!==U&&U)return h(p,(function(u){g.createImageBitmap(new Blob([u],{type:Q}),(0,P.d)({premultiplyAlpha:"none"},K)).then((function(w){v(w),Y&&URL.revokeObjectURL(p)})).catch((function(v){I&&I("Error while trying to load image: "+w,v)}))}),void 0,u||void 0,!0,(function(w,v){l(v)})),null;var R=new Image;z(p,R);var x=function w(){R.removeEventListener("load",w),R.removeEventListener("error",j),v(R),Y&&R.src&&URL.revokeObjectURL(R.src)},j=function w(v){R.removeEventListener("load",x),R.removeEventListener("error",w),l(v),Y&&R.src&&URL.revokeObjectURL(R.src)};R.addEventListener("load",x),R.addEventListener("error",j);var s=function(){R.src=p};if("blob:"!==p.substr(0,5)&&"data:"!==p.substr(0,5)&&u&&u.enableTexturesOffline)u.open((function(){u&&u.loadImage(p,R)}),s);else{if(-1!==p.indexOf("file:")){var B=decodeURIComponent(p.substring(5).toLowerCase());if(a.FilesToLoad[B]){try{var E=void 0;try{E=URL.createObjectURL(a.FilesToLoad[B])}catch(w){E=URL.createObjectURL(a.FilesToLoad[B])}R.src=E,Y=!0}catch(w){R.src=""}return R}}s()}return R},o=function(w,v,I,P,u){var Q=new FileReader,a={onCompleteObservable:new K.c,abort:function(){return Q.abort()}};return Q.onloadend=function(){return a.onCompleteObservable.notifyObservers(a)},u&&(Q.onerror=function(){u(new B("Unable to read ".concat(w.name),w))}),Q.onload=function(w){v(w.target.result)},I&&(Q.onprogress=I),P?Q.readAsArrayBuffer(w):Q.readAsText(w),a},h=function(w,v,I,P,u,Q,U){if(w.name)return o(w,v,I,u,Q?function(w){Q(void 0,w)}:void 0);var p=w;if(-1!==p.indexOf("file:")){var r=decodeURIComponent(p.substring(5).toLowerCase());0===r.indexOf("./")&&(r=r.substring(2));var Y=a.FilesToLoad[r];if(Y)return o(Y,v,I,u,Q?function(w){return Q(void 0,new j(w.message,w.file))}:void 0)}if(V(p)){var g={onCompleteObservable:new K.c,abort:function(){return function(){}}};try{v(u?F(p):N(p))}catch(w){Q?Q(void 0,w):l.e.Error(w.message||"Failed to parse the Data URL")}return R.e.SetImmediate((function(){g.onCompleteObservable.notifyObservers(g)})),g}return n(p,(function(w,I){v(w,I?I.responseURL:void 0)}),I,P,u,Q?function(w){Q(w.request,new j(w.message,w.request))}:void 0,U)},n=function(w,v,I,P,a,U,p){w=i(w),w=t.PreprocessUrl(w);var r=t.BaseUrl+w,Y=!1,g={onCompleteObservable:new K.c,abort:function(){return Y=!0}},J=function(){var w,P=new u.b,K=null,J=function(){P&&(I&&P.removeEventListener("progress",I),w&&P.removeEventListener("readystatechange",w),P.removeEventListener("loadend",R))},R=function(){J(),g.onCompleteObservable.notifyObservers(g),g.onCompleteObservable.clear(),I=void 0,w=null,R=null,U=void 0,p=void 0,v=void 0};g.abort=function(){Y=!0,R&&R(),P&&P.readyState!==(XMLHttpRequest.DONE||4)&&P.abort(),null!==K&&(clearTimeout(K),K=null),P=null};var x=function(w){var v=w.message||"Unknown error";U&&P?U(new s(v,P)):l.e.Error(v)};!function g(l){if(P){if(P.open("GET",r),p)try{p(P)}catch(w){return void x(w)}a&&(P.responseType="arraybuffer"),I&&P.addEventListener("progress",I),R&&P.addEventListener("loadend",R),w=function(){if(!Y&&P&&P.readyState===(XMLHttpRequest.DONE||4)){if(w&&P.removeEventListener("readystatechange",w),P.status>=200&&P.status<300||0===P.status&&(!(0,Q.r)()||W())){try{v&&v(a?P.response:P.responseText,P)}catch(w){x(w)}return}var I=t.DefaultRetryStrategy;if(I){var p=I(r,P,l);if(-1!==p)return J(),P=new u.b,void(K=setTimeout((function(){return g(l+1)}),p))}var R=new s("Error status: "+P.status+" "+P.statusText+" - Unable to load "+r,P);U&&U(R)}},P.addEventListener("readystatechange",w),P.send()}}(0)};if(P&&P.enableSceneOffline){var R=function(w){w&&w.status>400?U&&U(w):J()};P.open((function(){P&&P.loadFile(t.BaseUrl+w,(function(w){!Y&&v&&v(w),g.onCompleteObservable.notifyObservers(g)}),I?function(w){!Y&&I&&I(w)}:void 0,R,a)}),R)}else J();return g},W=function(){return"undefined"!==typeof location&&"file:"===location.protocol},V=function(w){return x.test(w)};function F(w){return(0,r.d)(w.split(",")[1])}var O,N=function(w){return(0,r.e)(w.split(",")[1])};g.d._FileToolsLoadImage=E,g.d._FileToolsLoadFile=h,Y.c._FileToolsLoadFile=h;!function(w,v,I,P,u,Q,K,a,U,p){O={DecodeBase64UrlToBinary:w,DecodeBase64UrlToString:v,DefaultRetryStrategy:I.DefaultRetryStrategy,BaseUrl:I.BaseUrl,CorsBehavior:I.CorsBehavior,PreprocessUrl:I.PreprocessUrl,IsBase64DataUrl:P,IsFileURL:u,LoadFile:Q,LoadImage:K,ReadFile:a,RequestFile:U,SetCorsBehavior:p},Object.defineProperty(O,"DefaultRetryStrategy",{get:function(){return I.DefaultRetryStrategy},set:function(w){I.DefaultRetryStrategy=w}}),Object.defineProperty(O,"BaseUrl",{get:function(){return I.BaseUrl},set:function(w){I.BaseUrl=w}}),Object.defineProperty(O,"PreprocessUrl",{get:function(){return I.PreprocessUrl},set:function(w){I.PreprocessUrl=w}}),Object.defineProperty(O,"CorsBehavior",{get:function(){return I.CorsBehavior},set:function(w){I.CorsBehavior=w}})}(F,N,t,V,W,h,E,o,n,z)},28372:function(w,v,I){"use strict";function P(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(w){var v=16*Math.random()|0;return("x"===w?v:3&v|8).toString(16)}))}I.d(v,{e:function(){return P}})},90526:function(w,v,I){"use strict";I.d(v,{e:function(){return Q}});var P=I(9127),u=I(31709),Q=function(){function w(){}return w.Instantiate=function(w){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[w])return this.RegisteredExternalClasses[w];var v=(0,u.c)(w);if(v)return v;P.e.Warn(w+" not found, you may have missed an import.");for(var I=w.split("."),Q=window||this,K=0,a=I.length;K<a;K++)Q=Q[I[K]];return"function"!==typeof Q?null:Q},w.RegisteredExternalClasses={},w}()},9127:function(w,v,I){"use strict";I.d(v,{e:function(){return P}});var P=function(){function w(){}return w._CheckLimit=function(v,I){var P=w._LogLimitOutputs[v];return P?P.current++:(P={limit:I,current:1},w._LogLimitOutputs[v]=P),P.current<=P.limit},w._GenerateLimitMessage=function(v,I){var P=w._LogLimitOutputs[v];if(P&&w.MessageLimitReached&&P.current===P.limit)switch(I){case 0:w.Log(w.MessageLimitReached.replace(/%LIMIT%/g,""+P.limit).replace(/%TYPE%/g,"log"));break;case 1:w.Warn(w.MessageLimitReached.replace(/%LIMIT%/g,""+P.limit).replace(/%TYPE%/g,"warning"));break;case 2:w.Error(w.MessageLimitReached.replace(/%LIMIT%/g,""+P.limit).replace(/%TYPE%/g,"error"))}},w._AddLogEntry=function(v){w._LogCache=v+w._LogCache,w.OnNewCacheEntry&&w.OnNewCacheEntry(v)},w._FormatMessage=function(w){var v=function(w){return w<10?"0"+w:""+w},I=new Date;return"["+v(I.getHours())+":"+v(I.getMinutes())+":"+v(I.getSeconds())+"]: "+w},w._LogDisabled=function(w,v){},w._LogEnabled=function(v,I){if(void 0===I||w._CheckLimit(v,I)){var P=w._FormatMessage(v);console.log("BJS - "+P);var u="<div style='color:white'>"+P+"</div><br>";w._AddLogEntry(u),w._GenerateLimitMessage(v,0)}},w._WarnDisabled=function(w,v){},w._WarnEnabled=function(v,I){if(void 0===I||w._CheckLimit(v,I)){var P=w._FormatMessage(v);console.warn("BJS - "+P);var u="<div style='color:orange'>"+v+"</div><br>";w._AddLogEntry(u),w._GenerateLimitMessage(v,1)}},w._ErrorDisabled=function(w,v){},w._ErrorEnabled=function(v,I){if(void 0===I||w._CheckLimit(v,I)){var P=w._FormatMessage(v);w.errorsCount++,console.error("BJS - "+P);var u="<div style='color:red'>"+P+"</div><br>";w._AddLogEntry(u),w._GenerateLimitMessage(v,2)}},Object.defineProperty(w,"LogCache",{get:function(){return w._LogCache},enumerable:!1,configurable:!0}),w.ClearLogCache=function(){w._LogCache="",w._LogLimitOutputs={},w.errorsCount=0},Object.defineProperty(w,"LogLevels",{set:function(v){(v&w.MessageLogLevel)===w.MessageLogLevel?w.Log=w._LogEnabled:w.Log=w._LogDisabled,(v&w.WarningLogLevel)===w.WarningLogLevel?w.Warn=w._WarnEnabled:w.Warn=w._WarnDisabled,(v&w.ErrorLogLevel)===w.ErrorLogLevel?w.Error=w._ErrorEnabled:w.Error=w._ErrorDisabled},enumerable:!1,configurable:!0}),w.NoneLogLevel=0,w.MessageLogLevel=1,w.WarningLogLevel=2,w.ErrorLogLevel=4,w.AllLogLevel=7,w.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",w._LogCache="",w._LogLimitOutputs={},w.errorsCount=0,w.Log=w._LogEnabled,w.Warn=w._WarnEnabled,w.Error=w._ErrorEnabled,w}()},9271:function(w,v,I){"use strict";I.d(v,{c:function(){return Q}});var P=function(){function w(w,v,I,P){void 0===v&&(v=!1),this.initialize(w,v,I,P)}return w.prototype.initialize=function(w,v,I,P){return void 0===v&&(v=!1),this.mask=w,this.skipNextObservers=v,this.target=I,this.currentTarget=P,this},w}(),u=function(w,v,I){void 0===I&&(I=null),this.callback=w,this.mask=v,this.scope=I,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},Q=(function(){function w(){}w.prototype.dispose=function(){if(this._observers&&this._observables)for(var w=0;w<this._observers.length;w++)this._observables[w].remove(this._observers[w]);this._observers=null,this._observables=null},w.Watch=function(v,I,P,u){void 0===P&&(P=-1),void 0===u&&(u=null);var Q=new w;Q._observers=new Array,Q._observables=v;for(var K=0,a=v;K<a.length;K++){var U=a[K].add(I,P,!1,u);U&&Q._observers.push(U)}return Q}}(),function(){function w(w){this._observers=new Array,this._eventState=new P(0),w&&(this._onObserverAdded=w)}return w.FromPromise=function(v,I){var P=new w;return v.then((function(w){P.notifyObservers(w)})).catch((function(w){if(!I)throw w;I.notifyObservers(w)})),P},Object.defineProperty(w.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),w.prototype.add=function(w,v,I,P,Q){if(void 0===v&&(v=-1),void 0===I&&(I=!1),void 0===P&&(P=null),void 0===Q&&(Q=!1),!w)return null;var K=new u(w,v,P);return K.unregisterOnNextCall=Q,I?this._observers.unshift(K):this._observers.push(K),this._onObserverAdded&&this._onObserverAdded(K),K},w.prototype.addOnce=function(w){return this.add(w,void 0,void 0,void 0,!0)},w.prototype.remove=function(w){return!!w&&(-1!==this._observers.indexOf(w)&&(this._deferUnregister(w),!0))},w.prototype.removeCallback=function(w,v){for(var I=0;I<this._observers.length;I++){var P=this._observers[I];if(!P._willBeUnregistered&&(P.callback===w&&(!v||v===P.scope)))return this._deferUnregister(P),!0}return!1},w.prototype._deferUnregister=function(w){var v=this;w.unregisterOnNextCall=!1,w._willBeUnregistered=!0,setTimeout((function(){v._remove(w)}),0)},w.prototype._remove=function(w){if(!w)return!1;var v=this._observers.indexOf(w);return-1!==v&&(this._observers.splice(v,1),!0)},w.prototype.makeObserverTopPriority=function(w){this._remove(w),this._observers.unshift(w)},w.prototype.makeObserverBottomPriority=function(w){this._remove(w),this._observers.push(w)},w.prototype.notifyObservers=function(w,v,I,P,u){if(void 0===v&&(v=-1),!this._observers.length)return!0;var Q=this._eventState;Q.mask=v,Q.target=I,Q.currentTarget=P,Q.skipNextObservers=!1,Q.lastReturnValue=w,Q.userInfo=u;for(var K=0,a=this._observers;K<a.length;K++){var U=a[K];if(!U._willBeUnregistered&&(U.mask&v&&(U.scope?Q.lastReturnValue=U.callback.apply(U.scope,[w,Q]):Q.lastReturnValue=U.callback(w,Q),U.unregisterOnNextCall&&this._deferUnregister(U)),Q.skipNextObservers))return!1}return!0},w.prototype.notifyObserversWithPromise=function(w,v,I,P,u){var Q=this;void 0===v&&(v=-1);var K=Promise.resolve(w);if(!this._observers.length)return K;var a=this._eventState;return a.mask=v,a.target=I,a.currentTarget=P,a.skipNextObservers=!1,a.userInfo=u,this._observers.forEach((function(I){a.skipNextObservers||I._willBeUnregistered||I.mask&v&&(K=I.scope?K.then((function(v){return a.lastReturnValue=v,I.callback.apply(I.scope,[w,a])})):K.then((function(v){return a.lastReturnValue=v,I.callback(w,a)})),I.unregisterOnNextCall&&Q._deferUnregister(I))})),K.then((function(){return w}))},w.prototype.notifyObserver=function(w,v,I){if(void 0===I&&(I=-1),!w._willBeUnregistered){var P=this._eventState;P.mask=I,P.skipNextObservers=!1,w.callback(v,P),w.unregisterOnNextCall&&this._deferUnregister(w)}},w.prototype.hasObservers=function(){return this._observers.length>0},w.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},w.prototype.clone=function(){var v=new w;return v._observers=this._observers.slice(0),v},w.prototype.hasSpecificMask=function(w){void 0===w&&(w=-1);for(var v=0,I=this._observers;v<I.length;v++){var P=I[v];if(P.mask&w||P.mask===w)return!0}return!1},w}())},16945:function(w,v,I){"use strict";I.d(v,{e:function(){return u}});var P=I(19500),u=function(){function w(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(w.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),w.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},w.prototype.addCount=function(v,I){w.Enabled&&(this._current+=v,I&&this._fetchResult())},w.prototype.beginMonitoring=function(){w.Enabled&&(this._startMonitoringTime=P.b.Now)},w.prototype.endMonitoring=function(v){if(void 0===v&&(v=!0),w.Enabled){v&&this.fetchNewFrame();var I=P.b.Now;this._current=I-this._startMonitoringTime,v&&this._fetchResult()}},w.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var w=P.b.Now;w-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=w,this._lastSecAccumulated=0,this._lastSecValueCount=0)},w.Enabled=!0,w}()},19500:function(w,v,I){"use strict";I.d(v,{b:function(){return u}});var P=I(60985),u=function(){function w(){}return Object.defineProperty(w,"Now",{get:function(){return P.e.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),w}()},81965:function(w,v,I){"use strict";I.d(v,{e:function(){return J}});var P=I(56965),u=(I(69233),I(84468),I(70937),I(52128),I(78502)),Q=I(90690),K=I(16179),a="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}";K.c.ShadersStore.passPixelShader=a;var U="varying vec2 vUV;\nuniform samplerCube textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";K.c.ShadersStore.passCubePixelShader=U;var p=I(31709),r=I(9892),Y=function(w){function v(v,I,P,u,Q,K,a,U){return void 0===P&&(P=null),void 0===a&&(a=0),void 0===U&&(U=!1),w.call(this,v,"pass",null,null,I,P,u,Q,K,void 0,a,void 0,null,U)||this}return(0,u.m)(v,w),v.prototype.getClassName=function(){return"PassPostProcess"},v._Parse=function(w,I,P,u){return r.e.Parse((function(){return new v(w.name,w.options,I,w.renderTargetSamplingMode,w._engine,w.reusable)}),w,P,u)},v}(P.b);(0,p.g)("BABYLON.PassPostProcess",Y);!function(w){function v(v,I,P,u,Q,K,a,U){void 0===P&&(P=null),void 0===a&&(a=0),void 0===U&&(U=!1);var p=w.call(this,v,"passCube",null,null,I,P,u,Q,K,"#define POSITIVEX",a,void 0,null,U)||this;return p._face=0,p}(0,u.m)(v,w),Object.defineProperty(v.prototype,"face",{get:function(){return this._face},set:function(w){if(!(w<0||w>5))switch(this._face=w,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"PassCubePostProcess"},v._Parse=function(w,I,P,u){return r.e.Parse((function(){return new v(w.name,w.options,I,w.renderTargetSamplingMode,w._engine,w.reusable)}),w,P,u)}}(P.b);function g(w,v,I,u,Q,K){var a=v.getEngine();return v.isReady=!1,Q=null!==Q&&void 0!==Q?Q:v.samplingMode,u=null!==u&&void 0!==u?u:v.type,K=null!==K&&void 0!==K?K:v.format,-1===u&&(u=0),new Promise((function(U){var p=new P.b("postprocess",w,null,null,1,null,Q,a,!1,void 0,u,void 0,null,!1,K);p.externalTextureSamplerBinding=!0;var r=a.createRenderTargetTexture({width:v.width,height:v.height},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:Q,type:u,format:K});p.getEffect().executeWhenCompiled((function(){p.onApply=function(w){w._bindTexture("textureSampler",v),w.setFloat2("scale",1,1)},I.postProcessManager.directRender([p],r,!0),a.restoreDefaultFramebuffer(),a._releaseTexture(v),p&&p.dispose(),r._swapAndDie(v),v.type=u,v.format=5,v.isReady=!0,U(v)}))}))}Q.d._RescalePostProcessFactory=function(w){return new Y("rescale",1,null,2,w,!1,0)};var J=function(){function w(){}return w.ExpandRGBDTexture=function(w){var v=w._texture;if(v&&w.isRGBD){var I=v.getEngine(),u=I.getCaps(),Q=v.isReady,K=!1;u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering?(K=!0,v.type=2):u.textureFloatRender&&u.textureFloatLinearFiltering&&(K=!0,v.type=1),K&&(v.isReady=!1,v._isRGBD=!1,v.invertY=!1);var a=function(){if(K){var u=new P.b("rgbdDecode","rgbdDecode",null,null,1,null,3,I,!1,void 0,v.type,void 0,null,!1);u.externalTextureSamplerBinding=!0;var Q=I.createRenderTargetTexture(v.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:v.samplingMode,type:v.type,format:5});u.getEffect().executeWhenCompiled((function(){u.onApply=function(w){w._bindTexture("textureSampler",v),w.setFloat2("scale",1,1)},w.getScene().postProcessManager.directRender([u],Q,!0),I.restoreDefaultFramebuffer(),I._releaseTexture(v),u&&u.dispose(),Q._swapAndDie(v),v.isReady=!0}))}};Q?a():w.onLoadObservable.addOnce(a)}},w.EncodeTextureToRGBD=function(w,v,I){return void 0===I&&(I=0),g("rgbdEncode",w,v,I,1,5)},w}()},21901:function(w,v,I){"use strict";I.d(v,{c:function(){return Q},g:function(){return u}});var P=I(78502),u=function(){function w(v){this.length=0,this.data=new Array(v),this._id=w._GlobalId++}return w.prototype.push=function(w){this.data[this.length++]=w,this.length>this.data.length&&(this.data.length*=2)},w.prototype.forEach=function(w){for(var v=0;v<this.length;v++)w(this.data[v])},w.prototype.sort=function(w){this.data.sort(w)},w.prototype.reset=function(){this.length=0},w.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},w.prototype.concat=function(w){if(0!==w.length){this.length+w.length>this.data.length&&(this.data.length=2*(this.length+w.length));for(var v=0;v<w.length;v++)this.data[this.length++]=(w.data||w)[v]}},w.prototype.indexOf=function(w){var v=this.data.indexOf(w);return v>=this.length?-1:v},w.prototype.contains=function(w){return-1!==this.indexOf(w)},w._GlobalId=0,w}(),Q=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v._duplicateId=0,v}return(0,P.m)(v,w),v.prototype.push=function(v){w.prototype.push.call(this,v),v.__smartArrayFlags||(v.__smartArrayFlags={}),v.__smartArrayFlags[this._id]=this._duplicateId},v.prototype.pushNoDuplicate=function(w){return(!w.__smartArrayFlags||w.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(w),!0)},v.prototype.reset=function(){w.prototype.reset.call(this),this._duplicateId++},v.prototype.concatWithNoDuplicate=function(w){if(0!==w.length){this.length+w.length>this.data.length&&(this.data.length=2*(this.length+w.length));for(var v=0;v<w.length;v++){var I=(w.data||w)[v];this.pushNoDuplicate(I)}}},v}(u)},50459:function(w,v,I){"use strict";I.d(v,{d:function(){return K},e:function(){return Q},f:function(){return P},h:function(){return u}});var P=function(w){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(w);for(var v="",I=0;I<w.byteLength;I++)v+=String.fromCharCode(w[I]);return v},u=function(w){for(var v,I,P,u,Q,K,a,U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p="",r=0,Y=ArrayBuffer.isView(w)?new Uint8Array(w.buffer,w.byteOffset,w.byteLength):new Uint8Array(w);r<Y.length;)u=(v=Y[r++])>>2,Q=(3&v)<<4|(I=r<Y.length?Y[r++]:Number.NaN)>>4,K=(15&I)<<2|(P=r<Y.length?Y[r++]:Number.NaN)>>6,a=63&P,isNaN(I)?K=a=64:isNaN(P)&&(a=64),p+=U.charAt(u)+U.charAt(Q)+U.charAt(K)+U.charAt(a);return p},Q=function(w){return atob(w)},K=function(w){for(var v=Q(w),I=v.length,P=new Uint8Array(new ArrayBuffer(I)),u=0;u<I;u++)P[u]=v.charCodeAt(u);return P.buffer}},45883:function(w,v,I){"use strict";I.d(v,{c:function(){return u}});var P=function(){function w(){}return w.Eval=function(v,I){return"true"===(v=v.match(/\([^()]*\)/g)?v.replace(/\([^()]*\)/g,(function(v){return v=v.slice(1,v.length-1),w._HandleParenthesisContent(v,I)})):w._HandleParenthesisContent(v,I))||"false"!==v&&w.Eval(v,I)},w._HandleParenthesisContent=function(v,I){var P;I=I||function(w){return"true"===w};var u=v.split("||");for(var Q in u)if(Object.prototype.hasOwnProperty.call(u,Q)){var K=w._SimplifyNegation(u[Q].trim()),a=K.split("&&");if(a.length>1)for(var U=0;U<a.length;++U){var p=w._SimplifyNegation(a[U].trim());if(!(P="true"!==p&&"false"!==p?"!"===p[0]?!I(p.substring(1)):I(p):"true"===p)){K="false";break}}if(P||"true"===K){P=!0;break}P="true"!==K&&"false"!==K?"!"===K[0]?!I(K.substring(1)):I(K):"true"===K}return P?"true":"false"},w._SimplifyNegation=function(w){return"!true"===(w=(w=w.replace(/^[\s!]+/,(function(w){return(w=w.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?w="false":"!false"===w&&(w="true"),w},w}(),u=function(){function w(){}return w.EnableFor=function(v){v._tags=v._tags||{},v.hasTags=function(){return w.HasTags(v)},v.addTags=function(I){return w.AddTagsTo(v,I)},v.removeTags=function(I){return w.RemoveTagsFrom(v,I)},v.matchesTagsQuery=function(I){return w.MatchesQuery(v,I)}},w.DisableFor=function(w){delete w._tags,delete w.hasTags,delete w.addTags,delete w.removeTags,delete w.matchesTagsQuery},w.HasTags=function(w){if(!w._tags)return!1;var v=w._tags;for(var I in v)if(Object.prototype.hasOwnProperty.call(v,I))return!0;return!1},w.GetTags=function(w,v){if(void 0===v&&(v=!0),!w._tags)return null;if(v){var I=[];for(var P in w._tags)Object.prototype.hasOwnProperty.call(w._tags,P)&&!0===w._tags[P]&&I.push(P);return I.join(" ")}return w._tags},w.AddTagsTo=function(v,I){I&&("string"===typeof I&&I.split(" ").forEach((function(I){w._AddTagTo(v,I)})))},w._AddTagTo=function(v,I){""!==(I=I.trim())&&"true"!==I&&"false"!==I&&(I.match(/[\s]/)||I.match(/^([!]|([|]|[&]){2})/)||(w.EnableFor(v),v._tags[I]=!0))},w.RemoveTagsFrom=function(v,I){if(w.HasTags(v)){var P=I.split(" ");for(var u in P)w._RemoveTagFrom(v,P[u])}},w._RemoveTagFrom=function(w,v){delete w._tags[v]},w.MatchesQuery=function(v,I){return void 0===I||(""===I?w.HasTags(v):P.Eval(I,(function(I){return w.HasTags(v)&&v._tags[I]})))},w}()},1116:function(w,v,I){"use strict";I.d(v,{e:function(){return u}});var P=I(60985),u=function(){function w(){}return w.SetImmediate=function(w){(0,P.r)()&&window.setImmediate?window.setImmediate(w):setTimeout(w,1)},w}()},9217:function(w,v,I){"use strict";I.d(v,{e:function(){return j},i:function(){return x}});var P=I(78502),u=I(9271),Q=I(60985),K=I(9127),a=I(51004),U=I(19500),p=I(50504),r=I(67935),Y=I(78588),g=I(82790),J=I(1116),l=I(90526),R=I(28372),x=function(){function w(){}return Object.defineProperty(w,"BaseUrl",{get:function(){return g.e.BaseUrl},set:function(w){g.e.BaseUrl=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"DefaultRetryStrategy",{get:function(){return g.e.DefaultRetryStrategy},set:function(w){g.e.DefaultRetryStrategy=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"CorsBehavior",{get:function(){return g.e.CorsBehavior},set:function(w){g.e.CorsBehavior=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"UseFallbackTexture",{get:function(){return Y.e.UseFallbackTexture},set:function(w){Y.e.UseFallbackTexture=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"RegisteredExternalClasses",{get:function(){return l.e.RegisteredExternalClasses},set:function(w){l.e.RegisteredExternalClasses=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"fallbackTexture",{get:function(){return Y.e.FallbackTexture},set:function(w){Y.e.FallbackTexture=w},enumerable:!1,configurable:!0}),w.FetchToRef=function(w,v,I,P,u,Q){var K=4*((Math.abs(w)*I%I|0)+(Math.abs(v)*P%P|0)*I);Q.r=u[K]/255,Q.g=u[K+1]/255,Q.b=u[K+2]/255,Q.a=u[K+3]/255},w.Mix=function(w,v,I){return w*(1-I)+v*I},w.Instantiate=function(w){return l.e.Instantiate(w)},w.SetImmediate=function(w){J.e.SetImmediate(w)},w.IsExponentOfTwo=function(w){var v=1;do{v*=2}while(v<w);return v===w},w.FloatRound=function(v){return Math.fround?Math.fround(v):(w._TmpFloatArray[0]=v,w._TmpFloatArray[0])},w.GetFilename=function(w){var v=w.lastIndexOf("/");return v<0?w:w.substring(v+1)},w.GetFolderPath=function(w,v){void 0===v&&(v=!1);var I=w.lastIndexOf("/");return I<0?v?w:"":w.substring(0,I+1)},w.ToDegrees=function(w){return 180*w/Math.PI},w.ToRadians=function(w){return w*Math.PI/180},w.MakeArray=function(w,v){return!0===v||void 0!==w&&null!=w?Array.isArray(w)?w:[w]:null},w.GetPointerPrefix=function(w){var v="pointer";return(0,Q.r)()&&!window.PointerEvent&&(v="mouse"),!w._badDesktopOS||w._badOS||document&&"ontouchend"in document||(v="mouse"),v},w.SetCorsBehavior=function(w,v){(0,g.x)(w,v)},w.SetReferrerPolicyBehavior=function(w,v){v.referrerPolicy=w},w.CleanUrl=function(w){return w=w.replace(/#/gm,"%23")},Object.defineProperty(w,"PreprocessUrl",{get:function(){return g.e.PreprocessUrl},set:function(w){g.e.PreprocessUrl=w},enumerable:!1,configurable:!0}),w.LoadImage=function(w,v,I,P,u,Q){return(0,g.m)(w,v,I,P,u,Q)},w.LoadFile=function(w,v,I,P,u,Q){return(0,g.k)(w,v,I,P,u,Q)},w.LoadFileAsync=function(w,v){return void 0===v&&(v=!0),new Promise((function(I,P){(0,g.k)(w,(function(w){I(w)}),void 0,void 0,v,(function(w,v){P(v)}))}))},w.LoadScript=function(w,v,I,P){if((0,Q.r)()){var u=document.getElementsByTagName("head")[0],K=document.createElement("script");K.setAttribute("type","text/javascript"),K.setAttribute("src",w),P&&(K.id=P),K.onload=function(){v&&v()},K.onerror=function(v){I&&I("Unable to load script '".concat(w,"'"),v)},u.appendChild(K)}},w.LoadScriptAsync=function(w){var v=this;return new Promise((function(I,P){v.LoadScript(w,(function(){I()}),(function(w,v){P(v)}))}))},w.ReadFileAsDataURL=function(w,v,I){var P=new FileReader,Q={onCompleteObservable:new u.c,abort:function(){return P.abort()}};return P.onloadend=function(){Q.onCompleteObservable.notifyObservers(Q)},P.onload=function(w){v(w.target.result)},P.onprogress=I,P.readAsDataURL(w),Q},w.ReadFile=function(w,v,I,P,u){return(0,g.p)(w,v,I,P,u)},w.FileAsURL=function(w){var v=new Blob([w]);return(window.URL||window.webkitURL).createObjectURL(v)},w.Format=function(w,v){return void 0===v&&(v=2),w.toFixed(v)},w.DeepCopy=function(w,v,I,P){a.e.DeepCopy(w,v,I,P)},w.IsEmpty=function(w){for(var v in w)if(Object.prototype.hasOwnProperty.call(w,v))return!1;return!0},w.RegisterTopRootEvents=function(w,v){for(var I=0;I<v.length;I++){var P=v[I];w.addEventListener(P.name,P.handler,!1);try{window.parent&&window.parent.addEventListener(P.name,P.handler,!1)}catch(w){}}},w.UnregisterTopRootEvents=function(w,v){for(var I=0;I<v.length;I++){var P=v[I];w.removeEventListener(P.name,P.handler);try{w.parent&&w.parent.removeEventListener(P.name,P.handler)}catch(w){}}},w.DumpFramebuffer=function(v,I,u,Q,K,a){return void 0===K&&(K="image/png"),(0,P.h)(this,void 0,void 0,(function(){var U,p;return(0,P.p)(this,(function(P){switch(P.label){case 0:return[4,u.readPixels(0,0,v,I)];case 1:return U=P.sent(),p=new Uint8Array(U.buffer),w.DumpData(v,I,p,Q,K,a,!0),[2]}}))}))},w.DumpData=function(v,I,P,u,Q,K,a,U,p){void 0===Q&&(Q="image/png"),void 0===a&&(a=!1),void 0===U&&(U=!1),w._ScreenshotCanvas||(w._ScreenshotCanvas=document.createElement("canvas")),w._ScreenshotCanvas.width=v,w._ScreenshotCanvas.height=I;var r=w._ScreenshotCanvas.getContext("2d");if(r){if(P instanceof Float32Array){for(var Y=new Uint8Array(P.length),g=P.length;g--;){var J=P[g];Y[g]=J<0?0:J>1?1:Math.round(255*J)}P=Y}var l=r.createImageData(v,I);l.data.set(P),r.putImageData(l,0,0);var R=w._ScreenshotCanvas;if(a){var x=document.createElement("canvas");x.width=v,x.height=I;var j=x.getContext("2d");if(!j)return;j.translate(0,I),j.scale(1,-1),j.drawImage(w._ScreenshotCanvas,0,0),R=x}U?w.ToBlob(R,(function(w){var v=new FileReader;v.onload=function(w){var v=w.target.result;u&&u(v)},v.readAsArrayBuffer(w)}),Q,p):w.EncodeScreenshotCanvasData(u,Q,K,R,p)}},w.DumpDataAsync=function(v,I,P,u,Q,K,a,U){return void 0===u&&(u="image/png"),void 0===K&&(K=!1),void 0===a&&(a=!1),new Promise((function(p){w.DumpData(v,I,P,(function(w){return p(w)}),u,Q,K,a,U)}))},w.ToBlob=function(w,v,I,P){void 0===I&&(I="image/png"),w.toBlob||(w.toBlob=function(w,v,I){var P=this;setTimeout((function(){for(var u=atob(P.toDataURL(v,I).split(",")[1]),Q=u.length,K=new Uint8Array(Q),a=0;a<Q;a++)K[a]=u.charCodeAt(a);w(new Blob([K]))}))}),w.toBlob((function(w){v(w)}),I,P)},w.DownloadBlob=function(v,I){if("download"in document.createElement("a")){if(!I){var P=new Date;I="screenshot_"+((P.getFullYear()+"-"+(P.getMonth()+1)).slice(2)+"-"+P.getDate()+"_"+P.getHours()+"-"+("0"+P.getMinutes()).slice(-2))+".png"}w.Download(v,I)}else if(v){var u=URL.createObjectURL(v),Q=window.open("");if(!Q)return;var K=Q.document.createElement("img");K.onload=function(){URL.revokeObjectURL(u)},K.src=u,Q.document.body.appendChild(K)}},w.EncodeScreenshotCanvasData=function(v,I,P,u,Q){(void 0===I&&(I="image/png"),v)?v((null!==u&&void 0!==u?u:w._ScreenshotCanvas).toDataURL(I,Q)):this.ToBlob(null!==u&&void 0!==u?u:w._ScreenshotCanvas,(function(v){v&&w.DownloadBlob(v,P)}),I,Q)},w.Download=function(w,v){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(w,v);else{var I=window.URL.createObjectURL(w),P=document.createElement("a");document.body.appendChild(P),P.style.display="none",P.href=I,P.download=v,P.addEventListener("click",(function(){P.parentElement&&P.parentElement.removeChild(P)})),P.click(),window.URL.revokeObjectURL(I)}},w.BackCompatCameraNoPreventDefault=function(w){return"boolean"===typeof w[0]?w[0]:"boolean"===typeof w[1]&&w[1]},w.CreateScreenshot=function(w,v,I,P,u){throw void 0===u&&(u="image/png"),(0,p.e)("ScreenshotTools")},w.CreateScreenshotAsync=function(w,v,I,P){throw void 0===P&&(P="image/png"),(0,p.e)("ScreenshotTools")},w.CreateScreenshotUsingRenderTarget=function(w,v,I,P,u,Q,K,a){throw void 0===u&&(u="image/png"),void 0===Q&&(Q=1),void 0===K&&(K=!1),(0,p.e)("ScreenshotTools")},w.CreateScreenshotUsingRenderTargetAsync=function(w,v,I,P,u,Q,K){throw void 0===P&&(P="image/png"),void 0===u&&(u=1),void 0===Q&&(Q=!1),(0,p.e)("ScreenshotTools")},w.RandomId=function(){return(0,R.e)()},w.IsBase64=function(w){return(0,g.h)(w)},w.DecodeBase64=function(w){return(0,g.c)(w)},Object.defineProperty(w,"errorsCount",{get:function(){return K.e.errorsCount},enumerable:!1,configurable:!0}),w.Log=function(w){K.e.Log(w)},w.Warn=function(w){K.e.Warn(w)},w.Error=function(w){K.e.Error(w)},Object.defineProperty(w,"LogCache",{get:function(){return K.e.LogCache},enumerable:!1,configurable:!0}),w.ClearLogCache=function(){K.e.ClearLogCache()},Object.defineProperty(w,"LogLevels",{set:function(w){K.e.LogLevels=w},enumerable:!1,configurable:!0}),Object.defineProperty(w,"PerformanceLogLevel",{set:function(v){return(v&w.PerformanceUserMarkLogLevel)===w.PerformanceUserMarkLogLevel?(w.StartPerformanceCounter=w._StartUserMark,void(w.EndPerformanceCounter=w._EndUserMark)):(v&w.PerformanceConsoleLogLevel)===w.PerformanceConsoleLogLevel?(w.StartPerformanceCounter=w._StartPerformanceConsole,void(w.EndPerformanceCounter=w._EndPerformanceConsole)):(w.StartPerformanceCounter=w._StartPerformanceCounterDisabled,void(w.EndPerformanceCounter=w._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),w._StartPerformanceCounterDisabled=function(w,v){},w._EndPerformanceCounterDisabled=function(w,v){},w._StartUserMark=function(v,I){if(void 0===I&&(I=!0),!w._Performance){if(!(0,Q.r)())return;w._Performance=window.performance}I&&w._Performance.mark&&w._Performance.mark(v+"-Begin")},w._EndUserMark=function(v,I){void 0===I&&(I=!0),I&&w._Performance.mark&&(w._Performance.mark(v+"-End"),w._Performance.measure(v,v+"-Begin",v+"-End"))},w._StartPerformanceConsole=function(v,I){void 0===I&&(I=!0),I&&(w._StartUserMark(v,I),console.time&&console.time(v))},w._EndPerformanceConsole=function(v,I){void 0===I&&(I=!0),I&&(w._EndUserMark(v,I),console.timeEnd(v))},Object.defineProperty(w,"Now",{get:function(){return U.b.Now},enumerable:!1,configurable:!0}),w.GetClassName=function(w,v){void 0===v&&(v=!1);var I=null;if(!v&&w.getClassName)I=w.getClassName();else{if(w instanceof Object)I=(v?w:Object.getPrototypeOf(w)).constructor.__bjsclassName__;I||(I=typeof w)}return I},w.First=function(w,v){for(var I=0,P=w;I<P.length;I++){var u=P[I];if(v(u))return u}return null},w.getFullClassName=function(w,v){void 0===v&&(v=!1);var I=null,P=null;if(!v&&w.getClassName)I=w.getClassName();else{if(w instanceof Object){var u=v?w:Object.getPrototypeOf(w);I=u.constructor.__bjsclassName__,P=u.constructor.__bjsmoduleName__}I||(I=typeof w)}return I?(null!=P?P+".":"")+I:null},w.DelayAsync=function(w){return new Promise((function(v){setTimeout((function(){v()}),w)}))},w.IsSafari=function(){return!!(0,Q.p)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},w.UseCustomRequestHeaders=!1,w.CustomRequestHeaders=r.b.CustomRequestHeaders,w._TmpFloatArray=new Float32Array(1),w.GetDOMTextContent=Q.i,w.GetAbsoluteUrl="object"===typeof document?function(w){var v=document.createElement("a");return v.href=w,v.href}:"function"===typeof URL&&"object"===typeof location?function(w){return new URL(w,location.origin).href}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},w.NoneLogLevel=K.e.NoneLogLevel,w.MessageLogLevel=K.e.MessageLogLevel,w.WarningLogLevel=K.e.WarningLogLevel,w.ErrorLogLevel=K.e.ErrorLogLevel,w.AllLogLevel=K.e.AllLogLevel,w.IsWindowObjectExist=Q.r,w.PerformanceNoneLogLevel=0,w.PerformanceUserMarkLogLevel=1,w.PerformanceConsoleLogLevel=2,w.StartPerformanceCounter=w._StartPerformanceCounterDisabled,w.EndPerformanceCounter=w._EndPerformanceCounterDisabled,w}();var j=function(){function w(w,v,I,P){void 0===P&&(P=0),this.iterations=w,this.index=P-1,this._done=!1,this._fn=v,this._successCallback=I}return w.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},w.prototype.breakLoop=function(){this._done=!0,this._successCallback()},w.Run=function(v,I,P,u){void 0===u&&(u=0);var Q=new w(v,I,P,u);return Q.executeNext(),Q},w.SyncAsyncForLoop=function(v,I,P,u,Q,K){return void 0===K&&(K=0),w.Run(Math.ceil(v/I),(function(w){Q&&Q()?w.breakLoop():setTimeout((function(){for(var u=0;u<I;++u){var K=w.index*I+u;if(K>=v)break;if(P(K),Q&&Q()){w.breakLoop();break}}w.executeNext()}),K)}),u)},w}();Y.e.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},31709:function(w,v,I){"use strict";I.d(v,{c:function(){return Q},g:function(){return u}});var P={};function u(w,v){P[w]=v}function Q(w){return P[w]}},45934:function(w,v,I){"use strict";I.d(v,{b:function(){return P}});var P=function(){function w(){}return Object.defineProperty(w,"UniqueId",{get:function(){var w=this._UniqueIdCounter;return this._UniqueIdCounter++,w},enumerable:!1,configurable:!0}),w._UniqueIdCounter=1,w}()},67935:function(w,v,I){"use strict";I.d(v,{b:function(){return P}});var P=function(){function w(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}return w.prototype._injectCustomRequestHeaders=function(){if(!this._shouldSkipRequestModifications(this._requestURL))for(var v in w.CustomRequestHeaders){var I=w.CustomRequestHeaders[v];I&&this._xhr.setRequestHeader(v,I)}},w.prototype._shouldSkipRequestModifications=function(v){return w.SkipRequestModificationForBabylonCDN&&(v.includes("preview.babylonjs.com")||v.includes("cdn.babylonjs.com"))},Object.defineProperty(w.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(w){this._xhr.onprogress=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(w){this._xhr.responseType=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"timeout",{get:function(){return this._xhr.timeout},set:function(w){this._xhr.timeout=w},enumerable:!1,configurable:!0}),w.prototype.addEventListener=function(w,v,I){this._xhr.addEventListener(w,v,I)},w.prototype.removeEventListener=function(w,v,I){this._xhr.removeEventListener(w,v,I)},w.prototype.abort=function(){this._xhr.abort()},w.prototype.send=function(v){w.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(v)},w.prototype.open=function(v,I){for(var P=0,u=w.CustomRequestModifiers;P<u.length;P++){var Q=u[P];if(this._shouldSkipRequestModifications(I))return;Q(this._xhr,I)}return I=(I=I.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=I,this._xhr.open(v,I,!0)},w.prototype.setRequestHeader=function(w,v){this._xhr.setRequestHeader(w,v)},w.prototype.getResponseHeader=function(w){return this._xhr.getResponseHeader(w)},w.CustomRequestHeaders={},w.CustomRequestModifiers=new Array,w.SkipRequestModificationForBabylonCDN=!0,w}()},44811:function(w,v,I){"use strict";I.d(v,{e:function(){return Pw}});var P=I(80105),u=I(23016),Q=I(51004),K=I(96658),a=function(){function w(){this.direction1=new P.l(0,1,0),this.direction2=new P.l(0,1,0),this.minEmitBox=new P.l(-.5,-.5,-.5),this.maxEmitBox=new P.l(.5,.5,.5)}return w.prototype.startDirectionFunction=function(w,v,I,u){var Q=K.b.RandomRange(this.direction1.x,this.direction2.x),a=K.b.RandomRange(this.direction1.y,this.direction2.y),U=K.b.RandomRange(this.direction1.z,this.direction2.z);if(u)return v.x=Q,v.y=a,void(v.z=U);P.l.TransformNormalFromFloatsToRef(Q,a,U,w,v)},w.prototype.startPositionFunction=function(w,v,I,u){var Q=K.b.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),a=K.b.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),U=K.b.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(u)return v.x=Q,v.y=a,void(v.z=U);P.l.TransformCoordinatesFromFloatsToRef(Q,a,U,w,v)},w.prototype.clone=function(){var v=new w;return Q.e.DeepCopy(this,v),v},w.prototype.applyToShader=function(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2),w.setVector3("minEmitBox",this.minEmitBox),w.setVector3("maxEmitBox",this.maxEmitBox)},w.prototype.buildUniformLayout=function(w){w.addUniform("direction1",3),w.addUniform("direction2",3),w.addUniform("minEmitBox",3),w.addUniform("maxEmitBox",3)},w.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},w.prototype.getClassName=function(){return"BoxParticleEmitter"},w.prototype.serialize=function(){var w={};return w.type=this.getClassName(),w.direction1=this.direction1.asArray(),w.direction2=this.direction2.asArray(),w.minEmitBox=this.minEmitBox.asArray(),w.maxEmitBox=this.maxEmitBox.asArray(),w},w.prototype.parse=function(w){P.l.FromArrayToRef(w.direction1,0,this.direction1),P.l.FromArrayToRef(w.direction2,0,this.direction2),P.l.FromArrayToRef(w.minEmitBox,0,this.minEmitBox),P.l.FromArrayToRef(w.maxEmitBox,0,this.maxEmitBox)},w}(),U=function(){function w(w,v,I){void 0===w&&(w=1),void 0===v&&(v=Math.PI),void 0===I&&(I=0),this.directionRandomizer=I,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=v,this.radius=w}return Object.defineProperty(w.prototype,"radius",{get:function(){return this._radius},set:function(w){this._radius=w,this._buildHeight()},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"angle",{get:function(){return this._angle},set:function(w){this._angle=w,this._buildHeight()},enumerable:!1,configurable:!0}),w.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},w.prototype.startDirectionFunction=function(w,v,I,u){u?P.i.Vector3[0].copyFrom(I._localPosition).normalize():I.position.subtractToRef(w.getTranslation(),P.i.Vector3[0]).normalize();var Q=K.b.RandomRange(0,this.directionRandomizer),a=K.b.RandomRange(0,this.directionRandomizer),U=K.b.RandomRange(0,this.directionRandomizer);v.x=P.i.Vector3[0].x+Q,v.y=P.i.Vector3[0].y+a,v.z=P.i.Vector3[0].z+U,v.normalize()},w.prototype.startPositionFunction=function(w,v,I,u){var Q,a=K.b.RandomRange(0,2*Math.PI);Q=this.emitFromSpawnPointOnly?1e-4:1-(Q=K.b.RandomRange(0,this.heightRange))*Q;var U=this._radius-K.b.RandomRange(0,this._radius*this.radiusRange),p=(U*=Q)*Math.sin(a),r=U*Math.cos(a),Y=Q*this._height;if(u)return v.x=p,v.y=Y,void(v.z=r);P.l.TransformCoordinatesFromFloatsToRef(p,Y,r,w,v)},w.prototype.clone=function(){var v=new w(this._radius,this._angle,this.directionRandomizer);return Q.e.DeepCopy(this,v),v},w.prototype.applyToShader=function(w){w.setFloat2("radius",this._radius,this.radiusRange),w.setFloat("coneAngle",this._angle),w.setFloat2("height",this._height,this.heightRange),w.setFloat("directionRandomizer",this.directionRandomizer)},w.prototype.buildUniformLayout=function(w){w.addUniform("radius",2),w.addUniform("coneAngle",1),w.addUniform("height",2),w.addUniform("directionRandomizer",1)},w.prototype.getEffectDefines=function(){var w="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(w+="\n#define CONEEMITTERSPAWNPOINT"),w},w.prototype.getClassName=function(){return"ConeParticleEmitter"},w.prototype.serialize=function(){var w={};return w.type=this.getClassName(),w.radius=this._radius,w.angle=this._angle,w.directionRandomizer=this.directionRandomizer,w.radiusRange=this.radiusRange,w.heightRange=this.heightRange,w.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,w},w.prototype.parse=function(w){this.radius=w.radius,this.angle=w.angle,this.directionRandomizer=w.directionRandomizer,this.radiusRange=void 0!==w.radiusRange?w.radiusRange:1,this.heightRange=void 0!==w.radiusRange?w.heightRange:1,this.emitFromSpawnPointOnly=void 0!==w.emitFromSpawnPointOnly&&w.emitFromSpawnPointOnly},w}(),p=I(78502),r=function(){function w(w,v,I,u){void 0===w&&(w=1),void 0===v&&(v=1),void 0===I&&(I=1),void 0===u&&(u=0),this.radius=w,this.height=v,this.radiusRange=I,this.directionRandomizer=u,this._tempVector=P.l.Zero()}return w.prototype.startDirectionFunction=function(w,v,I,u,Q){I.position.subtractToRef(w.getTranslation(),this._tempVector),this._tempVector.normalize(),P.l.TransformNormalToRef(this._tempVector,Q,this._tempVector);var a=K.b.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),U=Math.atan2(this._tempVector.x,this._tempVector.z);U+=K.b.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=a,this._tempVector.x=Math.sin(U),this._tempVector.z=Math.cos(U),this._tempVector.normalize(),u?v.copyFrom(this._tempVector):P.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,w,v)},w.prototype.startPositionFunction=function(w,v,I,u){var Q=K.b.RandomRange(-this.height/2,this.height/2),a=K.b.RandomRange(0,2*Math.PI),U=K.b.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),p=Math.sqrt(U)*this.radius,r=p*Math.cos(a),Y=p*Math.sin(a);u?v.copyFromFloats(r,Q,Y):P.l.TransformCoordinatesFromFloatsToRef(r,Q,Y,w,v)},w.prototype.clone=function(){var v=new w(this.radius,this.directionRandomizer);return Q.e.DeepCopy(this,v),v},w.prototype.applyToShader=function(w){w.setFloat("radius",this.radius),w.setFloat("height",this.height),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)},w.prototype.buildUniformLayout=function(w){w.addUniform("radius",1),w.addUniform("height",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)},w.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},w.prototype.getClassName=function(){return"CylinderParticleEmitter"},w.prototype.serialize=function(){var w={};return w.type=this.getClassName(),w.radius=this.radius,w.height=this.height,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w},w.prototype.parse=function(w){this.radius=w.radius,this.height=w.height,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer},w}(),Y=function(w){function v(v,I,u,Q,K){void 0===v&&(v=1),void 0===I&&(I=1),void 0===u&&(u=1),void 0===Q&&(Q=new P.l(0,1,0)),void 0===K&&(K=new P.l(0,1,0));var a=w.call(this,v,I,u)||this;return a.direction1=Q,a.direction2=K,a}return(0,p.m)(v,w),v.prototype.startDirectionFunction=function(w,v){var I=K.b.RandomRange(this.direction1.x,this.direction2.x),u=K.b.RandomRange(this.direction1.y,this.direction2.y),Q=K.b.RandomRange(this.direction1.z,this.direction2.z);P.l.TransformNormalFromFloatsToRef(I,u,Q,w,v)},v.prototype.clone=function(){var w=new v(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return Q.e.DeepCopy(this,w),w},v.prototype.applyToShader=function(w){w.setFloat("radius",this.radius),w.setFloat("height",this.height),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)},v.prototype.buildUniformLayout=function(w){w.addUniform("radius",1),w.addUniform("height",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)},v.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"},v.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},v.prototype.serialize=function(){var v=w.prototype.serialize.call(this);return v.direction1=this.direction1.asArray(),v.direction2=this.direction2.asArray(),v},v.prototype.parse=function(v){w.prototype.parse.call(this,v),this.direction1.copyFrom(v.direction1),this.direction2.copyFrom(v.direction2)},v}(r),g=function(){function w(w,v,I){void 0===w&&(w=1),void 0===v&&(v=1),void 0===I&&(I=0),this.radius=w,this.radiusRange=v,this.directionRandomizer=I}return w.prototype.startDirectionFunction=function(w,v,I,u){var Q=I.position.subtract(w.getTranslation()).normalize(),a=K.b.RandomRange(0,this.directionRandomizer),U=K.b.RandomRange(0,this.directionRandomizer),p=K.b.RandomRange(0,this.directionRandomizer);Q.x+=a,Q.y+=U,Q.z+=p,Q.normalize(),u?v.copyFrom(Q):P.l.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,w,v)},w.prototype.startPositionFunction=function(w,v,I,u){var Q=this.radius-K.b.RandomRange(0,this.radius*this.radiusRange),a=K.b.RandomRange(0,1),U=K.b.RandomRange(0,2*Math.PI),p=Math.acos(2*a-1),r=Q*Math.cos(U)*Math.sin(p),Y=Q*Math.cos(p),g=Q*Math.sin(U)*Math.sin(p);u?v.copyFromFloats(r,Math.abs(Y),g):P.l.TransformCoordinatesFromFloatsToRef(r,Math.abs(Y),g,w,v)},w.prototype.clone=function(){var v=new w(this.radius,this.directionRandomizer);return Q.e.DeepCopy(this,v),v},w.prototype.applyToShader=function(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)},w.prototype.buildUniformLayout=function(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)},w.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},w.prototype.getClassName=function(){return"HemisphericParticleEmitter"},w.prototype.serialize=function(){var w={};return w.type=this.getClassName(),w.radius=this.radius,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w},w.prototype.parse=function(w){this.radius=w.radius,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer},w}(),J=function(){function w(){this.direction1=new P.l(0,1,0),this.direction2=new P.l(0,1,0)}return w.prototype.startDirectionFunction=function(w,v,I,u){var Q=K.b.RandomRange(this.direction1.x,this.direction2.x),a=K.b.RandomRange(this.direction1.y,this.direction2.y),U=K.b.RandomRange(this.direction1.z,this.direction2.z);u?v.copyFromFloats(Q,a,U):P.l.TransformNormalFromFloatsToRef(Q,a,U,w,v)},w.prototype.startPositionFunction=function(w,v,I,u){u?v.copyFromFloats(0,0,0):P.l.TransformCoordinatesFromFloatsToRef(0,0,0,w,v)},w.prototype.clone=function(){var v=new w;return Q.e.DeepCopy(this,v),v},w.prototype.applyToShader=function(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)},w.prototype.buildUniformLayout=function(w){w.addUniform("direction1",3),w.addUniform("direction2",3)},w.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},w.prototype.getClassName=function(){return"PointParticleEmitter"},w.prototype.serialize=function(){var w={};return w.type=this.getClassName(),w.direction1=this.direction1.asArray(),w.direction2=this.direction2.asArray(),w},w.prototype.parse=function(w){P.l.FromArrayToRef(w.direction1,0,this.direction1),P.l.FromArrayToRef(w.direction2,0,this.direction2)},w}(),l=function(){function w(w,v,I){void 0===w&&(w=1),void 0===v&&(v=1),void 0===I&&(I=0),this.radius=w,this.radiusRange=v,this.directionRandomizer=I}return w.prototype.startDirectionFunction=function(w,v,I,u){var Q=I.position.subtract(w.getTranslation()).normalize(),a=K.b.RandomRange(0,this.directionRandomizer),U=K.b.RandomRange(0,this.directionRandomizer),p=K.b.RandomRange(0,this.directionRandomizer);Q.x+=a,Q.y+=U,Q.z+=p,Q.normalize(),u?v.copyFrom(Q):P.l.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,w,v)},w.prototype.startPositionFunction=function(w,v,I,u){var Q=this.radius-K.b.RandomRange(0,this.radius*this.radiusRange),a=K.b.RandomRange(0,1),U=K.b.RandomRange(0,2*Math.PI),p=Math.acos(2*a-1),r=Q*Math.cos(U)*Math.sin(p),Y=Q*Math.cos(p),g=Q*Math.sin(U)*Math.sin(p);u?v.copyFromFloats(r,Y,g):P.l.TransformCoordinatesFromFloatsToRef(r,Y,g,w,v)},w.prototype.clone=function(){var v=new w(this.radius,this.directionRandomizer);return Q.e.DeepCopy(this,v),v},w.prototype.applyToShader=function(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)},w.prototype.buildUniformLayout=function(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)},w.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},w.prototype.getClassName=function(){return"SphereParticleEmitter"},w.prototype.serialize=function(){var w={};return w.type=this.getClassName(),w.radius=this.radius,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w},w.prototype.parse=function(w){this.radius=w.radius,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer},w}(),R=function(w){function v(v,I,u){void 0===v&&(v=1),void 0===I&&(I=new P.l(0,1,0)),void 0===u&&(u=new P.l(0,1,0));var Q=w.call(this,v)||this;return Q.direction1=I,Q.direction2=u,Q}return(0,p.m)(v,w),v.prototype.startDirectionFunction=function(w,v){var I=K.b.RandomRange(this.direction1.x,this.direction2.x),u=K.b.RandomRange(this.direction1.y,this.direction2.y),Q=K.b.RandomRange(this.direction1.z,this.direction2.z);P.l.TransformNormalFromFloatsToRef(I,u,Q,w,v)},v.prototype.clone=function(){var w=new v(this.radius,this.direction1,this.direction2);return Q.e.DeepCopy(this,w),w},v.prototype.applyToShader=function(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)},v.prototype.buildUniformLayout=function(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)},v.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"},v.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},v.prototype.serialize=function(){var v=w.prototype.serialize.call(this);return v.direction1=this.direction1.asArray(),v.direction2=this.direction2.asArray(),v},v.prototype.parse=function(v){w.prototype.parse.call(this,v),this.direction1.copyFrom(v.direction1),this.direction2.copyFrom(v.direction2)},v}(l),x=function(){function w(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return w.prototype.startDirectionFunction=function(w,v,I,u){var Q=P.i.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,I,Q);var K=P.i.Vector3[1];Q.subtractToRef(I.position,K),K.scaleToRef(1/I.lifeTime,Q)}else Q.set(0,0,0);u?v.copyFrom(Q):P.l.TransformNormalToRef(Q,w,v)},w.prototype.startPositionFunction=function(w,v,I,u){var Q=P.i.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,I,Q):Q.set(0,0,0),u?v.copyFrom(Q):P.l.TransformCoordinatesToRef(Q,w,v)},w.prototype.clone=function(){var v=new w;return Q.e.DeepCopy(this,v),v},w.prototype.applyToShader=function(w){},w.prototype.buildUniformLayout=function(w){},w.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},w.prototype.getClassName=function(){return"CustomParticleEmitter"},w.prototype.serialize=function(){var w={};return w.type=this.getClassName(),w},w.prototype.parse=function(w){},w}(),j=I(43251),s=function(){function w(w){void 0===w&&(w=null),this._indices=null,this._positions=null,this._normals=null,this._storedNormal=P.l.Zero(),this._mesh=null,this.direction1=new P.l(0,1,0),this.direction2=new P.l(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=w}return Object.defineProperty(w.prototype,"mesh",{get:function(){return this._mesh},set:function(w){this._mesh!==w&&(this._mesh=w,w?(this._indices=w.getIndices(),this._positions=w.getVerticesData(j.f.PositionKind),this._normals=w.getVerticesData(j.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))},enumerable:!1,configurable:!0}),w.prototype.startDirectionFunction=function(w,v,I,u){if(this.useMeshNormalsForDirection&&this._normals)P.l.TransformNormalToRef(this._storedNormal,w,v);else{var Q=K.b.RandomRange(this.direction1.x,this.direction2.x),a=K.b.RandomRange(this.direction1.y,this.direction2.y),U=K.b.RandomRange(this.direction1.z,this.direction2.z);u?v.copyFromFloats(Q,a,U):P.l.TransformNormalFromFloatsToRef(Q,a,U,w,v)}},w.prototype.startPositionFunction=function(w,v,I,u){if(this._indices&&this._positions){var Q=3*Math.random()*(this._indices.length/3)|0,K=Math.random(),a=Math.random()*(1-K),U=1-K-a,p=this._indices[Q],r=this._indices[Q+1],Y=this._indices[Q+2],g=P.i.Vector3[0],J=P.i.Vector3[1],l=P.i.Vector3[2],R=P.i.Vector3[3];P.l.FromArrayToRef(this._positions,3*p,g),P.l.FromArrayToRef(this._positions,3*r,J),P.l.FromArrayToRef(this._positions,3*Y,l),R.x=K*g.x+a*J.x+U*l.x,R.y=K*g.y+a*J.y+U*l.y,R.z=K*g.z+a*J.z+U*l.z,u?v.copyFromFloats(R.x,R.y,R.z):P.l.TransformCoordinatesFromFloatsToRef(R.x,R.y,R.z,w,v),this.useMeshNormalsForDirection&&this._normals&&(P.l.FromArrayToRef(this._normals,3*p,g),P.l.FromArrayToRef(this._normals,3*r,J),P.l.FromArrayToRef(this._normals,3*Y,l),this._storedNormal.x=K*g.x+a*J.x+U*l.x,this._storedNormal.y=K*g.y+a*J.y+U*l.y,this._storedNormal.z=K*g.z+a*J.z+U*l.z)}},w.prototype.clone=function(){var v=new w(this.mesh);return Q.e.DeepCopy(this,v),v},w.prototype.applyToShader=function(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)},w.prototype.buildUniformLayout=function(w){w.addUniform("direction1",3),w.addUniform("direction2",3)},w.prototype.getEffectDefines=function(){return""},w.prototype.getClassName=function(){return"MeshParticleEmitter"},w.prototype.serialize=function(){var w,v={};return v.type=this.getClassName(),v.direction1=this.direction1.asArray(),v.direction2=this.direction2.asArray(),v.meshId=null===(w=this.mesh)||void 0===w?void 0:w.id,v.useMeshNormalsForDirection=this.useMeshNormalsForDirection,v},w.prototype.parse=function(w,v){P.l.FromArrayToRef(w.direction1,0,this.direction1),P.l.FromArrayToRef(w.direction2,0,this.direction2),w.meshId&&v&&(this.mesh=v.getLastMeshById(w.meshId)),this.useMeshNormalsForDirection=w.useMeshNormalsForDirection},w}(),B=I(9488),t=(I(37855),function(){function w(v){this.animations=[],this.renderingGroupId=0,this.emitter=P.l.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this._rootUrl="",this.noiseStrength=new P.l(10,10,10),this.onAnimationEnd=null,this.blendMode=w.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new P.k(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new P.l(0,0,0),this.gravity=P.l.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new B.f(1,1,1,1),this.color2=new B.f(1,1,1,1),this.colorDead=new B.f(0,0,0,1),this.textureMask=new B.f(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new u.d,this.id=v,this.name=v}return Object.defineProperty(w.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(w){this._noiseTexture!==w&&(this._noiseTexture=w,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(w){this._isAnimationSheetEnabled!=w&&(this._isAnimationSheetEnabled=w,this._reset())},enumerable:!1,configurable:!0}),w.prototype.getScene=function(){return this._scene},w.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},w.prototype.getDragGradients=function(){return this._dragGradients},w.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},w.prototype.getColorGradients=function(){return this._colorGradients},w.prototype.getSizeGradients=function(){return this._sizeGradients},w.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},w.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},w.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},w.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},w.prototype.getVelocityGradients=function(){return this._velocityGradients},w.prototype.getStartSizeGradients=function(){return this._startSizeGradients},w.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(w.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:P.l.Zero()},set:function(w){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:P.l.Zero()},set:function(w){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:P.l.Zero()},set:function(w){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:P.l.Zero()},set:function(w){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(w){this._billboardMode!==w&&(this._billboardMode=w,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(w){this._isBillboardBased!==w&&(this._isBillboardBased=w,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(w){this._attachImageProcessingConfiguration(w)},enumerable:!1,configurable:!0}),w.prototype._attachImageProcessingConfiguration=function(w){w!==this._imageProcessingConfiguration&&(!w&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=w)},w.prototype._reset=function(){},w.prototype._removeGradientAndTexture=function(w,v,I){if(!v)return this;for(var P=0,u=0,Q=v;u<Q.length;u++){if(Q[u].gradient===w){v.splice(P,1);break}P++}return I&&I.dispose(),this},w.prototype.createPointEmitter=function(w,v){var I=new J;return I.direction1=w,I.direction2=v,this.particleEmitterType=I,I},w.prototype.createHemisphericEmitter=function(w,v){void 0===w&&(w=1),void 0===v&&(v=1);var I=new g(w,v);return this.particleEmitterType=I,I},w.prototype.createSphereEmitter=function(w,v){void 0===w&&(w=1),void 0===v&&(v=1);var I=new l(w,v);return this.particleEmitterType=I,I},w.prototype.createDirectedSphereEmitter=function(w,v,I){void 0===w&&(w=1),void 0===v&&(v=new P.l(0,1,0)),void 0===I&&(I=new P.l(0,1,0));var u=new R(w,v,I);return this.particleEmitterType=u,u},w.prototype.createCylinderEmitter=function(w,v,I,P){void 0===w&&(w=1),void 0===v&&(v=1),void 0===I&&(I=1),void 0===P&&(P=0);var u=new r(w,v,I,P);return this.particleEmitterType=u,u},w.prototype.createDirectedCylinderEmitter=function(w,v,I,u,Q){void 0===w&&(w=1),void 0===v&&(v=1),void 0===I&&(I=1),void 0===u&&(u=new P.l(0,1,0)),void 0===Q&&(Q=new P.l(0,1,0));var K=new Y(w,v,I,u,Q);return this.particleEmitterType=K,K},w.prototype.createConeEmitter=function(w,v){void 0===w&&(w=1),void 0===v&&(v=Math.PI/4);var I=new U(w,v);return this.particleEmitterType=I,I},w.prototype.createBoxEmitter=function(w,v,I,P){var u=new a;return this.particleEmitterType=u,this.direction1=w,this.direction2=v,this.minEmitBox=I,this.maxEmitBox=P,u},w.BLENDMODE_ONEONE=0,w.BLENDMODE_STANDARD=1,w.BLENDMODE_ADD=2,w.BLENDMODE_MULTIPLY=3,w.BLENDMODE_MULTIPLYADD=4,w}()),i=I(90559),z=function(){function w(w){this._isUbo(w)?(this.setMatrix3x3=w.updateMatrix3x3.bind(w),this.setMatrix2x2=w.updateMatrix2x2.bind(w),this.setFloat=w.updateFloat.bind(w),this.setFloat2=w.updateFloat2.bind(w),this.setFloat3=w.updateFloat3.bind(w),this.setFloat4=w.updateFloat4.bind(w),this.setFloatArray=w.updateFloatArray.bind(w),this.setArray=w.updateArray.bind(w),this.setIntArray=w.updateIntArray.bind(w),this.setMatrix=w.updateMatrix.bind(w),this.setMatrices=w.updateMatrices.bind(w),this.setVector3=w.updateVector3.bind(w),this.setVector4=w.updateVector4.bind(w),this.setColor3=w.updateColor3.bind(w),this.setColor4=w.updateColor4.bind(w),this.setDirectColor4=w.updateDirectColor4.bind(w),this.setInt=w.updateInt.bind(w),this.setInt2=w.updateInt2.bind(w),this.setInt3=w.updateInt3.bind(w),this.setInt4=w.updateInt4.bind(w)):(this.setMatrix3x3=w.setMatrix3x3.bind(w),this.setMatrix2x2=w.setMatrix2x2.bind(w),this.setFloat=w.setFloat.bind(w),this.setFloat2=w.setFloat2.bind(w),this.setFloat3=w.setFloat3.bind(w),this.setFloat4=w.setFloat4.bind(w),this.setFloatArray=w.setFloatArray.bind(w),this.setArray=w.setArray.bind(w),this.setIntArray=w.setIntArray.bind(w),this.setMatrix=w.setMatrix.bind(w),this.setMatrices=w.setMatrices.bind(w),this.setVector3=w.setVector3.bind(w),this.setVector4=w.setVector4.bind(w),this.setColor3=w.setColor3.bind(w),this.setColor4=w.setColor4.bind(w),this.setDirectColor4=w.setDirectColor4.bind(w),this.setInt=w.setInt.bind(w),this.setInt2=w.setInt2.bind(w),this.setInt3=w.setInt3.bind(w),this.setInt4=w.setInt4.bind(w))}return w.prototype._isUbo=function(w){return void 0!==w.addUniform},w}(),E=I(31709),o=I(16179),h="#version 300 es\nvoid main() {\ndiscard;\n}\n";o.c.ShadersStore.gpuUpdateParticlesPixelShader=h;var n="#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {\nvec3 newPosition;\nvec3 newDirection;\nvec4 randoms=getRandomVec4(seed.x);\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=newAge-life;\noutSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=vec3(0,0,0);\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\nnewDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\nnewDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nnewPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;\nnewDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));\nnewDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;\nh=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h *height.x;\nnewPosition=vec3(randX,randY,randZ); \nif (abs(cos(coneAngle))==1.0) {\nnewDirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\nnewDirection=normalize(newPosition+directionRandomizer*randoms3); \n}\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;\noutInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);\nnewDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;\nif (cellInfos.w==1.0) {\nratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);\n}\nelse {\nratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);\n}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}";o.c.ShadersStore.gpuUpdateParticlesVertexShader=n;var W=function(){function w(w,v){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=w,this._engine=v,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}return w.prototype.isUpdateBufferCreated=function(){return!!this._updateEffect},w.prototype.isUpdateBufferReady=function(){var w,v;return null!==(v=null===(w=this._updateEffect)||void 0===w?void 0:w.isReady())&&void 0!==v&&v},w.prototype.createUpdateBuffer=function(w){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof x&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=w,this._updateEffect=new i.b("gpuUpdateParticles",this._updateEffectOptions,this._engine),new z(this._updateEffect)},w.prototype.createVertexBuffers=function(w,v){this._updateVAO.push(this._createUpdateVAO(w)),this._renderVAO.push(this._engine.recordVertexArrayObject(v,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null)},w.prototype.createParticleBuffer=function(w){return w},w.prototype.bindDrawBuffers=function(w){this._engine.bindVertexArrayObject(this._renderVAO[w],null)},w.prototype.preUpdateParticleBuffer=function(){var w=this._engine;if(this._engine.enableEffect(this._updateEffect),!w.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")},w.prototype.updateParticleBuffer=function(w,v,I){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[w],null);var P=this._engine;P.bindTransformFeedbackBuffer(v.getBuffer()),P.setRasterizerState(!1),P.beginTransformFeedback(!0),P.drawArraysType(3,0,I),P.endTransformFeedback(),P.setRasterizerState(!0),P.bindTransformFeedbackBuffer(null)},w.prototype.releaseBuffers=function(){},w.prototype.releaseVertexBuffers=function(){for(var w=0;w<this._updateVAO.length;w++)this._engine.releaseVertexArrayObject(this._updateVAO[w]);this._updateVAO=[];for(w=0;w<this._renderVAO.length;w++)this._engine.releaseVertexArrayObject(this._renderVAO[w]);this._renderVAO=[]},w.prototype._createUpdateVAO=function(w){var v={};v.position=w.createVertexBuffer("position",0,3);var I=3;v.age=w.createVertexBuffer("age",I,1),I+=1,v.size=w.createVertexBuffer("size",I,3),I+=3,v.life=w.createVertexBuffer("life",I,1),I+=1,v.seed=w.createVertexBuffer("seed",I,4),I+=4,v.direction=w.createVertexBuffer("direction",I,3),I+=3,this._parent.particleEmitterType instanceof x&&(v.initialPosition=w.createVertexBuffer("initialPosition",I,3),I+=3),this._parent._colorGradientsTexture||(v.color=w.createVertexBuffer("color",I,4),I+=4),this._parent._isBillboardBased||(v.initialDirection=w.createVertexBuffer("initialDirection",I,3),I+=3),this._parent.noiseTexture&&(v.noiseCoordinates1=w.createVertexBuffer("noiseCoordinates1",I,3),I+=3,v.noiseCoordinates2=w.createVertexBuffer("noiseCoordinates2",I,3),I+=3),this._parent._angularSpeedGradientsTexture?(v.angle=w.createVertexBuffer("angle",I,1),I+=1):(v.angle=w.createVertexBuffer("angle",I,2),I+=2),this._parent._isAnimationSheetEnabled&&(v.cellIndex=w.createVertexBuffer("cellIndex",I,1),I+=1,this._parent.spriteRandomStartCell&&(v.cellStartOffset=w.createVertexBuffer("cellStartOffset",I,1),I+=1));var P=this._engine.recordVertexArrayObject(v,null,this._updateEffect);return this._engine.bindArrayBuffer(null),P},w}();(0,E.g)("BABYLON.WebGL2ParticleSystem",W);var V,F=function(){function w(w,v,I){void 0===I&&(I=3),this._engine=w,this._engine._storageBuffers.push(this),this._create(v,I)}return w.prototype._create=function(w,v){this._bufferSize=w,this._creationFlags=v,this._buffer=this._engine.createStorageBuffer(w,v)},w.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},w.prototype.getBuffer=function(){return this._buffer},w.prototype.update=function(w,v,I){this._buffer&&this._engine.updateStorageBuffer(this._buffer,w,v,I)},w.prototype.read=function(w,v,I){return this._engine.readFromStorageBuffer(this._buffer,w,v,I)},w.prototype.dispose=function(){var w=this._engine._storageBuffers,v=w.indexOf(this);-1!==v&&(w[v]=w[w.length-1],w.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null},w}(),O=I(9892),N=I(72284);!function(w){w[w.Texture=0]="Texture",w[w.StorageTexture=1]="StorageTexture",w[w.UniformBuffer=2]="UniformBuffer",w[w.StorageBuffer=3]="StorageBuffer",w[w.TextureWithoutSampler=4]="TextureWithoutSampler",w[w.Sampler=5]="Sampler"}(V||(V={})),N.d.prototype.createComputeEffect=function(w,v){throw new Error("createComputeEffect: This engine does not support compute shaders!")},N.d.prototype.createComputePipelineContext=function(){throw new Error("createComputePipelineContext: This engine does not support compute shaders!")},N.d.prototype.createComputeContext=function(){},N.d.prototype.computeDispatch=function(w,v,I,P,u,Q,K){throw new Error("computeDispatch: This engine does not support compute shaders!")},N.d.prototype.areAllComputeEffectsReady=function(){return!0},N.d.prototype.releaseComputeEffects=function(){},N.d.prototype._prepareComputePipelineContext=function(w,v,I,P,u){},N.d.prototype._rebuildComputeEffects=function(){},N.d.prototype._executeWhenComputeStateIsCompiled=function(w,v){v()},N.d.prototype._releaseComputeEffect=function(w){},N.d.prototype._deleteComputePipelineContext=function(w){};var q=I(70937),m=I(45934),c=I(9127),M=I(80150),S=function(){function w(w,v,I,P){void 0===P&&(P={}),this._bindings={},this._samplers={},this._contextIsDirty=!1,this.onCompiled=null,this.onError=null,this.name=w,this._engine=v,this.uniqueId=m.b.UniqueId,this._engine.getCaps().supportComputeShaders?P.bindingsMapping?(this._context=v.createComputeContext(),this._shaderPath=I,this._options=(0,p.d)({bindingsMapping:{},defines:[]},P)):c.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):c.e.Error("This engine does not support compute shaders!")}return Object.defineProperty(w.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"shaderPath",{get:function(){return this._shaderPath},enumerable:!1,configurable:!0}),w.prototype.getClassName=function(){return"ComputeShader"},w.prototype.setTexture=function(w,v,I){void 0===I&&(I=!0);var P=this._bindings[w];this._bindings[w]={type:I?V.Texture:V.TextureWithoutSampler,object:v,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!P||P.object!==v||P.type!==this._bindings[w].type)},w.prototype.setStorageTexture=function(w,v){var I=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==v),this._bindings[w]={type:V.StorageTexture,object:v,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}},w.prototype.setUniformBuffer=function(w,v){var I=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==v),this._bindings[w]={type:V.UniformBuffer,object:v,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}},w.prototype.setStorageBuffer=function(w,v){var I=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!I||I.object!==v),this._bindings[w]={type:V.StorageBuffer,object:v,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}},w.prototype.setTextureSampler=function(w,v){var I=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!I||!v.compareSampler(I.object)),this._bindings[w]={type:V.Sampler,object:v,indexInGroupEntries:null===I||void 0===I?void 0:I.indexInGroupEntries}},w.prototype.isReady=function(){var w=this._effect;for(var v in this._bindings){var I=this._bindings[v],P=I.type,u=I.object;switch(P){case V.Texture:case V.TextureWithoutSampler:case V.StorageTexture:if(!u.isReady())return!1}}var Q=[],K=this._shaderPath;if(this._options.defines)for(var a=0;a<this._options.defines.length;a++)Q.push(this._options.defines[a]);var U=Q.join("\n");return this._cachedDefines!==U&&(this._cachedDefines=U,w=this._engine.createComputeEffect(K,{defines:U,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=w),!!w.isReady()},w.prototype.dispatch=function(w,v,I){var P;if(!this.isReady())return!1;for(var u in this._bindings){var Q=this._bindings[u];if(!this._options.bindingsMapping[u])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+u+"'");if(Q.type===V.Texture){var K=this._samplers[u],a=Q.object;K&&a._texture&&K.compareSampler(a._texture)||(this._samplers[u]=(new M.c).setParameters(a.wrapU,a.wrapV,a.wrapR,a.anisotropicFilteringLevel,a._texture.samplingMode,null===(P=a._texture)||void 0===P?void 0:P._comparisonFunction),this._contextIsDirty=!0)}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),this._engine.computeDispatch(this._effect,this._context,this._bindings,w,v,I,this._options.bindingsMapping),!0},w.prototype.dispatchWhenReady=function(w,v,I,P){var u=this;return void 0===P&&(P=10),new Promise((function(Q){!function K(){u.dispatch(w,v,I)?Q():setTimeout(K,P)}()}))},w.prototype.serialize=function(){var w=O.e.Serialize(this);for(var v in w.options=this._options,w.shaderPath=this._shaderPath,w.bindings={},w.textures={},this._bindings){var I=this._bindings[v],P=I.object;switch(I.type){case V.Texture:case V.TextureWithoutSampler:case V.StorageTexture:var u=P.serialize();u&&(w.textures[v]=u,w.bindings[v]={type:I.type});case V.UniformBuffer:}}return w},w.Parse=function(v,I,P){var u=O.e.Parse((function(){return new w(v.name,I.getEngine(),v.shaderPath,v.options)}),v,I,P);for(var Q in v.textures){var K=v.bindings[Q],a=q.e.Parse(v.textures[Q],I,P);K.type===V.Texture?u.setTexture(Q,a):K.type===V.TextureWithoutSampler?u.setTexture(Q,a,!1):u.setStorageTexture(Q,a)}return u},(0,p.i)([(0,O.J)()],w.prototype,"name",void 0),w}();(0,E.g)("BABYLON.ComputeShader",S);var e=I(90534),H="struct Particle {\nposition : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};\nstruct Particles {\nparticles : array<Particle>,\n};\nstruct SimParams {\ncurrentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\ndirectionRandomizer : f32,\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};\n@binding(0) @group(0) var<uniform> params : SimParams;\n@binding(1) @group(0) var<storage,read> particlesIn : Particles;\n@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;\n@binding(3) @group(0) var randomTexture : texture_2d<f32>;\n@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;\n@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;\n@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;\n@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;\n@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;\n@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;\n@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {\nreturn textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;\n}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {\nreturn textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);\n}\n@stage(compute) @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\nlet index : u32=GlobalInvocationID.x;\nlet vertexID : f32=f32(index);\nif (index>=u32(params.currentCount)) {\nreturn;\n}\nlet PI : f32=3.14159;\nlet timeDelta : f32=params.timeDelta;\nlet newAge : f32=particlesIn.particles[index].age+timeDelta;\nlet life : f32=particlesIn.particles[index].life;\nlet seed : vec4<f32>=particlesIn.particles[index].seed;\nlet direction : vec3<f32>=particlesIn.particles[index].direction;\nif (newAge>=life && params.stopFactor != 0.) {\nvar newPosition : vec3<f32>;\nvar newDirection : vec3<f32>;\nlet randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);\nlet outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;\nparticlesOut.particles[index].life=outLife;\nparticlesOut.particles[index].age=newAge-life;\nparticlesOut.particles[index].seed=seed;\nvar sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewPosition=vec3<f32>(0.,0.,0.);\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet phi : f32=2.0*PI*randoms2.x;\nlet theta : f32=acos(-1.0+2.0*randoms2.y);\nlet randX : f32=cos(phi)*sin(theta);\nlet randY : f32=cos(theta);\nlet randZ : f32=sin(phi)*sin(theta);\nnewPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet phi : f32=2.0*PI*randoms2.x;\nlet theta : f32=acos(-1.0+2.0*randoms2.y);\nlet randX : f32=cos(phi)*sin(theta);\nlet randY : f32=cos(theta);\nlet randZ : f32=sin(phi)*sin(theta);\nnewPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet yPos : f32=(-0.5+randoms2.x)*params.height;\nvar angle : f32=randoms2.y*PI*2.;\nlet inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);\nlet positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));\nlet xPos : f32=positionRadius*cos(angle);\nlet zPos : f32=positionRadius*sin(angle);\nnewPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;\nnewDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));\nnewDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;\nh=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;\nlRadius=lRadius*h;\nlet randX : f32=lRadius*sin(s);\nlet randZ : f32=lRadius*cos(s);\nlet randY : f32=h *params.height.x;\nnewPosition=vec3<f32>(randX,randY,randZ); \nif (abs(cos(params.coneAngle))==1.0) {\nnewDirection=vec3<f32>(0.,1.0,0.);\n} else {\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3); \n}\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;\nparticlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);\nnewDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;\nparticlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {\nvar directionScale : f32=timeDelta;\nparticlesOut.particles[index].age=newAge;\nlet ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;\nparticlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\nlet currentVelocity : f32=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*params.limitVelocityDamping;\n}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;\nlet noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;\nlet fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;\nparticlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;\nparticlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;\nparticlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\nparticlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;\nparticlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;\nlet dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;\nparticlesOut.particles[index].cellStartOffset=cellStartOffset;\noffsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;\nif (params.cellInfos.w==1.0) {\nratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);\n}\nelse {\nratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);\n}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}\n}\n";o.c.ShadersStoreWGSL.gpuUpdateParticlesComputeShader=H;var G=function(){function w(w,v){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=w,this._engine=v}return w.prototype.isUpdateBufferCreated=function(){return!!this._updateComputeShader},w.prototype.isUpdateBufferReady=function(){var w,v;return null!==(v=null===(w=this._updateComputeShader)||void 0===w?void 0:w.isReady())&&void 0!==v&&v},w.prototype.createUpdateBuffer=function(w){var v,I={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(I.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(I.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(I.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(I.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(I.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(I.noiseTexture={group:1,binding:11}),this._updateComputeShader=new S("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:I,defines:w.split("\n")}),null===(v=this._simParamsComputeShader)||void 0===v||v.dispose(),this._simParamsComputeShader=new e.b(this._engine),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new z(this._simParamsComputeShader)},w.prototype.createVertexBuffers=function(w,v){this._renderVertexBuffers.push(v)},w.prototype.createParticleBuffer=function(w){var v=new F(this._engine,4*w.length,11);return v.update(w),this._bufferComputeShader.push(v),v.getBuffer()},w.prototype.bindDrawBuffers=function(w,v){this._engine.bindBuffers(this._renderVertexBuffers[w],null,v)},w.prototype.preUpdateParticleBuffer=function(){},w.prototype.updateParticleBuffer=function(w,v,I){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[w]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^w]),this._updateComputeShader.dispatch(Math.ceil(I/64))},w.prototype.releaseBuffers=function(){for(var w,v=0;v<this._bufferComputeShader.length;++v)this._bufferComputeShader[v].dispose();this._bufferComputeShader=[],null===(w=this._simParamsComputeShader)||void 0===w||w.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null},w.prototype.releaseVertexBuffers=function(){this._renderVertexBuffers=[]},w}();(0,E.g)("BABYLON.ComputeShaderParticleSystem",G);var L,d=function(){function w(w,v,I){this.gradient=w,this.color1=v,this.color2=I}return w.prototype.getColorToRef=function(w){this.color2?B.f.LerpToRef(this.color1,this.color2,Math.random(),w):w.copyFrom(this.color1)},w}(),D=function(w,v){this.gradient=w,this.color=v},f=function(){function w(w,v,I){this.gradient=w,this.factor1=v,this.factor2=I}return w.prototype.getFactor=function(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},w}(),b=function(){function w(){}return w.GetCurrentGradient=function(w,v,I){if(v[0].gradient>w)I(v[0],v[0],1);else{for(var P=0;P<v.length-1;P++){var u=v[P],Q=v[P+1];if(w>=u.gradient&&w<=Q.gradient)return void I(u,Q,(w-u.gradient)/(Q.gradient-u.gradient))}var K=v.length-1;I(v[K],v[K],1)}},w}(),k=I(9271),C=I(15099),y=I(78588),T=function(){function w(v){this.particleSystem=v,this.position=P.l.Zero(),this.direction=P.l.Zero(),this.color=new B.f(0,0,0,0),this.colorStep=new B.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new P.k(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new B.f(0,0,0,0),this._currentColor2=new B.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=w._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}return w.prototype._updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},w.prototype.updateCellIndex=function(){var w=this.age,v=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===v?(v=1,w=this._randomCellOffset):w+=this._randomCellOffset);var I,P=this._initialEndSpriteCellID-this._initialStartSpriteCellID;I=this._initialSpriteCellLoop?K.b.Clamp(w*v%this.lifeTime/this.lifeTime):K.b.Clamp(w*v/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+I*P|0},w.prototype._inheritParticleInfoToSubEmitter=function(w){if(w.particleSystem.emitter.position){var v=w.particleSystem.emitter;if(v.position.copyFrom(this.position),w.inheritDirection){var I=P.i.Vector3[0];this.direction.normalizeToRef(I),v.setDirection(I,0,Math.PI/2)}}else{w.particleSystem.emitter.copyFrom(this.position)}this.direction.scaleToRef(w.inheritedVelocityAmount/2,P.i.Vector3[0]),w.particleSystem._inheritedVelocityOffset.copyFrom(P.i.Vector3[0])},w.prototype._inheritParticleInfoToSubEmitters=function(){var w=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((function(v){w._inheritParticleInfoToSubEmitter(v)}))},w.prototype._reset=function(){this.age=0,this.id=w._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},w.prototype.copyTo=function(w){w.position.copyFrom(this.position),this._initialDirection?w._initialDirection?w._initialDirection.copyFrom(this._initialDirection):w._initialDirection=this._initialDirection.clone():w._initialDirection=null,w.direction.copyFrom(this.direction),this._localPosition&&(w._localPosition?w._localPosition.copyFrom(this._localPosition):w._localPosition=this._localPosition.clone()),w.color.copyFrom(this.color),w.colorStep.copyFrom(this.colorStep),w.lifeTime=this.lifeTime,w.age=this.age,w._randomCellOffset=this._randomCellOffset,w.size=this.size,w.scale.copyFrom(this.scale),w.angle=this.angle,w.angularSpeed=this.angularSpeed,w.particleSystem=this.particleSystem,w.cellIndex=this.cellIndex,w.id=this.id,w._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(w._currentColorGradient=this._currentColorGradient,w._currentColor1.copyFrom(this._currentColor1),w._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(w._currentSizeGradient=this._currentSizeGradient,w._currentSize1=this._currentSize1,w._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(w._currentAngularSpeedGradient=this._currentAngularSpeedGradient,w._currentAngularSpeed1=this._currentAngularSpeed1,w._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(w._currentVelocityGradient=this._currentVelocityGradient,w._currentVelocity1=this._currentVelocity1,w._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(w._currentLimitVelocityGradient=this._currentLimitVelocityGradient,w._currentLimitVelocity1=this._currentLimitVelocity1,w._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(w._currentDragGradient=this._currentDragGradient,w._currentDrag1=this._currentDrag1,w._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(w._initialStartSpriteCellID=this._initialStartSpriteCellID,w._initialEndSpriteCellID=this._initialEndSpriteCellID,w._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(w.remapData&&this.remapData?w.remapData.copyFrom(this.remapData):w.remapData=new P.p(0,0,0,0)),this._randomNoiseCoordinates1&&(w._randomNoiseCoordinates1?(w._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),w._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(w._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),w._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},w._Count=0,w}(),Z=I(50504);!function(w){w[w.ATTACHED=0]="ATTACHED",w[w.END=1]="END"}(L||(L={}));var A=function(){function w(w){if(this.particleSystem=w,this.type=L.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!w.emitter||!w.emitter.dispose){var v=(0,E.c)("BABYLON.AbstractMesh");w.emitter=new v("SubemitterSystemEmitter",w.getScene()),w._disposeEmitterOnDispose=!0}}return w.prototype.clone=function(){var v=this.particleSystem.emitter;if(v){if(v instanceof P.l)v=v.clone();else if(-1!==v.getClassName().indexOf("Mesh")){(v=new((0,E.c)("BABYLON.Mesh"))("",v.getScene())).isVisible=!1}}else v=new P.l;var I=new w(this.particleSystem.clone(this.particleSystem.name,v));return I.particleSystem.name+="Clone",I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem._disposeEmitterOnDispose=!0,I.particleSystem.disposeOnStop=!0,I},w.prototype.serialize=function(w){void 0===w&&(w=!1);var v={};return v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem=this.particleSystem.serialize(w),v},w._ParseParticleSystem=function(w,v,I,P){throw void 0===P&&(P=!1),(0,Z.e)("ParseParticle")},w.Parse=function(v,I,P){var u=v.particleSystem,Q=new w(w._ParseParticleSystem(u,I,P,!0));return Q.type=v.type,Q.inheritDirection=v.inheritDirection,Q.inheritedVelocityAmount=v.inheritedVelocityAmount,Q.particleSystem._isSubEmitter=!0,Q},w.prototype.dispose=function(){this.particleSystem.dispose()},w}(),X=I(61803),ww=(I(76578),I(23598),I(83874),I(68923),I(84098),"varying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}");o.c.ShadersStore.particlesPixelShader=ww;I(49329),I(61906);var vw="attribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvPositionW=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition;\nvPositionW=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;\nvPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvPositionW=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset/particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.c.ShadersStore.particlesVertexShader=vw;var Iw=I(86018),Pw=(I(54980),function(w){function v(v,I,u,Q,U,p){void 0===Q&&(Q=null),void 0===U&&(U=!1),void 0===p&&(p=.01);var r=w.call(this,v)||this;r._emitterInverseWorldMatrix=P.e.Identity(),r._inheritedVelocityOffset=new P.l,r.onDisposeObservable=new k.c,r.onStoppedObservable=new k.c,r._particles=new Array,r._stockParticles=new Array,r._newPartsExcess=0,r._vertexBuffers={},r._scaledColorStep=new B.f(0,0,0,0),r._colorDiff=new B.f(0,0,0,0),r._scaledDirection=P.l.Zero(),r._scaledGravity=P.l.Zero(),r._currentRenderId=-1,r._useInstancing=!1,r._started=!1,r._stopped=!1,r._actualFrame=0,r._currentEmitRate1=0,r._currentEmitRate2=0,r._currentStartSize1=0,r._currentStartSize2=0,r._rawTextureWidth=256,r._useRampGradients=!1,r._disposeEmitterOnDispose=!1,r.isLocal=!1,r._onBeforeDrawParticlesObservable=null,r.recycleParticle=function(w){var v=r._particles.pop();v!==w&&v.copyTo(w),r._stockParticles.push(v)},r._createParticle=function(){var w;if(0!==r._stockParticles.length?(w=r._stockParticles.pop())._reset():w=new T(r),r._subEmitters&&r._subEmitters.length>0){var v=r._subEmitters[Math.floor(Math.random()*r._subEmitters.length)];w._attachedSubEmitters=[],v.forEach((function(v){if(v.type===L.ATTACHED){var I=v.clone();w._attachedSubEmitters.push(I),I.particleSystem.start()}}))}return w},r._emitFromParticle=function(w){if(r._subEmitters&&0!==r._subEmitters.length){var v=Math.floor(Math.random()*r._subEmitters.length);r._subEmitters[v].forEach((function(v){if(v.type===L.END){var I=v.clone();w._inheritParticleInfoToSubEmitter(I),I.particleSystem._rootParticleSystem=r,r.activeSubSystems.push(I.particleSystem),I.particleSystem.start()}}))}},r._capacity=I,r._epsilon=p,r._isAnimationSheetEnabled=U,u&&"Scene"!==u.getClassName()?(r._engine=u,r.defaultProjectionMatrix=P.e.PerspectiveFovLH(.8,1,.1,100,r._engine.isNDCHalfZRange)):(r._scene=u||y.e.LastCreatedScene,r._engine=r._scene.getEngine(),r.uniqueId=r._scene.getUniqueId(),r._scene.particleSystems.push(r)),r._engine.getCaps().vertexArrayObject&&(r._vertexArrayObject=null),r._attachImageProcessingConfiguration(null),r._customWrappers={0:new X.c(r._engine)},r._customWrappers[0].effect=Q,r._drawWrappers=[],r._useInstancing=r._engine.getCaps().instancedArrays,r._createIndexBuffer(),r._createVertexBuffers(),r.particleEmitterType=new a;var Y=null;return r.updateFunction=function(w){var v,I=null;r.noiseTexture&&(I=r.noiseTexture.getSize(),null===(v=r.noiseTexture.getContent())||void 0===v||v.then((function(w){Y=w})));for(var u,Q=function(v){var Q=w[v],a=r._scaledUpdateSpeed,U=Q.age;if(Q.age+=a,Q.age>Q.lifeTime){var p=Q.age-U;a=(Q.lifeTime-U)*a/p,Q.age=Q.lifeTime}var g=Q.age/Q.lifeTime;r._colorGradients&&r._colorGradients.length>0?b.GetCurrentGradient(g,r._colorGradients,(function(w,v,I){w!==Q._currentColorGradient&&(Q._currentColor1.copyFrom(Q._currentColor2),v.getColorToRef(Q._currentColor2),Q._currentColorGradient=w),B.f.LerpToRef(Q._currentColor1,Q._currentColor2,I,Q.color)})):(Q.colorStep.scaleToRef(a,r._scaledColorStep),Q.color.addInPlace(r._scaledColorStep),Q.color.a<0&&(Q.color.a=0)),r._angularSpeedGradients&&r._angularSpeedGradients.length>0&&b.GetCurrentGradient(g,r._angularSpeedGradients,(function(w,v,I){w!==Q._currentAngularSpeedGradient&&(Q._currentAngularSpeed1=Q._currentAngularSpeed2,Q._currentAngularSpeed2=v.getFactor(),Q._currentAngularSpeedGradient=w),Q.angularSpeed=K.b.Lerp(Q._currentAngularSpeed1,Q._currentAngularSpeed2,I)})),Q.angle+=Q.angularSpeed*a;var J=a;if(r._velocityGradients&&r._velocityGradients.length>0&&b.GetCurrentGradient(g,r._velocityGradients,(function(w,v,I){w!==Q._currentVelocityGradient&&(Q._currentVelocity1=Q._currentVelocity2,Q._currentVelocity2=v.getFactor(),Q._currentVelocityGradient=w),J*=K.b.Lerp(Q._currentVelocity1,Q._currentVelocity2,I)})),Q.direction.scaleToRef(J,r._scaledDirection),r._limitVelocityGradients&&r._limitVelocityGradients.length>0&&b.GetCurrentGradient(g,r._limitVelocityGradients,(function(w,v,I){w!==Q._currentLimitVelocityGradient&&(Q._currentLimitVelocity1=Q._currentLimitVelocity2,Q._currentLimitVelocity2=v.getFactor(),Q._currentLimitVelocityGradient=w);var P=K.b.Lerp(Q._currentLimitVelocity1,Q._currentLimitVelocity2,I);Q.direction.length()>P&&Q.direction.scaleInPlace(r.limitVelocityDamping)})),r._dragGradients&&r._dragGradients.length>0&&b.GetCurrentGradient(g,r._dragGradients,(function(w,v,I){w!==Q._currentDragGradient&&(Q._currentDrag1=Q._currentDrag2,Q._currentDrag2=v.getFactor(),Q._currentDragGradient=w);var P=K.b.Lerp(Q._currentDrag1,Q._currentDrag2,I);r._scaledDirection.scaleInPlace(1-P)})),r.isLocal&&Q._localPosition?(Q._localPosition.addInPlace(r._scaledDirection),P.l.TransformCoordinatesToRef(Q._localPosition,r._emitterWorldMatrix,Q.position)):Q.position.addInPlace(r._scaledDirection),Y&&I&&Q._randomNoiseCoordinates1){var l=r._fetchR(Q._randomNoiseCoordinates1.x,Q._randomNoiseCoordinates1.y,I.width,I.height,Y),R=r._fetchR(Q._randomNoiseCoordinates1.z,Q._randomNoiseCoordinates2.x,I.width,I.height,Y),x=r._fetchR(Q._randomNoiseCoordinates2.y,Q._randomNoiseCoordinates2.z,I.width,I.height,Y),j=P.i.Vector3[0],s=P.i.Vector3[1];j.copyFromFloats((2*l-1)*r.noiseStrength.x,(2*R-1)*r.noiseStrength.y,(2*x-1)*r.noiseStrength.z),j.scaleToRef(a,s),Q.direction.addInPlace(s)}if(r.gravity.scaleToRef(a,r._scaledGravity),Q.direction.addInPlace(r._scaledGravity),r._sizeGradients&&r._sizeGradients.length>0&&b.GetCurrentGradient(g,r._sizeGradients,(function(w,v,I){w!==Q._currentSizeGradient&&(Q._currentSize1=Q._currentSize2,Q._currentSize2=v.getFactor(),Q._currentSizeGradient=w),Q.size=K.b.Lerp(Q._currentSize1,Q._currentSize2,I)})),r._useRampGradients&&(r._colorRemapGradients&&r._colorRemapGradients.length>0&&b.GetCurrentGradient(g,r._colorRemapGradients,(function(w,v,I){var P=K.b.Lerp(w.factor1,v.factor1,I),u=K.b.Lerp(w.factor2,v.factor2,I);Q.remapData.x=P,Q.remapData.y=u-P})),r._alphaRemapGradients&&r._alphaRemapGradients.length>0&&b.GetCurrentGradient(g,r._alphaRemapGradients,(function(w,v,I){var P=K.b.Lerp(w.factor1,v.factor1,I),u=K.b.Lerp(w.factor2,v.factor2,I);Q.remapData.z=P,Q.remapData.w=u-P}))),r._isAnimationSheetEnabled&&Q.updateCellIndex(),Q._inheritParticleInfoToSubEmitters(),Q.age>=Q.lifeTime)return r._emitFromParticle(Q),Q._attachedSubEmitters&&(Q._attachedSubEmitters.forEach((function(w){w.particleSystem.disposeOnStop=!0,w.particleSystem.stop()})),Q._attachedSubEmitters=null),r.recycleParticle(Q),v--,u=v,"continue";u=v},a=0;a<w.length;a++)Q(a),a=u},r}return(0,p.m)(v,w),Object.defineProperty(v.prototype,"onDispose",{set:function(w){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(w){this._useRampGradients!==w&&(this._useRampGradients=w,this._resetEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"particles",{get:function(){return this._particles},enumerable:!1,configurable:!0}),v.prototype.getActiveCount=function(){return this._particles.length},v.prototype.getClassName=function(){return"ParticleSystem"},v.prototype.isStopping=function(){return this._stopped&&this.isAlive()},v.prototype.getCustomEffect=function(w){var v,I;return void 0===w&&(w=0),null!==(I=null===(v=this._customWrappers[w])||void 0===v?void 0:v.effect)&&void 0!==I?I:this._customWrappers[0].effect},v.prototype._getCustomDrawWrapper=function(w){var v;return void 0===w&&(w=0),null!==(v=this._customWrappers[w])&&void 0!==v?v:this._customWrappers[0]},v.prototype.setCustomEffect=function(w,v){void 0===v&&(v=0),this._customWrappers[v]=new X.c(this._engine),this._customWrappers[v].effect=w,this._customWrappers[v].drawContext&&(this._customWrappers[v].drawContext.useInstancing=this._useInstancing)},Object.defineProperty(v.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"vertexShaderName",{get:function(){return"particles"},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"vertexBuffers",{get:function(){return this._vertexBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!1,configurable:!0}),v.prototype._addFactorGradient=function(w,v,I,P){var u=new f(v,I,P);w.push(u),w.sort((function(w,v){return w.gradient<v.gradient?-1:w.gradient>v.gradient?1:0}))},v.prototype._removeFactorGradient=function(w,v){if(w)for(var I=0,P=0,u=w;P<u.length;P++){if(u[P].gradient===v){w.splice(I,1);break}I++}},v.prototype.addLifeTimeGradient=function(w,v,I){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,w,v,I),this},v.prototype.removeLifeTimeGradient=function(w){return this._removeFactorGradient(this._lifeTimeGradients,w),this},v.prototype.addSizeGradient=function(w,v,I){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,w,v,I),this},v.prototype.removeSizeGradient=function(w){return this._removeFactorGradient(this._sizeGradients,w),this},v.prototype.addColorRemapGradient=function(w,v,I){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,w,v,I),this},v.prototype.removeColorRemapGradient=function(w){return this._removeFactorGradient(this._colorRemapGradients,w),this},v.prototype.addAlphaRemapGradient=function(w,v,I){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,w,v,I),this},v.prototype.removeAlphaRemapGradient=function(w){return this._removeFactorGradient(this._alphaRemapGradients,w),this},v.prototype.addAngularSpeedGradient=function(w,v,I){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,w,v,I),this},v.prototype.removeAngularSpeedGradient=function(w){return this._removeFactorGradient(this._angularSpeedGradients,w),this},v.prototype.addVelocityGradient=function(w,v,I){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,w,v,I),this},v.prototype.removeVelocityGradient=function(w){return this._removeFactorGradient(this._velocityGradients,w),this},v.prototype.addLimitVelocityGradient=function(w,v,I){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,w,v,I),this},v.prototype.removeLimitVelocityGradient=function(w){return this._removeFactorGradient(this._limitVelocityGradients,w),this},v.prototype.addDragGradient=function(w,v,I){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,w,v,I),this},v.prototype.removeDragGradient=function(w){return this._removeFactorGradient(this._dragGradients,w),this},v.prototype.addEmitRateGradient=function(w,v,I){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,w,v,I),this},v.prototype.removeEmitRateGradient=function(w){return this._removeFactorGradient(this._emitRateGradients,w),this},v.prototype.addStartSizeGradient=function(w,v,I){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,w,v,I),this},v.prototype.removeStartSizeGradient=function(w){return this._removeFactorGradient(this._startSizeGradients,w),this},v.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture&&this._scene){for(var w=new Uint8Array(4*this._rawTextureWidth),v=B.g.Color3[0],I=function(I){var u=I/P._rawTextureWidth;b.GetCurrentGradient(u,P._rampGradients,(function(P,u,Q){B.b.LerpToRef(P.color,u.color,Q,v),w[4*I]=255*v.r,w[4*I+1]=255*v.g,w[4*I+2]=255*v.b,w[4*I+3]=255}))},P=this,u=0;u<this._rawTextureWidth;u++)I(u);this._rampGradientsTexture=C.b.CreateRGBATexture(w,this._rawTextureWidth,1,this._scene,!1,!1,1)}},v.prototype.getRampGradients=function(){return this._rampGradients},v.prototype.forceRefreshGradients=function(){this._syncRampGradientTexture()},v.prototype._syncRampGradientTexture=function(){this._rampGradients&&(this._rampGradients.sort((function(w,v){return w.gradient<v.gradient?-1:w.gradient>v.gradient?1:0})),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())},v.prototype.addRampGradient=function(w,v){this._rampGradients||(this._rampGradients=[]);var I=new D(w,v);return this._rampGradients.push(I),this._syncRampGradientTexture(),this},v.prototype.removeRampGradient=function(w){return this._removeGradientAndTexture(w,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},v.prototype.addColorGradient=function(w,v,I){this._colorGradients||(this._colorGradients=[]);var P=new d(w,v,I);return this._colorGradients.push(P),this._colorGradients.sort((function(w,v){return w.gradient<v.gradient?-1:w.gradient>v.gradient?1:0})),this},v.prototype.removeColorGradient=function(w){if(!this._colorGradients)return this;for(var v=0,I=0,P=this._colorGradients;I<P.length;I++){if(P[I].gradient===w){this._colorGradients.splice(v,1);break}v++}return this},v.prototype.resetDrawCache=function(){for(var w=0,v=this._drawWrappers;w<v.length;w++){var I=v[w];if(I)for(var P=0,u=I;P<u.length;P++){var Q=u[P];null===Q||void 0===Q||Q.dispose()}}this._drawWrappers=[]},v.prototype._fetchR=function(w,v,I,P,u){return u[4*(((w=.5*Math.abs(w)+.5)*I%I|0)+((v=.5*Math.abs(v)+.5)*P%P|0)*I)]/255},v.prototype._reset=function(){this._resetEffect()},v.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()},v.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==v.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var w=this._engine,I=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*I),this._vertexBuffer=new j.c(w,this._vertexData,!0,I);var P=0,u=this._vertexBuffer.createVertexBuffer(j.f.PositionKind,P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[j.f.PositionKind]=u,P+=3;var Q=this._vertexBuffer.createVertexBuffer(j.f.ColorKind,P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[j.f.ColorKind]=Q,P+=4;var K=this._vertexBuffer.createVertexBuffer("angle",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=K,P+=1;var a,U=this._vertexBuffer.createVertexBuffer("size",P,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=U,P+=2,this._isAnimationSheetEnabled){var p=this._vertexBuffer.createVertexBuffer("cellIndex",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=p,P+=1}if(!this._isBillboardBased||this.billboardMode===v.BILLBOARDMODE_STRETCHED){var r=this._vertexBuffer.createVertexBuffer("direction",P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=r,P+=3}if(this._useRampGradients){var Y=this._vertexBuffer.createVertexBuffer("remapData",P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Y,P+=4}if(this._useInstancing){var g=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new j.c(w,g,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)}else a=this._vertexBuffer.createVertexBuffer("offset",P,2,this._vertexBufferSize,this._useInstancing),P+=2;this._vertexBuffers.offset=a,this.resetDrawCache()},v.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var w=[],v=0,I=0;I<this._capacity;I++)w.push(v),w.push(v+1),w.push(v+2),w.push(v),w.push(v+2),w.push(v+3),v+=4;this._indexBuffer=this._engine.createIndexBuffer(w)}},v.prototype.getCapacity=function(){return this._capacity},v.prototype.isAlive=function(){return this._alive},v.prototype.isStarted=function(){return this._started},v.prototype._prepareSubEmitterInternalArray=function(){var w=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((function(I){I instanceof v?w._subEmitters.push([new A(I)]):I instanceof A?w._subEmitters.push([I]):I instanceof Array&&w._subEmitters.push(I)}))},v.prototype.start=function(w){var v,I=this;if(void 0===w&&(w=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(w)setTimeout((function(){I.start(0)}),w);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){-1!==(null===(v=this.emitter)||void 0===v?void 0:v.getClassName().indexOf("Mesh"))&&this.emitter.computeWorldMatrix(!0);var P=this.noiseTexture;if(P&&P.onGeneratedObservable)P.onGeneratedObservable.addOnce((function(){setTimeout((function(){for(var w=0;w<I.preWarmCycles;w++)I.animate(!0),P.render()}))}));else for(var u=0;u<this.preWarmCycles;u++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},v.prototype.stop=function(w){void 0===w&&(w=!0),this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,w&&this._stopSubEmitters())},v.prototype.reset=function(){this._stockParticles=[],this._particles=[]},v.prototype._appendParticleVertex=function(w,I,u,Q){var K=w*this._vertexBufferSize;if(this._vertexData[K++]=I.position.x+this.worldOffset.x,this._vertexData[K++]=I.position.y+this.worldOffset.y,this._vertexData[K++]=I.position.z+this.worldOffset.z,this._vertexData[K++]=I.color.r,this._vertexData[K++]=I.color.g,this._vertexData[K++]=I.color.b,this._vertexData[K++]=I.color.a,this._vertexData[K++]=I.angle,this._vertexData[K++]=I.scale.x*I.size,this._vertexData[K++]=I.scale.y*I.size,this._isAnimationSheetEnabled&&(this._vertexData[K++]=I.cellIndex),this._isBillboardBased)this.billboardMode===v.BILLBOARDMODE_STRETCHED&&(this._vertexData[K++]=I.direction.x,this._vertexData[K++]=I.direction.y,this._vertexData[K++]=I.direction.z);else if(I._initialDirection){var a=I._initialDirection;this.isLocal&&(P.l.TransformNormalToRef(a,this._emitterWorldMatrix,P.i.Vector3[0]),a=P.i.Vector3[0]),0===a.x&&0===a.z&&(a.x=.001),this._vertexData[K++]=a.x,this._vertexData[K++]=a.y,this._vertexData[K++]=a.z}else{var U=I.direction;this.isLocal&&(P.l.TransformNormalToRef(U,this._emitterWorldMatrix,P.i.Vector3[0]),U=P.i.Vector3[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[K++]=U.x,this._vertexData[K++]=U.y,this._vertexData[K++]=U.z}this._useRampGradients&&I.remapData&&(this._vertexData[K++]=I.remapData.x,this._vertexData[K++]=I.remapData.y,this._vertexData[K++]=I.remapData.z,this._vertexData[K++]=I.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===u?u=this._epsilon:1===u&&(u=1-this._epsilon),0===Q?Q=this._epsilon:1===Q&&(Q=1-this._epsilon)),this._vertexData[K++]=u,this._vertexData[K++]=Q)},v.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach((function(w){w.stop(!0)})),this.activeSubSystems=new Array)},v.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var w=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==w&&this._rootParticleSystem.activeSubSystems.splice(w,1),this._rootParticleSystem=null}},v.prototype._update=function(w){var v,I=this;if(this._alive=this._particles.length>0,this.emitter.position){var u=this.emitter;this._emitterWorldMatrix=u.getWorldMatrix()}else{var Q=this.emitter;this._emitterWorldMatrix=P.e.Translation(Q.x,Q.y,Q.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this._particles);for(var a=function(w){if(U._particles.length===U._capacity)return"break";if(v=U._createParticle(),U._particles.push(v),U.targetStopDuration&&U._lifeTimeGradients&&U._lifeTimeGradients.length>0){var u=K.b.Clamp(U._actualFrame/U.targetStopDuration);b.GetCurrentGradient(u,U._lifeTimeGradients,(function(w,I){var P=w,Q=I,a=P.getFactor(),U=Q.getFactor(),p=(u-P.gradient)/(Q.gradient-P.gradient);v.lifeTime=K.b.Lerp(a,U,p)}))}else v.lifeTime=K.b.RandomRange(U.minLifeTime,U.maxLifeTime);var Q=K.b.RandomRange(U.minEmitPower,U.maxEmitPower);if(U.startPositionFunction?U.startPositionFunction(U._emitterWorldMatrix,v.position,v,U.isLocal):U.particleEmitterType.startPositionFunction(U._emitterWorldMatrix,v.position,v,U.isLocal),U.isLocal&&(v._localPosition?v._localPosition.copyFrom(v.position):v._localPosition=v.position.clone(),P.l.TransformCoordinatesToRef(v._localPosition,U._emitterWorldMatrix,v.position)),U.startDirectionFunction?U.startDirectionFunction(U._emitterWorldMatrix,v.direction,v,U.isLocal):U.particleEmitterType.startDirectionFunction(U._emitterWorldMatrix,v.direction,v,U.isLocal,U._emitterInverseWorldMatrix),0===Q?v._initialDirection?v._initialDirection.copyFrom(v.direction):v._initialDirection=v.direction.clone():v._initialDirection=null,v.direction.scaleInPlace(Q),U._sizeGradients&&0!==U._sizeGradients.length?(v._currentSizeGradient=U._sizeGradients[0],v._currentSize1=v._currentSizeGradient.getFactor(),v.size=v._currentSize1,U._sizeGradients.length>1?v._currentSize2=U._sizeGradients[1].getFactor():v._currentSize2=v._currentSize1):v.size=K.b.RandomRange(U.minSize,U.maxSize),v.scale.copyFromFloats(K.b.RandomRange(U.minScaleX,U.maxScaleX),K.b.RandomRange(U.minScaleY,U.maxScaleY)),U._startSizeGradients&&U._startSizeGradients[0]&&U.targetStopDuration){var a=U._actualFrame/U.targetStopDuration;b.GetCurrentGradient(a,U._startSizeGradients,(function(w,P,u){w!==I._currentStartSizeGradient&&(I._currentStartSize1=I._currentStartSize2,I._currentStartSize2=P.getFactor(),I._currentStartSizeGradient=w);var Q=K.b.Lerp(I._currentStartSize1,I._currentStartSize2,u);v.scale.scaleInPlace(Q)}))}if(U._angularSpeedGradients&&0!==U._angularSpeedGradients.length?(v._currentAngularSpeedGradient=U._angularSpeedGradients[0],v.angularSpeed=v._currentAngularSpeedGradient.getFactor(),v._currentAngularSpeed1=v.angularSpeed,U._angularSpeedGradients.length>1?v._currentAngularSpeed2=U._angularSpeedGradients[1].getFactor():v._currentAngularSpeed2=v._currentAngularSpeed1):v.angularSpeed=K.b.RandomRange(U.minAngularSpeed,U.maxAngularSpeed),v.angle=K.b.RandomRange(U.minInitialRotation,U.maxInitialRotation),U._velocityGradients&&U._velocityGradients.length>0&&(v._currentVelocityGradient=U._velocityGradients[0],v._currentVelocity1=v._currentVelocityGradient.getFactor(),U._velocityGradients.length>1?v._currentVelocity2=U._velocityGradients[1].getFactor():v._currentVelocity2=v._currentVelocity1),U._limitVelocityGradients&&U._limitVelocityGradients.length>0&&(v._currentLimitVelocityGradient=U._limitVelocityGradients[0],v._currentLimitVelocity1=v._currentLimitVelocityGradient.getFactor(),U._limitVelocityGradients.length>1?v._currentLimitVelocity2=U._limitVelocityGradients[1].getFactor():v._currentLimitVelocity2=v._currentLimitVelocity1),U._dragGradients&&U._dragGradients.length>0&&(v._currentDragGradient=U._dragGradients[0],v._currentDrag1=v._currentDragGradient.getFactor(),U._dragGradients.length>1?v._currentDrag2=U._dragGradients[1].getFactor():v._currentDrag2=v._currentDrag1),U._colorGradients&&0!==U._colorGradients.length)v._currentColorGradient=U._colorGradients[0],v._currentColorGradient.getColorToRef(v.color),v._currentColor1.copyFrom(v.color),U._colorGradients.length>1?U._colorGradients[1].getColorToRef(v._currentColor2):v._currentColor2.copyFrom(v.color);else{var p=K.b.RandomRange(0,1);B.f.LerpToRef(U.color1,U.color2,p,v.color),U.colorDead.subtractToRef(v.color,U._colorDiff),U._colorDiff.scaleToRef(1/v.lifeTime,v.colorStep)}U._isAnimationSheetEnabled&&(v._initialStartSpriteCellID=U.startSpriteCellID,v._initialEndSpriteCellID=U.endSpriteCellID,v._initialSpriteCellLoop=U.spriteCellLoop),v.direction.addInPlace(U._inheritedVelocityOffset),U._useRampGradients&&(v.remapData=new P.p(0,1,0,1)),U.noiseTexture&&(v._randomNoiseCoordinates1?(v._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),v._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(v._randomNoiseCoordinates1=new P.l(Math.random(),Math.random(),Math.random()),v._randomNoiseCoordinates2=new P.l(Math.random(),Math.random(),Math.random()))),v._inheritParticleInfoToSubEmitters()},U=this,p=0;p<w;p++){if("break"===a())break}},v._GetAttributeNamesOrOptions=function(w,v,I){void 0===w&&(w=!1),void 0===v&&(v=!1),void 0===I&&(I=!1);var P=[j.f.PositionKind,j.f.ColorKind,"angle","offset","size"];return w&&P.push("cellIndex"),v||P.push("direction"),I&&P.push("remapData"),P},v._GetEffectCreationOptions=function(w){void 0===w&&(w=!1);var v=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return w&&v.push("particlesInfos"),v},v.prototype.fillDefines=function(w,I){if(this._scene&&(this._scene.clipPlane&&w.push("#define CLIPPLANE"),this._scene.clipPlane2&&w.push("#define CLIPPLANE2"),this._scene.clipPlane3&&w.push("#define CLIPPLANE3"),this._scene.clipPlane4&&w.push("#define CLIPPLANE4"),this._scene.clipPlane5&&w.push("#define CLIPPLANE5"),this._scene.clipPlane6&&w.push("#define CLIPPLANE6")),this._isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),I===v.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&w.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case v.BILLBOARDMODE_Y:w.push("#define BILLBOARDY");break;case v.BILLBOARDMODE_STRETCHED:w.push("#define BILLBOARDSTRETCHED");break;case v.BILLBOARDMODE_ALL:w.push("#define BILLBOARDMODE_ALL")}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(this._imageProcessingConfigurationDefines.toString()))},v.prototype.fillUniformsAttributesAndSamplerNames=function(w,I,P){I.push.apply(I,v._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==v.BILLBOARDMODE_STRETCHED,this._useRampGradients)),w.push.apply(w,v._GetEffectCreationOptions(this._isAnimationSheetEnabled)),P.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&(u.e.PrepareUniforms(w,this._imageProcessingConfigurationDefines),u.e.PrepareSamplers(P,this._imageProcessingConfigurationDefines))},v.prototype._getWrapper=function(w){var v=this._getCustomDrawWrapper(w);if(null===v||void 0===v?void 0:v.effect)return v;var I=[];this.fillDefines(I,w);var P=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0,u=this._drawWrappers[P];u||(u=this._drawWrappers[P]=[]);var Q=u[w];Q||((Q=new X.c(this._engine)).drawContext&&(Q.drawContext.useInstancing=this._useInstancing),u[w]=Q);var K=I.join("\n");if(Q.defines!==K){var a=[],U=[],p=[];this.fillUniformsAttributesAndSamplerNames(U,a,p),Q.setEffect(this._engine.createEffect("particles",a,U,p,K),K)}return Q},v.prototype.animate=function(w){var v,I=this;if(void 0===w&&(w=!1),this._started){if(!w&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var P;if(this._scaledUpdateSpeed=this.updateSpeed*(w?this.preWarmStepOffset:(null===(v=this._scene)||void 0===v?void 0:v.getAnimationRatio())||1),this.manualEmitCount>-1)P=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var u=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var Q=this._actualFrame/this.targetStopDuration;b.GetCurrentGradient(Q,this._emitRateGradients,(function(w,v,P){w!==I._currentEmitRateGradient&&(I._currentEmitRate1=I._currentEmitRate2,I._currentEmitRate2=v.getFactor(),I._currentEmitRateGradient=w),u=K.b.Lerp(I._currentEmitRate1,I._currentEmitRate2,P)}))}P=u*this._scaledUpdateSpeed>>0,this._newPartsExcess+=u*this._scaledUpdateSpeed-P}if(this._newPartsExcess>1&&(P+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?P=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(P),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!w){for(var a=0,U=0;U<this._particles.length;U++){var p=this._particles[U];this._appendParticleVertices(a,p),a+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this._particles.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},v.prototype._appendParticleVertices=function(w,v){this._appendParticleVertex(w++,v,0,0),this._useInstancing||(this._appendParticleVertex(w++,v,1,0),this._appendParticleVertex(w++,v,1,1),this._appendParticleVertex(w++,v,0,1))},v.prototype.rebuild=function(){var w,v;for(var I in this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(w=this._spriteBuffer)||void 0===w||w._rebuild(),null===(v=this._vertexBuffer)||void 0===v||v._rebuild(),this._vertexBuffers)this._vertexBuffers[I]._rebuild();this.resetDrawCache()},v.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==v.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(v.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(v.BLENDMODE_ADD).effect.isReady())return!1}return!0},v.prototype._render=function(w){var I,u,Q=this._getWrapper(w),K=Q.effect,a=this._engine;a.enableEffect(Q);var U=null!==(I=this.defaultViewMatrix)&&void 0!==I?I:this._scene.getViewMatrix();if(K.setTexture("diffuseSampler",this.particleTexture),K.setMatrix("view",U),K.setMatrix("projection",null!==(u=this.defaultProjectionMatrix)&&void 0!==u?u:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var p=this.particleTexture.getBaseSize();K.setFloat3("particlesInfos",this.spriteCellWidth/p.width,this.spriteCellHeight/p.height,this.spriteCellWidth/p.width)}if(K.setVector2("translationPivot",this.translationPivot),K.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){var r=this._scene.activeCamera;K.setVector3("eyePosition",r.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),K.setTexture("rampSampler",this._rampGradientsTexture));var Y=K.defines;switch(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&Iw.e.BindClipPlane(K,this._scene),Y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(U.invertToRef(P.i.Matrix[0]),K.setMatrix("invView",P.i.Matrix[0])),void 0!==this._vertexArrayObject?(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,K)),this._engine.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):a.bindBuffers(this._vertexBuffers,this._indexBuffer,K),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(K),w){case v.BLENDMODE_ADD:a.setAlphaMode(1);break;case v.BLENDMODE_ONEONE:a.setAlphaMode(6);break;case v.BLENDMODE_STANDARD:a.setAlphaMode(2);break;case v.BLENDMODE_MULTIPLY:a.setAlphaMode(4)}return this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(K),this._useInstancing?a.drawArraysType(7,0,4,this._particles.length):a.drawElementsType(0,0,6*this._particles.length),this._particles.length},v.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var w=this._engine;w.setState&&(w.setState(!1),this.forceDepthWrite&&w.setDepthWrite(!0));var I=0;return I=this.blendMode===v.BLENDMODE_MULTIPLYADD?this._render(v.BLENDMODE_MULTIPLY)+this._render(v.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),I},v.prototype.dispose=function(w){if(void 0===w&&(w=!0),this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),w&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),w&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),this._subEmitters&&this._subEmitters.length){for(var v=0;v<this._subEmitters.length;v++)for(var I=0,P=this._subEmitters[v];I<P.length;I++){P[I].dispose()}this._subEmitters=[],this.subEmitters=[]}(this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene)&&((v=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(v,1),this._scene._activeParticleSystems.dispose());this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onStoppedObservable.clear(),this.reset()},v.prototype.clone=function(w,I){var P=(0,p.d)({},this._customWrappers),u=null,Q=this._engine;if(Q.createEffectForParticles&&null!=this.customShader){var K=(u=this.customShader).shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"",a=Q.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,K);P[0]?P[0].effect=a:this.setCustomEffect(a,0)}var U=this.serialize(),r=v.Parse(U,this._scene||this._engine,this._rootUrl);return r.name=w,r.customShader=u,r._customWrappers=P,void 0===I&&(I=this.emitter),this.noiseTexture&&(r.noiseTexture=this.noiseTexture.clone()),r.emitter=I,this.preventAutoStart||r.start(),r},v.prototype.serialize=function(w){void 0===w&&(w=!1);var I={};if(v._Serialize(I,this,w),I.textureMask=this.textureMask.asArray(),I.customShader=this.customShader,I.preventAutoStart=this.preventAutoStart,this.subEmitters){I.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var P=0,u=this._subEmitters;P<u.length;P++){for(var Q=[],K=0,a=u[P];K<a.length;K++){var U=a[K];Q.push(U.serialize(w))}I.subEmitters.push(Q)}}return I},v._Serialize=function(w,v,I){if(w.name=v.name,w.id=v.id,w.capacity=v.getCapacity(),w.disposeOnStop=v.disposeOnStop,w.manualEmitCount=v.manualEmitCount,v.emitter.position){var P=v.emitter;w.emitterId=P.id}else{var u=v.emitter;w.emitter=u.asArray()}v.particleEmitterType&&(w.particleEmitterType=v.particleEmitterType.serialize()),v.particleTexture&&(I?w.texture=v.particleTexture.serialize():(w.textureName=v.particleTexture.name,w.invertY=!!v.particleTexture._invertY)),w.isLocal=v.isLocal,O.e.AppendSerializedAnimations(v,w),w.beginAnimationOnStart=v.beginAnimationOnStart,w.beginAnimationFrom=v.beginAnimationFrom,w.beginAnimationTo=v.beginAnimationTo,w.beginAnimationLoop=v.beginAnimationLoop,w.startDelay=v.startDelay,w.renderingGroupId=v.renderingGroupId,w.isBillboardBased=v.isBillboardBased,w.billboardMode=v.billboardMode,w.minAngularSpeed=v.minAngularSpeed,w.maxAngularSpeed=v.maxAngularSpeed,w.minSize=v.minSize,w.maxSize=v.maxSize,w.minScaleX=v.minScaleX,w.maxScaleX=v.maxScaleX,w.minScaleY=v.minScaleY,w.maxScaleY=v.maxScaleY,w.minEmitPower=v.minEmitPower,w.maxEmitPower=v.maxEmitPower,w.minLifeTime=v.minLifeTime,w.maxLifeTime=v.maxLifeTime,w.emitRate=v.emitRate,w.gravity=v.gravity.asArray(),w.noiseStrength=v.noiseStrength.asArray(),w.color1=v.color1.asArray(),w.color2=v.color2.asArray(),w.colorDead=v.colorDead.asArray(),w.updateSpeed=v.updateSpeed,w.targetStopDuration=v.targetStopDuration,w.blendMode=v.blendMode,w.preWarmCycles=v.preWarmCycles,w.preWarmStepOffset=v.preWarmStepOffset,w.minInitialRotation=v.minInitialRotation,w.maxInitialRotation=v.maxInitialRotation,w.startSpriteCellID=v.startSpriteCellID,w.spriteCellLoop=v.spriteCellLoop,w.endSpriteCellID=v.endSpriteCellID,w.spriteCellChangeSpeed=v.spriteCellChangeSpeed,w.spriteCellWidth=v.spriteCellWidth,w.spriteCellHeight=v.spriteCellHeight,w.spriteRandomStartCell=v.spriteRandomStartCell,w.isAnimationSheetEnabled=v.isAnimationSheetEnabled;var Q=v.getColorGradients();if(Q){w.colorGradients=[];for(var K=0,a=Q;K<a.length;K++){var U=a[K],p={gradient:U.gradient,color1:U.color1.asArray()};U.color2?p.color2=U.color2.asArray():p.color2=U.color1.asArray(),w.colorGradients.push(p)}}var r=v.getRampGradients();if(r){w.rampGradients=[];for(var Y=0,g=r;Y<g.length;Y++){var J=g[Y];p={gradient:J.gradient,color:J.color.asArray()};w.rampGradients.push(p)}w.useRampGradients=v.useRampGradients}var l=v.getColorRemapGradients();if(l){w.colorRemapGradients=[];for(var R=0,x=l;R<x.length;R++){var j=x[R];p={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2?p.factor2=j.factor2:p.factor2=j.factor1,w.colorRemapGradients.push(p)}}var s=v.getAlphaRemapGradients();if(s){w.alphaRemapGradients=[];for(var B=0,t=s;B<t.length;B++){var i=t[B];p={gradient:i.gradient,factor1:i.factor1};void 0!==i.factor2?p.factor2=i.factor2:p.factor2=i.factor1,w.alphaRemapGradients.push(p)}}var z=v.getSizeGradients();if(z){w.sizeGradients=[];for(var E=0,o=z;E<o.length;E++){var h=o[E];p={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?p.factor2=h.factor2:p.factor2=h.factor1,w.sizeGradients.push(p)}}var n=v.getAngularSpeedGradients();if(n){w.angularSpeedGradients=[];for(var W=0,V=n;W<V.length;W++){var F=V[W];p={gradient:F.gradient,factor1:F.factor1};void 0!==F.factor2?p.factor2=F.factor2:p.factor2=F.factor1,w.angularSpeedGradients.push(p)}}var N=v.getVelocityGradients();if(N){w.velocityGradients=[];for(var q=0,m=N;q<m.length;q++){var c=m[q];p={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?p.factor2=c.factor2:p.factor2=c.factor1,w.velocityGradients.push(p)}}var M=v.getDragGradients();if(M){w.dragGradients=[];for(var S=0,e=M;S<e.length;S++){var H=e[S];p={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?p.factor2=H.factor2:p.factor2=H.factor1,w.dragGradients.push(p)}}var G=v.getEmitRateGradients();if(G){w.emitRateGradients=[];for(var L=0,d=G;L<d.length;L++){var D=d[L];p={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?p.factor2=D.factor2:p.factor2=D.factor1,w.emitRateGradients.push(p)}}var f=v.getStartSizeGradients();if(f){w.startSizeGradients=[];for(var b=0,k=f;b<k.length;b++){var C=k[b];p={gradient:C.gradient,factor1:C.factor1};void 0!==C.factor2?p.factor2=C.factor2:p.factor2=C.factor1,w.startSizeGradients.push(p)}}var y=v.getLifeTimeGradients();if(y){w.lifeTimeGradients=[];for(var T=0,Z=y;T<Z.length;T++){var A=Z[T];p={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?p.factor2=A.factor2:p.factor2=A.factor1,w.lifeTimeGradients.push(p)}}var X=v.getLimitVelocityGradients();if(X){w.limitVelocityGradients=[];for(var ww=0,vw=X;ww<vw.length;ww++){var Iw=vw[ww];p={gradient:Iw.gradient,factor1:Iw.factor1};void 0!==Iw.factor2?p.factor2=Iw.factor2:p.factor2=Iw.factor1,w.limitVelocityGradients.push(p)}w.limitVelocityDamping=v.limitVelocityDamping}v.noiseTexture&&(w.noiseTexture=v.noiseTexture.serialize())},v._Parse=function(w,v,I,u){var Q,K,p,x;x=I instanceof N.d?null:I;var j,t=(0,E.c)("BABYLON.Texture");if(t&&x&&(w.texture?v.particleTexture=t.Parse(w.texture,x,u):w.textureName&&(v.particleTexture=new t(u+w.textureName,x,!1,void 0===w.invertY||w.invertY),v.particleTexture.name=w.textureName)),w.emitterId||0===w.emitterId||void 0!==w.emitter?w.emitterId&&x?v.emitter=x.getLastMeshById(w.emitterId):v.emitter=P.l.FromArray(w.emitter):v.emitter=P.l.Zero(),v.isLocal=!!w.isLocal,void 0!==w.renderingGroupId&&(v.renderingGroupId=w.renderingGroupId),void 0!==w.isBillboardBased&&(v.isBillboardBased=w.isBillboardBased),void 0!==w.billboardMode&&(v.billboardMode=w.billboardMode),w.animations){for(var i=0;i<w.animations.length;i++){var z=w.animations[i],o=(0,E.c)("BABYLON.Animation");o&&v.animations.push(o.Parse(z))}v.beginAnimationOnStart=w.beginAnimationOnStart,v.beginAnimationFrom=w.beginAnimationFrom,v.beginAnimationTo=w.beginAnimationTo,v.beginAnimationLoop=w.beginAnimationLoop}if(w.autoAnimate&&x&&x.beginAnimation(v,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),v.startDelay=0|w.startDelay,v.minAngularSpeed=w.minAngularSpeed,v.maxAngularSpeed=w.maxAngularSpeed,v.minSize=w.minSize,v.maxSize=w.maxSize,w.minScaleX&&(v.minScaleX=w.minScaleX,v.maxScaleX=w.maxScaleX,v.minScaleY=w.minScaleY,v.maxScaleY=w.maxScaleY),void 0!==w.preWarmCycles&&(v.preWarmCycles=w.preWarmCycles,v.preWarmStepOffset=w.preWarmStepOffset),void 0!==w.minInitialRotation&&(v.minInitialRotation=w.minInitialRotation,v.maxInitialRotation=w.maxInitialRotation),v.minLifeTime=w.minLifeTime,v.maxLifeTime=w.maxLifeTime,v.minEmitPower=w.minEmitPower,v.maxEmitPower=w.maxEmitPower,v.emitRate=w.emitRate,v.gravity=P.l.FromArray(w.gravity),w.noiseStrength&&(v.noiseStrength=P.l.FromArray(w.noiseStrength)),v.color1=B.f.FromArray(w.color1),v.color2=B.f.FromArray(w.color2),v.colorDead=B.f.FromArray(w.colorDead),v.updateSpeed=w.updateSpeed,v.targetStopDuration=w.targetStopDuration,v.blendMode=w.blendMode,w.colorGradients)for(var h=0,n=w.colorGradients;h<n.length;h++){var W=n[h];v.addColorGradient(W.gradient,B.f.FromArray(W.color1),W.color2?B.f.FromArray(W.color2):void 0)}if(w.rampGradients){for(var V=0,F=w.rampGradients;V<F.length;V++){var O=F[V];v.addRampGradient(O.gradient,B.b.FromArray(O.color))}v.useRampGradients=w.useRampGradients}if(w.colorRemapGradients)for(var q=0,m=w.colorRemapGradients;q<m.length;q++){var c=m[q];v.addColorRemapGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2)}if(w.alphaRemapGradients)for(var M=0,S=w.alphaRemapGradients;M<S.length;M++){var e=S[M];v.addAlphaRemapGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2)}if(w.sizeGradients)for(var H=0,G=w.sizeGradients;H<G.length;H++){var L=G[H];v.addSizeGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2)}if(w.angularSpeedGradients)for(var d=0,D=w.angularSpeedGradients;d<D.length;d++){var f=D[d];v.addAngularSpeedGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2)}if(w.velocityGradients)for(var b=0,k=w.velocityGradients;b<k.length;b++){var C=k[b];v.addVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2)}if(w.dragGradients)for(var y=0,T=w.dragGradients;y<T.length;y++){var Z=T[y];v.addDragGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2)}if(w.emitRateGradients)for(var A=0,X=w.emitRateGradients;A<X.length;A++){var ww=X[A];v.addEmitRateGradient(ww.gradient,void 0!==ww.factor1?ww.factor1:ww.factor,ww.factor2)}if(w.startSizeGradients)for(var vw=0,Iw=w.startSizeGradients;vw<Iw.length;vw++){var Pw=Iw[vw];v.addStartSizeGradient(Pw.gradient,void 0!==Pw.factor1?Pw.factor1:Pw.factor,Pw.factor2)}if(w.lifeTimeGradients)for(var uw=0,Qw=w.lifeTimeGradients;uw<Qw.length;uw++){var Kw=Qw[uw];v.addLifeTimeGradient(Kw.gradient,void 0!==Kw.factor1?Kw.factor1:Kw.factor,Kw.factor2)}if(w.limitVelocityGradients){for(var aw=0,Uw=w.limitVelocityGradients;aw<Uw.length;aw++){var pw=Uw[aw];v.addLimitVelocityGradient(pw.gradient,void 0!==pw.factor1?pw.factor1:pw.factor,pw.factor2)}v.limitVelocityDamping=w.limitVelocityDamping}if(w.noiseTexture&&x){var rw=(0,E.c)("BABYLON.ProceduralTexture");v.noiseTexture=rw.Parse(w.noiseTexture,x,u)}if(w.particleEmitterType){switch(w.particleEmitterType.type){case"SphereParticleEmitter":j=new l;break;case"SphereDirectedParticleEmitter":j=new R;break;case"ConeEmitter":case"ConeParticleEmitter":j=new U;break;case"CylinderParticleEmitter":j=new r;break;case"CylinderDirectedParticleEmitter":j=new Y;break;case"HemisphericParticleEmitter":j=new g;break;case"PointParticleEmitter":j=new J;break;case"MeshParticleEmitter":j=new s;break;default:j=new a}j.parse(w.particleEmitterType,x)}else(j=new a).parse(w,x);v.particleEmitterType=j,v.startSpriteCellID=w.startSpriteCellID,v.endSpriteCellID=w.endSpriteCellID,v.spriteCellLoop=null===(Q=w.spriteCellLoop)||void 0===Q||Q,v.spriteCellWidth=w.spriteCellWidth,v.spriteCellHeight=w.spriteCellHeight,v.spriteCellChangeSpeed=w.spriteCellChangeSpeed,v.spriteRandomStartCell=w.spriteRandomStartCell,v.disposeOnStop=null!==(K=w.disposeOnStop)&&void 0!==K&&K,v.manualEmitCount=null!==(p=w.manualEmitCount)&&void 0!==p?p:-1},v.Parse=function(w,I,P,u,Q){void 0===u&&(u=!1);var K,a=w.name,U=null,p=null;if(K=I instanceof N.d?I:I.getEngine(),w.customShader&&K.createEffectForParticles){var r=(p=w.customShader).shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"";U=K.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,r)}var Y=new v(a,Q||w.capacity,I,U,w.isAnimationSheetEnabled);if(Y.customShader=p,Y._rootUrl=P,w.id&&(Y.id=w.id),w.subEmitters){Y.subEmitters=[];for(var g=0,J=w.subEmitters;g<J.length;g++){for(var l=[],R=0,x=J[g];R<x.length;R++){var j=x[R];l.push(A.Parse(j,I,P))}Y.subEmitters.push(l)}}return v._Parse(w,Y,I,P),w.textureMask&&(Y.textureMask=B.f.FromArray(w.textureMask)),w.preventAutoStart&&(Y.preventAutoStart=w.preventAutoStart),u||Y.preventAutoStart||Y.start(),Y},v.BILLBOARDMODE_Y=2,v.BILLBOARDMODE_ALL=7,v.BILLBOARDMODE_STRETCHED=8,v}(t));A._ParseParticleSystem=Pw.Parse;var uw=I(33048),Qw="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";o.c.IncludesShadersStore.clipPlaneFragmentDeclaration2=Qw;var Kw="precision highp float;\nuniform sampler2D diffuseSampler;\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\ngl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\ngl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";o.c.ShadersStore.gpuRenderParticlesPixelShader=Kw;var aw="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nout float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nout float fClipDistance6;\n#endif\n";o.c.IncludesShadersStore.clipPlaneVertexDeclaration2=aw;var Uw="precision highp float;\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\nuniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;\nattribute float age;\nattribute float life;\nattribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nattribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=(position+worldOffset)-eyePosition;\nyaxis.y=0.;\nvPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=(position+worldOffset)-eyePosition;\nvPositionW=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvPositionW=rotate(yaxis,rotatedCorner);\nvec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n}";o.c.ShadersStore.gpuRenderParticlesVertexShader=Uw;var pw=function(w){function v(v,I,u,Q,K){void 0===Q&&(Q=null),void 0===K&&(K=!1);var U=w.call(this,v)||this;if(U.layerMask=268435455,U._accumulatedCount=0,U._targetIndex=0,U._currentRenderId=-1,U._currentRenderingCameraUniqueId=-1,U._started=!1,U._stopped=!1,U._timeDelta=0,U._actualFrame=0,U._rawTextureWidth=256,U.onDisposeObservable=new k.c,U.onStoppedObservable=new k.c,U.forceDepthWrite=!1,U._preWarmDone=!1,U.isLocal=!1,U._onBeforeDrawParticlesObservable=null,u&&"Scene"!==u.getClassName()?(U._engine=u,U.defaultProjectionMatrix=P.e.PerspectiveFovLH(.8,1,.1,100,U._engine.isNDCHalfZRange)):(U._scene=u||y.e.LastCreatedScene,U._engine=U._scene.getEngine(),U.uniqueId=U._scene.getUniqueId(),U._scene.particleSystems.push(U)),U._engine.getCaps().supportComputeShaders){if(!(0,E.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");U._platform=new((0,E.c)("BABYLON.ComputeShaderParticleSystem"))(U,U._engine)}else{if(!(0,E.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");U._platform=new((0,E.c)("BABYLON.WebGL2ParticleSystem"))(U,U._engine)}U._customWrappers={0:new X.c(U._engine)},U._customWrappers[0].effect=Q,U._drawWrappers={0:new X.c(U._engine)},U._drawWrappers[0].drawContext&&(U._drawWrappers[0].drawContext.useInstancing=!0),U._attachImageProcessingConfiguration(null),(I=null!==I&&void 0!==I?I:{}).randomTextureSize||delete I.randomTextureSize;var r=(0,p.d)({capacity:5e4,randomTextureSize:U._engine.getCaps().maxTextureSize},I),Y=I;isFinite(Y)&&(r.capacity=Y),U._capacity=r.capacity,U._activeCount=r.capacity,U._currentActiveCount=0,U._isAnimationSheetEnabled=K,U.particleEmitterType=new a;for(var g=Math.min(U._engine.getCaps().maxTextureSize,r.randomTextureSize),J=[],l=0;l<g;++l)J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random());U._randomTexture=new C.b(new Float32Array(J),g,1,5,u,!1,!1,1,1),U._randomTexture.name="GPUParticleSystem_random1",U._randomTexture.wrapU=1,U._randomTexture.wrapV=1,J=[];for(l=0;l<g;++l)J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random());return U._randomTexture2=new C.b(new Float32Array(J),g,1,5,u,!1,!1,1,1),U._randomTexture2.name="GPUParticleSystem_random2",U._randomTexture2.wrapU=1,U._randomTexture2.wrapV=1,U._randomTextureSize=g,U}return(0,p.m)(v,w),Object.defineProperty(v,"IsSupported",{get:function(){if(!y.e.LastCreatedEngine)return!1;var w=y.e.LastCreatedEngine.getCaps();return w.supportTransformFeedbacks||w.supportComputeShaders},enumerable:!1,configurable:!0}),v.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(v.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(w){this._activeCount=Math.min(w,this._capacity)},enumerable:!1,configurable:!0}),v.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==Pw.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Pw.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Pw.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)},v.prototype.isStarted=function(){return this._started},v.prototype.isStopped=function(){return this._stopped},v.prototype.isStopping=function(){return!1},v.prototype.getActiveCount=function(){return this._currentActiveCount},v.prototype.start=function(w){var v=this;if(void 0===w&&(w=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";w?setTimeout((function(){v.start(0)}),w):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},v.prototype.stop=function(){this._stopped||(this._stopped=!0)},v.prototype.reset=function(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0},v.prototype.getClassName=function(){return"GPUParticleSystem"},v.prototype.getCustomEffect=function(w){var v,I;return void 0===w&&(w=0),null!==(I=null===(v=this._customWrappers[w])||void 0===v?void 0:v.effect)&&void 0!==I?I:this._customWrappers[0].effect},v.prototype._getCustomDrawWrapper=function(w){var v;return void 0===w&&(w=0),null!==(v=this._customWrappers[w])&&void 0!==v?v:this._customWrappers[0]},v.prototype.setCustomEffect=function(w,v){void 0===v&&(v=0),this._customWrappers[v]=new X.c(this._engine),this._customWrappers[v].effect=w},Object.defineProperty(v.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"vertexShaderName",{get:function(){return"gpuRenderParticles"},enumerable:!1,configurable:!0}),v.prototype._removeGradientAndTexture=function(v,I,P){return w.prototype._removeGradientAndTexture.call(this,v,I,P),this._releaseBuffers(),this},v.prototype.addColorGradient=function(w,v){this._colorGradients||(this._colorGradients=[]);var I=new d(w,v);return this._colorGradients.push(I),this._refreshColorGradient(!0),this._releaseBuffers(),this},v.prototype._refreshColorGradient=function(w){void 0===w&&(w=!1),this._colorGradients&&(w&&this._colorGradients.sort((function(w,v){return w.gradient<v.gradient?-1:w.gradient>v.gradient?1:0})),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))},v.prototype.forceRefreshGradients=function(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()},v.prototype.removeColorGradient=function(w){return this._removeGradientAndTexture(w,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},v.prototype.resetDrawCache=function(){var w;for(var v in this._drawWrappers){null===(w=this._drawWrappers[v].drawContext)||void 0===w||w.reset()}},v.prototype._addFactorGradient=function(w,v,I){var P=new f(v,I);w.push(P),this._releaseBuffers()},v.prototype.addSizeGradient=function(w,v){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,w,v),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this},v.prototype.removeSizeGradient=function(w){return this._removeGradientAndTexture(w,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},v.prototype._refreshFactorGradient=function(w,v,I){if(void 0===I&&(I=!1),w){I&&w.sort((function(w,v){return w.gradient<v.gradient?-1:w.gradient>v.gradient?1:0}));var P=this;P[v]&&(P[v].dispose(),P[v]=null)}},v.prototype.addAngularSpeedGradient=function(w,v){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,w,v),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this},v.prototype.removeAngularSpeedGradient=function(w){return this._removeGradientAndTexture(w,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},v.prototype.addVelocityGradient=function(w,v){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,w,v),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this},v.prototype.removeVelocityGradient=function(w){return this._removeGradientAndTexture(w,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},v.prototype.addLimitVelocityGradient=function(w,v){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,w,v),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this},v.prototype.removeLimitVelocityGradient=function(w){return this._removeGradientAndTexture(w,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},v.prototype.addDragGradient=function(w,v){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,w,v),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this},v.prototype.removeDragGradient=function(w){return this._removeGradientAndTexture(w,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},v.prototype.addEmitRateGradient=function(){return this},v.prototype.removeEmitRateGradient=function(){return this},v.prototype.addStartSizeGradient=function(){return this},v.prototype.removeStartSizeGradient=function(){return this},v.prototype.addColorRemapGradient=function(){return this},v.prototype.removeColorRemapGradient=function(){return this},v.prototype.addAlphaRemapGradient=function(){return this},v.prototype.removeAlphaRemapGradient=function(){return this},v.prototype.addRampGradient=function(){return this},v.prototype.removeRampGradient=function(){return this},v.prototype.getRampGradients=function(){return null},Object.defineProperty(v.prototype,"useRampGradients",{get:function(){return!1},set:function(w){},enumerable:!1,configurable:!0}),v.prototype.addLifeTimeGradient=function(){return this},v.prototype.removeLifeTimeGradient=function(){return this},v.prototype._reset=function(){this._releaseBuffers()},v.prototype._createVertexBuffers=function(w,v,I){var P={};P.position=v.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var u=3;P.age=v.createVertexBuffer("age",u,1,this._attributesStrideSize,!0),u+=1,P.size=v.createVertexBuffer("size",u,3,this._attributesStrideSize,!0),u+=3,P.life=v.createVertexBuffer("life",u,1,this._attributesStrideSize,!0),u+=1,u+=4,this.billboardMode===Pw.BILLBOARDMODE_STRETCHED&&(P.direction=v.createVertexBuffer("direction",u,3,this._attributesStrideSize,!0)),u+=3,this._platform.alignDataInBuffer&&(u+=1),this.particleEmitterType instanceof x&&(u+=3,this._platform.alignDataInBuffer&&(u+=1)),this._colorGradientsTexture||(P.color=v.createVertexBuffer("color",u,4,this._attributesStrideSize,!0),u+=4),this._isBillboardBased||(P.initialDirection=v.createVertexBuffer("initialDirection",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1)),this.noiseTexture&&(P.noiseCoordinates1=v.createVertexBuffer("noiseCoordinates1",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1),P.noiseCoordinates2=v.createVertexBuffer("noiseCoordinates2",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1)),P.angle=v.createVertexBuffer("angle",u,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?u++:u+=2,this._isAnimationSheetEnabled&&(P.cellIndex=v.createVertexBuffer("cellIndex",u,1,this._attributesStrideSize,!0),u+=1,this.spriteRandomStartCell&&(P.cellStartOffset=v.createVertexBuffer("cellStartOffset",u,1,this._attributesStrideSize,!0),u+=1)),P.offset=I.createVertexBuffer("offset",0,2),P.uv=I.createVertexBuffer("uv",2,2),this._platform.createVertexBuffers(w,P),this.resetDrawCache()},v.prototype._initialize=function(w){if(void 0===w&&(w=!1),!this._buffer0||w){var v=this._engine,I=new Array;this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof x&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));for(var u=this.particleEmitterType instanceof x,Q=P.i.Vector3[0],K=0,a=0;a<this._capacity;a++)if(I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(0),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),u?(this.particleEmitterType.particleDestinationGenerator(a,null,Q),I.push(Q.x),I.push(Q.y),I.push(Q.z)):(I.push(0),I.push(0),I.push(0)),this._platform.alignDataInBuffer&&I.push(0),K+=16,u&&(this.particleEmitterType.particlePositionGenerator(a,null,Q),I.push(Q.x),I.push(Q.y),I.push(Q.z),this._platform.alignDataInBuffer&&I.push(0),K+=4),this._colorGradientsTexture||(I.push(0),I.push(0),I.push(0),I.push(0),K+=4),this.isBillboardBased||(I.push(0),I.push(0),I.push(0),this._platform.alignDataInBuffer&&I.push(0),K+=4),this.noiseTexture&&(I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),this._platform.alignDataInBuffer&&I.push(0),I.push(Math.random()),I.push(Math.random()),I.push(Math.random()),this._platform.alignDataInBuffer&&I.push(0),K+=8),I.push(0),K+=1,this._angularSpeedGradientsTexture||(I.push(0),K+=1),this._isAnimationSheetEnabled&&(I.push(0),K+=1,this.spriteRandomStartCell&&(I.push(0),K+=1)),this._platform.alignDataInBuffer){var U=3-(K+3&3);for(K+=U;U-->0;)I.push(0)}var p=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),r=this._platform.createParticleBuffer(I),Y=this._platform.createParticleBuffer(I);this._buffer0=new j.c(v,r,!1,this._attributesStrideSize),this._buffer1=new j.c(v,Y,!1,this._attributesStrideSize),this._spriteBuffer=new j.c(v,p,!1,4),this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},v.prototype._recreateUpdateEffect=function(){var w=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(w+="\n#define BILLBOARD"),this._colorGradientsTexture&&(w+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(w+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(w+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(w+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(w+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(w+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(w+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(w+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(w+="\n#define NOISE"),this.isLocal&&(w+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===w||(this._cachedUpdateDefines=w,this._updateBuffer=this._platform.createUpdateBuffer(w))},v.prototype._getWrapper=function(w){var v=this._getCustomDrawWrapper(w);if(null===v||void 0===v?void 0:v.effect)return v;var I=[];this.fillDefines(I,w);var P=this._drawWrappers[w];P||((P=new X.c(this._engine)).drawContext&&(P.drawContext.useInstancing=!0),this._drawWrappers[w]=P);var u=I.join("\n");if(P.defines!==u){var Q=[],K=[],a=[];this.fillUniformsAttributesAndSamplerNames(K,Q,a),P.setEffect(this._engine.createEffect("gpuRenderParticles",Q,K,a,u),u)}return P},v._GetAttributeNamesOrOptions=function(w,v,I,P){void 0===w&&(w=!1),void 0===v&&(v=!1),void 0===I&&(I=!1),void 0===P&&(P=!1);var u=[j.f.PositionKind,"age","life","size","angle"];return w||u.push(j.f.ColorKind),v&&u.push("cellIndex"),I||u.push("initialDirection"),P||u.push("direction"),u.push("offset",j.f.UVKind),u},v._GetEffectCreationOptions=function(w){void 0===w&&(w=!1);var v=["emitterWM","worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","translationPivot","eyePosition"];return w&&v.push("sheetInfos"),v},v.prototype.fillDefines=function(w,v){if(void 0===v&&(v=0),this._scene&&(this._scene.clipPlane&&w.push("#define CLIPPLANE"),this._scene.clipPlane2&&w.push("#define CLIPPLANE2"),this._scene.clipPlane3&&w.push("#define CLIPPLANE3"),this._scene.clipPlane4&&w.push("#define CLIPPLANE4"),this._scene.clipPlane5&&w.push("#define CLIPPLANE5"),this._scene.clipPlane6&&w.push("#define CLIPPLANE6")),v===Pw.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this.isLocal&&w.push("#define LOCAL"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case Pw.BILLBOARDMODE_Y:w.push("#define BILLBOARDY");break;case Pw.BILLBOARDMODE_STRETCHED:w.push("#define BILLBOARDSTRETCHED");break;case Pw.BILLBOARDMODE_ALL:w.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&w.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(""+this._imageProcessingConfigurationDefines.toString()))},v.prototype.fillUniformsAttributesAndSamplerNames=function(w,I,P){I.push.apply(I,v._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Pw.BILLBOARDMODE_STRETCHED)),w.push.apply(w,v._GetEffectCreationOptions(this._isAnimationSheetEnabled)),P.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(u.e.PrepareUniforms(w,this._imageProcessingConfigurationDefines),u.e.PrepareSamplers(P,this._imageProcessingConfigurationDefines))},v.prototype.animate=function(w){var v;void 0===w&&(w=!1),this._timeDelta=this.updateSpeed*(w?this.preWarmStepOffset:(null===(v=this._scene)||void 0===v?void 0:v.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},v.prototype._createFactorGradientTexture=function(w,v){var I=this[v];if(w&&w.length&&!I){for(var P=new Float32Array(this._rawTextureWidth),u=function(v){var I=v/Q._rawTextureWidth;b.GetCurrentGradient(I,w,(function(w,I,u){P[v]=K.b.Lerp(w.factor1,I.factor1,u)}))},Q=this,a=0;a<this._rawTextureWidth;a++)u(a);this[v]=C.b.CreateRTexture(P,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1)}},v.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},v.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},v.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},v.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},v.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},v.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var w=new Uint8Array(4*this._rawTextureWidth),v=B.g.Color4[0],I=function(I){var u=I/P._rawTextureWidth;b.GetCurrentGradient(u,P._colorGradients,(function(P,u,Q){B.f.LerpToRef(P.color1,u.color1,Q,v),w[4*I]=255*v.r,w[4*I+1]=255*v.g,w[4*I+2]=255*v.b,w[4*I+3]=255*v.a}))},P=this,u=0;u<this._rawTextureWidth;u++)I(u);this._colorGradientsTexture=C.b.CreateRGBATexture(w,this._rawTextureWidth,1,this._scene,!1,!1,1)}},v.prototype._render=function(w,v){var I,u,Q=this._getWrapper(w),K=Q.effect;this._engine.enableEffect(Q);var a=(null===(I=this._scene)||void 0===I?void 0:I.getViewMatrix())||P.e.IdentityReadOnly;if(K.setMatrix("view",a),K.setMatrix("projection",null!==(u=this.defaultProjectionMatrix)&&void 0!==u?u:this._scene.getProjectionMatrix()),K.setTexture("diffuseSampler",this.particleTexture),K.setVector2("translationPivot",this.translationPivot),K.setVector3("worldOffset",this.worldOffset),this.isLocal&&K.setMatrix("emitterWM",v),this._colorGradientsTexture?K.setTexture("colorGradientSampler",this._colorGradientsTexture):K.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var U=this.particleTexture.getBaseSize();K.setFloat3("sheetInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,U.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){var p=this._scene.activeCamera;K.setVector3("eyePosition",p.globalPosition)}var r=K.defines;if(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&uw.e.BindClipPlane(K,this._scene),r.indexOf("#define BILLBOARDMODE_ALL")>=0){var Y=a.clone();Y.invert(),K.setMatrix("invView",Y)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(K),w){case Pw.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case Pw.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case Pw.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case Pw.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,K),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(K),this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),this._currentActiveCount},v.prototype.render=function(w,v){if(void 0===w&&(w=!1),void 0===v&&(v=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),!this.isReady())return 0;if(!w&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(var I=0;I<this.preWarmCycles;I++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getFrameId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var u=0|this._accumulatedCount;this._accumulatedCount-=u,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+u)}if(!this._currentActiveCount)return 0;var Q;if(this.emitter.position){Q=this.emitter.getWorldMatrix()}else{var K=this.emitter;Q=P.e.Translation(K.x,K.y,K.z)}var a=this._engine;this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",Q),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount);var U=0;w||v||(a.setState(!1),this.forceDepthWrite&&a.setDepthWrite(!0),U=this.blendMode===Pw.BLENDMODE_MULTIPLYADD?this._render(Pw.BLENDMODE_MULTIPLY,Q)+this._render(Pw.BLENDMODE_ADD,Q):this._render(this.blendMode,Q),this._engine.setAlphaMode(0)),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var p=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=p,U},v.prototype.rebuild=function(){this._initialize(!0)},v.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()},v.prototype.dispose=function(w){for(var v in void 0===w&&(w=!0),this._drawWrappers){this._drawWrappers[v].dispose()}if(this._drawWrappers={},this._scene){var I=this._scene.particleSystems.indexOf(this);I>-1&&this._scene.particleSystems.splice(I,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),w&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),w&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},v.prototype.clone=function(w,I){var P=(0,p.d)({},this._customWrappers),u=null,Q=this._engine;if(Q.createEffectForParticles&&null!=this.customShader){var K=(u=this.customShader).shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"";P[0]=Q.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,K,void 0,void 0,void 0,this)}var a=this.serialize(),U=v.Parse(a,this._scene||this._engine,this._rootUrl);return U.name=w,U.customShader=u,U._customWrappers=P,void 0===I&&(I=this.emitter),this.noiseTexture&&(U.noiseTexture=this.noiseTexture.clone()),U.emitter=I,U},v.prototype.serialize=function(w){void 0===w&&(w=!1);var v={};return Pw._Serialize(v,this,w),v.activeParticleCount=this.activeParticleCount,v.randomTextureSize=this._randomTextureSize,v.customShader=this.customShader,v},v.Parse=function(w,I,P,u,Q){void 0===u&&(u=!1);var K,a=w.name;K=I instanceof N.d?I:I.getEngine();var U=new v(a,{capacity:Q||w.capacity,randomTextureSize:w.randomTextureSize},I,null,w.isAnimationSheetEnabled);if(U._rootUrl=P,w.customShader&&K.createEffectForParticles){var p=w.customShader,r=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"",Y=K.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,r,void 0,void 0,void 0,U);U.setCustomEffect(Y,0),U.customShader=p}return w.id&&(U.id=w.id),w.activeParticleCount&&(U.activeParticleCount=w.activeParticleCount),Pw._Parse(w,U,I,P),w.preventAutoStart&&(U.preventAutoStart=w.preventAutoStart),u||U.preventAutoStart||U.start(),U},v}(t),rw=I(9217),Yw=I(71898),gw=I(87683),Jw=function(){function w(){this._emitterNodeIsOwned=!0,this.systems=new Array}return Object.defineProperty(w.prototype,"emitterNode",{get:function(){return this._emitterNode},set:function(w){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(var v=0,I=this.systems;v<I.length;v++){I[v].emitter=w}this._emitterNode=w},enumerable:!1,configurable:!0}),w.prototype.setEmitterAsSphere=function(w,v,I){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:w,renderingGroupId:v};var P=(0,Yw.c)("emitterSphere",{diameter:w.diameter,segments:w.segments},I);P.renderingGroupId=v;var u=new gw.b("emitterSphereMaterial",I);u.emissiveColor=w.color,P.material=u;for(var Q=0,K=this.systems;Q<K.length;Q++){K[Q].emitter=P}this._emitterNode=P},w.prototype.start=function(w){for(var v=0,I=this.systems;v<I.length;v++){var P=I[v];w&&(P.emitter=w),P.start()}},w.prototype.dispose=function(){for(var w=0,v=this.systems;w<v.length;w++){v[w].dispose()}this.systems=[],this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)},w.prototype.serialize=function(w){void 0===w&&(w=!1);for(var v={systems:[]},I=0,P=this.systems;I<P.length;I++){var u=P[I];v.systems.push(u.serialize(w))}return this._emitterNode&&(v.emitter=this._emitterCreationOptions),v},w.Parse=function(v,I,P,u){void 0===P&&(P=!1);var Q=new w,K=this.BaseAssetsUrl+"/textures/";I=I||y.e.LastCreatedScene;for(var a=0,U=v.systems;a<U.length;a++){var p=U[a];Q.systems.push(P?pw.Parse(p,I,K,!0,u):Pw.Parse(p,I,K,!0,u))}if(v.emitter){var r=v.emitter.options;if("Sphere"===v.emitter.kind)Q.setEmitterAsSphere({diameter:r.diameter,segments:r.segments,color:B.b.FromArray(r.color)},v.emitter.renderingGroupId,I)}return Q},w.BaseAssetsUrl="https://assets.babylonjs.com/particles",w}(),lw=I(67935),Rw=(function(){function w(){}w.CreateDefault=function(w,v,I,P){var u;return void 0===v&&(v=500),void 0===P&&(P=!1),(u=P?new pw("default system",{capacity:v},I):new Pw("default system",v,I)).emitter=w,u.particleTexture=new q.e("https://assets.babylonjs.com/textures/flare.png",u.getScene()),u.createConeEmitter(.1,Math.PI/4),u.color1=new B.f(1,1,1,1),u.color2=new B.f(1,1,1,1),u.colorDead=new B.f(1,1,1,0),u.minSize=.1,u.maxSize=.1,u.minEmitPower=2,u.maxEmitPower=2,u.updateSpeed=1/60,u.emitRate=30,u},w.CreateAsync=function(v,I,P,u){void 0===P&&(P=!1),I||(I=y.e.LastCreatedScene);var Q={};return I._addPendingData(Q),new Promise((function(K,a){if(P&&!pw.IsSupported)return I._removePendingData(Q),a("Particle system with GPU is not supported.");rw.i.LoadFile("".concat(w.BaseAssetsUrl,"/systems/").concat(v,".json"),(function(w){I._removePendingData(Q);var v=JSON.parse(w.toString());return K(Jw.Parse(v,I,P,u))}),void 0,void 0,void 0,(function(){return I._removePendingData(Q),a("An error occurred with the creation of your particle system. Check if your type '".concat(v,"' exists."))}))}))},w.ExportSet=function(w){for(var v=new Jw,I=0,P=w;I<P.length;I++){var u=P[I];v.systems.push(u)}return v},w.ParseFromFileAsync=function(w,v,I,P,u,Q){return void 0===P&&(P=!1),void 0===u&&(u=""),new Promise((function(K,a){var U=new lw.b;U.addEventListener("readystatechange",(function(){if(4==U.readyState)if(200==U.status){var v=JSON.parse(U.responseText),p=void 0;p=P?pw.Parse(v,I,u,!1,Q):Pw.Parse(v,I,u,!1,Q),w&&(p.name=w),K(p)}else a("Unable to load the particle system")})),U.open("GET",v),U.send()}))},w.CreateFromSnippetAsync=function(w,v,I,P,u){var Q=this;if(void 0===I&&(I=!1),void 0===P&&(P=""),"_BLANK"===w){var K=this.CreateDefault(null);return K.start(),Promise.resolve(K)}return new Promise((function(K,a){var U=new lw.b;U.addEventListener("readystatechange",(function(){if(4==U.readyState)if(200==U.status){var Q=JSON.parse(JSON.parse(U.responseText).jsonPayload),p=JSON.parse(Q.particleSystem),r=void 0;(r=I?pw.Parse(p,v,P,!1,u):Pw.Parse(p,v,P,!1,u)).snippetId=w,K(r)}else a("Unable to load the snippet "+w)})),U.open("GET",Q.SnippetUrl+"/"+w.replace(/#/g,"/")),U.send()}))},w.BaseAssetsUrl=Jw.BaseAssetsUrl,w.SnippetUrl="https://snippet.babylonjs.com"}(),I(65847)),xw=I(60569),jw=I(90690),sw=I(21693);xw.b.AddParser(sw.c.NAME_PARTICLESYSTEM,(function(w,v,I,P){var u=xw.b.GetIndividualParser(sw.c.NAME_PARTICLESYSTEM);if(u&&void 0!==w.particleSystems&&null!==w.particleSystems)for(var Q=0,K=w.particleSystems.length;Q<K;Q++){var a=w.particleSystems[Q];I.particleSystems.push(u(a,v,P))}})),xw.b.AddIndividualParser(sw.c.NAME_PARTICLESYSTEM,(function(w,v,I){return w.activeParticleCount?pw.Parse(w,v,I):Pw.Parse(w,v,I)})),jw.d.prototype.createEffectForParticles=function(w,v,I,P,u,Q,K,a){var U;void 0===v&&(v=[]),void 0===I&&(I=[]),void 0===P&&(P="");var p=[],r=[],Y=[];return a?a.fillUniformsAttributesAndSamplerNames(r,p,Y):(p=Pw._GetAttributeNamesOrOptions(),r=Pw._GetEffectCreationOptions()),-1===P.indexOf(" BILLBOARD")&&(P+="\n#define BILLBOARD\n"),-1===I.indexOf("diffuseSampler")&&I.push("diffuseSampler"),this.createEffect({vertex:null!==(U=null===a||void 0===a?void 0:a.vertexShaderName)&&void 0!==U?U:"particles",fragmentElement:w},p,r.concat(v),Y.concat(I),P,u,Q,K)},Rw.b.prototype.getEmittedParticleSystems=function(){for(var w=new Array,v=0;v<this.getScene().particleSystems.length;v++){var I=this.getScene().particleSystems[v];I.emitter===this&&w.push(I)}return w},Rw.b.prototype.getHierarchyEmittedParticleSystems=function(){var w=new Array,v=this.getDescendants();v.push(this);for(var I=0;I<this.getScene().particleSystems.length;I++){var P=this.getScene().particleSystems[I],u=P.emitter;u.position&&-1!==v.indexOf(u)&&w.push(P)}return w};var Bw,tw=I(97918),iw=I(70176),zw=I(52644),Ew=function(){function w(w,v,I,u,Q,K,a,U,p,r){void 0===p&&(p=null),void 0===r&&(r=null),this.idx=0,this.id=0,this.color=new B.f(1,1,1,1),this.position=P.l.Zero(),this.rotation=P.l.Zero(),this.scaling=P.l.One(),this.uvs=new P.p(0,0,1,1),this.velocity=P.l.Zero(),this.pivot=P.l.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.props=null,this.cullingStrategy=zw.b.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=P.l.Zero(),this.idx=w,this.id=v,this._pos=I,this._ind=u,this._model=Q,this.shapeId=K,this.idxInShape=a,this._sps=U,p&&(this._modelBoundingInfo=p,this._boundingInfo=new tw.e(p.minimum,p.maximum)),null!==r&&(this.materialIndex=r)}return w.prototype.getBoundingInfo=function(){return this._boundingInfo},Object.defineProperty(w.prototype,"hasBoundingInfo",{get:function(){return null!==this._boundingInfo},enumerable:!1,configurable:!0}),w.prototype.copyToRef=function(w){return w.position.copyFrom(this.position),w.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(w.rotationQuaternion?w.rotationQuaternion.copyFrom(this.rotationQuaternion):w.rotationQuaternion=this.rotationQuaternion.clone()),w.scaling.copyFrom(this.scaling),this.color&&(w.color?w.color.copyFrom(this.color):w.color=this.color.clone()),w.uvs.copyFrom(this.uvs),w.velocity.copyFrom(this.velocity),w.pivot.copyFrom(this.pivot),w.translateFromPivot=this.translateFromPivot,w.alive=this.alive,w.isVisible=this.isVisible,w.parentId=this.parentId,w.cullingStrategy=this.cullingStrategy,null!==this.materialIndex&&(w.materialIndex=this.materialIndex),this},Object.defineProperty(w.prototype,"scale",{get:function(){return this.scaling},set:function(w){this.scaling=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(w){this.rotationQuaternion=w},enumerable:!1,configurable:!0}),w.prototype.intersectsMesh=function(w){return!(!this._boundingInfo||!w.hasBoundingInfo)&&(this._sps._bSphereOnly?iw.d.Intersects(this._boundingInfo.boundingSphere,w.getBoundingInfo().boundingSphere):this._boundingInfo.intersects(w.getBoundingInfo(),!1))},w.prototype.isInFrustum=function(w){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(w,this.cullingStrategy)},w.prototype.getRotationMatrix=function(w){var v;if(this.rotationQuaternion)v=this.rotationQuaternion;else{v=P.i.Quaternion[0];var I=this.rotation;P.f.RotationYawPitchRollToRef(I.y,I.x,I.z,v)}v.toRotationMatrix(w)},w}(),ow=function(){function w(w,v,I,P,u,Q,K,a,U){this._indicesLength=0,this.shapeId=w,this._shape=v,this._indices=I,this._indicesLength=I.length,this._shapeUV=Q,this._shapeColors=u,this._normals=P,this._positionFunction=K,this._vertexFunction=a,this._material=U}return Object.defineProperty(w.prototype,"shapeID",{get:function(){return this.shapeId},set:function(w){this.shapeId=w},enumerable:!1,configurable:!0}),w}(),hw=function(w,v,I,P){this.idx=0,this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.idx=w,this.ind=v,this.indicesLength=I,this.materialIndex=P},nw=function(){function w(){this.position=P.l.Zero(),this.color=new B.f(1,1,1,1),this.uv=P.k.Zero()}return Object.defineProperty(w.prototype,"x",{get:function(){return this.position.x},set:function(w){this.position.x=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"y",{get:function(){return this.position.y},set:function(w){this.position.y=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"z",{get:function(){return this.position.z},set:function(w){this.position.z=w},enumerable:!1,configurable:!0}),w}(),Ww=I(85779),Vw=I(60612),Fw=I(54044),Ow=I(50384),Nw=I(49443),qw=(function(){function w(w,v,I){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new Ew(0,0,0,0,null,0,0,this),this._color=new B.f(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(w,v){return v.sqDistance-w.sqDistance},this._materialSortFunction=function(w,v){return w.materialIndex-v.materialIndex},this._autoUpdateSubMeshes=!1,this.name=w,this._scene=v||y.e.LastCreatedScene,this._camera=v.activeCamera,this._pickable=!!I&&I.isPickable,this._depthSort=!!I&&I.enableDepthSort,this._multimaterialEnabled=!!I&&I.enableMultiMaterial,this._useModelMaterial=!!I&&I.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!I&&I.expandable,this._particlesIntersect=!!I&&I.particleIntersection,this._bSphereOnly=!!I&&I.boundingSphereOnly,this._bSphereRadiusFactor=I&&I.bSphereRadiusFactor?I.bSphereRadiusFactor:1,I&&void 0!==I.updatable?this._updatable=I.updatable:this._updatable=!0,this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new Nw.b(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={}),this._tmpVertex=new nw}w.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){var w=(0,Vw.e)("",{radius:1,tessellation:3},this._scene);this.addShape(w,1),w.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var v=new Rw.b(this.name,this._scene);this.mesh=v}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&Ww.b.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var I=new Ww.b;if(I.indices=this._depthSort?this._indices:this._indices32,I.set(this._positions32,j.f.PositionKind),I.set(this._normals32,j.f.NormalKind),this._uvs32.length>0&&I.set(this._uvs32,j.f.UVKind),this._colors32.length>0&&I.set(this._colors32,j.f.ColorKind),I.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._pickable)for(var P=0,u=0;u<this.nbParticles;u++)for(var Q=this.particles[u],K=Q._model._indicesLength,a=0;a<K;a++){if(0==a%3){var U={idx:Q.idx,faceId:P};this.pickedParticles[P]=U,P++}}return this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},w.prototype.digest=function(w,v){var I=v&&v.facetNb||1,u=v&&v.number||0,Q=v&&v.delta||0,K=w.getVerticesData(j.f.PositionKind),a=w.getIndices(),U=w.getVerticesData(j.f.UVKind),p=w.getVerticesData(j.f.ColorKind),r=w.getVerticesData(j.f.NormalKind),Y=v&&v.storage?v.storage:null,g=0,J=a.length/3;u?(u=u>J?J:u,I=Math.round(J/u),Q=0):I=I>J?J:I;for(var l=[],R=[],x=[],s=[],B=[],t=P.l.Zero(),i=I;g<J;){g>J-(I=i+Math.floor((1+Q)*Math.random()))&&(I=J-g),l.length=0,R.length=0,x.length=0,s.length=0,B.length=0;for(var z=0,E=3*g;E<3*(g+I);E++){x.push(z);var o=a[E],h=3*o;if(l.push(K[h],K[h+1],K[h+2]),R.push(r[h],r[h+1],r[h+2]),U){var n=2*o;s.push(U[n],U[n+1])}if(p){var W=4*o;B.push(p[W],p[W+1],p[W+2],p[W+3])}z++}var V=this.nbParticles,F=this._posToShape(l),O=this._uvsToShapeUV(s),N=x.slice(),q=B.slice(),m=R.slice();t.copyFromFloats(0,0,0);var c=void 0;for(c=0;c<F.length;c++)t.addInPlace(F[c]);t.scaleInPlace(1/F.length);var M=new P.l(1/0,1/0,1/0),S=new P.l(-1/0,-1/0,-1/0);for(c=0;c<F.length;c++)F[c].subtractInPlace(t),M.minimizeInPlaceFromFloats(F[c].x,F[c].y,F[c].z),S.maximizeInPlaceFromFloats(F[c].x,F[c].y,F[c].z);var e=void 0;this._particlesIntersect&&(e=new tw.e(M,S));var H=null;this._useModelMaterial&&(H=w.material?w.material:this._setDefaultMaterial());var G=new ow(this._shapeCounter,F,N,m,q,O,null,null,H),L=this._positions.length,d=this._indices.length;this._meshBuilder(this._index,d,F,this._positions,N,this._indices,s,this._uvs,q,this._colors,m,this._normals,V,0,null,G),this._addParticle(V,this._lastParticleId,L,d,G,this._shapeCounter,0,e,Y),this.particles[this.nbParticles].position.addInPlace(t),Y||(this._index+=F.length,V++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,g+=I}return this._isNotBuilt=!0,this},w.prototype._unrotateFixedNormals=function(){for(var w=0,v=0,I=P.i.Vector3[0],u=P.i.Quaternion[0],Q=P.i.Matrix[0],K=0;K<this.particles.length;K++){var a=this.particles[K],U=a._model._shape;if(a.rotationQuaternion)a.rotationQuaternion.conjugateToRef(u);else{var p=a.rotation;P.f.RotationYawPitchRollToRef(p.y,p.x,p.z,u),u.conjugateInPlace()}u.toRotationMatrix(Q);for(var r=0;r<U.length;r++)v=w+3*r,P.l.TransformNormalFromFloatsToRef(this._normals32[v],this._normals32[v+1],this._normals32[v+2],Q,I),I.toArray(this._fixedNormal32,v);w=v+3}},w.prototype._resetCopy=function(){var w=this._copy;w.position.setAll(0),w.rotation.setAll(0),w.rotationQuaternion=null,w.scaling.setAll(1),w.uvs.copyFromFloats(0,0,1,1),w.color=null,w.translateFromPivot=!1,w.shapeId=0,w.materialIndex=null},w.prototype._meshBuilder=function(w,v,I,u,Q,K,a,U,p,r,Y,g,J,l,R,x){var j,s=0,B=0,t=0;this._resetCopy();var i=this._copy,z=!(!R||!R.storage);if(i.idx=J,i.idxInShape=l,i.shapeId=x.shapeId,this._useModelMaterial){var E=x._material.uniqueId,o=this._materialIndexesById;Object.prototype.hasOwnProperty.call(o,E)||(o[E]=this._materials.length,this._materials.push(x._material));var h=o[E];i.materialIndex=h}if(R&&R.positionFunction&&(R.positionFunction(i,J,l),this._mustUnrotateFixedNormals=!0),z)return i;var n=P.i.Matrix[0],W=this._tmpVertex,V=W.position,F=W.color,O=W.uv,N=P.i.Vector3[1],q=P.i.Vector3[2],m=P.i.Vector3[3];P.e.IdentityToRef(n),i.getRotationMatrix(n),i.pivot.multiplyToRef(i.scaling,m),i.translateFromPivot?q.setAll(0):q.copyFrom(m);var c=R&&R.vertexFunction;for(j=0;j<I.length;j++){if(V.copyFrom(I[j]),i.color&&F.copyFrom(i.color),a&&O.copyFromFloats(a[s],a[s+1]),c&&R.vertexFunction(i,W,j),V.multiplyInPlace(i.scaling).subtractInPlace(m),P.l.TransformCoordinatesToRef(V,n,N),N.addInPlace(q).addInPlace(i.position),u.push(N.x,N.y,N.z),a){var M=i.uvs;U.push((M.z-M.x)*O.x+M.x,(M.w-M.y)*O.y+M.y),s+=2}if(i.color)this._color.copyFrom(F);else{var S=this._color;p&&void 0!==p[B]?(S.r=p[B],S.g=p[B+1],S.b=p[B+2],S.a=p[B+3]):(S.r=1,S.g=1,S.b=1,S.a=1)}r.push(this._color.r,this._color.g,this._color.b,this._color.a),B+=4,!this.recomputeNormals&&Y&&(P.l.TransformNormalFromFloatsToRef(Y[t],Y[t+1],Y[t+2],n,V),g.push(V.x,V.y,V.z),t+=3)}for(j=0;j<Q.length;j++){var e=w+Q[j];K.push(e),e>65535&&(this._needs32Bits=!0)}if(this._depthSort||this._multimaterialEnabled){var H=null!==i.materialIndex?i.materialIndex:0;this.depthSortedParticles.push(new hw(J,v,Q.length,H))}return i},w.prototype._posToShape=function(w){for(var v=[],I=0;I<w.length;I+=3)v.push(P.l.FromArray(w,I));return v},w.prototype._uvsToShapeUV=function(w){var v=[];if(w)for(var I=0;I<w.length;I++)v.push(w[I]);return v},w.prototype._addParticle=function(w,v,I,P,u,Q,K,a,U){void 0===a&&(a=null),void 0===U&&(U=null);var p=new Ew(w,v,I,P,u,Q,K,this,a);return(U||this.particles).push(p),p},w.prototype.addShape=function(w,v,I){var P=w.getVerticesData(j.f.PositionKind),u=w.getIndices(),Q=w.getVerticesData(j.f.UVKind),K=w.getVerticesData(j.f.ColorKind),a=w.getVerticesData(j.f.NormalKind);this.recomputeNormals=!a;var U=Array.from(u),p=Array.from(a),r=K?Array.from(K):[],Y=I&&I.storage?I.storage:null,g=null;this._particlesIntersect&&(g=w.getBoundingInfo());var J=this._posToShape(P),l=this._uvsToShapeUV(Q),R=I?I.positionFunction:null,x=I?I.vertexFunction:null,s=null;this._useModelMaterial&&(s=w.material?w.material:this._setDefaultMaterial());for(var B=new ow(this._shapeCounter,J,U,p,r,l,R,x,s),t=0;t<v;t++)this._insertNewParticle(this.nbParticles,t,B,J,u,Q,K,a,g,Y,I);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},w.prototype._rebuildParticle=function(w,v){void 0===v&&(v=!1),this._resetCopy();var I=this._copy;w._model._positionFunction&&w._model._positionFunction(I,w.idx,w.idxInShape);var u=P.i.Matrix[0],Q=P.i.Vector3[0],K=P.i.Vector3[1],a=P.i.Vector3[2],U=P.i.Vector3[3];I.getRotationMatrix(u),w.pivot.multiplyToRef(w.scaling,U),I.translateFromPivot?a.copyFromFloats(0,0,0):a.copyFrom(U);for(var p=w._model._shape,r=0;r<p.length;r++)Q.copyFrom(p[r]),w._model._vertexFunction&&w._model._vertexFunction(I,Q,r),Q.multiplyInPlace(I.scaling).subtractInPlace(U),P.l.TransformCoordinatesToRef(Q,u,K),K.addInPlace(a).addInPlace(I.position).toArray(this._positions32,w._pos+3*r);v&&(w.position.setAll(0),w.rotation.setAll(0),w.rotationQuaternion=null,w.scaling.setAll(1),w.uvs.setAll(0),w.pivot.setAll(0),w.translateFromPivot=!1,w.parentId=null)},w.prototype.rebuildMesh=function(w){void 0===w&&(w=!1);for(var v=0;v<this.particles.length;v++)this._rebuildParticle(this.particles[v],w);return this.mesh.updateVerticesData(j.f.PositionKind,this._positions32,!1,!1),this},w.prototype.removeParticles=function(w,v){var I=v-w+1;if(!this._expandable||I<=0||I>=this.nbParticles||!this._updatable)return[];var P=this.particles,u=this.nbParticles;if(v<u-1)for(var Q=v+1,K=P[Q]._pos-P[w]._pos,a=P[Q]._ind-P[w]._ind,U=Q;U<u;U++){var p=P[U];p._pos-=K,p._ind-=a}var r=P.splice(w,I);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var Y=0,g=P.length,J=0;J<g;J++){var l=P[J],R=l._model,x=R._shape,j=R._indices,s=R._normals,B=R._shapeColors,t=R._shapeUV;l.idx=J,this._idxOfId[l.id]=J,this._meshBuilder(this._index,Y,x,this._positions,j,this._indices,t,this._uvs,B,this._colors,s,this._normals,l.idx,l.idxInShape,null,R),this._index+=x.length,Y+=j.length}return this.nbParticles-=I,this._isNotBuilt=!0,r},w.prototype.insertParticlesFromArray=function(w){if(!this._expandable)return this;for(var v=0,I=w[0].shapeId,P=w.length,u=0;u<P;u++){var Q=w[u],K=Q._model,a=K._shape,U=K._indices,p=K._shapeUV,r=K._shapeColors,Y=K._normals,g=!Y;this.recomputeNormals=g||this.recomputeNormals;var J=Q.getBoundingInfo(),l=this._insertNewParticle(this.nbParticles,v,K,a,U,p,r,Y,J,null,null);Q.copyToRef(l),v++,I!=Q.shapeId&&(I=Q.shapeId,v=0)}return this._isNotBuilt=!0,this},w.prototype._insertNewParticle=function(w,v,I,P,u,Q,K,a,U,p,r){var Y=this._positions.length,g=this._indices.length,J=this._meshBuilder(this._index,g,P,this._positions,u,this._indices,Q,this._uvs,K,this._colors,a,this._normals,w,v,r,I),l=null;return this._updatable&&((l=this._addParticle(this.nbParticles,this._lastParticleId,Y,g,I,this._shapeCounter,v,U,p)).position.copyFrom(J.position),l.rotation.copyFrom(J.rotation),J.rotationQuaternion&&(l.rotationQuaternion?l.rotationQuaternion.copyFrom(J.rotationQuaternion):l.rotationQuaternion=J.rotationQuaternion.clone()),J.color&&(l.color?l.color.copyFrom(J.color):l.color=J.color.clone()),l.scaling.copyFrom(J.scaling),l.uvs.copyFrom(J.uvs),null!==J.materialIndex&&(l.materialIndex=J.materialIndex),this.expandable&&(this._idxOfId[l.id]=l.idx)),p||(this._index+=P.length,this.nbParticles++,this._lastParticleId++),l},w.prototype.setParticles=function(w,v,I){if(void 0===w&&(w=0),void 0===v&&(v=this.nbParticles-1),void 0===I&&(I=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(w,v,I);var u=P.i.Matrix[0],Q=P.i.Matrix[1],K=this.mesh,a=this._colors32,U=this._positions32,p=this._normals32,r=this._uvs32,Y=this._indices32,g=this._indices,J=this._fixedNormal32,l=P.i.Vector3,R=l[5].copyFromFloats(1,0,0),x=l[6].copyFromFloats(0,1,0),s=l[7].copyFromFloats(0,0,1),B=l[8].setAll(Number.MAX_VALUE),t=l[9].setAll(-Number.MAX_VALUE),i=l[10].setAll(0),z=this._tmpVertex,E=z.position,o=z.color,h=z.uv;if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(Q)),this.billboard){var n=l[0];this._camera.getDirectionToRef(Fw.c.Z,n),P.l.TransformNormalToRef(n,Q,s),s.normalize();var W=this._camera.getViewMatrix(!0);P.l.TransformNormalFromFloatsToRef(W.m[1],W.m[5],W.m[9],Q,x),P.l.CrossToRef(x,s,R),x.normalize(),R.normalize()}this._depthSort&&P.l.TransformCoordinatesToRef(this._camera.globalPosition,Q,i),P.e.IdentityToRef(u);var V=0,F=0,O=0,N=0,q=0,m=0,c=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),v=v>=this.nbParticles?this.nbParticles-1:v,this._computeBoundingBox&&(0!=w||v!=this.nbParticles-1)){var M=this.mesh.getBoundingInfo();M&&(B.copyFrom(M.minimum),t.copyFrom(M.maximum))}var S=(F=this.particles[w]._pos)/3|0;N=4*S,m=2*S;for(var e=w;e<=v;e++){var H=this.particles[e];this.updateParticle(H);var G=H._model._shape,L=H._model._shapeUV,d=H._rotationMatrix,D=H.position,f=H.rotation,b=H.scaling,k=H._globalPosition;if(this._depthSort&&this._depthSortParticles){var C=this.depthSortedParticles[e];C.idx=H.idx,C.ind=H._ind,C.indicesLength=H._model._indicesLength,C.sqDistance=P.l.DistanceSquared(H.position,i)}if(!H.alive||H._stillInvisible&&!H.isVisible)F+=3*(c=G.length),N+=4*c,m+=2*c;else{if(H.isVisible){H._stillInvisible=!1;var y=l[12];if(H.pivot.multiplyToRef(b,y),this.billboard&&(f.x=0,f.y=0),(this._computeParticleRotation||this.billboard)&&H.getRotationMatrix(u),null!==H.parentId){var T=this.getParticleById(H.parentId);if(T){var Z=T._rotationMatrix,A=T._globalPosition,X=D.x*Z[1]+D.y*Z[4]+D.z*Z[7],ww=D.x*Z[0]+D.y*Z[3]+D.z*Z[6],vw=D.x*Z[2]+D.y*Z[5]+D.z*Z[8];if(k.x=A.x+ww,k.y=A.y+X,k.z=A.z+vw,this._computeParticleRotation||this.billboard){var Iw=u.m;d[0]=Iw[0]*Z[0]+Iw[1]*Z[3]+Iw[2]*Z[6],d[1]=Iw[0]*Z[1]+Iw[1]*Z[4]+Iw[2]*Z[7],d[2]=Iw[0]*Z[2]+Iw[1]*Z[5]+Iw[2]*Z[8],d[3]=Iw[4]*Z[0]+Iw[5]*Z[3]+Iw[6]*Z[6],d[4]=Iw[4]*Z[1]+Iw[5]*Z[4]+Iw[6]*Z[7],d[5]=Iw[4]*Z[2]+Iw[5]*Z[5]+Iw[6]*Z[8],d[6]=Iw[8]*Z[0]+Iw[9]*Z[3]+Iw[10]*Z[6],d[7]=Iw[8]*Z[1]+Iw[9]*Z[4]+Iw[10]*Z[7],d[8]=Iw[8]*Z[2]+Iw[9]*Z[5]+Iw[10]*Z[8]}}else H.parentId=null}else if(k.x=D.x,k.y=D.y,k.z=D.z,this._computeParticleRotation||this.billboard){Iw=u.m;d[0]=Iw[0],d[1]=Iw[1],d[2]=Iw[2],d[3]=Iw[4],d[4]=Iw[5],d[5]=Iw[6],d[6]=Iw[8],d[7]=Iw[9],d[8]=Iw[10]}var Pw=l[11];for(H.translateFromPivot?Pw.setAll(0):Pw.copyFrom(y),c=0;c<G.length;c++){V=F+3*c,O=N+4*c,q=m+2*c;var uw=2*c,Qw=uw+1;E.copyFrom(G[c]),this._computeParticleColor&&H.color&&o.copyFrom(H.color),this._computeParticleTexture&&h.copyFromFloats(L[uw],L[Qw]),this._computeParticleVertex&&this.updateParticleVertex(H,z,c);var Kw=E.x*b.x-y.x,aw=E.y*b.y-y.y,Uw=E.z*b.z-y.z;ww=Kw*d[0]+aw*d[3]+Uw*d[6],X=Kw*d[1]+aw*d[4]+Uw*d[7],vw=Kw*d[2]+aw*d[5]+Uw*d[8];ww+=Pw.x,X+=Pw.y,vw+=Pw.z;var pw=U[V]=k.x+R.x*ww+x.x*X+s.x*vw,rw=U[V+1]=k.y+R.y*ww+x.y*X+s.y*vw,Yw=U[V+2]=k.z+R.z*ww+x.z*X+s.z*vw;if(this._computeBoundingBox&&(B.minimizeInPlaceFromFloats(pw,rw,Yw),t.maximizeInPlaceFromFloats(pw,rw,Yw)),!this._computeParticleVertex){var gw=J[V],Jw=J[V+1],lw=J[V+2],Rw=gw*d[0]+Jw*d[3]+lw*d[6],xw=gw*d[1]+Jw*d[4]+lw*d[7],jw=gw*d[2]+Jw*d[5]+lw*d[8];p[V]=R.x*Rw+x.x*xw+s.x*jw,p[V+1]=R.y*Rw+x.y*xw+s.y*jw,p[V+2]=R.z*Rw+x.z*xw+s.z*jw}if(this._computeParticleColor&&H.color){var sw=this._colors32;sw[O]=o.r,sw[O+1]=o.g,sw[O+2]=o.b,sw[O+3]=o.a}if(this._computeParticleTexture){var Bw=H.uvs;r[q]=h.x*(Bw.z-Bw.x)+Bw.x,r[q+1]=h.y*(Bw.w-Bw.y)+Bw.y}}}else for(H._stillInvisible=!0,c=0;c<G.length;c++){if(O=N+4*c,q=m+2*c,U[V=F+3*c]=U[V+1]=U[V+2]=0,p[V]=p[V+1]=p[V+2]=0,this._computeParticleColor&&H.color){var tw=H.color;a[O]=tw.r,a[O+1]=tw.g,a[O+2]=tw.b,a[O+3]=tw.a}if(this._computeParticleTexture){Bw=H.uvs;r[q]=L[2*c]*(Bw.z-Bw.x)+Bw.x,r[q+1]=L[2*c+1]*(Bw.w-Bw.y)+Bw.y}}if(this._particlesIntersect){var iw=H.getBoundingInfo(),zw=iw.boundingBox,Ew=iw.boundingSphere,ow=H._modelBoundingInfo;if(!this._bSphereOnly){var hw=ow.boundingBox.vectors,nw=l[1],Vw=l[2];nw.setAll(Number.MAX_VALUE),Vw.setAll(-Number.MAX_VALUE);for(var Ow=0;Ow<8;Ow++){var Nw=hw[Ow].x*b.x,qw=hw[Ow].y*b.y,mw=hw[Ow].z*b.z,cw=(ww=Nw*d[0]+qw*d[3]+mw*d[6],X=Nw*d[1]+qw*d[4]+mw*d[7],vw=Nw*d[2]+qw*d[5]+mw*d[8],D.x+R.x*ww+x.x*X+s.x*vw),Mw=D.y+R.y*ww+x.y*X+s.y*vw,Sw=D.z+R.z*ww+x.z*X+s.z*vw;nw.minimizeInPlaceFromFloats(cw,Mw,Sw),Vw.maximizeInPlaceFromFloats(cw,Mw,Sw)}zw.reConstruct(nw,Vw,K._worldMatrix)}var ew=ow.minimum.multiplyToRef(b,l[1]),Hw=ow.maximum.multiplyToRef(b,l[2]),Gw=Hw.addToRef(ew,l[3]).scaleInPlace(.5).addInPlace(k),Lw=Hw.subtractToRef(ew,l[4]).scaleInPlace(.5*this._bSphereRadiusFactor),dw=Gw.subtractToRef(Lw,l[1]),Dw=Gw.addToRef(Lw,l[2]);Ew.reConstruct(dw,Dw,K._worldMatrix)}F=V+3,N=O+4,m=q+2}}if(I){if(this._computeParticleColor)(Cw=K.getVertexBuffer(j.f.ColorKind))&&!K.isPickable?Cw.updateDirectly(a,0):K.updateVerticesData(j.f.ColorKind,a,!1,!1);if(this._computeParticleTexture)(Cw=K.getVertexBuffer(j.f.UVKind))&&!K.isPickable?Cw.updateDirectly(r,0):K.updateVerticesData(j.f.UVKind,r,!1,!1);var fw=K.getVertexBuffer(j.f.PositionKind);if(fw&&!K.isPickable?fw.updateDirectly(U,0):K.updateVerticesData(j.f.PositionKind,U,!1,!1),!K.areNormalsFrozen||K.isFacetDataEnabled){if(this._computeParticleVertex||K.isFacetDataEnabled){var bw=K.isFacetDataEnabled?K.getFacetDataParameters():null;Ww.b.ComputeNormals(U,Y,p,bw);for(var kw=0;kw<p.length;kw++)J[kw]=p[kw]}var Cw;if(!K.areNormalsFrozen)(Cw=K.getVertexBuffer(j.f.NormalKind))&&!K.isPickable?Cw.updateDirectly(p,0):K.updateVerticesData(j.f.NormalKind,p,!1,!1)}if(this._depthSort&&this._depthSortParticles){var yw=this.depthSortedParticles;yw.sort(this._depthSortFunction);for(var Tw=yw.length,Zw=0,Aw=0,Xw=0;Xw<Tw;Xw++){var wv=yw[Xw],vv=wv.indicesLength,Iv=wv.ind;for(kw=0;kw<vv;kw++){if(Y[Zw]=g[Iv+kw],Zw++,this._pickable)if(0==kw%3){var Pv=this.pickedParticles[Aw];Pv.idx=wv.idx,Pv.faceId=Aw,Aw++}}}K.updateIndices(Y)}}return this._computeBoundingBox&&(K.hasBoundingInfo?K.getBoundingInfo().reConstruct(B,t,K._worldMatrix):K.buildBoundingInfo(B,t,K._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(w,v,I),this},w.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null,this.pickedBySubMesh=null,this._materials=null,this._materialIndexes=null,this._indicesByMaterial=null,this._idxOfId=null},w.prototype.pickedParticle=function(w){if(w.hit){var v=w.subMeshId,I=w.faceId-this.mesh.subMeshes[v].indexStart/3,P=this.pickedBySubMesh;if(P[v]&&P[v][I])return P[v][I]}return null},w.prototype.getParticleById=function(w){var v=this.particles[w];if(v&&v.id==w)return v;var I=this.particles,P=this._idxOfId[w];if(void 0!==P)return I[P];for(var u=0,Q=this.nbParticles;u<Q;){var K=I[u];if(K.id==w)return K;u++}return null},w.prototype.getParticlesByShapeId=function(w){var v=[];return this.getParticlesByShapeIdToRef(w,v),v},w.prototype.getParticlesByShapeIdToRef=function(w,v){v.length=0;for(var I=0;I<this.nbParticles;I++){var P=this.particles[I];P.shapeId==w&&v.push(P)}return this},w.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var w=this.depthSortedParticles;if(this.particles.length>0)for(var v=0;v<this.particles.length;v++){var I=this.particles[v];I.materialIndex||(I.materialIndex=0);var P=w[v];P.materialIndex=I.materialIndex,P.ind=I._ind,P.indicesLength=I._model._indicesLength,P.idx=I.idx}this._sortParticlesByMaterial();var u=this._indicesByMaterial,Q=this._materialIndexes,K=this.mesh;K.subMeshes=[];for(var a=K.getTotalVertices(),U=0;U<Q.length;U++){var p=u[U],r=u[U+1]-p,Y=Q[U];new Ow.c(Y,0,a,p,r,K)}return this},w.prototype._sortParticlesByMaterial=function(){var w=[0];this._indicesByMaterial=w;var v=[];this._materialIndexes=v;var I=this.depthSortedParticles;I.sort(this._materialSortFunction);var P=I.length,u=this._indices32,Q=this._indices,K=0,a=0,U=0,p=I[0].materialIndex;v.push(p),this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(var r=0;r<P;r++){var Y=I[r],g=Y.indicesLength,J=Y.ind;Y.materialIndex!==p&&(p=Y.materialIndex,w.push(U),v.push(p),this._pickable&&(K++,this.pickedBySubMesh[K]=[],a=0));for(var l=0,R=0;R<g;R++){if(u[U]=Q[J+R],this._pickable)if(0==R%3){var x=this.pickedBySubMesh[K][a];x?(x.idx=Y.idx,x.faceId=l):this.pickedBySubMesh[K][a]={idx:Y.idx,faceId:l},a++,l++}U++}}return w.push(u.length),this._updatable&&this.mesh.updateIndices(u),this},w.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var w=0;w<this._materials.length;w++){var v=this._materials[w].uniqueId;this._materialIndexesById[v]=w}},w.prototype._filterUniqueMaterialId=function(w){return w.filter((function(w,v,I){return I.indexOf(w)===v}))},w.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new gw.b(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},w.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},w.prototype.setVisibilityBox=function(w){var v=w/2;this.mesh.buildBoundingInfo(new P.l(-v,-v,-v),new P.l(v,v,v))},Object.defineProperty(w.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(w){this._alwaysVisible=w,this.mesh.alwaysSelectAsActiveMesh=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(w){this._isVisibilityBoxLocked=w,this.mesh.getBoundingInfo().isLocked=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(w){this._computeParticleRotation=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(w){this._computeParticleColor=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(w){this._computeParticleTexture=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(w){this._computeParticleVertex=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(w){this._computeBoundingBox=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(w){this._depthSortParticles=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"expandable",{get:function(){return this._expandable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"materials",{get:function(){return this._materials},enumerable:!1,configurable:!0}),w.prototype.setMultiMaterial=function(w){this._materials=this._filterUniqueMaterialId(w),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new Nw.b(this.name+"MultiMaterial",this._scene);for(var v=0;v<this._materials.length;v++)this._multimaterial.subMaterials.push(this._materials[v]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(w.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(w){this._multimaterial=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(w){this._autoUpdateSubMeshes=w},enumerable:!1,configurable:!0}),w.prototype.initParticles=function(){},w.prototype.recycleParticle=function(w){return w},w.prototype.updateParticle=function(w){return w},w.prototype.updateParticleVertex=function(w,v,I){return this},w.prototype.beforeUpdateParticles=function(w,v,I){},w.prototype.afterUpdateParticles=function(w,v,I){}}(),I(39578)),mw=function(){function w(w,v,I,P,u){this.idx=0,this.color=new qw.f(1,1,1,1),this.position=qw.p.Zero(),this.rotation=qw.p.Zero(),this.uv=new qw.n(0,0),this.velocity=qw.p.Zero(),this.pivot=qw.p.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=qw.p.Zero(),this.idx=w,this._group=v,this.groupId=I,this.idxInGroup=P,this._pcs=u}return Object.defineProperty(w.prototype,"size",{get:function(){return this.size},set:function(w){this.size=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(w){this.rotationQuaternion=w},enumerable:!1,configurable:!0}),w.prototype.intersectsMesh=function(w,v){if(!w.hasBoundingInfo)return!1;if(v=v||!1)return w.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var I,P,u,Q,K,a;I=w.getBoundingInfo().boundingBox.maximumWorld.x,P=w.getBoundingInfo().boundingBox.minimumWorld.x,u=w.getBoundingInfo().boundingBox.maximumWorld.y,Q=w.getBoundingInfo().boundingBox.minimumWorld.y,K=w.getBoundingInfo().boundingBox.maximumWorld.z,a=w.getBoundingInfo().boundingBox.minimumWorld.z;var U=this.position.x+this._pcs.mesh.position.x,p=this.position.y+this._pcs.mesh.position.y,r=this.position.z+this._pcs.mesh.position.z;return P<=U&&U<=I&&Q<=p&&p<=u&&a<=r&&r<=K},w.prototype.getRotationMatrix=function(w){var v;if(this.rotationQuaternion)v=this.rotationQuaternion;else{v=qw.k.Quaternion[0];var I=this.rotation;qw.i.RotationYawPitchRollToRef(I.y,I.x,I.z,v)}v.toRotationMatrix(w)},w}(),cw=function(){function w(w,v){this.groupId=w,this._positionFunction=v}return Object.defineProperty(w.prototype,"groupID",{get:function(){return this.groupId},set:function(w){this.groupId=w},enumerable:!1,configurable:!0}),w}(),Mw=I(11126),Sw=I(76384);!function(w){w[w.Color=2]="Color",w[w.UV=1]="UV",w[w.Random=0]="Random",w[w.Stated=3]="Stated"}(Bw||(Bw={}));!function(){function w(w,v,I,P){this.particles=new Array,this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array,this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=w,this._size=v,this._scene=I||y.e.LastCreatedScene,P&&void 0!==P.updatable?this._updatable=P.updatable:this._updatable=!0}Object.defineProperty(w.prototype,"positions",{get:function(){return this._positions32},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"colors",{get:function(){return this._colors32},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"uvs",{get:function(){return this._uvs32},enumerable:!1,configurable:!0}),w.prototype.buildMeshAsync=function(w){var v=this;return Promise.all(this._promises).then((function(){return v._isReady=!0,v._buildMesh(w)}))},w.prototype._buildMesh=function(w){0===this.nbParticles&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var v=new Ww.b;v.set(this._positions32,j.f.PositionKind),this._uvs32.length>0&&v.set(this._uvs32,j.f.UVKind);var I=0;this._colors32.length>0&&(I=1,v.set(this._colors32,j.f.ColorKind));var P=new Rw.b(this.name,this._scene);v.applyToMesh(P,this._updatable),this.mesh=P,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var u=w;return u||((u=new gw.b("point cloud material",this._scene)).emissiveColor=new qw.c(I,I,I),u.disableLighting=!0,u.pointsCloud=!0,u.pointSize=this._size),P.material=u,new Promise((function(w){return w(P)}))},w.prototype._addParticle=function(w,v,I,P){var u=new mw(w,v,I,P,this);return this.particles.push(u),u},w.prototype._randomUnitVector=function(w){w.position=new P.l(Math.random(),Math.random(),Math.random()),w.color=new qw.f(1,1,1,1)},w.prototype._getColorIndicesForCoord=function(w,v,I,P){var u=w._groupImageData,Q=I*(4*P)+4*v,K=[Q,Q+1,Q+2,Q+3],a=K[1],U=K[2],p=K[3],r=u[K[0]],Y=u[a],g=u[U],J=u[p];return new qw.f(r/255,Y/255,g/255,J)},w.prototype._setPointsColorOrUV=function(w,v,I,u,Q,a,U){I&&w.updateFacetData();var p=2*w.getBoundingInfo().boundingSphere.radius,r=w.getVerticesData(j.f.PositionKind),Y=w.getIndices(),g=w.getVerticesData(j.f.UVKind),J=w.getVerticesData(j.f.ColorKind),l=P.l.Zero();w.computeWorldMatrix();var R=w.getWorldMatrix();if(!R.isIdentity()){r=r.slice(0);for(var x=0;x<r.length/3;x++)P.l.TransformCoordinatesFromFloatsToRef(r[3*x],r[3*x+1],r[3*x+2],R,l),r[3*x]=l.x,r[3*x+1]=l.y,r[3*x+2]=l.z}var s,B,t=0,i=0,z=0,E=0,o=0,h=0,n=0,W=0,V=0,F=0,O=0,N=0,q=0,m=P.l.Zero(),c=P.l.Zero(),M=P.l.Zero(),S=P.l.Zero(),e=P.l.Zero(),H=0,G=0,L=0,d=0,D=0,f=0,b=P.k.Zero(),k=P.k.Zero(),C=P.k.Zero(),y=P.k.Zero(),T=P.k.Zero(),Z=0,A=0,X=0,ww=0,vw=0,Iw=0,Pw=0,uw=0,Qw=0,Kw=0,aw=0,Uw=0,pw=P.p.Zero(),rw=P.p.Zero(),Yw=P.p.Zero(),gw=P.p.Zero(),Jw=P.p.Zero(),lw=0,Rw=0;U=U||0;for(var xw,jw=new P.p(0,0,0,0),sw=P.l.Zero(),Bw=P.l.Zero(),tw=P.l.Zero(),iw=0,zw=P.l.Zero(),Ew=0,ow=0,hw=new Mw.d(P.l.Zero(),new P.l(1,0,0)),nw=P.l.Zero(),Ww=0;Ww<Y.length/3;Ww++){i=Y[3*Ww],z=Y[3*Ww+1],E=Y[3*Ww+2],o=r[3*i],h=r[3*i+1],n=r[3*i+2],W=r[3*z],V=r[3*z+1],F=r[3*z+2],O=r[3*E],N=r[3*E+1],q=r[3*E+2],m.set(o,h,n),c.set(W,V,F),M.set(O,N,q),c.subtractToRef(m,S),M.subtractToRef(c,e),g&&(H=g[2*i],G=g[2*i+1],L=g[2*z],d=g[2*z+1],D=g[2*E],f=g[2*E+1],b.set(H,G),k.set(L,d),C.set(D,f),k.subtractToRef(b,y),C.subtractToRef(k,T)),J&&u&&(Z=J[4*i],A=J[4*i+1],X=J[4*i+2],ww=J[4*i+3],vw=J[4*z],Iw=J[4*z+1],Pw=J[4*z+2],uw=J[4*z+3],Qw=J[4*E],Kw=J[4*E+1],aw=J[4*E+2],Uw=J[4*E+3],pw.set(Z,A,X,ww),rw.set(vw,Iw,Pw,uw),Yw.set(Qw,Kw,aw,Uw),rw.subtractToRef(pw,gw),Yw.subtractToRef(rw,Jw));for(var Vw=void 0,Fw=void 0,Ow=void 0,Nw=void 0,mw=void 0,cw=void 0,Sw=void 0,ew=void 0,Hw=new qw.c(0,0,0),Gw=new qw.c(0,0,0),Lw=void 0,dw=void 0,Dw=0;Dw<v._groupDensity[Ww];Dw++)t=this.particles.length,this._addParticle(t,v,this._groupCounter,Ww+Dw),dw=this.particles[t],lw=K.b.RandomRange(0,1),Rw=K.b.RandomRange(0,1),s=m.add(S.scale(lw)).add(e.scale(lw*Rw)),I&&(sw=w.getFacetNormal(Ww).normalize().scale(-1),Bw=S.clone().normalize(),tw=P.l.Cross(sw,Bw),iw=K.b.RandomRange(0,2*Math.PI),zw=Bw.scale(Math.cos(iw)).add(tw.scale(Math.sin(iw))),iw=K.b.RandomRange(.1,Math.PI/2),nw=zw.scale(Math.cos(iw)).add(sw.scale(Math.sin(iw))),hw.origin=s.add(nw.scale(1e-5)),hw.direction=nw,hw.length=p,(xw=hw.intersectsMesh(w)).hit&&(ow=xw.pickedPoint.subtract(s).length(),Ew=K.b.RandomRange(0,1)*ow,s.addInPlace(nw.scale(Ew)))),dw.position=s.clone(),this._positions.push(dw.position.x,dw.position.y,dw.position.z),void 0!==u?g&&(B=b.add(y.scale(lw)).add(T.scale(lw*Rw)),u?Q&&null!==v._groupImageData?(Vw=v._groupImgWidth,Fw=v._groupImgHeight,Lw=this._getColorIndicesForCoord(v,Math.round(B.x*Vw),Math.round(B.y*Fw),Vw),dw.color=Lw,this._colors.push(Lw.r,Lw.g,Lw.b,Lw.a)):J?(jw=pw.add(gw.scale(lw)).add(Jw.scale(lw*Rw)),dw.color=new qw.f(jw.x,jw.y,jw.z,jw.w),this._colors.push(jw.x,jw.y,jw.z,jw.w)):(jw=pw.set(Math.random(),Math.random(),Math.random(),1),dw.color=new qw.f(jw.x,jw.y,jw.z,jw.w),this._colors.push(jw.x,jw.y,jw.z,jw.w)):(dw.uv=B.clone(),this._uvs.push(dw.uv.x,dw.uv.y))):(a?(Hw.set(a.r,a.g,a.b),Ow=K.b.RandomRange(-U,U),Nw=K.b.RandomRange(-U,U),mw=(ew=Hw.toHSV()).r,(cw=ew.g+Ow)<0&&(cw=0),cw>1&&(cw=1),(Sw=ew.b+Nw)<0&&(Sw=0),Sw>1&&(Sw=1),qw.c.HSVtoRGBToRef(mw,cw,Sw,Gw),jw.set(Gw.r,Gw.g,Gw.b,1)):jw=pw.set(Math.random(),Math.random(),Math.random(),1),dw.color=new qw.f(jw.x,jw.y,jw.z,jw.w),this._colors.push(jw.x,jw.y,jw.z,jw.w))}},w.prototype._colorFromTexture=function(w,v,I){var P=this;if(null===w.material)return c.e.Warn(w.name+"has no material."),v._groupImageData=null,void this._setPointsColorOrUV(w,v,I,!0,!1);var u=w.material.getActiveTextures();if(0===u.length)return c.e.Warn(w.name+"has no usable texture."),v._groupImageData=null,void this._setPointsColorOrUV(w,v,I,!0,!1);var Q=w.clone();Q.setEnabled(!1),this._promises.push(new Promise((function(w){Sw.c.WhenAllReady(u,(function(){var K=v._textureNb;K<0&&(K=0),K>u.length-1&&(K=u.length-1);var a=function(){v._groupImgWidth=u[K].getSize().width,v._groupImgHeight=u[K].getSize().height,P._setPointsColorOrUV(Q,v,I,!0,!0),Q.dispose(),w()};v._groupImageData=null;var U=u[K].readPixels();U?U.then((function(w){v._groupImageData=w,a()})):a()}))})))},w.prototype._calculateDensity=function(w,v,I){for(var u,Q,K,a,U,p,r,Y,g,J,l,R,x,j,s,B,t,i=new Array,z=P.l.Zero(),E=P.l.Zero(),o=P.l.Zero(),h=P.l.Zero(),n=P.l.Zero(),W=P.l.Zero(),V=new Array,F=0,O=I.length/3,N=0;N<O;N++)u=I[3*N],Q=I[3*N+1],K=I[3*N+2],a=v[3*u],U=v[3*u+1],p=v[3*u+2],r=v[3*Q],Y=v[3*Q+1],g=v[3*Q+2],J=v[3*K],l=v[3*K+1],R=v[3*K+2],z.set(a,U,p),E.set(r,Y,g),o.set(J,l,R),E.subtractToRef(z,h),o.subtractToRef(E,n),o.subtractToRef(z,W),B=((x=h.length())+(j=n.length())+(s=W.length()))/2,F+=t=Math.sqrt(B*(B-x)*(B-j)*(B-s)),V[N]=t;var q=0;for(N=0;N<O;N++)i[N]=Math.floor(w*V[N]/F),q+=i[N];var m=w-q,c=Math.floor(m/O),M=m%O;c>0&&(i=i.map((function(w){return w+c})));for(N=0;N<M;N++)i[N]+=1;return i},w.prototype.addPoints=function(w,v){void 0===v&&(v=this._randomUnitVector);for(var I,P=new cw(this._groupCounter,v),u=this.nbParticles,Q=0;Q<w;Q++)I=this._addParticle(u,P,this._groupCounter,Q),P&&P._positionFunction&&P._positionFunction(I,u,Q),this._positions.push(I.position.x,I.position.y,I.position.z),I.color&&this._colors.push(I.color.r,I.color.g,I.color.b,I.color.a),I.uv&&this._uvs.push(I.uv.x,I.uv.y),u++;return this.nbParticles+=w,this._groupCounter++,this._groupCounter},w.prototype.addSurfacePoints=function(w,v,I,P,u){var Q=I||Bw.Random;(isNaN(Q)||Q<0||Q>3)&&(Q=Bw.Random);var K=w.getVerticesData(j.f.PositionKind),a=w.getIndices();this._groups.push(this._groupCounter);var U=new cw(this._groupCounter,null);switch(U._groupDensity=this._calculateDensity(v,K,a),Q===Bw.Color?U._textureNb=P||0:P=P||new qw.f(1,1,1,1),Q){case Bw.Color:this._colorFromTexture(w,U,!1);break;case Bw.UV:this._setPointsColorOrUV(w,U,!1,!1,!1);break;case Bw.Random:this._setPointsColorOrUV(w,U,!1);break;case Bw.Stated:this._setPointsColorOrUV(w,U,!1,void 0,void 0,P,u)}return this.nbParticles+=v,this._groupCounter++,this._groupCounter-1},w.prototype.addVolumePoints=function(w,v,I,P,u){var Q=I||Bw.Random;(isNaN(Q)||Q<0||Q>3)&&(Q=Bw.Random);var K=w.getVerticesData(j.f.PositionKind),a=w.getIndices();this._groups.push(this._groupCounter);var U=new cw(this._groupCounter,null);switch(U._groupDensity=this._calculateDensity(v,K,a),Q===Bw.Color?U._textureNb=P||0:P=P||new qw.f(1,1,1,1),Q){case Bw.Color:this._colorFromTexture(w,U,!0);break;case Bw.UV:this._setPointsColorOrUV(w,U,!0,!1,!1);break;case Bw.Random:this._setPointsColorOrUV(w,U,!0);break;case Bw.Stated:this._setPointsColorOrUV(w,U,!0,void 0,void 0,P,u)}return this.nbParticles+=v,this._groupCounter++,this._groupCounter-1},w.prototype.setParticles=function(w,v,I){if(void 0===w&&(w=0),void 0===v&&(v=this.nbParticles-1),void 0===I&&(I=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(w,v,I);var u=P.i.Matrix[0],Q=this.mesh,K=this._colors32,a=this._positions32,U=this._uvs32,p=P.i.Vector3,r=p[5].copyFromFloats(1,0,0),Y=p[6].copyFromFloats(0,1,0),g=p[7].copyFromFloats(0,0,1),J=p[8].setAll(Number.MAX_VALUE),l=p[9].setAll(-Number.MAX_VALUE);P.e.IdentityToRef(u);var R=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),v=v>=this.nbParticles?this.nbParticles-1:v,this._computeBoundingBox&&(0!=w||v!=this.nbParticles-1)){var x=this.mesh.getBoundingInfo();x&&(J.copyFrom(x.minimum),l.copyFrom(x.maximum))}R=0;for(var s=0,B=0,t=0,i=w;i<=v;i++){var z=this.particles[i];s=3*(R=z.idx),B=4*R,t=2*R,this.updateParticle(z);var E=z._rotationMatrix,o=z.position,h=z._globalPosition;if(this._computeParticleRotation&&z.getRotationMatrix(u),null!==z.parentId){var n=this.particles[z.parentId],W=n._rotationMatrix,V=n._globalPosition,F=o.x*W[1]+o.y*W[4]+o.z*W[7],O=o.x*W[0]+o.y*W[3]+o.z*W[6],N=o.x*W[2]+o.y*W[5]+o.z*W[8];if(h.x=V.x+O,h.y=V.y+F,h.z=V.z+N,this._computeParticleRotation){var q=u.m;E[0]=q[0]*W[0]+q[1]*W[3]+q[2]*W[6],E[1]=q[0]*W[1]+q[1]*W[4]+q[2]*W[7],E[2]=q[0]*W[2]+q[1]*W[5]+q[2]*W[8],E[3]=q[4]*W[0]+q[5]*W[3]+q[6]*W[6],E[4]=q[4]*W[1]+q[5]*W[4]+q[6]*W[7],E[5]=q[4]*W[2]+q[5]*W[5]+q[6]*W[8],E[6]=q[8]*W[0]+q[9]*W[3]+q[10]*W[6],E[7]=q[8]*W[1]+q[9]*W[4]+q[10]*W[7],E[8]=q[8]*W[2]+q[9]*W[5]+q[10]*W[8]}}else if(h.x=0,h.y=0,h.z=0,this._computeParticleRotation){q=u.m;E[0]=q[0],E[1]=q[1],E[2]=q[2],E[3]=q[4],E[4]=q[5],E[5]=q[6],E[6]=q[8],E[7]=q[9],E[8]=q[10]}var m=p[11];z.translateFromPivot?m.setAll(0):m.copyFrom(z.pivot);var c=p[0];c.copyFrom(z.position);var M=c.x-z.pivot.x,S=c.y-z.pivot.y,e=c.z-z.pivot.z,H=M*E[0]+S*E[3]+e*E[6],G=M*E[1]+S*E[4]+e*E[7],L=M*E[2]+S*E[5]+e*E[8];H+=m.x,G+=m.y,L+=m.z;var d=a[s]=h.x+r.x*H+Y.x*G+g.x*L,D=a[s+1]=h.y+r.y*H+Y.y*G+g.y*L,f=a[s+2]=h.z+r.z*H+Y.z*G+g.z*L;if(this._computeBoundingBox&&(J.minimizeInPlaceFromFloats(d,D,f),l.maximizeInPlaceFromFloats(d,D,f)),this._computeParticleColor&&z.color){var b=z.color,k=this._colors32;k[B]=b.r,k[B+1]=b.g,k[B+2]=b.b,k[B+3]=b.a}if(this._computeParticleTexture&&z.uv){var C=z.uv,y=this._uvs32;y[t]=C.x,y[t+1]=C.y}}return I&&(this._computeParticleColor&&Q.updateVerticesData(j.f.ColorKind,K,!1,!1),this._computeParticleTexture&&Q.updateVerticesData(j.f.UVKind,U,!1,!1),Q.updateVerticesData(j.f.PositionKind,a,!1,!1)),this._computeBoundingBox&&(Q.hasBoundingInfo?Q.getBoundingInfo().reConstruct(J,l,Q._worldMatrix):Q.buildBoundingInfo(J,l,Q._worldMatrix)),this.afterUpdateParticles(w,v,I),this},w.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},w.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},w.prototype.setVisibilityBox=function(w){var v=w/2;this.mesh.buildBoundingInfo(new P.l(-v,-v,-v),new P.l(v,v,v))},Object.defineProperty(w.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(w){this._alwaysVisible=w,this.mesh.alwaysSelectAsActiveMesh=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeParticleRotation",{set:function(w){this._computeParticleRotation=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(w){this._computeParticleColor=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(w){this._computeParticleTexture=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(w){this._computeBoundingBox=w},enumerable:!1,configurable:!0}),w.prototype.initParticles=function(){},w.prototype.recycleParticle=function(w){return w},w.prototype.updateParticle=function(w){return w},w.prototype.beforeUpdateParticles=function(w,v,I){},w.prototype.afterUpdateParticles=function(w,v,I){}}()},56965:function(w,v,I){"use strict";I.d(v,{b:function(){return g}});var P=I(78502),u=I(21901),Q=I(9271),K=I(80105),a="attribute vec2 position;\nuniform vec2 scale;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";I(16179).c.ShadersStore.postprocessVertexShader=a;var U=I(90690),p=(I(84468),I(9892)),r=I(31709),Y=I(61803),g=function(){function w(w,v,I,P,a,U,p,r,g,J,l,R,x,j,s){void 0===p&&(p=1),void 0===J&&(J=null),void 0===l&&(l=0),void 0===R&&(R="postprocess"),void 0===j&&(j=!1),void 0===s&&(s=5),this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=0,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new u.g(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new K.k(1,1),this._texelSize=K.k.Zero(),this.onActivateObservable=new Q.c,this.onSizeChangedObservable=new Q.c,this.onApplyObservable=new Q.c,this.onBeforeRenderObservable=new Q.c,this.onAfterRenderObservable=new Q.c,this.name=w,null!=U?(this._camera=U,this._scene=U.getScene(),U.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):r&&(this._engine=r,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=p||1,this._reusable=g||!1,this._textureType=l,this._textureFormat=s,this._samplers=P||[],this._samplers.push("textureSampler"),this._fragmentUrl=v,this._vertexUrl=R,this._parameters=I||[],this._parameters.push("scale"),this._indexParameters=x,this._drawWrapper=new Y.c(this._engine),j||this.updateEffect(J)}return Object.defineProperty(w.prototype,"samples",{get:function(){return this._samples},set:function(w){var v=this;this._samples=Math.min(w,this._engine.getCaps().maxMSAASamples),this._textures.forEach((function(w){w.samples!==v._samples&&v._engine.updateRenderTargetTextureSampleCount(w,v._samples)}))},enumerable:!1,configurable:!0}),w.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(w.prototype,"onActivate",{set:function(w){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),w&&(this._onActivateObserver=this.onActivateObservable.add(w))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onSizeChanged",{set:function(w){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onApply",{set:function(w){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBeforeRender",{set:function(w){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onAfterRender",{set:function(w){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(w){this._forcedOutputTexture=w},enumerable:!1,configurable:!0}),w.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())},w.prototype.getCamera=function(){return this._camera},Object.defineProperty(w.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),w.prototype.getClassName=function(){return"PostProcess"},w.prototype.getEngine=function(){return this._engine},w.prototype.getEffect=function(){return this._drawWrapper.effect},w.prototype.shareOutputWith=function(w){return this._disposeTextures(),this._shareOutputWithPostProcess=w,this},w.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new u.g(2)),this._shareOutputWithPostProcess=null},w.prototype.updateEffect=function(w,v,I,P,u,Q,K,a){void 0===w&&(w=null),void 0===v&&(v=null),void 0===I&&(I=null),this._postProcessDefines=w,this._drawWrapper.effect=this._engine.createEffect({vertex:null!==K&&void 0!==K?K:this._vertexUrl,fragment:null!==a&&void 0!==a?a:this._fragmentUrl},["position"],v||this._parameters,I||this._samplers,null!==w?w:"",void 0,u,Q,P||this._indexParameters)},w.prototype.isReusable=function(){return this._reusable},w.prototype.markTextureDirty=function(){this.width=-1},w.prototype._createRenderTargetTexture=function(w,v,I){void 0===I&&(I=0);for(var P=0;P<this._textureCache.length;P++)if(this._textureCache[P].texture.width===w.width&&this._textureCache[P].texture.height===w.height&&this._textureCache[P].postProcessChannel===I&&this._textureCache[P].texture._generateDepthBuffer===v.generateDepthBuffer)return this._textureCache[P].texture;var u=this._engine.createRenderTargetTexture(w,v);return this._textureCache.push({texture:u,postProcessChannel:I,lastUsedRenderId:-1}),u},w.prototype._flushTextureCache=function(){for(var w=this._renderId,v=this._textureCache.length-1;v>=0;v--)if(w-this._textureCache[v].lastUsedRenderId>100){for(var I=!1,P=0;P<this._textures.length;P++)if(this._textures.data[P]===this._textureCache[v].texture){I=!0;break}I||(this._textureCache[v].texture.dispose(),this._textureCache.splice(v,1))}},w.prototype._resize=function(w,v,I,P,u){this._textures.length>0&&this._textures.reset(),this.width=w,this.height=v;for(var Q=null,K=0;K<I._postProcesses.length;K++)if(null!==I._postProcesses[K]){Q=I._postProcesses[K];break}var a={width:this.width,height:this.height},U={generateMipMaps:P,generateDepthBuffer:u||Q===this,generateStencilBuffer:(u||Q===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._createRenderTargetTexture(a,U,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(a,U,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)},w.prototype.activate=function(w,v,I){var P,u,Q=this;void 0===v&&(v=null);var K=(w=w||this._camera).getScene(),a=K.getEngine(),p=a.getCaps().maxTextureSize,r=(v?v.width:this._engine.getRenderWidth(!0))*this._options|0,Y=(v?v.height:this._engine.getRenderHeight(!0))*this._options|0,g=w.parent;!g||g.leftCamera!=w&&g.rightCamera!=w||(r/=2);var J,l=this._options.width||r,R=this._options.height||Y,x=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var j=a.currentViewport;j&&(l*=j.width,R*=j.height)}(x||this.alwaysForcePOT)&&(this._options.width||(l=a.needPOTTextures?U.d.GetExponentOfTwo(l,p,this.scaleMode):l),this._options.height||(R=a.needPOTTextures?U.d.GetExponentOfTwo(R,p,this.scaleMode):R)),this.width===l&&this.height===R||this._resize(l,R,w,x,I),this._textures.forEach((function(w){w.samples!==Q.samples&&Q._engine.updateRenderTargetTextureSampleCount(w,Q.samples)})),this._flushTextureCache(),this._renderId++}if(this._shareOutputWithPostProcess)J=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)J=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{J=this.inputTexture;for(var s=void 0,B=0;B<this._textureCache.length;B++)if(this._textureCache[B].texture===J){s=this._textureCache[B];break}s&&(s.lastUsedRenderId=this._renderId)}return this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(r/l,Y/R),this._engine.bindFramebuffer(J,0,r,Y,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(J,0,void 0,void 0,this.forceFullscreenViewport)),null===(u=(P=this._engine)._debugInsertMarker)||void 0===u||u.call(P,"post process ".concat(this.name," input")),this.onActivateObservable.notifyObservers(w),this.autoClear&&0===this.alphaMode&&this._engine.clear(this.clearColor?this.clearColor:K.clearColor,K._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),J},Object.defineProperty(w.prototype,"isSupported",{get:function(){return this._drawWrapper.effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),w.prototype.isReady=function(){var w,v;return null!==(v=null===(w=this._drawWrapper.effect)||void 0===w?void 0:w.isReady())&&void 0!==v&&v},w.prototype.apply=function(){var w,v;return(null===(w=this._drawWrapper.effect)||void 0===w?void 0:w.isReady())?(this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),v=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",null===v||void 0===v?void 0:v.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),this._drawWrapper.effect):null},w.prototype._disposeTextures=function(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())},w.prototype._disposeTextureCache=function(){for(var w=this._textureCache.length-1;w>=0;w--)this._textureCache[w].texture.dispose();this._textureCache.length=0},w.prototype.setPrePassRenderer=function(w){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=w.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},w.prototype.dispose=function(w){var v;if(w=w||this._camera,this._disposeTextures(),this._scene&&-1!==(v=this._scene.postProcesses.indexOf(this))&&this._scene.postProcesses.splice(v,1),this._parentContainer){var I=this._parentContainer.postProcesses.indexOf(this);I>-1&&this._parentContainer.postProcesses.splice(I,1),this._parentContainer=null}if(-1!==(v=this._engine.postProcesses.indexOf(this))&&this._engine.postProcesses.splice(v,1),w){if(w.detachPostProcess(this),0===(v=w._postProcesses.indexOf(this))&&w._postProcesses.length>0){var P=this._camera._getFirstPostProcess();P&&P.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},w.prototype.serialize=function(){var w=p.e.Serialize(this),v=this.getCamera()||this._scene&&this._scene.activeCamera;return w.customType="BABYLON."+this.getClassName(),w.cameraId=v?v.id:null,w.reusable=this._reusable,w.textureType=this._textureType,w.fragmentUrl=this._fragmentUrl,w.parameters=this._parameters,w.samplers=this._samplers,w.options=this._options,w.defines=this._postProcessDefines,w.textureFormat=this._textureFormat,w.vertexUrl=this._vertexUrl,w.indexParameters=this._indexParameters,w},w.prototype.clone=function(){var v=this.serialize();v._engine=this._engine,v.cameraId=null;var I=w.Parse(v,this._scene,"");return I?(I.onActivateObservable=this.onActivateObservable.clone(),I.onSizeChangedObservable=this.onSizeChangedObservable.clone(),I.onApplyObservable=this.onApplyObservable.clone(),I.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),I.onAfterRenderObservable=this.onAfterRenderObservable.clone(),I._prePassEffectConfiguration=this._prePassEffectConfiguration,I):null},w.Parse=function(w,v,I){var P=(0,r.c)(w.customType);if(!P||!P._Parse)return null;var u=v?v.getCameraById(w.cameraId):null;return P._Parse(w,u,v,I)},w._Parse=function(v,I,P,u){return p.e.Parse((function(){return new w(v.name,v.fragmentUrl,v.parameters,v.samplers,v.options,I,v.renderTargetSamplingMode,v._engine,v.reusable,v.defines,v.textureType,v.vertexUrl,v.indexParameters,!1,v.textureFormat)}),v,P,u)},(0,P.i)([(0,p.J)()],w.prototype,"uniqueId",void 0),(0,P.i)([(0,p.J)()],w.prototype,"name",void 0),(0,P.i)([(0,p.J)()],w.prototype,"width",void 0),(0,P.i)([(0,p.J)()],w.prototype,"height",void 0),(0,P.i)([(0,p.J)()],w.prototype,"renderTargetSamplingMode",void 0),(0,P.i)([(0,p.q)()],w.prototype,"clearColor",void 0),(0,P.i)([(0,p.J)()],w.prototype,"autoClear",void 0),(0,P.i)([(0,p.J)()],w.prototype,"alphaMode",void 0),(0,P.i)([(0,p.J)()],w.prototype,"alphaConstants",void 0),(0,P.i)([(0,p.J)()],w.prototype,"enablePixelPerfectMode",void 0),(0,P.i)([(0,p.J)()],w.prototype,"forceFullscreenViewport",void 0),(0,P.i)([(0,p.J)()],w.prototype,"scaleMode",void 0),(0,P.i)([(0,p.J)()],w.prototype,"alwaysForcePOT",void 0),(0,P.i)([(0,p.J)("samples")],w.prototype,"_samples",void 0),(0,P.i)([(0,p.J)()],w.prototype,"adaptScaleToCurrentViewport",void 0),w}();(0,r.g)("BABYLON.PostProcess",g)},64833:function(w,v,I){"use strict";I.d(v,{c:function(){return u}});var P=I(43251),u=function(){function w(w){this._vertexBuffers={},this._scene=w}return w.prototype._prepareBuffers=function(){if(!this._vertexBuffers[P.f.PositionKind]){var w=[];w.push(1,1),w.push(-1,1),w.push(-1,-1),w.push(1,-1),this._vertexBuffers[P.f.PositionKind]=new P.f(this._scene.getEngine(),w,P.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}},w.prototype._buildIndexBuffer=function(){var w=[];w.push(0),w.push(1),w.push(2),w.push(0),w.push(2),w.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(w)},w.prototype._rebuild=function(){var w=this._vertexBuffers[P.f.PositionKind];w&&(w._rebuild(),this._buildIndexBuffer())},w.prototype._prepareFrame=function(w,v){void 0===w&&(w=null),void 0===v&&(v=null);var I=this._scene.activeCamera;return!!I&&(!(!(v=v||I._postProcesses.filter((function(w){return null!=w})))||0===v.length||!this._scene.postProcessesEnabled)&&(v[0].activate(I,w,null!==v&&void 0!==v),!0))},w.prototype.directRender=function(w,v,I,P,u,Q){var K;void 0===v&&(v=null),void 0===I&&(I=!1),void 0===P&&(P=0),void 0===u&&(u=0),void 0===Q&&(Q=!1);for(var a=this._scene.getEngine(),U=0;U<w.length;U++){U<w.length-1?w[U+1].activate(this._scene.activeCamera,null===v||void 0===v?void 0:v.texture):(v?a.bindFramebuffer(v,P,void 0,void 0,I,u):Q||a.restoreDefaultFramebuffer(),null===(K=a._debugInsertMarker)||void 0===K||K.call(a,"post process ".concat(w[U].name," output")));var p=w[U],r=p.apply();r&&(p.onBeforeRenderObservable.notifyObservers(r),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,r),a.drawElementsType(0,0,6),p.onAfterRenderObservable.notifyObservers(r))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},w.prototype._finalizeFrame=function(w,v,I,P,u){var Q;void 0===u&&(u=!1);var K=this._scene.activeCamera;if(K&&(P=P||K._postProcesses.filter((function(w){return null!=w})),0!==P.length&&this._scene.postProcessesEnabled)){for(var a=this._scene.getEngine(),U=0,p=P.length;U<p;U++){var r=P[U];if(U<p-1?r._outputTexture=P[U+1].activate(K,null===v||void 0===v?void 0:v.texture):(v?(a.bindFramebuffer(v,I,void 0,void 0,u),r._outputTexture=v):(a.restoreDefaultFramebuffer(),r._outputTexture=null),null===(Q=a._debugInsertMarker)||void 0===Q||Q.call(a,"post process ".concat(P[U].name," output"))),w)break;var Y=r.apply();Y&&(r.onBeforeRenderObservable.notifyObservers(Y),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,Y),a.drawElementsType(0,0,6),r.onAfterRenderObservable.notifyObservers(Y))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}},w.prototype.dispose=function(){var w=this._vertexBuffers[P.f.PositionKind];w&&(w.dispose(),this._vertexBuffers[P.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},w}()},16369:function(w,v,I){"use strict";I.d(v,{c:function(){return a}});var P=I(21901),u=I(80105),Q=function(){function w(w,v,I,u,Q){void 0===I&&(I=null),void 0===u&&(u=null),void 0===Q&&(Q=null),this.index=w,this._opaqueSubMeshes=new P.g(256),this._transparentSubMeshes=new P.g(256),this._alphaTestSubMeshes=new P.g(256),this._depthOnlySubMeshes=new P.g(256),this._particleSystems=new P.g(256),this._spriteManagers=new P.g(256),this._empty=!0,this._edgesRenderers=new P.c(16),this._scene=v,this.opaqueSortCompareFn=I,this.alphaTestSortCompareFn=u,this.transparentSortCompareFn=Q}return Object.defineProperty(w.prototype,"opaqueSortCompareFn",{set:function(v){this._opaqueSortCompareFn=v||w.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"alphaTestSortCompareFn",{set:function(v){this._alphaTestSortCompareFn=v||w.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"transparentSortCompareFn",{set:function(v){this._transparentSortCompareFn=v||w.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted},enumerable:!1,configurable:!0}),w.prototype.render=function(w,v,I,P){if(w)w(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var u=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(u.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),u.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var Q=u.getStencilBuffer();if(u.setStencilBuffer(!1),v&&this._renderSprites(),I&&this._renderParticles(P),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(u.setStencilBuffer(Q),this._scene.useOrderIndependentTransparency){var K=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);K.length&&this._renderTransparent(K)}else this._renderTransparent(this._transparentSubMeshes);u.setAlphaMode(0)}if(u.setStencilBuffer(!1),this._edgesRenderers.length){for(var a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();u.setAlphaMode(0)}u.setStencilBuffer(Q)}},w.prototype._renderOpaqueSorted=function(v){return w._RenderSorted(v,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},w.prototype._renderAlphaTestSorted=function(v){return w._RenderSorted(v,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},w.prototype._renderTransparentSorted=function(v){return w._RenderSorted(v,this._transparentSortCompareFn,this._scene.activeCamera,!0)},w._RenderSorted=function(v,I,P,Q){var K,a=0,U=P?P.globalPosition:w._ZeroVector;if(Q)for(;a<v.length;a++)(K=v.data[a])._alphaIndex=K.getMesh().alphaIndex,K._distanceToCamera=u.l.Distance(K.getBoundingInfo().boundingSphere.centerWorld,U);var p=v.length===v.data.length?v.data:v.data.slice(0,v.length);I&&p.sort(I);var r=p[0].getMesh().getScene();for(a=0;a<p.length;a++)if(K=p[a],!r._activeMeshesFrozenButKeepClipping||K.isInFrustum(r._frustumPlanes)){if(Q){var Y=K.getMaterial();if(Y&&Y.needDepthPrePass){var g=Y.getScene().getEngine();g.setColorWrite(!1),g.setAlphaMode(0),K.render(!1),g.setColorWrite(!0)}}K.render(Q)}},w.defaultTransparentSortCompare=function(v,I){return v._alphaIndex>I._alphaIndex?1:v._alphaIndex<I._alphaIndex?-1:w.backToFrontSortCompare(v,I)},w.backToFrontSortCompare=function(w,v){return w._distanceToCamera<v._distanceToCamera?1:w._distanceToCamera>v._distanceToCamera?-1:0},w.frontToBackSortCompare=function(w,v){return w._distanceToCamera<v._distanceToCamera?-1:w._distanceToCamera>v._distanceToCamera?1:0},w.PainterSortCompare=function(w,v){var I=w.getMesh(),P=v.getMesh();return I.material&&P.material?I.material.uniqueId-P.material.uniqueId:I.uniqueId-P.uniqueId},w.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset(),this._empty=!0},w.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},w.prototype.dispatch=function(w,v,I){void 0===v&&(v=w.getMesh()),void 0===I&&(I=w.getMaterial()),null!==I&&void 0!==I&&(I.needAlphaBlendingForMesh(v)?this._transparentSubMeshes.push(w):I.needAlphaTesting()?(I.needDepthPrePass&&this._depthOnlySubMeshes.push(w),this._alphaTestSubMeshes.push(w)):(I.needDepthPrePass&&this._depthOnlySubMeshes.push(w),this._opaqueSubMeshes.push(w)),v._renderingGroup=this,v._edgesRenderer&&v._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(v._edgesRenderer),this._empty=!1)},w.prototype.dispatchSprites=function(w){this._spriteManagers.push(w),this._empty=!1},w.prototype.dispatchParticles=function(w){this._particleSystems.push(w),this._empty=!1},w.prototype._renderParticles=function(w){if(0!==this._particleSystems.length){var v=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var I=0;I<this._particleSystems.length;I++){var P=this._particleSystems.data[I];if(0!==(v&&v.layerMask&P.layerMask)){var u=P.emitter;u.position&&w&&-1===w.indexOf(u)||this._scene._activeParticles.addCount(P.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},w.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var w=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var v=0;v<this._spriteManagers.length;v++){var I=this._spriteManagers.data[v];0!==(w&&w.layerMask&I.layerMask)&&I.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},w._ZeroVector=u.l.Zero(),w}(),K=function(){},a=function(){function w(v){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new K,this._scene=v;for(var I=w.MIN_RENDERINGGROUPS;I<w.MAX_RENDERINGGROUPS;I++)this._autoClearDepthStencil[I]={autoClear:!0,depth:!0,stencil:!0}}return w.prototype._clearDepthStencilBuffer=function(w,v){void 0===w&&(w=!0),void 0===v&&(v=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,w,v),this._depthStencilBufferAlreadyCleaned=!0)},w.prototype.render=function(v,I,P,u){var Q=this._renderingGroupInfo;if(Q.scene=this._scene,Q.camera=this._scene.activeCamera,this._scene.spriteManagers&&u)for(var K=0;K<this._scene.spriteManagers.length;K++){var a=this._scene.spriteManagers[K];this.dispatchSprites(a)}for(K=w.MIN_RENDERINGGROUPS;K<w.MAX_RENDERINGGROUPS;K++){this._depthStencilBufferAlreadyCleaned=K===w.MIN_RENDERINGGROUPS;var U=this._renderingGroups[K];if(U&&!U._empty){var p=Math.pow(2,K);if(Q.renderingGroupId=K,this._scene.onBeforeRenderingGroupObservable.notifyObservers(Q,p),w.AUTOCLEAR){var r=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(K):this._autoClearDepthStencil[K];r&&r.autoClear&&this._clearDepthStencilBuffer(r.depth,r.stencil)}for(var Y=0,g=this._scene._beforeRenderingGroupDrawStage;Y<g.length;Y++){g[Y].action(K)}U.render(v,u,P,I);for(var J=0,l=this._scene._afterRenderingGroupDrawStage;J<l.length;J++){l[J].action(K)}this._scene.onAfterRenderingGroupObservable.notifyObservers(Q,p)}}},w.prototype.reset=function(){for(var v=w.MIN_RENDERINGGROUPS;v<w.MAX_RENDERINGGROUPS;v++){var I=this._renderingGroups[v];I&&I.prepare()}},w.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},w.prototype.freeRenderingGroups=function(){for(var v=w.MIN_RENDERINGGROUPS;v<w.MAX_RENDERINGGROUPS;v++){var I=this._renderingGroups[v];I&&I.dispose()}},w.prototype._prepareRenderingGroup=function(w){void 0===this._renderingGroups[w]&&(this._renderingGroups[w]=new Q(w,this._scene,this._customOpaqueSortCompareFn[w],this._customAlphaTestSortCompareFn[w],this._customTransparentSortCompareFn[w]))},w.prototype.dispatchSprites=function(w){var v=w.renderingGroupId||0;this._prepareRenderingGroup(v),this._renderingGroups[v].dispatchSprites(w)},w.prototype.dispatchParticles=function(w){var v=w.renderingGroupId||0;this._prepareRenderingGroup(v),this._renderingGroups[v].dispatchParticles(w)},w.prototype.dispatch=function(w,v,I){void 0===v&&(v=w.getMesh());var P=v.renderingGroupId||0;this._prepareRenderingGroup(P),this._renderingGroups[P].dispatch(w,v,I)},w.prototype.setRenderingOrder=function(w,v,I,P){if(void 0===v&&(v=null),void 0===I&&(I=null),void 0===P&&(P=null),this._customOpaqueSortCompareFn[w]=v,this._customAlphaTestSortCompareFn[w]=I,this._customTransparentSortCompareFn[w]=P,this._renderingGroups[w]){var u=this._renderingGroups[w];u.opaqueSortCompareFn=this._customOpaqueSortCompareFn[w],u.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[w],u.transparentSortCompareFn=this._customTransparentSortCompareFn[w]}},w.prototype.setRenderingAutoClearDepthStencil=function(w,v,I,P){void 0===I&&(I=!0),void 0===P&&(P=!0),this._autoClearDepthStencil[w]={autoClear:v,depth:I,stencil:P}},w.prototype.getAutoClearDepthStencilSetup=function(w){return this._autoClearDepthStencil[w]},w.MAX_RENDERINGGROUPS=4,w.MIN_RENDERINGGROUPS=0,w.AUTOCLEAR=!0,w}()},48623:function(w,v,I){"use strict";var P="bakedVertexAnimation",u="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;\nfloat VATEndFrame=BVASNAME.y;\nfloat VATOffsetFrame=BVASNAME.z;\nfloat VATSpeed=BVASNAME.w;\nfloat totalFrames=VATEndFrame-VATStartFrame+1.0;\nfloat time=bakedVertexAnimationTime*VATSpeed/totalFrames;\nfloat frameCorrection=time<1.0 ? 0.0 : 1.0;\nfloat numOfFrames=totalFrames-frameCorrection;\nfloat VATFrameNum=fract(time)*numOfFrames;\nVATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);\nVATFrameNum=floor(VATFrameNum);\nVATFrameNum+=VATStartFrame+frameCorrection;\nmat4 VATInfluence;\nVATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;\n}\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},54001:function(w,v,I){"use strict";var P="bakedVertexAnimationDeclaration",u="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;\nuniform vec2 bakedVertexAnimationTextureSizeInverted;\nuniform vec4 bakedVertexAnimationSettings;\nuniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{\nfloat offset=index*4.0;\nfloat frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;\nfloat dx=bakedVertexAnimationTextureSizeInverted.x;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},31377:function(w,v,I){"use strict";var P="bonesDeclaration",u="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index *4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},97202:function(w,v,I){"use strict";var P="bonesVertex",u="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},78767:function(w,v,I){"use strict";var P="bumpFragment",u="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#elif defined(BUMP)\nfloat normalScale=vBumpInfos.y;\n#else\nfloat normalScale=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#elif defined(BUMP)\nvec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);\n#else\nvec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nvec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;\nmat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);\nvec2 detailNormalRG=detailColor.wy*2.0-1.0;\nfloat detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));\nvec3 detailNormal=vec3(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);\n#else\nvec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal.xy*=vDetailInfos.z;\nvec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal.xy*=vDetailInfos.z;\nbumpNormal+=vec3(0.0,0.0,1.0);\ndetailNormal*=vec3(-1.0,-1.0,1.0);\nvec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal.xy*=vDetailInfos.z;\nnormalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},49904:function(w,v,I){"use strict";var P=I(16179),u=(I(54587),"bumpFragmentFunctions"),Q="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n";P.c.IncludesShadersStore[u]=Q},72994:function(w,v,I){"use strict";var P="bumpFragmentMainFunctions",u="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)\n{\n#ifdef NORMALXYSCALE\nnormal=normalize(normal*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\nreturn perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);\n}\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},70179:function(w,v,I){"use strict";var P="bumpVertex",u="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},20142:function(w,v,I){"use strict";var P="bumpVertexDeclaration",u="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},84098:function(w,v,I){"use strict";var P="clipPlaneFragment",u="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},76578:function(w,v,I){"use strict";var P="clipPlaneFragmentDeclaration",u="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},61906:function(w,v,I){"use strict";var P="clipPlaneVertex",u="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},49329:function(w,v,I){"use strict";var P="clipPlaneVertexDeclaration",u="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},75060:function(w,v,I){"use strict";var P="depthPrePass",u="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},80345:function(w,v,I){"use strict";var P="fogFragment",u="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},35850:function(w,v,I){"use strict";var P="fogFragmentDeclaration",u="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR==vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},32560:function(w,v,I){"use strict";var P="fogVertex",u="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},23654:function(w,v,I){"use strict";var P="fogVertexDeclaration",u="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},83874:function(w,v,I){"use strict";var P="helperFunctions",u="const float PI=3.1415926535897932384626433832795;\nconst float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nfloat toLinearSpace(float color)\n{\nreturn pow(color,LinearEncodePowerApprox);\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec4 toLinearSpace(vec4 color)\n{\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nvec4 toGammaSpace(vec4 color)\n{\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n}\nfloat toGammaSpace(float color)\n{\nreturn pow(color,GammaEncodePowerApprox);\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nvec3 square(vec3 value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D =max(rgbdMaxRange/maxRGB,1.);\nD =clamp(floor(D)/255.0,0.,1.);\nvec3 rgb=color.rgb*D;\nrgb=toGammaSpace(rgb);\nreturn vec4(clamp(rgb,0.,1.),D); \n}\nvec3 fromRGBD(vec4 rgbd) {\nrgbd.rgb=toLinearSpace(rgbd.rgb);\nreturn rgbd.rgb/rgbd.a;\n}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\nvec3 intersectPositionWS=vertexPos+origVec*distance;\nreturn intersectPositionWS-cubePos;\n}\n";I(16179).c.IncludesShadersStore[P]=u},23598:function(w,v,I){"use strict";var P="imageProcessingDeclaration",u="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},68923:function(w,v,I){"use strict";var P="imageProcessingFunctions",u="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}";I(16179).c.IncludesShadersStore[P]=u},16554:function(w,v,I){"use strict";var P="instancesDeclaration",u="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;\nattribute vec4 previousWorld1;\nattribute vec4 previousWorld2;\nattribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},50511:function(w,v,I){"use strict";var P="instancesVertex",u="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},57932:function(w,v,I){"use strict";var P="lightFragment",u="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},65084:function(w,v,I){"use strict";var P="lightFragmentDeclaration",u="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},45928:function(w,v,I){"use strict";var P="lightUboDeclaration",u="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X}; \n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},65359:function(w,v,I){"use strict";var P="lightVxFragmentDeclaration",u="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},58003:function(w,v,I){"use strict";var P="lightVxUboDeclaration",u="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},96919:function(w,v,I){"use strict";var P="logDepthDeclaration",u="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},84981:function(w,v,I){"use strict";var P="logDepthFragment",u="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},30242:function(w,v,I){"use strict";var P="logDepthVertex",u="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},87321:function(w,v,I){"use strict";var P="mainUVVaryingDeclaration",u="#ifdef MAINUV{X}\nvarying vec2 vMainUV{X};\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},61496:function(w,v,I){"use strict";var P="meshUboDeclaration",u="#ifdef WEBGL2\nuniform mat4 world;\nuniform float visibility;\n#else\nlayout(std140,column_major) uniform;\nuniform Mesh\n{\nmat4 world;\nfloat visibility;\n};\n#endif\n#define WORLD_UBO\n";I(16179).c.IncludesShadersStore[P]=u},48767:function(w,v,I){"use strict";var P="morphTargetsVertex",u="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE \nvertexID=float(gl_VertexID)*morphTargetTextureInfo.x;\npositionUpdated+=(readVector3FromRawSampler({X},vertexID)-position)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler({X},vertexID) -normal)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler({X},vertexID).xy-uv)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler({X},vertexID) -tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},83700:function(w,v,I){"use strict";var P="morphTargetsVertexDeclaration",u="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},63886:function(w,v,I){"use strict";var P="morphTargetsVertexGlobal",u="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},36062:function(w,v,I){"use strict";var P="morphTargetsVertexGlobalDeclaration",u="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nprecision mediump sampler2DArray; \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];\nuniform vec3 morphTargetTextureInfo;\nuniform sampler2DArray morphTargets;\nvec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);\nfloat x=vertexIndex-y*morphTargetTextureInfo.y;\nvec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);\nreturn texture(morphTargets,textureUV).xyz;\n}\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},44184:function(w,v,I){"use strict";var P="oitDeclaration",u="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out vec2 depth; \nlayout(location=1) out vec4 frontColor;\nlayout(location=2) out vec4 backColor;\n#define MAX_DEPTH 99999.0\nhighp vec4 gl_FragColor;\nuniform sampler2D oitDepthSampler;\nuniform sampler2D oitFrontColorSampler;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},69991:function(w,v,I){"use strict";var P="oitFragment",u="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nfloat fragDepth=gl_FragCoord.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nuint halfFloat=packHalf2x16(vec2(fragDepth));\nvec2 full=unpackHalf2x16(halfFloat);\nfragDepth=full.x;\n#endif\nivec2 fragCoord=ivec2(gl_FragCoord.xy);\nvec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;\nvec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);\ndepth.rg=vec2(-MAX_DEPTH);\nfrontColor=lastFrontColor;\nbackColor=vec4(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nfloat furthestDepth=-lastDepth.x;\nfloat nearestDepth=lastDepth.y;\n#else\nfloat nearestDepth=-lastDepth.x;\nfloat furthestDepth=lastDepth.y;\n#endif\nfloat alphaMultiplier=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn;\n}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\ndepth.rg=vec2(-fragDepth,fragDepth);\nreturn;\n}\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},74422:function(w,v,I){"use strict";var P="prePassDeclaration",u="#ifdef PREPASS\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;\n#ifdef PREPASS_DEPTH\nvarying highp vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},32875:function(w,v,I){"use strict";var P="prePassVertex",u="#ifdef PREPASS_DEPTH\nvViewPos=(view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},63201:function(w,v,I){"use strict";var P="prePassVertexDeclaration",u="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform mat4 previousViewProjection;\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},31814:function(w,v,I){"use strict";var P="reflectionFunction",u="vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0); \n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0); \n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,1.));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},54587:function(w,v,I){"use strict";var P="samplerFragmentDeclaration",u="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\nuniform sampler2D _SAMPLERNAME_Sampler;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},138:function(w,v,I){"use strict";var P="samplerVertexDeclaration",u="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},58878:function(w,v,I){"use strict";var P="samplerVertexImplementation",u="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (v_INFONAME_==0.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));\n}\n#ifdef UV2\nelse if (v_INFONAME_==1.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef UV3\nelse if (v_INFONAME_==2.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));\n}\n#endif\n#ifdef UV4\nelse if (v_INFONAME_==3.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));\n}\n#endif\n#ifdef UV5\nelse if (v_INFONAME_==4.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));\n}\n#endif\n#ifdef UV6\nelse if (v_INFONAME_==5.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));\n}\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},88987:function(w,v,I){"use strict";var P="sceneUboDeclaration",u="layout(std140,column_major) uniform;\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif \nmat4 view;\nmat4 projection;\nvec4 vEyePosition;\n};\n";I(16179).c.IncludesShadersStore[P]=u},35765:function(w,v,I){"use strict";var P="shadowsFragmentFunctions",u="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\n#define inline\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nreturn depth>shadow ? darkness : 1.0;\n}\n#define inline\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\n#define inline\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\n#define inline\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#if defined(WEBGL2) || defined(WEBGPU)\n#define inline\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n#endif\n#define inline\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n}\n#define inline\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#ifdef IS_NDC_HALF_ZRANGE\n#define ZINCLIP clipSpace.z\n#else\n#define ZINCLIP uvDepth.z\n#endif\n#if defined(WEBGL2) || defined(WEBGPU)\n#define GREATEST_LESS_THAN_ONE 0.99999994\n#define inline\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture2D(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n#define inline\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n}\n#define inline\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#define inline\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},70323:function(w,v,I){"use strict";var P="shadowsVertex",u="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},94040:function(w,v,I){"use strict";var P="uvAttributeDeclaration",u="#ifdef UV{X}\nattribute vec2 uv{X};\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},3970:function(w,v,I){"use strict";var P="uvVariableDeclaration",u="#if !defined(UV{X}) && defined(MAINUV{X})\nvec2 uv{X}=vec2(0.,0.);\n#endif\n#ifdef MAINUV{X}\nvMainUV{X}=uv{X};\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},35738:function(w,v,I){"use strict";var P="vertexColorMixing",u="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n";I(16179).c.IncludesShadersStore[P]=u},69233:function(w,v,I){"use strict";var P=I(16179),u=(I(83874),"rgbdDecodePixelShader"),Q="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";P.c.ShadersStore[u]=Q},60569:function(w,v,I){"use strict";I.d(v,{b:function(){return P}});var P=function(){function w(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return w.AddParser=function(w,v){this._BabylonFileParsers[w]=v},w.GetParser=function(w){return this._BabylonFileParsers[w]?this._BabylonFileParsers[w]:null},w.AddIndividualParser=function(w,v){this._IndividualBabylonFileParsers[w]=v},w.GetIndividualParser=function(w){return this._IndividualBabylonFileParsers[w]?this._IndividualBabylonFileParsers[w]:null},w.Parse=function(w,v,I,P){for(var u in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,u)&&this._BabylonFileParsers[u](w,v,I,P)},Object.defineProperty(w.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(w){this._environmentTexture=w},enumerable:!1,configurable:!0}),w.prototype.getNodes=function(){var w=new Array;return w=(w=(w=(w=w.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(v){return w=w.concat(v.bones)})),w},w._BabylonFileParsers={},w._IndividualBabylonFileParsers={},w}()},74134:function(w,v,I){"use strict";I.d(v,{b:function(){return r}});var P=I(78502),u=I(80105),Q=I(9892),K=I(9271),a=I(78588),U=I(50504),p=function(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new K.c,this._onClonedObservable=new K.c},r=function(){function w(w,v){void 0===v&&(v=null),this._isDirty=!1,this._nodeDataStorage=new p,this.state="",this.metadata=null,this.reservedDataStore=null,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=u.e.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new K.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=w,this.id=w,this._scene=v||a.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return w.AddNodeConstructor=function(w,v){this._NodeConstructors[w]=v},w.Construct=function(w,v,I,P){var u=this._NodeConstructors[w];return u?u(v,I,P):null},Object.defineProperty(w.prototype,"doNotSerialize",{get:function(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(w){this._nodeDataStorage._doNotSerialize=w},enumerable:!1,configurable:!0}),w.prototype.isDisposed=function(){return this._nodeDataStorage._isDisposed},Object.defineProperty(w.prototype,"parent",{get:function(){return this._parentNode},set:function(w){if(this._parentNode!==w){var v=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var I=this._parentNode._children.indexOf(this);-1!==I&&this._parentNode._children.splice(I,1),w||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=w,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),v||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),w.prototype._serializeAsParent=function(w){w.parentId=this.uniqueId},w.prototype._addToSceneRootNodes=function(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},w.prototype._removeFromSceneRootNodes=function(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){var w=this._scene.rootNodes,v=w.length-1;w[this._nodeDataStorage._sceneRootNodesIndex]=w[v],w[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}},Object.defineProperty(w.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(w){this._animationPropertiesOverride=w},enumerable:!1,configurable:!0}),w.prototype.getClassName=function(){return"Node"},Object.defineProperty(w.prototype,"onDispose",{set:function(w){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onEnabledStateChangedObservable",{get:function(){return this._nodeDataStorage._onEnabledStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onClonedObservable",{get:function(){return this._nodeDataStorage._onClonedObservable},enumerable:!1,configurable:!0}),w.prototype.getScene=function(){return this._scene},w.prototype.getEngine=function(){return this._scene.getEngine()},w.prototype.addBehavior=function(w,v){var I=this;return void 0===v&&(v=!1),-1!==this._behaviors.indexOf(w)||(w.init(),this._scene.isLoading&&!v?this._scene.onDataLoadedObservable.addOnce((function(){w.attach(I)})):w.attach(this),this._behaviors.push(w)),this},w.prototype.removeBehavior=function(w){var v=this._behaviors.indexOf(w);return-1===v||(this._behaviors[v].detach(),this._behaviors.splice(v,1)),this},Object.defineProperty(w.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),w.prototype.getBehaviorByName=function(w){for(var v=0,I=this._behaviors;v<I.length;v++){var P=I[v];if(P.name===w)return P}return null},w.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},w.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(w.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),w.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},w.prototype.updateCache=function(w){!w&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},w.prototype._getActionManagerForTrigger=function(w,v){return void 0===v&&(v=!0),this.parent?this.parent._getActionManagerForTrigger(w,!1):null},w.prototype._updateCache=function(w){},w.prototype._isSynchronized=function(){return!0},w.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},w.prototype.isSynchronizedWithParent=function(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},w.prototype.isSynchronized=function(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},w.prototype.isReady=function(w){return void 0===w&&(w=!1),this._nodeDataStorage._isReady},w.prototype.markAsDirty=function(w){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},w.prototype.isEnabled=function(w){return void 0===w&&(w=!0),!1===w?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled},w.prototype._syncParentEnabledState=function(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((function(w){w._syncParentEnabledState()}))},w.prototype.setEnabled=function(w){this._nodeDataStorage._isEnabled!==w&&(this._nodeDataStorage._isEnabled=w,this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(w),this._syncParentEnabledState())},w.prototype.isDescendantOf=function(w){return!!this.parent&&(this.parent===w||this.parent.isDescendantOf(w))},w.prototype._getDescendants=function(w,v,I){if(void 0===v&&(v=!1),this._children)for(var P=0;P<this._children.length;P++){var u=this._children[P];I&&!I(u)||w.push(u),v||u._getDescendants(w,!1,I)}},w.prototype.getDescendants=function(w,v){var I=new Array;return this._getDescendants(I,w,v),I},w.prototype.getChildMeshes=function(w,v){var I=[];return this._getDescendants(I,w,(function(w){return(!v||v(w))&&void 0!==w.cullingStrategy})),I},w.prototype.getChildren=function(w,v){return void 0===v&&(v=!0),this.getDescendants(v,w)},w.prototype._setReady=function(w){w!==this._nodeDataStorage._isReady&&(w?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)},w.prototype.getAnimationByName=function(w){for(var v=0;v<this.animations.length;v++){var I=this.animations[v];if(I.name===w)return I}return null},w.prototype.createAnimationRange=function(v,I,P){if(!this._ranges[v]){this._ranges[v]=w._AnimationRangeFactory(v,I,P);for(var u=0,Q=this.animations.length;u<Q;u++)this.animations[u]&&this.animations[u].createRange(v,I,P)}},w.prototype.deleteAnimationRange=function(w,v){void 0===v&&(v=!0);for(var I=0,P=this.animations.length;I<P;I++)this.animations[I]&&this.animations[I].deleteRange(w,v);this._ranges[w]=null},w.prototype.getAnimationRange=function(w){return this._ranges[w]||null},w.prototype.getAnimationRanges=function(){var w,v=[];for(w in this._ranges)v.push(this._ranges[w]);return v},w.prototype.beginAnimation=function(w,v,I,P){var u=this.getAnimationRange(w);return u?this._scene.beginAnimation(this,u.from,u.to,v,I,P):null},w.prototype.serializeAnimationRanges=function(){var w=[];for(var v in this._ranges){var I=this._ranges[v];if(I){var P={};P.name=v,P.from=I.from,P.to=I.to,w.push(P)}}return w},w.prototype.computeWorldMatrix=function(w){return this._worldMatrix||(this._worldMatrix=u.e.Identity()),this._worldMatrix},w.prototype.dispose=function(w,v){if(void 0===v&&(v=!1),this._nodeDataStorage._isDisposed=!0,!w)for(var I=0,P=this.getDescendants(!0);I<P.length;I++){P[I].dispose(w,v)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(var u=0,Q=this._behaviors;u<Q.length;u++){Q[u].detach()}this._behaviors=[],this.metadata=null},w.ParseAnimationRanges=function(w,v,I){if(v.ranges)for(var P=0;P<v.ranges.length;P++){var u=v.ranges[P];w.createAnimationRange(u.name,u.from,u.to)}},w.prototype.getHierarchyBoundingVectors=function(w,v){var I,P;void 0===w&&(w=!0),void 0===v&&(v=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var Q=this;if(Q.getBoundingInfo&&Q.subMeshes){var K=Q.getBoundingInfo();I=K.boundingBox.minimumWorld.clone(),P=K.boundingBox.maximumWorld.clone()}else I=new u.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),P=new u.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(w)for(var a=0,U=this.getDescendants(!1);a<U.length;a++){var p=U[a];if(p.computeWorldMatrix(!0),(!v||v(p))&&p.getBoundingInfo&&0!==p.getTotalVertices()){var r=p.getBoundingInfo().boundingBox,Y=r.minimumWorld,g=r.maximumWorld;u.l.CheckExtends(Y,I,P),u.l.CheckExtends(g,I,P)}}return{min:I,max:P}},w._AnimationRangeFactory=function(w,v,I){throw(0,U.e)("AnimationRange")},w._NodeConstructors={},(0,P.i)([(0,Q.J)()],w.prototype,"name",void 0),(0,P.i)([(0,Q.J)()],w.prototype,"id",void 0),(0,P.i)([(0,Q.J)()],w.prototype,"uniqueId",void 0),(0,P.i)([(0,Q.J)()],w.prototype,"state",void 0),(0,P.i)([(0,Q.J)()],w.prototype,"metadata",void 0),w}()},37105:function(w,v,I){"use strict";I.d(v,{d:function(){return Z}});var P,u,Q,K,a,U,p,r=I(78502),Y=I(9217),g=I(19500),J=I(9271),l=I(21901),R=function(){function w(){this._count=0,this._data={}}return w.prototype.copyFrom=function(w){var v=this;this.clear(),w.forEach((function(w,I){return v.add(w,I)}))},w.prototype.get=function(w){var v=this._data[w];if(void 0!==v)return v},w.prototype.getOrAddWithFactory=function(w,v){var I=this.get(w);return void 0!==I||(I=v(w))&&this.add(w,I),I},w.prototype.getOrAdd=function(w,v){var I=this.get(w);return void 0!==I?I:(this.add(w,v),v)},w.prototype.contains=function(w){return void 0!==this._data[w]},w.prototype.add=function(w,v){return void 0===this._data[w]&&(this._data[w]=v,++this._count,!0)},w.prototype.set=function(w,v){return void 0!==this._data[w]&&(this._data[w]=v,!0)},w.prototype.getAndRemove=function(w){var v=this.get(w);return void 0!==v?(delete this._data[w],--this._count,v):null},w.prototype.remove=function(w){return!!this.contains(w)&&(delete this._data[w],--this._count,!0)},w.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(w.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),w.prototype.forEach=function(w){for(var v in this._data){w(v,this._data[v])}},w.prototype.first=function(w){for(var v in this._data){var I=w(v,this._data[v]);if(I)return I}return null},w}(),x=I(45883),j=I(80105),s=I(60569),B=I(23016),t=I(90534),i=I(44904),z=function(){function w(w,v,I,P,u,Q){this.source=w,this.pointerX=v,this.pointerY=I,this.meshUnderPointer=P,this.sourceEvent=u,this.additionalData=Q}return w.CreateNew=function(v,I,P){var u=v.getScene();return new w(v,u.pointerX,u.pointerY,u.meshUnderPointer||v,I,P)},w.CreateNewFromSprite=function(v,I,P,u){return new w(v,I.pointerX,I.pointerY,I.meshUnderPointer,P,u)},w.CreateNewFromScene=function(v,I){return new w(null,v.pointerX,v.pointerY,v.meshUnderPointer,I)},w.CreateNewFromPrimitive=function(v,I,P,u){return new w(v,I.x,I.y,null,P,u)},w}(),E=I(64833),o=I(16369),h=I(21693),n=I(60985),W=I(78588),V=I(50504),F=I(25239),O=function(){function w(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(w,"HasTriggers",{get:function(){for(var v in w.Triggers)if(Object.prototype.hasOwnProperty.call(w.Triggers,v))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(w,"HasPickTriggers",{get:function(){for(var v in w.Triggers)if(Object.prototype.hasOwnProperty.call(w.Triggers,v)){var I=parseInt(v);if(I>=1&&I<=7)return!0}return!1},enumerable:!1,configurable:!0}),w.HasSpecificTrigger=function(v){for(var I in w.Triggers){if(Object.prototype.hasOwnProperty.call(w.Triggers,I))if(parseInt(I)===v)return!0}return!1},w.Triggers={},w}(),N=I(45591);!function(w){w[w.Generic=0]="Generic",w[w.Keyboard=1]="Keyboard",w[w.Mouse=2]="Mouse",w[w.Touch=3]="Touch",w[w.DualShock=4]="DualShock",w[w.Xbox=5]="Xbox",w[w.Switch=6]="Switch",w[w.DualSense=7]="DualSense"}(P||(P={})),function(w){w[w.Horizontal=0]="Horizontal",w[w.Vertical=1]="Vertical",w[w.LeftClick=2]="LeftClick",w[w.MiddleClick=3]="MiddleClick",w[w.RightClick=4]="RightClick",w[w.BrowserBack=5]="BrowserBack",w[w.BrowserForward=6]="BrowserForward",w[w.MouseWheelX=7]="MouseWheelX",w[w.MouseWheelY=8]="MouseWheelY",w[w.MouseWheelZ=9]="MouseWheelZ",w[w.Move=12]="Move"}(u||(u={})),function(w){w[w.Horizontal=0]="Horizontal",w[w.Vertical=1]="Vertical",w[w.LeftClick=2]="LeftClick",w[w.MiddleClick=3]="MiddleClick",w[w.RightClick=4]="RightClick",w[w.BrowserBack=5]="BrowserBack",w[w.BrowserForward=6]="BrowserForward",w[w.MouseWheelX=7]="MouseWheelX",w[w.MouseWheelY=8]="MouseWheelY",w[w.MouseWheelZ=9]="MouseWheelZ",w[w.DeltaHorizontal=10]="DeltaHorizontal",w[w.DeltaVertical=11]="DeltaVertical"}(Q||(Q={})),function(w){w[w.Cross=0]="Cross",w[w.Circle=1]="Circle",w[w.Square=2]="Square",w[w.Triangle=3]="Triangle",w[w.L1=4]="L1",w[w.R1=5]="R1",w[w.L2=6]="L2",w[w.R2=7]="R2",w[w.Share=8]="Share",w[w.Options=9]="Options",w[w.L3=10]="L3",w[w.R3=11]="R3",w[w.DPadUp=12]="DPadUp",w[w.DPadDown=13]="DPadDown",w[w.DPadLeft=14]="DPadLeft",w[w.DPadRight=15]="DPadRight",w[w.Home=16]="Home",w[w.TouchPad=17]="TouchPad",w[w.LStickXAxis=18]="LStickXAxis",w[w.LStickYAxis=19]="LStickYAxis",w[w.RStickXAxis=20]="RStickXAxis",w[w.RStickYAxis=21]="RStickYAxis"}(K||(K={})),function(w){w[w.Cross=0]="Cross",w[w.Circle=1]="Circle",w[w.Square=2]="Square",w[w.Triangle=3]="Triangle",w[w.L1=4]="L1",w[w.R1=5]="R1",w[w.L2=6]="L2",w[w.R2=7]="R2",w[w.Create=8]="Create",w[w.Options=9]="Options",w[w.L3=10]="L3",w[w.R3=11]="R3",w[w.DPadUp=12]="DPadUp",w[w.DPadDown=13]="DPadDown",w[w.DPadLeft=14]="DPadLeft",w[w.DPadRight=15]="DPadRight",w[w.Home=16]="Home",w[w.TouchPad=17]="TouchPad",w[w.LStickXAxis=18]="LStickXAxis",w[w.LStickYAxis=19]="LStickYAxis",w[w.RStickXAxis=20]="RStickXAxis",w[w.RStickYAxis=21]="RStickYAxis"}(a||(a={})),function(w){w[w.A=0]="A",w[w.B=1]="B",w[w.X=2]="X",w[w.Y=3]="Y",w[w.LB=4]="LB",w[w.RB=5]="RB",w[w.LT=6]="LT",w[w.RT=7]="RT",w[w.Back=8]="Back",w[w.Start=9]="Start",w[w.LS=10]="LS",w[w.RS=11]="RS",w[w.DPadUp=12]="DPadUp",w[w.DPadDown=13]="DPadDown",w[w.DPadLeft=14]="DPadLeft",w[w.DPadRight=15]="DPadRight",w[w.Home=16]="Home",w[w.LStickXAxis=17]="LStickXAxis",w[w.LStickYAxis=18]="LStickYAxis",w[w.RStickXAxis=19]="RStickXAxis",w[w.RStickYAxis=20]="RStickYAxis"}(U||(U={})),function(w){w[w.B=0]="B",w[w.A=1]="A",w[w.Y=2]="Y",w[w.X=3]="X",w[w.L=4]="L",w[w.R=5]="R",w[w.ZL=6]="ZL",w[w.ZR=7]="ZR",w[w.Minus=8]="Minus",w[w.Plus=9]="Plus",w[w.LS=10]="LS",w[w.RS=11]="RS",w[w.DPadUp=12]="DPadUp",w[w.DPadDown=13]="DPadDown",w[w.DPadLeft=14]="DPadLeft",w[w.DPadRight=15]="DPadRight",w[w.Home=16]="Home",w[w.Capture=17]="Capture",w[w.LStickXAxis=18]="LStickXAxis",w[w.LStickYAxis=19]="LStickYAxis",w[w.RStickXAxis=20]="RStickXAxis",w[w.RStickYAxis=21]="RStickYAxis"}(p||(p={}));var q=I(13316),m=function(){function w(){}return w.CreateDeviceEvent=function(w,v,I,Q,K,a){switch(w){case P.Keyboard:return this._CreateKeyboardEvent(I,Q,K,a);case P.Mouse:if(I===u.MouseWheelX||I===u.MouseWheelY||I===u.MouseWheelZ)return this._CreateWheelEvent(w,v,I,Q,K,a);case P.Touch:return this._CreatePointerEvent(w,v,I,Q,K,a);default:throw"Unable to generate event for device ".concat(P[w])}},w._CreatePointerEvent=function(w,v,I,Q,K,a){var U=this._CreateMouseEvent(w,v,I,Q,K,a);return w===P.Mouse?(U.deviceType=P.Mouse,U.pointerId=1,U.pointerType="mouse"):(U.deviceType=P.Touch,U.pointerId=v,U.pointerType="touch"),I===u.Move?U.type="pointermove":I>=u.LeftClick&&I<=u.RightClick&&(U.type=1===Q?"pointerdown":"pointerup",U.button=I-2),U},w._CreateWheelEvent=function(w,v,I,P,Q,K){var a=this._CreateMouseEvent(w,v,I,P,Q,K);switch(a.type="wheel",a.deltaMode=q.b.DOM_DELTA_PIXEL,a.deltaX=0,a.deltaY=0,a.deltaZ=0,I){case u.MouseWheelX:a.deltaX=P;break;case u.MouseWheelY:a.deltaY=P;break;case u.MouseWheelZ:a.deltaZ=P}return a},w._CreateMouseEvent=function(w,v,I,P,K,a){var U=this._CreateEvent(a),p=K.pollInput(w,v,u.Horizontal),r=K.pollInput(w,v,u.Vertical);return a?(U.movementX=0,U.movementY=0,U.offsetX=U.movementX-a.getBoundingClientRect().x,U.offsetY=U.movementY-a.getBoundingClientRect().y):(U.movementX=K.pollInput(w,v,Q.DeltaHorizontal),U.movementY=K.pollInput(w,v,Q.DeltaVertical),U.offsetX=0,U.offsetY=0),this._CheckNonCharacterKeys(U,K),U.clientX=p,U.clientY=r,U.x=p,U.y=r,U.deviceType=w,U.deviceSlot=v,U.inputIndex=I,U},w._CreateKeyboardEvent=function(w,v,I,u){var Q=this._CreateEvent(u);return this._CheckNonCharacterKeys(Q,I),Q.deviceType=P.Keyboard,Q.deviceSlot=0,Q.inputIndex=w,Q.type=1===v?"keydown":"keyup",Q.key=String.fromCharCode(w),Q.keyCode=w,Q},w._CheckNonCharacterKeys=function(w,v){var I=v.isDeviceAvailable(P.Keyboard),u=I&&1===v.pollInput(P.Keyboard,0,18),Q=I&&1===v.pollInput(P.Keyboard,0,17),K=I&&(1===v.pollInput(P.Keyboard,0,91)||1===v.pollInput(P.Keyboard,0,92)||1===v.pollInput(P.Keyboard,0,93)),a=I&&1===v.pollInput(P.Keyboard,0,16);w.altKey=u,w.ctrlKey=Q,w.metaKey=K,w.shiftKey=a},w._CreateEvent=function(w){var v={preventDefault:function(){}};return v.target=w,v},w}(),c=function(){function w(w,v,I){var P=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(w,v,(function(w,v,u,Q){var K=m.CreateDeviceEvent(w,v,u,Q,P);I(w,v,K)})):this._createDummyNativeInput()}return w.prototype.pollInput=function(w,v,I){return this._nativeInput.pollInput(w,v,I)},w.prototype.isDeviceAvailable=function(w){return w===P.Mouse||w===P.Touch},w.prototype.dispose=function(){this._nativeInput.dispose()},w.prototype._createDummyNativeInput=function(){return{pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}}},w}(),M=Object.keys(u).length/2,S=function(){function w(w,v,I,P){var u=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=Y.i.IsSafari(),this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(w){},this._keyboardUpEvent=function(w){},this._keyboardBlurEvent=function(w){},this._pointerMoveEvent=function(w){},this._pointerDownEvent=function(w){},this._pointerUpEvent=function(w){},this._pointerCancelEvent=function(w){},this._pointerWheelEvent=function(w){},this._pointerBlurEvent=function(w){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=n.e.IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(w){},this._gamepadDisconnectedEvent=function(w){},this._eventPrefix=Y.i.GetPointerPrefix(w),this._engine=w,this._onDeviceConnected=v,this._onDeviceDisconnected=I,this._onInputChanged=P,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){u._enableEvents()})}return w.prototype.pollInput=function(w,v,I){var Q=this._inputs[w][v];if(!Q)throw"Unable to find device ".concat(P[w]);w>=P.DualShock&&w<=P.DualSense&&this._updateDevice(w,v,I);var K=Q[I];if(void 0===K)throw"Unable to find input ".concat(I," for device ").concat(P[w]," in slot ").concat(v);return I===u.Move&&Y.i.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),K},w.prototype.isDeviceAvailable=function(w){return void 0!==this._inputs[w]},w.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},w.prototype._enableEvents=function(){var w=null===this||void 0===this?void 0:this._engine.getInputElement();if(w&&(!this._eventsAttached||this._elementToAttachTo!==w)){if(this._disableEvents(),this._inputs)for(var v=0,I=this._inputs;v<I.length;v++){var P=I[v];if(P)for(var u in P){var Q=P[+u];if(Q)for(var K=0;K<Q.length;K++)Q[K]=0}}this._elementToAttachTo=w,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},w.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},w.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var w=0,v=navigator.getGamepads();w<v.length;w++){var I=v[w];I&&this._addGamePad(I)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(P.Mouse,0,0,0)},w.prototype._addGamePad=function(w){var v=this._getGamepadDeviceType(w.id),I=w.index;this._gamepads=this._gamepads||new Array(w.index+1),this._registerDevice(v,I,w.buttons.length+w.axes.length),this._gamepads[I]=v},w.prototype._addPointerDevice=function(w,v,I,P){this._pointerActive||(this._pointerActive=!0),this._registerDevice(w,v,M);var u=this._inputs[w][v];u[0]=I,u[1]=P},w.prototype._registerDevice=function(w,v,I){if(void 0===v)throw"Unable to register device ".concat(P[w]," to undefined slot.");if(this._inputs[w]||(this._inputs[w]={}),!this._inputs[w][v]){for(var u=new Array(I),Q=0;Q<I;Q++)u[Q]=0;this._inputs[w][v]=u,this._onDeviceConnected(w,v)}},w.prototype._unregisterDevice=function(w,v){this._inputs[w][v]&&(delete this._inputs[w][v],this._onDeviceDisconnected(w,v))},w.prototype._handleKeyActions=function(){var w=this;this._keyboardDownEvent=function(v){w._keyboardActive||(w._keyboardActive=!0,w._registerDevice(P.Keyboard,0,255));var I=w._inputs[P.Keyboard][0];if(I){I[v.keyCode]=1;var u=v;u.inputIndex=v.keyCode,w._usingMacOS&&v.metaKey&&"Meta"!==v.key&&(w._metaKeys.includes(v.keyCode)||w._metaKeys.push(v.keyCode)),w._onInputChanged(P.Keyboard,0,u)}},this._keyboardUpEvent=function(v){w._keyboardActive||(w._keyboardActive=!0,w._registerDevice(P.Keyboard,0,255));var I=w._inputs[P.Keyboard][0];if(I){I[v.keyCode]=0;var u=v;if(u.inputIndex=v.keyCode,w._usingMacOS&&"Meta"===v.key&&w._metaKeys.length>0){for(var Q=0,K=w._metaKeys;Q<K.length;Q++){var a=K[Q],U=m.CreateDeviceEvent(P.Keyboard,0,a,0,w,w._elementToAttachTo);I[a]=0,w._onInputChanged(P.Keyboard,0,U)}w._metaKeys.splice(0,w._metaKeys.length)}w._onInputChanged(P.Keyboard,0,u)}},this._keyboardBlurEvent=function(){if(w._keyboardActive){for(var v=w._inputs[P.Keyboard][0],I=0;I<v.length;I++)if(0!==v[I]){v[I]=0;var u=m.CreateDeviceEvent(P.Keyboard,0,I,0,w,w._elementToAttachTo);w._onInputChanged(P.Keyboard,0,u)}w._usingMacOS&&w._metaKeys.splice(0,w._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},w.prototype._handlePointerActions=function(){var w=this;this._maxTouchPoints=n.e.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var v=0;v<this._maxTouchPoints;v++)this._activeTouchIds[v]=-1;this._pointerMoveEvent=function(v){var I=w._getPointerType(v),Q=I===P.Mouse?0:w._activeTouchIds.indexOf(v.pointerId);w._inputs[I]||(w._inputs[I]={}),w._inputs[I][Q]||w._addPointerDevice(I,Q,v.clientX,v.clientY);var K=w._inputs[I][Q];if(K){K[u.Horizontal]=v.clientX,K[u.Vertical]=v.clientY;var a=v;a.inputIndex=u.Move,w._onInputChanged(I,Q,a),w._usingSafari||-1===v.button||(a.inputIndex=v.button+2,K[v.button+2]=K[v.button+2]?0:1,w._onInputChanged(I,Q,a))}},this._pointerDownEvent=function(v){var I=w._getPointerType(v),Q=I===P.Mouse?0:v.pointerId;if(I===P.Touch){var K=w._activeTouchIds.indexOf(-1);if(!(K>=0))return void Y.i.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(w._maxTouchPoints));Q=K,w._activeTouchIds[K]=v.pointerId}w._inputs[I]||(w._inputs[I]={}),w._inputs[I][Q]?I===P.Touch&&w._onDeviceConnected(I,Q):w._addPointerDevice(I,Q,v.clientX,v.clientY);var a=w._inputs[I][Q];if(a){var U=a[u.Horizontal],p=a[u.Vertical];if(I===P.Mouse){if(-1===w._mouseId&&(void 0===v.pointerId?w._mouseId=w._isUsingFirefox?0:1:w._mouseId=v.pointerId),!document.pointerLockElement)try{w._elementToAttachTo.setPointerCapture(w._mouseId)}catch(w){}}else if(v.pointerId&&!document.pointerLockElement)try{w._elementToAttachTo.setPointerCapture(v.pointerId)}catch(w){}a[u.Horizontal]=v.clientX,a[u.Vertical]=v.clientY,a[v.button+2]=1;var r=v;r.inputIndex=v.button+2,w._onInputChanged(I,Q,r),U===v.clientX&&p===v.clientY||(r.inputIndex=u.Move,w._onInputChanged(I,Q,r))}},this._pointerUpEvent=function(v){var I,Q,K,a,U,p=w._getPointerType(v),r=p===P.Mouse?0:w._activeTouchIds.indexOf(v.pointerId);if(p===P.Touch){if(-1===r)return;w._activeTouchIds[r]=-1}var Y=null===(I=w._inputs[p])||void 0===I?void 0:I[r];if(Y&&0!==Y[v.button+2]){var g=Y[u.Horizontal],J=Y[u.Vertical];Y[u.Horizontal]=v.clientX,Y[u.Vertical]=v.clientY,Y[v.button+2]=0;var l=v;g===v.clientX&&J===v.clientY||(l.inputIndex=u.Move,w._onInputChanged(p,r,l)),l.inputIndex=v.button+2,p===P.Mouse&&w._mouseId>=0&&(null===(K=(Q=w._elementToAttachTo).hasPointerCapture)||void 0===K?void 0:K.call(Q,w._mouseId))?w._elementToAttachTo.releasePointerCapture(w._mouseId):v.pointerId&&(null===(U=(a=w._elementToAttachTo).hasPointerCapture)||void 0===U?void 0:U.call(a,v.pointerId))&&w._elementToAttachTo.releasePointerCapture(v.pointerId),w._onInputChanged(p,r,l),p===P.Touch&&w._onDeviceDisconnected(p,r)}},this._pointerCancelEvent=function(v){var I,Q,K,a;if("mouse"===v.pointerType){var U=w._inputs[P.Mouse][0];w._mouseId>=0&&(null===(Q=(I=w._elementToAttachTo).hasPointerCapture)||void 0===Q?void 0:Q.call(I,w._mouseId))&&w._elementToAttachTo.releasePointerCapture(w._mouseId);for(var p=u.LeftClick;p<=u.BrowserForward;p++)if(1===U[p]){U[p]=0;var r=m.CreateDeviceEvent(P.Mouse,0,p,0,w,w._elementToAttachTo);w._onInputChanged(P.Mouse,0,r)}}else{var Y=w._activeTouchIds.indexOf(v.pointerId);(null===(a=(K=w._elementToAttachTo).hasPointerCapture)||void 0===a?void 0:a.call(K,v.pointerId))&&w._elementToAttachTo.releasePointerCapture(v.pointerId),w._inputs[P.Touch][Y][u.LeftClick]=0;r=m.CreateDeviceEvent(P.Touch,Y,u.LeftClick,0,w,w._elementToAttachTo);w._onInputChanged(P.Touch,Y,r),w._activeTouchIds[Y]=-1,w._onDeviceDisconnected(P.Touch,Y)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";var I=!1,Q=function(){};try{var K=Object.defineProperty({},"passive",{get:function(){I=!0}});this._elementToAttachTo.addEventListener("test",Q,K),this._elementToAttachTo.removeEventListener("test",Q,K)}catch(w){}this._pointerBlurEvent=function(){var v,I,Q,K,a;if(w.isDeviceAvailable(P.Mouse)){var U=w._inputs[P.Mouse][0];w._mouseId>=0&&(null===(I=(v=w._elementToAttachTo).hasPointerCapture)||void 0===I?void 0:I.call(v,w._mouseId))&&w._elementToAttachTo.releasePointerCapture(w._mouseId);for(var p=u.LeftClick;p<=u.BrowserForward;p++)if(1===U[p]){U[p]=0;var r=m.CreateDeviceEvent(P.Mouse,0,p,0,w,w._elementToAttachTo);w._onInputChanged(P.Mouse,0,r)}}if(w.isDeviceAvailable(P.Touch)){U=w._inputs[P.Touch];for(var Y=0;Y<w._activeTouchIds.length;Y++){var g=w._activeTouchIds[Y];if((null===(K=(Q=w._elementToAttachTo).hasPointerCapture)||void 0===K?void 0:K.call(Q,g))&&w._elementToAttachTo.releasePointerCapture(g),-1!==g&&1===(null===(a=U[Y])||void 0===a?void 0:a[u.LeftClick])){U[Y][u.LeftClick]=0;r=m.CreateDeviceEvent(P.Touch,Y,u.LeftClick,0,w,w._elementToAttachTo);w._onInputChanged(P.Touch,Y,r),w._activeTouchIds[Y]=-1,w._onDeviceDisconnected(P.Touch,Y)}}}},this._pointerWheelEvent=function(v){var I=P.Mouse;w._inputs[I]||(w._inputs[I]=[]),w._inputs[I][0]||(w._pointerActive=!0,w._registerDevice(I,0,M));var Q=w._inputs[I][0];if(Q){Q[u.MouseWheelX]=v.deltaX||0,Q[u.MouseWheelY]=v.deltaY||v.wheelDelta||0,Q[u.MouseWheelZ]=v.deltaZ||0;var K=v;0!==Q[u.MouseWheelX]&&(K.inputIndex=u.MouseWheelX,w._onInputChanged(I,0,K)),0!==Q[u.MouseWheelY]&&(K.inputIndex=u.MouseWheelY,w._onInputChanged(I,0,K)),0!==Q[u.MouseWheelZ]&&(K.inputIndex=u.MouseWheelZ,w._onInputChanged(I,0,K))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!I&&{passive:!0}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((function(){if(w.isDeviceAvailable(P.Mouse)){var v=w._inputs[P.Mouse][0];v[u.MouseWheelX]=0,v[u.MouseWheelY]=0,v[u.MouseWheelZ]=0}}))},w.prototype._handleGamepadActions=function(){var w=this;this._gamepadConnectedEvent=function(v){w._addGamePad(v.gamepad)},this._gamepadDisconnectedEvent=function(v){if(w._gamepads){var I=w._getGamepadDeviceType(v.gamepad.id),P=v.gamepad.index;w._unregisterDevice(I,P),delete w._gamepads[P]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},w.prototype._updateDevice=function(w,v,I){var P=navigator.getGamepads()[v];if(P&&w===this._gamepads[v]){var u=this._inputs[w][v];I>=P.buttons.length?u[I]=P.axes[I-P.buttons.length].valueOf():u[I]=P.buttons[I].value}},w.prototype._getGamepadDeviceType=function(w){return-1!==w.indexOf("054c")?-1!==w.indexOf("0ce6")?P.DualSense:P.DualShock:-1!==w.indexOf("Xbox One")||-1!==w.search("Xbox 360")||-1!==w.search("xinput")?P.Xbox:-1!==w.indexOf("057e")?P.Switch:P.Generic},w.prototype._getPointerType=function(w){var v=P.Mouse;return("touch"===w.pointerType||"pen"===w.pointerType||w.touches)&&(v=P.Touch),v},w}(),e=function(){function w(w,v,I){void 0===I&&(I=0),this.deviceType=v,this.deviceSlot=I,this.onInputChangedObservable=new J.c,this._deviceInputSystem=w}return w.prototype.getInput=function(w){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,w)},w}(),H=function(){function w(w){var v=this;this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(w){for(var I=0;I<v._devices.length;I++){var P=v._devices[I];for(var u in P){var Q=+u;w._addDevice(new e(v._deviceInputSystem,I,Q))}}v._registeredManagers.push(w)},this.unregisterManager=function(w){var I=v._registeredManagers.indexOf(w);I>-1&&v._registeredManagers.splice(I,1)};var I=Object.keys(P).length/2;this._devices=new Array(I);var u=function(w,I){v._devices[w]||(v._devices[w]=new Array),v._devices[w][I]||(v._devices[w][I]=I);for(var P=0,u=v._registeredManagers;P<u.length;P++){var Q=u[P],K=new e(v._deviceInputSystem,w,I);Q._addDevice(K)}},Q=function(w,I){var P;(null===(P=v._devices[w])||void 0===P?void 0:P[I])&&delete v._devices[w][I];for(var u=0,Q=v._registeredManagers;u<Q.length;u++){Q[u]._removeDevice(w,I)}},K=function(w,I,P){if(P)for(var u=0,Q=v._registeredManagers;u<Q.length;u++){Q[u]._onInputChanged(w,I,P)}};"undefined"!==typeof _native?this._deviceInputSystem=new c(u,Q,K):this._deviceInputSystem=new S(w,u,Q,K)}return w.prototype.dispose=function(){this._deviceInputSystem.dispose()},w}(),G=function(){function w(w){var v=this,I=Object.keys(P).length/2;this._devices=new Array(I),this._firstDevice=new Array(I),this._engine=w,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new H(w)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new J.c((function(w){for(var I=0,P=v._devices;I<P.length;I++){var u=P[I];if(u)for(var Q=0,K=u;Q<K.length;Q++){var a=K[Q];a&&v.onDeviceConnectedObservable.notifyObserver(w,a)}}})),this.onDeviceDisconnectedObservable=new J.c,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=w.onDisposeObservable.add((function(){v.dispose()}))}return w.prototype.getDeviceSource=function(w,v){if(void 0===v){if(void 0===this._firstDevice[w])return null;v=this._firstDevice[w]}return this._devices[w]&&void 0!==this._devices[w][v]?this._devices[w][v]:null},w.prototype.getDeviceSources=function(w){return this._devices[w].filter((function(w){return!!w}))},w.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},w.prototype._addDevice=function(w){this._devices[w.deviceType]||(this._devices[w.deviceType]=new Array),this._devices[w.deviceType][w.deviceSlot]||(this._devices[w.deviceType][w.deviceSlot]=w,this._updateFirstDevices(w.deviceType)),this.onDeviceConnectedObservable.notifyObservers(w)},w.prototype._removeDevice=function(w,v){var I,P,u=null===(I=this._devices[w])||void 0===I?void 0:I[v];this.onDeviceDisconnectedObservable.notifyObservers(u),(null===(P=this._devices[w])||void 0===P?void 0:P[v])&&delete this._devices[w][v],this._updateFirstDevices(w)},w.prototype._onInputChanged=function(w,v,I){var P,u;null===(u=null===(P=this._devices[w])||void 0===P?void 0:P[v])||void 0===u||u.onInputChangedObservable.notifyObservers(I)},w.prototype._updateFirstDevices=function(w){switch(w){case P.Keyboard:case P.Mouse:this._firstDevice[w]=0;break;case P.Touch:case P.DualSense:case P.DualShock:case P.Xbox:case P.Switch:case P.Generic:delete this._firstDevice[w];var v=this._devices[w];if(v)for(var I=0;I<v.length;I++)if(v[I]){this._firstDevice[w]=I;break}}},w}(),L=function(){function w(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(w.prototype,"singleClick",{get:function(){return this._singleClick},set:function(w){this._singleClick=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(w){this._doubleClick=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(w){this._hasSwiped=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"ignore",{get:function(){return this._ignore},set:function(w){this._ignore=w},enumerable:!1,configurable:!0}),w}(),d=function(){function w(w){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new j.k(0,0),this._previousStartingPointerPosition=new j.k(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=w||W.e.LastCreatedScene,this._scene}return Object.defineProperty(w.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),w.prototype.getMeshUnderPointerByPointerId=function(w){return this._meshUnderPointerId[w]||null},Object.defineProperty(w.prototype,"unTranslatedPointer",{get:function(){return new j.k(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"pointerX",{get:function(){return this._pointerX},set:function(w){this._pointerX=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"pointerY",{get:function(){return this._pointerY},set:function(w){this._pointerY=w},enumerable:!1,configurable:!0}),w.prototype._updatePointerPosition=function(w){var v=this._scene.getEngine().getInputElementClientRect();v&&(this._pointerX=w.clientX-v.left,this._pointerY=w.clientY-v.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},w.prototype._processPointerMove=function(w,v){var I=this._scene,P=I.getEngine(),u=P.getInputElement();u&&(u.tabIndex=P.canvasTabIndex,I.doNotHandleCursors||(u.style.cursor=I.defaultCursor));var Q=!!(w&&w.hit&&w.pickedMesh);if(Q){if(I.setPointerOverMesh(w.pickedMesh,v.pointerId,w),!I.doNotHandleCursors&&u&&this._pointerOverMesh){var K=this._pointerOverMesh._getActionManagerForTrigger();K&&K.hasPointerTriggers&&(u.style.cursor=K.hoverCursor||I.hoverCursor)}}else I.setPointerOverMesh(null,v.pointerId,w);for(var a=0,U=I._pointerMoveStage;a<U.length;a++){w=U[a].action(this._unTranslatedPointerX,this._unTranslatedPointerY,w,Q,u)}if(w){var p="wheel"===v.type||"mousewheel"===v.type||"DOMMouseScroll"===v.type?F.e.POINTERWHEEL:F.e.POINTERMOVE;if(I.onPointerMove&&I.onPointerMove(v,w,p),I.onPointerObservable.hasObservers()){var r=new F.m(p,v,w);this._setRayOnPointerInfo(r),I.onPointerObservable.notifyObservers(r,p)}}},w.prototype._setRayOnPointerInfo=function(w){var v=this._scene;w.pickInfo&&!w.pickInfo._pickingUnavailable&&(w.pickInfo.ray||(w.pickInfo.ray=v.createPickingRay(w.event.offsetX,w.event.offsetY,j.e.Identity(),v.activeCamera)))},w.prototype._checkPrePointerObservable=function(w,v,I){var P=this._scene,u=new F.i(I,v,this._unTranslatedPointerX,this._unTranslatedPointerY);return w&&(u.ray=w.ray,w.originMesh&&(u.nearInteractionPickingInfo=w)),P.onPrePointerObservable.notifyObservers(u,I),!!u.skipOnPointerObservable},w.prototype.simulatePointerMove=function(w,v){var I=new PointerEvent("pointermove",v);I.inputIndex=u.Move,this._checkPrePointerObservable(w,I,F.e.POINTERMOVE)||this._processPointerMove(w,I)},w.prototype.simulatePointerDown=function(w,v){var I=new PointerEvent("pointerdown",v);I.inputIndex=I.button+2,this._checkPrePointerObservable(w,I,F.e.POINTERDOWN)||this._processPointerDown(w,I)},w.prototype._processPointerDown=function(v,I){var P=this,u=this._scene;if(v&&v.hit&&v.pickedMesh){this._pickedDownMesh=v.pickedMesh;var Q=v.pickedMesh._getActionManagerForTrigger();if(Q){if(Q.hasPickTriggers)switch(Q.processTrigger(5,z.CreateNew(v.pickedMesh,I)),I.button){case 0:Q.processTrigger(2,z.CreateNew(v.pickedMesh,I));break;case 1:Q.processTrigger(4,z.CreateNew(v.pickedMesh,I));break;case 2:Q.processTrigger(3,z.CreateNew(v.pickedMesh,I))}Q.hasSpecificTrigger(8)&&window.setTimeout((function(){var v=u.pick(P._unTranslatedPointerX,P._unTranslatedPointerY,(function(w){return w.isPickable&&w.isVisible&&w.isReady()&&w.actionManager&&w.actionManager.hasSpecificTrigger(8)&&w===P._pickedDownMesh}),!1,u.cameraToUseForPointers);v&&v.hit&&v.pickedMesh&&Q&&0!==P._totalPointersPressed&&Date.now()-P._startingPointerTime>w.LongPressDelay&&!P._isPointerSwiping()&&(P._startingPointerTime=0,Q.processTrigger(8,z.CreateNew(v.pickedMesh,I)))}),w.LongPressDelay)}}else for(var K=0,a=u._pointerDownStage;K<a.length;K++){v=a[K].action(this._unTranslatedPointerX,this._unTranslatedPointerY,v,I)}if(v){var U=F.e.POINTERDOWN;if(u.onPointerDown&&u.onPointerDown(I,v,U),u.onPointerObservable.hasObservers()){var p=new F.m(U,I,v);this._setRayOnPointerInfo(p),u.onPointerObservable.notifyObservers(p,U)}}},w.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>w.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>w.DragMovementThreshold},w.prototype.simulatePointerUp=function(w,v,I){var P=new PointerEvent("pointerup",v);P.inputIndex=u.Move;var Q=new L;I?Q.doubleClick=!0:Q.singleClick=!0,this._checkPrePointerObservable(w,P,F.e.POINTERUP)||this._processPointerUp(w,P,Q)},w.prototype._processPointerUp=function(w,v,I){var P=this._scene;if(w&&w.hit&&w.pickedMesh){if(this._pickedUpMesh=w.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(P.onPointerPick&&P.onPointerPick(v,w),I.singleClick&&!I.ignore&&P.onPointerObservable.hasObservers())){var u=F.e.POINTERPICK,Q=new F.m(u,v,w);this._setRayOnPointerInfo(Q),P.onPointerObservable.notifyObservers(Q,u)}var K=w.pickedMesh._getActionManagerForTrigger();if(K&&!I.ignore){K.processTrigger(7,z.CreateNew(w.pickedMesh,v,w)),!I.hasSwiped&&I.singleClick&&K.processTrigger(1,z.CreateNew(w.pickedMesh,v,w));var a=w.pickedMesh._getActionManagerForTrigger(6);I.doubleClick&&a&&a.processTrigger(6,z.CreateNew(w.pickedMesh,v,w))}}else if(!I.ignore)for(var U=0,p=P._pointerUpStage;U<p.length;U++){w=p[U].action(this._unTranslatedPointerX,this._unTranslatedPointerY,w,v)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var r=this._pickedDownMesh._getActionManagerForTrigger(16);r&&r.processTrigger(16,z.CreateNew(this._pickedDownMesh,v))}var Y=0;if(P.onPointerObservable.hasObservers()){if(!I.ignore&&!I.hasSwiped&&(I.singleClick&&P.onPointerObservable.hasSpecificMask(F.e.POINTERTAP)?Y=F.e.POINTERTAP:I.doubleClick&&P.onPointerObservable.hasSpecificMask(F.e.POINTERDOUBLETAP)&&(Y=F.e.POINTERDOUBLETAP),Y)){Q=new F.m(Y,v,w);this._setRayOnPointerInfo(Q),P.onPointerObservable.notifyObservers(Q,Y)}if(!I.ignore){Y=F.e.POINTERUP;Q=new F.m(Y,v,w);this._setRayOnPointerInfo(Q),P.onPointerObservable.notifyObservers(Q,Y)}}P.onPointerUp&&!I.ignore&&P.onPointerUp(v,w,Y)},w.prototype.isPointerCaptured=function(w){return void 0===w&&(w=0),this._pointerCaptures[w]},w.prototype.attachControl=function(v,I,Q,K){var a=this;void 0===v&&(v=!0),void 0===I&&(I=!0),void 0===Q&&(Q=!0),void 0===K&&(K=null);var U=this._scene,p=U.getEngine();K||(K=p.getInputElement()),this._alreadyAttached&&this.detachControl(),K&&(this._alreadyAttachedTo=K),this._deviceSourceManager=new G(p),this._initActionManager=function(w){if(!a._meshPickProceed){var v=U.skipPointerUpPicking?null:U.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,U.pointerUpPredicate,!1,U.cameraToUseForPointers);a._currentPickResult=v,v&&(w=v.hit&&v.pickedMesh?v.pickedMesh._getActionManagerForTrigger():null),a._meshPickProceed=!0}return w},this._delayedSimpleClick=function(v,I,P){(Date.now()-a._previousStartingPointerTime>w.DoubleClickDelay&&!a._doubleClickOccured||v!==a._previousButtonPressed)&&(a._doubleClickOccured=!1,I.singleClick=!0,I.ignore=!1,P(I,a._currentPickResult))},this._initClickEvent=function(v,I,P,u){var Q=new L;a._currentPickResult=null;var K=null,U=v.hasSpecificMask(F.e.POINTERPICK)||I.hasSpecificMask(F.e.POINTERPICK)||v.hasSpecificMask(F.e.POINTERTAP)||I.hasSpecificMask(F.e.POINTERTAP)||v.hasSpecificMask(F.e.POINTERDOUBLETAP)||I.hasSpecificMask(F.e.POINTERDOUBLETAP);!U&&O&&(K=a._initActionManager(K,Q))&&(U=K.hasPickTriggers);var p=!1;if(U){var r=P.button;if(Q.hasSwiped=a._isPointerSwiping(),!Q.hasSwiped){var Y=!w.ExclusiveDoubleClickMode;Y||(Y=!v.hasSpecificMask(F.e.POINTERDOUBLETAP)&&!I.hasSpecificMask(F.e.POINTERDOUBLETAP))&&!O.HasSpecificTrigger(6)&&(K=a._initActionManager(K,Q))&&(Y=!K.hasSpecificTrigger(6)),Y?(Date.now()-a._previousStartingPointerTime>w.DoubleClickDelay||r!==a._previousButtonPressed)&&(Q.singleClick=!0,u(Q,a._currentPickResult),p=!0):(a._previousDelayedSimpleClickTimeout=a._delayedSimpleClickTimeout,a._delayedSimpleClickTimeout=window.setTimeout(a._delayedSimpleClick.bind(a,r,Q,u),w.DoubleClickDelay));var g=v.hasSpecificMask(F.e.POINTERDOUBLETAP)||I.hasSpecificMask(F.e.POINTERDOUBLETAP);!g&&O.HasSpecificTrigger(6)&&(K=a._initActionManager(K,Q))&&(g=K.hasSpecificTrigger(6)),g&&(r===a._previousButtonPressed&&Date.now()-a._previousStartingPointerTime<w.DoubleClickDelay&&!a._doubleClickOccured?(Q.hasSwiped||a._isPointerSwiping()?(a._doubleClickOccured=!1,a._previousStartingPointerTime=a._startingPointerTime,a._previousStartingPointerPosition.x=a._startingPointerPosition.x,a._previousStartingPointerPosition.y=a._startingPointerPosition.y,a._previousButtonPressed=r,w.ExclusiveDoubleClickMode?(a._previousDelayedSimpleClickTimeout&&clearTimeout(a._previousDelayedSimpleClickTimeout),a._previousDelayedSimpleClickTimeout=a._delayedSimpleClickTimeout,u(Q,a._previousPickResult)):u(Q,a._currentPickResult)):(a._previousStartingPointerTime=0,a._doubleClickOccured=!0,Q.doubleClick=!0,Q.ignore=!1,w.ExclusiveDoubleClickMode&&a._previousDelayedSimpleClickTimeout&&clearTimeout(a._previousDelayedSimpleClickTimeout),a._previousDelayedSimpleClickTimeout=a._delayedSimpleClickTimeout,u(Q,a._currentPickResult)),p=!0):(a._doubleClickOccured=!1,a._previousStartingPointerTime=a._startingPointerTime,a._previousStartingPointerPosition.x=a._startingPointerPosition.x,a._previousStartingPointerPosition.y=a._startingPointerPosition.y,a._previousButtonPressed=r))}}p||u(Q,a._currentPickResult)},this._onPointerMove=function(w){if(void 0===w.pointerId&&(w.pointerId=0),a._updatePointerPosition(w),!a._checkPrePointerObservable(null,w,"wheel"===w.type||"mousewheel"===w.type||"DOMMouseScroll"===w.type?F.e.POINTERWHEEL:F.e.POINTERMOVE)&&(U.cameraToUseForPointers||U.activeCamera))if(U.skipPointerMovePicking)a._processPointerMove(new i.d,w);else{U.pointerMovePredicate||(U.pointerMovePredicate=function(w){return w.isPickable&&w.isVisible&&w.isReady()&&w.isEnabled()&&(w.enablePointerMoveEvents||U.constantlyUpdateMeshUnderPointer||null!==w._getActionManagerForTrigger())&&(!U.cameraToUseForPointers||0!==(U.cameraToUseForPointers.layerMask&w.layerMask))});var v=U.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,U.pointerMovePredicate,!1,U.cameraToUseForPointers,U.pointerMoveTrianglePredicate);a._processPointerMove(v,w)}},this._onPointerDown=function(w){var v;(a._totalPointersPressed++,a._pickedDownMesh=null,a._meshPickProceed=!1,void 0===w.pointerId&&(w.pointerId=0),a._updatePointerPosition(w),U.preventDefaultOnPointerDown&&K&&(w.preventDefault(),K.focus()),a._startingPointerPosition.x=a._pointerX,a._startingPointerPosition.y=a._pointerY,a._startingPointerTime=Date.now(),a._checkPrePointerObservable(null,w,F.e.POINTERDOWN))||(U.cameraToUseForPointers||U.activeCamera)&&(a._pointerCaptures[w.pointerId]=!0,U.pointerDownPredicate||(U.pointerDownPredicate=function(w){return w.isPickable&&w.isVisible&&w.isReady()&&w.isEnabled()&&(!U.cameraToUseForPointers||0!==(U.cameraToUseForPointers.layerMask&w.layerMask))}),a._pickedDownMesh=null,v=U.skipPointerDownPicking?new i.d:U.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,U.pointerDownPredicate,!1,U.cameraToUseForPointers),a._processPointerDown(v,w))},this._onPointerUp=function(w){0!==a._totalPointersPressed&&(a._totalPointersPressed--,a._pickedUpMesh=null,a._meshPickProceed=!1,void 0===w.pointerId&&(w.pointerId=0),a._updatePointerPosition(w),U.preventDefaultOnPointerUp&&K&&(w.preventDefault(),K.focus()),a._initClickEvent(U.onPrePointerObservable,U.onPointerObservable,w,(function(v,I){if(U.onPrePointerObservable.hasObservers()&&!v.ignore){if(!v.hasSwiped){if(v.singleClick&&U.onPrePointerObservable.hasSpecificMask(F.e.POINTERTAP)&&a._checkPrePointerObservable(null,w,F.e.POINTERTAP))return;if(v.doubleClick&&U.onPrePointerObservable.hasSpecificMask(F.e.POINTERDOUBLETAP)&&a._checkPrePointerObservable(null,w,F.e.POINTERDOUBLETAP))return}if(a._checkPrePointerObservable(null,w,F.e.POINTERUP))return}!a._pointerCaptures[w.pointerId]&&w.buttons>0||(a._pointerCaptures[w.pointerId]=!1,(U.cameraToUseForPointers||U.activeCamera)&&(U.pointerUpPredicate||(U.pointerUpPredicate=function(w){return w.isPickable&&w.isVisible&&w.isReady()&&w.isEnabled()&&(!U.cameraToUseForPointers||0!==(U.cameraToUseForPointers.layerMask&w.layerMask))}),!a._meshPickProceed&&(O&&O.HasTriggers||U.onPointerObservable.hasObservers())&&a._initActionManager(null,v),I||(I=a._currentPickResult),a._processPointerUp(I,w,v),a._previousPickResult=a._currentPickResult))})))},this._onKeyDown=function(w){var v=N.d.KEYDOWN;if(U.onPreKeyboardObservable.hasObservers()){var I=new N.f(v,w);if(U.onPreKeyboardObservable.notifyObservers(I,v),I.skipOnKeyboardObservable)return}if(U.onKeyboardObservable.hasObservers()){I=new N.g(v,w);U.onKeyboardObservable.notifyObservers(I,v)}U.actionManager&&U.actionManager.processTrigger(14,z.CreateNewFromScene(U,w))},this._onKeyUp=function(w){var v=N.d.KEYUP;if(U.onPreKeyboardObservable.hasObservers()){var I=new N.f(v,w);if(U.onPreKeyboardObservable.notifyObservers(I,v),I.skipOnKeyboardObservable)return}if(U.onKeyboardObservable.hasObservers()){I=new N.g(v,w);U.onKeyboardObservable.notifyObservers(I,v)}U.actionManager&&U.actionManager.processTrigger(15,z.CreateNewFromScene(U,w))},this._deviceSourceManager.onDeviceConnectedObservable.add((function(w){w.deviceType===P.Mouse?w.onInputChangedObservable.add((function(P){P.inputIndex===u.LeftClick||P.inputIndex===u.MiddleClick||P.inputIndex===u.RightClick?I&&1===w.getInput(P.inputIndex)?a._onPointerDown(P):v&&0===w.getInput(P.inputIndex)&&a._onPointerUp(P):Q&&(P.inputIndex===u.Move?a._onPointerMove(P):P.inputIndex!==u.MouseWheelX&&P.inputIndex!==u.MouseWheelY&&P.inputIndex!==u.MouseWheelZ||a._onPointerMove(P))})):w.deviceType===P.Touch?w.onInputChangedObservable.add((function(P){P.inputIndex===u.LeftClick&&(I&&1===w.getInput(P.inputIndex)?a._onPointerDown(P):v&&0===w.getInput(P.inputIndex)&&a._onPointerUp(P)),Q&&P.inputIndex===u.Move&&a._onPointerMove(P)})):w.deviceType===P.Keyboard&&w.onInputChangedObservable.add((function(w){"keydown"===w.type?a._onKeyDown(w):"keyup"===w.type&&a._onKeyUp(w)}))})),this._alreadyAttached=!0},w.prototype.detachControl=function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)},w.prototype.setPointerOverMesh=function(w,v,I){if(void 0===v&&(v=0),this._meshUnderPointerId[v]!==w){var P,u=this._meshUnderPointerId[v];u&&(P=u._getActionManagerForTrigger(10))&&P.processTrigger(10,z.CreateNew(u,void 0,{pointerId:v})),w?(this._meshUnderPointerId[v]=w,this._pointerOverMesh=w,(P=w._getActionManagerForTrigger(9))&&P.processTrigger(9,z.CreateNew(w,void 0,{pointerId:v,pickResult:I}))):(delete this._meshUnderPointerId[v],this._pointerOverMesh=null)}},w.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},w.prototype._invalidateMesh=function(w){for(var v in this._pointerOverMesh===w&&(this._pointerOverMesh=null),this._pickedDownMesh===w&&(this._pickedDownMesh=null),this._pickedUpMesh===w&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[v]===w&&delete this._meshUnderPointerId[v]},w.DragMovementThreshold=10,w.LongPressDelay=500,w.DoubleClickDelay=300,w.ExclusiveDoubleClickMode=!1,w}(),D=I(16945),f=I(9488),b=I(46647),k=I(45934),C=I(82790),y=I(21876),T=function(){function w(v,I){w.IsAvailable&&(this._observer=new window.ComputePressureObserver(v,I))}return Object.defineProperty(w,"IsAvailable",{get:function(){return(0,n.r)()&&"ComputePressureObserver"in window},enumerable:!1,configurable:!0}),w.prototype.observe=function(){var w,v;(null===(w=this._observer)||void 0===w?void 0:w.observe)&&(null===(v=this._observer)||void 0===v||v.observe().catch((function(){})))},w.prototype.unobserve=function(){var w,v;(null===(w=this._observer)||void 0===w?void 0:w.unobserve)&&(null===(v=this._observer)||void 0===v||v.unobserve())},w}(),Z=function(w){function v(I,P){var u=w.call(this)||this;u._inputManager=new d(u),u.cameraToUseForPointers=null,u._isScene=!0,u._blockEntityCollection=!1,u.autoClear=!0,u.autoClearDepthAndStencil=!0,u.clearColor=new f.f(.2,.2,.3,1),u.ambientColor=new f.b(0,0,0),u.environmentIntensity=1,u._forceWireframe=!1,u._skipFrustumClipping=!1,u._forcePointsCloud=!1,u.animationsEnabled=!0,u._animationPropertiesOverride=null,u.useConstantAnimationDeltaTime=!1,u.constantlyUpdateMeshUnderPointer=!1,u.hoverCursor="pointer",u.defaultCursor="",u.doNotHandleCursors=!1,u.preventDefaultOnPointerDown=!0,u.preventDefaultOnPointerUp=!0,u.metadata=null,u.reservedDataStore=null,u.disableOfflineSupportExceptionRules=new Array,u.onDisposeObservable=new J.c,u._onDisposeObserver=null,u.onBeforeRenderObservable=new J.c,u._onBeforeRenderObserver=null,u.onAfterRenderObservable=new J.c,u.onAfterRenderCameraObservable=new J.c,u._onAfterRenderObserver=null,u.onBeforeAnimationsObservable=new J.c,u.onAfterAnimationsObservable=new J.c,u.onBeforeDrawPhaseObservable=new J.c,u.onAfterDrawPhaseObservable=new J.c,u.onReadyObservable=new J.c,u.onBeforeCameraRenderObservable=new J.c,u._onBeforeCameraRenderObserver=null,u.onAfterCameraRenderObservable=new J.c,u._onAfterCameraRenderObserver=null,u.onBeforeActiveMeshesEvaluationObservable=new J.c,u.onAfterActiveMeshesEvaluationObservable=new J.c,u.onBeforeParticlesRenderingObservable=new J.c,u.onAfterParticlesRenderingObservable=new J.c,u.onDataLoadedObservable=new J.c,u.onNewCameraAddedObservable=new J.c,u.onCameraRemovedObservable=new J.c,u.onNewLightAddedObservable=new J.c,u.onLightRemovedObservable=new J.c,u.onNewGeometryAddedObservable=new J.c,u.onGeometryRemovedObservable=new J.c,u.onNewTransformNodeAddedObservable=new J.c,u.onTransformNodeRemovedObservable=new J.c,u.onNewMeshAddedObservable=new J.c,u.onMeshRemovedObservable=new J.c,u.onNewSkeletonAddedObservable=new J.c,u.onSkeletonRemovedObservable=new J.c,u.onNewMaterialAddedObservable=new J.c,u.onNewMultiMaterialAddedObservable=new J.c,u.onMaterialRemovedObservable=new J.c,u.onMultiMaterialRemovedObservable=new J.c,u.onNewTextureAddedObservable=new J.c,u.onTextureRemovedObservable=new J.c,u.onBeforeRenderTargetsRenderObservable=new J.c,u.onAfterRenderTargetsRenderObservable=new J.c,u.onBeforeStepObservable=new J.c,u.onAfterStepObservable=new J.c,u.onActiveCameraChanged=new J.c,u.onBeforeRenderingGroupObservable=new J.c,u.onAfterRenderingGroupObservable=new J.c,u.onMeshImportedObservable=new J.c,u.onAnimationFileImportedObservable=new J.c,u._registeredForLateAnimationBindings=new l.c(256),u.skipPointerMovePicking=!1,u.skipPointerDownPicking=!1,u.skipPointerUpPicking=!1,u.onPrePointerObservable=new J.c,u.onPointerObservable=new J.c,u.onPreKeyboardObservable=new J.c,u.onKeyboardObservable=new J.c,u._useRightHandedSystem=!1,u._timeAccumulator=0,u._currentStepId=0,u._currentInternalStep=0,u._fogEnabled=!0,u._fogMode=v.FOGMODE_NONE,u.fogColor=new f.b(.2,.2,.3),u.fogDensity=.1,u.fogStart=0,u.fogEnd=1e3,u.needsPreviousWorldMatrices=!1,u._shadowsEnabled=!0,u._lightsEnabled=!0,u.activeCameras=new Array,u._texturesEnabled=!0,u.physicsEnabled=!0,u.particlesEnabled=!0,u.spritesEnabled=!0,u._skeletonsEnabled=!0,u.lensFlaresEnabled=!0,u.collisionsEnabled=!0,u.gravity=new j.l(0,-9.807,0),u.postProcessesEnabled=!0,u.renderTargetsEnabled=!0,u.dumpNextRenderTargets=!1,u.customRenderTargets=new Array,u.importedMeshesFiles=new Array,u.probesEnabled=!0,u._meshesForIntersections=new l.c(256),u.proceduralTexturesEnabled=!0,u._totalVertices=new D.e,u._activeIndices=new D.e,u._activeParticles=new D.e,u._activeBones=new D.e,u._animationTime=0,u.animationTimeScale=1,u._renderId=0,u._frameId=0,u._executeWhenReadyTimeoutId=null,u._intermediateRendering=!1,u._defaultFrameBufferCleared=!1,u._viewUpdateFlag=-1,u._projectionUpdateFlag=-1,u._toBeDisposed=new Array(256),u._activeRequests=new Array,u._pendingData=new Array,u._isDisposed=!1,u.dispatchAllSubMeshesOfActiveMeshes=!1,u._activeMeshes=new l.g(256),u._processedMaterials=new l.g(256),u._renderTargets=new l.c(256),u._materialsRenderTargets=new l.c(256),u._activeParticleSystems=new l.g(256),u._activeSkeletons=new l.c(32),u._softwareSkinnedMeshes=new l.c(32),u._activeAnimatables=new Array,u._transformMatrix=j.e.Zero(),u.requireLightSorting=!1,u._components=[],u._serializableComponents=[],u._transientComponents=[],u._beforeCameraUpdateStage=h.f.Create(),u._beforeClearStage=h.f.Create(),u._beforeRenderTargetClearStage=h.f.Create(),u._gatherRenderTargetsStage=h.f.Create(),u._gatherActiveCameraRenderTargetsStage=h.f.Create(),u._isReadyForMeshStage=h.f.Create(),u._beforeEvaluateActiveMeshStage=h.f.Create(),u._evaluateSubMeshStage=h.f.Create(),u._preActiveMeshStage=h.f.Create(),u._cameraDrawRenderTargetStage=h.f.Create(),u._beforeCameraDrawStage=h.f.Create(),u._beforeRenderTargetDrawStage=h.f.Create(),u._beforeRenderingGroupDrawStage=h.f.Create(),u._beforeRenderingMeshStage=h.f.Create(),u._afterRenderingMeshStage=h.f.Create(),u._afterRenderingGroupDrawStage=h.f.Create(),u._afterCameraDrawStage=h.f.Create(),u._afterRenderTargetDrawStage=h.f.Create(),u._afterRenderStage=h.f.Create(),u._pointerMoveStage=h.f.Create(),u._pointerDownStage=h.f.Create(),u._pointerUpStage=h.f.Create(),u._geometriesByUniqueId=null,u._defaultMeshCandidates={data:[],length:0},u._defaultSubMeshCandidates={data:[],length:0},u._preventFreeActiveMeshesAndRenderingGroups=!1,u._activeMeshesFrozen=!1,u._activeMeshesFrozenButKeepClipping=!1,u._skipEvaluateActiveMeshesCompletely=!1,u._allowPostProcessClearColor=!0,u.getDeterministicFrameTime=function(){return u._engine.getTimeStep()},u._blockMaterialDirtyMechanism=!1,u._perfCollector=null,u.onComputePressureChanged=new J.c;var Q=(0,r.d)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},P);return u._engine=I||W.e.LastCreatedEngine,Q.virtual?u._engine._virtualScenes.push(u):(W.e._LastCreatedScene=u,u._engine.scenes.push(u)),u._uid=null,u._renderingManager=new o.c(u),E.c&&(u.postProcessManager=new E.c(u)),(0,n.r)()&&u.attachControl(),u._createUbo(),B.e&&(u._imageProcessingConfiguration=new B.e),u.setDefaultCandidateProviders(),Q.useGeometryUniqueIdsMap&&(u._geometriesByUniqueId={}),u.useMaterialMeshMap=Q.useMaterialMeshMap,u.useClonedMeshMap=Q.useClonedMeshMap,P&&P.virtual||u._engine.onNewSceneAddedObservable.notifyObservers(u),T.IsAvailable&&(u._computePressureObserver=new T((function(w){u.onComputePressureChanged.notifyObservers(w)}),{cpuUtilizationThresholds:[.25,.5,.75,.9],cpuSpeedThresholds:[.5]}),u._computePressureObserver.observe()),u}return(0,r.m)(v,w),v.DefaultMaterialFactory=function(w){throw(0,V.e)("StandardMaterial")},v.CollisionCoordinatorFactory=function(){throw(0,V.e)("DefaultCollisionCoordinator")},Object.defineProperty(v.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(w){this._environmentTexture!==w&&(this._environmentTexture=w,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(w){this._forceWireframe!==w&&(this._forceWireframe=w,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(w){this._skipFrustumClipping!==w&&(this._skipFrustumClipping=w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(w){this._forcePointsCloud!==w&&(this._forcePointsCloud=w,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(w){this._animationPropertiesOverride=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onDispose",{set:function(w){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"beforeRender",{set:function(w){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),w&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(w))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"afterRender",{set:function(w){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),w&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(w))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"beforeCameraRender",{set:function(w){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"afterCameraRender",{set:function(w){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(v,"DragMovementThreshold",{get:function(){return d.DragMovementThreshold},set:function(w){d.DragMovementThreshold=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"LongPressDelay",{get:function(){return d.LongPressDelay},set:function(w){d.LongPressDelay=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"DoubleClickDelay",{get:function(){return d.DoubleClickDelay},set:function(w){d.DoubleClickDelay=w},enumerable:!1,configurable:!0}),Object.defineProperty(v,"ExclusiveDoubleClickMode",{get:function(){return d.ExclusiveDoubleClickMode},set:function(w){d.ExclusiveDoubleClickMode=w},enumerable:!1,configurable:!0}),v.prototype.bindEyePosition=function(w,v,I){var P;void 0===v&&(v="vEyePosition"),void 0===I&&(I=!1);var u=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:null!==(P=this.activeCamera.globalPosition)&&void 0!==P?P:this.activeCamera.devicePosition,Q=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return j.i.Vector4[0].set(u.x,u.y,u.z,Q?-1:1),w&&(I?w.setFloat3(v,j.i.Vector4[0].x,j.i.Vector4[0].y,j.i.Vector4[0].z):w.setVector4(v,j.i.Vector4[0])),j.i.Vector4[0]},v.prototype.finalizeSceneUbo=function(){var w=this.getSceneUniformBuffer(),v=this.bindEyePosition(null);return w.updateFloat4("vEyePosition",v.x,v.y,v.z,v.w),w.update(),w},Object.defineProperty(v.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(w){this._useRightHandedSystem!==w&&(this._useRightHandedSystem=w,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),v.prototype.setStepId=function(w){this._currentStepId=w},v.prototype.getStepId=function(){return this._currentStepId},v.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(v.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(w){this._fogEnabled!==w&&(this._fogEnabled=w,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"fogMode",{get:function(){return this._fogMode},set:function(w){this._fogMode!==w&&(this._fogMode=w,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"prePass",{get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(w){this._shadowsEnabled!==w&&(this._shadowsEnabled=w,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(w){this._lightsEnabled!==w&&(this._lightsEnabled=w,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(w){w!==this._activeCamera&&(this._activeCamera=w,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=v.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(w){this._defaultMaterial=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(w){this._texturesEnabled!==w&&(this._texturesEnabled=w,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(w){this._skeletonsEnabled!==w&&(this._skeletonsEnabled=w,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=v.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),v.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var w=0,v=this._transientComponents;w<v.length;w++){v[w].register()}this._transientComponents=[]}},v.prototype._addComponent=function(w){this._components.push(w),this._transientComponents.push(w);var v=w;v.addFromContainer&&v.serialize&&this._serializableComponents.push(v)},v.prototype._getComponent=function(w){for(var v=0,I=this._components;v<I.length;v++){var P=I[v];if(P.name===w)return P}return null},v.prototype.getClassName=function(){return"Scene"},v.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},v.prototype._getDefaultSubMeshCandidates=function(w){return this._defaultSubMeshCandidates.data=w.subMeshes,this._defaultSubMeshCandidates.length=w.subMeshes.length,this._defaultSubMeshCandidates},v.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(v.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(w){this._inputManager.pointerX=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(w){this._inputManager.pointerY=w},enumerable:!1,configurable:!0}),v.prototype.getCachedMaterial=function(){return this._cachedMaterial},v.prototype.getCachedEffect=function(){return this._cachedEffect},v.prototype.getCachedVisibility=function(){return this._cachedVisibility},v.prototype.isCachedMaterialInvalid=function(w,v,I){return void 0===I&&(I=1),this._cachedEffect!==v||this._cachedMaterial!==w||this._cachedVisibility!==I},v.prototype.getEngine=function(){return this._engine},v.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(v.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),v.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(v.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),v.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(v.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),v.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(v.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),v.prototype.getActiveMeshes=function(){return this._activeMeshes},v.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},v.prototype.getRenderId=function(){return this._renderId},v.prototype.getFrameId=function(){return this._frameId},v.prototype.incrementRenderId=function(){this._renderId++},v.prototype._createUbo=function(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())},v.prototype.simulatePointerMove=function(w,v){return this._inputManager.simulatePointerMove(w,v),this},v.prototype.simulatePointerDown=function(w,v){return this._inputManager.simulatePointerDown(w,v),this},v.prototype.simulatePointerUp=function(w,v,I){return this._inputManager.simulatePointerUp(w,v,I),this},v.prototype.isPointerCaptured=function(w){return void 0===w&&(w=0),this._inputManager.isPointerCaptured(w)},v.prototype.attachControl=function(w,v,I){void 0===w&&(w=!0),void 0===v&&(v=!0),void 0===I&&(I=!0),this._inputManager.attachControl(w,v,I)},v.prototype.detachControl=function(){this._inputManager.detachControl()},v.prototype.isReady=function(w){if(void 0===w&&(w=!0),this._isDisposed)return!1;var v,I=this.getEngine(),P=!0;for(this._pendingData.length>0&&(P=!1),w&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),v=0;v<this.meshes.length;v++){var u=this.meshes[v];if(u.subMeshes&&0!==u.subMeshes.length)if(u.isReady(!0)){for(var Q=u.hasThinInstances||"InstancedMesh"===u.getClassName()||"InstancedLinesMesh"===u.getClassName()||I.getCaps().instancedArrays&&u.instances.length>0,K=0,a=this._isReadyForMeshStage;K<a.length;K++){a[K].action(u,Q)||(P=!1)}if(w){var U=u.material||this.defaultMaterial;if(U)if(U._storeEffectOnSubMeshes)for(var p=0,r=u.subMeshes;p<r.length;p++){var Y=r[p].getMaterial();Y&&Y.hasRenderTargetTextures&&null!=Y.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Y)&&(this._processedMaterials.push(Y),this._materialsRenderTargets.concatWithNoDuplicate(Y.getRenderTargetTextures()))}else U.hasRenderTargetTextures&&null!=U.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(U)&&(this._processedMaterials.push(U),this._materialsRenderTargets.concatWithNoDuplicate(U.getRenderTargetTextures()))}}else P=!1}if(!P)return!1;if(!I.areAllEffectsReady())return!1;if(w)for(v=0;v<this._materialsRenderTargets.length;++v){if(!this._materialsRenderTargets.data[v].isReadyForRendering())return!1}for(v=0;v<this.geometries.length;v++){if(2===this.geometries[v].delayLoadState)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var g=0,J=this.activeCameras;g<J.length;g++){if(!J[g].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var l=0,R=this.particleSystems;l<R.length;l++){if(!R[l].isReady())return!1}return!0},v.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},v.prototype.registerBeforeRender=function(w){this.onBeforeRenderObservable.add(w)},v.prototype.unregisterBeforeRender=function(w){this.onBeforeRenderObservable.removeCallback(w)},v.prototype.registerAfterRender=function(w){this.onAfterRenderObservable.add(w)},v.prototype.unregisterAfterRender=function(w){this.onAfterRenderObservable.removeCallback(w)},v.prototype._executeOnceBeforeRender=function(w){var v=this;this.registerBeforeRender((function I(){w(),setTimeout((function(){v.unregisterBeforeRender(I)}))}))},v.prototype.executeOnceBeforeRender=function(w,v){var I=this;void 0!==v?setTimeout((function(){I._executeOnceBeforeRender(w)}),v):this._executeOnceBeforeRender(w)},v.prototype._addPendingData=function(w){this._pendingData.push(w)},v.prototype._removePendingData=function(w){var v=this.isLoading,I=this._pendingData.indexOf(w);-1!==I&&this._pendingData.splice(I,1),v&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},v.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(v.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),v.prototype.executeWhenReady=function(w,v){void 0===v&&(v=!1),this.onReadyObservable.add(w),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(v)},v.prototype.whenReadyAsync=function(w){var v=this;return void 0===w&&(w=!1),new Promise((function(I){v.executeWhenReady((function(){I()}),w)}))},v.prototype._checkIsReady=function(w){var v=this;return void 0===w&&(w=!1),this._registerTransientComponents(),this.isReady(w)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((function(){v._checkIsReady(w)}),100))},Object.defineProperty(v.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),v.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=g.b.Now},v.prototype.getViewMatrix=function(){return this._viewMatrix},v.prototype.getProjectionMatrix=function(){return this._projectionMatrix},v.prototype.getTransformMatrix=function(){return this._transformMatrix},v.prototype.setTransformMatrix=function(w,v,I,P){I||P||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===w.updateFlag&&this._projectionUpdateFlag===v.updateFlag||(this._viewUpdateFlag=w.updateFlag,this._projectionUpdateFlag=v.updateFlag,this._viewMatrix=w,this._projectionMatrix=v,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?b.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=b.b.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(I,P):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))},v.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},v.prototype.createSceneUniformBuffer=function(w){var v=new t.b(this._engine,void 0,!1,null!==w&&void 0!==w?w:"scene");return v.addUniform("viewProjection",16),v.addUniform("view",16),v.addUniform("projection",16),v.addUniform("vEyePosition",4),v},v.prototype.setSceneUniformBuffer=function(w){this._sceneUbo=w,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1},v.prototype.getUniqueId=function(){return k.b.UniqueId},v.prototype.addMesh=function(w,v){var I=this;void 0===v&&(v=!1),this._blockEntityCollection||(this.meshes.push(w),w._resyncLightSources(),w.parent||w._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(w),v&&w.getChildMeshes().forEach((function(w){I.addMesh(w)})))},v.prototype.removeMesh=function(w,v){var I=this;void 0===v&&(v=!1);var P=this.meshes.indexOf(w);return-1!==P&&(this.meshes[P]=this.meshes[this.meshes.length-1],this.meshes.pop(),w.parent||w._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(w),this.onMeshRemovedObservable.notifyObservers(w),v&&w.getChildMeshes().forEach((function(w){I.removeMesh(w)})),P},v.prototype.addTransformNode=function(w){this._blockEntityCollection||w.getScene()===this&&-1!==w._indexInSceneTransformNodesArray||(w._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(w),w.parent||w._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(w))},v.prototype.removeTransformNode=function(w){var v=w._indexInSceneTransformNodesArray;if(-1!==v){if(v!==this.transformNodes.length-1){var I=this.transformNodes[this.transformNodes.length-1];this.transformNodes[v]=I,I._indexInSceneTransformNodesArray=v}w._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),w.parent||w._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(w),v},v.prototype.removeSkeleton=function(w){var v=this.skeletons.indexOf(w);return-1!==v&&(this.skeletons.splice(v,1),this.onSkeletonRemovedObservable.notifyObservers(w),this._executeActiveContainerCleanup(this._activeSkeletons)),v},v.prototype.removeMorphTargetManager=function(w){var v=this.morphTargetManagers.indexOf(w);return-1!==v&&this.morphTargetManagers.splice(v,1),v},v.prototype.removeLight=function(w){var v=this.lights.indexOf(w);if(-1!==v){for(var I=0,P=this.meshes;I<P.length;I++){P[I]._removeLightSource(w,!1)}this.lights.splice(v,1),this.sortLightsByPriority(),w.parent||w._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(w),v},v.prototype.removeCamera=function(w){var v=this.cameras.indexOf(w);if(-1!==v&&(this.cameras.splice(v,1),w.parent||w._removeFromSceneRootNodes()),this.activeCameras){var I=this.activeCameras.indexOf(w);-1!==I&&this.activeCameras.splice(I,1)}return this.activeCamera===w&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(w),v},v.prototype.removeParticleSystem=function(w){var v=this.particleSystems.indexOf(w);return-1!==v&&(this.particleSystems.splice(v,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),v},v.prototype.removeAnimation=function(w){var v=this.animations.indexOf(w);return-1!==v&&this.animations.splice(v,1),v},v.prototype.stopAnimation=function(w,v,I){},v.prototype.removeAnimationGroup=function(w){var v=this.animationGroups.indexOf(w);return-1!==v&&this.animationGroups.splice(v,1),v},v.prototype.removeMultiMaterial=function(w){var v=this.multiMaterials.indexOf(w);return-1!==v&&this.multiMaterials.splice(v,1),this.onMultiMaterialRemovedObservable.notifyObservers(w),v},v.prototype.removeMaterial=function(w){var v=w._indexInSceneMaterialArray;if(-1!==v&&v<this.materials.length){if(v!==this.materials.length-1){var I=this.materials[this.materials.length-1];this.materials[v]=I,I._indexInSceneMaterialArray=v}w._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(w),v},v.prototype.removeActionManager=function(w){var v=this.actionManagers.indexOf(w);return-1!==v&&this.actionManagers.splice(v,1),v},v.prototype.removeTexture=function(w){var v=this.textures.indexOf(w);return-1!==v&&this.textures.splice(v,1),this.onTextureRemovedObservable.notifyObservers(w),v},v.prototype.addLight=function(w){if(!this._blockEntityCollection){this.lights.push(w),this.sortLightsByPriority(),w.parent||w._addToSceneRootNodes();for(var v=0,I=this.meshes;v<I.length;v++){var P=I[v];-1===P.lightSources.indexOf(w)&&(P.lightSources.push(w),P._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(w)}},v.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(y.c.CompareLightsPriority)},v.prototype.addCamera=function(w){this._blockEntityCollection||(this.cameras.push(w),this.onNewCameraAddedObservable.notifyObservers(w),w.parent||w._addToSceneRootNodes())},v.prototype.addSkeleton=function(w){this._blockEntityCollection||(this.skeletons.push(w),this.onNewSkeletonAddedObservable.notifyObservers(w))},v.prototype.addParticleSystem=function(w){this._blockEntityCollection||this.particleSystems.push(w)},v.prototype.addAnimation=function(w){this._blockEntityCollection||this.animations.push(w)},v.prototype.addAnimationGroup=function(w){this._blockEntityCollection||this.animationGroups.push(w)},v.prototype.addMultiMaterial=function(w){this._blockEntityCollection||(this.multiMaterials.push(w),this.onNewMultiMaterialAddedObservable.notifyObservers(w))},v.prototype.addMaterial=function(w){this._blockEntityCollection||w.getScene()===this&&-1!==w._indexInSceneMaterialArray||(w._indexInSceneMaterialArray=this.materials.length,this.materials.push(w),this.onNewMaterialAddedObservable.notifyObservers(w))},v.prototype.addMorphTargetManager=function(w){this._blockEntityCollection||this.morphTargetManagers.push(w)},v.prototype.addGeometry=function(w){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[w.uniqueId]=this.geometries.length),this.geometries.push(w))},v.prototype.addActionManager=function(w){this.actionManagers.push(w)},v.prototype.addTexture=function(w){this._blockEntityCollection||(this.textures.push(w),this.onNewTextureAddedObservable.notifyObservers(w))},v.prototype.switchActiveCamera=function(w,v){void 0===v&&(v=!0),this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=w,v&&w.attachControl())},v.prototype.setActiveCameraById=function(w){var v=this.getCameraById(w);return v?(this.activeCamera=v,v):null},v.prototype.setActiveCameraByName=function(w){var v=this.getCameraByName(w);return v?(this.activeCamera=v,v):null},v.prototype.getAnimationGroupByName=function(w){for(var v=0;v<this.animationGroups.length;v++)if(this.animationGroups[v].name===w)return this.animationGroups[v];return null},v.prototype.getMaterialByUniqueID=function(w){for(var v=0;v<this.materials.length;v++)if(this.materials[v].uniqueId===w)return this.materials[v];return null},v.prototype.getMaterialById=function(w){for(var v=0;v<this.materials.length;v++)if(this.materials[v].id===w)return this.materials[v];return null},v.prototype.getLastMaterialById=function(w,v){void 0===v&&(v=!1);for(var I=this.materials.length-1;I>=0;I--)if(this.materials[I].id===w)return this.materials[I];if(v)for(I=this.multiMaterials.length-1;I>=0;I--)if(this.multiMaterials[I].id===w)return this.multiMaterials[I];return null},v.prototype.getMaterialByName=function(w){for(var v=0;v<this.materials.length;v++)if(this.materials[v].name===w)return this.materials[v];return null},v.prototype.getTextureByUniqueId=function(w){for(var v=0;v<this.textures.length;v++)if(this.textures[v].uniqueId===w)return this.textures[v];return null},v.prototype.getTextureByName=function(w){for(var v=0;v<this.textures.length;v++)if(this.textures[v].name===w)return this.textures[v];return null},v.prototype.getCameraById=function(w){for(var v=0;v<this.cameras.length;v++)if(this.cameras[v].id===w)return this.cameras[v];return null},v.prototype.getCameraByUniqueId=function(w){for(var v=0;v<this.cameras.length;v++)if(this.cameras[v].uniqueId===w)return this.cameras[v];return null},v.prototype.getCameraByName=function(w){for(var v=0;v<this.cameras.length;v++)if(this.cameras[v].name===w)return this.cameras[v];return null},v.prototype.getBoneById=function(w){for(var v=0;v<this.skeletons.length;v++)for(var I=this.skeletons[v],P=0;P<I.bones.length;P++)if(I.bones[P].id===w)return I.bones[P];return null},v.prototype.getBoneByName=function(w){for(var v=0;v<this.skeletons.length;v++)for(var I=this.skeletons[v],P=0;P<I.bones.length;P++)if(I.bones[P].name===w)return I.bones[P];return null},v.prototype.getLightByName=function(w){for(var v=0;v<this.lights.length;v++)if(this.lights[v].name===w)return this.lights[v];return null},v.prototype.getLightById=function(w){for(var v=0;v<this.lights.length;v++)if(this.lights[v].id===w)return this.lights[v];return null},v.prototype.getLightByUniqueId=function(w){for(var v=0;v<this.lights.length;v++)if(this.lights[v].uniqueId===w)return this.lights[v];return null},v.prototype.getParticleSystemById=function(w){for(var v=0;v<this.particleSystems.length;v++)if(this.particleSystems[v].id===w)return this.particleSystems[v];return null},v.prototype.getGeometryById=function(w){for(var v=0;v<this.geometries.length;v++)if(this.geometries[v].id===w)return this.geometries[v];return null},v.prototype._getGeometryByUniqueId=function(w){if(this._geometriesByUniqueId){if(void 0!==(v=this._geometriesByUniqueId[w]))return this.geometries[v]}else for(var v=0;v<this.geometries.length;v++)if(this.geometries[v].uniqueId===w)return this.geometries[v];return null},v.prototype.pushGeometry=function(w,v){return!(!v&&this._getGeometryByUniqueId(w.uniqueId))&&(this.addGeometry(w),this.onNewGeometryAddedObservable.notifyObservers(w),!0)},v.prototype.removeGeometry=function(w){var v;if(this._geometriesByUniqueId){if(void 0===(v=this._geometriesByUniqueId[w.uniqueId]))return!1}else if((v=this.geometries.indexOf(w))<0)return!1;if(v!==this.geometries.length-1){var I=this.geometries[this.geometries.length-1];I&&(this.geometries[v]=I,this._geometriesByUniqueId&&(this._geometriesByUniqueId[I.uniqueId]=v,this._geometriesByUniqueId[w.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(w),!0},v.prototype.getGeometries=function(){return this.geometries},v.prototype.getMeshById=function(w){for(var v=0;v<this.meshes.length;v++)if(this.meshes[v].id===w)return this.meshes[v];return null},v.prototype.getMeshesById=function(w){return this.meshes.filter((function(v){return v.id===w}))},v.prototype.getTransformNodeById=function(w){for(var v=0;v<this.transformNodes.length;v++)if(this.transformNodes[v].id===w)return this.transformNodes[v];return null},v.prototype.getTransformNodeByUniqueId=function(w){for(var v=0;v<this.transformNodes.length;v++)if(this.transformNodes[v].uniqueId===w)return this.transformNodes[v];return null},v.prototype.getTransformNodesById=function(w){return this.transformNodes.filter((function(v){return v.id===w}))},v.prototype.getMeshByUniqueId=function(w){for(var v=0;v<this.meshes.length;v++)if(this.meshes[v].uniqueId===w)return this.meshes[v];return null},v.prototype.getLastMeshById=function(w){for(var v=this.meshes.length-1;v>=0;v--)if(this.meshes[v].id===w)return this.meshes[v];return null},v.prototype.getLastEntryById=function(w){var v;for(v=this.meshes.length-1;v>=0;v--)if(this.meshes[v].id===w)return this.meshes[v];for(v=this.transformNodes.length-1;v>=0;v--)if(this.transformNodes[v].id===w)return this.transformNodes[v];for(v=this.cameras.length-1;v>=0;v--)if(this.cameras[v].id===w)return this.cameras[v];for(v=this.lights.length-1;v>=0;v--)if(this.lights[v].id===w)return this.lights[v];return null},v.prototype.getNodeById=function(w){var v=this.getMeshById(w);if(v)return v;var I=this.getTransformNodeById(w);if(I)return I;var P=this.getLightById(w);if(P)return P;var u=this.getCameraById(w);if(u)return u;var Q=this.getBoneById(w);return Q||null},v.prototype.getNodeByName=function(w){var v=this.getMeshByName(w);if(v)return v;var I=this.getTransformNodeByName(w);if(I)return I;var P=this.getLightByName(w);if(P)return P;var u=this.getCameraByName(w);if(u)return u;var Q=this.getBoneByName(w);return Q||null},v.prototype.getMeshByName=function(w){for(var v=0;v<this.meshes.length;v++)if(this.meshes[v].name===w)return this.meshes[v];return null},v.prototype.getTransformNodeByName=function(w){for(var v=0;v<this.transformNodes.length;v++)if(this.transformNodes[v].name===w)return this.transformNodes[v];return null},v.prototype.getLastSkeletonById=function(w){for(var v=this.skeletons.length-1;v>=0;v--)if(this.skeletons[v].id===w)return this.skeletons[v];return null},v.prototype.getSkeletonByUniqueId=function(w){for(var v=0;v<this.skeletons.length;v++)if(this.skeletons[v].uniqueId===w)return this.skeletons[v];return null},v.prototype.getSkeletonById=function(w){for(var v=0;v<this.skeletons.length;v++)if(this.skeletons[v].id===w)return this.skeletons[v];return null},v.prototype.getSkeletonByName=function(w){for(var v=0;v<this.skeletons.length;v++)if(this.skeletons[v].name===w)return this.skeletons[v];return null},v.prototype.getMorphTargetManagerById=function(w){for(var v=0;v<this.morphTargetManagers.length;v++)if(this.morphTargetManagers[v].uniqueId===w)return this.morphTargetManagers[v];return null},v.prototype.getMorphTargetById=function(w){for(var v=0;v<this.morphTargetManagers.length;++v)for(var I=this.morphTargetManagers[v],P=0;P<I.numTargets;++P){var u=I.getTarget(P);if(u.id===w)return u}return null},v.prototype.getMorphTargetByName=function(w){for(var v=0;v<this.morphTargetManagers.length;++v)for(var I=this.morphTargetManagers[v],P=0;P<I.numTargets;++P){var u=I.getTarget(P);if(u.name===w)return u}return null},v.prototype.getPostProcessByName=function(w){for(var v=0;v<this.postProcesses.length;++v){var I=this.postProcesses[v];if(I.name===w)return I}return null},v.prototype.isActiveMesh=function(w){return-1!==this._activeMeshes.indexOf(w)},Object.defineProperty(v.prototype,"uid",{get:function(){return this._uid||(this._uid=Y.i.RandomId()),this._uid},enumerable:!1,configurable:!0}),v.prototype.addExternalData=function(w,v){return this._externalData||(this._externalData=new R),this._externalData.add(w,v)},v.prototype.getExternalData=function(w){return this._externalData?this._externalData.get(w):null},v.prototype.getOrAddExternalDataWithFactory=function(w,v){return this._externalData||(this._externalData=new R),this._externalData.getOrAddWithFactory(w,v)},v.prototype.removeExternalData=function(w){return this._externalData.remove(w)},v.prototype._evaluateSubMesh=function(w,v,I){if(I.hasInstances||I.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||v.alwaysSelectAsActiveMesh||1===v.subMeshes.length||w.isInFrustum(this._frustumPlanes)){for(var P=0,u=this._evaluateSubMeshStage;P<u.length;P++){u[P].action(v,w)}var Q=w.getMaterial();null!==Q&&void 0!==Q&&(Q.hasRenderTargetTextures&&null!=Q.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Q)&&(this._processedMaterials.push(Q),this._materialsRenderTargets.concatWithNoDuplicate(Q.getRenderTargetTextures())),this._renderingManager.dispatch(w,v,Q))}},v.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(v.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(w){this._preventFreeActiveMeshesAndRenderingGroups!==w&&(w&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=w)},enumerable:!1,configurable:!0}),v.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var w=0;w<this.activeCameras.length;w++){var v=this.activeCameras[w];v&&v._activeMeshes&&v._activeMeshes.dispose()}},v.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var w=0;w<this.textures.length;w++){var v=this.textures[w];v&&v.renderList&&v.freeRenderingGroups()}},v.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},v.prototype.freezeActiveMeshes=function(w,v,I,P,u){var Q=this;return void 0===w&&(w=!1),void 0===P&&(P=!0),void 0===u&&(u=!1),this.executeWhenReady((function(){if(Q.activeCamera){if(Q._frustumPlanes||Q.updateTransformMatrix(),Q._evaluateActiveMeshes(),Q._activeMeshesFrozen=!0,Q._activeMeshesFrozenButKeepClipping=u,Q._skipEvaluateActiveMeshesCompletely=w,P)for(var K=0;K<Q._activeMeshes.length;K++)Q._activeMeshes.data[K]._freeze();v&&v()}else I&&I("No active camera found")})),this},v.prototype.unfreezeActiveMeshes=function(){for(var w=0;w<this.meshes.length;w++){var v=this.meshes[w];v._internalAbstractMeshDataInfo&&(v._internalAbstractMeshDataInfo._isActive=!1)}for(w=0;w<this._activeMeshes.length;w++)this._activeMeshes.data[w]._unFreeze();return this._activeMeshesFrozen=!1,this},v.prototype._executeActiveContainerCleanup=function(w){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((function(){return w.dispose()}))},v.prototype._evaluateActiveMeshes=function(){var w;if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)this._activeMeshes.length>0&&(null===(w=this.activeCamera)||void 0===w||w._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());else if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var v=this._activeMeshes.length,I=0;I<v;I++){(U=this._activeMeshes.data[I]).computeWorldMatrix()}if(this._activeParticleSystems){var P=this._activeParticleSystems.length;for(I=0;I<P;I++)this._activeParticleSystems.data[I].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(var u=0,Q=this._beforeEvaluateActiveMeshStage;u<Q.length;u++){Q[u].action()}var K=this.getActiveMeshCandidates(),a=K.length;for(I=0;I<a;I++){var U;if((U=K.data[I])._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!U.isBlocked&&(this._totalVertices.addCount(U.getTotalVertices(),!1),U.isReady()&&U.isEnabled()&&!U.scaling.hasAZeroComponent)){U.computeWorldMatrix(),U.actionManager&&U.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(U);var p=this.customLODSelector?this.customLODSelector(U,this.activeCamera):U.getLOD(this.activeCamera);if(U._internalAbstractMeshDataInfo._currentLOD=p,U._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==p&&null!==p&&(p!==U&&0!==p.billboardMode&&p.computeWorldMatrix(),U._preActivate(),U.isVisible&&U.visibility>0&&0!==(U.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||U.alwaysSelectAsActiveMesh||U.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(U),this.activeCamera._activeMeshes.push(U),p!==U&&p._activate(this._renderId,!1);for(var r=0,Y=this._preActiveMeshStage;r<Y.length;r++){Y[r].action(U)}U._activate(this._renderId,!1)&&(U.isAnInstance?U._internalAbstractMeshDataInfo._actAsRegularMesh&&(p=U):p._internalAbstractMeshDataInfo._onlyForInstances=!1,p._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(U,p)),U._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var g=0;g<this.particleSystems.length;g++){var J=this.particleSystems[g];if(J.isStarted()&&J.emitter){var l=J.emitter;l.position&&!l.isEnabled()||(this._activeParticleSystems.push(J),J.animate(),this._renderingManager.dispatchParticles(J))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},v.prototype._activeMesh=function(w,v){if(this._skeletonsEnabled&&null!==v.skeleton&&void 0!==v.skeleton&&(this._activeSkeletons.pushNoDuplicate(v.skeleton)&&(v.skeleton.prepare(),this._activeBones.addCount(v.skeleton.bones.length,!1)),v.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(v)),v&&v.subMeshes&&v.subMeshes.length>0)for(var I=this.getActiveSubMeshCandidates(v),P=I.length,u=0;u<P;u++){var Q=I.data[u];this._evaluateSubMesh(Q,v,w)}},v.prototype.updateTransformMatrix=function(w){if(this.activeCamera)if(this.activeCamera._renderingMultiview){var v=this.activeCamera._rigCameras[0],I=this.activeCamera._rigCameras[1];this.setTransformMatrix(v.getViewMatrix(),v.getProjectionMatrix(w),I.getViewMatrix(),I.getProjectionMatrix(w))}else this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(w))},v.prototype._bindFrameBuffer=function(w,v){void 0===v&&(v=!0),w&&w._multiviewTexture?w._multiviewTexture._bindFrameBuffer():w&&w.outputRenderTarget?w.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),v&&this._clearFrameBuffer(w)},v.prototype._clearFrameBuffer=function(w){if(w&&w._multiviewTexture);else if(w&&w.outputRenderTarget){var v=w.outputRenderTarget;v.onClearObservable.hasObservers()?v.onClearObservable.notifyObservers(this._engine):v.skipInitialClear||(this._engine.clear(v.clearColor||this.clearColor,!v._cleared,!0,!0),v._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())},v.prototype._renderForCamera=function(w,v,I){var P,u,Q;if(void 0===I&&(I=!0),!w||!w._skipRendering){var K=this._engine;if(this._activeCamera=w,!this.activeCamera)throw new Error("Active camera not set");if(K.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&I){var a=!0;w._renderingMultiview&&w.outputRenderTarget&&(a=w.outputRenderTarget.skipInitialClear,this.autoClear&&(w.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),w._renderingMultiview&&w.outputRenderTarget&&(w.outputRenderTarget.skipInitialClear=a)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var U=0;U<this._softwareSkinnedMeshes.length;U++){var p=this._softwareSkinnedMeshes.data[U];p.applySkeleton(p.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),w.customRenderTargets&&w.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(w.customRenderTargets),v&&v.customRenderTargets&&v.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(v.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(var r=0,g=this._gatherActiveCameraRenderTargetsStage;r<g.length;r++){g[r].action(this._renderTargets)}var J=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){Y.i.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var l=0;l<this._renderTargets.length;l++){var R=this._renderTargets.data[l];if(R._shouldRender()){this._renderId++;var x=R.activeCamera&&R.activeCamera!==this.activeCamera;R.render(x,this.dumpNextRenderTargets),J=!0}}Y.i.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var j=0,s=this._cameraDrawRenderTargetStage;j<s.length;j++){J=s[j].action(this.activeCamera)||J}this._intermediateRendering=!1}this._engine.currentRenderPassId=null!==(Q=null!==(u=null===(P=w.outputRenderTarget)||void 0===P?void 0:P.renderPassId)&&void 0!==u?u:w.renderPassId)&&void 0!==Q?Q:0,J&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||w._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(var B=0,t=this._beforeCameraDrawStage;B<t.length;B++){t[B].action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),K.snapshotRendering&&1===K.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var i=0,z=this._afterCameraDrawStage;i<z.length;i++){z[i].action(this.activeCamera)}if(this.postProcessManager&&!w._multiviewTexture){var E=w.outputRenderTarget?w.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(w.isIntermediate,E)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},v.prototype._processSubCameras=function(w,v){if(void 0===v&&(v=!0),0===w.cameraRigMode||w._renderingMultiview)return w._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(w,void 0,v),void this.onAfterRenderCameraObservable.notifyObservers(w);if(w._useMultiviewToSingleView)this._renderMultiviewToSingleView(w);else{this.onBeforeCameraRenderObservable.notifyObservers(w);for(var I=0;I<w._rigCameras.length;I++)this._renderForCamera(w._rigCameras[I],w)}this._activeCamera=w,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(w)},v.prototype._checkIntersections=function(){for(var w=0;w<this._meshesForIntersections.length;w++){var v=this._meshesForIntersections.data[w];if(v.actionManager)for(var I=function(w){var I=v.actionManager.actions[w];if(12===I.trigger||13===I.trigger){var P=I.getTriggerParameter(),u=P.mesh?P.mesh:P,Q=u.intersectsMesh(v,P.usePreciseIntersection),K=v._intersectionsInProgress.indexOf(u);Q&&-1===K?12===I.trigger?(I._executeCurrent(z.CreateNew(v,void 0,u)),v._intersectionsInProgress.push(u)):13===I.trigger&&v._intersectionsInProgress.push(u):!Q&&K>-1&&(13===I.trigger&&I._executeCurrent(z.CreateNew(v,void 0,u)),v.actionManager.hasSpecificTrigger(13,(function(w){var v=w.mesh?w.mesh:w;return u===v}))&&13!==I.trigger||v._intersectionsInProgress.splice(K,1))}},P=0;v.actionManager&&P<v.actionManager.actions.length;P++)I(P)}},v.prototype._advancePhysicsEngineStep=function(w){},v.prototype._animate=function(){},v.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var w=Math.max(v.MinDeltaTime,Math.min(this._engine.getDeltaTime(),v.MaxDeltaTime))+this._timeAccumulator,I=this._engine.getTimeStep(),P=1e3/I/1e3,u=0,Q=this._engine.getLockstepMaxSteps(),K=Math.floor(w/I);for(K=Math.min(K,Q);w>0&&u<K;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=I*P,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(I),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,u++,w-=I;this._timeAccumulator=w<0?0:w}else{w=this.useConstantAnimationDeltaTime?16:Math.max(v.MinDeltaTime,Math.min(this._engine.getDeltaTime(),v.MaxDeltaTime));this._animationRatio=.06*w,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(w)}},v.prototype._clear=function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)},v.prototype._checkCameraRenderTarget=function(w){var v;if((null===w||void 0===w?void 0:w.outputRenderTarget)&&!(null===w||void 0===w?void 0:w.isRigCamera)&&(w.outputRenderTarget._cleared=!1),null===(v=null===w||void 0===w?void 0:w.rigCameras)||void 0===v?void 0:v.length)for(var I=0;I<w.rigCameras.length;++I){var P=w.rigCameras[I].outputRenderTarget;P&&(P._cleared=!1)}},v.prototype.resetDrawCache=function(w){if(this.meshes)for(var v=0,I=this.meshes;v<I.length;v++){I[v].resetDrawCache(w)}},v.prototype.render=function(w,v){var I,P,u;if(void 0===w&&(w=!0),void 0===v&&(v=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(null===(I=this.activeCameras)||void 0===I?void 0:I.length)&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),v||this.animate();for(var Q=0,K=this._beforeCameraUpdateStage;Q<K.length;Q++){K[Q].action()}if(w)if(this.activeCameras&&this.activeCameras.length>0)for(var a=0;a<this.activeCameras.length;a++){var U=this.activeCameras[a];if(U.update(),0!==U.cameraRigMode)for(var p=0;p<U._rigCameras.length;p++)U._rigCameras[p].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(p=0;p<this.activeCamera._rigCameras.length;p++)this.activeCamera._rigCameras[p].update();this.onBeforeRenderObservable.notifyObservers(this);var r=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var g=(null===(P=this.activeCameras)||void 0===P?void 0:P.length)?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){Y.i.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var J=0;J<this.customRenderTargets.length;J++){var l=this.customRenderTargets[J];if(l._shouldRender()){if(this._renderId++,this.activeCamera=l.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");r.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),l.render(g!==this.activeCamera,this.dumpNextRenderTargets)}}Y.i.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=null!==(u=null===g||void 0===g?void 0:g.renderPassId)&&void 0!==u?u:0,this.activeCamera=g,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var R=0,x=this._beforeClearStage;R<x.length;R++){x[R].action()}this._clearFrameBuffer(this.activeCamera);for(var j=0,s=this._gatherRenderTargetsStage;j<s.length;j++){s[j].action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(a=0;a<this.activeCameras.length;a++)this._processSubCameras(this.activeCameras[a],a>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(var B=0,t=this._afterRenderStage;B<t.length;B++){t[B].action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(p=0;p<this._toBeDisposed.length;p++){var i=this._toBeDisposed[p];i&&i.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}},v.prototype.freezeMaterials=function(){for(var w=0;w<this.materials.length;w++)this.materials[w].freeze()},v.prototype.unfreezeMaterials=function(){for(var w=0;w<this.materials.length;w++)this.materials[w].unfreeze()},v.prototype.dispose=function(){var w;if(!this.isDisposed){this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var v=0,I=this._activeRequests.slice();v<I.length;v++){I[v].abort()}if(this._activeRequests=[],this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onComputePressureChanged.clear(),null===(w=this._computePressureObserver)||void 0===w||w.unobserve(),this._computePressureObserver=void 0,this.detachControl(),this._engine.getInputElement())for(var P=0;P<this.cameras.length;P++)this.cameras[P].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(function(w){return w.dispose(!0)})),this._disposeList(this.transformNodes,(function(w){return w.dispose(!0)})),this._disposeList(this.cameras),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);var u=this._engine.scenes.indexOf(this);u>-1&&this._engine.scenes.splice(u,1),W.e._LastCreatedScene===this&&(this._engine.scenes.length>0?W.e._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:W.e._LastCreatedScene=null),(u=this._engine._virtualScenes.indexOf(this))>-1&&this._engine._virtualScenes.splice(u,1),this._engine.wipeCaches(!0),this._isDisposed=!0}},v.prototype._disposeList=function(w,v){v=null!==v&&void 0!==v?v:function(w){return w.dispose()};for(var I=0,P=w.slice(0);I<P.length;I++){v(P[I])}w.length=0},Object.defineProperty(v.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),v.prototype.clearCachedVertexData=function(){for(var w=0;w<this.meshes.length;w++){var v=this.meshes[w].geometry;v&&v.clearCachedData()}},v.prototype.cleanCachedTextureBuffer=function(){for(var w=0,v=this.textures;w<v.length;w++){var I=v[w];I._buffer&&(I._buffer=null)}},v.prototype.getWorldExtends=function(w){var v=new j.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),I=new j.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return w=w||function(){return!0},this.meshes.filter(w).forEach((function(w){if(w.computeWorldMatrix(!0),w.subMeshes&&0!==w.subMeshes.length&&!w.infiniteDistance){var P=w.getBoundingInfo(),u=P.boundingBox.minimumWorld,Q=P.boundingBox.maximumWorld;j.l.CheckExtends(u,v,I),j.l.CheckExtends(Q,v,I)}})),{min:v,max:I}},v.prototype.createPickingRay=function(w,v,I,P,u){throw void 0===u&&(u=!1),(0,V.e)("Ray")},v.prototype.createPickingRayToRef=function(w,v,I,P,u,Q,K){throw void 0===Q&&(Q=!1),void 0===K&&(K=!1),(0,V.e)("Ray")},v.prototype.createPickingRayInCameraSpace=function(w,v,I){throw(0,V.e)("Ray")},v.prototype.createPickingRayInCameraSpaceToRef=function(w,v,I,P){throw(0,V.e)("Ray")},v.prototype.pick=function(w,v,I,P,u,Q){var K=new i.d;return K._pickingUnavailable=!0,K},v.prototype.pickWithBoundingInfo=function(w,v,I,P,u){var Q=new i.d;return Q._pickingUnavailable=!0,Q},v.prototype.pickWithRay=function(w,v,I,P){throw(0,V.e)("Ray")},v.prototype.multiPick=function(w,v,I,P,u){throw(0,V.e)("Ray")},v.prototype.multiPickWithRay=function(w,v,I){throw(0,V.e)("Ray")},v.prototype.setPointerOverMesh=function(w,v,I){this._inputManager.setPointerOverMesh(w,v,I)},v.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},v.prototype._rebuildGeometries=function(){for(var w=0,v=this.geometries;w<v.length;w++){v[w]._rebuild()}for(var I=0,P=this.meshes;I<P.length;I++){P[I]._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var u=0,Q=this._components;u<Q.length;u++){Q[u].rebuild()}for(var K=0,a=this.particleSystems;K<a.length;K++){a[K].rebuild()}if(this.spriteManagers)for(var U=0,p=this.spriteManagers;U<p.length;U++){p[U].rebuild()}},v.prototype._rebuildTextures=function(){for(var w=0,v=this.textures;w<v.length;w++){v[w]._rebuild()}this.markAllMaterialsAsDirty(1)},v.prototype._getByTags=function(w,v,I){if(void 0===v)return w;var P=[];for(var u in I=I||function(w){},w){var Q=w[u];x.c&&x.c.MatchesQuery(Q,v)&&(P.push(Q),I(Q))}return P},v.prototype.getMeshesByTags=function(w,v){return this._getByTags(this.meshes,w,v)},v.prototype.getCamerasByTags=function(w,v){return this._getByTags(this.cameras,w,v)},v.prototype.getLightsByTags=function(w,v){return this._getByTags(this.lights,w,v)},v.prototype.getMaterialByTags=function(w,v){return this._getByTags(this.materials,w,v).concat(this._getByTags(this.multiMaterials,w,v))},v.prototype.getTransformNodesByTags=function(w,v){return this._getByTags(this.transformNodes,w,v)},v.prototype.setRenderingOrder=function(w,v,I,P){void 0===v&&(v=null),void 0===I&&(I=null),void 0===P&&(P=null),this._renderingManager.setRenderingOrder(w,v,I,P)},v.prototype.setRenderingAutoClearDepthStencil=function(w,v,I,P){void 0===I&&(I=!0),void 0===P&&(P=!0),this._renderingManager.setRenderingAutoClearDepthStencil(w,v,I,P)},v.prototype.getAutoClearDepthStencilSetup=function(w){return this._renderingManager.getAutoClearDepthStencilSetup(w)},Object.defineProperty(v.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(w){this._blockMaterialDirtyMechanism!==w&&(this._blockMaterialDirtyMechanism=w,w||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),v.prototype.markAllMaterialsAsDirty=function(w,v){if(!this._blockMaterialDirtyMechanism)for(var I=0,P=this.materials;I<P.length;I++){var u=P[I];v&&!v(u)||u.markAsDirty(w)}},v.prototype._loadFile=function(w,v,I,P,u,Q,K){var a=this,U=(0,C.k)(w,v,I,P?this.offlineProvider:void 0,u,Q,K);return this._activeRequests.push(U),U.onCompleteObservable.add((function(w){a._activeRequests.splice(a._activeRequests.indexOf(w),1)})),U},v.prototype._loadFileAsync=function(w,v,I,P,u){var Q=this;return new Promise((function(K,a){Q._loadFile(w,(function(w){K(w)}),v,I,P,(function(w,v){a(v)}),u)}))},v.prototype._requestFile=function(w,v,I,P,u,Q,K){var a=this,U=(0,C.t)(w,v,I,P?this.offlineProvider:void 0,u,Q,K);return this._activeRequests.push(U),U.onCompleteObservable.add((function(w){a._activeRequests.splice(a._activeRequests.indexOf(w),1)})),U},v.prototype._requestFileAsync=function(w,v,I,P,u){var Q=this;return new Promise((function(K,a){Q._requestFile(w,(function(w){K(w)}),v,I,P,(function(w){a(w)}),u)}))},v.prototype._readFile=function(w,v,I,P,u){var Q=this,K=(0,C.p)(w,v,I,P,u);return this._activeRequests.push(K),K.onCompleteObservable.add((function(w){Q._activeRequests.splice(Q._activeRequests.indexOf(w),1)})),K},v.prototype._readFileAsync=function(w,v,I){var P=this;return new Promise((function(u,Q){P._readFile(w,(function(w){u(w)}),v,I,(function(w){Q(w)}))}))},v.prototype.getPerfCollector=function(){throw(0,V.e)("performanceViewerSceneExtension")},v.FOGMODE_NONE=0,v.FOGMODE_EXP=1,v.FOGMODE_EXP2=2,v.FOGMODE_LINEAR=3,v.MinDeltaTime=1,v.MaxDeltaTime=1e3,v}(s.b);Z.prototype.setActiveCameraByID=function(w){return this.setActiveCameraById(w)},Z.prototype.getLastMaterialByID=function(w){return this.getLastMaterialById(w)},Z.prototype.getMaterialByID=function(w){return this.getMaterialById(w)},Z.prototype.getTextureByUniqueID=function(w){return this.getTextureByUniqueId(w)},Z.prototype.getCameraByID=function(w){return this.getCameraById(w)},Z.prototype.getCameraByUniqueID=function(w){return this.getCameraByUniqueId(w)},Z.prototype.getBoneByID=function(w){return this.getBoneById(w)},Z.prototype.getLightByID=function(w){return this.getLightById(w)},Z.prototype.getLightByUniqueID=function(w){return this.getLightByUniqueId(w)},Z.prototype.getParticleSystemByID=function(w){return this.getParticleSystemById(w)},Z.prototype.getGeometryByID=function(w){return this.getGeometryById(w)},Z.prototype.getMeshByID=function(w){return this.getMeshById(w)},Z.prototype.getMeshesByID=function(w){return this.getMeshesById(w)},Z.prototype.getTransformNodeByID=function(w){return this.getTransformNodeById(w)},Z.prototype.getTransformNodeByUniqueID=function(w){return this.getTransformNodeByUniqueId(w)},Z.prototype.getTransformNodesByID=function(w){return this.getTransformNodesById(w)},Z.prototype.getMeshByUniqueID=function(w){return this.getMeshByUniqueId(w)},Z.prototype.getLastMeshByID=function(w){return this.getLastMeshById(w)},Z.prototype.getLastEntryByID=function(w){return this.getLastEntryById(w)},Z.prototype.getNodeByID=function(w){return this.getNodeById(w)},Z.prototype.getLastSkeletonByID=function(w){return this.getLastSkeletonById(w)}},21693:function(w,v,I){"use strict";I.d(v,{c:function(){return u},f:function(){return Q}});var P=I(78502),u=function(){function w(){}return w.NAME_EFFECTLAYER="EffectLayer",w.NAME_LAYER="Layer",w.NAME_LENSFLARESYSTEM="LensFlareSystem",w.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",w.NAME_PARTICLESYSTEM="ParticleSystem",w.NAME_GAMEPAD="Gamepad",w.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",w.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",w.NAME_PREPASSRENDERER="PrePassRenderer",w.NAME_DEPTHRENDERER="DepthRenderer",w.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",w.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",w.NAME_SPRITE="Sprite",w.NAME_SUBSURFACE="SubSurface",w.NAME_OUTLINERENDERER="Outline",w.NAME_PROCEDURALTEXTURE="ProceduralTexture",w.NAME_SHADOWGENERATOR="ShadowGenerator",w.NAME_OCTREE="Octree",w.NAME_PHYSICSENGINE="PhysicsEngine",w.NAME_AUDIO="Audio",w.STEP_ISREADYFORMESH_EFFECTLAYER=0,w.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,w.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,w.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,w.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,w.STEP_BEFORECAMERADRAW_PREPASS=0,w.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,w.STEP_BEFORECAMERADRAW_LAYER=2,w.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,w.STEP_BEFORERENDERTARGETDRAW_LAYER=1,w.STEP_BEFORERENDERINGMESH_PREPASS=0,w.STEP_BEFORERENDERINGMESH_OUTLINE=1,w.STEP_AFTERRENDERINGMESH_PREPASS=0,w.STEP_AFTERRENDERINGMESH_OUTLINE=1,w.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,w.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,w.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,w.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,w.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,w.STEP_BEFORECLEAR_PREPASS=1,w.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,w.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,w.STEP_AFTERRENDERTARGETDRAW_LAYER=1,w.STEP_AFTERCAMERADRAW_PREPASS=0,w.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,w.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,w.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,w.STEP_AFTERCAMERADRAW_LAYER=4,w.STEP_AFTERRENDER_AUDIO=0,w.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,w.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,w.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,w.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,w.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,w.STEP_POINTERMOVE_SPRITE=0,w.STEP_POINTERDOWN_SPRITE=0,w.STEP_POINTERUP_SPRITE=0,w}(),Q=function(w){function v(v){return w.apply(this,v)||this}return(0,P.m)(v,w),v.Create=function(){return Object.create(v.prototype)},v.prototype.registerStep=function(w,v,I){var P=0;for(Number.MAX_VALUE;P<this.length;P++){if(w<this[P].index)break}this.splice(P,0,{index:w,component:v,action:I.bind(v)})},v.prototype.clear=function(){this.length=0},v}(Array)},4892:function(w,v,I){"use strict";var P=function(){function w(){var w=this;this.promise=new Promise((function(v,I){w._resolve=v,w._reject=I}))}return Object.defineProperty(w.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),w}(),u=I(80105),Q=I(9488),K=I(9217),a=I(37643),U=I(35958),p=I(21664),r=I(9271),Y=I(78588),g=I(45883),J=function(){function w(){}return w.prototype.getClassName=function(){return"TargetedAnimation"},w.prototype.serialize=function(){var w={};return w.animation=this.animation.serialize(),w.targetId=this.target.id,w},w}(),l=function(){function w(w,v){void 0===v&&(v=null),this.name=w,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._parentContainer=null,this.onAnimationEndObservable=new r.c,this.onAnimationLoopObservable=new r.c,this.onAnimationGroupLoopObservable=new r.c,this.onAnimationGroupEndObservable=new r.c,this.onAnimationGroupPauseObservable=new r.c,this.onAnimationGroupPlayObservable=new r.c,this.metadata=null,this._scene=v||Y.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(w.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(w){if(this._speedRatio!==w){this._speedRatio=w;for(var v=0;v<this._animatables.length;v++){this._animatables[v].speedRatio=this._speedRatio}}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(w){if(this._loopAnimation!==w){this._loopAnimation=w;for(var v=0;v<this._animatables.length;v++){this._animatables[v].loopAnimation=this._loopAnimation}}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(w){if(this._isAdditive!==w){this._isAdditive=w;for(var v=0;v<this._animatables.length;v++){this._animatables[v].isAdditive=this._isAdditive}}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),w.prototype.addTargetedAnimation=function(w,v){var I=new J;I.animation=w,I.target=v;var P=w.getKeys();return this._from>P[0].frame&&(this._from=P[0].frame),this._to<P[P.length-1].frame&&(this._to=P[P.length-1].frame),this._targetedAnimations.push(I),I},w.prototype.normalize=function(w,v){void 0===w&&(w=null),void 0===v&&(v=null),null==w&&(w=this._from),null==v&&(v=this._to);for(var I=0;I<this._targetedAnimations.length;I++){var P=this._targetedAnimations[I].animation.getKeys(),u=P[0],Q=P[P.length-1];if(u.frame>w){var K={frame:w,value:u.value,inTangent:u.inTangent,outTangent:u.outTangent,interpolation:u.interpolation};P.splice(0,0,K)}if(Q.frame<v){K={frame:v,value:Q.value,inTangent:Q.inTangent,outTangent:Q.outTangent,interpolation:Q.interpolation};P.push(K)}}return this._from=w,this._to=v,this},w.prototype._processLoop=function(w,v,I){var P=this;w.onAnimationLoop=function(){P.onAnimationLoopObservable.notifyObservers(v),P._animationLoopFlags[I]||(P._animationLoopFlags[I]=!0,P._animationLoopCount++,P._animationLoopCount===P._targetedAnimations.length&&(P.onAnimationGroupLoopObservable.notifyObservers(P),P._animationLoopCount=0,P._animationLoopFlags=[]))}},w.prototype.start=function(w,v,I,P,u){var Q=this;if(void 0===w&&(w=!1),void 0===v&&(v=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=w,this._animationLoopCount=0,this._animationLoopFlags=[];for(var K=function(K){var U=a._targetedAnimations[K],p=a._scene.beginDirectAnimation(U.target,[U.animation],void 0!==I?I:a._from,void 0!==P?P:a._to,w,v,void 0,void 0,void 0!==u?u:a._isAdditive);p.onAnimationEnd=function(){Q.onAnimationEndObservable.notifyObservers(U),Q._checkAnimationGroupEnded(p)},a._processLoop(p,U,K),a._animatables.push(p)},a=this,U=0;U<this._targetedAnimations.length;U++)K(U);return this._speedRatio=v,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},w.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var w=0;w<this._animatables.length;w++){this._animatables[w].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},w.prototype.play=function(w){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==w&&(this.loopAnimation=w),this.restart()):(this.stop(),this.start(w,this._speedRatio)),this._isPaused=!1,this},w.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var w=0;w<this._animatables.length;w++){this._animatables[w].reset()}return this},w.prototype.restart=function(){if(!this._isStarted)return this;for(var w=0;w<this._animatables.length;w++){this._animatables[w].restart()}return this.onAnimationGroupPlayObservable.notifyObservers(this),this},w.prototype.stop=function(){if(!this._isStarted)return this;for(var w=this._animatables.slice(),v=0;v<w.length;v++)w[v].stop();return this._isStarted=!1,this},w.prototype.setWeightForAllAnimatables=function(w){for(var v=0;v<this._animatables.length;v++){this._animatables[v].weight=w}return this},w.prototype.syncAllAnimationsWith=function(w){for(var v=0;v<this._animatables.length;v++){this._animatables[v].syncWith(w)}return this},w.prototype.goToFrame=function(w){if(!this._isStarted)return this;for(var v=0;v<this._animatables.length;v++){this._animatables[v].goToFrame(w)}return this},w.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var w=this._scene.animationGroups.indexOf(this);if(w>-1&&this._scene.animationGroups.splice(w,1),this._parentContainer){var v=this._parentContainer.animationGroups.indexOf(this);v>-1&&this._parentContainer.animationGroups.splice(v,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},w.prototype._checkAnimationGroupEnded=function(w){var v=this._animatables.indexOf(w);v>-1&&this._animatables.splice(v,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},w.prototype.clone=function(v,I,P){void 0===P&&(P=!1);for(var u=new w(v||this.name,this._scene),Q=0,K=this._targetedAnimations;Q<K.length;Q++){var a=K[Q];u.addTargetedAnimation(P?a.animation.clone():a.animation,I?I(a.target):a.target)}return u},w.prototype.serialize=function(){var w={};w.name=this.name,w.from=this.from,w.to=this.to,w.targetedAnimations=[];for(var v=0;v<this.targetedAnimations.length;v++){var I=this.targetedAnimations[v];w.targetedAnimations[v]=I.serialize()}return g.c&&g.c.HasTags(this)&&(w.tags=g.c.GetTags(this)),this.metadata&&(w.metadata=this.metadata),w},w.Parse=function(v,I){for(var P=new w(v.name,I),u=0;u<v.targetedAnimations.length;u++){var Q=v.targetedAnimations[u],K=p.b.Parse(Q.animation),a=Q.targetId;if("influence"===Q.animation.property){var U=I.getMorphTargetById(a);U&&P.addTargetedAnimation(K,U)}else{var r=I.getNodeById(a);null!=r&&P.addTargetedAnimation(K,r)}}return null!==v.from&&null!==v.to&&P.normalize(v.from,v.to),g.c&&g.c.AddTagsTo(P,v.tags),void 0!==v.metadata&&(P.metadata=v.metadata),P},w.MakeAnimationAdditive=function(w,v,I,P,u){void 0===v&&(v=0),void 0===P&&(P=!1);var Q=w;P&&(Q=w.clone(u||Q.name));for(var K=Q.targetedAnimations,a=0;a<K.length;a++){var U=K[a];p.b.MakeAnimationAdditive(U.animation,v,I)}return Q.isAdditive=!0,Q},w.prototype.getClassName=function(){return"AnimationGroup"},w.prototype.toString=function(w){var v="Name: "+this.name;return v+=", type: "+this.getClassName(),w&&(v+=", from: "+this._from,v+=", to: "+this._to,v+=", isStarted: "+this._isStarted,v+=", speedRatio: "+this._speedRatio,v+=", targetedAnimations length: "+this._targetedAnimations.length,v+=", animatables length: "+this._animatables),v},w}(),R=I(78502),x=I(89214),j=I(74134),s=I(54044),B=function(w){function v(v,I,P,Q,K,a,U){void 0===P&&(P=null),void 0===Q&&(Q=null),void 0===K&&(K=null),void 0===a&&(a=null),void 0===U&&(U=null);var p=w.call(this,v,I.getScene())||this;return p.name=v,p.children=new Array,p.animations=new Array,p._index=null,p._absoluteTransform=new u.e,p._invertedAbsoluteTransform=new u.e,p._scalingDeterminant=1,p._worldTransform=new u.e,p._needToDecompose=!0,p._needToCompose=!1,p._linkedTransformNode=null,p._waitingTransformNodeId=null,p._skeleton=I,p._localMatrix=Q?Q.clone():u.e.Identity(),p._restPose=K||p._localMatrix.clone(),p._baseMatrix=a||p._localMatrix.clone(),p._index=U,I.bones.push(p),p.setParent(P,!1),(a||Q)&&p._updateDifferenceMatrix(),p}return(0,R.m)(v,w),Object.defineProperty(v.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(w){this._needToCompose=!1,w.updateFlag!==this._localMatrix.updateFlag&&(this._localMatrix.copyFrom(w),this._markAsDirtyAndDecompose())},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"Bone"},v.prototype.getSkeleton=function(){return this._skeleton},Object.defineProperty(v.prototype,"parent",{get:function(){return this._parentNode},set:function(w){this.setParent(w)},enumerable:!1,configurable:!0}),v.prototype.getParent=function(){return this.parent},v.prototype.getChildren=function(){return this.children},v.prototype.getIndex=function(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index},v.prototype.setParent=function(w,v){if(void 0===v&&(v=!0),this.parent!==w){if(this.parent){var I=this.parent.children.indexOf(this);-1!==I&&this.parent.children.splice(I,1)}this._parentNode=w,this.parent&&this.parent.children.push(this),v&&this._updateDifferenceMatrix(),this.markAsDirty()}},v.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},v.prototype.getBaseMatrix=function(){return this._baseMatrix},v.prototype.getRestPose=function(){return this._restPose},v.prototype.setRestPose=function(w){this._restPose.copyFrom(w)},v.prototype.getBindPose=function(){return this._baseMatrix},v.prototype.setBindPose=function(w){this.updateMatrix(w)},v.prototype.getWorldMatrix=function(){return this._worldTransform},v.prototype.returnToRest=function(){var w;if(this._linkedTransformNode){var v=u.i.Vector3[0],I=u.i.Quaternion[0],P=u.i.Vector3[1];this.getRestPose().decompose(v,I,P),this._linkedTransformNode.position.copyFrom(P),this._linkedTransformNode.rotationQuaternion=null!==(w=this._linkedTransformNode.rotationQuaternion)&&void 0!==w?w:u.f.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(I),this._linkedTransformNode.scaling.copyFrom(v)}else this._matrix=this._restPose},v.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},v.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},v.prototype.linkTransformNode=function(w){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=w,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},v.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(v.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(w){this._decompose(),this._localPosition.copyFrom(w),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"rotation",{get:function(){return this.getRotation()},set:function(w){this.setRotation(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(w){this.setRotationQuaternion(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"scaling",{get:function(){return this.getScale()},set:function(w){this.setScale(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),v.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=u.l.Zero(),this._localRotation=u.f.Zero(),this._localPosition=u.l.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},v.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,u.e.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},v.prototype.updateMatrix=function(w,v,I){void 0===v&&(v=!0),void 0===I&&(I=!0),this._baseMatrix.copyFrom(w),v&&this._updateDifferenceMatrix(),I?this._matrix=w:this.markAsDirty()},v.prototype._updateDifferenceMatrix=function(w,v){if(void 0===v&&(v=!0),w||(w=this._baseMatrix),this.parent?w.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(w),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),v)for(var I=0;I<this.children.length;I++)this.children[I]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},v.prototype.markAsDirty=function(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this},v.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},v.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},v.prototype.translate=function(w,I,P){void 0===I&&(I=s.j.LOCAL);var Q=this.getLocalMatrix();if(I==s.j.LOCAL)Q.addAtIndex(12,w.x),Q.addAtIndex(13,w.y),Q.addAtIndex(14,w.z);else{var K=null;P&&(K=P.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=v._TmpMats[0],U=v._TmpVecs[0];this.parent?P&&K?(a.copyFrom(this.parent.getAbsoluteTransform()),a.multiplyToRef(K,a)):a.copyFrom(this.parent.getAbsoluteTransform()):u.e.IdentityToRef(a),a.setTranslationFromFloats(0,0,0),a.invert(),u.l.TransformCoordinatesToRef(w,a,U),Q.addAtIndex(12,U.x),Q.addAtIndex(13,U.y),Q.addAtIndex(14,U.z)}this._markAsDirtyAndDecompose()},v.prototype.setPosition=function(w,I,P){void 0===I&&(I=s.j.LOCAL);var Q=this.getLocalMatrix();if(I==s.j.LOCAL)Q.setTranslationFromFloats(w.x,w.y,w.z);else{var K=null;P&&(K=P.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=v._TmpMats[0],U=v._TmpVecs[0];this.parent?(P&&K?(a.copyFrom(this.parent.getAbsoluteTransform()),a.multiplyToRef(K,a)):a.copyFrom(this.parent.getAbsoluteTransform()),a.invert()):u.e.IdentityToRef(a),u.l.TransformCoordinatesToRef(w,a,U),Q.setTranslationFromFloats(U.x,U.y,U.z)}this._markAsDirtyAndDecompose()},v.prototype.setAbsolutePosition=function(w,v){this.setPosition(w,s.j.WORLD,v)},v.prototype.scale=function(w,I,P,Q){void 0===Q&&(Q=!1);var K=this.getLocalMatrix(),a=v._TmpMats[0];u.e.ScalingToRef(w,I,P,a),a.multiplyToRef(K,K),a.invert();for(var U=0,p=this.children;U<p.length;U++){var r=(J=p[U]).getLocalMatrix();r.multiplyToRef(a,r),r.multiplyAtIndex(12,w),r.multiplyAtIndex(13,I),r.multiplyAtIndex(14,P),J._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),Q)for(var Y=0,g=this.children;Y<g.length;Y++){var J;(J=g[Y]).scale(w,I,P,Q)}},v.prototype.setScale=function(w){this._decompose(),this._localScaling.copyFrom(w),this._markAsDirtyAndCompose()},v.prototype.getScale=function(){return this._decompose(),this._localScaling},v.prototype.getScaleToRef=function(w){this._decompose(),w.copyFrom(this._localScaling)},v.prototype.setYawPitchRoll=function(w,I,P,Q,K){if(void 0===Q&&(Q=s.j.LOCAL),Q===s.j.LOCAL){var a=v._TmpQuat;return u.f.RotationYawPitchRollToRef(w,I,P,a),void this.setRotationQuaternion(a,Q,K)}var U=v._TmpMats[0];if(this._getNegativeRotationToRef(U,K)){var p=v._TmpMats[1];u.e.RotationYawPitchRollToRef(w,I,P,p),U.multiplyToRef(p,p),this._rotateWithMatrix(p,Q,K)}},v.prototype.rotate=function(w,I,P,Q){void 0===P&&(P=s.j.LOCAL);var K=v._TmpMats[0];K.setTranslationFromFloats(0,0,0),u.e.RotationAxisToRef(w,I,K),this._rotateWithMatrix(K,P,Q)},v.prototype.setAxisAngle=function(w,I,P,Q){if(void 0===P&&(P=s.j.LOCAL),P===s.j.LOCAL){var K=v._TmpQuat;return u.f.RotationAxisToRef(w,I,K),void this.setRotationQuaternion(K,P,Q)}var a=v._TmpMats[0];if(this._getNegativeRotationToRef(a,Q)){var U=v._TmpMats[1];u.e.RotationAxisToRef(w,I,U),a.multiplyToRef(U,U),this._rotateWithMatrix(U,P,Q)}},v.prototype.setRotation=function(w,v,I){void 0===v&&(v=s.j.LOCAL),this.setYawPitchRoll(w.y,w.x,w.z,v,I)},v.prototype.setRotationQuaternion=function(w,I,P){if(void 0===I&&(I=s.j.LOCAL),I===s.j.LOCAL)return this._decompose(),this._localRotation.copyFrom(w),void this._markAsDirtyAndCompose();var Q=v._TmpMats[0];if(this._getNegativeRotationToRef(Q,P)){var K=v._TmpMats[1];u.e.FromQuaternionToRef(w,K),Q.multiplyToRef(K,K),this._rotateWithMatrix(K,I,P)}},v.prototype.setRotationMatrix=function(w,I,P){if(void 0===I&&(I=s.j.LOCAL),I===s.j.LOCAL){var Q=v._TmpQuat;return u.f.FromRotationMatrixToRef(w,Q),void this.setRotationQuaternion(Q,I,P)}var K=v._TmpMats[0];if(this._getNegativeRotationToRef(K,P)){var a=v._TmpMats[1];a.copyFrom(w),K.multiplyToRef(w,a),this._rotateWithMatrix(a,I,P)}},v.prototype._rotateWithMatrix=function(w,I,P){void 0===I&&(I=s.j.LOCAL);var u=this.getLocalMatrix(),Q=u.m[12],K=u.m[13],a=u.m[14],U=this.getParent(),p=v._TmpMats[3],r=v._TmpMats[4];U&&I==s.j.WORLD?(P?(p.copyFrom(P.getWorldMatrix()),U.getAbsoluteTransform().multiplyToRef(p,p)):p.copyFrom(U.getAbsoluteTransform()),r.copyFrom(p),r.invert(),u.multiplyToRef(p,u),u.multiplyToRef(w,u),u.multiplyToRef(r,u)):I==s.j.WORLD&&P?(p.copyFrom(P.getWorldMatrix()),r.copyFrom(p),r.invert(),u.multiplyToRef(p,u),u.multiplyToRef(w,u),u.multiplyToRef(r,u)):u.multiplyToRef(w,u),u.setTranslationFromFloats(Q,K,a),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},v.prototype._getNegativeRotationToRef=function(w,I){var P=v._TmpMats[2];return w.copyFrom(this.getAbsoluteTransform()),I?(w.multiplyToRef(I.getWorldMatrix(),w),u.e.ScalingToRef(I.scaling.x,I.scaling.y,I.scaling.z,P)):u.e.IdentityToRef(P),w.invert(),!isNaN(w.m[0])&&(P.multiplyAtIndex(0,this._scalingDeterminant),w.multiplyToRef(P,w),!0)},v.prototype.getPosition=function(w,v){void 0===w&&(w=s.j.LOCAL),void 0===v&&(v=null);var I=u.l.Zero();return this.getPositionToRef(w,v,I),I},v.prototype.getPositionToRef=function(w,I,P){if(void 0===w&&(w=s.j.LOCAL),w==s.j.LOCAL){var u=this.getLocalMatrix();P.x=u.m[12],P.y=u.m[13],P.z=u.m[14]}else{var Q=null;I&&(Q=I.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var K=v._TmpMats[0];I&&Q?(K.copyFrom(this.getAbsoluteTransform()),K.multiplyToRef(Q,K)):K=this.getAbsoluteTransform(),P.x=K.m[12],P.y=K.m[13],P.z=K.m[14]}},v.prototype.getAbsolutePosition=function(w){void 0===w&&(w=null);var v=u.l.Zero();return this.getPositionToRef(s.j.WORLD,w,v),v},v.prototype.getAbsolutePositionToRef=function(w,v){this.getPositionToRef(s.j.WORLD,w,v)},v.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var w=this._skeleton.getPoseMatrix();w&&this._absoluteTransform.multiplyToRef(w,this._absoluteTransform)}for(var v=this.children,I=v.length,P=0;P<I;P++)v[P].computeAbsoluteTransforms()},v.prototype.getDirection=function(w,v){void 0===v&&(v=null);var I=u.l.Zero();return this.getDirectionToRef(w,v,I),I},v.prototype.getDirectionToRef=function(w,I,P){void 0===I&&(I=null);var Q=null;I&&(Q=I.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var K=v._TmpMats[0];K.copyFrom(this.getAbsoluteTransform()),I&&Q&&K.multiplyToRef(Q,K),u.l.TransformNormalToRef(w,K,P),P.normalize()},v.prototype.getRotation=function(w,v){void 0===w&&(w=s.j.LOCAL),void 0===v&&(v=null);var I=u.l.Zero();return this.getRotationToRef(w,v,I),I},v.prototype.getRotationToRef=function(w,I,P){void 0===w&&(w=s.j.LOCAL),void 0===I&&(I=null);var u=v._TmpQuat;this.getRotationQuaternionToRef(w,I,u),u.toEulerAnglesToRef(P)},v.prototype.getRotationQuaternion=function(w,v){void 0===w&&(w=s.j.LOCAL),void 0===v&&(v=null);var I=u.f.Identity();return this.getRotationQuaternionToRef(w,v,I),I},v.prototype.getRotationQuaternionToRef=function(w,I,P){if(void 0===w&&(w=s.j.LOCAL),void 0===I&&(I=null),w==s.j.LOCAL)this._decompose(),P.copyFrom(this._localRotation);else{var u=v._TmpMats[0],Q=this.getAbsoluteTransform();I?Q.multiplyToRef(I.getWorldMatrix(),u):u.copyFrom(Q),u.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyAtIndex(1,this._scalingDeterminant),u.multiplyAtIndex(2,this._scalingDeterminant),u.decompose(void 0,P,void 0)}},v.prototype.getRotationMatrix=function(w,v){void 0===w&&(w=s.j.LOCAL);var I=u.e.Identity();return this.getRotationMatrixToRef(w,v,I),I},v.prototype.getRotationMatrixToRef=function(w,I,P){if(void 0===w&&(w=s.j.LOCAL),w==s.j.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(P);else{var u=v._TmpMats[0],Q=this.getAbsoluteTransform();I?Q.multiplyToRef(I.getWorldMatrix(),u):u.copyFrom(Q),u.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyAtIndex(1,this._scalingDeterminant),u.multiplyAtIndex(2,this._scalingDeterminant),u.getRotationMatrixToRef(P)}},v.prototype.getAbsolutePositionFromLocal=function(w,v){void 0===v&&(v=null);var I=u.l.Zero();return this.getAbsolutePositionFromLocalToRef(w,v,I),I},v.prototype.getAbsolutePositionFromLocalToRef=function(w,I,P){void 0===I&&(I=null);var Q=null;I&&(Q=I.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var K=v._TmpMats[0];I&&Q?(K.copyFrom(this.getAbsoluteTransform()),K.multiplyToRef(Q,K)):K=this.getAbsoluteTransform(),u.l.TransformCoordinatesToRef(w,K,P)},v.prototype.getLocalPositionFromAbsolute=function(w,v){void 0===v&&(v=null);var I=u.l.Zero();return this.getLocalPositionFromAbsoluteToRef(w,v,I),I},v.prototype.getLocalPositionFromAbsoluteToRef=function(w,I,P){void 0===I&&(I=null);var Q=null;I&&(Q=I.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var K=v._TmpMats[0];K.copyFrom(this.getAbsoluteTransform()),I&&Q&&K.multiplyToRef(Q,K),K.invert(),u.l.TransformCoordinatesToRef(w,K,P)},v.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},v._TmpVecs=x.c.BuildArray(2,u.l.Zero),v._TmpQuat=u.f.Identity(),v._TmpMats=x.c.BuildArray(5,u.e.Identity),v}(j.b),t=I(15099),i=I(7686),z=I(9127),E=I(51004),o=function(){function w(w,v,I){this.name=w,this.id=v,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=u.e.Identity(),this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new r.c,this.bones=[],this._scene=I||Y.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var P=this._scene.getEngine().getCaps();this._canUseTextureForBones=P.textureFloat&&P.maxVertexTextureImageUnits>0}return Object.defineProperty(w.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(w){this._useTextureToStoreBoneMatrices=w,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(w){this._animationPropertiesOverride=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),w.prototype.getClassName=function(){return"Skeleton"},w.prototype.getChildren=function(){return this.bones.filter((function(w){return!w.getParent()}))},w.prototype.getTransformMatrices=function(w){return this.needInitialSkinMatrix?(w._bonesTransformMatrices||this.prepare(),w._bonesTransformMatrices):(this._transformMatrices||this.prepare(),this._transformMatrices)},w.prototype.getTransformMatrixTexture=function(w){return this.needInitialSkinMatrix&&w._transformMatrixTexture?w._transformMatrixTexture:this._transformMatrixTexture},w.prototype.getScene=function(){return this._scene},w.prototype.toString=function(w){var v="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);if(v+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none"),w){v+=", Ranges: {";var I=!0;for(var P in this._ranges)I&&(v+=", ",I=!1),v+=P;v+="}"}return v},w.prototype.getBoneIndexByName=function(w){for(var v=0,I=this.bones.length;v<I;v++)if(this.bones[v].name===w)return v;return-1},w.prototype.createAnimationRange=function(w,v,I){if(!this._ranges[w]){this._ranges[w]=new i.d(w,v,I);for(var P=0,u=this.bones.length;P<u;P++)this.bones[P].animations[0]&&this.bones[P].animations[0].createRange(w,v,I)}},w.prototype.deleteAnimationRange=function(w,v){void 0===v&&(v=!0);for(var I=0,P=this.bones.length;I<P;I++)this.bones[I].animations[0]&&this.bones[I].animations[0].deleteRange(w,v);this._ranges[w]=null},w.prototype.getAnimationRange=function(w){return this._ranges[w]||null},w.prototype.getAnimationRanges=function(){var w,v=[];for(w in this._ranges)v.push(this._ranges[w]);return v},w.prototype.copyAnimationRange=function(w,v,I){if(void 0===I&&(I=!1),this._ranges[v]||!w.getAnimationRange(v))return!1;var P,u,Q=!0,K=this._getHighestAnimationFrame()+1,a={},U=w.bones;for(u=0,P=U.length;u<P;u++)a[U[u].name]=U[u];this.bones.length!==U.length&&(z.e.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(U.length)),Q=!1);var p=I&&this.dimensionsAtRest&&w.dimensionsAtRest?this.dimensionsAtRest.divide(w.dimensionsAtRest):null;for(u=0,P=this.bones.length;u<P;u++){var r=this.bones[u].name,Y=a[r];Y?Q=Q&&this.bones[u].copyAnimationRange(Y,v,K,I,p):(z.e.Warn("copyAnimationRange: not same rig, missing source bone "+r),Q=!1)}var g=w.getAnimationRange(v);return g&&(this._ranges[v]=new i.d(v,g.from+K,g.to+K)),Q},w.prototype.returnToRest=function(){for(var w=0,v=this.bones;w<v.length;w++){var I=v[w];-1!==I._index&&I.returnToRest()}},w.prototype._getHighestAnimationFrame=function(){for(var w=0,v=0,I=this.bones.length;v<I;v++)if(this.bones[v].animations[0]){var P=this.bones[v].animations[0].getHighestFrame();w<P&&(w=P)}return w},w.prototype.beginAnimation=function(w,v,I,P){var u=this.getAnimationRange(w);return u?this._scene.beginAnimation(this,u.from,u.to,v,I,P):null},w.MakeAnimationAdditive=function(w,v,I){void 0===v&&(v=0);var P=w.getAnimationRange(I);if(!P)return null;for(var u=w._scene.getAllAnimatablesByTarget(w),Q=null,K=0;K<u.length;K++){var a=u[K];if(a.fromFrame===(null===P||void 0===P?void 0:P.from)&&a.toFrame===(null===P||void 0===P?void 0:P.to)){Q=a;break}}var U=w.getAnimatables();for(K=0;K<U.length;K++){var r=U[K].animations;if(r)for(var Y=0;Y<r.length;Y++)p.b.MakeAnimationAdditive(r[Y],v,I)}return Q&&(Q.isAdditive=!0),w},w.prototype._markAsDirty=function(){this._isDirty=!0,this._absoluteTransformIsDirty=!0},w.prototype._registerMeshWithPoseMatrix=function(w){this._meshesWithPoseMatrix.push(w)},w.prototype._unregisterMeshWithPoseMatrix=function(w){var v=this._meshesWithPoseMatrix.indexOf(w);v>-1&&this._meshesWithPoseMatrix.splice(v,1)},w.prototype._computeTransformMatrices=function(w,v){this.onBeforeComputeObservable.notifyObservers(this);for(var I=0;I<this.bones.length;I++){var P=this.bones[I];P._childUpdateId++;var u=P.getParent();if(u?P.getLocalMatrix().multiplyToRef(u.getWorldMatrix(),P.getWorldMatrix()):v?P.getLocalMatrix().multiplyToRef(v,P.getWorldMatrix()):P.getWorldMatrix().copyFrom(P.getLocalMatrix()),-1!==P._index){var Q=null===P._index?I:P._index;P.getInvertedAbsoluteTransform().multiplyToArray(P.getWorldMatrix(),w,16*Q)}}this._identity.copyToArray(w,16*this.bones.length)},w.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var w=0,v=this.bones;w<v.length;w++){(r=v[w])._linkedTransformNode&&(r._linkedTransformNode.computeWorldMatrix(),r._matrix=r._linkedTransformNode._localMatrix)}if(this.needInitialSkinMatrix)for(var I=0,P=this._meshesWithPoseMatrix;I<P.length;I++){var Q=P[I],K=Q.getPoseMatrix(),a=this._isDirty;if(Q._bonesTransformMatrices&&Q._bonesTransformMatrices.length===16*(this.bones.length+1)||(Q._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),a=!0),a){if(this._synchronizedWithMesh!==Q){this._synchronizedWithMesh=Q;for(var U=0,p=this.bones;U<p.length;U++){var r;if(!(r=p[U]).getParent())r.getBaseMatrix().multiplyToRef(K,u.i.Matrix[1]),r._updateDifferenceMatrix(u.i.Matrix[1])}if(this.isUsingTextureForMatrices){var Y=4*(this.bones.length+1);Q._transformMatrixTexture&&Q._transformMatrixTexture.getSize().width===Y||(Q._transformMatrixTexture&&Q._transformMatrixTexture.dispose(),Q._transformMatrixTexture=t.b.CreateRGBATexture(Q._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Q._bonesTransformMatrices,K),this.isUsingTextureForMatrices&&Q._transformMatrixTexture&&Q._transformMatrixTexture.update(Q._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=t.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1},w.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var w=0;w<this.bones.length;w++)this._animatables.push(this.bones[w])}return this._animatables},w.prototype.clone=function(v,I){var P=new w(v,I||v,this._scene);P.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var u=0;u<this.bones.length;u++){var Q=this.bones[u],K=null,a=Q.getParent();if(a){var U=this.bones.indexOf(a);K=P.bones[U]}var p=new B(Q.name,P,K,Q.getBaseMatrix().clone(),Q.getRestPose().clone());p._index=Q._index,Q._linkedTransformNode&&p.linkTransformNode(Q._linkedTransformNode),E.e.DeepCopy(Q.animations,p.animations)}if(this._ranges)for(var r in P._ranges={},this._ranges){var Y=this._ranges[r];Y&&(P._ranges[r]=Y.clone())}return this._isDirty=!0,P},w.prototype.enableBlending=function(w){void 0===w&&(w=.01),this.bones.forEach((function(v){v.animations.forEach((function(v){v.enableBlending=!0,v.blendingSpeed=w}))}))},w.prototype.dispose=function(){if(this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){var w=this._parentContainer.skeletons.indexOf(this);w>-1&&this._parentContainer.skeletons.splice(w,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},w.prototype.serialize=function(){var w,v={};v.name=this.name,v.id=this.id,this.dimensionsAtRest&&(v.dimensionsAtRest=this.dimensionsAtRest.asArray()),v.bones=[],v.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var I=0;I<this.bones.length;I++){var P=this.bones[I],u=P.getParent(),Q={parentBoneIndex:u?this.bones.indexOf(u):-1,index:P.getIndex(),name:P.name,id:P.id,matrix:P.getBaseMatrix().toArray(),rest:P.getRestPose().toArray(),linkedTransformNodeId:null===(w=P.getTransformNode())||void 0===w?void 0:w.id};for(var K in v.bones.push(Q),P.length&&(Q.length=P.length),P.metadata&&(Q.metadata=P.metadata),P.animations&&P.animations.length>0&&(Q.animation=P.animations[0].serialize()),v.ranges=[],this._ranges){var a=this._ranges[K];if(a){var U={};U.name=K,U.from=a.from,U.to=a.to,v.ranges.push(U)}}}return v},w.Parse=function(v,I){var P,Q=new w(v.name,v.id,I);for(v.dimensionsAtRest&&(Q.dimensionsAtRest=u.l.FromArray(v.dimensionsAtRest)),Q.needInitialSkinMatrix=v.needInitialSkinMatrix,P=0;P<v.bones.length;P++){var K=v.bones[P],a=v.bones[P].index,U=null;K.parentBoneIndex>-1&&(U=Q.bones[K.parentBoneIndex]);var r=K.rest?u.e.FromArray(K.rest):null,Y=new B(K.name,Q,U,u.e.FromArray(K.matrix),r,null,a);void 0!==K.id&&null!==K.id&&(Y.id=K.id),K.length&&(Y.length=K.length),K.metadata&&(Y.metadata=K.metadata),K.animation&&Y.animations.push(p.b.Parse(K.animation)),void 0!==K.linkedTransformNodeId&&null!==K.linkedTransformNodeId&&(Q._hasWaitingData=!0,Y._waitingTransformNodeId=K.linkedTransformNodeId)}if(v.ranges)for(P=0;P<v.ranges.length;P++){var g=v.ranges[P];Q.createAnimationRange(g.name,g.from,g.to)}return Q},w.prototype.computeAbsoluteTransforms=function(w){void 0===w&&(w=!1),(this._absoluteTransformIsDirty||w)&&(this.bones[0].computeAbsoluteTransforms(),this._absoluteTransformIsDirty=!1)},w.prototype.getPoseMatrix=function(){var w=null;return this._meshesWithPoseMatrix.length>0&&(w=this._meshesWithPoseMatrix[0].getPoseMatrix()),w},w.prototype.sortBones=function(){for(var w=new Array,v=new Array(this.bones.length),I=0;I<this.bones.length;I++)this._sortBones(I,w,v);this.bones=w},w.prototype._sortBones=function(w,v,I){if(!I[w]){I[w]=!0;var P=this.bones[w];if(P){void 0===P._index&&(P._index=w);var u=P.getParent();u&&this._sortBones(this.bones.indexOf(u),v,I),v.push(P)}}},w.prototype.setCurrentPoseAsRest=function(){this.bones.forEach((function(w){w.setCurrentPoseAsRest()}))},w}(),h=I(46907),n=I(92366),W=I(70937),V=I(77129),F=I(43251),O=I(3579),N=I(65847),q=I(9892),m=I(31709),c=function(){function w(w,v,I){void 0===v&&(v=0),void 0===I&&(I=null),this.name=w,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new r.c,this._onDataLayoutChanged=new r.c,this._animationPropertiesOverride=null,this._scene=I||Y.e.LastCreatedScene,this.influence=v,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(w.prototype,"influence",{get:function(){return this._influence},set:function(w){if(this._influence!==w){var v=this._influence;this._influence=w,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===v||0===w)}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(w){this._animationPropertiesOverride=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0}),w.prototype.setPositions=function(w){var v=this.hasPositions;this._positions=w,v!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},w.prototype.getPositions=function(){return this._positions},w.prototype.setNormals=function(w){var v=this.hasNormals;this._normals=w,v!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},w.prototype.getNormals=function(){return this._normals},w.prototype.setTangents=function(w){var v=this.hasTangents;this._tangents=w,v!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},w.prototype.getTangents=function(){return this._tangents},w.prototype.setUVs=function(w){var v=this.hasUVs;this._uvs=w,v!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},w.prototype.getUVs=function(){return this._uvs},w.prototype.clone=function(){var v=this,I=q.e.Clone((function(){return new w(v.name,v.influence,v._scene)}),this);return I._positions=this._positions,I._normals=this._normals,I._tangents=this._tangents,I._uvs=this._uvs,I},w.prototype.serialize=function(){var w={};return w.name=this.name,w.influence=this.influence,w.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(w.id=this.id),this.hasNormals&&(w.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(w.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(w.uvs=Array.prototype.slice.call(this.getUVs())),q.e.AppendSerializedAnimations(this,w),w},w.prototype.getClassName=function(){return"MorphTarget"},w.Parse=function(v,I){var P=new w(v.name,v.influence);if(P.setPositions(v.positions),null!=v.id&&(P.id=v.id),v.normals&&P.setNormals(v.normals),v.tangents&&P.setTangents(v.tangents),v.uvs&&P.setUVs(v.uvs),v.animations){for(var u=0;u<v.animations.length;u++){var Q=v.animations[u],K=(0,m.c)("BABYLON.Animation");K&&P.animations.push(K.Parse(Q))}v.autoAnimate&&I&&I.beginAnimation(P,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1)}return P},w.FromMesh=function(v,I,P){I||(I=v.name);var u=new w(I,P,v.getScene());return u.setPositions(v.getVerticesData(F.f.PositionKind)),v.isVerticesDataPresent(F.f.NormalKind)&&u.setNormals(v.getVerticesData(F.f.NormalKind)),v.isVerticesDataPresent(F.f.TangentKind)&&u.setTangents(v.getVerticesData(F.f.TangentKind)),v.isVerticesDataPresent(F.f.UVKind)&&u.setUVs(v.getVerticesData(F.f.UVKind)),u},(0,R.i)([(0,q.J)()],w.prototype,"id",void 0),w}(),M=I(21901),S=I(57194),e=function(){function w(w){if(void 0===w&&(w=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new M.g(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._useTextureToStoreTargets=!0,w||(w=Y.e.LastCreatedScene),this._scene=w,this._scene){this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId();var v=this._scene.getEngine().getCaps();this._canUseTextureForTargets=v.canUseGLVertexID&&v.textureFloat&&v.maxVertexTextureImageUnits>0&&v.texture2DArrayMaxLayerCount>1}}return Object.defineProperty(w.prototype,"areUpdatesFrozen",{get:function(){return this._blockCounter>0},set:function(w){w?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"useTextureToStoreTargets",{get:function(){return this._useTextureToStoreTargets},set:function(w){this._useTextureToStoreTargets=w},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isUsingTextureForTargets",{get:function(){return w.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets},enumerable:!1,configurable:!0}),w.prototype.getActiveTarget=function(w){return this._activeTargets.data[w]},w.prototype.getTarget=function(w){return this._targets[w]},w.prototype.addTarget=function(w){var v=this;this._targets.push(w),this._targetInfluenceChangedObservers.push(w.onInfluenceChanged.add((function(w){v._syncActiveTargets(w)}))),this._targetDataLayoutChangedObservers.push(w._onDataLayoutChanged.add((function(){v._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)},w.prototype.removeTarget=function(w){var v=this._targets.indexOf(w);v>=0&&(this._targets.splice(v,1),w.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(v,1)[0]),w._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(v,1)[0]),this._syncActiveTargets(!0))},w.prototype._bind=function(w){w.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),w.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),w.setTexture("morphTargets",this._targetStoreTexture)},w.prototype.clone=function(){for(var v=new w(this._scene),I=0,P=this._targets;I<P.length;I++){var u=P[I];v.addTarget(u.clone())}return v.enableNormalMorphing=this.enableNormalMorphing,v.enableTangentMorphing=this.enableTangentMorphing,v.enableUVMorphing=this.enableUVMorphing,v},w.prototype.serialize=function(){var w={};w.id=this.uniqueId,w.targets=[];for(var v=0,I=this._targets;v<I.length;v++){var P=I[v];w.targets.push(P.serialize())}return w},w.prototype._syncActiveTargets=function(w){if(!this.areUpdatesFrozen){var v=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));for(var I=-1,P=0,u=this._targets;P<u.length;P++){var Q=u[P];if(I++,0!==Q.influence||!this.optimizeInfluencers){this._activeTargets.push(Q),this._morphTargetTextureIndices[v]=I,this._tempInfluences[v++]=Q.influence,this._supportsNormals=this._supportsNormals&&Q.hasNormals,this._supportsTangents=this._supportsTangents&&Q.hasTangents,this._supportsUVs=this._supportsUVs&&Q.hasUVs;var K=Q.getPositions();if(K){var a=K.length/3;if(0===this._vertexCount)this._vertexCount=a;else if(this._vertexCount!==a)return void z.e.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===v||(this._influences=new Float32Array(v));for(var U=0;U<v;U++)this._influences[U]=this._tempInfluences[U];w&&this.synchronize()}},w.prototype.synchronize=function(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&this._vertexCount){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride,this._textureHeight=1;var w=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>w&&(this._textureHeight=Math.ceil(this._textureWidth/w),this._textureWidth=w);var v=!0;if(this._targetStoreTexture){var I=this._targetStoreTexture.getSize();I.width===this._textureWidth&&I.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(v=!1)}if(v){this._targetStoreTexture&&this._targetStoreTexture.dispose();for(var P=this._targets.length,u=new Float32Array(P*this._textureWidth*this._textureHeight*4),Q=0,K=0;K<P;K++){var a=this._targets[K],U=a.getPositions(),p=a.getNormals(),r=a.getUVs(),Y=a.getTangents();if(!U)return void(0===K&&z.e.Error("Invalid morph target. Target must have positions."));Q=K*this._textureWidth*this._textureHeight*4;for(var g=0;g<this._vertexCount;g++)u[Q]=U[3*g],u[Q+1]=U[3*g+1],u[Q+2]=U[3*g+2],Q+=4,p&&(u[Q]=p[3*g],u[Q+1]=p[3*g+1],u[Q+2]=p[3*g+2],Q+=4),r&&(u[Q]=r[2*g],u[Q+1]=r[2*g+1],Q+=4),Y&&(u[Q]=Y[3*g],u[Q+1]=Y[3*g+1],u[Q+2]=Y[3*g+2],Q+=4)}this._targetStoreTexture=S.e.CreateRGBATexture(u,this._textureWidth,this._textureHeight,P,this._scene,!1,!1,1,1)}}for(var J=0,l=this._scene.meshes;J<l.length;J++){var R=l[J];R.morphTargetManager===this&&R._syncGeometryWithMorphTargetManager()}}},w.prototype.dispose=function(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene&&(this._scene.removeMorphTargetManager(this),this._parentContainer)){var w=this._parentContainer.morphTargetManagers.indexOf(this);w>-1&&this._parentContainer.morphTargetManagers.splice(w,1),this._parentContainer=null}},w.Parse=function(v,I){var P=new w(I);P._uniqueId=v.id;for(var u=0,Q=v.targets;u<Q.length;u++){var K=Q[u];P.addTarget(c.Parse(K,I))}return P},w.EnableTextureStorage=!0,w}(),H=I(47984),G=I(25488),L=I(82790),d=I(97918),D=function(){function w(){}return w.Get=function(w,v,I){if(!v||void 0==I||!v[I])throw new Error("".concat(w,": Failed to find index (").concat(I,")"));return v[I]},w.Assign=function(w){if(w)for(var v=0;v<w.length;v++)w[v].index=v},w}();function f(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];var I=function(w){return w&&"object"===typeof w};return w.reduce((function(w,v){return Object.keys(v).forEach((function(P){var u=w[P],Q=v[P];Array.isArray(u)&&Array.isArray(Q)?w[P]=u.concat.apply(u,Q):I(u)&&I(Q)?w[P]=f(u,Q):w[P]=Q})),w}),{})}var b=function(){function w(w){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=w}return w.RegisterExtension=function(v,I){w.UnregisterExtension(v)&&z.e.Warn("Extension with the name '".concat(v,"' already exists")),w._RegisteredExtensions[v]={factory:I}},w.UnregisterExtension=function(v){return!!w._RegisteredExtensions[v]&&(delete w._RegisteredExtensions[v],!0)},Object.defineProperty(w.prototype,"gltf",{get:function(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"babylonScene",{get:function(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),w.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((function(w){return w.dispose&&w.dispose()})),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())},w.prototype.importMeshAsync=function(w,v,I,P,u,Q,K){var a=this;return void 0===K&&(K=""),Promise.resolve().then((function(){a._babylonScene=v,a._assetContainer=I,a._loadData(P);var Q=null;if(w){var U={};if(a._gltf.nodes)for(var p=0,r=a._gltf.nodes;p<r.length;p++){var Y=r[p];Y.name&&(U[Y.name]=Y.index)}Q=(w instanceof Array?w:[w]).map((function(w){var v=U[w];if(void 0===v)throw new Error("Failed to find node '".concat(w,"'"));return v}))}return a._loadAsync(u,K,Q,(function(){return{meshes:a._getMeshes(),particleSystems:[],skeletons:a._getSkeletons(),animationGroups:a._getAnimationGroups(),lights:a._babylonLights,transformNodes:a._getTransformNodes(),geometries:a._getGeometries()}}))}))},w.prototype.loadAsync=function(w,v,I,P,u){var Q=this;return void 0===u&&(u=""),Promise.resolve().then((function(){return Q._babylonScene=w,Q._loadData(v),Q._loadAsync(I,u,null,(function(){}))}))},w.prototype._loadAsync=function(w,v,I,P){var u=this;return Promise.resolve().then((function(){u._rootUrl=w,u._uniqueRootUrl=!w.startsWith("file:")&&v?w:"".concat(w).concat(Date.now(),"/"),u._fileName=v,u._loadExtensions(),u._checkExtensions();var Q="".concat(H.n[H.n.LOADING]," => ").concat(H.n[H.n.READY]),a="".concat(H.n[H.n.LOADING]," => ").concat(H.n[H.n.COMPLETE]);u._parent._startPerformanceCounter(Q),u._parent._startPerformanceCounter(a),u._parent._setState(H.n.LOADING),u._extensionsOnLoading();var U=new Array;if(!u.parent.loadOnlyMaterials)if(I)U.push(u.loadSceneAsync("/nodes",{nodes:I,index:-1}));else if(void 0!=u._gltf.scene||u._gltf.scenes&&u._gltf.scenes[0]){var p=D.Get("/scene",u._gltf.scenes,u._gltf.scene||0);U.push(u.loadSceneAsync("/scenes/".concat(p.index),p))}if(!u.parent.skipMaterials&&u.parent.loadAllMaterials&&u._gltf.materials)for(var r=0;r<u._gltf.materials.length;++r){var Y=u._gltf.materials[r],g="/materials/"+r,J=h.b.TriangleFillMode;U.push(u._loadMaterialAsync(g,Y,null,J,(function(){})))}return u._parent.compileMaterials&&U.push(u._compileMaterialsAsync()),u._parent.compileShadowGenerators&&U.push(u._compileShadowGeneratorsAsync()),Promise.all(U).then((function(){return u._rootBabylonMesh&&u._rootBabylonMesh.setEnabled(!0),u._extensionsOnReady(),u._parent._setState(H.n.READY),u._startAnimations(),P()})).then((function(w){return u._parent._endPerformanceCounter(Q),K.i.SetImmediate((function(){u._disposed||Promise.all(u._completePromises).then((function(){u._parent._endPerformanceCounter(a),u._parent._setState(H.n.COMPLETE),u._parent.onCompleteObservable.notifyObservers(void 0),u._parent.onCompleteObservable.clear(),u.dispose()}),(function(w){u._parent.onErrorObservable.notifyObservers(w),u._parent.onErrorObservable.clear(),u.dispose()}))})),w}))})).catch((function(w){throw u._disposed||(u._parent.onErrorObservable.notifyObservers(w),u._parent.onErrorObservable.clear(),u.dispose()),w}))},w.prototype._loadData=function(w){if(this._gltf=w.json,this._setupData(),w.bin){var v=this._gltf.buffers;if(v&&v[0]&&!v[0].uri){var I=v[0];(I.byteLength<w.bin.byteLength-3||I.byteLength>w.bin.byteLength)&&z.e.Warn("Binary buffer length (".concat(I.byteLength,") from JSON does not match chunk length (").concat(w.bin.byteLength,")")),this._bin=w.bin}else z.e.Warn("Unexpected BIN chunk")}},w.prototype._setupData=function(){if(D.Assign(this._gltf.accessors),D.Assign(this._gltf.animations),D.Assign(this._gltf.buffers),D.Assign(this._gltf.bufferViews),D.Assign(this._gltf.cameras),D.Assign(this._gltf.images),D.Assign(this._gltf.materials),D.Assign(this._gltf.meshes),D.Assign(this._gltf.nodes),D.Assign(this._gltf.samplers),D.Assign(this._gltf.scenes),D.Assign(this._gltf.skins),D.Assign(this._gltf.textures),this._gltf.nodes){for(var w={},v=0,I=this._gltf.nodes;v<I.length;v++){if((U=I[v]).children)for(var P=0,u=U.children;P<u.length;P++){w[u[P]]=U.index}}for(var Q=this._createRootNode(),K=0,a=this._gltf.nodes;K<a.length;K++){var U,p=w[(U=a[K]).index];U.parent=void 0===p?Q:this._gltf.nodes[p]}}},w.prototype._loadExtensions=function(){for(var v in w._RegisteredExtensions){var I=w._RegisteredExtensions[v].factory(this);I.name!==v&&z.e.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(I.name," !== ").concat(v)),this._extensions.push(I),this._parent.onExtensionLoadedObservable.notifyObservers(I)}this._extensions.sort((function(w,v){return(w.order||Number.MAX_VALUE)-(v.order||Number.MAX_VALUE)})),this._parent.onExtensionLoadedObservable.clear()},w.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var w=function(w){if(!v._extensions.some((function(v){return v.name===w&&v.enabled})))throw new Error("Require extension ".concat(w," is not available"))},v=this,I=0,P=this._gltf.extensionsRequired;I<P.length;I++){w(P[I])}},w.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=!!this._assetContainer,this._rootBabylonMesh=new N.b("__root__",this._babylonScene),this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var v={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case H.k.AUTO:this._babylonScene.useRightHandedSystem||(v.rotation=[0,1,0,0],v.scale=[1,1,-1],w._LoadTransform(v,this._rootBabylonMesh));break;case H.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),v},w.prototype.loadSceneAsync=function(w,v){var I=this,P=this._extensionsLoadSceneAsync(w,v);if(P)return P;var u=new Array;if(this.logOpen("".concat(w," ").concat(v.name||"")),v.nodes)for(var Q=0,K=v.nodes;Q<K.length;Q++){var a=K[Q],U=D.Get("".concat(w,"/nodes/").concat(a),this._gltf.nodes,a);u.push(this.loadNodeAsync("/nodes/".concat(U.index),U,(function(w){w.parent=I._rootBabylonMesh})))}for(var p=0,r=this._postSceneLoadActions;p<r.length;p++){(0,r[p])()}return u.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(u).then((function(){}))},w.prototype._forEachPrimitive=function(w,v){if(w._primitiveBabylonMeshes)for(var I=0,P=w._primitiveBabylonMeshes;I<P.length;I++){v(P[I])}},w.prototype._getGeometries=function(){var w=new Array,v=this._gltf.nodes;if(v)for(var I=0,P=v;I<P.length;I++){var u=P[I];this._forEachPrimitive(u,(function(v){var I=v.geometry;I&&-1===w.indexOf(I)&&w.push(I)}))}return w},w.prototype._getMeshes=function(){var w=new Array;this._rootBabylonMesh&&w.push(this._rootBabylonMesh);var v=this._gltf.nodes;if(v)for(var I=0,P=v;I<P.length;I++){var u=P[I];this._forEachPrimitive(u,(function(v){w.push(v)}))}return w},w.prototype._getTransformNodes=function(){var w=new Array,v=this._gltf.nodes;if(v)for(var I=0,P=v;I<P.length;I++){var u=P[I];u._babylonTransformNode&&"TransformNode"===u._babylonTransformNode.getClassName()&&w.push(u._babylonTransformNode),u._babylonTransformNodeForSkin&&w.push(u._babylonTransformNodeForSkin)}return w},w.prototype._getSkeletons=function(){var w=new Array,v=this._gltf.skins;if(v)for(var I=0,P=v;I<P.length;I++){var u=P[I];u._data&&w.push(u._data.babylonSkeleton)}return w},w.prototype._getAnimationGroups=function(){var w=new Array,v=this._gltf.animations;if(v)for(var I=0,P=v;I<P.length;I++){var u=P[I];u._babylonAnimationGroup&&w.push(u._babylonAnimationGroup)}return w},w.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case H.g.NONE:break;case H.g.FIRST:0!==(w=this._getAnimationGroups()).length&&w[0].start(!0);break;case H.g.ALL:for(var w,v=0,I=w=this._getAnimationGroups();v<I.length;v++){I[v].start(!0)}break;default:return void z.e.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}},w.prototype.loadNodeAsync=function(v,I,P){var u=this;void 0===P&&(P=function(){});var Q=this._extensionsLoadNodeAsync(v,I,P);if(Q)return Q;if(I._babylonTransformNode)throw new Error("".concat(v,": Invalid recursive node hierarchy"));var K=new Array;this.logOpen("".concat(v," ").concat(I.name||""));var a=function(Q){if(w.AddPointerMetadata(Q,v),w._LoadTransform(I,Q),void 0!=I.camera){var a=D.Get("".concat(v,"/camera"),u._gltf.cameras,I.camera);K.push(u.loadCameraAsync("/cameras/".concat(a.index),a,(function(w){w.parent=Q})))}if(I.children)for(var U=0,p=I.children;U<p.length;U++){var r=p[U],Y=D.Get("".concat(v,"/children/").concat(r),u._gltf.nodes,r);K.push(u.loadNodeAsync("/nodes/".concat(Y.index),Y,(function(w){w.parent=Q})))}P(Q)};if(void 0==I.mesh||void 0!=I.skin){var U=I.name||"node".concat(I.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var p=new V.d(U,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==I.mesh?I._babylonTransformNode=p:I._babylonTransformNodeForSkin=p,a(p)}if(void 0!=I.mesh)if(void 0==I.skin){var r=D.Get("".concat(v,"/mesh"),this._gltf.meshes,I.mesh);K.push(this._loadMeshAsync("/meshes/".concat(r.index),I,r,a))}else{r=D.Get("".concat(v,"/mesh"),this._gltf.meshes,I.mesh);K.push(this._loadMeshAsync("/meshes/".concat(r.index),I,r,(function(w){var P=I._babylonTransformNodeForSkin;w.metadata=f(P.metadata,w.metadata||{});var Q=D.Get("".concat(v,"/skin"),u._gltf.skins,I.skin);K.push(u._loadSkinAsync("/skins/".concat(Q.index),I,Q,(function(v){u._forEachPrimitive(I,(function(w){w.skeleton=v})),u._postSceneLoadActions.push((function(){if(void 0!=Q.skeleton){var v=D.Get("/skins/".concat(Q.index,"/skeleton"),u._gltf.nodes,Q.skeleton).parent;I.index===v.index?w.parent=P.parent:w.parent=v._babylonTransformNode}else w.parent=u._rootBabylonMesh;u._parent.onSkinLoadedObservable.notifyObservers({node:P,skinnedNode:w})}))})))})))}return this.logClose(),Promise.all(K).then((function(){return u._forEachPrimitive(I,(function(w){w.geometry&&w.geometry.useBoundingInfoFromGeometry?w._updateBoundingInfo():w.refreshBoundingInfo(!0)})),I._babylonTransformNode}))},w.prototype._loadMeshAsync=function(w,v,I,P){var u=I.primitives;if(!u||!u.length)throw new Error("".concat(w,": Primitives are missing"));void 0==u[0].index&&D.Assign(u);var Q=new Array;this.logOpen("".concat(w," ").concat(I.name||""));var K=v.name||"node".concat(v.index);if(1===u.length){var a=I.primitives[0];Q.push(this._loadMeshPrimitiveAsync("".concat(w,"/primitives/").concat(a.index),K,v,I,a,(function(w){v._babylonTransformNode=w,v._primitiveBabylonMeshes=[w]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,v._babylonTransformNode=new V.d(K,this._babylonScene),v._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._primitiveBabylonMeshes=[];for(var U=0,p=u;U<p.length;U++){a=p[U];Q.push(this._loadMeshPrimitiveAsync("".concat(w,"/primitives/").concat(a.index),"".concat(K,"_primitive").concat(a.index),v,I,a,(function(w){w.parent=v._babylonTransformNode,v._primitiveBabylonMeshes.push(w)})))}}return P(v._babylonTransformNode),this.logClose(),Promise.all(Q).then((function(){return v._babylonTransformNode}))},w.prototype._loadMeshPrimitiveAsync=function(v,I,P,u,Q,K){var a=this,U=this._extensionsLoadMeshPrimitiveAsync(v,I,P,u,Q,K);if(U)return U;this.logOpen("".concat(v));var p,r,Y=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==P.skin&&!u.primitives[0].targets;if(Y&&Q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,(p=Q._instanceData.babylonSourceMesh.createInstance(I))._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r=Q._instanceData.promise;else{var g=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;var J=new N.b(I,this._babylonScene);J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?h.b.CounterClockWiseSideOrientation:h.b.ClockWiseSideOrientation,this._createMorphTargets(v,P,u,Q,J),g.push(this._loadVertexDataAsync(v,Q,J).then((function(w){return a._loadMorphTargetsAsync(v,Q,J,w).then((function(){a._disposed||(a._babylonScene._blockEntityCollection=!!a._assetContainer,w.applyToMesh(J),w._parentContainer=a._assetContainer,a._babylonScene._blockEntityCollection=!1)}))})));var l=w._GetDrawMode(v,Q.mode);if(void 0==Q.material){var R=this._defaultBabylonMaterialData[l];R||(R=this._createDefaultMaterial("__GLTFLoader._default",l),this._parent.onMaterialLoadedObservable.notifyObservers(R),this._defaultBabylonMaterialData[l]=R),J.material=R}else if(!this.parent.skipMaterials){var x=D.Get("".concat(v,"/material"),this._gltf.materials,Q.material);g.push(this._loadMaterialAsync("/materials/".concat(x.index),x,J,l,(function(w){J.material=w})))}r=Promise.all(g),Y&&(Q._instanceData={babylonSourceMesh:J,promise:r}),p=J}return w.AddPointerMetadata(p,v),this._parent.onMeshLoadedObservable.notifyObservers(p),K(p),this.logClose(),r.then((function(){return p}))},w.prototype._loadVertexDataAsync=function(w,v,I){var P=this,Q=this._extensionsLoadVertexDataAsync(w,v,I);if(Q)return Q;var K=v.attributes;if(!K)throw new Error("".concat(w,": Attributes are missing"));var a=new Array,U=new O.b(I.name,this._babylonScene);if(void 0==v.indices)I.isUnIndexed=!0;else{var p=D.Get("".concat(w,"/indices"),this._gltf.accessors,v.indices);a.push(this._loadIndicesAccessorAsync("/accessors/".concat(p.index),p).then((function(w){U.setIndices(w)})))}var r=function(v,Q,p){if(void 0!=K[v]){I._delayInfo=I._delayInfo||[],-1===I._delayInfo.indexOf(Q)&&I._delayInfo.push(Q);var r=D.Get("".concat(w,"/attributes/").concat(v),P._gltf.accessors,K[v]);a.push(P._loadVertexAccessorAsync("/accessors/".concat(r.index),r,Q).then((function(w){if(w.getKind()===F.f.PositionKind&&!P.parent.alwaysComputeBoundingBox&&!I.skeleton){var v=r.min,Q=r.max;if(void 0!==v&&void 0!==Q){if(r.normalized&&5126!==r.componentType){var K=1;switch(r.componentType){case 5120:K=127;break;case 5121:K=255;break;case 5122:K=32767;break;case 5123:K=65535}for(var a=0;a<3;++a)v[a]=Math.max(v[a]/K,-1),Q[a]=Math.max(Q[a]/K,-1)}var p=u.i.Vector3[0],Y=u.i.Vector3[1];p.copyFromFloats.apply(p,v),Y.copyFromFloats.apply(Y,Q),U._boundingInfo=new d.e(p,Y),U.useBoundingInfoFromGeometry=!0}}U.setVerticesBuffer(w,r.count)}))),Q==F.f.MatricesIndicesExtraKind&&(I.numBoneInfluencers=8),p&&p(r)}};return r("POSITION",F.f.PositionKind),r("NORMAL",F.f.NormalKind),r("TANGENT",F.f.TangentKind),r("TEXCOORD_0",F.f.UVKind),r("TEXCOORD_1",F.f.UV2Kind),r("TEXCOORD_2",F.f.UV3Kind),r("TEXCOORD_3",F.f.UV4Kind),r("TEXCOORD_4",F.f.UV5Kind),r("TEXCOORD_5",F.f.UV6Kind),r("JOINTS_0",F.f.MatricesIndicesKind),r("WEIGHTS_0",F.f.MatricesWeightsKind),r("JOINTS_1",F.f.MatricesIndicesExtraKind),r("WEIGHTS_1",F.f.MatricesWeightsExtraKind),r("COLOR_0",F.f.ColorKind,(function(w){"VEC4"===w.type&&(I.hasVertexAlpha=!0)})),Promise.all(a).then((function(){return U}))},w.prototype._createMorphTargets=function(w,v,I,P,u){if(P.targets){if(void 0==v._numMorphTargets)v._numMorphTargets=P.targets.length;else if(P.targets.length!==v._numMorphTargets)throw new Error("".concat(w,": Primitives do not have the same number of targets"));var Q=I.extras?I.extras.targetNames:null;u.morphTargetManager=new e(u.getScene()),u.morphTargetManager.areUpdatesFrozen=!0;for(var K=0;K<P.targets.length;K++){var a=v.weights?v.weights[K]:I.weights?I.weights[K]:0,U=Q?Q[K]:"morphTarget".concat(K);u.morphTargetManager.addTarget(new c(U,a,u.getScene()))}}},w.prototype._loadMorphTargetsAsync=function(w,v,I,P){if(!v.targets)return Promise.resolve();for(var u=new Array,Q=I.morphTargetManager,K=0;K<Q.numTargets;K++){var a=Q.getTarget(K);u.push(this._loadMorphTargetVertexDataAsync("".concat(w,"/targets/").concat(K),P,v.targets[K],a))}return Promise.all(u).then((function(){Q.areUpdatesFrozen=!1}))},w.prototype._loadMorphTargetVertexDataAsync=function(w,v,I,P){var u=this,Q=new Array,K=function(P,K,a){if(void 0!=I[P]){var U=v.getVertexBuffer(K);if(U){var p=D.Get("".concat(w,"/").concat(P),u._gltf.accessors,I[P]);Q.push(u._loadFloatAccessorAsync("/accessors/".concat(p.index),p).then((function(w){a(U,w)})))}}};return K("POSITION",F.f.PositionKind,(function(w,v){var I=new Float32Array(v.length);w.forEach(v.length,(function(w,P){I[P]=v[P]+w})),P.setPositions(I)})),K("NORMAL",F.f.NormalKind,(function(w,v){var I=new Float32Array(v.length);w.forEach(I.length,(function(w,P){I[P]=v[P]+w})),P.setNormals(I)})),K("TANGENT",F.f.TangentKind,(function(w,v){var I=new Float32Array(v.length/3*4),u=0;w.forEach(v.length/3*4,(function(w,P){(P+1)%4!==0&&(I[u]=v[u]+w,u++)})),P.setTangents(I)})),Promise.all(Q).then((function(){}))},w._LoadTransform=function(w,v){if(void 0==w.skin){var I=u.l.Zero(),P=u.f.Identity(),Q=u.l.One();if(w.matrix)u.e.FromArray(w.matrix).decompose(Q,P,I);else w.translation&&(I=u.l.FromArray(w.translation)),w.rotation&&(P=u.f.FromArray(w.rotation)),w.scale&&(Q=u.l.FromArray(w.scale));v.position=I,v.rotationQuaternion=P,v.scaling=Q}},w.prototype._loadSkinAsync=function(w,v,I,P){var u=this,Q=this._extensionsLoadSkinAsync(w,v,I);if(Q)return Q;if(I._data)return P(I._data.babylonSkeleton),I._data.promise;var K="skeleton".concat(I.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var a=new o(I.name||K,K,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(w,I,a);var U=this._loadSkinInverseBindMatricesDataAsync(w,I).then((function(w){u._updateBoneMatrices(a,w)}));return I._data={babylonSkeleton:a,promise:U},P(a),U},w.prototype._loadBones=function(w,v,I){if(void 0==v.skeleton||this._parent.alwaysComputeSkeletonRootNode){var P=this._findSkeletonRootNode("".concat(w,"/joints"),v.joints);if(P)if(void 0===v.skeleton)v.skeleton=P.index;else{var u=D.Get("".concat(w,"/skeleton"),this._gltf.nodes,v.skeleton);u===P||function(w,v){for(;v.parent;v=v.parent)if(v.parent===w)return!0;return!1}(u,P)||(z.e.Warn("".concat(w,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),v.skeleton=P.index)}else z.e.Warn("".concat(w,": Failed to find common root"))}for(var Q={},K=0,a=v.joints;K<a.length;K++){var U=a[K],p=D.Get("".concat(w,"/joints/").concat(U),this._gltf.nodes,U);this._loadBone(p,v,I,Q)}},w.prototype._findSkeletonRootNode=function(w,v){if(0===v.length)return null;for(var I={},P=0,u=v;P<u.length;P++){for(var Q=u[P],K=new Array,a=D.Get("".concat(w,"/").concat(Q),this._gltf.nodes,Q);-1!==a.index;)K.unshift(a),a=a.parent;I[Q]=K}for(var U=null,p=0;;++p){if(p>=(K=I[v[0]]).length)return U;a=K[p];for(var r=1;r<v.length;++r)if(p>=(K=I[v[r]]).length||a!==K[p])return U;U=a}},w.prototype._loadBone=function(w,v,I,P){var u=P[w.index];if(u)return u;var Q=null;w.index!==v.skeleton&&(w.parent&&-1!==w.parent.index?Q=this._loadBone(w.parent,v,I,P):void 0!==v.skeleton&&z.e.Warn("/skins/".concat(v.index,"/skeleton: Skeleton node is not a common root")));var K=v.joints.indexOf(w.index);return u=new B(w.name||"joint".concat(w.index),I,Q,this._getNodeMatrix(w),null,null,K),P[w.index]=u,this._postSceneLoadActions.push((function(){u.linkTransformNode(w._babylonTransformNode)})),u},w.prototype._loadSkinInverseBindMatricesDataAsync=function(w,v){if(void 0==v.inverseBindMatrices)return Promise.resolve(null);var I=D.Get("".concat(w,"/inverseBindMatrices"),this._gltf.accessors,v.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(I.index),I)},w.prototype._updateBoneMatrices=function(w,v){for(var I=0,P=w.bones;I<P.length;I++){var Q=P[I],K=u.e.Identity(),a=Q._index;v&&-1!==a&&(u.e.FromArrayToRef(v,16*a,K),K.invertToRef(K));var U=Q.getParent();U&&K.multiplyToRef(U.getInvertedAbsoluteTransform(),K),Q.updateMatrix(K,!1,!1),Q._updateDifferenceMatrix(void 0,!1)}},w.prototype._getNodeMatrix=function(w){return w.matrix?u.e.FromArray(w.matrix):u.e.Compose(w.scale?u.l.FromArray(w.scale):u.l.One(),w.rotation?u.f.FromArray(w.rotation):u.f.Identity(),w.translation?u.l.FromArray(w.translation):u.l.Zero())},w.prototype.loadCameraAsync=function(v,I,P){void 0===P&&(P=function(){});var Q=this._extensionsLoadCameraAsync(v,I,P);if(Q)return Q;var K=new Array;this.logOpen("".concat(v," ").concat(I.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;var p=new U.e(I.name||"camera".concat(I.index),u.l.Zero(),this._babylonScene,!1);switch(p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.ignoreParentScaling=!0,p.rotation=new u.l(0,Math.PI,0),I.type){case"perspective":var r=I.perspective;if(!r)throw new Error("".concat(v,": Camera perspective properties are missing"));p.fov=r.yfov,p.minZ=r.znear,p.maxZ=r.zfar||0;break;case"orthographic":if(!I.orthographic)throw new Error("".concat(v,": Camera orthographic properties are missing"));p.mode=a.e.ORTHOGRAPHIC_CAMERA,p.orthoLeft=-I.orthographic.xmag,p.orthoRight=I.orthographic.xmag,p.orthoBottom=-I.orthographic.ymag,p.orthoTop=I.orthographic.ymag,p.minZ=I.orthographic.znear,p.maxZ=I.orthographic.zfar;break;default:throw new Error("".concat(v,": Invalid camera type (").concat(I.type,")"))}return w.AddPointerMetadata(p,v),this._parent.onCameraLoadedObservable.notifyObservers(p),P(p),this.logClose(),Promise.all(K).then((function(){return p}))},w.prototype._loadAnimationsAsync=function(){var w=this._gltf.animations;if(!w)return Promise.resolve();for(var v=new Array,I=0;I<w.length;I++){var P=w[I];v.push(this.loadAnimationAsync("/animations/".concat(P.index),P).then((function(w){0===w.targetedAnimations.length&&w.dispose()})))}return Promise.all(v).then((function(){}))},w.prototype.loadAnimationAsync=function(w,v){var I=this._extensionsLoadAnimationAsync(w,v);if(I)return I;this._babylonScene._blockEntityCollection=!!this._assetContainer;var P=new l(v.name||"animation".concat(v.index),this._babylonScene);P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._babylonAnimationGroup=P;var u=new Array;D.Assign(v.channels),D.Assign(v.samplers);for(var Q=0,K=v.channels;Q<K.length;Q++){var a=K[Q];u.push(this._loadAnimationChannelAsync("".concat(w,"/channels/").concat(a.index),w,v,a,P))}return Promise.all(u).then((function(){return P.normalize(0),P}))},w.prototype._loadAnimationChannelAsync=function(w,v,I,P,Q,K){var a=this;if(void 0===K&&(K=null),void 0==P.target.node)return Promise.resolve();var U=D.Get("".concat(w,"/target/node"),this._gltf.nodes,P.target.node);if("weights"===P.target.path&&!U._numMorphTargets||"weights"!==P.target.path&&!U._babylonTransformNode)return Promise.resolve();var r=D.Get("".concat(w,"/sampler"),I.samplers,P.sampler);return this._loadAnimationSamplerAsync("".concat(v,"/samplers/").concat(P.sampler),r).then((function(v){var I,r;switch(P.target.path){case"translation":I="position",r=p.b.ANIMATIONTYPE_VECTOR3;break;case"rotation":I="rotationQuaternion",r=p.b.ANIMATIONTYPE_QUATERNION;break;case"scale":I="scaling",r=p.b.ANIMATIONTYPE_VECTOR3;break;case"weights":I="influence",r=p.b.ANIMATIONTYPE_FLOAT;break;default:throw new Error("".concat(w,"/target/path: Invalid value (").concat(P.target.path,")"))}var Y,g,J=0;switch(I){case"position":Y=function(w){var I=u.l.FromArray(v.output,J).scaleInPlace(w);return J+=3,I};break;case"rotationQuaternion":Y=function(w){var I=u.f.FromArray(v.output,J).scaleInPlace(w);return J+=4,I};break;case"scaling":Y=function(w){var I=u.l.FromArray(v.output,J).scaleInPlace(w);return J+=3,I};break;case"influence":Y=function(w){for(var I=new Array(U._numMorphTargets),P=0;P<U._numMorphTargets;P++)I[P]=v.output[J++]*w;return I}}switch(v.interpolation){case"STEP":g=function(w){return{frame:v.input[w]*a.parent.targetFps,value:Y(1),interpolation:G.d.STEP}};break;case"LINEAR":g=function(w){return{frame:v.input[w]*a.parent.targetFps,value:Y(1)}};break;case"CUBICSPLINE":var l=1/a.parent.targetFps;g=function(w){return{frame:v.input[w]*a.parent.targetFps,inTangent:Y(l),value:Y(1),outTangent:Y(l)}}}for(var R=new Array(v.input.length),x=0;x<v.input.length;x++)R[x]=g(x);if("influence"===I)for(var j=function(w){var v="".concat(Q.name,"_channel").concat(Q.targetedAnimations.length),P=new p.b(v,I,a.parent.targetFps,r);P.setKeys(R.map((function(v){return{frame:v.frame,inTangent:v.inTangent?v.inTangent[w]:void 0,value:v.value[w],outTangent:v.outTangent?v.outTangent[w]:void 0,interpolation:v.interpolation}}))),a._forEachPrimitive(U,(function(v){var I=v;if(I.morphTargetManager){var u=I.morphTargetManager.getTarget(w),K=P.clone();u.animations.push(K),Q.addTargetedAnimation(K,u)}}))},s=0;s<U._numMorphTargets;s++)j(s);else{var B="".concat(Q.name,"_channel").concat(Q.targetedAnimations.length),t=new p.b(B,I,a.parent.targetFps,r);t.setKeys(R),null!=K&&null!=K.animations?(K.animations.push(t),Q.addTargetedAnimation(t,K)):(U._babylonTransformNode.animations.push(t),Q.addTargetedAnimation(t,U._babylonTransformNode))}}))},w.prototype._loadAnimationSamplerAsync=function(w,v){if(v._data)return v._data;var I=v.interpolation||"LINEAR";switch(I){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(w,"/interpolation: Invalid value (").concat(v.interpolation,")"))}var P=D.Get("".concat(w,"/input"),this._gltf.accessors,v.input),u=D.Get("".concat(w,"/output"),this._gltf.accessors,v.output);return v._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(P.index),P),this._loadFloatAccessorAsync("/accessors/".concat(u.index),u)]).then((function(w){var v=w[0],P=w[1];return{input:v,interpolation:I,output:P}})),v._data},w.prototype.loadBufferAsync=function(w,v,I,P){var u=this._extensionsLoadBufferAsync(w,v,I,P);if(u)return u;if(!v._data)if(v.uri)v._data=this.loadUriAsync("".concat(w,"/uri"),v,v.uri);else{if(!this._bin)throw new Error("".concat(w,": Uri is missing or the binary glTF is missing its binary chunk"));v._data=this._bin.readAsync(0,v.byteLength)}return v._data.then((function(v){try{return new Uint8Array(v.buffer,v.byteOffset+I,P)}catch(v){throw new Error("".concat(w,": ").concat(v.message))}}))},w.prototype.loadBufferViewAsync=function(w,v){var I=this._extensionsLoadBufferViewAsync(w,v);if(I)return I;if(v._data)return v._data;var P=D.Get("".concat(w,"/buffer"),this._gltf.buffers,v.buffer);return v._data=this.loadBufferAsync("/buffers/".concat(P.index),P,v.byteOffset||0,v.byteLength),v._data},w.prototype._loadAccessorAsync=function(v,I,P){var u=this;if(I._data)return I._data;var Q=w._GetNumComponents(v,I.type),K=Q*F.f.GetTypeByteLength(I.componentType),a=Q*I.count;if(void 0==I.bufferView)I._data=Promise.resolve(new P(a));else{var U=D.Get("".concat(v,"/bufferView"),this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync("/bufferViews/".concat(U.index),U).then((function(u){if(5126!==I.componentType||I.normalized||U.byteStride&&U.byteStride!==K){var p=new P(a);return F.f.ForEach(u,I.byteOffset||0,U.byteStride||K,Q,I.componentType,p.length,I.normalized||!1,(function(w,v){p[v]=w})),p}return w._GetTypedArray(v,I.componentType,u,I.byteOffset,a)}))}if(I.sparse){var p=I.sparse;I._data=I._data.then((function(a){var U=a,r=D.Get("".concat(v,"/sparse/indices/bufferView"),u._gltf.bufferViews,p.indices.bufferView),Y=D.Get("".concat(v,"/sparse/values/bufferView"),u._gltf.bufferViews,p.values.bufferView);return Promise.all([u.loadBufferViewAsync("/bufferViews/".concat(r.index),r),u.loadBufferViewAsync("/bufferViews/".concat(Y.index),Y)]).then((function(u){var a,r=u[0],Y=u[1],g=w._GetTypedArray("".concat(v,"/sparse/indices"),p.indices.componentType,r,p.indices.byteOffset,p.count),J=Q*p.count;if(5126!==I.componentType||I.normalized){var l=w._GetTypedArray("".concat(v,"/sparse/values"),I.componentType,Y,p.values.byteOffset,J);a=new P(J),F.f.ForEach(l,0,K,Q,I.componentType,a.length,I.normalized||!1,(function(w,v){a[v]=w}))}else a=w._GetTypedArray("".concat(v,"/sparse/values"),I.componentType,Y,p.values.byteOffset,J);for(var R=0,x=0;x<g.length;x++)for(var j=g[x]*Q,s=0;s<Q;s++)U[j++]=a[R++];return U}))}))}return I._data},w.prototype._loadFloatAccessorAsync=function(w,v){return this._loadAccessorAsync(w,v,Float32Array)},w.prototype._loadIndicesAccessorAsync=function(v,I){if("SCALAR"!==I.type)throw new Error("".concat(v,"/type: Invalid value ").concat(I.type));if(5121!==I.componentType&&5123!==I.componentType&&5125!==I.componentType)throw new Error("".concat(v,"/componentType: Invalid value ").concat(I.componentType));if(I._data)return I._data;if(I.sparse){var P=w._GetTypedArrayConstructor("".concat(v,"/componentType"),I.componentType);I._data=this._loadAccessorAsync(v,I,P)}else{var u=D.Get("".concat(v,"/bufferView"),this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync("/bufferViews/".concat(u.index),u).then((function(P){return w._GetTypedArray(v,I.componentType,P,I.byteOffset,I.count)}))}return I._data},w.prototype._loadVertexBufferViewAsync=function(w){if(w._babylonBuffer)return w._babylonBuffer;var v=this._babylonScene.getEngine();return w._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(w.index),w).then((function(w){return new F.c(v,w,!1)})),w._babylonBuffer},w.prototype._loadVertexAccessorAsync=function(v,I,P){var u;if(null===(u=I._babylonVertexBuffer)||void 0===u?void 0:u[P])return I._babylonVertexBuffer[P];I._babylonVertexBuffer||(I._babylonVertexBuffer={});var Q=this._babylonScene.getEngine();if(I.sparse)I._babylonVertexBuffer[P]=this._loadFloatAccessorAsync(v,I).then((function(w){return new F.f(Q,w,P,!1)}));else if(P===F.f.MatricesIndicesKind||P===F.f.MatricesIndicesExtraKind)I._babylonVertexBuffer[P]=this._loadFloatAccessorAsync(v,I).then((function(w){return new F.f(Q,w,P,!1)}));else{var K=D.Get("".concat(v,"/bufferView"),this._gltf.bufferViews,I.bufferView);I._babylonVertexBuffer[P]=this._loadVertexBufferViewAsync(K).then((function(u){var a=w._GetNumComponents(v,I.type);return new F.f(Q,u,P,!1,!1,K.byteStride,!1,I.byteOffset,a,I.componentType,I.normalized,!0,1,!0)}))}return I._babylonVertexBuffer[P]},w.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(w,v,I){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var P=new Array;return v&&(v.baseColorFactor?(I.albedoColor=Q.b.FromArray(v.baseColorFactor),I.alpha=v.baseColorFactor[3]):I.albedoColor=Q.b.White(),I.metallic=void 0==v.metallicFactor?1:v.metallicFactor,I.roughness=void 0==v.roughnessFactor?1:v.roughnessFactor,v.baseColorTexture&&P.push(this.loadTextureInfoAsync("".concat(w,"/baseColorTexture"),v.baseColorTexture,(function(w){w.name="".concat(I.name," (Base Color)"),I.albedoTexture=w}))),v.metallicRoughnessTexture&&(v.metallicRoughnessTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync("".concat(w,"/metallicRoughnessTexture"),v.metallicRoughnessTexture,(function(w){w.name="".concat(I.name," (Metallic Roughness)"),I.metallicTexture=w}))),I.useMetallnessFromMetallicTextureBlue=!0,I.useRoughnessFromMetallicTextureGreen=!0,I.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(P).then((function(){}))},w.prototype._loadMaterialAsync=function(v,I,P,u,Q){void 0===Q&&(Q=function(){});var K=this._extensionsLoadMaterialAsync(v,I,P,u,Q);if(K)return K;I._data=I._data||{};var a=I._data[u];if(!a){this.logOpen("".concat(v," ").concat(I.name||""));var U=this.createMaterial(v,I,u);a={babylonMaterial:U,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(v,I,U)},I._data[u]=a,w.AddPointerMetadata(U,v),this._parent.onMaterialLoadedObservable.notifyObservers(U),this.logClose()}return P&&(a.babylonMeshes.push(P),P.onDisposeObservable.addOnce((function(){var w=a.babylonMeshes.indexOf(P);-1!==w&&a.babylonMeshes.splice(w,1)}))),Q(a.babylonMaterial),a.promise.then((function(){return a.babylonMaterial}))},w.prototype._createDefaultMaterial=function(w,v){this._babylonScene._blockEntityCollection=!!this._assetContainer;var I=new n.d(w,this._babylonScene);return I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I.fillMode=v,I.enableSpecularAntiAliasing=!0,I.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,I.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,I.transparencyMode=n.d.PBRMATERIAL_OPAQUE,I.metallic=1,I.roughness=1,I},w.prototype.createMaterial=function(w,v,I){var P=this._extensionsCreateMaterial(w,v,I);if(P)return P;var u=v.name||"material".concat(v.index);return this._createDefaultMaterial(u,I)},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this._extensionsLoadMaterialPropertiesAsync(w,v,I);if(P)return P;var u=new Array;return u.push(this.loadMaterialBasePropertiesAsync(w,v,I)),v.pbrMetallicRoughness&&u.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(w,"/pbrMetallicRoughness"),v.pbrMetallicRoughness,I)),this.loadMaterialAlphaProperties(w,v,I),Promise.all(u).then((function(){}))},w.prototype.loadMaterialBasePropertiesAsync=function(w,v,I){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var P=new Array;return I.emissiveColor=v.emissiveFactor?Q.b.FromArray(v.emissiveFactor):new Q.b(0,0,0),v.doubleSided&&(I.backFaceCulling=!1,I.twoSidedLighting=!0),v.normalTexture&&(v.normalTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync("".concat(w,"/normalTexture"),v.normalTexture,(function(w){w.name="".concat(I.name," (Normal)"),I.bumpTexture=w}))),I.invertNormalMapX=!this._babylonScene.useRightHandedSystem,I.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=v.normalTexture.scale&&I.bumpTexture&&(I.bumpTexture.level=v.normalTexture.scale),I.forceIrradianceInFragment=!0),v.occlusionTexture&&(v.occlusionTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync("".concat(w,"/occlusionTexture"),v.occlusionTexture,(function(w){w.name="".concat(I.name," (Occlusion)"),I.ambientTexture=w}))),I.useAmbientInGrayScale=!0,void 0!=v.occlusionTexture.strength&&(I.ambientTextureStrength=v.occlusionTexture.strength)),v.emissiveTexture&&P.push(this.loadTextureInfoAsync("".concat(w,"/emissiveTexture"),v.emissiveTexture,(function(w){w.name="".concat(I.name," (Emissive)"),I.emissiveTexture=w}))),Promise.all(P).then((function(){}))},w.prototype.loadMaterialAlphaProperties=function(w,v,I){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));switch(v.alphaMode||"OPAQUE"){case"OPAQUE":I.transparencyMode=n.d.PBRMATERIAL_OPAQUE;break;case"MASK":I.transparencyMode=n.d.PBRMATERIAL_ALPHATEST,I.alphaCutOff=void 0==v.alphaCutoff?.5:v.alphaCutoff,I.albedoTexture&&(I.albedoTexture.hasAlpha=!0);break;case"BLEND":I.transparencyMode=n.d.PBRMATERIAL_ALPHABLEND,I.albedoTexture&&(I.albedoTexture.hasAlpha=!0,I.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(w,"/alphaMode: Invalid value (").concat(v.alphaMode,")"))}},w.prototype.loadTextureInfoAsync=function(v,I,P){var u=this;void 0===P&&(P=function(){});var Q=this._extensionsLoadTextureInfoAsync(v,I,P);if(Q)return Q;if(this.logOpen("".concat(v)),I.texCoord>=6)throw new Error("".concat(v,"/texCoord: Invalid value (").concat(I.texCoord,")"));var K=D.Get("".concat(v,"/index"),this._gltf.textures,I.index);K._textureInfo=I;var a=this._loadTextureAsync("/textures/".concat(I.index),K,(function(Q){Q.coordinatesIndex=I.texCoord||0,w.AddPointerMetadata(Q,v),u._parent.onTextureLoadedObservable.notifyObservers(Q),P(Q)}));return this.logClose(),a},w.prototype._loadTextureAsync=function(v,I,P){void 0===P&&(P=function(){});var u=this._extensionsLoadTextureAsync(v,I,P);if(u)return u;this.logOpen("".concat(v," ").concat(I.name||""));var Q=void 0==I.sampler?w.DefaultSampler:D.Get("".concat(v,"/sampler"),this._gltf.samplers,I.sampler),K=D.Get("".concat(v,"/source"),this._gltf.images,I.source),a=this._createTextureAsync(v,Q,K,P,void 0,!I._textureInfo.nonColorData);return this.logClose(),a},w.prototype._createTextureAsync=function(w,v,I,u,Q,K){var a=this;void 0===u&&(u=function(){});var U=this._loadSampler("/samplers/".concat(v.index),v),p=new Array,r=new P;this._babylonScene._blockEntityCollection=!!this._assetContainer;var Y={noMipmap:U.noMipMaps,invertY:!1,samplingMode:U.samplingMode,onLoad:function(){a._disposed||r.resolve()},onError:function(v,I){a._disposed||r.reject(new Error("".concat(w,": ").concat(I&&I.message?I.message:v||"Failed to load texture")))},mimeType:I.mimeType,loaderOptions:Q,useSRGBBuffer:!!K&&this._parent.useSRGBBuffers},g=new W.e(null,this._babylonScene,Y);return g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.push(r.promise),p.push(this.loadImageAsync("/images/".concat(I.index),I).then((function(w){var v=I.uri||"".concat(a._fileName,"#image").concat(I.index),P="data:".concat(a._uniqueRootUrl).concat(v);g.updateURL(P,w)}))),g.wrapU=U.wrapU,g.wrapV=U.wrapV,u(g),Promise.all(p).then((function(){return g}))},w.prototype._loadSampler=function(v,I){return I._data||(I._data={noMipMaps:9728===I.minFilter||9729===I.minFilter,samplingMode:w._GetTextureSamplingMode(v,I),wrapU:w._GetTextureWrapMode("".concat(v,"/wrapS"),I.wrapS),wrapV:w._GetTextureWrapMode("".concat(v,"/wrapT"),I.wrapT)}),I._data},w.prototype.loadImageAsync=function(w,v){if(!v._data){if(this.logOpen("".concat(w," ").concat(v.name||"")),v.uri)v._data=this.loadUriAsync("".concat(w,"/uri"),v,v.uri);else{var I=D.Get("".concat(w,"/bufferView"),this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync("/bufferViews/".concat(I.index),I)}this.logClose()}return v._data},w.prototype.loadUriAsync=function(v,I,P){var u=this,Q=this._extensionsLoadUriAsync(v,I,P);if(Q)return Q;if(!w._ValidateUri(P))throw new Error("".concat(v,": '").concat(P,"' is invalid"));if((0,L.h)(P)){var K=new Uint8Array((0,L.c)(P));return this.log("".concat(v,": Decoded ").concat(P.substr(0,64),"... (").concat(K.length," bytes)")),Promise.resolve(K)}return this.log("".concat(v,": Loading ").concat(P)),this._parent.preprocessUrlAsync(this._rootUrl+P).then((function(w){return new Promise((function(I,Q){u._parent._loadFile(u._babylonScene,w,(function(w){u._disposed||(u.log("".concat(v,": Loaded ").concat(P," (").concat(w.byteLength," bytes)")),I(new Uint8Array(w)))}),!0,(function(w){Q(new L.j("".concat(v,": Failed to load '").concat(P,"'").concat(w?": "+w.status+" "+w.statusText:""),w))}))}))}))},w.AddPointerMetadata=function(w,v){var I=w.metadata=w.metadata||{},P=I.gltf=I.gltf||{};(P.pointers=P.pointers||[]).push(v)},w._GetTextureWrapMode=function(w,v){switch(v=void 0==v?10497:v){case 33071:return W.e.CLAMP_ADDRESSMODE;case 33648:return W.e.MIRROR_ADDRESSMODE;case 10497:return W.e.WRAP_ADDRESSMODE;default:return z.e.Warn("".concat(w,": Invalid value (").concat(v,")")),W.e.WRAP_ADDRESSMODE}},w._GetTextureSamplingMode=function(w,v){var I=void 0==v.magFilter?9729:v.magFilter,P=void 0==v.minFilter?9987:v.minFilter;if(9729===I)switch(P){case 9728:return W.e.LINEAR_NEAREST;case 9729:return W.e.LINEAR_LINEAR;case 9984:return W.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return W.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return W.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return W.e.LINEAR_LINEAR_MIPLINEAR;default:return z.e.Warn("".concat(w,"/minFilter: Invalid value (").concat(P,")")),W.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==I&&z.e.Warn("".concat(w,"/magFilter: Invalid value (").concat(I,")")),P){case 9728:return W.e.NEAREST_NEAREST;case 9729:return W.e.NEAREST_LINEAR;case 9984:return W.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return W.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return W.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return W.e.NEAREST_LINEAR_MIPLINEAR;default:return z.e.Warn("".concat(w,"/minFilter: Invalid value (").concat(P,")")),W.e.NEAREST_NEAREST_MIPNEAREST}},w._GetTypedArrayConstructor=function(w,v){switch(v){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("".concat(w,": Invalid component type ").concat(v))}},w._GetTypedArray=function(v,I,P,u,Q){var K=P.buffer;u=P.byteOffset+(u||0);var a=w._GetTypedArrayConstructor("".concat(v,"/componentType"),I),U=F.f.GetTypeByteLength(I);return u%U!==0?(z.e.Warn("".concat(v,": Copying buffer as byte offset (").concat(u,") is not a multiple of component type byte length (").concat(U,")")),new a(K.slice(u,u+Q*U),0)):new a(K,u,Q)},w._GetNumComponents=function(w,v){switch(v){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(w,": Invalid type (").concat(v,")"))},w._ValidateUri=function(w){return K.i.IsBase64(w)||-1===w.indexOf("..")},w._GetDrawMode=function(w,v){switch(void 0==v&&(v=4),v){case 0:return h.b.PointListDrawMode;case 1:return h.b.LineListDrawMode;case 2:return h.b.LineLoopDrawMode;case 3:return h.b.LineStripDrawMode;case 4:return h.b.TriangleFillMode;case 5:return h.b.TriangleStripDrawMode;case 6:return h.b.TriangleFanDrawMode}throw new Error("".concat(w,": Invalid mesh primitive mode (").concat(v,")"))},w.prototype._compileMaterialsAsync=function(){var w=this;this._parent._startPerformanceCounter("Compile materials");var v=new Array;if(this._gltf.materials)for(var I=0,P=this._gltf.materials;I<P.length;I++){var u=P[I];if(u._data)for(var Q in u._data)for(var K=u._data[Q],a=0,U=K.babylonMeshes;a<U.length;a++){var p=U[a];p.computeWorldMatrix(!0);var r=K.babylonMaterial;v.push(r.forceCompilationAsync(p)),v.push(r.forceCompilationAsync(p,{useInstances:!0})),this._parent.useClipPlane&&(v.push(r.forceCompilationAsync(p,{clipPlane:!0})),v.push(r.forceCompilationAsync(p,{clipPlane:!0,useInstances:!0})))}}return Promise.all(v).then((function(){w._parent._endPerformanceCounter("Compile materials")}))},w.prototype._compileShadowGeneratorsAsync=function(){var w=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var v=new Array,I=0,P=this._babylonScene.lights;I<P.length;I++){var u=P[I].getShadowGenerator();u&&v.push(u.forceCompilationAsync())}return Promise.all(v).then((function(){w._parent._endPerformanceCounter("Compile shadow generators")}))},w.prototype._forEachExtensions=function(w){for(var v=0,I=this._extensions;v<I.length;v++){var P=I[v];P.enabled&&w(P)}},w.prototype._applyExtensions=function(w,v,I){for(var P=0,u=this._extensions;P<u.length;P++){var Q=u[P];if(Q.enabled){var K="".concat(Q.name,".").concat(v),a=w;a._activeLoaderExtensionFunctions=a._activeLoaderExtensionFunctions||{};var U=a._activeLoaderExtensionFunctions;if(!U[K]){U[K]=!0;try{var p=I(Q);if(p)return p}finally{delete U[K]}}}}return null},w.prototype._extensionsOnLoading=function(){this._forEachExtensions((function(w){return w.onLoading&&w.onLoading()}))},w.prototype._extensionsOnReady=function(){this._forEachExtensions((function(w){return w.onReady&&w.onReady()}))},w.prototype._extensionsLoadSceneAsync=function(w,v){return this._applyExtensions(v,"loadScene",(function(I){return I.loadSceneAsync&&I.loadSceneAsync(w,v)}))},w.prototype._extensionsLoadNodeAsync=function(w,v,I){return this._applyExtensions(v,"loadNode",(function(P){return P.loadNodeAsync&&P.loadNodeAsync(w,v,I)}))},w.prototype._extensionsLoadCameraAsync=function(w,v,I){return this._applyExtensions(v,"loadCamera",(function(P){return P.loadCameraAsync&&P.loadCameraAsync(w,v,I)}))},w.prototype._extensionsLoadVertexDataAsync=function(w,v,I){return this._applyExtensions(v,"loadVertexData",(function(P){return P._loadVertexDataAsync&&P._loadVertexDataAsync(w,v,I)}))},w.prototype._extensionsLoadMeshPrimitiveAsync=function(w,v,I,P,u,Q){return this._applyExtensions(u,"loadMeshPrimitive",(function(K){return K._loadMeshPrimitiveAsync&&K._loadMeshPrimitiveAsync(w,v,I,P,u,Q)}))},w.prototype._extensionsLoadMaterialAsync=function(w,v,I,P,u){return this._applyExtensions(v,"loadMaterial",(function(Q){return Q._loadMaterialAsync&&Q._loadMaterialAsync(w,v,I,P,u)}))},w.prototype._extensionsCreateMaterial=function(w,v,I){return this._applyExtensions(v,"createMaterial",(function(P){return P.createMaterial&&P.createMaterial(w,v,I)}))},w.prototype._extensionsLoadMaterialPropertiesAsync=function(w,v,I){return this._applyExtensions(v,"loadMaterialProperties",(function(P){return P.loadMaterialPropertiesAsync&&P.loadMaterialPropertiesAsync(w,v,I)}))},w.prototype._extensionsLoadTextureInfoAsync=function(w,v,I){return this._applyExtensions(v,"loadTextureInfo",(function(P){return P.loadTextureInfoAsync&&P.loadTextureInfoAsync(w,v,I)}))},w.prototype._extensionsLoadTextureAsync=function(w,v,I){return this._applyExtensions(v,"loadTexture",(function(P){return P._loadTextureAsync&&P._loadTextureAsync(w,v,I)}))},w.prototype._extensionsLoadAnimationAsync=function(w,v){return this._applyExtensions(v,"loadAnimation",(function(I){return I.loadAnimationAsync&&I.loadAnimationAsync(w,v)}))},w.prototype._extensionsLoadSkinAsync=function(w,v,I){return this._applyExtensions(I,"loadSkin",(function(P){return P._loadSkinAsync&&P._loadSkinAsync(w,v,I)}))},w.prototype._extensionsLoadUriAsync=function(w,v,I){return this._applyExtensions(v,"loadUri",(function(P){return P._loadUriAsync&&P._loadUriAsync(w,v,I)}))},w.prototype._extensionsLoadBufferViewAsync=function(w,v){return this._applyExtensions(v,"loadBufferView",(function(I){return I.loadBufferViewAsync&&I.loadBufferViewAsync(w,v)}))},w.prototype._extensionsLoadBufferAsync=function(w,v,I,P){return this._applyExtensions(v,"loadBuffer",(function(u){return u.loadBufferAsync&&u.loadBufferAsync(w,v,I,P)}))},w.LoadExtensionAsync=function(w,v,I,P){if(!v.extensions)return null;var u=v.extensions[I];return u?P("".concat(w,"/extensions/").concat(I),u):null},w.LoadExtraAsync=function(w,v,I,P){if(!v.extras)return null;var u=v.extras[I];return u?P("".concat(w,"/extras/").concat(I),u):null},w.prototype.isExtensionUsed=function(w){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(w)},w.prototype.logOpen=function(w){this._parent._logOpen(w)},w.prototype.logClose=function(){this._parent._logClose()},w.prototype.log=function(w){this._parent._log(w)},w.prototype.startPerformanceCounter=function(w){this._parent._startPerformanceCounter(w)},w.prototype.endPerformanceCounter=function(w){this._parent._endPerformanceCounter(w)},w._RegisteredExtensions={},w.DefaultSampler={index:-1},w}();H.c._CreateGLTF2Loader=function(w){return new b(w)};var k=I(96658),C=I(37094),y=I(60766),T=I(76384),Z=(I(37105),I(56965)),A=(I(81965),I(42373),I(91156),I(28689),I(16179)),X=(I(83874),"varying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}");A.c.ShadersStore.rgbdEncodePixelShader=X;I(69233);var ww="image/png";function vw(w,v,I,P,u,Q,K,a,U,p,r){return new Promise((function(Y,g){if(I){var J=v.createTexture(null,!0,!0,null,1,null,(function(w){g(w)}),w);P.getEffect().executeWhenCompiled((function(){P.externalTextureSamplerBinding=!0,P.onApply=function(I){I._bindTexture("textureSampler",J),I.setFloat2("scale",1,v._features.needsInvertingBitmap&&w instanceof ImageBitmap?-1:1)},v.scenes.length&&(v.scenes[0].postProcessManager.directRender([P],p,!0,Q,K),v.restoreDefaultFramebuffer(),J.dispose(),URL.revokeObjectURL(u),Y())}))}else{if(v._uploadImageToTexture(r,w,Q,K),a){var l=U[K];l&&v._uploadImageToTexture(l._texture,w,Q,0)}Y()}}))}function Iw(w,v,I){if(void 0===I&&(I=ww),!K.i.IsExponentOfTwo(w.width))throw new Error("Texture size must be a power of two");var P=k.b.ILog2(w.width)+1,u=w.getEngine(),Q=!1,a=!1,U=null,p=null,r=null,Y=u.getCaps();if(w.format=5,w.type=0,w.generateMipMaps=!0,w._cachedAnisotropicFilteringLevel=null,u.updateTextureSamplingMode(3,w),Y.textureLOD?u._features.supportRenderAndCopyToLodForFloatTextures?Y.textureHalfFloatRender&&Y.textureHalfFloatLinearFiltering?(Q=!0,w.type=2):Y.textureFloatRender&&Y.textureFloatLinearFiltering&&(Q=!0,w.type=1):Q=!1:(Q=!1,a=!0,r={}),Q)U=new Z.b("rgbdDecode","rgbdDecode",null,null,1,null,3,u,!1,void 0,w.type,void 0,null,!1),w._isRGBD=!1,w.invertY=!1,p=u.createRenderTargetCubeTexture(w.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:w.type,format:5});else if(w._isRGBD=!0,w.invertY=!0,a)for(var g=w._lodGenerationScale,J=w._lodGenerationOffset,l=0;l<3;l++){var R=(P-1)*g+J,x=J+(R-J)*(1-l/2),j=Math.round(Math.min(Math.max(x,0),R)),s=new y.h(u,y.e.Temp);s.isCube=!0,s.invertY=!0,s.generateMipMaps=!1,u.updateTextureSamplingMode(2,s);var B=new T.c(null);switch(B.isCube=!0,B._texture=s,r[j]=B,l){case 0:w._lodTextureLow=B;break;case 1:w._lodTextureMid=B;break;case 2:w._lodTextureHigh=B}}var t=[],i=function(P){for(var K=function(K){var Y=v[P][K],g=new Blob([Y],{type:I}),J=URL.createObjectURL(g),l=void 0;if("undefined"===typeof Image||u._features.forceBitmapOverHTMLImageElement)l=u.createImageBitmap(g,{premultiplyAlpha:"none"}).then((function(v){return vw(v,u,Q,U,J,K,P,a,r,p,w)}));else{var R=new Image;R.src=J,l=new Promise((function(v,I){R.onload=function(){vw(R,u,Q,U,J,K,P,a,r,p,w).then((function(){return v()})).catch((function(w){I(w)}))},R.onerror=function(w){I(w)}}))}t.push(l)},Y=0;Y<6;Y++)K(Y)};for(l=0;l<v.length;l++)i(l);if(v.length<P){var z=void 0,E=Math.pow(2,P-1-v.length),o=E*E*4;switch(w.type){case 0:z=new Uint8Array(o);break;case 2:z=new Uint16Array(o);break;case 1:z=new Float32Array(o)}for(l=v.length;l<P;l++)for(var h=0;h<6;h++)u._uploadArrayBufferViewToTexture(w,z,h,l)}return Promise.all(t).then((function(){p&&(u._releaseTexture(w),p._swapAndDie(w)),U&&U.dispose(),a&&(w._lodTextureHigh&&w._lodTextureHigh._texture&&(w._lodTextureHigh._texture.isReady=!0),w._lodTextureMid&&w._lodTextureMid._texture&&(w._lodTextureMid._texture.isReady=!0),w._lodTextureLow&&w._lodTextureLow._texture&&(w._lodTextureLow._texture.isReady=!0))}))}var Pw=I(16708),uw=(I(36125),function(w){function v(v,I,P,u,Q,K,a,U,p){void 0===u&&(u=5),void 0===Q&&(Q=0),void 0===K&&(K=!1),void 0===a&&(a=!1),void 0===U&&(U=3),void 0===p&&(p=null);var r=w.call(this,"",v)||this;return r._texture=v.getEngine().createRawCubeTexture(I,P,u,Q,K,a,U,p),r}return(0,R.m)(v,w),v.prototype.update=function(w,v,I,P,u){void 0===u&&(u=null),this._texture.getEngine().updateRawCubeTexture(this._texture,w,v,I,P,u)},v.prototype.updateRGBDAsync=function(w,v,I,P){return void 0===v&&(v=null),void 0===I&&(I=.8),void 0===P&&(P=0),function(w,v,I,P,u){var Q=Iw(w.getEngine().createRawCubeTexture(null,w.width,w.format,w.type,w.generateMipMaps,w.invertY,w.samplingMode,w._compression),v).then((function(){return w}));return w.onRebuildCallback=function(w){return{proxy:Q,isReady:!0,isAsync:!0}},w._source=y.e.CubeRawRGBD,w._bufferViewArrayArray=v,w._lodGenerationScale=P,w._lodGenerationOffset=u,w._sphericalPolynomial=I,Iw(w,v).then((function(){return w.isReady=!0,w}))}(this._texture,w,v,I,P).then((function(){}))},v.prototype.clone=function(){var w=this;return q.e.Clone((function(){var I=w.getScene(),P=w._texture,u=new v(I,P._bufferViewArray,P.width,P.format,P.type,P.generateMipMaps,P.invertY,P.samplingMode,P._compression);return P.source===y.e.CubeRawRGBD&&u.updateRGBDAsync(P._bufferViewArrayArray,P._sphericalPolynomial,P._lodGenerationScale,P._lodGenerationOffset),u}),this)},v}(Pw.c)),Qw="EXT_lights_image_based",Kw=function(){function w(w){this.name=Qw,this._loader=w,this.enabled=this._loader.isExtensionUsed(Qw)}return w.prototype.dispose=function(){this._loader=null,delete this._lights},w.prototype.onLoading=function(){var w=this._loader.gltf.extensions;if(w&&w[this.name]){var v=w[this.name];this._lights=v.lights}},w.prototype.loadSceneAsync=function(w,v){var I=this;return b.LoadExtensionAsync(w,v,this.name,(function(P,u){var Q=new Array;Q.push(I._loader.loadSceneAsync(w,v)),I._loader.logOpen("".concat(P));var K=D.Get("".concat(P,"/light"),I._lights,u.light);return Q.push(I._loadLightAsync("/extensions/".concat(I.name,"/lights/").concat(u.light),K).then((function(w){I._loader.babylonScene.environmentTexture=w}))),I._loader.logClose(),Promise.all(Q).then((function(){}))}))},w.prototype._loadLightAsync=function(w,v){var I=this;if(!v._loaded){var P=new Array;this._loader.logOpen("".concat(w));for(var Q=new Array(v.specularImages.length),K=function(I){var u=v.specularImages[I];Q[I]=new Array(u.length);for(var K=function(v){var K="".concat(w,"/specularImages/").concat(I,"/").concat(v);a._loader.logOpen("".concat(K));var U=u[v],p=D.Get(K,a._loader.gltf.images,U);P.push(a._loader.loadImageAsync("/images/".concat(U),p).then((function(w){Q[I][v]=w}))),a._loader.logClose()},U=0;U<u.length;U++)K(U)},a=this,U=0;U<v.specularImages.length;U++)K(U);this._loader.logClose(),v._loaded=Promise.all(P).then((function(){var P=new uw(I._loader.babylonScene,null,v.specularImageSize);if(P.name=v.name||"environment",v._babylonTexture=P,void 0!=v.intensity&&(P.level=v.intensity),v.rotation){var K=u.f.FromArray(v.rotation);I._loader.babylonScene.useRightHandedSystem||(K=u.f.Inverse(K)),u.e.FromQuaternionToRef(K,P.getReflectionTextureMatrix())}if(!v.irradianceCoefficients)throw new Error("".concat(w,": Irradiance coefficients are missing"));var a=C.e.FromArray(v.irradianceCoefficients);a.scaleInPlace(v.intensity),a.convertIrradianceToLambertianRadiance();var U=C.i.FromHarmonics(a),p=(Q.length-1)/k.b.Log2(v.specularImageSize);return P.updateRGBDAsync(Q,U,p)}))}return v._loaded.then((function(){return v._babylonTexture}))},w}();b.RegisterExtension(Qw,(function(w){return new Kw(w)}));I(14313);var aw="EXT_mesh_gpu_instancing",Uw=function(){function w(w){this.name=aw,this._loader=w,this.enabled=this._loader.isExtensionUsed(aw)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadNodeAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(w,Q){P._loader._disableInstancedMesh++;var K=P._loader.loadNodeAsync("/nodes/".concat(v.index),v,I);if(P._loader._disableInstancedMesh--,!v._primitiveBabylonMeshes)return K;var a=new Array,U=0,p=function(v){if(void 0!=Q.attributes[v]){var I=D.Get("".concat(w,"/attributes/").concat(v),P._loader.gltf.accessors,Q.attributes[v]);if(a.push(P._loader._loadFloatAccessorAsync("/accessors/".concat(I.bufferView),I)),0===U)U=I.count;else if(U!==I.count)throw new Error("".concat(w,"/attributes: Instance buffer accessors do not have the same count."))}else a.push(Promise.resolve(null))};return p("TRANSLATION"),p("ROTATION"),p("SCALE"),K.then((function(w){return Promise.all(a).then((function(I){var P=I[0],Q=I[1],K=I[2],a=new Float32Array(16*U);u.i.Vector3[0].copyFromFloats(0,0,0),u.i.Quaternion[0].copyFromFloats(0,0,0,1),u.i.Vector3[1].copyFromFloats(1,1,1);for(var p=0;p<U;++p)P&&u.l.FromArrayToRef(P,3*p,u.i.Vector3[0]),Q&&u.f.FromArrayToRef(Q,4*p,u.i.Quaternion[0]),K&&u.l.FromArrayToRef(K,3*p,u.i.Vector3[1]),u.e.ComposeToRef(u.i.Vector3[1],u.i.Quaternion[0],u.i.Vector3[0],u.i.Matrix[0]),u.i.Matrix[0].copyToArray(a,16*p);for(var r=0,Y=v._primitiveBabylonMeshes;r<Y.length;r++){Y[r].thinInstanceSetBuffer("matrix",a,16,!0)}return w}))}))}))},w}();b.RegisterExtension(aw,(function(w){return new Uw(w)}));var pw=function(){function w(){var v=w.Configuration.decoder;this._decoderModulePromise=K.i.LoadScriptAsync(K.i.GetAbsoluteUrl(v.url)).then((function(){return MeshoptDecoder.ready}))}return Object.defineProperty(w,"Default",{get:function(){return w._Default||(w._Default=new w),w._Default},enumerable:!1,configurable:!0}),w.prototype.dispose=function(){delete this._decoderModulePromise},w.prototype.decodeGltfBufferAsync=function(w,v,I,P,u){return this._decoderModulePromise.then((function(){var Q=new Uint8Array(v*I);return MeshoptDecoder.decodeGltfBuffer(Q,v,I,w,P,u),Q}))},w.Configuration={decoder:{url:"https://preview.babylonjs.com/meshopt_decoder.js"}},w._Default=null,w}(),rw="EXT_meshopt_compression",Yw=function(){function w(w){this.name=rw,this.enabled=w.isExtensionUsed(rw),this._loader=w}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadBufferViewAsync=function(w,v){var I=this;return b.LoadExtensionAsync(w,v,this.name,(function(P,u){var Q=v;if(Q._meshOptData)return Q._meshOptData;var K=D.Get("".concat(w,"/buffer"),I._loader.gltf.buffers,u.buffer);return Q._meshOptData=I._loader.loadBufferAsync("/buffers/".concat(K.index),K,u.byteOffset||0,u.byteLength).then((function(w){return pw.Default.decodeGltfBufferAsync(w,u.count,u.byteStride,u.mode,u.filter)})),Q._meshOptData}))},w}();b.RegisterExtension(rw,(function(w){return new Yw(w)}));var gw="EXT_texture_webp",Jw=function(){function w(w){this.name=gw,this._loader=w,this.enabled=w.isExtensionUsed(gw)}return w.prototype.dispose=function(){this._loader=null},w.prototype._loadTextureAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=void 0==v.sampler?b.DefaultSampler:D.Get("".concat(w,"/sampler"),P._loader.gltf.samplers,v.sampler),a=D.Get("".concat(u,"/source"),P._loader.gltf.images,Q.source);return P._loader._createTextureAsync(w,K,a,(function(w){I(w)}),void 0,!v._textureInfo.nonColorData)}))},w}();b.RegisterExtension(gw,(function(w){return new Jw(w)}));var lw=I(40689),Rw="KHR_draco_mesh_compression",xw=function(){function w(w){this.name=Rw,this._loader=w,this.enabled=lw.e.DecoderAvailable&&this._loader.isExtensionUsed(Rw)}return w.prototype.dispose=function(){delete this.dracoCompression,this._loader=null},w.prototype._loadVertexDataAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){if(void 0!=v.mode){if(5!==v.mode&&4!==v.mode)throw new Error("".concat(w,": Unsupported mode ").concat(v.mode));if(5===v.mode)throw new Error("".concat(w,": Mode ").concat(v.mode," is not currently supported"))}var K={},a={},U=function(u,U){var p=Q.attributes[u];if(void 0!==p&&void 0!==v.attributes[u]){K[U]=p;var r=D.Get("".concat(w,"/attributes/").concat(u),P._loader.gltf.accessors,v.attributes[u]);if(r.normalized&&5126!==r.componentType){var Y=1;switch(r.componentType){case 5120:Y=127;break;case 5121:Y=255;break;case 5122:Y=32767;break;case 5123:Y=65535}a[U]=Y}I._delayInfo=I._delayInfo||[],-1===I._delayInfo.indexOf(U)&&I._delayInfo.push(U)}};U("POSITION",F.f.PositionKind),U("NORMAL",F.f.NormalKind),U("TANGENT",F.f.TangentKind),U("TEXCOORD_0",F.f.UVKind),U("TEXCOORD_1",F.f.UV2Kind),U("TEXCOORD_2",F.f.UV3Kind),U("TEXCOORD_3",F.f.UV4Kind),U("TEXCOORD_4",F.f.UV5Kind),U("TEXCOORD_5",F.f.UV6Kind),U("JOINTS_0",F.f.MatricesIndicesKind),U("WEIGHTS_0",F.f.MatricesWeightsKind),U("COLOR_0",F.f.ColorKind);var p=D.Get(u,P._loader.gltf.bufferViews,Q.bufferView);return p._dracoBabylonGeometry||(p._dracoBabylonGeometry=P._loader.loadBufferViewAsync("/bufferViews/".concat(p.index),p).then((function(v){return(P.dracoCompression||lw.e.Default).decodeMeshAsync(v,K,a).then((function(w){var v=new O.b(I.name,P._loader.babylonScene);return w.applyToGeometry(v),v})).catch((function(v){throw new Error("".concat(w,": ").concat(v.message))}))}))),p._dracoBabylonGeometry}))},w}();b.RegisterExtension(Rw,(function(w){return new xw(w)}));var jw=I(315),sw=function(w){function v(){var v=null!==w&&w.apply(this,arguments)||this;return v._needProjectionMatrixCompute=!0,v}return(0,R.m)(v,w),v.prototype._setPosition=function(w){this._position=w},Object.defineProperty(v.prototype,"position",{get:function(){return this._position},set:function(w){this._setPosition(w)},enumerable:!1,configurable:!0}),v.prototype._setDirection=function(w){this._direction=w},Object.defineProperty(v.prototype,"direction",{get:function(){return this._direction},set:function(w){this._setDirection(w)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(w){this._shadowMinZ=w,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(w){this._shadowMaxZ=w,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),v.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=u.l.Zero()),u.l.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=u.l.Zero()),u.l.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},v.prototype.getDepthScale=function(){return 50},v.prototype.getShadowDirection=function(w){return this.transformedDirection?this.transformedDirection:this.direction},v.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},v.prototype.setDirectionToTarget=function(w){return this.direction=u.l.Normalize(w.subtract(this.position)),this.direction},v.prototype.getRotation=function(){this.direction.normalize();var w=u.l.Cross(this.direction,s.c.Y),v=u.l.Cross(w,this.direction);return u.l.RotationFromAxis(w,v,this.direction)},v.prototype.needCube=function(){return!1},v.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},v.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},v.prototype._initCache=function(){w.prototype._initCache.call(this),this._cache.position=u.l.Zero()},v.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},v.prototype.computeWorldMatrix=function(w){return!w&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=u.e.Identity()),u.e.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},v.prototype.getDepthMinZ=function(w){return void 0!==this.shadowMinZ?this.shadowMinZ:w.minZ},v.prototype.getDepthMaxZ=function(w){return void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ},v.prototype.setShadowProjectionMatrix=function(w,v,I){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(v,I,w):this._setDefaultShadowProjectionMatrix(w,v,I),this},v.prototype._syncParentEnabledState=function(){w.prototype._syncParentEnabledState.call(this),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)},(0,R.i)([(0,q.G)()],v.prototype,"position",null),(0,R.i)([(0,q.G)()],v.prototype,"direction",null),(0,R.i)([(0,q.J)()],v.prototype,"shadowMinZ",null),(0,R.i)([(0,q.J)()],v.prototype,"shadowMaxZ",null),v}(jw.d);j.b.AddNodeConstructor("Light_Type_1",(function(w,v){return function(){return new Bw(w,u.l.Zero(),v)}}));var Bw=function(w){function v(v,I,P){var u=w.call(this,v,P)||this;return u._shadowFrustumSize=0,u._shadowOrthoScale=.1,u.autoUpdateExtends=!0,u.autoCalcShadowZBounds=!1,u._orthoLeft=Number.MAX_VALUE,u._orthoRight=Number.MIN_VALUE,u._orthoTop=Number.MIN_VALUE,u._orthoBottom=Number.MAX_VALUE,u.position=I.scale(-1),u.direction=I,u}return(0,R.m)(v,w),Object.defineProperty(v.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(w){this._shadowFrustumSize=w,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(w){this._shadowOrthoScale=w,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"orthoLeft",{get:function(){return this._orthoLeft},set:function(w){this._orthoLeft=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"orthoRight",{get:function(){return this._orthoRight},set:function(w){this._orthoRight=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"orthoTop",{get:function(){return this._orthoTop},set:function(w){this._orthoTop=w},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"orthoBottom",{get:function(){return this._orthoBottom},set:function(w){this._orthoBottom=w},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"DirectionalLight"},v.prototype.getTypeID=function(){return jw.d.LIGHTTYPEID_DIRECTIONALLIGHT},v.prototype._setDefaultShadowProjectionMatrix=function(w,v,I){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(w):this._setDefaultAutoExtendShadowProjectionMatrix(w,v,I)},v.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(w){var v=this.getScene().activeCamera;v&&u.e.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:v.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,w,this.getScene().getEngine().isNDCHalfZRange)},v.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(w,v,I){var P=this.getScene().activeCamera;if(P){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var Q=u.l.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var K=Number.MAX_VALUE,a=Number.MIN_VALUE,U=0;U<I.length;U++){var p=I[U];if(p)for(var r=p.getBoundingInfo().boundingBox,Y=0;Y<r.vectorsWorld.length;Y++)u.l.TransformCoordinatesToRef(r.vectorsWorld[Y],v,Q),Q.x<this._orthoLeft&&(this._orthoLeft=Q.x),Q.y<this._orthoBottom&&(this._orthoBottom=Q.y),Q.x>this._orthoRight&&(this._orthoRight=Q.x),Q.y>this._orthoTop&&(this._orthoTop=Q.y),this.autoCalcShadowZBounds&&(Q.z<K&&(K=Q.z),Q.z>a&&(a=Q.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=K,this._shadowMaxZ=a)}var g=this._orthoRight-this._orthoLeft,J=this._orthoTop-this._orthoBottom,l=void 0!==this.shadowMinZ?this.shadowMinZ:P.minZ,R=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,x=this.getScene().getEngine().useReverseDepthBuffer;u.e.OrthoOffCenterLHToRef(this._orthoLeft-g*this.shadowOrthoScale,this._orthoRight+g*this.shadowOrthoScale,this._orthoBottom-J*this.shadowOrthoScale,this._orthoTop+J*this.shadowOrthoScale,x?R:l,x?l:R,w,this.getScene().getEngine().isNDCHalfZRange)}},v.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},v.prototype.transferToEffect=function(w,v){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,v),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,v),this)},v.prototype.transferToNodeMaterialEffect=function(w,v){return this.computeTransformedInformation()?(w.setFloat3(v,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(w.setFloat3(v,this.direction.x,this.direction.y,this.direction.z),this)},v.prototype.getDepthMinZ=function(w){var v=this._scene.getEngine();return!v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:1},v.prototype.getDepthMaxZ=function(w){var v=this._scene.getEngine();return v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:1},v.prototype.prepareLightSpecificDefines=function(w,v){w["DIRLIGHT"+v]=!0},(0,R.i)([(0,q.J)()],v.prototype,"shadowFrustumSize",null),(0,R.i)([(0,q.J)()],v.prototype,"shadowOrthoScale",null),(0,R.i)([(0,q.J)()],v.prototype,"autoUpdateExtends",void 0),(0,R.i)([(0,q.J)()],v.prototype,"autoCalcShadowZBounds",void 0),(0,R.i)([(0,q.J)("orthoLeft")],v.prototype,"_orthoLeft",void 0),(0,R.i)([(0,q.J)("orthoRight")],v.prototype,"_orthoRight",void 0),(0,R.i)([(0,q.J)("orthoTop")],v.prototype,"_orthoTop",void 0),(0,R.i)([(0,q.J)("orthoBottom")],v.prototype,"_orthoBottom",void 0),v}(sw);j.b.AddNodeConstructor("Light_Type_0",(function(w,v){return function(){return new tw(w,u.l.Zero(),v)}}));var tw=function(w){function v(v,I,P){var u=w.call(this,v,P)||this;return u._shadowAngle=Math.PI/2,u.position=I,u}return(0,R.m)(v,w),Object.defineProperty(v.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(w){this._shadowAngle=w,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"direction",{get:function(){return this._direction},set:function(w){var v=this.needCube();this._direction=w,this.needCube()!==v&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"PointLight"},v.prototype.getTypeID=function(){return jw.d.LIGHTTYPEID_POINTLIGHT},v.prototype.needCube=function(){return!this.direction},v.prototype.getShadowDirection=function(v){if(this.direction)return w.prototype.getShadowDirection.call(this,v);switch(v){case 0:return new u.l(1,0,0);case 1:return new u.l(-1,0,0);case 2:return new u.l(0,-1,0);case 3:return new u.l(0,1,0);case 4:return new u.l(0,0,1);case 5:return new u.l(0,0,-1)}return u.l.Zero()},v.prototype._setDefaultShadowProjectionMatrix=function(w,v,I){var P=this.getScene().activeCamera;if(P){var Q=void 0!==this.shadowMinZ?this.shadowMinZ:P.minZ,K=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,a=this.getScene().getEngine().useReverseDepthBuffer;u.e.PerspectiveFovLHToRef(this.shadowAngle,1,a?K:Q,a?Q:K,w,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}},v.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},v.prototype.transferToEffect=function(w,v){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,v):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,v),this},v.prototype.transferToNodeMaterialEffect=function(w,v){return this.computeTransformedInformation()?w.setFloat3(v,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):w.setFloat3(v,this.position.x,this.position.y,this.position.z),this},v.prototype.prepareLightSpecificDefines=function(w,v){w["POINTLIGHT"+v]=!0},(0,R.i)([(0,q.J)()],v.prototype,"shadowAngle",null),v}(sw);j.b.AddNodeConstructor("Light_Type_2",(function(w,v){return function(){return new iw(w,u.l.Zero(),u.l.Zero(),0,0,v)}}));var iw=function(w){function v(v,I,P,Q,K,a){var U=w.call(this,v,a)||this;return U._innerAngle=0,U._projectionTextureMatrix=u.e.Zero(),U._projectionTextureLightNear=1e-6,U._projectionTextureLightFar=1e3,U._projectionTextureUpDirection=u.l.Up(),U._projectionTextureViewLightDirty=!0,U._projectionTextureProjectionLightDirty=!0,U._projectionTextureDirty=!0,U._projectionTextureViewTargetVector=u.l.Zero(),U._projectionTextureViewLightMatrix=u.e.Zero(),U._projectionTextureProjectionLightMatrix=u.e.Zero(),U._projectionTextureScalingMatrix=u.e.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),U.position=I,U.direction=P,U.angle=Q,U.exponent=K,U}return(0,R.m)(v,w),Object.defineProperty(v.prototype,"angle",{get:function(){return this._angle},set:function(w){this._angle=w,this._cosHalfAngle=Math.cos(.5*w),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(w){this._innerAngle=w,this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(w){this._shadowAngleScale=w,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(w){this._projectionTextureLightNear=w,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(w){this._projectionTextureLightFar=w,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(w){this._projectionTextureUpDirection=w,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(w){var I=this;this._projectionTexture!==w&&(this._projectionTexture=w,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(v._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((function(){I._markMeshesAsLightDirty()})):v._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((function(){I._markMeshesAsLightDirty()}))))},enumerable:!1,configurable:!0}),v._IsProceduralTexture=function(w){return void 0!==w.onGeneratedObservable},v._IsTexture=function(w){return void 0!==w.onLoadObservable},Object.defineProperty(v.prototype,"projectionTextureProjectionLightMatrix",{get:function(){return this._projectionTextureProjectionLightMatrix},set:function(w){this._projectionTextureProjectionLightMatrix=w,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"SpotLight"},v.prototype.getTypeID=function(){return jw.d.LIGHTTYPEID_SPOTLIGHT},v.prototype._setDirection=function(v){w.prototype._setDirection.call(this,v),this._projectionTextureViewLightDirty=!0},v.prototype._setPosition=function(v){w.prototype._setPosition.call(this,v),this._projectionTextureViewLightDirty=!0},v.prototype._setDefaultShadowProjectionMatrix=function(w,v,I){var P=this.getScene().activeCamera;if(P){this._shadowAngleScale=this._shadowAngleScale||1;var Q=this._shadowAngleScale*this._angle,K=void 0!==this.shadowMinZ?this.shadowMinZ:P.minZ,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,U=this.getScene().getEngine().useReverseDepthBuffer;u.e.PerspectiveFovLHToRef(Q,1,U?a:K,U?K:a,w,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}},v.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),u.e.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},v.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var w=this.projectionTextureLightFar,v=this.projectionTextureLightNear,I=w/(w-v),P=-I*v,Q=1/Math.tan(this._angle/2);u.e.FromValuesToRef(Q/1,0,0,0,0,Q,0,0,0,0,I,1,0,0,P,0,this._projectionTextureProjectionLightMatrix)},v.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof W.e){var w=this._projectionTexture.uScale/2,v=this._projectionTexture.vScale/2;u.e.FromValuesToRef(w,0,0,0,0,v,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},v.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},v.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},v.prototype.transferTexturesToEffect=function(w,v){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),w.setMatrix("textureProjectionMatrix"+v,this._projectionTextureMatrix),w.setTexture("projectionLightSampler"+v,this.projectionTexture)),this},v.prototype.transferToEffect=function(w,v){var I;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,v),I=u.l.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,v),I=u.l.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",I.x,I.y,I.z,this._cosHalfAngle,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,v),this},v.prototype.transferToNodeMaterialEffect=function(w,v){var I;return I=this.computeTransformedInformation()?u.l.Normalize(this.transformedDirection):u.l.Normalize(this.direction),this.getScene().useRightHandedSystem?w.setFloat3(v,-I.x,-I.y,-I.z):w.setFloat3(v,I.x,I.y,I.z),this},v.prototype.dispose=function(){w.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},v.prototype.getDepthMinZ=function(w){var v=this._scene.getEngine(),I=void 0!==this.shadowMinZ?this.shadowMinZ:w.minZ;return v.useReverseDepthBuffer&&v.isNDCHalfZRange?I:this._scene.getEngine().isNDCHalfZRange?0:I},v.prototype.getDepthMaxZ=function(w){var v=this._scene.getEngine(),I=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ;return v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:I},v.prototype.prepareLightSpecificDefines=function(w,v){w["SPOTLIGHT"+v]=!0,w["PROJECTEDLIGHTTEXTURE"+v]=!(!this.projectionTexture||!this.projectionTexture.isReady())},(0,R.i)([(0,q.J)()],v.prototype,"angle",null),(0,R.i)([(0,q.J)()],v.prototype,"innerAngle",null),(0,R.i)([(0,q.J)()],v.prototype,"shadowAngleScale",null),(0,R.i)([(0,q.J)()],v.prototype,"exponent",void 0),(0,R.i)([(0,q.J)()],v.prototype,"projectionTextureLightNear",null),(0,R.i)([(0,q.J)()],v.prototype,"projectionTextureLightFar",null),(0,R.i)([(0,q.J)()],v.prototype,"projectionTextureUpDirection",null),(0,R.i)([(0,q.B)("projectedLightTexture")],v.prototype,"_projectionTexture",void 0),v}(sw),zw="KHR_lights_punctual",Ew=function(){function w(w){this.name=zw,this._loader=w,this.enabled=this._loader.isExtensionUsed(zw)}return w.prototype.dispose=function(){this._loader=null,delete this._lights},w.prototype.onLoading=function(){var w=this._loader.gltf.extensions;if(w&&w[this.name]){var v=w[this.name];this._lights=v.lights}},w.prototype.loadNodeAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(K,a){return P._loader.loadNodeAsync(w,v,(function(w){var v,U=D.Get(K,P._lights,a.light),p=U.name||w.name;switch(P._loader.babylonScene._blockEntityCollection=!!P._loader._assetContainer,U.type){case"directional":v=new Bw(p,u.l.Backward(),P._loader.babylonScene);break;case"point":v=new tw(p,u.l.Zero(),P._loader.babylonScene);break;case"spot":var r=new iw(p,u.l.Zero(),u.l.Backward(),0,1,P._loader.babylonScene);r.angle=2*(U.spot&&U.spot.outerConeAngle||Math.PI/4),r.innerAngle=2*(U.spot&&U.spot.innerConeAngle||0),v=r;break;default:throw P._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(K,": Invalid light type (").concat(U.type,")"))}v._parentContainer=P._loader._assetContainer,P._loader.babylonScene._blockEntityCollection=!1,v.falloffType=jw.d.FALLOFF_GLTF,v.diffuse=U.color?Q.b.FromArray(U.color):Q.b.White(),v.intensity=void 0==U.intensity?1:U.intensity,v.range=void 0==U.range?Number.MAX_VALUE:U.range,v.parent=w,P._loader._babylonLights.push(v),b.AddPointerMetadata(v,K),I(w)}))}))},w}();b.RegisterExtension(zw,(function(w){return new Ew(w)}));var ow="KHR_materials_pbrSpecularGlossiness",hw=function(){function w(w){this.name=ow,this.order=200,this._loader=w,this.enabled=this._loader.isExtensionUsed(ow)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialBasePropertiesAsync(w,v,I)),K.push(P._loadSpecularGlossinessPropertiesAsync(u,v,Q,I)),P._loader.loadMaterialAlphaProperties(w,v,I),Promise.all(K).then((function(){}))}))},w.prototype._loadSpecularGlossinessPropertiesAsync=function(w,v,I,P){if(!(P instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var u=new Array;return P.metallic=null,P.roughness=null,I.diffuseFactor?(P.albedoColor=Q.b.FromArray(I.diffuseFactor),P.alpha=I.diffuseFactor[3]):P.albedoColor=Q.b.White(),P.reflectivityColor=I.specularFactor?Q.b.FromArray(I.specularFactor):Q.b.White(),P.microSurface=void 0==I.glossinessFactor?1:I.glossinessFactor,I.diffuseTexture&&u.push(this._loader.loadTextureInfoAsync("".concat(w,"/diffuseTexture"),I.diffuseTexture,(function(w){w.name="".concat(P.name," (Diffuse)"),P.albedoTexture=w}))),I.specularGlossinessTexture&&(u.push(this._loader.loadTextureInfoAsync("".concat(w,"/specularGlossinessTexture"),I.specularGlossinessTexture,(function(w){w.name="".concat(P.name," (Specular Glossiness)"),P.reflectivityTexture=w,P.reflectivityTexture.hasAlpha=!0}))),P.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(u).then((function(){}))},w}();b.RegisterExtension(ow,(function(w){return new hw(w)}));var nw="KHR_materials_unlit",Ww=function(){function w(w){this.name=nw,this.order=210,this._loader=w,this.enabled=this._loader.isExtensionUsed(nw)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(){return P._loadUnlitPropertiesAsync(w,v,I)}))},w.prototype._loadUnlitPropertiesAsync=function(w,v,I){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var P=new Array;I.unlit=!0;var u=v.pbrMetallicRoughness;return u&&(u.baseColorFactor?(I.albedoColor=Q.b.FromArray(u.baseColorFactor),I.alpha=u.baseColorFactor[3]):I.albedoColor=Q.b.White(),u.baseColorTexture&&P.push(this._loader.loadTextureInfoAsync("".concat(w,"/baseColorTexture"),u.baseColorTexture,(function(w){w.name="".concat(I.name," (Base Color)"),I.albedoTexture=w})))),v.doubleSided&&(I.backFaceCulling=!1,I.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(w,v,I),Promise.all(P).then((function(){}))},w}();b.RegisterExtension(nw,(function(w){return new Ww(w)}));var Vw="KHR_materials_clearcoat",Fw=function(){function w(w){this.name=Vw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(Vw)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialPropertiesAsync(w,v,I)),K.push(P._loadClearCoatPropertiesAsync(u,Q,I)),Promise.all(K).then((function(){}))}))},w.prototype._loadClearCoatPropertiesAsync=function(w,v,I){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var P=new Array;return I.clearCoat.isEnabled=!0,I.clearCoat.useRoughnessFromMainTexture=!1,I.clearCoat.remapF0OnInterfaceChange=!1,void 0!=v.clearcoatFactor?I.clearCoat.intensity=v.clearcoatFactor:I.clearCoat.intensity=0,v.clearcoatTexture&&P.push(this._loader.loadTextureInfoAsync("".concat(w,"/clearcoatTexture"),v.clearcoatTexture,(function(w){w.name="".concat(I.name," (ClearCoat Intensity)"),I.clearCoat.texture=w}))),void 0!=v.clearcoatRoughnessFactor?I.clearCoat.roughness=v.clearcoatRoughnessFactor:I.clearCoat.roughness=0,v.clearcoatRoughnessTexture&&(v.clearcoatRoughnessTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync("".concat(w,"/clearcoatRoughnessTexture"),v.clearcoatRoughnessTexture,(function(w){w.name="".concat(I.name," (ClearCoat Roughness)"),I.clearCoat.textureRoughness=w})))),v.clearcoatNormalTexture&&(v.clearcoatNormalTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync("".concat(w,"/clearcoatNormalTexture"),v.clearcoatNormalTexture,(function(w){w.name="".concat(I.name," (ClearCoat Normal)"),I.clearCoat.bumpTexture=w}))),I.invertNormalMapX=!I.getScene().useRightHandedSystem,I.invertNormalMapY=I.getScene().useRightHandedSystem,void 0!=v.clearcoatNormalTexture.scale&&(I.clearCoat.bumpTexture.level=v.clearcoatNormalTexture.scale)),Promise.all(P).then((function(){}))},w}();b.RegisterExtension(Vw,(function(w){return new Fw(w)}));var Ow="KHR_materials_iridescence",Nw=function(){function w(w){this.name=Ow,this.order=195,this._loader=w,this.enabled=this._loader.isExtensionUsed(Ow)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialPropertiesAsync(w,v,I)),K.push(P._loadIridescencePropertiesAsync(u,Q,I)),Promise.all(K).then((function(){}))}))},w.prototype._loadIridescencePropertiesAsync=function(w,v,I){var P,u,Q,K,a;if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var U=new Array;return I.iridescence.isEnabled=!0,I.iridescence.intensity=null!==(P=v.iridescenceFactor)&&void 0!==P?P:0,I.iridescence.indexOfRefraction=null!==(Q=null!==(u=v.iridescenceIor)&&void 0!==u?u:v.iridescenceIOR)&&void 0!==Q?Q:1.3,I.iridescence.minimumThickness=null!==(K=v.iridescenceThicknessMinimum)&&void 0!==K?K:100,I.iridescence.maximumThickness=null!==(a=v.iridescenceThicknessMaximum)&&void 0!==a?a:400,v.iridescenceTexture&&U.push(this._loader.loadTextureInfoAsync("".concat(w,"/iridescenceTexture"),v.iridescenceTexture,(function(w){w.name="".concat(I.name," (Iridescence Intensity)"),I.iridescence.texture=w}))),v.iridescenceThicknessTexture&&U.push(this._loader.loadTextureInfoAsync("".concat(w,"/iridescenceThicknessTexture"),v.iridescenceThicknessTexture,(function(w){w.name="".concat(I.name," (Iridescence Thickness)"),I.iridescence.thicknessTexture=w}))),Promise.all(U).then((function(){}))},w}();b.RegisterExtension(Ow,(function(w){return new Nw(w)}));var qw="KHR_materials_emissive_strength",mw=function(){function w(w){this.name=qw,this.order=170,this._loader=w,this.enabled=this._loader.isExtensionUsed(qw)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){return P._loader.loadMaterialPropertiesAsync(w,v,I).then((function(){P._loadEmissiveProperties(u,Q,I)}))}))},w.prototype._loadEmissiveProperties=function(w,v,I){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));void 0!==v.emissiveStrength&&I.emissiveColor.scaleToRef(v.emissiveStrength,I.emissiveColor)},w}();b.RegisterExtension(qw,(function(w){return new mw(w)}));var cw="KHR_materials_sheen",Mw=function(){function w(w){this.name=cw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(cw)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialPropertiesAsync(w,v,I)),K.push(P._loadSheenPropertiesAsync(u,Q,I)),Promise.all(K).then((function(){}))}))},w.prototype._loadSheenPropertiesAsync=function(w,v,I){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var P=new Array;return I.sheen.isEnabled=!0,I.sheen.intensity=1,void 0!=v.sheenColorFactor?I.sheen.color=Q.b.FromArray(v.sheenColorFactor):I.sheen.color=Q.b.Black(),v.sheenColorTexture&&P.push(this._loader.loadTextureInfoAsync("".concat(w,"/sheenColorTexture"),v.sheenColorTexture,(function(w){w.name="".concat(I.name," (Sheen Color)"),I.sheen.texture=w}))),void 0!==v.sheenRoughnessFactor?I.sheen.roughness=v.sheenRoughnessFactor:I.sheen.roughness=0,v.sheenRoughnessTexture&&(v.sheenRoughnessTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync("".concat(w,"/sheenRoughnessTexture"),v.sheenRoughnessTexture,(function(w){w.name="".concat(I.name," (Sheen Roughness)"),I.sheen.textureRoughness=w})))),I.sheen.albedoScaling=!0,I.sheen.useRoughnessFromMainTexture=!1,Promise.all(P).then((function(){}))},w}();b.RegisterExtension(cw,(function(w){return new Mw(w)}));var Sw="KHR_materials_specular",ew=function(){function w(w){this.name=Sw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(Sw)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialPropertiesAsync(w,v,I)),K.push(P._loadSpecularPropertiesAsync(u,Q,I)),Promise.all(K).then((function(){}))}))},w.prototype._loadSpecularPropertiesAsync=function(w,v,I){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var P=new Array;return void 0!==v.specularFactor&&(I.metallicF0Factor=v.specularFactor),void 0!==v.specularColorFactor&&(I.metallicReflectanceColor=Q.b.FromArray(v.specularColorFactor)),v.specularTexture&&(v.specularTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync("".concat(w,"/specularTexture"),v.specularTexture,(function(w){w.name="".concat(I.name," (Specular F0 Strength)"),I.metallicReflectanceTexture=w,I.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),v.specularColorTexture&&P.push(this._loader.loadTextureInfoAsync("".concat(w,"/specularColorTexture"),v.specularColorTexture,(function(w){w.name="".concat(I.name," (Specular F0 Color)"),I.reflectanceTexture=w}))),Promise.all(P).then((function(){}))},w}();b.RegisterExtension(Sw,(function(w){return new ew(w)}));var Hw="KHR_materials_ior",Gw=function(){function w(w){this.name=Hw,this.order=180,this._loader=w,this.enabled=this._loader.isExtensionUsed(Hw)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialPropertiesAsync(w,v,I)),K.push(P._loadIorPropertiesAsync(u,Q,I)),Promise.all(K).then((function(){}))}))},w.prototype._loadIorPropertiesAsync=function(v,I,P){if(!(P instanceof n.d))throw new Error("".concat(v,": Material type not supported"));return void 0!==I.ior?P.indexOfRefraction=I.ior:P.indexOfRefraction=w._DEFAULT_IOR,Promise.resolve()},w._DEFAULT_IOR=1.5,w}();b.RegisterExtension(Hw,(function(w){return new Gw(w)}));var Lw="KHR_materials_variants",dw=function(){function w(w){this.name=Lw,this._loader=w,this.enabled=this._loader.isExtensionUsed(Lw)}return w.prototype.dispose=function(){this._loader=null},w.GetAvailableVariants=function(w){var v=this._GetExtensionMetadata(w);return v?Object.keys(v.variants):[]},w.prototype.getAvailableVariants=function(v){return w.GetAvailableVariants(v)},w.SelectVariant=function(w,v){var I=this._GetExtensionMetadata(w);if(!I)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(Lw," extension"));var P=function(w){var v=I.variants[w];if(v)for(var P=0,u=v;P<u.length;P++){var Q=u[P];Q.mesh.material=Q.material}};if(v instanceof Array)for(var u=0,Q=v;u<Q.length;u++){P(Q[u])}else P(v);I.lastSelected=v},w.prototype.selectVariant=function(v,I){return w.SelectVariant(v,I)},w.Reset=function(w){var v=this._GetExtensionMetadata(w);if(!v)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(Lw," extension"));for(var I=0,P=v.original;I<P.length;I++){var u=P[I];u.mesh.material=u.material}v.lastSelected=null},w.prototype.reset=function(v){return w.Reset(v)},w.GetLastSelectedVariant=function(w){var v=this._GetExtensionMetadata(w);if(!v)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(Lw," extension"));return v.lastSelected},w.prototype.getLastSelectedVariant=function(v){return w.GetLastSelectedVariant(v)},w._GetExtensionMetadata=function(w){var v,I;return(null===(I=null===(v=null===w||void 0===w?void 0:w.metadata)||void 0===v?void 0:v.gltf)||void 0===I?void 0:I.KHR_materials_variants)||null},w.prototype.onLoading=function(){var w=this._loader.gltf.extensions;if(w&&w[this.name]){var v=w[this.name];this._variants=v.variants}},w.prototype._loadMeshPrimitiveAsync=function(v,I,P,u,Q,K){var a=this;return b.LoadExtensionAsync(v,Q,this.name,(function(U,p){var r=new Array;return r.push(a._loader._loadMeshPrimitiveAsync(v,I,P,u,Q,(function(I){if(K(I),I instanceof N.b){var P=b._GetDrawMode(v,Q.mode),u=a._loader.rootBabylonMesh,Y=u?u.metadata=u.metadata||{}:{},g=Y.gltf=Y.gltf||{},J=g.KHR_materials_variants=g.KHR_materials_variants||{lastSelected:null,original:[],variants:{}};J.original.push({mesh:I,material:I.material});for(var l=function(v){var Q=p.mappings[v],K=D.Get("".concat(U,"/mappings/").concat(v,"/material"),a._loader.gltf.materials,Q.material);r.push(a._loader._loadMaterialAsync("#/materials/".concat(Q.material),K,I,P,(function(v){for(var P=function(P){var K=Q.variants[P],U=D.Get("/extensions/".concat(Lw,"/variants/").concat(K),a._variants,K);J.variants[U.name]=J.variants[U.name]||[],J.variants[U.name].push({mesh:I,material:v}),I.onClonedObservable.add((function(v){var P=v,Q=null,K=P;do{if(!(K=K.parent))return;Q=w._GetExtensionMetadata(K)}while(null===Q);if(u&&Q===w._GetExtensionMetadata(u)){for(var a in K.metadata={},u.metadata)K.metadata[a]=u.metadata[a];for(var a in K.metadata.gltf=[],u.metadata.gltf)K.metadata.gltf[a]=u.metadata.gltf[a];K.metadata.gltf.KHR_materials_variants={lastSelected:null,original:[],variants:{}};for(var p=0,r=Q.original;p<r.length;p++){var Y=r[p];K.metadata.gltf.KHR_materials_variants.original.push({mesh:Y.mesh,material:Y.material})}for(var a in Q.variants)if(Object.prototype.hasOwnProperty.call(Q.variants,a)){K.metadata.gltf.KHR_materials_variants.variants[a]=[];for(var g=0,J=Q.variants[a];g<J.length;g++){var l=J[g];K.metadata.gltf.KHR_materials_variants.variants[a].push({mesh:l.mesh,material:l.material})}}Q=K.metadata.gltf.KHR_materials_variants}for(var R=0,x=Q.original;R<x.length;R++){(B=x[R]).mesh===I&&(B.mesh=P)}for(var j=0,s=Q.variants[U.name];j<s.length;j++){var B;(B=s[j]).mesh===I&&(B.mesh=P)}}))},K=0;K<Q.variants.length;++K)P(K)})))},R=0;R<p.mappings.length;++R)l(R)}}))),Promise.all(r).then((function(w){return w[0]}))}))},w}();b.RegisterExtension(Lw,(function(w){return new dw(w)}));var Dw=function(){return Dw=Object.assign||function(w){for(var v,I=1,P=arguments.length;I<P;I++)for(var u in v=arguments[I])Object.prototype.hasOwnProperty.call(v,u)&&(w[u]=v[u]);return w},Dw.apply(this,arguments)};Object.create;Object.create;var fw=I(52128),bw=function(){function w(){}return w.ALPHA_DISABLE=0,w.ALPHA_ADD=1,w.ALPHA_COMBINE=2,w.ALPHA_SUBTRACT=3,w.ALPHA_MULTIPLY=4,w.ALPHA_MAXIMIZED=5,w.ALPHA_ONEONE=6,w.ALPHA_PREMULTIPLIED=7,w.ALPHA_PREMULTIPLIED_PORTERDUFF=8,w.ALPHA_INTERPOLATE=9,w.ALPHA_SCREENMODE=10,w.ALPHA_ONEONE_ONEONE=11,w.ALPHA_ALPHATOCOLOR=12,w.ALPHA_REVERSEONEMINUS=13,w.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,w.ALPHA_ONEONE_ONEZERO=15,w.ALPHA_EXCLUSION=16,w.ALPHA_LAYER_ACCUMULATE=17,w.ALPHA_EQUATION_ADD=0,w.ALPHA_EQUATION_SUBSTRACT=1,w.ALPHA_EQUATION_REVERSE_SUBTRACT=2,w.ALPHA_EQUATION_MAX=3,w.ALPHA_EQUATION_MIN=4,w.ALPHA_EQUATION_DARKEN=5,w.DELAYLOADSTATE_NONE=0,w.DELAYLOADSTATE_LOADED=1,w.DELAYLOADSTATE_LOADING=2,w.DELAYLOADSTATE_NOTLOADED=4,w.NEVER=512,w.ALWAYS=519,w.LESS=513,w.EQUAL=514,w.LEQUAL=515,w.GREATER=516,w.GEQUAL=518,w.NOTEQUAL=517,w.KEEP=7680,w.ZERO=0,w.REPLACE=7681,w.INCR=7682,w.DECR=7683,w.INVERT=5386,w.INCR_WRAP=34055,w.DECR_WRAP=34056,w.TEXTURE_CLAMP_ADDRESSMODE=0,w.TEXTURE_WRAP_ADDRESSMODE=1,w.TEXTURE_MIRROR_ADDRESSMODE=2,w.TEXTURE_CREATIONFLAG_STORAGE=1,w.TEXTUREFORMAT_ALPHA=0,w.TEXTUREFORMAT_LUMINANCE=1,w.TEXTUREFORMAT_LUMINANCE_ALPHA=2,w.TEXTUREFORMAT_RGB=4,w.TEXTUREFORMAT_RGBA=5,w.TEXTUREFORMAT_RED=6,w.TEXTUREFORMAT_R=6,w.TEXTUREFORMAT_RG=7,w.TEXTUREFORMAT_RED_INTEGER=8,w.TEXTUREFORMAT_R_INTEGER=8,w.TEXTUREFORMAT_RG_INTEGER=9,w.TEXTUREFORMAT_RGB_INTEGER=10,w.TEXTUREFORMAT_RGBA_INTEGER=11,w.TEXTUREFORMAT_BGRA=12,w.TEXTUREFORMAT_DEPTH24_STENCIL8=13,w.TEXTUREFORMAT_DEPTH32_FLOAT=14,w.TEXTUREFORMAT_DEPTH16=15,w.TEXTUREFORMAT_DEPTH24=16,w.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,w.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,w.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,w.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,w.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,w.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,w.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,w.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,w.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,w.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,w.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,w.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,w.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,w.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,w.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,w.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,w.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,w.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,w.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,w.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,w.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,w.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,w.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,w.TEXTURETYPE_UNSIGNED_BYTE=0,w.TEXTURETYPE_UNSIGNED_INT=0,w.TEXTURETYPE_FLOAT=1,w.TEXTURETYPE_HALF_FLOAT=2,w.TEXTURETYPE_BYTE=3,w.TEXTURETYPE_SHORT=4,w.TEXTURETYPE_UNSIGNED_SHORT=5,w.TEXTURETYPE_INT=6,w.TEXTURETYPE_UNSIGNED_INTEGER=7,w.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,w.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,w.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,w.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,w.TEXTURETYPE_UNSIGNED_INT_24_8=12,w.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,w.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,w.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,w.TEXTURETYPE_UNDEFINED=16,w.TEXTURE_NEAREST_SAMPLINGMODE=1,w.TEXTURE_NEAREST_NEAREST=1,w.TEXTURE_BILINEAR_SAMPLINGMODE=2,w.TEXTURE_LINEAR_LINEAR=2,w.TEXTURE_TRILINEAR_SAMPLINGMODE=3,w.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,w.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,w.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,w.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,w.TEXTURE_NEAREST_LINEAR=7,w.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,w.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,w.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,w.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,w.TEXTURE_LINEAR_NEAREST=12,w.TEXTURE_EXPLICIT_MODE=0,w.TEXTURE_SPHERICAL_MODE=1,w.TEXTURE_PLANAR_MODE=2,w.TEXTURE_CUBIC_MODE=3,w.TEXTURE_PROJECTION_MODE=4,w.TEXTURE_SKYBOX_MODE=5,w.TEXTURE_INVCUBIC_MODE=6,w.TEXTURE_EQUIRECTANGULAR_MODE=7,w.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,w.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,w.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,w.TEXTURE_FILTERING_QUALITY_HIGH=64,w.TEXTURE_FILTERING_QUALITY_MEDIUM=16,w.TEXTURE_FILTERING_QUALITY_LOW=8,w.SCALEMODE_FLOOR=1,w.SCALEMODE_NEAREST=2,w.SCALEMODE_CEILING=3,w.MATERIAL_TextureDirtyFlag=1,w.MATERIAL_LightDirtyFlag=2,w.MATERIAL_FresnelDirtyFlag=4,w.MATERIAL_AttributesDirtyFlag=8,w.MATERIAL_MiscDirtyFlag=16,w.MATERIAL_PrePassDirtyFlag=32,w.MATERIAL_AllDirtyFlag=63,w.MATERIAL_TriangleFillMode=0,w.MATERIAL_WireFrameFillMode=1,w.MATERIAL_PointFillMode=2,w.MATERIAL_PointListDrawMode=3,w.MATERIAL_LineListDrawMode=4,w.MATERIAL_LineLoopDrawMode=5,w.MATERIAL_LineStripDrawMode=6,w.MATERIAL_TriangleStripDrawMode=7,w.MATERIAL_TriangleFanDrawMode=8,w.MATERIAL_ClockWiseSideOrientation=0,w.MATERIAL_CounterClockWiseSideOrientation=1,w.ACTION_NothingTrigger=0,w.ACTION_OnPickTrigger=1,w.ACTION_OnLeftPickTrigger=2,w.ACTION_OnRightPickTrigger=3,w.ACTION_OnCenterPickTrigger=4,w.ACTION_OnPickDownTrigger=5,w.ACTION_OnDoublePickTrigger=6,w.ACTION_OnPickUpTrigger=7,w.ACTION_OnPickOutTrigger=16,w.ACTION_OnLongPressTrigger=8,w.ACTION_OnPointerOverTrigger=9,w.ACTION_OnPointerOutTrigger=10,w.ACTION_OnEveryFrameTrigger=11,w.ACTION_OnIntersectionEnterTrigger=12,w.ACTION_OnIntersectionExitTrigger=13,w.ACTION_OnKeyDownTrigger=14,w.ACTION_OnKeyUpTrigger=15,w.PARTICLES_BILLBOARDMODE_Y=2,w.PARTICLES_BILLBOARDMODE_ALL=7,w.PARTICLES_BILLBOARDMODE_STRETCHED=8,w.MESHES_CULLINGSTRATEGY_STANDARD=0,w.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,w.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,w.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,w.SCENELOADER_NO_LOGGING=0,w.SCENELOADER_MINIMAL_LOGGING=1,w.SCENELOADER_SUMMARY_LOGGING=2,w.SCENELOADER_DETAILED_LOGGING=3,w.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,w.PREPASS_POSITION_TEXTURE_TYPE=1,w.PREPASS_VELOCITY_TEXTURE_TYPE=2,w.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,w.PREPASS_COLOR_TEXTURE_TYPE=4,w.PREPASS_DEPTH_TEXTURE_TYPE=5,w.PREPASS_NORMAL_TEXTURE_TYPE=6,w.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,w.BUFFER_CREATIONFLAG_READ=1,w.BUFFER_CREATIONFLAG_WRITE=2,w.BUFFER_CREATIONFLAG_READWRITE=3,w.BUFFER_CREATIONFLAG_UNIFORM=4,w.BUFFER_CREATIONFLAG_VERTEX=8,w.BUFFER_CREATIONFLAG_INDEX=16,w.BUFFER_CREATIONFLAG_STORAGE=32,w.RENDERPASS_MAIN=0,w.INPUT_ALT_KEY=18,w.INPUT_CTRL_KEY=17,w.INPUT_META_KEY1=91,w.INPUT_META_KEY2=92,w.INPUT_META_KEY3=93,w.INPUT_SHIFT_KEY=16,w.SNAPSHOTRENDERING_STANDARD=0,w.SNAPSHOTRENDERING_FAST=1,w.PERSPECTIVE_CAMERA=0,w.ORTHOGRAPHIC_CAMERA=1,w.FOVMODE_VERTICAL_FIXED=0,w.FOVMODE_HORIZONTAL_FIXED=1,w.RIG_MODE_NONE=0,w.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,w.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,w.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,w.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,w.RIG_MODE_STEREOSCOPIC_INTERLACED=14,w.RIG_MODE_VR=20,w.RIG_MODE_WEBVR=21,w.RIG_MODE_CUSTOM=22,w.MAX_SUPPORTED_UV_SETS=6,w.GL_ALPHA_EQUATION_ADD=32774,w.GL_ALPHA_EQUATION_MIN=32775,w.GL_ALPHA_EQUATION_MAX=32776,w.GL_ALPHA_EQUATION_SUBTRACT=32778,w.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,w.GL_ALPHA_FUNCTION_SRC=768,w.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,w.GL_ALPHA_FUNCTION_SRC_ALPHA=770,w.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,w.GL_ALPHA_FUNCTION_DST_ALPHA=772,w.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,w.GL_ALPHA_FUNCTION_DST_COLOR=774,w.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,w.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,w.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,w.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,w.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,w.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,w.SnippetUrl="https://snippet.babylonjs.com",w}(),kw=function(){function w(v,I){var P=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=Dw(Dw({},w._GetDefaultOptions()),v),this._scene=I,this._scene._transmissionHelper=this,this.onErrorObservable=new r.c,this._scene.onDisposeObservable.addOnce((function(){P.dispose()})),this._parseScene(),this._setupRenderTargets()}return w._GetDefaultOptions=function(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:bw.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}},w.prototype.updateOptions=function(w){var v=this;if(Object.keys(w).filter((function(I){return v._options[I]!==w[I]})).length){var I=Dw(Dw({},this._options),w),P=this._options;this._options=I,I.renderSize===P.renderSize&&I.renderTargetTextureType===P.renderTargetTextureType&&I.generateMipmaps===P.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=I.samples,this._opaqueRenderTarget.lodGenerationScale=I.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=I.lodGenerationOffset):this._setupRenderTargets()}},w.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},w.prototype._shouldRenderAsTransmission=function(w){return!!w&&!!(w instanceof n.d&&w.subSurface.isRefractionEnabled)},w.prototype._addMesh=function(w){var v=this;this._materialObservers[w.uniqueId]=w.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),K.i.SetImmediate((function(){v._shouldRenderAsTransmission(w.material)?(w.material.refractionTexture=v._opaqueRenderTarget,v._transparentMeshesCache.push(w)):v._opaqueMeshesCache.push(w)}))},w.prototype._removeMesh=function(w){w.onMaterialChangedObservable.remove(this._materialObservers[w.uniqueId]),delete this._materialObservers[w.uniqueId];var v=this._transparentMeshesCache.indexOf(w);-1!==v&&this._transparentMeshesCache.splice(v,1),-1!==(v=this._opaqueMeshesCache.indexOf(w))&&this._opaqueMeshesCache.splice(v,1)},w.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},w.prototype._onMeshMaterialChanged=function(w){var v=this._transparentMeshesCache.indexOf(w),I=this._opaqueMeshesCache.indexOf(w);this._shouldRenderAsTransmission(w.material)?(w.material instanceof n.d&&(w.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==I?(this._opaqueMeshesCache.splice(I,1),this._transparentMeshesCache.push(w)):-1===v&&this._transparentMeshesCache.push(w)):-1!==v?(this._transparentMeshesCache.splice(v,1),this._opaqueMeshesCache.push(w)):-1===I&&this._opaqueMeshesCache.push(w)},w.prototype._setupRenderTargets=function(){var w,v,I,P,u=this;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new fw.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(v=null===(w=this._options.clearColor)||void 0===w?void 0:w.clone())&&void 0!==v?v:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.onBeforeBindObservable.add((function(w){P=u._scene.environmentIntensity,u._scene.environmentIntensity=1,I=u._scene.imageProcessingConfiguration.applyByPostProcess,u._options.clearColor?w.clearColor.copyFrom(u._options.clearColor):u._scene.clearColor.toLinearSpaceToRef(w.clearColor),u._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((function(){u._scene.environmentIntensity=P,u._scene.imageProcessingConfiguration._applyByPostProcess=I})),this._transparentMeshesCache.forEach((function(w){u._shouldRenderAsTransmission(w.material)&&(w.material.refractionTexture=u._opaqueRenderTarget)}))},w.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},w}(),Cw="KHR_materials_transmission",yw=function(){function w(w){this.name=Cw,this.order=175,this._loader=w,this.enabled=this._loader.isExtensionUsed(Cw),this.enabled&&(w.parent.transparencyAsCoverage=!0)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialBasePropertiesAsync(w,v,I)),K.push(P._loader.loadMaterialPropertiesAsync(w,v,I)),K.push(P._loadTransparentPropertiesAsync(u,v,I,Q)),Promise.all(K).then((function(){}))}))},w.prototype._loadTransparentPropertiesAsync=function(w,v,I,P){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var u=I;if(u.subSurface.isRefractionEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.useAlbedoToTintRefraction=!0,void 0===P.transmissionFactor)return u.subSurface.refractionIntensity=0,u.subSurface.isRefractionEnabled=!1,Promise.resolve();u.subSurface.refractionIntensity=P.transmissionFactor;var Q=u.getScene();return u.subSurface.refractionIntensity&&!Q._transmissionHelper&&new kw({},u.getScene()),u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,P.transmissionTexture?(P.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(w,"/transmissionTexture"),P.transmissionTexture,void 0).then((function(w){u.subSurface.refractionIntensityTexture=w,u.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()},w}();b.RegisterExtension(Cw,(function(w){return new yw(w)}));var Tw="KHR_materials_translucency",Zw=function(){function w(w){this.name=Tw,this.order=174,this._loader=w,this.enabled=this._loader.isExtensionUsed(Tw),this.enabled&&(w.parent.transparencyAsCoverage=!0)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialBasePropertiesAsync(w,v,I)),K.push(P._loader.loadMaterialPropertiesAsync(w,v,I)),K.push(P._loadTranslucentPropertiesAsync(u,v,I,Q)),Promise.all(K).then((function(){}))}))},w.prototype._loadTranslucentPropertiesAsync=function(w,v,I,P){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));var u=I;return u.subSurface.isTranslucencyEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,u.subSurface.useAlbedoToTintTranslucency=!0,void 0===P.translucencyFactor?(u.subSurface.translucencyIntensity=0,u.subSurface.isTranslucencyEnabled=!1,Promise.resolve()):(u.subSurface.translucencyIntensity=P.translucencyFactor,P.translucencyTexture?(P.translucencyTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(w,"/translucencyTexture"),P.translucencyTexture).then((function(w){u.subSurface.translucencyIntensityTexture=w}))):Promise.resolve())},w}();b.RegisterExtension(Tw,(function(w){return new Zw(w)}));var Aw="KHR_materials_volume",Xw=function(){function w(w){this.name=Aw,this.order=173,this._loader=w,this.enabled=this._loader.isExtensionUsed(Aw),this.enabled&&this._loader._disableInstancedMesh++}return w.prototype.dispose=function(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=new Array;return K.push(P._loader.loadMaterialBasePropertiesAsync(w,v,I)),K.push(P._loader.loadMaterialPropertiesAsync(w,v,I)),K.push(P._loadVolumePropertiesAsync(u,v,I,Q)),Promise.all(K).then((function(){}))}))},w.prototype._loadVolumePropertiesAsync=function(w,v,I,P){if(!(I instanceof n.d))throw new Error("".concat(w,": Material type not supported"));if(!I.subSurface.isRefractionEnabled&&!I.subSurface.isTranslucencyEnabled||!P.thicknessFactor)return Promise.resolve();I.subSurface.volumeIndexOfRefraction=I.indexOfRefraction;var u=void 0!==P.attenuationDistance?P.attenuationDistance:Number.MAX_VALUE;return I.subSurface.tintColorAtDistance=u,void 0!==P.attenuationColor&&3==P.attenuationColor.length&&I.subSurface.tintColor.copyFromFloats(P.attenuationColor[0],P.attenuationColor[1],P.attenuationColor[2]),I.subSurface.minimumThickness=0,I.subSurface.maximumThickness=P.thicknessFactor,I.subSurface.useThicknessAsDepth=!0,P.thicknessTexture?(P.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(w,"/thicknessTexture"),P.thicknessTexture).then((function(w){I.subSurface.thicknessTexture=w,I.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()},w}();b.RegisterExtension(Aw,(function(w){return new Xw(w)}));var wv="KHR_mesh_quantization",vv=function(){function w(w){this.name=wv,this.enabled=w.isExtensionUsed(wv)}return w.prototype.dispose=function(){},w}();b.RegisterExtension(wv,(function(w){return new vv(w)}));var Iv="KHR_texture_basisu",Pv=function(){function w(w){this.name=Iv,this._loader=w,this.enabled=w.isExtensionUsed(Iv)}return w.prototype.dispose=function(){this._loader=null},w.prototype._loadTextureAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){var K=void 0==v.sampler?b.DefaultSampler:D.Get("".concat(w,"/sampler"),P._loader.gltf.samplers,v.sampler),a=D.Get("".concat(u,"/source"),P._loader.gltf.images,Q.source);return P._loader._createTextureAsync(w,K,a,(function(w){I(w)}),v._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!v._textureInfo.nonColorData)}))},w}();b.RegisterExtension(Iv,(function(w){return new Pv(w)}));var uv="KHR_texture_transform",Qv=function(){function w(w){this.name=uv,this._loader=w,this.enabled=this._loader.isExtensionUsed(uv)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadTextureInfoAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(u,Q){return P._loader.loadTextureInfoAsync(w,v,(function(w){if(!(w instanceof W.e))throw new Error("".concat(u,": Texture type not supported"));Q.offset&&(w.uOffset=Q.offset[0],w.vOffset=Q.offset[1]),w.uRotationCenter=0,w.vRotationCenter=0,Q.rotation&&(w.wAng=-Q.rotation),Q.scale&&(w.uScale=Q.scale[0],w.vScale=Q.scale[1]),void 0!=Q.texCoord&&(w.coordinatesIndex=Q.texCoord),I(w)}))}))},w}();b.RegisterExtension(uv,(function(w){return new Qv(w)}));var Kv="KHR_xmp_json_ld",av=function(){function w(w){this.name=Kv,this.order=100,this._loader=w,this.enabled=this._loader.isExtensionUsed(Kv)}return w.prototype.dispose=function(){this._loader=null},w.prototype.onLoading=function(){var w,v,I;if(null!==this._loader.rootBabylonMesh){var P=null===(w=this._loader.gltf.extensions)||void 0===w?void 0:w.KHR_xmp_json_ld,u=null===(I=null===(v=this._loader.gltf.asset)||void 0===v?void 0:v.extensions)||void 0===I?void 0:I.KHR_xmp_json_ld;if(P&&u){var Q=+u.packet;P.packets&&Q<P.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=P.packets[Q])}}},w}();b.RegisterExtension(Kv,(function(w){return new av(w)}));var Uv=function(){function w(w,v,I){this.frame=w,this.action=v,this.onlyOnce=I,this.isDone=!1}return w.prototype._clone=function(){return new w(this.frame,this.action,this.onlyOnce)},w}(),pv=I(90690),rv=I(50504),Yv=function(){function w(v,I,P,Q,a){void 0===Q&&(Q=null);var U,p,g,J,l,R=this;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new r.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=u.l.Zero(),this._localDirection=new u.l(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=v,P=P||Y.e.LastCreatedScene)if(this._scene=P,w._SceneComponentInitialization(P),this._readyToPlayCallback=Q,this._customAttenuationFunction=function(w,v,I,P,u){return v<I?w*(1-v/I):0},a&&(this.autoplay=a.autoplay||!1,this._loop=a.loop||!1,void 0!==a.volume&&(this._volume=a.volume),this._spatialSound=null!==(U=a.spatialSound)&&void 0!==U&&U,this.maxDistance=null!==(p=a.maxDistance)&&void 0!==p?p:100,this.useCustomAttenuation=null!==(g=a.useCustomAttenuation)&&void 0!==g&&g,this.rolloffFactor=a.rolloffFactor||1,this.refDistance=a.refDistance||1,this.distanceModel=a.distanceModel||"linear",this._playbackRate=a.playbackRate||1,this._streaming=null!==(J=a.streaming)&&void 0!==J&&J,this._length=a.length,this._offset=a.offset),(null===(l=pv.d.audioEngine)||void 0===l?void 0:l.canUseWebAudio)&&pv.d.audioEngine.audioContext){this._soundGain=pv.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);var x=!0;if(I)try{"string"===typeof I?this._urlType="String":I instanceof ArrayBuffer?this._urlType="ArrayBuffer":I instanceof HTMLMediaElement?this._urlType="MediaElement":I instanceof MediaStream?this._urlType="MediaStream":Array.isArray(I)&&(this._urlType="Array");var j=[],s=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=pv.d.audioEngine.audioContext.createMediaElementSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=pv.d.audioEngine.audioContext.createMediaStreamSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":I.byteLength>0&&(s=!0,this._soundLoaded(I));break;case"String":j.push(I);case"Array":0===j.length&&(j=I);for(var B=function(w){var v=j[w];if(s=a&&a.skipCodecCheck||-1!==v.indexOf(".mp3",v.length-4)&&pv.d.audioEngine.isMP3supported||-1!==v.indexOf(".ogg",v.length-4)&&pv.d.audioEngine.isOGGsupported||-1!==v.indexOf(".wav",v.length-4)||-1!==v.indexOf(".m4a",v.length-4)||-1!==v.indexOf(".mp4",v.length-4)||-1!==v.indexOf("blob:"))return t._streaming?(t._htmlAudioElement=new Audio(v),t._htmlAudioElement.controls=!1,t._htmlAudioElement.loop=t.loop,K.i.SetCorsBehavior(v,t._htmlAudioElement),t._htmlAudioElement.preload="auto",t._htmlAudioElement.addEventListener("canplaythrough",(function(){R._isReadyToPlay=!0,R.autoplay&&R.play(0,R._offset,R._length),R._readyToPlayCallback&&R._readyToPlayCallback()})),document.body.appendChild(t._htmlAudioElement),t._htmlAudioElement.load()):t._scene._loadFile(v,(function(w){R._soundLoaded(w)}),void 0,!0,!0,(function(w){w&&z.e.Error("XHR "+w.status+" error on: "+v+"."),z.e.Error("Sound creation aborted."),R._scene.mainSoundTrack.removeSound(R)})),"break"},t=this,i=0;i<j.length;i++){if("break"===B(i))break}break;default:x=!1}x?s||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout((function(){R._readyToPlayCallback&&R._readyToPlayCallback()}),1e3)):z.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(w){z.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),pv.d.audioEngine&&!pv.d.audioEngine.WarnedWebAudioUnsupported&&(z.e.Error("Web Audio is not supported by your browser."),pv.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout((function(){R._readyToPlayCallback&&R._readyToPlayCallback()}),1e3)}return Object.defineProperty(w.prototype,"loop",{get:function(){return this._loop},set:function(w){w!==this._loop&&(this._loop=w,this.updateOptions({loop:w}))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"currentTime",{get:function(){var w;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;var v=this._startOffset;return this.isPlaying&&(null===(w=pv.d.audioEngine)||void 0===w?void 0:w.audioContext)&&(v+=pv.d.audioEngine.audioContext.currentTime-this._startTime),v},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"spatialSound",{get:function(){return this._spatialSound},set:function(w){var v;this._spatialSound=w,this._spatialSound&&(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.canUseWebAudio)&&pv.d.audioEngine.audioContext&&this._createSpatialParameters()},enumerable:!1,configurable:!0}),w.prototype.dispose=function(){var w;(null===(w=pv.d.audioEngine)||void 0===w?void 0:w.canUseWebAudio)&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},w.prototype.isReady=function(){return this._isReadyToPlay},w.prototype.getClassName=function(){return"Sound"},w.prototype._soundLoaded=function(w){var v,I=this;(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.audioContext)&&pv.d.audioEngine.audioContext.decodeAudioData(w,(function(w){I._audioBuffer=w,I._isReadyToPlay=!0,I.autoplay&&I.play(0,I._offset,I._length),I._readyToPlayCallback&&I._readyToPlayCallback()}),(function(w){z.e.Error("Error while decoding audio data for: "+I.name+" / Error: "+w)}))},w.prototype.setAudioBuffer=function(w){var v;(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.canUseWebAudio)&&(this._audioBuffer=w,this._isReadyToPlay=!0)},w.prototype.updateOptions=function(w){var v,I,P,u,Q,K,a,U,p,r;w&&(this.loop=null!==(v=w.loop)&&void 0!==v?v:this.loop,this.maxDistance=null!==(I=w.maxDistance)&&void 0!==I?I:this.maxDistance,this.useCustomAttenuation=null!==(P=w.useCustomAttenuation)&&void 0!==P?P:this.useCustomAttenuation,this.rolloffFactor=null!==(u=w.rolloffFactor)&&void 0!==u?u:this.rolloffFactor,this.refDistance=null!==(Q=w.refDistance)&&void 0!==Q?Q:this.refDistance,this.distanceModel=null!==(K=w.distanceModel)&&void 0!==K?K:this.distanceModel,this._playbackRate=null!==(a=w.playbackRate)&&void 0!==a?a:this._playbackRate,this._length=null!==(U=w.length)&&void 0!==U?U:void 0,this._offset=null!==(p=w.offset)&&void 0!==p?p:void 0,this.setVolume(null!==(r=w.volume)&&void 0!==r?r:this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))},w.prototype._createSpatialParameters=function(){var w,v;(null===(w=pv.d.audioEngine)||void 0===w?void 0:w.canUseWebAudio)&&pv.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=null!==(v=this._soundPanner)&&void 0!==v?v:pv.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))},w.prototype._updateSpatialParameters=function(){this._spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},w.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},w.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},w.prototype._switchPanningModel=function(){var w;(null===(w=pv.d.audioEngine)||void 0===w?void 0:w.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},w.prototype.connectToSoundTrackAudioNode=function(w){var v;(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.canUseWebAudio)&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(w),this._isOutputConnected=!0)},w.prototype.setDirectionalCone=function(w,v,I){v<w?z.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=w,this._coneOuterAngle=v,this._coneOuterGain=I,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))},Object.defineProperty(w.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(w){var v;if(w!=this._coneInnerAngle){if(this._coneOuterAngle<w)return void z.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=w,(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(w){var v;if(w!=this._coneOuterAngle){if(w<this._coneInnerAngle)return void z.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=w,(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!1,configurable:!0}),w.prototype.setPosition=function(w){var v;w.equals(this._position)||(this._position.copyFrom(w),(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))},w.prototype.setLocalDirectionToMesh=function(w){var v;this._localDirection=w,(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.canUseWebAudio)&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},w.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var w=this._connectedTransformNode.getWorldMatrix(),v=u.l.TransformNormal(this._localDirection,w);v.normalize(),this._soundPanner.orientationX.value=v.x,this._soundPanner.orientationY.value=v.y,this._soundPanner.orientationZ.value=v.z}},w.prototype.updateDistanceFromListener=function(){var w;if((null===(w=pv.d.audioEngine)||void 0===w?void 0:w.canUseWebAudio)&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var v=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,v,this.maxDistance,this.refDistance,this.rolloffFactor)}},w.prototype.setAttenuationFunction=function(w){this._customAttenuationFunction=w},w.prototype.play=function(w,v,I){var P,u,Q,K,a=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&(null===(P=pv.d.audioEngine)||void 0===P?void 0:P.audioContext))try{this._startOffset<0&&(w=-this._startOffset,this._startOffset=0);var U=w?(null===(u=pv.d.audioEngine)||void 0===u?void 0:u.audioContext.currentTime)+w:null===(Q=pv.d.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=pv.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){a._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){!function w(){var v,I;if(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.unlocked){var P=a._htmlAudioElement.play();void 0!==P&&P.catch((function(){var v,I;null===(v=pv.d.audioEngine)||void 0===v||v.lock(),(a.loop||a.autoplay)&&(null===(I=pv.d.audioEngine)||void 0===I||I.onAudioUnlockedObservable.addOnce((function(){w()})))}))}else(a.loop||a.autoplay)&&(null===(I=pv.d.audioEngine)||void 0===I||I.onAudioUnlockedObservable.addOnce((function(){w()})))}()}}else{var p=function(){var P,u,Q;if(null===(P=pv.d.audioEngine)||void 0===P?void 0:P.audioContext){if(I=I||a._length,v=v||a._offset,a._soundSource){var K=a._soundSource;K.onended=function(){K.disconnect()}}if(a._soundSource=null===(u=pv.d.audioEngine)||void 0===u?void 0:u.audioContext.createBufferSource(),a._soundSource&&a._inputAudioNode){a._soundSource.buffer=a._audioBuffer,a._soundSource.connect(a._inputAudioNode),a._soundSource.loop=a.loop,void 0!==v&&(a._soundSource.loopStart=v),void 0!==I&&(a._soundSource.loopEnd=(0|v)+I),a._soundSource.playbackRate.value=a._playbackRate,a._soundSource.onended=function(){a._onended()},U=w?(null===(Q=pv.d.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime)+w:pv.d.audioEngine.audioContext.currentTime;var p=a.isPaused?a._startOffset%a._soundSource.buffer.duration:v||0;a._soundSource.start(U,p,a.loop?void 0:I)}}};"suspended"===(null===(K=pv.d.audioEngine)||void 0===K?void 0:K.audioContext.state)?setTimeout((function(){var w;"suspended"===(null===(w=pv.d.audioEngine)||void 0===w?void 0:w.audioContext.state)?(pv.d.audioEngine.lock(),(a.loop||a.autoplay)&&pv.d.audioEngine.onAudioUnlockedObservable.addOnce((function(){p()}))):p()}),500):p()}this._startTime=U,this.isPlaying=!0,this.isPaused=!1}catch(w){z.e.Error("Error while trying to play audio: "+this.name+", "+w.message)}},w.prototype._onended=function(){this.isPlaying=!1,this._startOffset=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},w.prototype.stop=function(w){var v,I=this;if(this.isPlaying)if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if((null===(v=pv.d.audioEngine)||void 0===v?void 0:v.audioContext)&&this._soundSource){var P=w?pv.d.audioEngine.audioContext.currentTime+w:void 0;this._soundSource.stop(P),void 0===P?(this.isPlaying=!1,this._soundSource.onended=function(){}):this._soundSource.onended=function(){I.isPlaying=!1},this.isPaused||(this._startOffset=0)}},w.prototype.pause=function(){var w;this.isPlaying&&(this.isPaused=!0,this._streaming?(this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect(),this.isPlaying=!1):(null===(w=pv.d.audioEngine)||void 0===w?void 0:w.audioContext)&&(this.stop(0),this._startOffset+=pv.d.audioEngine.audioContext.currentTime-this._startTime))},w.prototype.setVolume=function(w,v){var I;(null===(I=pv.d.audioEngine)||void 0===I?void 0:I.canUseWebAudio)&&this._soundGain&&(v&&pv.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(pv.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,pv.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(w,pv.d.audioEngine.audioContext.currentTime+v)):this._soundGain.gain.value=w),this._volume=w},w.prototype.setPlaybackRate=function(w){this._playbackRate=w,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},w.prototype.getVolume=function(){return this._volume},w.prototype.attachToMesh=function(w){var v=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=w,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(w){return v._onRegisterAfterWorldMatrixUpdate(w)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},w.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},w.prototype._onRegisterAfterWorldMatrixUpdate=function(w){var v;if(w.getBoundingInfo){var I=w.getBoundingInfo();this.setPosition(I.boundingSphere.centerWorld)}else this.setPosition(w.absolutePosition);(null===(v=pv.d.audioEngine)||void 0===v?void 0:v.canUseWebAudio)&&this._isDirectional&&this.isPlaying&&this._updateDirection()},w.prototype.clone=function(){var v=this;if(this._streaming)return null;var I={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},P=new w(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,I);return this.useCustomAttenuation&&P.setAttenuationFunction(this._customAttenuationFunction),P.setPosition(this._position),P.setPlaybackRate(this._playbackRate),function w(){v._isReadyToPlay?(P._audioBuffer=v.getAudioBuffer(),P._isReadyToPlay=!0,P.autoplay&&P.play(0,v._offset,v._length)):window.setTimeout(w,300)}(),P},w.prototype.getAudioBuffer=function(){return this._audioBuffer},w.prototype.getSoundSource=function(){return this._soundSource},w.prototype.getSoundGain=function(){return this._soundGain},w.prototype.serialize=function(){var w={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(w.connectedMeshId=this._connectedTransformNode.id),w.position=this._position.asArray(),w.refDistance=this.refDistance,w.distanceModel=this.distanceModel,w.isDirectional=this._isDirectional,w.localDirectionToMesh=this._localDirection.asArray(),w.coneInnerAngle=this._coneInnerAngle,w.coneOuterAngle=this._coneOuterAngle,w.coneOuterGain=this._coneOuterGain),w},w.Parse=function(v,I,P,Q){var K,a=v.name;K=v.url?P+v.url:P+a;var U,p={autoplay:v.autoplay,loop:v.loop,volume:v.volume,spatialSound:v.spatialSound,maxDistance:v.maxDistance,rolloffFactor:v.rolloffFactor,refDistance:v.refDistance,distanceModel:v.distanceModel,playbackRate:v.playbackRate};if(Q){U=new w(a,new ArrayBuffer(0),I,null,p),function w(){Q._isReadyToPlay?(U._audioBuffer=Q.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,U._offset,U._length)):window.setTimeout(w,300)}()}else U=new w(a,K,I,(function(){I._removePendingData(U)}),p),I._addPendingData(U);if(v.position){var r=u.l.FromArray(v.position);U.setPosition(r)}if(v.isDirectional&&(U.setDirectionalCone(v.coneInnerAngle||360,v.coneOuterAngle||360,v.coneOuterGain||0),v.localDirectionToMesh)){var Y=u.l.FromArray(v.localDirectionToMesh);U.setLocalDirectionToMesh(Y)}if(v.connectedMeshId){var g=I.getMeshById(v.connectedMeshId);g&&U.attachToMesh(g)}return v.metadata&&(U.metadata=v.metadata),U},w._SceneComponentInitialization=function(w){throw(0,rv.e)("AudioSceneComponent")},w}(),gv=function(){function w(w,v,I){var P=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],v.length!==I.length)throw new Error("Sounds length does not equal weights length");this.loop=w,this._weights=I;for(var u=0,Q=0,K=I;Q<K.length;Q++){u+=K[Q]}for(var a=u>0?1/u:0,U=0;U<this._weights.length;U++)this._weights[U]*=a;this._sounds=v;for(var p=0,r=this._sounds;p<r.length;p++){r[p].onEndedObservable.add((function(){P._onended()}))}}return Object.defineProperty(w.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(w){if(w!==this._coneInnerAngle){if(this._coneOuterAngle<w)return void z.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=w;for(var v=0,I=this._sounds;v<I.length;v++){I[v].directionalConeInnerAngle=w}}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(w){if(w!==this._coneOuterAngle){if(w<this._coneInnerAngle)return void z.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=w;for(var v=0,I=this._sounds;v<I.length;v++){I[v].directionalConeOuterAngle=w}}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"volume",{get:function(){return this._volume},set:function(w){if(w!==this._volume)for(var v=0,I=this._sounds;v<I.length;v++){I[v].setVolume(w)}},enumerable:!1,configurable:!0}),w.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},w.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},w.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},w.prototype.play=function(w){if(!this.isPaused){this.stop();for(var v=Math.random(),I=0,P=0;P<this._weights.length;P++)if(v<=(I+=this._weights[P])){this._currentIndex=P;break}}var u=this._sounds[this._currentIndex];u.isReady()?u.play(0,this.isPaused?void 0:w):u.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},w}(),Jv="MSFT_audio_emitter",lv=function(){function w(w){this.name=Jv,this._loader=w,this.enabled=this._loader.isExtensionUsed(Jv)}return w.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},w.prototype.onLoading=function(){var w=this._loader.gltf.extensions;if(w&&w[this.name]){var v=w[this.name];this._clips=v.clips,this._emitters=v.emitters,D.Assign(this._clips),D.Assign(this._emitters)}},w.prototype.loadSceneAsync=function(w,v){var I=this;return b.LoadExtensionAsync(w,v,this.name,(function(P,u){var Q=new Array;Q.push(I._loader.loadSceneAsync(w,v));for(var K=0,a=u.emitters;K<a.length;K++){var U=a[K],p=D.Get("".concat(P,"/emitters"),I._emitters,U);if(void 0!=p.refDistance||void 0!=p.maxDistance||void 0!=p.rolloffFactor||void 0!=p.distanceModel||void 0!=p.innerAngle||void 0!=p.outerAngle)throw new Error("".concat(P,": Direction or Distance properties are not allowed on emitters attached to a scene"));Q.push(I._loadEmitterAsync("".concat(P,"/emitters/").concat(p.index),p))}return Promise.all(Q).then((function(){}))}))},w.prototype.loadNodeAsync=function(w,v,I){var P=this;return b.LoadExtensionAsync(w,v,this.name,(function(w,Q){var a=new Array;return P._loader.loadNodeAsync(w,v,(function(v){for(var U=function(I){var Q=D.Get("".concat(w,"/emitters"),P._emitters,I);a.push(P._loadEmitterAsync("".concat(w,"/emitters/").concat(Q.index),Q).then((function(){for(var w=0,I=Q._babylonSounds;w<I.length;w++){var P=I[w];P.attachToMesh(v),void 0==Q.innerAngle&&void 0==Q.outerAngle||(P.setLocalDirectionToMesh(u.l.Forward()),P.setDirectionalCone(2*K.i.ToDegrees(void 0==Q.innerAngle?Math.PI:Q.innerAngle),2*K.i.ToDegrees(void 0==Q.outerAngle?Math.PI:Q.outerAngle),0))}})))},p=0,r=Q.emitters;p<r.length;p++){U(r[p])}I(v)})).then((function(w){return Promise.all(a).then((function(){return w}))}))}))},w.prototype.loadAnimationAsync=function(w,v){var I=this;return b.LoadExtensionAsync(w,v,this.name,(function(P,u){return I._loader.loadAnimationAsync(w,v).then((function(Q){var K=new Array;D.Assign(u.events);for(var a=0,U=u.events;a<U.length;a++){var p=U[a];K.push(I._loadAnimationEventAsync("".concat(P,"/events/").concat(p.index),w,v,p,Q))}return Promise.all(K).then((function(){return Q}))}))}))},w.prototype._loadClipAsync=function(w,v){if(v._objectURL)return v._objectURL;var I;if(v.uri)I=this._loader.loadUriAsync(w,v,v.uri);else{var P=D.Get("".concat(w,"/bufferView"),this._loader.gltf.bufferViews,v.bufferView);I=this._loader.loadBufferViewAsync("/bufferViews/".concat(P.index),P)}return v._objectURL=I.then((function(w){return URL.createObjectURL(new Blob([w],{type:v.mimeType}))})),v._objectURL},w.prototype._loadEmitterAsync=function(w,v){var I=this;if(v._babylonSounds=v._babylonSounds||[],!v._babylonData){for(var P=new Array,u=v.name||"emitter".concat(v.index),Q={loop:!1,autoplay:!1,volume:void 0==v.volume?1:v.volume},a=function(w){var K="/extensions/".concat(U.name,"/clips"),a=D.Get(K,U._clips,v.clips[w].clip);P.push(U._loadClipAsync("".concat(K,"/").concat(v.clips[w].clip),a).then((function(P){var K=v._babylonSounds[w]=new Yv(u,P,I._loader.babylonScene,null,Q);K.refDistance=v.refDistance||1,K.maxDistance=v.maxDistance||256,K.rolloffFactor=v.rolloffFactor||1,K.distanceModel=v.distanceModel||"exponential"})))},U=this,p=0;p<v.clips.length;p++)a(p);var r=Promise.all(P).then((function(){var w=v.clips.map((function(w){return w.weight||1})),I=new gv(v.loop||!1,v._babylonSounds,w);v.innerAngle&&(I.directionalConeInnerAngle=2*K.i.ToDegrees(v.innerAngle)),v.outerAngle&&(I.directionalConeOuterAngle=2*K.i.ToDegrees(v.outerAngle)),v.volume&&(I.volume=v.volume),v._babylonData.sound=I}));v._babylonData={loaded:r}}return v._babylonData.loaded},w.prototype._getEventAction=function(w,v,I,P,u){switch(I){case"play":return function(w){var I=(u||0)+(w-P);v.play(I)};case"stop":return function(){v.stop()};case"pause":return function(){v.pause()};default:throw new Error("".concat(w,": Unsupported action ").concat(I))}},w.prototype._loadAnimationEventAsync=function(w,v,I,P,u){var Q=this;if(0==u.targetedAnimations.length)return Promise.resolve();var K=u.targetedAnimations[0],a=P.emitter,U=D.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,a);return this._loadEmitterAsync(w,U).then((function(){var v=U._babylonData.sound;if(v){var I=new Uv(P.time,Q._getEventAction(w,v,P.action,P.time,P.startOffset));K.animation.addEvent(I),u.onAnimationGroupEndObservable.add((function(){v.stop()})),u.onAnimationGroupPauseObservable.add((function(){v.pause()}))}}))},w}();b.RegisterExtension(Jv,(function(w){return new lv(w)}));var Rv="MSFT_lod",xv=function(){function w(w){this.name=Rv,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new r.c,this.onMaterialLODsLoadedObservable=new r.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=w,this.enabled=this._loader.isExtensionUsed(Rv)}return w.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},w.prototype.onReady=function(){for(var w=this,v=function(v){var P=Promise.all(I._nodePromiseLODs[v]).then((function(){0!==v&&(w._loader.endPerformanceCounter("Node LOD ".concat(v)),w._loader.log("Loaded node LOD ".concat(v))),w.onNodeLODsLoadedObservable.notifyObservers(v),v!==w._nodePromiseLODs.length-1&&(w._loader.startPerformanceCounter("Node LOD ".concat(v+1)),w._loadBufferLOD(w._nodeBufferLODs,v+1),w._nodeSignalLODs[v]&&w._nodeSignalLODs[v].resolve())}));I._loader._completePromises.push(P)},I=this,P=0;P<this._nodePromiseLODs.length;P++)v(P);var u=function(v){var I=Promise.all(Q._materialPromiseLODs[v]).then((function(){0!==v&&(w._loader.endPerformanceCounter("Material LOD ".concat(v)),w._loader.log("Loaded material LOD ".concat(v))),w.onMaterialLODsLoadedObservable.notifyObservers(v),v!==w._materialPromiseLODs.length-1&&(w._loader.startPerformanceCounter("Material LOD ".concat(v+1)),w._loadBufferLOD(w._materialBufferLODs,v+1),w._materialSignalLODs[v]&&w._materialSignalLODs[v].resolve())}));Q._loader._completePromises.push(I)},Q=this;for(P=0;P<this._materialPromiseLODs.length;P++)u(P)},w.prototype.loadSceneAsync=function(w,v){var I=this._loader.loadSceneAsync(w,v);return this._loadBufferLOD(this._bufferLODs,0),I},w.prototype.loadNodeAsync=function(w,v,I){var u=this;return b.LoadExtensionAsync(w,v,this.name,(function(w,Q){var K,a=u._getLODs(w,v,u._loader.gltf.nodes,Q.ids);u._loader.logOpen("".concat(w));for(var U=function(w){var v=a[w];0!==w&&(u._nodeIndexLOD=w,u._nodeSignalLODs[w]=u._nodeSignalLODs[w]||new P);var Q=u._loader.loadNodeAsync("/nodes/".concat(v.index),v,(function(w){I(w),w.setEnabled(!1)})).then((function(v){if(0!==w){var I=a[w-1];I._babylonTransformNode&&(u._disposeTransformNode(I._babylonTransformNode),delete I._babylonTransformNode)}return v.setEnabled(!0),v}));u._nodePromiseLODs[w]=u._nodePromiseLODs[w]||[],0===w?K=Q:(u._nodeIndexLOD=null,u._nodePromiseLODs[w].push(Q))},p=0;p<a.length;p++)U(p);return u._loader.logClose(),K}))},w.prototype._loadMaterialAsync=function(w,v,I,P,u){var Q=this;return this._nodeIndexLOD?null:b.LoadExtensionAsync(w,v,this.name,(function(w,K){var a,U=Q._getLODs(w,v,Q._loader.gltf.materials,K.ids);Q._loader.logOpen("".concat(w));for(var p=function(w){var v=U[w];0!==w&&(Q._materialIndexLOD=w);var K=Q._loader._loadMaterialAsync("/materials/".concat(v.index),v,I,P,(function(v){0===w&&u(v)})).then((function(v){if(0!==w){u(v);var I=U[w-1]._data;I[P]&&(Q._disposeMaterials([I[P].babylonMaterial]),delete I[P])}return v}));Q._materialPromiseLODs[w]=Q._materialPromiseLODs[w]||[],0===w?a=K:(Q._materialIndexLOD=null,Q._materialPromiseLODs[w].push(K))},r=0;r<U.length;r++)p(r);return Q._loader.logClose(),a}))},w.prototype._loadUriAsync=function(w,v,I){var u=this;if(null!==this._nodeIndexLOD){this._loader.log("deferred");var Q=this._nodeIndexLOD-1;return this._nodeSignalLODs[Q]=this._nodeSignalLODs[Q]||new P,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((function(){return u._loader.loadUriAsync(w,v,I)}))}if(null!==this._materialIndexLOD){this._loader.log("deferred");Q=this._materialIndexLOD-1;return this._materialSignalLODs[Q]=this._materialSignalLODs[Q]||new P,this._materialSignalLODs[Q].promise.then((function(){return u._loader.loadUriAsync(w,v,I)}))}return null},w.prototype.loadBufferAsync=function(w,v,I,u){if(this._loader.parent.useRangeRequests&&!v.uri){if(!this._loader.bin)throw new Error("".concat(w,": Uri is missing or the binary glTF is missing its binary chunk"));var Q=function(w,v){var Q=I,K=Q+u-1,a=w[v];return a?(a.start=Math.min(a.start,Q),a.end=Math.max(a.end,K)):(a={start:Q,end:K,loaded:new P},w[v]=a),a.loaded.promise.then((function(w){return new Uint8Array(w.buffer,w.byteOffset+I-a.start,u)}))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?Q(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?Q(this._materialBufferLODs,this._materialIndexLOD):Q(this._bufferLODs,0)}return null},w.prototype._loadBufferLOD=function(w,v){var I=w[v];I&&(this._loader.log("Loading buffer range [".concat(I.start,"-").concat(I.end,"]")),this._loader.bin.readAsync(I.start,I.end-I.start+1).then((function(w){I.loaded.resolve(w)}),(function(w){I.loaded.reject(w)})))},w.prototype._getLODs=function(w,v,I,P){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var u=new Array,Q=P.length-1;Q>=0;Q--)if(u.push(D.Get("".concat(w,"/ids/").concat(P[Q]),I,P[Q])),u.length===this.maxLODsToLoad)return u;return u.push(v),u},w.prototype._disposeTransformNode=function(w){var v=this,I=new Array,P=w.material;P&&I.push(P);for(var u=0,Q=w.getChildMeshes();u<Q.length;u++){var K=Q[u];K.material&&I.push(K.material)}w.dispose();var a=I.filter((function(w){return v._loader.babylonScene.meshes.every((function(v){return v.material!=w}))}));this._disposeMaterials(a)},w.prototype._disposeMaterials=function(w){for(var v={},I=0,P=w;I<P.length;I++){for(var u=0,Q=(r=P[I]).getActiveTextures();u<Q.length;u++){var K=Q[u];v[K.uniqueId]=K}r.dispose()}for(var a in v)for(var U=0,p=this._loader.babylonScene.materials;U<p.length;U++){var r;(r=p[U]).hasTexture(v[a])&&delete v[a]}for(var a in v)v[a].dispose()},w}();b.RegisterExtension(Rv,(function(w){return new xv(w)}));var jv="MSFT_minecraftMesh",sv=function(){function w(w){this.name=jv,this._loader=w,this.enabled=this._loader.isExtensionUsed(jv)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtraAsync(w,v,this.name,(function(u,Q){if(Q){if(!(I instanceof n.d))throw new Error("".concat(u,": Material type not supported"));var K=P._loader.loadMaterialPropertiesAsync(w,v,I);return I.needAlphaBlending()&&(I.forceDepthWrite=!0,I.separateCullingPass=!0),I.backFaceCulling=I.forceDepthWrite,I.twoSidedLighting=!0,K}return null}))},w}();b.RegisterExtension(jv,(function(w){return new sv(w)}));var Bv="MSFT_sRGBFactors",tv=function(){function w(w){this.name=Bv,this._loader=w,this.enabled=this._loader.isExtensionUsed(Bv)}return w.prototype.dispose=function(){this._loader=null},w.prototype.loadMaterialPropertiesAsync=function(w,v,I){var P=this;return b.LoadExtraAsync(w,v,this.name,(function(u,Q){if(Q){if(!(I instanceof n.d))throw new Error("".concat(u,": Material type not supported"));var K=P._loader.loadMaterialPropertiesAsync(w,v,I);return I.albedoTexture||I.albedoColor.toLinearSpaceToRef(I.albedoColor),I.reflectivityTexture||I.reflectivityColor.toLinearSpaceToRef(I.reflectivityColor),K}return null}))},w}();b.RegisterExtension(Bv,(function(w){return new tv(w)}));var iv="ExtrasAsMetadata",zv=function(){function w(w){this.name=iv,this.enabled=!0,this._loader=w}return w.prototype._assignExtras=function(w,v){if(v.extras&&Object.keys(v.extras).length>0){var I=w.metadata=w.metadata||{};(I.gltf=I.gltf||{}).extras=v.extras}},w.prototype.dispose=function(){this._loader=null},w.prototype.loadNodeAsync=function(w,v,I){var P=this;return this._loader.loadNodeAsync(w,v,(function(w){P._assignExtras(w,v),I(w)}))},w.prototype.loadCameraAsync=function(w,v,I){var P=this;return this._loader.loadCameraAsync(w,v,(function(w){P._assignExtras(w,v),I(w)}))},w.prototype.createMaterial=function(w,v,I){var P=this._loader.createMaterial(w,v,I);return this._assignExtras(P,v),P},w}();b.RegisterExtension(iv,(function(w){return new zv(w)}))},47984:function(w,v,I){"use strict";I.d(v,{c:function(){return E},g:function(){return u},k:function(){return P},n:function(){return Q}});var P,u,Q,K=I(9271),a=I(9217),U=I(67269),p=I(78502),r=I(60569),Y=I(65847),g=I(9127),J=I(78588),l=function(w){function v(){return null!==w&&w.apply(this,arguments)||this}return(0,p.m)(v,w),v}(r.b),R=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},x=function(w){function v(v){var I=w.call(this)||this;return I._wasAddedToScene=!1,(v=v||J.e.LastCreatedScene)?(I.scene=v,I.sounds=[],I.effectLayers=[],I.layers=[],I.lensFlareSystems=[],I.proceduralTextures=[],I.reflectionProbes=[],v.onDisposeObservable.add((function(){I._wasAddedToScene||I.dispose()})),I._onContextRestoredObserver=v.getEngine().onContextRestoredObservable.add((function(){for(var w=0,v=I.geometries;w<v.length;w++){v[w]._rebuild()}for(var P=0,u=I.meshes;P<u.length;P++){u[P]._rebuild()}for(var Q=0,K=I.particleSystems;Q<K.length;Q++){K[Q].rebuild()}for(var a=0,U=I.textures;a<U.length;a++){U[a]._rebuild()}})),I):I}return(0,p.m)(v,w),v.prototype.instantiateModelsToScene=function(w,v,I){var P=this;void 0===v&&(v=!1);var u={},Q={},K=new R,a=[],U=[];I||(I={doNotInstantiate:!0});var p=function(v,I){if(u[v.uniqueId]=I.uniqueId,Q[I.uniqueId]=I,w&&(I.name=w(v.name)),I instanceof Y.b){var P=I;if(P.morphTargetManager){var K=v.morphTargetManager;P.morphTargetManager=K.clone();for(var a=0;a<K.numTargets;a++){var U=K.getTarget(a),p=P.morphTargetManager.getTarget(a);u[U.uniqueId]=p.uniqueId,Q[p.uniqueId]=p}}}};return this.transformNodes.forEach((function(w){if((!I||!I.predicate||I.predicate(w))&&!w.parent){var v=w.instantiateHierarchy(null,I,(function(w,v){p(w,v)}));v&&K.rootNodes.push(v)}})),this.meshes.forEach((function(a){if((!I||!I.predicate||I.predicate(a))&&!a.parent){var r=a.instantiateHierarchy(null,I,(function(I,K){if(p(I,K),K.material){var a=K;if(a.material)if(v){var r=I.material;if(-1===U.indexOf(r)){var Y=r.clone(w?w(r.name):"Clone of "+r.name);if(U.push(r),u[r.uniqueId]=Y.uniqueId,Q[Y.uniqueId]=Y,"MultiMaterial"===r.getClassName()){for(var g=r,J=0,l=g.subMaterials;J<l.length;J++){var R=l[J];R&&(Y=R.clone(w?w(R.name):"Clone of "+R.name),U.push(R),u[R.uniqueId]=Y.uniqueId,Q[Y.uniqueId]=Y)}g.subMaterials=g.subMaterials.map((function(w){return w&&Q[u[w.uniqueId]]}))}}"InstancedMesh"!==a.getClassName()&&(a.material=Q[u[r.uniqueId]])}else"MultiMaterial"===a.material.getClassName()?-1===P.scene.multiMaterials.indexOf(a.material)&&P.scene.addMultiMaterial(a.material):-1===P.scene.materials.indexOf(a.material)&&P.scene.addMaterial(a.material)}}));r&&K.rootNodes.push(r)}})),this.skeletons.forEach((function(v){if(!I||!I.predicate||I.predicate(v)){for(var U=v.clone(w?w(v.name):"Clone of "+v.name),p=0,r=P.meshes;p<r.length;p++){var Y=r[p];if(Y.skeleton===v&&!Y.isAnInstance){var g=Q[u[Y.uniqueId]];if(g.isAnInstance)continue;if(g.skeleton=U,-1!==a.indexOf(U))continue;a.push(U);for(var J=0,l=U.bones;J<l.length;J++){var R=l[J];R._linkedTransformNode&&(R._linkedTransformNode=Q[u[R._linkedTransformNode.uniqueId]])}}}K.skeletons.push(U)}})),this.animationGroups.forEach((function(v){if(!I||!I.predicate||I.predicate(v)){var P=v.clone(w?w(v.name):"Clone of "+v.name,(function(w){return Q[u[w.uniqueId]]||w}));K.animationGroups.push(P)}})),K},v.prototype.addAllToScene=function(){if(!this._wasAddedToScene){this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var w=0,v=this.scene._serializableComponents;w<v.length;w++){v[w].addFromContainer(this)}this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}},v.prototype.addToScene=function(w){var v=this;void 0===w&&(w=null),this.cameras.forEach((function(I){w&&!w(I)||v.scene.addCamera(I)})),this.lights.forEach((function(I){w&&!w(I)||v.scene.addLight(I)})),this.meshes.forEach((function(I){w&&!w(I)||v.scene.addMesh(I)})),this.skeletons.forEach((function(I){w&&!w(I)||v.scene.addSkeleton(I)})),this.animations.forEach((function(I){w&&!w(I)||v.scene.addAnimation(I)})),this.animationGroups.forEach((function(I){w&&!w(I)||v.scene.addAnimationGroup(I)})),this.multiMaterials.forEach((function(I){w&&!w(I)||v.scene.addMultiMaterial(I)})),this.materials.forEach((function(I){w&&!w(I)||v.scene.addMaterial(I)})),this.morphTargetManagers.forEach((function(I){w&&!w(I)||v.scene.addMorphTargetManager(I)})),this.geometries.forEach((function(I){w&&!w(I)||v.scene.addGeometry(I)})),this.transformNodes.forEach((function(I){w&&!w(I)||v.scene.addTransformNode(I)})),this.actionManagers.forEach((function(I){w&&!w(I)||v.scene.addActionManager(I)})),this.textures.forEach((function(I){w&&!w(I)||v.scene.addTexture(I)})),this.reflectionProbes.forEach((function(I){w&&!w(I)||v.scene.addReflectionProbe(I)}))},v.prototype.removeAllFromScene=function(){this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var w=0,v=this.scene._serializableComponents;w<v.length;w++){v[w].removeFromContainer(this)}},v.prototype.removeFromScene=function(w){var v=this;void 0===w&&(w=null),this.cameras.forEach((function(I){w&&!w(I)||v.scene.removeCamera(I)})),this.lights.forEach((function(I){w&&!w(I)||v.scene.removeLight(I)})),this.meshes.forEach((function(I){w&&!w(I)||v.scene.removeMesh(I)})),this.skeletons.forEach((function(I){w&&!w(I)||v.scene.removeSkeleton(I)})),this.animations.forEach((function(I){w&&!w(I)||v.scene.removeAnimation(I)})),this.animationGroups.forEach((function(I){w&&!w(I)||v.scene.removeAnimationGroup(I)})),this.multiMaterials.forEach((function(I){w&&!w(I)||v.scene.removeMultiMaterial(I)})),this.materials.forEach((function(I){w&&!w(I)||v.scene.removeMaterial(I)})),this.morphTargetManagers.forEach((function(I){w&&!w(I)||v.scene.removeMorphTargetManager(I)})),this.geometries.forEach((function(I){w&&!w(I)||v.scene.removeGeometry(I)})),this.transformNodes.forEach((function(I){w&&!w(I)||v.scene.removeTransformNode(I)})),this.actionManagers.forEach((function(I){w&&!w(I)||v.scene.removeActionManager(I)})),this.textures.forEach((function(I){w&&!w(I)||v.scene.removeTexture(I)})),this.reflectionProbes.forEach((function(I){w&&!w(I)||v.scene.removeReflectionProbe(I)}))},v.prototype.dispose=function(){this.cameras.slice(0).forEach((function(w){w.dispose()})),this.cameras=[],this.lights.slice(0).forEach((function(w){w.dispose()})),this.lights=[],this.meshes.slice(0).forEach((function(w){w.dispose()})),this.meshes=[],this.skeletons.slice(0).forEach((function(w){w.dispose()})),this.skeletons=[],this.animationGroups.slice(0).forEach((function(w){w.dispose()})),this.animationGroups=[],this.multiMaterials.slice(0).forEach((function(w){w.dispose()})),this.multiMaterials=[],this.materials.slice(0).forEach((function(w){w.dispose()})),this.materials=[],this.geometries.slice(0).forEach((function(w){w.dispose()})),this.geometries=[],this.transformNodes.slice(0).forEach((function(w){w.dispose()})),this.transformNodes=[],this.actionManagers.slice(0).forEach((function(w){w.dispose()})),this.actionManagers=[],this.textures.slice(0).forEach((function(w){w.dispose()})),this.textures=[],this.reflectionProbes.slice(0).forEach((function(w){w.dispose()})),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var w=0,v=this.scene._serializableComponents;w<v.length;w++){v[w].removeFromContainer(this,!0)}this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)},v.prototype._moveAssets=function(w,v,I){if(w)for(var P=0,u=w;P<u.length;P++){var Q=u[P],K=!0;if(I)for(var a=0,U=I;a<U.length;a++){if(Q===U[a]){K=!1;break}}K&&(v.push(Q),Q._parentContainer=this)}},v.prototype.moveAllFromScene=function(w){for(var v in this._wasAddedToScene=!1,void 0===w&&(w=new l),this)Object.prototype.hasOwnProperty.call(this,v)&&(this[v]=this[v]||("environmentTexture"===v?null:[]),this._moveAssets(this.scene[v],this[v],w[v]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},v.prototype.createRootMesh=function(){var w=new Y.b("assetContainerRootMesh",this.scene);return this.meshes.forEach((function(v){v.parent||w.addChild(v)})),this.meshes.unshift(w),w},v.prototype.mergeAnimationsTo=function(w,v,I){if(void 0===w&&(w=J.e.LastCreatedScene),void 0===I&&(I=null),!w)return g.e.Error("No scene available to merge animations to"),[];var P=I||function(v){var I=null,P=v.animations.length?v.animations[0].targetProperty:"",u=v.name.split(".").join("").split("_primitive")[0];switch(P){case"position":case"rotationQuaternion":I=w.getTransformNodeByName(v.name)||w.getTransformNodeByName(u);break;case"influence":I=w.getMorphTargetByName(v.name)||w.getMorphTargetByName(u);break;default:I=w.getNodeByName(v.name)||w.getNodeByName(u)}return I};this.getNodes().forEach((function(w){var v=P(w);if(null!==v){for(var I=function(w){for(var I=0,P=v.animations.filter((function(v){return v.targetProperty===w.targetProperty}));I<P.length;I++){var u=P[I],Q=v.animations.indexOf(u,0);Q>-1&&v.animations.splice(Q,1)}},u=0,Q=w.animations;u<Q.length;u++){I(Q[u])}v.animations=v.animations.concat(w.animations)}}));var u=new Array;return this.animationGroups.slice().forEach((function(w){u.push(w.clone(w.name,P)),w.animatables.forEach((function(w){w.stop()}))})),v.forEach((function(v){var I=P(v.target);I&&(w.beginAnimation(I,v.fromFrame,v.toFrame,v.loopAnimation,v.speedRatio,v.onAnimationEnd?v.onAnimationEnd:void 0,void 0,!0,void 0,v.onAnimationLoop?v.onAnimationLoop:void 0),w.stopAnimation(v.target))})),u},v}(r.b),j=I(50459),s=function(){function w(w){this.byteOffset=0,this.buffer=w}return w.prototype.loadAsync=function(w){var v=this;return this.buffer.readAsync(this.byteOffset,w).then((function(w){v._dataView=new DataView(w.buffer,w.byteOffset,w.byteLength),v._dataByteOffset=0}))},w.prototype.readUint32=function(){var w=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,w},w.prototype.readUint8Array=function(w){var v=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,w);return this._dataByteOffset+=w,this.byteOffset+=w,v},w.prototype.readString=function(w){return(0,j.f)(this.readUint8Array(w))},w.prototype.skipBytes=function(w){this._dataByteOffset+=w,this.byteOffset+=w},w}(),B=I(36470),t=I(82790),i=I(39524);function z(w,v,I){try{return Promise.resolve(new Uint8Array(w,v,I))}catch(w){return Promise.reject(w)}}!function(w){w[w.AUTO=0]="AUTO",w[w.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(P||(P={})),function(w){w[w.NONE=0]="NONE",w[w.FIRST=1]="FIRST",w[w.ALL=2]="ALL"}(u||(u={})),function(w){w[w.LOADING=0]="LOADING",w[w.READY=1]="READY",w[w.COMPLETE=2]="COMPLETE"}(Q||(Q={}));var E=function(){function w(){this.onParsedObservable=new K.c,this.coordinateSystemMode=P.AUTO,this.animationStartMode=u.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.preprocessUrlAsync=function(w){return Promise.resolve(w)},this.onMeshLoadedObservable=new K.c,this.onSkinLoadedObservable=new K.c,this.onTextureLoadedObservable=new K.c,this.onMaterialLoadedObservable=new K.c,this.onCameraLoadedObservable=new K.c,this.onCompleteObservable=new K.c,this.onErrorObservable=new K.c,this.onDisposeObservable=new K.c,this.onExtensionLoadedObservable=new K.c,this.validate=!1,this.onValidatedObservable=new K.c,this._loader=null,this._state=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this.onLoaderStateChangedObservable=new K.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(w.prototype,"onParsed",{set:function(w){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onMeshLoaded",{set:function(w){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onTextureLoaded",{set:function(w){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onMaterialLoaded",{set:function(w){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onCameraLoaded",{set:function(w){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onComplete",{set:function(w){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onError",{set:function(w){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onDispose",{set:function(w){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onExtensionLoaded",{set:function(w){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(w)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(w){this._loggingEnabled!==w&&(this._loggingEnabled=w,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(w){this._capturePerformanceCounters!==w&&(this._capturePerformanceCounters=w,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onValidated",{set:function(w){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(w)},enumerable:!1,configurable:!0}),w.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var w=0,v=this._requests;w<v.length;w++){v[w].abort()}this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(w){return Promise.resolve(w)},this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},w.prototype.loadFile=function(w,v,I,P,u,Q){var U=this;this._progressCallback=P;var p=v.name?"file:":a.i.GetFolderPath(v),r=v.name||a.i.GetFilename(v);if(u){if(this.useRangeRequests){this.validate&&g.e.Warn("glTF validation is not supported when range requests are enabled");var Y={abort:function(){},onCompleteObservable:new K.c},J={readAsync:function(I,P){return new Promise((function(u,Q){U._loadFile(w,v,(function(w){u(new Uint8Array(w))}),!0,(function(w){Q(w)}),(function(w){w.setRequestHeader("Range","bytes=".concat(I,"-").concat(I+P-1))}))}))},byteLength:0};return this._unpackBinaryAsync(new s(J)).then((function(w){Y.onCompleteObservable.notifyObservers(Y),I(w)}),Q?function(w){return Q(void 0,w)}:void 0),Y}return this._loadFile(w,v,(function(v){U._validate(w,v,p,r),U._unpackBinaryAsync(new s({readAsync:function(w,I){return z(v,w,I)},byteLength:v.byteLength})).then((function(w){I(w)}),Q?function(w){return Q(void 0,w)}:void 0)}),!0,Q)}return this._loadFile(w,v,(function(v){U._validate(w,v,p,r),I({json:U._parseJson(v)})}),u,Q)},w.prototype.importMeshAsync=function(w,v,I,P,u,Q){var K=this;return Promise.resolve().then((function(){return K.onParsedObservable.notifyObservers(I),K.onParsedObservable.clear(),K._log("Loading ".concat(Q||"")),K._loader=K._getLoader(I),K._loader.importMeshAsync(w,v,null,I,P,u,Q)}))},w.prototype.loadAsync=function(w,v,I,P,u){var Q=this;return Promise.resolve().then((function(){return Q.onParsedObservable.notifyObservers(v),Q.onParsedObservable.clear(),Q._log("Loading ".concat(u||"")),Q._loader=Q._getLoader(v),Q._loader.loadAsync(w,v,I,P,u)}))},w.prototype.loadAssetContainerAsync=function(w,v,I,P,u){var Q=this;return Promise.resolve().then((function(){Q.onParsedObservable.notifyObservers(v),Q.onParsedObservable.clear(),Q._log("Loading ".concat(u||"")),Q._loader=Q._getLoader(v);var K=new x(w),a=[];Q.onMaterialLoadedObservable.add((function(w){a.push(w)}));var U=[];Q.onTextureLoadedObservable.add((function(w){U.push(w)}));var p=[];return Q.onCameraLoadedObservable.add((function(w){p.push(w)})),Q._loader.importMeshAsync(null,w,K,v,I,P,u).then((function(w){return Array.prototype.push.apply(K.geometries,w.geometries),Array.prototype.push.apply(K.meshes,w.meshes),Array.prototype.push.apply(K.particleSystems,w.particleSystems),Array.prototype.push.apply(K.skeletons,w.skeletons),Array.prototype.push.apply(K.animationGroups,w.animationGroups),Array.prototype.push.apply(K.materials,a),Array.prototype.push.apply(K.textures,U),Array.prototype.push.apply(K.lights,w.lights),Array.prototype.push.apply(K.transformNodes,w.transformNodes),Array.prototype.push.apply(K.cameras,p),K}))}))},w.prototype.canDirectLoad=function(v){return-1!==v.indexOf("asset")&&-1!==v.indexOf("version")||v.startsWith("data:base64,"+w._MagicBase64Encoded)||v.startsWith("data:;base64,"+w._MagicBase64Encoded)||v.startsWith("data:application/octet-stream;base64,"+w._MagicBase64Encoded)||v.startsWith("data:model/gltf-binary;base64,"+w._MagicBase64Encoded)},w.prototype.directLoad=function(v,I){if(I.startsWith("base64,"+w._MagicBase64Encoded)||I.startsWith(";base64,"+w._MagicBase64Encoded)||I.startsWith("application/octet-stream;base64,"+w._MagicBase64Encoded)||I.startsWith("model/gltf-binary;base64,"+w._MagicBase64Encoded)){var P=(0,t.c)(I);return this._validate(v,P),this._unpackBinaryAsync(new s({readAsync:function(w,v){return z(P,w,v)},byteLength:P.byteLength}))}return this._validate(v,I),Promise.resolve({json:this._parseJson(I)})},w.prototype.createPlugin=function(){return new w},Object.defineProperty(w.prototype,"loaderState",{get:function(){return this._state},enumerable:!1,configurable:!0}),w.prototype.whenCompleteAsync=function(){var w=this;return new Promise((function(v,I){w.onCompleteObservable.addOnce((function(){v()})),w.onErrorObservable.addOnce((function(w){I(w)}))}))},w.prototype._setState=function(w){this._state!==w&&(this._state=w,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(Q[this._state]))},w.prototype._loadFile=function(w,v,I,P,u,Q){var K=this,a=w._loadFile(v,I,(function(w){K._onProgress(w,a)}),!0,P,u,Q);return a.onCompleteObservable.add((function(w){K._requests.splice(K._requests.indexOf(w),1)})),this._requests.push(a),a},w.prototype._onProgress=function(w,v){if(this._progressCallback){v._lengthComputable=w.lengthComputable,v._loaded=w.loaded,v._total=w.total;for(var I=!0,P=0,u=0,Q=0,K=this._requests;Q<K.length;Q++){var a=K[Q];if(void 0===a._lengthComputable||void 0===a._loaded||void 0===a._total)return;I=I&&a._lengthComputable,P+=a._loaded,u+=a._total}this._progressCallback({lengthComputable:I,loaded:P,total:I?u:0})}},w.prototype._validate=function(w,v,I,P){var u=this;void 0===I&&(I=""),void 0===P&&(P=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),B.c.ValidateAsync(v,I,P,(function(v){return u.preprocessUrlAsync(I+v).then((function(v){return w._loadFileAsync(v,void 0,!0,!0)}))})).then((function(w){u._endPerformanceCounter("Validate JSON"),u.onValidatedObservable.notifyObservers(w),u.onValidatedObservable.clear()}),(function(w){u._endPerformanceCounter("Validate JSON"),a.i.Warn("Failed to validate: ".concat(w.message)),u.onValidatedObservable.clear()})))},w.prototype._getLoader=function(v){var I=v.json.asset||{};this._log("Asset version: ".concat(I.version)),I.minVersion&&this._log("Asset minimum version: ".concat(I.minVersion)),I.generator&&this._log("Asset generator: ".concat(I.generator));var P=w._parseVersion(I.version);if(!P)throw new Error("Invalid version: "+I.version);if(void 0!==I.minVersion){var u=w._parseVersion(I.minVersion);if(!u)throw new Error("Invalid minimum version: "+I.minVersion);if(w._compareVersion(u,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+I.minVersion)}var Q={1:w._CreateGLTF1Loader,2:w._CreateGLTF2Loader}[P.major];if(!Q)throw new Error("Unsupported version: "+I.version);return Q(this)},w.prototype._parseJson=function(w){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(w.length));var v=JSON.parse(w);return this._endPerformanceCounter("Parse JSON"),v},w.prototype._unpackBinaryAsync=function(w){var v=this;return this._startPerformanceCounter("Unpack Binary"),w.loadAsync(20).then((function(){var I=w.readUint32();if(1179937895!==I)throw new i.f("Unexpected magic: "+I,i.e.GLTFLoaderUnexpectedMagicError);var P=w.readUint32();v.loggingEnabled&&v._log("Binary version: ".concat(P));var u,Q=w.readUint32();if(0!==w.buffer.byteLength&&Q!==w.buffer.byteLength)throw new Error("Length in header does not match actual data length: ".concat(Q," != ").concat(w.buffer.byteLength));switch(P){case 1:u=v._unpackBinaryV1Async(w,Q);break;case 2:u=v._unpackBinaryV2Async(w,Q);break;default:throw new Error("Unsupported version: "+P)}return v._endPerformanceCounter("Unpack Binary"),u}))},w.prototype._unpackBinaryV1Async=function(w,v){var I=w.readUint32(),P=w.readUint32();if(0!==P)throw new Error("Unexpected content format: ".concat(P));var u=v-w.byteOffset,Q={json:this._parseJson(w.readString(I)),bin:null};if(0!==u){var K=w.byteOffset;Q.bin={readAsync:function(v,I){return w.buffer.readAsync(K+v,I)},byteLength:u}}return Promise.resolve(Q)},w.prototype._unpackBinaryV2Async=function(w,v){var I=this,P=1313821514,u=5130562,Q=w.readUint32();if(w.readUint32()!==P)throw new Error("First chunk format is not JSON");return w.byteOffset+Q===v?w.loadAsync(Q).then((function(){return{json:I._parseJson(w.readString(Q)),bin:null}})):w.loadAsync(Q+8).then((function(){var K={json:I._parseJson(w.readString(Q)),bin:null};return function I(){var Q=w.readUint32();switch(w.readUint32()){case P:throw new Error("Unexpected JSON chunk");case u:var a=w.byteOffset;K.bin={readAsync:function(v,I){return w.buffer.readAsync(a+v,I)},byteLength:Q},w.skipBytes(Q);break;default:w.skipBytes(Q)}return w.byteOffset!==v?w.loadAsync(8).then(I):Promise.resolve(K)}()}))},w._parseVersion=function(w){if("1.0"===w||"1.0.1"===w)return{major:1,minor:0};var v=(w+"").match(/^(\d+)\.(\d+)/);return v?{major:parseInt(v[1]),minor:parseInt(v[2])}:null},w._compareVersion=function(w,v){return w.major>v.major?1:w.major<v.major?-1:w.minor>v.minor?1:w.minor<v.minor?-1:0},w.prototype._logOpen=function(w){this._log(w),this._logIndentLevel++},w.prototype._logClose=function(){--this._logIndentLevel},w.prototype._logEnabled=function(v){var I=w._logSpaces.substr(0,2*this._logIndentLevel);g.e.Log("".concat(I).concat(v))},w.prototype._logDisabled=function(w){},w.prototype._startPerformanceCounterEnabled=function(w){a.i.StartPerformanceCounter(w)},w.prototype._startPerformanceCounterDisabled=function(w){},w.prototype._endPerformanceCounterEnabled=function(w){a.i.EndPerformanceCounter(w)},w.prototype._endPerformanceCounterDisabled=function(w){},w.IncrementalLoading=!0,w.HomogeneousCoordinates=!1,w._MagicBase64Encoded="Z2xURg",w._logSpaces="                                ",w}();U.e&&U.e.RegisterPlugin(new E)},36470:function(w,v,I){"use strict";I.d(v,{c:function(){return K}});var P=I(9217);function u(w,v,I,P){var u={externalResourceFunction:function(w){return P(w).then((function(w){return new Uint8Array(w)}))}};return I&&(u.uri="file:"===v?I:v+I),w instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(w),u):GLTFValidator.validateString(w,u)}function Q(){var w=[];onmessage=function(v){var I=v.data;switch(I.id){case"init":importScripts(I.url);break;case"validate":u(I.data,I.rootUrl,I.fileName,(function(v){return new Promise((function(I,P){var u=w.length;w.push({resolve:I,reject:P}),postMessage({id:"getExternalResource",index:u,uri:v})}))})).then((function(w){postMessage({id:"validate.resolve",value:w})}),(function(w){postMessage({id:"validate.reject",reason:w})}));break;case"getExternalResource.resolve":w[I.index].resolve(I.value);break;case"getExternalResource.reject":w[I.index].reject(I.reason)}}}var K=function(){function w(){}return w.ValidateAsync=function(w,v,I,K){var a=this;return"function"===typeof Worker?new Promise((function(P,U){var p="".concat(u,"(").concat(Q,")()"),r=URL.createObjectURL(new Blob([p],{type:"application/javascript"})),Y=new Worker(r),g=function w(v){Y.removeEventListener("error",w),Y.removeEventListener("message",J),U(v)},J=function w(v){var I=v.data;switch(I.id){case"getExternalResource":K(I.uri).then((function(w){Y.postMessage({id:"getExternalResource.resolve",index:I.index,value:w},[w])}),(function(w){Y.postMessage({id:"getExternalResource.reject",index:I.index,reason:w})}));break;case"validate.resolve":Y.removeEventListener("error",g),Y.removeEventListener("message",w),P(I.value),Y.terminate();break;case"validate.reject":Y.removeEventListener("error",g),Y.removeEventListener("message",w),U(I.reason),Y.terminate()}};Y.addEventListener("error",g),Y.addEventListener("message",J),Y.postMessage({id:"init",url:a.Configuration.url}),Y.postMessage({id:"validate",data:w,rootUrl:v,fileName:I})})):(this._LoadScriptPromise||(this._LoadScriptPromise=P.i.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((function(){return u(w,v,I,K)})))},w.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},w}()},52014:function(w,v,I){"use strict";I.d(v,{e:function(){return t}});var P=function(w,v){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,v){w.__proto__=v}||function(w,v){for(var I in v)Object.prototype.hasOwnProperty.call(v,I)&&(w[I]=v[I])},P(w,v)};function u(w,v){if("function"!==typeof v&&null!==v)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");function I(){this.constructor=w}P(w,v),w.prototype=null===v?Object.create(v):(I.prototype=v.prototype,new I)}function Q(w,v,I,P){var u,Q=arguments.length,K=Q<3?v:null===P?P=Object.getOwnPropertyDescriptor(v,I):P;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)K=Reflect.decorate(w,v,I,P);else for(var a=w.length-1;a>=0;a--)(u=w[a])&&(K=(Q<3?u(K):Q>3?u(v,I,K):u(v,I))||K);return Q>3&&K&&Object.defineProperty(v,I,K),K}Object.create;Object.create;var K=I(9892),a=I(80105),U=I(4241),p=I(33048),r=I(29553),Y=I(43251),g=I(37105),J=I(31709),l=I(16179),R=(I(76578),I(35850),I(84098),I(80345),"#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n");l.c.IncludesShadersStore.imageProcessingCompatibility=R;var x="precision highp float;\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;\nuniform vec3 cameraOffset;\nuniform vec3 up;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0);\ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\nvec3 retColor=curr*whiteScale;\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";l.c.ShadersStore.skyPixelShader=x;I(49329),I(23654),I(61906),I(32560);var j="precision highp float;\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";l.c.ShadersStore.skyVertexShader=j;var s=I(54497),B=function(w){function v(){var v=w.call(this)||this;return v.CLIPPLANE=!1,v.CLIPPLANE2=!1,v.CLIPPLANE3=!1,v.CLIPPLANE4=!1,v.CLIPPLANE5=!1,v.CLIPPLANE6=!1,v.POINTSIZE=!1,v.FOG=!1,v.VERTEXCOLOR=!1,v.VERTEXALPHA=!1,v.IMAGEPROCESSINGPOSTPROCESS=!1,v.SKIPFINALCOLORCLAMP=!1,v.rebuild(),v}return u(v,w),v}(U.b),t=function(w){function v(v,I){var P=w.call(this,v,I)||this;return P.luminance=1,P.turbidity=10,P.rayleigh=2,P.mieCoefficient=.005,P.mieDirectionalG=.8,P.distance=500,P.inclination=.49,P.azimuth=.25,P.sunPosition=new a.l(0,100,0),P.useSunPosition=!1,P.cameraOffset=a.l.Zero(),P.up=a.l.Up(),P._cameraPosition=a.l.Zero(),P._skyOrientation=new a.f,P}return u(v,w),v.prototype.needAlphaBlending=function(){return this.alpha<1},v.prototype.needAlphaTesting=function(){return!1},v.prototype.getAlphaTestTexture=function(){return null},v.prototype.isReadyForSubMesh=function(w,v){if(this.isFrozen&&v.effect&&v.effect._wasPreviouslyReady)return!0;v.materialDefines||(v.materialDefines=new B);var I=v.materialDefines,P=this.getScene();if(this._isReadyForSubMesh(v))return!0;if(p.e.PrepareDefinesForMisc(w,P,!1,this.pointsCloud,this.fogEnabled,!1,I),p.e.PrepareDefinesForAttributes(w,I,!0,!1),I.IMAGEPROCESSINGPOSTPROCESS!==P.imageProcessingConfiguration.applyByPostProcess&&I.markAsMiscDirty(),I.isDirty){I.markAsProcessed(),P.resetCachedMaterial();var u=new s.b;I.FOG&&u.addFallback(1,"FOG"),I.IMAGEPROCESSINGPOSTPROCESS=P.imageProcessingConfiguration.applyByPostProcess;var Q=[Y.f.PositionKind];I.VERTEXCOLOR&&Q.push(Y.f.ColorKind);var K=I.toString();v.setEffect(P.getEngine().createEffect("sky",Q,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"],[],K,u,this.onCompiled,this.onError),I,this._materialContext)}return!(!v.effect||!v.effect.isReady())&&(I._renderId=P.getRenderId(),v.effect._wasPreviouslyReady=!0,!0)},v.prototype.bindForSubMesh=function(w,v,I){var P=this.getScene();if(I.materialDefines){var u=I.effect;if(u){this._activeEffect=u,this.bindOnlyWorldMatrix(w),this._activeEffect.setMatrix("viewProjection",P.getTransformMatrix()),this._mustRebind(P,u)&&(p.e.BindClipPlane(this._activeEffect,P),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),P.fogEnabled&&v.applyFog&&P.fogMode!==g.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",P.getViewMatrix()),p.e.BindFogParameters(P,v,this._activeEffect);var Q=P.activeCamera;if(Q){var K=Q.getWorldMatrix();this._cameraPosition.x=K.m[12],this._cameraPosition.y=K.m[13],this._cameraPosition.z=K.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var U=Math.PI*(this.inclination-.5),r=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(r)*Math.cos(U),this.sunPosition.y=this.distance*Math.sin(-U),this.sunPosition.z=this.distance*Math.sin(r)*Math.cos(U),a.f.FromUnitVectorsToRef(a.l.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(v,this._activeEffect)}}},v.prototype.getAnimatables=function(){return[]},v.prototype.dispose=function(v){w.prototype.dispose.call(this,v)},v.prototype.clone=function(w){var I=this;return K.e.Clone((function(){return new v(w,I.getScene())}),this)},v.prototype.serialize=function(){var v=w.prototype.serialize.call(this);return v.customType="BABYLON.SkyMaterial",v},v.prototype.getClassName=function(){return"SkyMaterial"},v.Parse=function(w,I,P){return K.e.Parse((function(){return new v(w.name,I)}),w,I,P)},Q([(0,K.J)()],v.prototype,"luminance",void 0),Q([(0,K.J)()],v.prototype,"turbidity",void 0),Q([(0,K.J)()],v.prototype,"rayleigh",void 0),Q([(0,K.J)()],v.prototype,"mieCoefficient",void 0),Q([(0,K.J)()],v.prototype,"mieDirectionalG",void 0),Q([(0,K.J)()],v.prototype,"distance",void 0),Q([(0,K.J)()],v.prototype,"inclination",void 0),Q([(0,K.J)()],v.prototype,"azimuth",void 0),Q([(0,K.G)()],v.prototype,"sunPosition",void 0),Q([(0,K.J)()],v.prototype,"useSunPosition",void 0),Q([(0,K.G)()],v.prototype,"cameraOffset",void 0),Q([(0,K.G)()],v.prototype,"up",void 0),v}(r.d);(0,J.g)("BABYLON.SkyMaterial",t)},22494:function(w,v,I){"use strict";function P(w,v){v.headers=w.headers||{},v.statusMessage=w.statusText,v.statusCode=w.status,v.data=w.response}function u(w,v,I){return new Promise((function(u,Q){I=I||{};var K,a,U,p=new XMLHttpRequest,r=I.body,Y=I.headers||{};for(K in I.timeout&&(p.timeout=I.timeout),p.ontimeout=p.onerror=function(w){w.timeout="timeout"==w.type,Q(w)},p.open(w,v.href||v),p.onload=function(){for(U=p.getAllResponseHeaders().trim().split(/[\r\n]+/),P(p,p);a=U.shift();)a=a.split(": "),p.headers[a.shift().toLowerCase()]=a.join(": ");if((a=p.headers["content-type"])&&~a.indexOf("application/json"))try{p.data=JSON.parse(p.data,I.reviver)}catch(w){return P(p,w),Q(w)}(p.status>=400?Q:u)(p)},typeof FormData<"u"&&r instanceof FormData||r&&"object"==typeof r&&(Y["content-type"]="application/json",r=JSON.stringify(r)),p.withCredentials=!!I.withCredentials,Y)p.setRequestHeader(K,Y[K]);p.send(r)}))}I.r(v),I.d(v,{del:function(){return U},get:function(){return Q},patch:function(){return a},post:function(){return K},put:function(){return p},send:function(){return u}});var Q=u.bind(u,"GET"),K=u.bind(u,"POST"),a=u.bind(u,"PATCH"),U=u.bind(u,"DELETE"),p=u.bind(u,"PUT")},4088:function(w,v,I){"use strict";Math.sqrt(3),Math.sqrt(3),Math.sqrt(5),Math.sqrt(5),new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0])}}]);